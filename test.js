webpackJsonp([24], [, , , , function(t, e, i) {
    "use strict";
    var n = i(29)
      , r = i(455)
      , a = i.n(r)
      , s = i(313);
    i.i(s.a)(),
    i.i(n.a)().webgl2 && (a.a.osg.Options.getOptionsURL().webgl2 = !0),
    i(1006),
    i(1005),
    i(1004),
    e.a = a.a
}
, function(t, e, i) {
    "use strict";
    var n = i(379)
      , r = i(830)
      , a = i(837);
    r.glMatrix.setMatrixArrayType(a.ArrayType),
    r.glMatrix.EPSILON = 1e-9;
    var s = r.vec2
      , o = r.vec3
      , l = r.vec4
      , u = r.mat4
      , h = r.mat3
      , c = r.quat;
    o.create32 = function() {
        return new Float32Array(3)
    }
    ,
    o.create64 = function() {
        return new Float64Array(3)
    }
    ,
    o.fromValues32 = function(t, e, i) {
        var n = new Float32Array(3);
        return n[0] = t,
        n[1] = e,
        n[2] = i,
        n
    }
    ,
    o.fromValues64 = function(t, e, i) {
        var n = new Float64Array(3);
        return n[0] = t,
        n[1] = e,
        n[2] = i,
        n
    }
    ,
    o.init = function(t) {
        return o.set(t, 0, 0, 0)
    }
    ,
    o.transformMat4Rotate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2];
        return t[0] = i[0] * n + i[1] * r + i[2] * a,
        t[1] = i[4] * n + i[5] * r + i[6] * a,
        t[2] = i[8] * n + i[9] * r + i[10] * a,
        t
    }
    ,
    o.valid = function(t) {
        return !n.isNaN(t[0]) && (!n.isNaN(t[1]) && !n.isNaN(t[2]))
    }
    ,
    o.neg = o.negate,
    o.ZERO = o.create(),
    o.ONE = o.fromValues(1, 1, 1),
    o.INFINITY = o.fromValues(1 / 0, 1 / 0, 1 / 0),
    o.NEGATIVE_INFINITY = o.fromValues(-1 / 0, -1 / 0, -1 / 0),
    s.create32 = function() {
        return new Float32Array(2)
    }
    ,
    s.create64 = function() {
        return new Float64Array(2)
    }
    ,
    s.fromValues32 = function(t, e) {
        var i = new Float32Array(2);
        return i[0] = t,
        i[1] = e,
        i
    }
    ,
    s.fromValues64 = function(t, e) {
        var i = new Float64Array(2);
        return i[0] = t,
        i[1] = e,
        i
    }
    ,
    s.init = function(t) {
        return s.set(t, 0, 0)
    }
    ,
    s.valid = function(t) {
        return !n.isNaN(t[0]) && !n.isNaN(t[1])
    }
    ,
    s.ZERO = s.create(),
    s.ONE = s.fromValues(1, 1),
    s.INFINITY = s.fromValues(1 / 0, 1 / 0),
    s.NEGATIVE_INFINITY = s.fromValues(-1 / 0, -1 / 0),
    l.create32 = function() {
        return new Float32Array(4)
    }
    ,
    l.create64 = function() {
        return new Float64Array(4)
    }
    ,
    l.fromValues32 = function(t, e, i, n) {
        var r = new Float32Array(4);
        return r[0] = t,
        r[1] = e,
        r[2] = i,
        r[3] = n,
        r
    }
    ,
    l.fromValues64 = function(t, e, i, n) {
        var r = new Float64Array(4);
        return r[0] = t,
        r[1] = e,
        r[2] = i,
        r[3] = n,
        r
    }
    ,
    l.init = function(t) {
        return l.set(t, 0, 0, 0, 0)
    }
    ,
    l.valid = function(t) {
        return !n.isNaN(t[0]) && (!n.isNaN(t[1]) && (!n.isNaN(t[2]) && !n.isNaN(t[3])))
    }
    ,
    l.neg = l.negate,
    l.ZERO = l.create(),
    l.ONE = l.fromValues(1, 1, 1, 1),
    l.INFINITY = l.fromValues(1 / 0, 1 / 0, 1 / 0, 1 / 0),
    l.NEGATIVE_INFINITY = l.fromValues(-1 / 0, -1 / 0, -1 / 0, -1 / 0),
    c.IDENTITY = c.create(),
    c.zeroRotation = function(t) {
        return 0 === t[0] && 0 === t[1] && 0 === t[2] && 1 === t[3]
    }
    ,
    c.create32 = function() {
        var t = new Float32Array(4);
        return t[3] = 1,
        t
    }
    ,
    c.create64 = function() {
        var t = new Float64Array(4);
        return t[3] = 1,
        t
    }
    ,
    c.fromValues32 = l.fromValues32,
    c.fromValues64 = l.fromValues64,
    c.init = c.identity,
    c.nlerp = function(t, e, i, n) {
        var r, a, s, o, l = e[0], u = e[1], h = e[2], c = e[3], d = i[0], p = i[1], f = i[2], g = i[3], m = l * d + u * p + h * f + c * g, v = 1 - n;
        m < 0 ? (r = l * v - d * n,
        a = u * v - p * n,
        s = h * v - f * n,
        o = c * v - g * n) : (r = l * v + d * n,
        a = u * v + p * n,
        s = h * v + f * n,
        o = c * v + g * n);
        var _ = 1 / Math.sqrt(r * r + a * a + s * s + o * o);
        return t[0] = r * _,
        t[1] = a * _,
        t[2] = s * _,
        t[3] = o * _,
        t
    }
    ,
    h.IDENTITY = h.create(),
    h.create32 = function() {
        var t = new Float32Array(9);
        return t[0] = t[4] = t[8] = 1,
        t
    }
    ,
    h.create64 = function() {
        var t = new Float64Array(9);
        return t[0] = t[4] = t[8] = 1,
        t
    }
    ,
    u.IDENTITY = u.create(),
    u.create32 = function() {
        var t = new Float32Array(16);
        return t[0] = t[5] = t[10] = t[15] = 1,
        t
    }
    ,
    u.create64 = function() {
        var t = new Float64Array(16);
        return t[0] = t[5] = t[10] = t[15] = 1,
        t
    }
    ,
    u.setTranslation = function(t, e) {
        return t[12] = e[0],
        t[13] = e[1],
        t[14] = e[2],
        t
    }
    ,
    u.getFrustum = function(t, e) {
        var i, n, r = 0, a = 0, s = 0, o = 0;
        if (0 !== e[3] || 0 !== e[7] || -1 !== e[11] || 0 !== e[15])
            return !1;
        var l = e[14] / (e[10] - 1)
          , u = e[14] / (1 + e[10]);
        return a = l * (e[8] - 1) / e[0],
        r = l * (1 + e[8]) / e[0],
        s = l * (1 + e[9]) / e[5],
        o = l * (e[9] - 1) / e[5],
        i = l,
        n = u,
        t.left = a,
        t.right = r,
        t.top = s,
        t.bottom = o,
        t.zNear = i,
        t.zFar = n,
        !0
    }
    ,
    u.getPerspective = function() {
        var t = {
            right: 0,
            left: 0,
            top: 0,
            bottom: 0,
            zNear: 0,
            zFar: 0
        };
        return function(e, i) {
            return u.getFrustum(t, i) && (e.fovy = 180 / Math.PI * (Math.atan(t.top / t.zNear) - Math.atan(t.bottom / t.zNear)),
            e.aspectRatio = (t.right - t.left) / (t.top - t.bottom)),
            e.zNear = t.zNear,
            e.zFar = t.zFar,
            e
        }
    }(),
    u.getLookAt = function() {
        var t = u.create()
          , e = o.create()
          , i = o.fromValues(0, 1, 0)
          , n = o.fromValues(0, 0, -1);
        return function(r, a, s, l, h) {
            var c = void 0 !== h ? h : 1;
            u.invert(t, l),
            u.getTranslation(r, t),
            o.transformMat4Rotate(s, i, l),
            o.transformMat4Rotate(a, n, l),
            o.normalize(a, a),
            o.add(a, o.scale(e, a, c), r)
        }
    }(),
    u.getFrustumPlanes = function() {
        var t = u.create();
        return function(e, i, n, r) {
            u.mul(t, i, n);
            var a = !!r
              , s = e[0];
            s[0] = t[3] - t[0],
            s[1] = t[7] - t[4],
            s[2] = t[11] - t[8],
            s[3] = t[15] - t[12];
            var o = e[1];
            o[0] = t[3] + t[0],
            o[1] = t[7] + t[4],
            o[2] = t[11] + t[8],
            o[3] = t[15] + t[12];
            var l = e[2];
            l[0] = t[3] + t[1],
            l[1] = t[7] + t[5],
            l[2] = t[11] + t[9],
            l[3] = t[15] + t[13];
            var h = e[3];
            h[0] = t[3] - t[1],
            h[1] = t[7] - t[5],
            h[2] = t[11] - t[9],
            h[3] = t[15] - t[13];
            var c = 4;
            if (a) {
                c = 6;
                var d = e[4];
                d[0] = t[3] - t[2],
                d[1] = t[7] - t[6],
                d[2] = t[11] - t[10],
                d[3] = t[15] - t[14];
                var p = e[5];
                p[0] = t[3] + t[2],
                p[1] = t[7] + t[6],
                p[2] = t[11] + t[10],
                p[3] = t[15] + t[14]
            }
            for (var f = 0; f < c; f++) {
                var g = e[f]
                  , m = 1 / Math.sqrt(g[0] * g[0] + g[1] * g[1] + g[2] * g[2]);
                g[0] *= m,
                g[1] *= m,
                g[2] *= m,
                g[3] *= m
            }
        }
    }(),
    u.infiniteFrustum = function(t, e, i, n, r, a) {
        var s = 2 * a / (i - e)
          , o = 2 * a / (r - n)
          , l = (i + e) / (i - e)
          , u = (r + n) / (r - n);
        return t[0] = s,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = o,
        t[6] = 0,
        t[7] = 0,
        t[8] = l,
        t[9] = u,
        t[10] = -1,
        t[11] = -1,
        t[12] = 0,
        t[13] = 0,
        t[14] = -2 * a,
        t[15] = 0,
        t
    }
    ,
    u.lookAtDirection = function() {
        var t = o.create()
          , e = o.create()
          , i = o.create();
        return function(n, r, a, s) {
            var l = a;
            return o.cross(t, l, s),
            o.normalize(t, t),
            o.cross(e, t, l),
            o.normalize(e, e),
            n[0] = t[0],
            n[1] = e[0],
            n[2] = -l[0],
            n[3] = 0,
            n[4] = t[1],
            n[5] = e[1],
            n[6] = -l[1],
            n[7] = 0,
            n[8] = t[2],
            n[9] = e[2],
            n[10] = -l[2],
            n[11] = 0,
            n[12] = 0,
            n[13] = 0,
            n[14] = 0,
            n[15] = 1,
            u.translate(n, n, o.neg(i, r))
        }
    }(),
    u.getScale = function() {
        var t = o.create()
          , e = o.create()
          , i = o.create();
        return function(n, r) {
            return t[0] = r[0],
            t[1] = r[4],
            t[2] = r[8],
            e[0] = r[1],
            e[1] = r[5],
            e[2] = r[9],
            i[0] = r[2],
            i[1] = r[6],
            i[2] = r[10],
            n[0] = o.length(t),
            n[1] = o.length(e),
            n[2] = o.length(i),
            n
        }
    }(),
    u.getSqrScale = function() {
        var t = o.create()
          , e = o.create()
          , i = o.create();
        return function(n, r) {
            return t[0] = r[0],
            t[1] = r[4],
            t[2] = r[8],
            e[0] = r[1],
            e[1] = r[5],
            e[2] = r[9],
            i[0] = r[2],
            i[1] = r[6],
            i[2] = r[10],
            n[0] = o.sqrLen(t),
            n[1] = o.sqrLen(e),
            n[2] = o.sqrLen(i),
            n
        }
    }();
    var d = u.rotate;
    u.rotate = function(t, e, i, n) {
        return d(t, e, i, n) || u.identity(t)
    }
    ;
    var p = u.fromRotation;
    u.fromRotation = function(t, e, i) {
        return p(t, e, i) || u.identity(t)
    }
    ,
    t.exports = r
}
, , , , function(t, e, i) {
    "use strict";
    Object.defineProperty(e, "__esModule", {
        value: !0
    });
    var n = i(2)
      , r = i.n(n)
      , a = i(391)
      , s = i.n(a)
      , o = i(297)
      , l = i.n(o)
      , u = i(1)
      , h = (i.n(u),
    i(147))
      , c = i(286)
      , d = i(11)
      , p = i(155)
      , f = i(21)
      , g = i(398)
      , m = i(132)
      , v = l.a.Loader.extend({
        getSource: function(t) {
            return {
                src: {
                    type: "code",
                    obj: window.nunjucksPrecompiled[t]
                },
                path: t
            }
        }
    })
      , _ = new l.a.Environment([new v],{
        autoescape: !0
    });
    _.addFilter("log", function(t) {
        return console.log("[Nunjucks] : ", t),
        t
    }),
    _.addFilter("urlize", m.a.urlize),
    _.addFilter("best_fit", p.a),
    _.addFilter("iterable", function(t) {
        return Array.isArray(t) ? t : [t]
    }),
    _.addFilter("slugify", m.a.slugify),
    _.addFilter("call_macro_by_name", function(t) {
        var e = this.ctx[t]
          , i = Array.prototype.slice.call(arguments, 1);
        if (!e)
            throw new Error('Missing macro "' + t + '"');
        return e.apply(this, i)
    }),
    _.addFilter("user_profile_filled", function(t) {
        return "avatar-blue" !== t.avatars.name && "avatar-orange" !== t.avatars.name && "avatar-grey" !== t.avatars.name && (t.biography || t.tagline || t.city || t.country) && (t.website || t.twitterUsername || t.linkedinUsername || t.facebookUsername)
    }),
    _.addFilter("print_suggestion_verb", function(t, e) {
        var i = "";
        return 0 === t && (i = e.displayName + " is a <b>popular</b> user"),
        10 === t && (i = "You <b>liked</b> their models :"),
        20 === t && (i = "You share a common <b>skill</b> :"),
        30 === t && (i = "You share a common <b>interest</b> :"),
        40 === t && (i = "Your profiles are similar."),
        l.a.runtime.markSafe(i)
    }),
    _.addFilter("print_suggestion_target", function(t, e) {
        if (0 === e)
            return "";
        if (10 === e) {
            var i = [];
            return t.forEach(function(t) {
                var e = r()('<a href="/models/' + t.uid + '">' + t.name + "</a>");
                i.push(r()("<div>").append(e).html())
            }),
            l.a.runtime.markSafe(i.join(", "))
        }
        return 20 === e ? t.name : 30 === e ? t.name : 40 === e ? "" : void 0
    });
    var b;
    _.addFilter("skill_slug_to_name", function(t) {
        return b || (b = new c.a,
        b.fetch({
            immediate: !0
        })),
        b.findWhere({
            slug: t
        }).get("name")
    });
    var x;
    _.addFilter("category_uid_to_name", function(t) {
        x || (x = new h.a,
        x.fetch({
            immediate: !0
        }));
        var e = x.findWhere({
            uid: t
        })
          , i = e.get("name");
        return e.get("parent") && (i = x.findWhere({
            uid: e.get("parent")
        }).get("name ") + "/" + i),
        i
    }),
    _.addFilter("underscorify", m.a.underscorify),
    _.addFilter("image_container", function(t, e, i, n, a, s) {
        var o = _.getFilter("best_fit")(t, e, i)
          , u = ""
          , h = o ? {
            backgroundImage: "url(" + o + ")"
        } : {}
          , c = r()("<div/>").attr("class", "image-container").css({
            width: n ? "100%" : e
        });
        return s ? (u = r()("<div/>").attr("class", "model-card-placeholder")[0].outerHTML,
        c.attr("data-background", o)) : c.css(h),
        l.a.runtime.markSafe(u + c.append(r()("<div/>").css({
            paddingTop: i / e * 100 + "%"
        }))[0].outerHTML)
    }),
    _.addFilter("query_string", function(t, e) {
        var i = document.createElement("a");
        return i.href = t,
        Object.keys(e).length && (i.search = "?" + f.a.craft(f.a.reset(i.search, e))),
        i.href
    }),
    _.addFilter("first_n", function(t, e) {
        return t.slice(0, e)
    }),
    _.addFilter("fill_null", function(t, e) {
        for (var i = t.slice(); i.length < e; )
            i.push(null);
        return i
    }),
    _.addFilter("prettify_text", function(t, e) {
        var i = _.getFilter("striptags")(t);
        return _.getFilter("urlize")(i, e)
    }),
    _.addFilter("paragraphy", m.a.paragraphy),
    _.addFilter("striptags", m.a.stripTags),
    _.addFilter("humanize_number", function(t) {
        var e = parseFloat(t)
          , i = [3, 6, 9, 12, 15]
          , n = ["k", "M", "B", "T", "P"];
        if (!e)
            return t;
        var r = e < 0 ? "-" : ""
          , a = Math.abs(e);
        if (a < 1e3)
            return e;
        for (var s = 0, o = i.length; s < o; ++s) {
            var l = function(t, e) {
                if (e <= 0)
                    return t;
                var i = Math.pow(10, e)
                  , n = t * i;
                return Math.round(n) / i
            }(a / Math.pow(10, i[s]), 1);
            if (l < 1e3) {
                var u = Math.floor(l);
                return l !== u ? r + l + n[s] : r + u + n[s]
            }
        }
        return e < 0 ? "1000- P" : "1000+ P"
    }),
    _.addFilter("pluralize", m.a.pluralize),
    _.addFilter("merge", function(t, e) {
        return i.i(u.extend)({}, t, e)
    }),
    _.addFilter("json_data", function(t) {
        return JSON.stringify(t).replace(/<\//g, "<\\/")
    }),
    _.addFilter("format_date", function(t, e) {
        var i;
        return i = "full" === e ? "YYYY/MM/DD HH:mm" : "L",
        s.a.utc(t).format(i)
    }),
    _.addFilter("max", function(t) {
        return Math.max.apply(Math, t)
    }),
    _.addFilter("min", function(t) {
        return Math.min.apply(Math, t)
    }),
    _.addFilter("time_ago", function(t) {
        return g.a.timeAgo(s.a.utc(t).toDate())
    }),
    _.addFilter("seconds_to_duration", function(t) {
        return s.a.utc(1e3 * parseFloat(t)).format("mm:ss")
    }),
    _.addFilter("can_upgrade_to_pro", function(t) {
        return new d.a(t).canUpgradeToPro()
    }),
    _.addFilter("can_protect_models", function(t) {
        return new d.a(t).canProtectModels()
    });
    var y = _.getFilter("trim");
    _.addFilter("trim", function(t) {
        return null === t ? "" : y(t)
    }),
    e.default = {
        get: function(t, e) {
            var i = function(e) {
                return _.render(t + ".jinja", e)
            };
            return e ? i(e) : i
        },
        getFromString: function(t, e) {
            var i = function(e) {
                return _.renderString(t, e)
            };
            return e ? i(e) : i
        },
        getFromMacro: function(t, e, i) {
            Array.isArray(t) && (i = e,
            e = t[1],
            t = t[0]);
            var n = function(i) {
                return _.renderString(["{%- from source import " + e + " -%}", "{{ " + e + "(" + i.map(function(t, e) {
                    return "parameters[ " + e + " ]"
                }).join(",") + ") }}"].join("\n"), {
                    source: t + ".jinja",
                    parameters: i
                })
            };
            return i ? n(i) : n
        },
        equal: function() {
            var t, e, i;
            return "object" == typeof arguments[1] ? (t = arguments[0],
            e = arguments[1],
            i = Array.prototype.slice.call(arguments, 2)) : (t = arguments[0],
            e = {},
            i = Array.prototype.slice.call(arguments, 1)),
            equal.apply(void 0, [this.getFromString(t, e)].concat(i))
        }
    }
}
, , , , function(t, e, i) {
    "use strict";
    var n = i(467);
    i(433);
    var r = i(324)
      , a = i(28)
      , s = {};
    s.init = function() {
        var t = i(433);
        n.memoryPools.stateGraph = new n.OsgObjectMemoryPool(t).grow(50)
    }
    ,
    s.extend = function() {
        var t, e, i, n, r = window.Object.prototype.toString, a = window.Object.prototype.hasOwnProperty, o = s.isArray, l = function(t) {
            if (!t || "[object Object]" !== r.call(t) || t.nodeType || t.setInterval)
                return !1;
            if (t.constructor && !a.call(t, "constructor") && !a.call(t.constructor.prototype, "isPrototypeOf"))
                return !1;
            var e;
            for (e in t)
                ;
            return void 0 === e || a.call(t, e)
        }, u = arguments[0] || {}, h = 1, c = arguments.length, d = !1;
        for ("boolean" == typeof u && (d = u,
        u = arguments[1] || {},
        h = 2),
        "object" == typeof u || function(t) {
            return "[object Function]" === r.call(t)
        }(u) || (u = {}),
        c === h && (u = this,
        --h); h < c; h++)
            if (null !== (t = arguments[h]))
                for (e in t)
                    if (i = u[e],
                    n = t[e],
                    u !== n)
                        if (d && n && (l(n) || o(n))) {
                            var p = i && (l(i) || o(i)) ? i : o(n) ? [] : {};
                            u[e] = s.extend(d, p, n)
                        } else
                            void 0 !== n && (u[e] = n);
        return u
    }
    ,
    s.objectInherit = function(t) {
        function e() {}
        e.prototype = t;
        for (var i = new e, n = 1; n < arguments.length; n++)
            s.objectMix(i, arguments[n], !1);
        return i
    }
    ,
    s.objectMix = function(t, e, i) {
        for (var n in e)
            i && t[n] || (t[n] = e[n]);
        return t
    }
    ,
    s.objectType = {},
    s.objectType.type = 0,
    s.objectType.generate = function(t) {
        var e = s.objectType.type;
        return s.objectType[e] = t,
        s.objectType[t] = e,
        s.objectType.type += 1,
        e
    }
    ,
    s.objectLibraryClass = function(t, e, i) {
        t.className = function() {
            return i
        }
        ,
        t.libraryName = function() {
            return e
        }
        ;
        var n = e + "::" + i;
        return t.libraryClassName = function() {
            return n
        }
        ,
        t
    }
    ,
    s.setTypeID = function(t) {
        var e = t.prototype.libraryClassName()
          , i = s.objectType.generate(e)
          , n = function() {
            return i
        };
        t.typeID = t.prototype.typeID = i,
        t.getTypeID = t.prototype.getTypeID = n
    }
    ,
    s.createPrototypeClass = function(t, e, i, n) {
        t.prototype = e,
        e.constructor = t,
        s.objectLibraryClass(e, i, n),
        s.setTypeID(t)
    }
    ,
    s.Float32Array = "undefined" != typeof Float32Array ? Float32Array : null,
    s.Int32Array = "undefined" != typeof Int32Array ? Int32Array : null,
    s.Uint8Array = "undefined" != typeof Uint8Array ? Uint8Array : null,
    s.Uint16Array = "undefined" != typeof Uint16Array ? Uint16Array : null,
    s.Uint32Array = "undefined" != typeof Uint32Array ? Uint32Array : null;
    var o = {};
    s.time = (a.console.time || function(t) {
        o[t] = r.instance().tick()
    }
    ).bind(a.console),
    s.timeEnd = (a.console.timeEnd || function(t) {
        if (void 0 !== o[t]) {
            var e = r.instance().deltaM(o[t], r.instance().tick());
            a.debug(t + ": " + e + "ms"),
            o[t] = void 0
        }
    }
    ).bind(a.console),
    s.timeStamp = (a.console.timeStamp || a.console.markTimeline || function() {}
    ).bind(a.console),
    s.profile = (a.console.profile || function() {}
    ).bind(a.console),
    s.profileEnd = (a.console.profileEnd || function() {}
    ).bind(a.console),
    t.exports = s
}
, , , , , , function(t, e) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/layouts/popup.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = "";
                try {
                    var s = null;
                    a += '<div class="popup-container',
                    n.contextOrFrameLookup(e, i, "popupNeedsLoading") && (a += " popup-loading"),
                    a += " ",
                    a += n.suppressValue(n.contextOrFrameLookup(e, i, "popupClass"), t.opts.autoescape),
                    a += '">\n\n    <div class="popup-overlay">\n    </div>\n\n    <form class="popup" method="post"',
                    n.contextOrFrameLookup(e, i, "allowAutocomplete") || (a += ' autocomplete="off"'),
                    a += " ",
                    n.contextOrFrameLookup(e, i, "popupAction") && (a += 'action="',
                    a += n.suppressValue(n.contextOrFrameLookup(e, i, "popupAction"), t.opts.autoescape),
                    a += '"'),
                    a += ">\n\n        ",
                    n.contextOrFrameLookup(e, i, "allowAutocomplete") || (a += "\n            ",
                    a += '\n            <input type="text" style="display:none" />\n            <input type="password" style="display:none" />\n        '),
                    a += '\n\n        <input type="hidden" name="csrfmiddlewaretoken" value="',
                    a += n.suppressValue(n.contextOrFrameLookup(e, i, "csrf_token"), t.opts.autoescape),
                    a += '" />\n\n        <header class="popup-header">\n\n            ',
                    (s ? function(t, e, i, n, r) {
                        r("")
                    }
                    : e.getBlock("popup_header"))(t, e, i, n, function(o, l) {
                        if (o)
                            return void r(o);
                        a += l,
                        a += '\n\n            <div class="popup-actions">\n                ',
                        n.contextOrFrameLookup(e, i, "popupClosable") && (a += '\n                    <a class="popup-close" data-action="close">\n                        <i class="fa fa-times"></i>\n                    </a>\n                '),
                        a += '\n            </div>\n\n        </header>\n\n        <div class="popup-content">\n\n            <div class="popup-content-overlay"></div>\n\n            ',
                        (s ? function(t, e, i, n, r) {
                            r("")
                        }
                        : e.getBlock("popup_content"))(t, e, i, n, function(o, l) {
                            if (o)
                                return void r(o);
                            a += l,
                            a += '\n        </div>\n\n        <footer class="popup-footer">\n            ',
                            (s ? function(t, e, i, n, r) {
                                r("")
                            }
                            : e.getBlock("popup_footer"))(t, e, i, n, function(o, l) {
                                if (o)
                                    return void r(o);
                                a += l,
                                a += "\n        </footer>\n\n    </form>\n\n</div>\n",
                                s ? s.rootRenderFunc(t, e, i, n, r) : r(null, a)
                            })
                        })
                    })
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            function e(t, e, i, n, r) {
                var a = "";
                try {
                    var i = i.push(!0);
                    a += '\n                <div class="popup-title">\n                    ',
                    a += n.suppressValue(n.contextOrFrameLookup(e, i, "popupTitle"), t.opts.autoescape),
                    a += "\n                </div>\n            ",
                    r(null, a)
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            function i(t, e, i, n, r) {
                var a = "";
                try {
                    var i = i.push(!0);
                    a += "\n            ",
                    r(null, a)
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            function n(t, e, i, n, r) {
                var a = "";
                try {
                    var i = i.push(!0);
                    a += "\n            ",
                    r(null, a)
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            return {
                b_popup_header: e,
                b_popup_content: i,
                b_popup_footer: n,
                root: t
            }
        }()
    }()
}
, , , , , , , function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(1)
      , s = (i.n(a),
    i(6))
      , o = i(88)
      , l = [];
    e.a = s.a.extend({
        parent: "body",
        events: {
            "click .popup-overlay": "_close",
            'click [data-action="close"]': "_close"
        },
        constructor: function() {
            this.onKeyDown = this.onKeyDown.bind(this),
            this.lazyResize = i.i(a.debounce)(this.center, 50),
            this.resizeHandler = function() {
                r.a.each(l, function(t, e) {
                    e.lazyResize()
                })
            }
            .bind(this),
            s.a.apply(this, arguments)
        },
        initialize: function() {
            if (s.a.prototype.initialize.apply(this, arguments),
            this.options = i.i(a.defaults)(this.options || {}, {
                cleanOnClose: !0
            }),
            r()(this.options.el)[0] !== r()(this.el)[0]) {
                if (!this.template)
                    throw new Error("You cannot use this class without specifying an element during instanciation");
                this.setElement(i.i(a.result)(this, "template"))
            }
        },
        delegateEvents: function() {
            s.a.prototype.delegateEvents.apply(this, arguments),
            r()(window).on("resize", this.resizeHandler),
            document.addEventListener("keydown", this.onKeyDown, !0)
        },
        undelegateEvents: function() {
            s.a.prototype.undelegateEvents.apply(this, arguments),
            r()(window).off("resize", this.resizeHandler),
            document.removeEventListener("keydown", this.onKeyDown, !0)
        },
        open: function(t) {
            return -1 !== l.indexOf(this) ? (this.show(),
            this.setElement(this.$el),
            this) : (l.unshift(this),
            r()(i.i(a.result)(this, "parent")).append(this.$el),
            this.setElement(this.$el),
            t ? this : (this.hide(),
            this.center(),
            window.requestAnimationFrame(function() {
                this.show()
            }
            .bind(this)),
            this.autofocus(),
            this.center(),
            this))
        },
        show: function() {
            this.$el.removeClass("hidden")
        },
        hide: function() {
            this.$el.addClass("hidden")
        },
        isHidden: function() {
            return this.$el.hasClass("hidden")
        },
        onKeyDown: function(t) {
            27 === t.keyCode && 0 !== l.length && (l[0].close(),
            t.stopImmediatePropagation(),
            t.stopPropagation())
        },
        _close: function(t, e) {
            return -1 === l.indexOf(this) ? this : this.$el.closest(".inline-popup").length > 0 ? this : ((this.options.cleanOnClose || e) && (i.i(o.a)(this.$el, this.remove.bind(this)),
            -1 !== l.indexOf(this) && l.splice(l.indexOf(this), 1)),
            this.hide(),
            this)
        },
        close: function(t) {
            return this._close(null, t)
        },
        replaceWith: function(t) {
            return this.close(),
            t.open(),
            t
        },
        center: function() {
            var t = this.$(".popup")
              , e = this.$(".popup-overlay")
              , i = r()(window).width()
              , n = r()(window).height()
              , a = r()(document).height()
              , s = t.width()
              , o = t.height()
              , l = r()(document).scrollTop()
              , u = n / 2 - o / 2 + l
              , h = i / 2 - s / 2;
            o > n && (u += (o - n) / 2),
            e.width(i),
            e.height(a),
            t.css({
                left: h,
                top: u
            });
            var c = h + s / 2 + "px"
              , d = u + o / 2 + "px"
              , p = c + " " + d;
            document.getElementsByClassName("popup-container")[0].style.perspectiveOrigin = p
        },
        resize: function(t) {
            var e = this.$(".popup");
            return t.width && e.width(t.width),
            t.height && e.height(t.height),
            this
        },
        autofocus: function() {
            var t = window.scrollX
              , e = window.scrollY;
            this.$el.find(".form-input:visible").length > 0 ? (this.$el.find(".form-input").eq(0).focus(),
            window.scrollTo(t, e)) : (this.$el.find(".btn-primary, .submit").focus(),
            window.scrollTo(t, e))
        },
        remove: function() {
            return this.undelegateEvents(),
            s.a.prototype.remove.apply(this, arguments)
        }
    })
}
, function(t, e, i) {
    "use strict";
    Object.defineProperty(e, "__esModule", {
        value: !0
    });
    var n = i(2)
      , r = i.n(n)
      , a = i(9)
      , s = i(26)
      , o = i(130);
    i.n(o);
    e.default = s.a.extend({
        template: function() {
            return a.default.get("skfb_front/popups/message", {
                title: this.options.title,
                text: this.options.text,
                buttons: this.options.buttons,
                safe: this.options.safe,
                popupClass: this.options.popupClass,
                popupClosable: this.options.popupClosable
            })
        },
        events: {
            "reset form": "cancel",
            "submit form": "continue"
        },
        initialize: function() {
            s.a.prototype.initialize.apply(this, arguments),
            this.deferred = r.a.Deferred(),
            this.promise = this.deferred.promise()
        },
        continue: function() {
            this.deferred.resolve()
        },
        cancel: function() {
            this.deferred.reject()
        },
        then: function() {
            return this.promise.then.apply(this, arguments)
        }
    })
}
, function(t, e, i) {
    "use strict";
    function n(t, e) {
        l.console && (l.console[t](e),
        l.traceLogCall && "error" !== t && console.trace())
    }
    function r(t, e, i) {
        l.console && (l.console.groupCollapsed && l.console.groupCollapsed(e),
        l.console[t](i),
        l.traceLogCall && "error" !== t && console.trace(),
        l.console.groupEnd && l.console.groupEnd())
    }
    function a(t, e) {
        return e ? [t.slice(0, 4), t.slice(4, 8), t.slice(8, 12), t.slice(12, 16)] : [[t[0], t[4], t[8], t[12]], [t[1], t[5], t[9], t[13]], [t[2], t[6], t[10], t[14]], [t[3], t[7], t[11], t[15]]]
    }
    function s(t, e) {
        l.console.table && n("table", a(t, e))
    }
    function o(t, e, i) {
        l.console.table && r("table", t, a(e, i))
    }
    var l = {};
    l.DEBUG = 0,
    l.INFO = 1,
    l.NOTICE = l.LOG = 2,
    l.WARN = 3,
    l.ERROR = 4,
    l.console = window.console;
    for (var u = ["log", "info", "warn", "error", "debug"], h = {}, c = 0; c < u.length; ++c) {
        var d = u[c];
        h[d] = n.bind(l, d),
        h[d + "Fold"] = r.bind(l, d),
        h[d + "Matrix"] = s.bind(l),
        h[d + "MatrixFold"] = o.bind(l)
    }
    var p = function(t, e) {
        void 0 === this.console || t || this.console.assert(t, e)
    };
    l.assert = p,
    l.setNotifyLevel = function(t) {
        for (var e = function() {}, i = 0; i < u.length; ++i) {
            var n = u[i]
              , r = t > l[n.toUpperCase()];
            l[n] = r ? e : h[n],
            l[n + "Fold"] = r ? e : h[n + "Fold"],
            l[n + "Matrix"] = r ? e : h[n + "Matrix"],
            l[n + "MatrixFold"] = r ? e : h[n + "MatrixFold"]
        }
        l.notice = l.log,
        l.noticeFold = l.logFold,
        l.noticeMatrix = l.logMatrix,
        l.noticeMatrixFold = l.logMatrixFold
    }
    ,
    l.setNotifyLevel(l.NOTICE),
    l.reportWebGLError = !1,
    l.setConsole = function(t) {
        l.console = t
    }
    ,
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n, r = i(1), a = (i.n(r),
    i(1094)), s = i.n(a), o = i(21), l = i(680), u = i(90), h = i(293), c = i(11), d = function(t) {
        if (null !== t && void 0 !== t)
            return "+Infinity" === t || "Infinity" === t ? 1 / 0 : "-Infinity" === t ? -1 / 0 : t
    }, p = function() {
        if (n)
            return n;
        n = {};
        for (var t in s.a) {
            var e = s.a[t]
              , a = d(e.defaultValue);
            n[i.i(r.camelCase)(t)] = o.a[e.type](t, a)
        }
        try {
            c.a.me().get("isStaff") && void 0 === n.webgl2 && (n.webgl2 = !0)
        } catch (t) {
            console.warn("Prefetching failure while trying to reach User.me(). This is probably because this code has been run in a non web context where prefetchdata are unusable.")
        }
        n.annotationCycleAutostart = void 0 !== n.annotationCycle,
        n.annotationCycleDuration = void 0 === n.annotationCycle ? 5e3 : 1e3 * n.annotationCycle,
        delete n.annotationCycle,
        (n.cardboard || n.annotation) && (n.camera = !1),
        n.stats && (n.continuousRender = !0),
        n.processOptions && i.i(h.a)(!0),
        n.processOptions && (n.processMaterial = !0);
        var p = !i.i(h.a)() && !i.i(u.a)() && "1.0.0" !== n.apiVersion && !n.materialShowcase;
        return void 0 === n.mergeMaterials && (n.mergeMaterials = p),
        void 0 === n.graphOptimizer && (n.graphOptimizer = p),
        void 0 === n.materialPacking && (n.materialPacking = "1.0.0" !== n.apiVersion && !n.materialShowcase),
        i.i(l.a)(n),
        n
    };
    e.a = p
}
, , , , , , , , , function(t, e, i) {
    "use strict";
    e.a = function(t) {
        var e = Array.prototype.slice.call(arguments, 1)
          , i = t.bind.apply(t, e);
        return i(),
        i
    }
}
, function(t, e, i) {
    i(49),
    i(50),
    i(64),
    function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/model.jinja"] = function() {
            function t(t, e, n, r, a) {
                var s = null
                  , o = null
                  , l = "";
                try {
                    var u = null;
                    t.getTemplate("skfb_front/macros/buttons.jinja", !1, "skfb_front/macros/model.jinja", !1, function(h, c) {
                        if (h)
                            return void a(h);
                        c.getExported(function(h, c) {
                            if (h)
                                return void a(h);
                            if (!c.hasOwnProperty("star_like_button"))
                                return void a(new Error("cannot import 'star_like_button'"));
                            var d = c.star_like_button;
                            e.setVariable("star_like_button", d),
                            l += "\n",
                            t.getTemplate("skfb_front/macros/user.jinja", !1, "skfb_front/macros/model.jinja", !1, function(h, c) {
                                if (h)
                                    return void a(h);
                                c.getExported(function(h, c) {
                                    if (h)
                                        return void a(h);
                                    if (!c.hasOwnProperty("user_name"))
                                        return void a(new Error("cannot import 'user_name'"));
                                    var d = c.user_name;
                                    e.setVariable("user_name", d),
                                    l += "\n",
                                    t.getTemplate("skfb_front/macros/utils.jinja", !1, "skfb_front/macros/model.jinja", !1, function(h, c) {
                                        if (h)
                                            return void a(h);
                                        c.getExported(function(h, c) {
                                            if (h)
                                                return void a(h);
                                            if (!c.hasOwnProperty("humanize_count"))
                                                return void a(new Error("cannot import 'humanize_count'"));
                                            var d = c.humanize_count;
                                            e.setVariable("humanize_count", d),
                                            l += "\n\n\n";
                                            var p = r.makeMacro(["authUser", "model"], ["options"], function(a, s, o) {
                                                var l = n;
                                                n = new r.Frame,
                                                o = o || {},
                                                o.hasOwnProperty("caller") && n.set("caller", o.caller),
                                                n.set("authUser", a),
                                                n.set("model", s),
                                                n.set("options", o.hasOwnProperty("options") ? o.options : {});
                                                var u = "";
                                                u += "\n\n    ";
                                                var h;
                                                return h = t.getFilter("merge").call(e, {
                                                    clickable: !0,
                                                    withStaffpickFlag: !0,
                                                    withStaffpickLink: !1,
                                                    withRestrictedFlag: !0
                                                }, r.contextOrFrameLookup(e, n, "options")),
                                                n.set("options", h, !0),
                                                n.topLevel && e.setVariable("options", h),
                                                n.topLevel && e.addExport("options", h),
                                                u += '\n\n    <span class="model-name">\n\n        ',
                                                r.memberLookup(s, "isProtected") ? u += '\n            <i class="fa fa-lock protected"></i>\n        ' : r.memberLookup(s, "isPrivate") && (u += '\n            <i class="fa fa-lock private"></i>\n        '),
                                                u += "\n\n        ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "clickable") ? (u += '\n            <a class="label" href="',
                                                u += r.suppressValue(r.memberLookup(s, "viewerUrl"), t.opts.autoescape),
                                                u += '"',
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "target") && (u += ' target="',
                                                u += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "target"), t.opts.autoescape),
                                                u += '"'),
                                                u += ' title="',
                                                u += r.suppressValue(r.memberLookup(s, "name"), t.opts.autoescape),
                                                u += '">',
                                                u += r.suppressValue(r.memberLookup(s, "name"), t.opts.autoescape),
                                                u += "</a>\n        ") : (u += '\n            <span class="label">',
                                                u += r.suppressValue(r.memberLookup(s, "name"), t.opts.autoescape),
                                                u += "</span>\n        "),
                                                u += "\n\n        ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withStaffpickLink") && r.memberLookup(s, "staffpickedAt") ? u += '\n            <meta itemprop="award" content="Staff Pick" />\n            <a href="/models/staffpicks" class="flag-staffpicked" title="See all staff picks"></a>\n        ' : r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withStaffpickFlag") && r.memberLookup(s, "staffpickedAt") && (u += '\n            <meta itemprop="award" content="Staff Pick" />\n            <span class="flag-staffpicked" title="Staff Picks"></span>\n        '),
                                                u += "\n\n        ",
                                                u += "\n        ",
                                                (r.memberLookup(s, "isRestricted") || r.memberLookup(s, "isAdult")) && (u += "\n            ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withRestrictedFlag") && (u += '\n                <a href="https://help.sketchfab.com/hc/en-us/articles/214867883-Age-Restricted-Content" class="flag-restricted" title="Age-restricted content">\n                    <img src="',
                                                u += r.suppressValue(i(150), t.opts.autoescape),
                                                u += '" width="38" height="18" alt="age_+" class="age-restricted-logo">\n                </a>\n            '),
                                                u += "\n        "),
                                                u += "\n\n    </span>\n\n",
                                                n = l,
                                                new r.SafeString(u)
                                            });
                                            e.addExport("model_name"),
                                            e.setVariable("model_name", p),
                                            l += "\n\n";
                                            var f = r.makeMacro(["authUser", "model"], ["options"], function(i, a, s) {
                                                var o = n;
                                                n = new r.Frame,
                                                s = s || {},
                                                s.hasOwnProperty("caller") && n.set("caller", s.caller),
                                                n.set("authUser", i),
                                                n.set("model", a),
                                                n.set("options", s.hasOwnProperty("options") ? s.options : {});
                                                var l = "";
                                                l += "\n\n    ";
                                                var u;
                                                return u = t.getFilter("merge").call(e, {
                                                    withPublish: !0,
                                                    with3DSettings: !0
                                                }, r.contextOrFrameLookup(e, n, "options")),
                                                n.set("options", u, !0),
                                                n.topLevel && e.setVariable("options", u),
                                                n.topLevel && e.addExport("options", u),
                                                l += '\n\n    <ul class="hover-menu quicksettings corner',
                                                "up" == r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "direction") && (l += " hover-menu-up"),
                                                "left" == r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "direction") && (l += " hover-menu-left"),
                                                l += '">\n\n        ',
                                                2 == r.memberLookup(a, "processingStatus") && (l += "\n            ",
                                                !r.memberLookup(a, "publishedAt") && r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withPublish") && (l += '\n                <li><a data-action="publish">Publish</a></li>\n                <li class="separator"></li>\n            '),
                                                l += '\n\n            <li><a data-action="open-settings-popup">Properties</a></li>\n\n            ',
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "with3DSettings") && (l += '\n            <li><a href="',
                                                l += r.suppressValue(r.memberLookup(a, "editorUrl"), t.opts.autoescape),
                                                l += '" data-action="settings3d-button">3D settings</a></li>\n            '),
                                                l += "\n\n            ",
                                                r.memberLookup(a, "publishedAt") && (l += '\n                <li><a data-action="open-collection-popup">Add to collection</a></li>\n            '),
                                                l += '\n\n            <li class="separator"></li>\n\n        '),
                                                l += "\n\n        ",
                                                r.memberLookup(a, "processingStatus") > 1 && (l += '\n            <li><a data-action="open-reupload-popup">Re-upload</a></li>\n            <li><a data-action="delete-model">Delete</a></li>\n        '),
                                                l += '\n        <li><a data-action="report-issue">Report an issue</a></li>\n\n    </ul>\n\n',
                                                n = o,
                                                new r.SafeString(l)
                                            });
                                            e.addExport("model_quicksettings"),
                                            e.setVariable("model_quicksettings", f),
                                            l += "\n\n";
                                            var g = r.makeMacro(["authUser", "model"], ["options"], function(t, i, a) {
                                                var s = n;
                                                n = new r.Frame,
                                                a = a || {},
                                                a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                n.set("authUser", t),
                                                n.set("model", i),
                                                n.set("options", a.hasOwnProperty("options") ? a.options : {});
                                                var o = "";
                                                return o += '\n\n    <ul class="hover-menu quicksettings corner',
                                                "up" == r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "direction") && (o += " hover-menu-up"),
                                                "left" == r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "direction") && (o += " hover-menu-left"),
                                                o += '">\n        <li><a data-action="remove-model">Remove</a></li>\n    </ul>\n\n',
                                                n = s,
                                                new r.SafeString(o)
                                            });
                                            e.addExport("collection_quicksettings"),
                                            e.setVariable("collection_quicksettings", g),
                                            l += "\n\n";
                                            var m = r.makeMacro([], [], function(t) {
                                                var e = n;
                                                n = new r.Frame,
                                                t = t || {},
                                                t.hasOwnProperty("caller") && n.set("caller", t.caller);
                                                var i = "";
                                                return i += '\n\n    <a class="model-card-preview" data-action="open-preview">\n        <i class="fa fa-search"></i>\n    </a>\n\n',
                                                n = e,
                                                new r.SafeString(i)
                                            });
                                            e.addExport("preview_link"),
                                            e.setVariable("preview_link", m),
                                            l += "\n\n";
                                            var v = r.makeMacro(["authUser", "model"], ["options"], function(i, a, l) {
                                                var u = n;
                                                n = new r.Frame,
                                                l = l || {},
                                                l.hasOwnProperty("caller") && n.set("caller", l.caller),
                                                n.set("authUser", i),
                                                n.set("model", a),
                                                n.set("options", l.hasOwnProperty("options") ? l.options : {});
                                                var h = "";
                                                h += "\n\n    ";
                                                var c;
                                                return c = t.getFilter("merge").call(e, {
                                                    withAvatars: !0,
                                                    withUser: !0,
                                                    withDate: !1,
                                                    withQuickSettings: !1,
                                                    withStaffpickFlag: !0,
                                                    withStaffpickLink: !1,
                                                    deferImages: !1
                                                }, r.contextOrFrameLookup(e, n, "options")),
                                                n.set("options", c, !0),
                                                n.topLevel && e.setVariable("options", c),
                                                n.topLevel && e.addExport("options", c),
                                                h += "\n\n    ",
                                                h += "\n\n    ",
                                                a = t.getFilter("merge").call(e, {
                                                    user: r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "user")
                                                }, a),
                                                n.set("model", a, !0),
                                                n.topLevel && e.setVariable("model", a),
                                                n.topLevel && e.addExport("model", a),
                                                h += "\n\n    ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "wrapMetaType") && (h += '\n\n    <data itemscope itemtype="http://schema.org/BlogPosting">\n\n    <meta itemprop="headline" content="',
                                                h += r.suppressValue(r.memberLookup(a, "name"), t.opts.autoescape),
                                                h += '" />\n    <meta itemprop="image" content="',
                                                h += r.suppressValue(t.getFilter("best_fit").call(e, r.memberLookup(a, "thumbnails"), 1024, 768), t.opts.autoescape),
                                                h += '" />\n    <meta itemprop="datepublished" content="',
                                                h += r.suppressValue(r.memberLookup(a, "publishedAt"), t.opts.autoescape),
                                                h += '" />\n    <meta itemprop="description" content="',
                                                h += r.suppressValue(r.memberLookup(a, "description"), t.opts.autoescape),
                                                h += '" />\n\n    '),
                                                h += '\n\n    <div class="model-card" itemprop="',
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "wrapMetaType") ? h += " associatedMedia " : h += " owns ",
                                                h += '" itemscope itemtype="http://schema.org/MediaObject">\n\n        <meta itemprop="commentCount" content="',
                                                h += r.suppressValue(r.memberLookup(a, "commentCount"), t.opts.autoescape),
                                                h += '" />\n        <meta itemprop="contentSize" content="',
                                                h += r.suppressValue(t.getFilter("humanize_number").call(e, t.getFilter("default").call(e, r.memberLookup(a, "archiveSize"), 0)), t.opts.autoescape),
                                                h += 'B" />\n        <meta itemprop="isBasedOnUrl" content="',
                                                h += r.suppressValue(r.memberLookup(a, "viewerUrl"), t.opts.autoescape),
                                                h += '/editor" />\n        <meta itemprop="embedUrl" content="',
                                                h += r.suppressValue(r.memberLookup(a, "embedUrl"), t.opts.autoescape),
                                                h += '" />\n        <meta itemprop="name" content="',
                                                h += r.suppressValue(r.memberLookup(a, "name"), t.opts.autoescape),
                                                h += '" />\n\n        <div class="model-card-thumbnail">\n\n            ',
                                                h += r.suppressValue(t.getFilter("image_container").call(e, r.memberLookup(a, "thumbnails"), 500, 313, !0, !1, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "deferImages"), r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "initialLoading")), t.opts.autoescape),
                                                h += '\n            <div class="model-card-overlay"></div>\n\n            <a class="model-card-filter" href="',
                                                h += r.suppressValue(r.memberLookup(a, "viewerUrl"), t.opts.autoescape),
                                                h += '"></a>\n\n            ',
                                                3 != r.memberLookup(a, "processingStatus") && (h += "\n                ",
                                                h += r.suppressValue((s = 134,
                                                o = 29,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "preview_link"), "preview_link", e, [])), t.opts.autoescape),
                                                h += "\n            "),
                                                h += "\n\n            ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withQuickSettings") && (h += "\n                ",
                                                r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withQuickSettings"), "collectionItem") ? (h += '\n                    <div class="model-card-settings" data-action>\n                        <i class="fa fa-cog"></i>\n                        ',
                                                h += r.suppressValue((s = 141,
                                                o = 49,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "collection_quicksettings"), "collection_quicksettings", e, [i, a])), t.opts.autoescape),
                                                h += "\n                    </div>\n                ") : (h += "\n                    ",
                                                r.memberLookup(i, "uid") == r.memberLookup(r.memberLookup(a, "user"), "uid") && (h += "\n                        ",
                                                h += '\n                        <div class="model-card-settings" data-action>\n                            <i class="fa fa-cog"></i>\n                            ',
                                                h += r.suppressValue((s = 148,
                                                o = 48,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "model_quicksettings"), "model_quicksettings", e, [i, a])), t.opts.autoescape),
                                                h += "\n                        </div>\n                    "),
                                                h += "\n                "),
                                                h += "\n            "),
                                                h += "\n\n            ",
                                                r.memberLookup(a, "publishedAt") && (h += '\n            <div class="model-card-information">\n                <div class="model-card-left-extra">\n                    <div class="model-card-stats">\n                        <span class="model-card-views">',
                                                h += r.suppressValue(t.getFilter("humanize_number").call(e, r.memberLookup(a, "viewCount")), t.opts.autoescape),
                                                h += "</span>\n                    </div>\n\n                    ",
                                                h += r.suppressValue((s = 161,
                                                o = 37,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "star_like_button"), "star_like_button", e, [i, r.makeKeywordArgs({
                                                    options: {
                                                        count: {
                                                            display: !0,
                                                            like: (s = 164,
                                                            o = 50,
                                                            r.callWrap(r.contextOrFrameLookup(e, n, "humanize_count"), "humanize_count", e, [r.memberLookup(a, "likeCount")]))
                                                        },
                                                        popover: {
                                                            display: !0,
                                                            arrow: "down-arrow middle-arrow"
                                                        },
                                                        buttonClass: "model-card-like-button model-card-stats",
                                                        tooltipClass: "tooltip-up"
                                                    }
                                                })])), t.opts.autoescape),
                                                h += '\n                </div>\n\n                <div class="model-card-right-extra">\n\n                    ',
                                                r.memberLookup(a, "animationCount") > 0 && (h += '\n                        <div class="model-card-stats animation-stat">\n                            <span title="Model has ',
                                                h += r.suppressValue(r.memberLookup(a, "animationCount"), t.opts.autoescape),
                                                h += " animation",
                                                h += r.suppressValue(t.getFilter("pluralize").call(e, r.memberLookup(a, "animationCount")), t.opts.autoescape),
                                                h += '" class="model-card-animations">',
                                                h += r.suppressValue(r.memberLookup(a, "animationCount"), t.opts.autoescape),
                                                h += "</span>\n                        </div>\n                    "),
                                                h += "\n\n                    ",
                                                r.memberLookup(a, "isDownloadable") && r.memberLookup(a, "downloadCount") > 0 && (h += '\n                        <div class="model-card-stats download-start">\n                            <span class="model-card-downloads">',
                                                h += r.suppressValue(t.getFilter("humanize_number").call(e, r.memberLookup(a, "downloadCount")), t.opts.autoescape),
                                                h += "</span>\n                        </div>\n                    "),
                                                h += "\n\n                    ",
                                                r.memberLookup(a, "commentCount") > 0 && (h += '\n                        <div class="model-card-stats comments-stat">\n                            <a class="model-card-comments" itemprop="discussionUrl" href="',
                                                h += r.suppressValue(r.memberLookup(a, "viewerUrl"), t.opts.autoescape),
                                                h += '#comments" data-action="goto-comments">',
                                                h += r.suppressValue(t.getFilter("humanize_number").call(e, r.memberLookup(a, "commentCount")), t.opts.autoescape),
                                                h += "</a>\n                        </div>\n                    "),
                                                h += "\n                </div>\n            </div>\n            "),
                                                h += '\n\n        </div>\n\n        <div class="model-card-meta',
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withUser") && (h += " model-card-with-user"),
                                                h += '">\n\n            <div class="model-card-name">\n                ',
                                                h += r.suppressValue((s = 203,
                                                o = 27,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "model_name"), "model_name", e, [i, a, {
                                                    withStaffpickFlag: r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withStaffpickFlag"),
                                                    withStaffpickLink: r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withStaffpickLink")
                                                }])), t.opts.autoescape),
                                                h += '\n            </div>\n\n            <div class="model-card-extra">\n\n                ',
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withUser") && (h += '\n                    <div class="model-card-user" itemscope itemtype="http://schema.org/Person" itemprop="author">\n                        ',
                                                h += r.suppressValue((s = 213,
                                                o = 34,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "user_name"), "user_name", e, [i, r.memberLookup(a, "user"), {
                                                    withAvatar: r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withAvatars"),
                                                    avatarWidth: 34,
                                                    by: !0,
                                                    withSummary: !0
                                                }])), t.opts.autoescape),
                                                h += "\n                    </div>\n                "),
                                                h += "\n\n                ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withDate") && (h += "\n                    ",
                                                r.memberLookup(a, "publishedAt") ? (h += '\n                        <div class="model-card-date">\n                            ',
                                                h += r.suppressValue(t.getFilter("time_ago").call(e, r.memberLookup(a, "publishedAt")), t.opts.autoescape),
                                                h += "\n                        </div>\n                    ") : (h += "\n                        <div>\n                            ",
                                                0 == r.memberLookup(a, "processingStatus") ? h += '\n                                <span class="flag-draft">Pending</span>\n                            ' : 1 == r.memberLookup(a, "processingStatus") ? h += '\n                                <span class="flag-draft">Processing</span>\n                            ' : 2 == r.memberLookup(a, "processingStatus") ? h += '\n                                <span class="flag-draft">Draft</span>\n                            ' : h += '\n                                <span class="flag-error">Error</span>\n                            ',
                                                h += "\n                        </div>\n                    "),
                                                h += "\n                "),
                                                h += "\n\n            </div>\n\n        </div>\n\n    </div>\n\n\n    ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "wrapMetaType") && (h += "\n    </data>\n    "),
                                                h += "\n\n",
                                                n = u,
                                                new r.SafeString(h)
                                            });
                                            e.addExport("model_card"),
                                            e.setVariable("model_card", v),
                                            l += "\n\n";
                                            var _ = r.makeMacro(["authUser", "model"], ["options"], function(i, a, l) {
                                                var u = n;
                                                n = new r.Frame,
                                                l = l || {},
                                                l.hasOwnProperty("caller") && n.set("caller", l.caller),
                                                n.set("authUser", i),
                                                n.set("model", a),
                                                n.set("options", l.hasOwnProperty("options") ? l.options : {});
                                                var h = "";
                                                return h += '\n\n    <meta itemprop="commentCount" content="',
                                                h += r.suppressValue(r.memberLookup(a, "commentCount"), t.opts.autoescape),
                                                h += '" />\n    <meta itemprop="contentSize" content="',
                                                h += r.suppressValue(t.getFilter("humanize_number").call(e, t.getFilter("default").call(e, r.memberLookup(a, "archiveSize"), 0)), t.opts.autoescape),
                                                h += 'B" />\n    <meta itemprop="discussionUrl" content="',
                                                h += r.suppressValue(r.memberLookup(a, "viewerUrl"), t.opts.autoescape),
                                                h += '#comments" />\n    <meta itemprop="isBasedOnUrl" content="',
                                                h += r.suppressValue(r.memberLookup(a, "viewerUrl"), t.opts.autoescape),
                                                h += '/editor" />\n\n    <div class="model-smallcard" data-link="',
                                                h += r.suppressValue(r.memberLookup(a, "viewerUrl"), t.opts.autoescape),
                                                h += '">\n\n        <a class="thumbnail" itemprop="url" href="',
                                                h += r.suppressValue(r.memberLookup(a, "viewerUrl"), t.opts.autoescape),
                                                h += '">\n            ',
                                                h += r.suppressValue(t.getFilter("image_container").call(e, r.memberLookup(a, "thumbnails"), 125, 80), t.opts.autoescape),
                                                h += '\n        </a>\n\n        <div class="meta">\n            <div class="name" itemprop="name">\n                ',
                                                h += r.suppressValue((s = 265,
                                                o = 27,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "model_name"), "model_name", e, [i, a])), t.opts.autoescape),
                                                h += '\n            </div>\n\n            <div class="stats">\n                ',
                                                r.memberLookup(a, "commentCount") > 0 && (h += '\n                    <a class="model-card-comments" href="',
                                                h += r.suppressValue(r.memberLookup(a, "viewerUrl"), t.opts.autoescape),
                                                h += '#comments">\n                        ',
                                                h += r.suppressValue(t.getFilter("humanize_number").call(e, r.memberLookup(a, "commentCount")), t.opts.autoescape),
                                                h += "\n                    </a>\n                "),
                                                h += '\n                <div class="views">\n                    ',
                                                h += r.suppressValue(t.getFilter("humanize_number").call(e, r.memberLookup(a, "viewCount")), t.opts.autoescape),
                                                h += "\n                </div>\n\n                ",
                                                h += r.suppressValue((s = 278,
                                                o = 33,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "star_like_button"), "star_like_button", e, [i, r.makeKeywordArgs({
                                                    options: {
                                                        count: {
                                                            display: !0,
                                                            like: (s = 281,
                                                            o = 46,
                                                            r.callWrap(r.contextOrFrameLookup(e, n, "humanize_count"), "humanize_count", e, [r.memberLookup(a, "likeCount")]))
                                                        },
                                                        popover: {
                                                            display: !0,
                                                            arrow: "down-arrow middle-arrow"
                                                        },
                                                        buttonClass: "model-card-like-button model-subscribe",
                                                        tooltipClass: "tooltip-up"
                                                    }
                                                })])), t.opts.autoescape),
                                                h += "\n\n            </div>\n        </div>\n\n    </div>\n\n",
                                                n = u,
                                                new r.SafeString(h)
                                            });
                                            e.addExport("model_smallcard"),
                                            e.setVariable("model_smallcard", _),
                                            l += "\n\n\n";
                                            var b = r.makeMacro(["authUser", "model"], ["options"], function(i, a, l) {
                                                var u = n;
                                                n = new r.Frame,
                                                l = l || {},
                                                l.hasOwnProperty("caller") && n.set("caller", l.caller),
                                                n.set("authUser", i),
                                                n.set("model", a),
                                                n.set("options", l.hasOwnProperty("options") ? l.options : {});
                                                var h = "";
                                                return h += '\n\n    <div class="model-uploadcard">\n\n        <h3 class="filename">\n            <a href="',
                                                h += r.suppressValue(r.memberLookup(a, "viewerUrl"), t.opts.autoescape),
                                                h += '">',
                                                r.memberLookup(a, "name") ? h += r.suppressValue((s = 307,
                                                o = 31,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "model_name"), "model_name", e, [i, a, {
                                                    withStaffpickFlag: !1
                                                }])), t.opts.autoescape) : h += r.suppressValue(t.getFilter("default").call(e, r.memberLookup(a, "originalFileName"), "No file name"), t.opts.autoescape),
                                                h += '</a>\n        </h3>\n        <div class="meta">',
                                                r.memberLookup(a, "name") && (h += '<span class="original-filename">\n                    ',
                                                h += r.suppressValue(t.getFilter("default").call(e, r.memberLookup(a, "originalFileName"), "No file name"), t.opts.autoescape),
                                                h += "\n                </span>"),
                                                r.memberLookup(a, "processedAt") ? (h += '\n                <span class="date" title="',
                                                h += r.suppressValue(r.memberLookup(a, "processedAt"), t.opts.autoescape),
                                                h += '">',
                                                h += r.suppressValue(t.getFilter("time_ago").call(e, r.memberLookup(a, "processedAt")), t.opts.autoescape),
                                                h += "</span>\n            ") : (h += '\n                <span class="date" title="',
                                                h += r.suppressValue(r.memberLookup(a, "createdAt"), t.opts.autoescape),
                                                h += '">',
                                                h += r.suppressValue(t.getFilter("time_ago").call(e, r.memberLookup(a, "createdAt")), t.opts.autoescape),
                                                h += "</span>\n            "),
                                                h += '\n        </div>\n\n        <div class="status">',
                                                0 == r.memberLookup(a, "processingStatus") ? h += '<div class="help">\n                    <i class="icon spinner-small-slow"></i>\n                    <div class="tooltip tooltip-down">Pending</div>\n                </div>' : 1 == r.memberLookup(a, "processingStatus") ? h += '<div class="help">\n                    <i class="icon spinner-small"></i>\n                    <div class="tooltip tooltip-down">Processing</div>\n                </div>' : 2 == r.memberLookup(a, "processingStatus") ? r.memberLookup(a, "isPublished") ? h += '<div class="help">\n                        <i class="icon fa fa-check"></i>\n                        <div class="tooltip tooltip-down">Published</div>\n                    </div>' : (h += '<button type="button" class="button btn-important btn-medium" data-action="publish">\n                        Publish\n                    </button>\n\n                    <a href="/models/',
                                                h += r.suppressValue(r.memberLookup(a, "uid"), t.opts.autoescape),
                                                h += '/edit" class="button btn-tertiary btn-medium btn-edit" data-action="edit">\n                        3D Settings\n                    </a>') : 3 == r.memberLookup(a, "processingStatus") && (h += '<div class="help">\n                    <i class="icon fa fa-times"></i>\n                    <div class="tooltip tooltip-down">Error</div>\n                </div>'),
                                                h += '</div>\n\n        <div class="model-uploadcard-settings">\n            <div class="button btn-medium btn-tertiary"',
                                                r.memberLookup(a, "processingStatus") < 2 && (h += " disabled"),
                                                h += '>\n                <i class="fa fa-cog"></i>\n                ',
                                                h += r.suppressValue((s = 375,
                                                o = 36,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "model_quicksettings"), "model_quicksettings", e, [i, a, {
                                                    direction: "left",
                                                    withPublish: !1
                                                }])), t.opts.autoescape),
                                                h += "\n            </div>\n        </div>\n\n    </div>\n\n",
                                                n = u,
                                                new r.SafeString(h)
                                            });
                                            e.addExport("model_uploadcard"),
                                            e.setVariable("model_uploadcard", b),
                                            l += "\n\n\n";
                                            var x = r.makeMacro(["authUser"], ["options"], function(i, a) {
                                                var s = n;
                                                n = new r.Frame,
                                                a = a || {},
                                                a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                n.set("authUser", i),
                                                n.set("options", a.hasOwnProperty("options") ? a.options : {});
                                                var o = "";
                                                return o += '\n\n    <div class="annotation" data-hotspot="',
                                                o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "hotspotIndex"), t.opts.autoescape),
                                                o += '">\n\n        <div class="tooltip">\n\n            ',
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "editMode") ? o += '\n                <form class="tooltip-content padded">\n                    <div class="edition">\n                            <input class="title" placeholder="Title *" maxlength="64" required>\n                            <textarea class="description" placeholder="Description" maxlength="1024" rows="2"></textarea>\n                    </div>\n                    <div class="render tooltip-content padded">\n                        <div class="title"></div>\n                        <div class="description markdown-rendered-content inversed"></div>\n                    </div>\n                    <div class="meta">\n                        <button type="submit" class="submit button btn-small">OK</button>\n                        <i class="fa fa-eye activate-render"></i>\n                        <i class="fa fa-pencil activate-edition selected"></i>\n                    </div>\n                </form>\n            ' : o += '\n\n                <div class="tooltip-content">\n                    <div class="tooltip-content-minimal">\n                        <div class="title"></div>\n                        <a href="#" class="more">+ more info</a>\n                    </div>\n                    <div class="title"></div>\n                    <div class="description markdown-rendered-content inversed"></div>\n                </div>\n\n            ',
                                                o += "\n\n        </div>\n\n    </div>\n\n",
                                                n = s,
                                                new r.SafeString(o)
                                            });
                                            e.addExport("model_hotspot"),
                                            e.setVariable("model_hotspot", x),
                                            l += "\n\n\n";
                                            var y = r.makeMacro([], ["options"], function(i) {
                                                var a = n;
                                                n = new r.Frame,
                                                i = i || {},
                                                i.hasOwnProperty("caller") && n.set("caller", i.caller),
                                                n.set("options", i.hasOwnProperty("options") ? i.options : {});
                                                var l = "";
                                                l += "\n\n";
                                                var u;
                                                u = 30,
                                                n.set("width_before", u, !0),
                                                n.topLevel && e.setVariable("width_before", u),
                                                n.topLevel && e.addExport("width_before", u),
                                                l += "\n";
                                                var h;
                                                h = 960,
                                                n.set("width_next", h, !0),
                                                n.topLevel && e.setVariable("width_next", h),
                                                n.topLevel && e.addExport("width_next", h),
                                                l += '\n\n<div class="annotation vr visible" data-hotspot="',
                                                l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "hotspotIndex"), t.opts.autoescape),
                                                l += '" style="width:',
                                                l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "widthContent"), t.opts.autoescape),
                                                l += 'px;height:576px;position:absolute;top:30px;left:30px;">\n\n    <div class="tooltip visible" style="width:',
                                                l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "widthContent"), t.opts.autoescape),
                                                l += 'px;border-radius:30px;left:0;">\n        <div class="tooltip-content" style="width:',
                                                l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "widthContent"), t.opts.autoescape),
                                                l += 'px;height:576px;border-radius:30px;display:flex;flex-direction:column;">\n\n            <div class="title" style="font-size:48px;line-height:1.5;padding:10px 80px 0 80px;">',
                                                l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "title"), t.opts.autoescape),
                                                l += "</div>",
                                                n = n.push();
                                                var c = (s = 438,
                                                o = 32,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "range"), "range", e, [0, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "column")]));
                                                if (c)
                                                    for (var d = c.length, p = 0; p < c.length; p++) {
                                                        var f = c[p];
                                                        n.set("column", f),
                                                        n.set("loop.index", p + 1),
                                                        n.set("loop.index0", p),
                                                        n.set("loop.revindex", d - p),
                                                        n.set("loop.revindex0", d - p - 1),
                                                        n.set("loop.first", 0 === p),
                                                        n.set("loop.last", p === d - 1),
                                                        n.set("loop.length", d),
                                                        r.contextOrFrameLookup(e, n, "width_before") > 30 && (l += '<div class="fa fa-arrow-left" style="font-size:40px;position:absolute;top:250px;left:',
                                                        l += r.suppressValue(r.contextOrFrameLookup(e, n, "width_before"), t.opts.autoescape),
                                                        l += 'px"></div>');
                                                        var g;
                                                        g = r.contextOrFrameLookup(e, n, "width_before") + 1024,
                                                        n.set("width_before", g, !0),
                                                        n.topLevel && e.setVariable("width_before", g),
                                                        n.topLevel && e.addExport("width_before", g)
                                                    }
                                                n = n.pop(),
                                                l += '<div class="description" style="column-gap:180px;column-count:',
                                                l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "column"), t.opts.autoescape),
                                                l += ';font-size:36px;width:100%;line-height:1.5;padding:10px 80px 0 80px;">',
                                                l += r.suppressValue(t.getFilter("safe").call(e, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "description")), t.opts.autoescape),
                                                l += "</div>",
                                                n = n.push();
                                                var m = (s = 447,
                                                o = 32,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "range"), "range", e, [1, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "column")]));
                                                if (m)
                                                    for (var v = m.length, _ = 0; _ < m.length; _++) {
                                                        var b = m[_];
                                                        n.set("column", b),
                                                        n.set("loop.index", _ + 1),
                                                        n.set("loop.index0", _),
                                                        n.set("loop.revindex", v - _),
                                                        n.set("loop.revindex0", v - _ - 1),
                                                        n.set("loop.first", 0 === _),
                                                        n.set("loop.last", _ === v - 1),
                                                        n.set("loop.length", v),
                                                        l += '<div class="fa fa-arrow-right" style="font-size:40px;position:absolute;top:250px;left:',
                                                        l += r.suppressValue(r.contextOrFrameLookup(e, n, "width_next"), t.opts.autoescape),
                                                        l += 'px"></div>\n                ';
                                                        var x;
                                                        x = r.contextOrFrameLookup(e, n, "width_next") + 1024,
                                                        n.set("width_next", x, !0),
                                                        n.topLevel && e.setVariable("width_next", x),
                                                        n.topLevel && e.addExport("width_next", x)
                                                    }
                                                n = n.pop(),
                                                l += '<div class="footer" style="text-align:left;font-size:36px;justify-content:space-around;bottom:15px;left:0;position:absolute;margin:20px 0 20px 0;">',
                                                n = n.push();
                                                var y = (s = 453,
                                                o = 40,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "range"), "range", e, [0, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "column")]));
                                                if (y)
                                                    for (var S = y.length, w = 0; w < y.length; w++) {
                                                        var C = y[w];
                                                        n.set("column", C),
                                                        n.set("loop.index", w + 1),
                                                        n.set("loop.index0", w),
                                                        n.set("loop.revindex", S - w),
                                                        n.set("loop.revindex0", S - w - 1),
                                                        n.set("loop.first", 0 === w),
                                                        n.set("loop.last", w === S - 1),
                                                        n.set("loop.length", S),
                                                        l += '<div class="containter-button" style="width:1024px;display:inline-block;text-align:center;">',
                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "displayNavigation") ? l += '<button id="prevButton" class="button" style="background:#444444;">Prev</button>\n                                <button id="closeButton" class="button" style="background:#444444;">Close annotation</button>\n                                <button id="nextButton" class="button" style="background:#444444;">Next</button>' : l += '<button id="closeButton" class="button" style="background:#444444;">Close annotation</button>',
                                                        l += "</div>"
                                                    }
                                                return n = n.pop(),
                                                l += "</div>\n\n        </div>\n    </div>\n</div>\n\n",
                                                n = a,
                                                new r.SafeString(l)
                                            });
                                            e.addExport("model_hotspot_vr"),
                                            e.setVariable("model_hotspot_vr", y),
                                            l += "\n\n";
                                            var S = r.makeMacro(["src"], ["options"], function(i, a) {
                                                var s = n;
                                                n = new r.Frame,
                                                a = a || {},
                                                a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                n.set("src", i),
                                                n.set("options", a.hasOwnProperty("options") ? a.options : {});
                                                var o = "";
                                                return o += "<iframe",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "class") && (o += ' class="',
                                                o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "class"), t.opts.autoescape),
                                                o += '"'),
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "width") && (o += ' width="',
                                                o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "width"), t.opts.autoescape),
                                                o += '"'),
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "height") && (o += ' height="',
                                                o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "height"), t.opts.autoescape),
                                                o += '"'),
                                                o += ' src="',
                                                o += r.suppressValue(i, t.opts.autoescape),
                                                o += '" frameborder="0" allowvr allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" onmousewheel=""></iframe>',
                                                n = s,
                                                new r.SafeString(o)
                                            });
                                            e.addExport("model_iframe"),
                                            e.setVariable("model_iframe", S),
                                            l += "\n\n";
                                            var w = r.makeMacro(["relatedByAlgo"], [], function(i, a) {
                                                var l = n;
                                                n = new r.Frame,
                                                a = a || {},
                                                a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                n.set("relatedByAlgo", i);
                                                var u = "";
                                                u += '\n    <h5 class="sidebar-title">Suggested models</h5>\n    <ul class="related-algo ',
                                                i || (u += "spinner"),
                                                u += '">',
                                                n = n.push();
                                                var h = i;
                                                if (h)
                                                    for (var c = h.length, d = 0; d < h.length; d++) {
                                                        var p = h[d];
                                                        n.set("model", p),
                                                        n.set("loop.index", d + 1),
                                                        n.set("loop.index0", d),
                                                        n.set("loop.revindex", c - d),
                                                        n.set("loop.revindex0", c - d - 1),
                                                        n.set("loop.first", 0 === d),
                                                        n.set("loop.last", d === c - 1),
                                                        n.set("loop.length", c),
                                                        u += r.suppressValue((s = 478,
                                                        o = 36,
                                                        r.callWrap(r.contextOrFrameLookup(e, n, "model_related_algo_item"), "model_related_algo_item", e, [p])), t.opts.autoescape)
                                                    }
                                                return n = n.pop(),
                                                u += "</ul>\n",
                                                n = l,
                                                new r.SafeString(u)
                                            });
                                            e.addExport("model_related_algo"),
                                            e.setVariable("model_related_algo", w),
                                            l += "\n\n";
                                            var C = r.makeMacro(["item"], [], function(i, a) {
                                                var l = n;
                                                n = new r.Frame,
                                                a = a || {},
                                                a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                n.set("item", i);
                                                var u = "";
                                                return u += '\n    <li itemprop="workExample" itemscope itemtype="http://schema.org/MediaObject" data-uid="',
                                                u += r.suppressValue(r.memberLookup(i, "uid"), t.opts.autoescape),
                                                u += '">',
                                                u += r.suppressValue((s = 484,
                                                o = 120,
                                                r.callWrap(r.contextOrFrameLookup(e, n, "model_smallcard"), "model_smallcard", e, [r.contextOrFrameLookup(e, n, "authUser"), i])), t.opts.autoescape),
                                                u += "</li>\n",
                                                n = l,
                                                new r.SafeString(u)
                                            });
                                            e.addExport("model_related_algo_item"),
                                            e.setVariable("model_related_algo_item", C),
                                            l += "\n\n";
                                            var M = r.makeMacro(["license"], ["options"], function(a, s) {
                                                var o = n;
                                                n = new r.Frame,
                                                s = s || {},
                                                s.hasOwnProperty("caller") && n.set("caller", s.caller),
                                                n.set("license", a),
                                                n.set("options", s.hasOwnProperty("options") ? s.options : {});
                                                var l = "";
                                                l += "\n\n    ";
                                                var u;
                                                u = t.getFilter("default").call(e, r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "icon_size"), 20),
                                                n.set("icon_size", u, !0),
                                                n.topLevel && e.setVariable("icon_size", u),
                                                n.topLevel && e.addExport("icon_size", u),
                                                l += "\n\n    ";
                                                var h;
                                                if (h = {
                                                    "http://creativecommons.org/licenses/by/4.0/": {
                                                        clauses: ["by"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/licenses/by-sa/4.0/": {
                                                        clauses: ["by", "sa"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/licenses/by-nd/4.0/": {
                                                        clauses: ["by", "nd"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/licenses/by-nc/4.0/": {
                                                        clauses: ["by", "nc"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/licenses/by-nc-sa/4.0/": {
                                                        clauses: ["by", "nc", "sa"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/licenses/by-nc-nd/4.0/": {
                                                        clauses: ["by", "nc", "nd"],
                                                        label: "Some rights reserved"
                                                    },
                                                    "http://creativecommons.org/publicdomain/zero/1.0/": {
                                                        clauses: ["zero"],
                                                        label: "Public Domain"
                                                    }
                                                },
                                                n.set("all_licenses", h, !0),
                                                n.topLevel && e.setVariable("all_licenses", h),
                                                n.topLevel && e.addExport("all_licenses", h),
                                                l += "\n\n    ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "all_licenses"), r.memberLookup(a, "url"))) {
                                                    l += '\n\n        <a href="',
                                                    l += r.suppressValue(r.memberLookup(a, "url"), t.opts.autoescape),
                                                    l += '" rel="license" itemprop="license" class="help" target="_blank">\n            ',
                                                    n = n.push();
                                                    var c = r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e, n, "all_licenses"), r.memberLookup(a, "url")), "clauses");
                                                    if (c)
                                                        for (var d = c.length, p = 0; p < c.length; p++) {
                                                            var f = c[p];
                                                            n.set("clause", f),
                                                            n.set("loop.index", p + 1),
                                                            n.set("loop.index0", p),
                                                            n.set("loop.revindex", d - p),
                                                            n.set("loop.revindex0", d - p - 1),
                                                            n.set("loop.first", 0 === p),
                                                            n.set("loop.last", p === d - 1),
                                                            n.set("loop.length", d),
                                                            l += "\n                ",
                                                            "by" == f ? (l += '\n                    <img src="',
                                                            l += r.suppressValue(i(157), t.opts.autoescape),
                                                            l += '" width="',
                                                            l += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            l += '" height="',
                                                            l += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            l += '" class="icon" />\n                ') : "nc" == f ? (l += '\n                    <img src="',
                                                            l += r.suppressValue(i(158), t.opts.autoescape),
                                                            l += '" width="',
                                                            l += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            l += '" height="',
                                                            l += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            l += '" class="icon" />\n                ') : "sa" == f ? (l += '\n                    <img src="',
                                                            l += r.suppressValue(i(160), t.opts.autoescape),
                                                            l += '" width="',
                                                            l += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            l += '" height="',
                                                            l += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            l += '" class="icon" />\n                ') : "nd" == f && (l += '\n                    <img src="',
                                                            l += r.suppressValue(i(159), t.opts.autoescape),
                                                            l += '" width="',
                                                            l += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            l += '" height="',
                                                            l += r.suppressValue(r.contextOrFrameLookup(e, n, "icon_size"), t.opts.autoescape),
                                                            l += '" class="icon" />\n                '),
                                                            l += "\n            "
                                                        }
                                                    n = n.pop(),
                                                    l += "\n\n            ",
                                                    l += r.suppressValue(r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e, n, "all_licenses"), r.memberLookup(a, "url")), "label"), t.opts.autoescape),
                                                    l += '\n\n            <span class="tooltip tooltip-right">',
                                                    l += r.suppressValue(r.memberLookup(a, "fullname"), t.opts.autoescape),
                                                    l += "</span>\n        </a>\n\n    "
                                                } else
                                                    l += "\n\n        <span>All rights reserved</span>\n\n    ";
                                                return l += "\n\n",
                                                n = o,
                                                new r.SafeString(l)
                                            });
                                            e.addExport("model_license"),
                                            e.setVariable("model_license", M);
                                            var T = r.makeMacro(["model"], ["options"], function(t, i) {
                                                var a = n;
                                                n = new r.Frame,
                                                i = i || {},
                                                i.hasOwnProperty("caller") && n.set("caller", i.caller),
                                                n.set("model", t),
                                                n.set("options", i.hasOwnProperty("options") ? i.options : {});
                                                var s = "";
                                                return r.memberLookup(t, "isProtected") ? (s += "\n        ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withIcons") && (s += '<i class="icon fa fa-lock protected"></i> '),
                                                s += '\n        <span class="label">Only people with password and link will have access</span>\n    ') : r.memberLookup(t, "isPrivate") ? (s += "\n        ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withIcons") && (s += '<i class="icon fa fa-lock private"></i> '),
                                                s += '\n        <span class="label">Only people with link will have access</span>\n    ') : (s += "\n        ",
                                                r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "withIcons") && (s += '<i class="icon fa fa-globe"></i> '),
                                                s += '\n        <span class="label">Everyone will have access</span>\n    '),
                                                n = a,
                                                new r.SafeString(s)
                                            });
                                            e.addExport("model_draft_privacy_description"),
                                            e.setVariable("model_draft_privacy_description", T),
                                            u ? u.rootRenderFunc(t, e, n, r, a) : a(null, l)
                                        })
                                    })
                                })
                            })
                        })
                    })
                } catch (t) {
                    a(r.handleError(t, s, o))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, , , function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(18))
      , a = i.n(r)
      , s = i(7)
      , o = i.n(s)
      , l = i(388)
      , u = i(400)
      , h = i(399)
      , c = i(21)
      , d = i(397);
    e.a = a.a.Collection.extend({
        defaultOptions: {},
        backend: l.a,
        constructor: function() {
            this.options = i.i(n.extend)({}, this.defaultOptions, i.i(n.pickBy)(arguments[1] || {}, function(t) {
                return void 0 !== t
            })),
            a.a.Collection.apply(this, arguments)
        },
        at: function(t) {
            return t < 0 ? void 0 : a.a.Collection.prototype.at.call(this, t)
        },
        initialize: function() {
            this.options.backend && (this.backend = this.options.backend),
            i.i(d.a)(this, this.backend),
            a.a.Collection.prototype.initialize.apply(this, arguments)
        },
        add: function() {
            var t = a.a.Collection.prototype.add.apply(this, arguments);
            return this.trigger("afterAdd", this.models),
            t
        },
        set: function() {
            var t = a.a.Collection.prototype.set.apply(this, arguments);
            return this.trigger("afterAdd", this.models),
            t
        },
        queryParams: function() {
            return this.isCursorPagination() ? {
                cursor: this._currentCursor,
                count: this.options.count
            } : {
                offset: this.options.offset,
                count: this.options.count
            }
        },
        url: function() {
            var t = i.i(n.result)(this, "domain")
              , e = i.i(n.result)(this, "endpoint")
              , r = t + e
              , a = r + c.a.craft("?", this.queryParams());
            return a = a.replace(/(?!^)\/{2,}/g, "/")
        },
        fetch: function() {
            return this.previousPromise && this.previousPromise.abort(),
            this.trigger("beforeRequest"),
            this.previousPromise = a.a.Collection.prototype.fetch.apply(this, arguments),
            this.previousPromise.then(function(t) {
                return this.trigger("afterRequest"),
                t
            }
            .bind(this))
        },
        loadMore: function(t) {
            if (this.pagination)
                return this.loadNextPage();
            var e = this.options.offset || 0
              , r = this.options.pageSize || 10;
            return this.options.offset = e + r,
            this.options.maxOffset && this.options.offset >= this.options.maxOffset ? void 0 : this.fetch(i.i(n.extend)({
                remove: !1
            }, t))
        },
        isCursorPagination: function() {
            return this.pagination && "cursor" === this.pagination.type
        },
        initializePagination: function(t) {
            "offset" === t ? this._initializeOffsetPagination() : this._initializeCursorPagination()
        },
        _initializeCursorPagination: function() {
            var t = {
                previous: this.options.cursor ? this.options.cursor.previous : null,
                current: void 0
            };
            this.options.cursor && (t.next = this.options.cursor.next),
            this.pagination = i.i(h.a)(t, function(t) {
                return this._currentCursor = t,
                this.fetch({
                    reset: !1,
                    add: !1,
                    remove: !1
                })
            }
            .bind(this))
        },
        _initializeOffsetPagination: function() {
            var t = {
                lastPage: this.options.lastPage,
                currentPageIndex: this.options.firstPage
            };
            this.pagination = i.i(u.a)(t, function(t) {
                return this.options.offset = (parseInt(this.options.pageSize) || 24) * t,
                this.fetch({
                    reset: !1,
                    add: !1,
                    remove: !1
                })
            }
            .bind(this))
        },
        loadPreviousPage: function() {
            return this.pagination.loadPrevious({}).then(function(t) {
                this.add(this.parse(t), {
                    at: 0
                })
            }
            .bind(this))
        },
        loadNextPage: function() {
            return this.pagination.loadNext({}).then(function(t) {
                this.add(this.parse(t))
            }
            .bind(this))
        },
        loadFirstPage: function() {
            return this.pagination.loadFirst({}).then(function(t) {
                this.set(this.parse(t))
            }
            .bind(this))
        },
        prefetchNextPage: function() {
            return this.pagination.hasNext() ? this.pagination.loadNext({
                isPrefetching: !0
            }) : o.a.resolve()
        },
        hasPreviousPage: function() {
            return this.pagination.hasPrevious()
        },
        hasNextPage: function() {
            return this.pagination.hasNext()
        }
    }, {
        extend: function(t, e) {
            var r = i.i(n.extend)({}, t, {
                defaultOptions: i.i(n.extend)({}, this.prototype.defaultOptions || {}, t.defaultOptions || {})
            });
            return a.a.Collection.extend.call(this, r, e)
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = {};
    a.OSG_VERSION = -1;
    var s = function(t) {
        var e = r.a.defer()
          , i = e.promise;
        a["get" + t] = function() {
            return i
        }
        ,
        a["resolve" + t] = function() {
            !1 === i.isFulfilled() && e.resolve.apply(e, arguments)
        }
    };
    s("Polygon"),
    s("Wireframe"),
    s("ModelDisplayed"),
    s("FirstAnimation"),
    s("AllAnimations"),
    s("HasAnimation"),
    s("FirstCameraAnimation"),
    s("Material"),
    s("HasSound"),
    s("SoundsCanPlayTrough"),
    s("LowResLoaded"),
    s("HighResLoaded"),
    s("LowResBound"),
    s("HighResBound"),
    e.a = a
}
, , , , , , function(t, e, i) {
    i(338),
    function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/buttons.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    var l = null;
                    t.getTemplate("skfb_front/macros/popovers.jinja", !1, "skfb_front/macros/buttons.jinja", !1, function(u, h) {
                        if (u)
                            return void r(u);
                        h.getExported(function(u, h) {
                            if (u)
                                return void r(u);
                            if (!h.hasOwnProperty("share_popover"))
                                return void r(new Error("cannot import 'share_popover'"));
                            var c = h.share_popover;
                            e.setVariable("share_popover", c),
                            o += "\n\n";
                            var d = n.makeMacro(["authUser", "user"], ["options"], function(e, r, a) {
                                var s = i;
                                i = new n.Frame,
                                a = a || {},
                                a.hasOwnProperty("caller") && i.set("caller", a.caller),
                                i.set("authUser", e),
                                i.set("user", r),
                                i.set("options", a.hasOwnProperty("options") ? a.options : {});
                                var o = "";
                                return o += '\n\n    <span class="toggle-button follow-button btn-loading" data-action="follow" data-user="',
                                o += n.suppressValue(n.memberLookup(r, "uid"), t.opts.autoescape),
                                o += '">\n        <a class="button btn-primary toggle btn-disabled">\n            <i class="icon fa fa-plus"></i>\n            Follow\n        </a>\n        <a class="button btn-important untoggle">\n            <span class="toggled">\n                Following\n            </span>\n            <span class="untoggled">\n                Unfollow\n            </span>\n        </a>\n    </span>\n\n',
                                i = s,
                                new n.SafeString(o)
                            });
                            e.addExport("follow_button"),
                            e.setVariable("follow_button", d),
                            o += "\n\n";
                            var p = n.makeMacro(["authUser"], ["options"], function(r, o) {
                                var l = i;
                                i = new n.Frame,
                                o = o || {},
                                o.hasOwnProperty("caller") && i.set("caller", o.caller),
                                i.set("authUser", r),
                                i.set("options", o.hasOwnProperty("options") ? o.options : {});
                                var u = "";
                                return u += '\n\n    <div class="button btn-medium btn-secondary btn-loading like like-button popover-container btn-disabled" data-action="like-model">\n        <i class="icon fa fa-star"></i>\n        Like\n        ',
                                n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover"), "display") && (u += "\n            ",
                                u += n.suppressValue((a = 27,
                                s = 26,
                                n.callWrap(n.contextOrFrameLookup(e, i, "share_popover"), "share_popover", e, [{
                                    class: n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover"), "arrow")
                                }])), t.opts.autoescape),
                                u += "\n        "),
                                u += "\n    </div>\n\n",
                                i = l,
                                new n.SafeString(u)
                            });
                            e.addExport("like_button"),
                            e.setVariable("like_button", p),
                            o += "\n\n";
                            var f = n.makeMacro(["authUser"], ["options"], function(r, o) {
                                var l = i;
                                i = new n.Frame,
                                o = o || {},
                                o.hasOwnProperty("caller") && i.set("caller", o.caller),
                                i.set("authUser", r),
                                i.set("options", o.hasOwnProperty("options") ? o.options : {});
                                var u = "";
                                return u += '\n\n    <div class="help like-button star-like-button btn-loading popover-container',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "buttonClass") && (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "buttonClass"), t.opts.autoescape)),
                                u += '" data-action="like-model">\n        ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count") && n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count"), "display") && (u += '\n            <span class="count">',
                                u += n.suppressValue(n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count"), "like"), t.opts.autoescape),
                                u += "</span>\n        "),
                                u += '\n        <span class="tooltip liked-content',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass") ? (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass"), t.opts.autoescape)) : u += " tooltip-down",
                                u += '">Like</span>\n        <span class="tooltip unliked-content',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass") ? (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass"), t.opts.autoescape)) : u += " tooltip-down",
                                u += '">Unlike</span>\n        ',
                                n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover"), "display") && (u += "\n            ",
                                u += n.suppressValue((a = 42,
                                s = 26,
                                n.callWrap(n.contextOrFrameLookup(e, i, "share_popover"), "share_popover", e, [{
                                    class: n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover"), "arrow")
                                }])), t.opts.autoescape),
                                u += "\n        "),
                                u += "\n    </div>\n\n",
                                i = l,
                                new n.SafeString(u)
                            });
                            e.addExport("star_like_button"),
                            e.setVariable("star_like_button", f),
                            o += "\n\n\n";
                            var g = n.makeMacro(["authUser"], ["options"], function(r, o) {
                                var l = i;
                                i = new n.Frame,
                                o = o || {},
                                o.hasOwnProperty("caller") && i.set("caller", o.caller),
                                i.set("authUser", r),
                                i.set("options", o.hasOwnProperty("options") ? o.options : {});
                                var u = "";
                                return u += '\n\n    <div class="help subscribe-button count-subscribe-button btn-loading popover-container',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "buttonClass") && (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "buttonClass"), t.opts.autoescape)),
                                u += '" data-action="subscribe-collection">\n        ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count") && n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count"), "display") && (u += '\n            <span class="count">',
                                u += n.suppressValue(n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "count"), "subscribe"), t.opts.autoescape),
                                u += "</span>\n        "),
                                u += '\n        <span class="tooltip subscribed-content',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass") ? (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass"), t.opts.autoescape)) : u += " tooltip-down",
                                u += '">Subscribe</span>\n        <span class="tooltip unsubscribed-content',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass") ? (u += " ",
                                u += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "tooltipClass"), t.opts.autoescape)) : u += " tooltip-down",
                                u += '">Unsubscribe</span>\n        ',
                                n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover"), "display") && (u += "\n            ",
                                u += n.suppressValue((a = 58,
                                s = 26,
                                n.callWrap(n.contextOrFrameLookup(e, i, "share_popover"), "share_popover", e, [{
                                    class: n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "popover"), "arrow")
                                }])), t.opts.autoescape),
                                u += "\n        "),
                                u += "\n    </div>\n\n",
                                i = l,
                                new n.SafeString(u)
                            });
                            e.addExport("subscribe_button_count"),
                            e.setVariable("subscribe_button_count", g),
                            o += "\n\n";
                            var m = n.makeMacro(["collection"], [], function(e, r) {
                                var a = i;
                                i = new n.Frame,
                                r = r || {},
                                r.hasOwnProperty("caller") && i.set("caller", r.caller),
                                i.set("collection", e);
                                var s = "";
                                return s += '\n\n    <span class="toggle-button addto-button" data-collection="',
                                s += n.suppressValue(n.memberLookup(e, "uid"), t.opts.autoescape),
                                s += '">\n        <a class="button btn-small btn-primary toggle">\n            Add\n        </a>\n        <a class="button btn-small btn-important untoggle">\n            <span class="toggled">\n                Added\n            </span>\n            <span class="untoggled">\n                Remove\n            </span>\n        </a>\n    </span>\n\n',
                                i = a,
                                new n.SafeString(s)
                            });
                            e.addExport("add_to_collection_button"),
                            e.setVariable("add_to_collection_button", m),
                            o += "\n\n";
                            var v = n.makeMacro(["collection"], [], function(e, r) {
                                var a = i;
                                i = new n.Frame,
                                r = r || {},
                                r.hasOwnProperty("caller") && i.set("caller", r.caller),
                                i.set("collection", e);
                                var s = "";
                                return s += '\n\n    <span class="toggle-button subscribe-collection-button btn-loading" data-action="subscribe-collection" data-collection="',
                                s += n.suppressValue(n.memberLookup(e, "uid"), t.opts.autoescape),
                                s += '">\n        <div class="subscribe">\n            <a class="button btn-medium btn-primary btn-disabled toggle">\n                <i class="icon fa fa-rss"></i>\n                Subscribe\n            </a>\n            <a class="button btn-medium btn-important untoggle">\n                <i class="icon icon-fixed-left fa fa-rss"></i>\n                <span class="toggled">\n                    Subscribed\n                </span>\n                <span class="untoggled">\n                    Unsubscribe\n                </span>\n            </a>\n        </div>\n    </span>\n\n',
                                i = a,
                                new n.SafeString(s)
                            });
                            e.addExport("subscribe_button"),
                            e.setVariable("subscribe_button", v),
                            o += "\n\n";
                            var _ = n.makeMacro([], [], function(t) {
                                var e = i;
                                i = new n.Frame,
                                t = t || {},
                                t.hasOwnProperty("caller") && i.set("caller", t.caller);
                                var r = "";
                                return r += '\n\n    <a class="button btn-medium btn-secondary" data-action="open-collection-popup">\n        <div class="add-to">\n            <i class="icon fa fa-plus"></i>\n            Add to\n        </div>\n    </a>\n\n',
                                i = e,
                                new n.SafeString(r)
                            });
                            e.addExport("add_to_open_popup"),
                            e.setVariable("add_to_open_popup", _),
                            o += "\n",
                            l ? l.rootRenderFunc(t, e, i, n, r) : r(null, o)
                        })
                    })
                } catch (t) {
                    r(n.handleError(t, a, s))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e, i) {
    i(49),
    function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/user.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = null
                  , s = null
                  , o = "";
                try {
                    var l = null;
                    t.getTemplate("skfb_front/macros/buttons.jinja", !1, "skfb_front/macros/user.jinja", !1, function(u, h) {
                        if (u)
                            return void r(u);
                        h.getExported(function(u, h) {
                            if (u)
                                return void r(u);
                            if (!h.hasOwnProperty("follow_button"))
                                return void r(new Error("cannot import 'follow_button'"));
                            var c = h.follow_button;
                            e.setVariable("follow_button", c),
                            o += "\n\n";
                            var d = n.makeMacro(["authUser", "user"], ["options"], function(r, a, s) {
                                var o = i;
                                i = new n.Frame,
                                s = s || {},
                                s.hasOwnProperty("caller") && i.set("caller", s.caller),
                                i.set("authUser", r),
                                i.set("user", a),
                                i.set("options", s.hasOwnProperty("options") ? s.options : {});
                                var l = "";
                                if (l += '\n\n    <a class="user-name" href="',
                                l += n.suppressValue(n.memberLookup(a, "profileUrl"), t.opts.autoescape),
                                l += '"',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "target") && (l += ' target="',
                                l += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "target"), t.opts.autoescape),
                                l += '"'),
                                l += '>\n\n        <div class="wrapper ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSummary") && (l += 'js-summary-trigger" data-user-summary-anchor=".user-summary-anchor.avatar[data-user=\'',
                                l += n.suppressValue(n.memberLookup(a, "uid"), t.opts.autoescape),
                                l += "']"),
                                l += '" data-user="',
                                l += n.suppressValue(n.memberLookup(a, "uid"), t.opts.autoescape),
                                l += '">\n            <data itemprop="url" value="',
                                l += n.suppressValue(n.memberLookup(a, "profileUrl"), t.opts.autoescape),
                                l += '"></data>\n            ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withAvatar")) {
                                    if (l += '\n                <div class="avatar ',
                                    n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSummary") && (l += "user-summary-anchor"),
                                    l += '" data-user="',
                                    l += n.suppressValue(n.memberLookup(a, "uid"), t.opts.autoescape),
                                    l += '">\n                    ',
                                    n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "avatarWidth")) {
                                        l += "\n                        ";
                                        var u;
                                        u = n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "avatarWidth"),
                                        i.set("avatarWidth", u, !0),
                                        i.topLevel && e.setVariable("avatarWidth", u),
                                        i.topLevel && e.addExport("avatarWidth", u),
                                        l += "\n                    "
                                    } else {
                                        l += "\n                        ";
                                        var h;
                                        h = 20,
                                        i.set("avatarWidth", h, !0),
                                        i.topLevel && e.setVariable("avatarWidth", h),
                                        i.topLevel && e.addExport("avatarWidth", h),
                                        l += "\n                    "
                                    }
                                    if (l += "\n                    ",
                                    n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "avatarHeight")) {
                                        l += "\n                        ";
                                        var c;
                                        c = n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "avatarHeight"),
                                        i.set("avatarHeight", c, !0),
                                        i.topLevel && e.setVariable("avatarHeight", c),
                                        i.topLevel && e.addExport("avatarHeight", c),
                                        l += "\n                    "
                                    } else {
                                        l += "\n                        ";
                                        var d;
                                        d = n.contextOrFrameLookup(e, i, "avatarWidth"),
                                        i.set("avatarHeight", d, !0),
                                        i.topLevel && e.setVariable("avatarHeight", d),
                                        i.topLevel && e.addExport("avatarHeight", d),
                                        l += "\n                    "
                                    }
                                    l += "\n                    ",
                                    l += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(a, "avatars"), n.contextOrFrameLookup(e, i, "avatarWidth"), n.contextOrFrameLookup(e, i, "avatarHeight")), t.opts.autoescape),
                                    l += "\n                </div>\n            "
                                }
                                return l += '\n\n            <div class="text">\n                ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "by") && (l += "by"),
                                l += '\n                <div class="username-wrapper" itemprop="name" title="',
                                l += n.suppressValue(n.memberLookup(a, "displayName"), t.opts.autoescape),
                                l += '">',
                                l += n.suppressValue(n.memberLookup(a, "displayName"), t.opts.autoescape),
                                l += "</div>\n            </div>\n            ",
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withoutBadge") || (l += "\n                ",
                                n.memberLookup(a, "accountType") ? (l += '\n                    <span class="flag flag-',
                                l += n.suppressValue(n.memberLookup(n.memberLookup(a, "accountType"), "badge"), t.opts.autoescape),
                                l += '">',
                                l += n.suppressValue(n.memberLookup(n.memberLookup(a, "accountType"), "title"), t.opts.autoescape),
                                l += "</span>\n                ") : (l += "\n                    ",
                                "pro" == n.memberLookup(a, "account") ? l += '\n                        <span class="flag flag-pro">Pro</span>\n                    ' : "biz" == n.memberLookup(a, "account") && (l += '\n                        <span class="flag flag-biz">Pro</span>\n                    '),
                                l += "\n                "),
                                l += "\n            "),
                                l += "\n\n        </div>\n\n    </a>\n\n",
                                i = o,
                                new n.SafeString(l)
                            });
                            e.addExport("user_name"),
                            e.setVariable("user_name", d),
                            o += "\n\n\n";
                            var p = n.makeMacro(["avatars"], ["options"], function(r, a) {
                                var s = i;
                                i = new n.Frame,
                                a = a || {},
                                a.hasOwnProperty("caller") && i.set("caller", a.caller),
                                i.set("avatars", r),
                                i.set("options", a.hasOwnProperty("options") ? a.options : {});
                                var o = "";
                                o += "\n\n    ";
                                var l;
                                return l = t.getFilter("merge").call(e, {
                                    size: 32,
                                    expand: !1
                                }, n.contextOrFrameLookup(e, i, "options")),
                                i.set("options", l, !0),
                                i.topLevel && e.setVariable("options", l),
                                i.topLevel && e.addExport("options", l),
                                o += "\n    ",
                                o += n.suppressValue(t.getFilter("image_container").call(e, r, n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "size"), n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "size"), n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "expand")), t.opts.autoescape),
                                o += "\n\n",
                                i = s,
                                new n.SafeString(o)
                            });
                            e.addExport("user_avatar"),
                            e.setVariable("user_avatar", p),
                            o += "\n\n\n",
                            o += "\n";
                            var f = n.makeMacro(["authUser", "user"], ["options"], function(r, a, s) {
                                var o = i;
                                i = new n.Frame,
                                s = s || {},
                                s.hasOwnProperty("caller") && i.set("caller", s.caller),
                                i.set("authUser", r),
                                i.set("user", a),
                                i.set("options", s.hasOwnProperty("options") ? s.options : {});
                                var l = "";
                                return (n.memberLookup(a, "city") || n.memberLookup(a, "country")) && (n.memberLookup(a, "city") && (n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "microData") && (l += '<data itemprop="addressLocality">'),
                                l += n.suppressValue(n.memberLookup(a, "city"), t.opts.autoescape),
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "microData") && (l += "</data>"),
                                n.memberLookup(a, "country") && (l += ",")),
                                l += " ",
                                n.memberLookup(a, "country") && (n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "microData") && (l += '<data itemprop="addressCountry">'),
                                l += n.suppressValue(n.memberLookup(a, "country"), t.opts.autoescape),
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "microData") && (l += "</data>"))),
                                i = o,
                                new n.SafeString(l)
                            });
                            e.addExport("user_location_plaintext"),
                            e.setVariable("user_location_plaintext", f),
                            o += "\n\n";
                            var g = n.makeMacro(["authUser", "user"], ["options"], function(r, o, l) {
                                var u = i;
                                i = new n.Frame,
                                l = l || {},
                                l.hasOwnProperty("caller") && i.set("caller", l.caller),
                                i.set("authUser", r),
                                i.set("user", o),
                                i.set("options", l.hasOwnProperty("options") ? l.options : {});
                                var h = "";
                                if (h += "\n\n    ",
                                "" != (a = 60,
                                s = 31,
                                n.callWrap(n.contextOrFrameLookup(e, i, "user_location_plaintext"), "user_location_plaintext", e, [r, o, n.contextOrFrameLookup(e, i, "options")]))) {
                                    h += "\n\n        ";
                                    var c;
                                    c = t.getFilter("merge").call(e, {
                                        microData: !0
                                    }, n.contextOrFrameLookup(e, i, "options")),
                                    i.set("options", c, !0),
                                    i.topLevel && e.setVariable("options", c),
                                    i.topLevel && e.addExport("options", c),
                                    h += '\n\n        <i class="fa fa-map-marker"></i>\n        <data itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">\n            <data itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">\n            ',
                                    h += n.suppressValue((a = 67,
                                    s = 36,
                                    n.callWrap(n.contextOrFrameLookup(e, i, "user_location_plaintext"), "user_location_plaintext", e, [r, o, n.contextOrFrameLookup(e, i, "options")])), t.opts.autoescape),
                                    h += "\n            </data>\n        </data>\n    "
                                }
                                return h += "\n\n",
                                i = u,
                                new n.SafeString(h)
                            });
                            e.addExport("user_location"),
                            e.setVariable("user_location", g),
                            o += "\n\n";
                            var m = n.makeMacro(["authUser", "user"], ["options"], function(r, o, l) {
                                var u = i;
                                i = new n.Frame,
                                l = l || {},
                                l.hasOwnProperty("caller") && i.set("caller", l.caller),
                                i.set("authUser", r),
                                i.set("user", o),
                                i.set("options", l.hasOwnProperty("options") ? l.options : {});
                                var h = "";
                                return h += '\n\n    <div class="user-smallcard" data-link="',
                                h += n.suppressValue(n.memberLookup(o, "profileUrl"), t.opts.autoescape),
                                h += '">\n\n        <div class="card-user-avatar ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSummary") && (h += "js-summary-trigger"),
                                h += '" data-user="',
                                h += n.suppressValue(n.memberLookup(o, "uid"), t.opts.autoescape),
                                h += '">\n            ',
                                h += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(o, "avatars"), 60, 60), t.opts.autoescape),
                                h += '\n        </div>\n\n        <div class="card-user-meta">\n            <div class="card-user-name">\n                ',
                                h += n.suppressValue((a = 84,
                                s = 26,
                                n.callWrap(n.contextOrFrameLookup(e, i, "user_name"), "user_name", e, [r, o])), t.opts.autoescape),
                                h += '\n            </div>\n            <div class="card-user-stats">\n                <div class="smallcard-user-follower-count">\n                    ',
                                h += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(o, "followerCount"), 0), t.opts.autoescape),
                                h += ' Followers\n                </div>\n                <div class="smallcard-user-model-count">\n                    ',
                                h += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(o, "modelCount"), 0), t.opts.autoescape),
                                h += " Models\n                </div>\n            </div>\n        </div>\n\n    </div>\n\n",
                                i = u,
                                new n.SafeString(h)
                            });
                            e.addExport("user_smallcard"),
                            e.setVariable("user_smallcard", m),
                            o += "\n\n";
                            var v = n.makeMacro(["authUser", "user"], ["options"], function(r, o, l) {
                                var u = i;
                                i = new n.Frame,
                                l = l || {},
                                l.hasOwnProperty("caller") && i.set("caller", l.caller),
                                i.set("authUser", r),
                                i.set("user", o),
                                i.set("options", l.hasOwnProperty("options") ? l.options : {});
                                var h = "";
                                h += "\n\n    ";
                                var c;
                                if (c = t.getFilter("merge").call(e, {
                                    withSkills: !0,
                                    withRelated: !0
                                }, n.contextOrFrameLookup(e, i, "options")),
                                i.set("options", c, !0),
                                i.topLevel && e.setVariable("options", c),
                                i.topLevel && e.addExport("options", c),
                                h += '\n\n    <div class="card-user" data-link="',
                                h += n.suppressValue(n.memberLookup(o, "profileUrl"), t.opts.autoescape),
                                h += '">\n\n        <div class="card-user-avatar ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSummary") && (h += "js-summary-trigger"),
                                h += '" data-user="',
                                h += n.suppressValue(n.memberLookup(o, "uid"), t.opts.autoescape),
                                h += '">\n            ',
                                h += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(o, "avatars"), 90, 90, !1, !1, !0), t.opts.autoescape),
                                h += '\n        </div>\n        <div class="card-user-meta">\n            <div class="card-user-name">\n                ',
                                h += n.suppressValue((a = 111,
                                s = 26,
                                n.callWrap(n.contextOrFrameLookup(e, i, "user_name"), "user_name", e, [r, o])), t.opts.autoescape),
                                h += '\n            </div>\n            <div class="card-user-location">\n                ',
                                (n.memberLookup(o, "city") || n.memberLookup(o, "country")) && (h += "\n                    ",
                                h += n.suppressValue((a = 115,
                                s = 34,
                                n.callWrap(n.contextOrFrameLookup(e, i, "user_location"), "user_location", e, [r, o])), t.opts.autoescape),
                                h += "\n                "),
                                h += '\n            </div>\n            <div class="card-user-stats">\n                ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withFollow") && n.memberLookup(r, "uid") != n.memberLookup(o, "uid") && (h += "\n                    ",
                                h += n.suppressValue((a = 120,
                                s = 34,
                                n.callWrap(n.contextOrFrameLookup(e, i, "follow_button"), "follow_button", e, [r, o])), t.opts.autoescape),
                                h += "\n                "),
                                h += '\n                <div class="card-user-metrics-container">\n                    <div class="card-user-follower-count help">\n                        <span>',
                                h += n.suppressValue(n.memberLookup(o, "followerCount"), t.opts.autoescape),
                                h += '</span>\n                        <div class="tooltip tooltip-up">Followers</div>\n                    </div>\n                    <div class="card-user-model-count help">\n                        ',
                                h += n.suppressValue(n.memberLookup(o, "modelCount"), t.opts.autoescape),
                                h += '\n                        <div class="tooltip tooltip-up">Models</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        ',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSkills")) {
                                    h += '\n            <div class="card-user-skills">\n                <ul class="item-list list-monoline list-static">\x3c!--\n                    ',
                                    i = i.push();
                                    var d = n.memberLookup(o, "skills");
                                    if (d)
                                        for (var p = d.length, f = 0; f < d.length; f++) {
                                            var g = d[f];
                                            i.set("skill", g),
                                            i.set("loop.index", f + 1),
                                            i.set("loop.index0", f),
                                            i.set("loop.revindex", p - f),
                                            i.set("loop.revindex0", p - f - 1),
                                            i.set("loop.first", 0 === f),
                                            i.set("loop.last", f === p - 1),
                                            i.set("loop.length", p),
                                            h += '\n                        --\x3e<li class="item">',
                                            h += n.suppressValue(n.memberLookup(g, "name"), t.opts.autoescape),
                                            h += "</li>\x3c!--\n                    "
                                        }
                                    i = i.pop(),
                                    h += "\n                --\x3e</ul>\n            </div>\n        "
                                }
                                if (h += "\n\n        ",
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withRelated")) {
                                    if (h += '\n            <div class="card-user-examples">\n                <a class="overlay btn-container" href="',
                                    h += n.suppressValue(n.memberLookup(o, "profileUrl"), t.opts.autoescape),
                                    h += '">\n                    <div class="button btn-small btn-primary">View full profile</div>\n                </a>\n\n                <ul class="card-user-models">\x3c!--\n                    ',
                                    n.memberLookup(o, "thumbnails")) {
                                        h += "\n                        ",
                                        i = i.push();
                                        var m = t.getFilter("fill_null").call(e, t.getFilter("first_n").call(e, n.memberLookup(o, "thumbnails"), 3), 3);
                                        if (m)
                                            for (var v = m.length, _ = 0; _ < m.length; _++) {
                                                var b = m[_];
                                                i.set("thumb", b),
                                                i.set("loop.index", _ + 1),
                                                i.set("loop.index0", _),
                                                i.set("loop.revindex", v - _),
                                                i.set("loop.revindex0", v - _ - 1),
                                                i.set("loop.first", 0 === _),
                                                i.set("loop.last", _ === v - 1),
                                                i.set("loop.length", v),
                                                h += "\n                            --\x3e<li>",
                                                h += n.suppressValue(t.getFilter("image_container").call(e, b, 153, 88, !0, !1, !0), t.opts.autoescape),
                                                h += "</li>\x3c!--\n                        "
                                            }
                                        i = i.pop(),
                                        h += "\n                    "
                                    }
                                    h += "\n                --\x3e</ul>\n\n            </div>\n        "
                                }
                                return h += "\n\n    </div>\n\n",
                                i = u,
                                new n.SafeString(h)
                            });
                            e.addExport("user_card"),
                            e.setVariable("user_card", v),
                            o += "\n\n";
                            var _ = n.makeMacro(["authUser", "user"], ["options"], function(r, o, l) {
                                var u = i;
                                i = new n.Frame,
                                l = l || {},
                                l.hasOwnProperty("caller") && i.set("caller", l.caller),
                                i.set("authUser", r),
                                i.set("user", o),
                                i.set("options", l.hasOwnProperty("options") ? l.options : {});
                                var h = "";
                                h += '\n\n    <div class="user">\n        <a href="/',
                                h += n.suppressValue(n.memberLookup(o, "username"), t.opts.autoescape),
                                h += '">\n        ',
                                h += n.suppressValue((a = 170,
                                s = 20,
                                n.callWrap(n.contextOrFrameLookup(e, i, "user_avatar"), "user_avatar", e, [n.memberLookup(o, "avatars"), {
                                    size: 104
                                }])), t.opts.autoescape),
                                h += '\n        </a>\n        <div class="info">\n            <p class="name" title="',
                                h += n.suppressValue(n.memberLookup(o, "displayName"), t.opts.autoescape),
                                h += '"><a href="/',
                                h += n.suppressValue(n.memberLookup(o, "username"), t.opts.autoescape),
                                h += '">',
                                h += n.suppressValue(n.memberLookup(o, "displayName"), t.opts.autoescape),
                                h += '</a></p>\n            <p class="tagline" title="',
                                h += n.suppressValue(n.memberLookup(o, "tagline"), t.opts.autoescape),
                                h += '"><a href="/',
                                h += n.suppressValue(n.memberLookup(o, "username"), t.opts.autoescape),
                                h += '">',
                                h += n.suppressValue(n.memberLookup(o, "tagline"), t.opts.autoescape),
                                h += "</a></p>\n            ",
                                0 != n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "followButton") && n.memberLookup(r, "uid") != n.memberLookup(o, "uid") && (h += '\n                <div class="follow-wrapper">\n                    ',
                                h += n.suppressValue((a = 177,
                                s = 34,
                                n.callWrap(n.contextOrFrameLookup(e, i, "follow_button"), "follow_button", e, [r, o])), t.opts.autoescape),
                                h += '\n                    <p class="follow-count"><a href="/',
                                h += n.suppressValue(n.memberLookup(o, "username"), t.opts.autoescape),
                                h += '/followers"><span>',
                                h += n.suppressValue(n.memberLookup(o, "followerCount"), t.opts.autoescape),
                                h += "</span> followers</a></p>\n                </div>\n            "),
                                h += '\n        </div>\n    </div>\n    <div class="models">',
                                i = i.push();
                                var c = t.getFilter("first_n").call(e, n.memberLookup(o, "thumbnails"), 3);
                                if (c)
                                    for (var d = c.length, p = 0; p < c.length; p++) {
                                        var f = c[p];
                                        i.set("thumb", f),
                                        i.set("loop.index", p + 1),
                                        i.set("loop.index0", p),
                                        i.set("loop.revindex", d - p),
                                        i.set("loop.revindex0", d - p - 1),
                                        i.set("loop.first", 0 === p),
                                        i.set("loop.last", p === d - 1),
                                        i.set("loop.length", d),
                                        h += '\n            <a href="',
                                        h += n.suppressValue(n.memberLookup(f, "viewerUrl"), t.opts.autoescape),
                                        h += '">\n                ',
                                        h += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(f, "thumbnail"), 133, 88, !1), t.opts.autoescape),
                                        h += "\n            </a>\n        "
                                    }
                                return i = i.pop(),
                                h += '\n    </div>\n    <div class="stats">\n        <p class="model-count">',
                                h += n.suppressValue(n.memberLookup(o, "modelCount"), t.opts.autoescape),
                                h += " model",
                                h += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(o, "modelCount")), t.opts.autoescape),
                                h += '</p>\n        <p class="view-count">',
                                h += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(n.memberLookup(o, "stats"), "view_count")), t.opts.autoescape),
                                h += " view",
                                h += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(n.memberLookup(o, "stats"), "view_count")), t.opts.autoescape),
                                h += '</p>\n        <p class="like-count">',
                                h += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(n.memberLookup(o, "stats"), "like_count")), t.opts.autoescape),
                                h += " like",
                                h += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(n.memberLookup(o, "stats"), "like_count")), t.opts.autoescape),
                                h += "</p>\n    </div>\n\n",
                                i = u,
                                new n.SafeString(h)
                            });
                            e.addExport("user_summary"),
                            e.setVariable("user_summary", _),
                            o += "\n\n";
                            var b = n.makeMacro(["authUser", "followSuggestion", "cloaked"], ["options"], function(r, o, l, u) {
                                var h = i;
                                i = new n.Frame,
                                u = u || {},
                                u.hasOwnProperty("caller") && i.set("caller", u.caller),
                                i.set("authUser", r),
                                i.set("followSuggestion", o),
                                i.set("cloaked", l),
                                i.set("options", u.hasOwnProperty("options") ? u.options : {});
                                var c = "";
                                return c += "\n\n\n    ",
                                c += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(o, "avatars"), 64, 64), t.opts.autoescape),
                                c += '\n\n    <div class="info">\n        <p class="name">',
                                c += n.suppressValue(n.memberLookup(o, "displayName"), t.opts.autoescape),
                                c += '</p>\n        <p class="stats">',
                                c += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(o, "followerCount")), t.opts.autoescape),
                                c += " follower",
                                c += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(o, "followerCount")), t.opts.autoescape),
                                c += ", ",
                                c += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(o, "modelCount")), t.opts.autoescape),
                                c += " model",
                                c += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(o, "modelCount")), t.opts.autoescape),
                                c += " </p>\n    </div>\n\n    ",
                                n.memberLookup(r, "uid") != n.memberLookup(o, "uid") && (c += "\n        ",
                                c += n.suppressValue((a = 209,
                                s = 22,
                                n.callWrap(n.contextOrFrameLookup(e, i, "follow_button"), "follow_button", e, [r, o])), t.opts.autoescape),
                                c += "\n    "),
                                c += "\n\n",
                                i = h,
                                new n.SafeString(c)
                            });
                            e.addExport("follow_suggestion_large"),
                            e.setVariable("follow_suggestion_large", b),
                            o += "\n\n";
                            var x = n.makeMacro(["authUser", "followSuggestion", "cloaked"], ["options"], function(r, o, l, u) {
                                var h = i;
                                i = new n.Frame,
                                u = u || {},
                                u.hasOwnProperty("caller") && i.set("caller", u.caller),
                                i.set("authUser", r),
                                i.set("followSuggestion", o),
                                i.set("cloaked", l),
                                i.set("options", u.hasOwnProperty("options") ? u.options : {});
                                var c = "";
                                return c += '\n\n    <span class="js-summary-trigger avatar-container" data-user="',
                                c += n.suppressValue(n.memberLookup(n.memberLookup(o, "user"), "uid"), t.opts.autoescape),
                                c += '">\n        ',
                                c += n.suppressValue(t.getFilter("image_container").call(e, n.memberLookup(n.memberLookup(o, "user"), "avatars"), 64, 64), t.opts.autoescape),
                                c += '\n    </span>\n\n    <div class="info">\n        <p class="name js-summary-trigger" data-user="',
                                c += n.suppressValue(n.memberLookup(n.memberLookup(o, "user"), "uid"), t.opts.autoescape),
                                c += '" data-user-summary-anchor=".avatar-container[data-user=\'',
                                c += n.suppressValue(n.memberLookup(n.memberLookup(o, "user"), "uid"), t.opts.autoescape),
                                c += "']\">",
                                c += n.suppressValue(n.memberLookup(n.memberLookup(o, "user"), "displayName"), t.opts.autoescape),
                                c += '</p>\n        <p class="stats">',
                                c += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(n.memberLookup(o, "user"), "followerCount")), t.opts.autoescape),
                                c += " follower",
                                c += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(n.memberLookup(o, "user"), "followerCount")), t.opts.autoescape),
                                c += ", ",
                                c += n.suppressValue(t.getFilter("humanize_number").call(e, n.memberLookup(n.memberLookup(o, "user"), "modelCount")), t.opts.autoescape),
                                c += " model",
                                c += n.suppressValue(t.getFilter("pluralize").call(e, n.memberLookup(n.memberLookup(o, "user"), "modelCount")), t.opts.autoescape),
                                c += " </p>\n    </div>\n\n    ",
                                n.memberLookup(r, "uid") != n.memberLookup(n.memberLookup(o, "user"), "uid") && (c += "\n        ",
                                c += n.suppressValue((a = 226,
                                s = 22,
                                n.callWrap(n.contextOrFrameLookup(e, i, "follow_button"), "follow_button", e, [r, n.memberLookup(o, "user")])), t.opts.autoescape),
                                c += "\n    "),
                                c += '\n\n    <div class="reason">\n        <p>',
                                c += n.suppressValue(t.getFilter("print_suggestion_verb").call(e, n.memberLookup(o, "verb"), n.memberLookup(o, "user")), t.opts.autoescape),
                                c += " ",
                                c += n.suppressValue(t.getFilter("print_suggestion_target").call(e, n.memberLookup(o, "target"), n.memberLookup(o, "verb")), t.opts.autoescape),
                                c += "</p>\n    </div>\n\n",
                                i = h,
                                new n.SafeString(c)
                            });
                            e.addExport("follow_suggestion_reason"),
                            e.setVariable("follow_suggestion_reason", x),
                            o += "\n\n";
                            var y = n.makeMacro(["authUser", "followSuggestion", "cloaked"], ["options"], function(r, o, l, u) {
                                var h = i;
                                i = new n.Frame,
                                u = u || {},
                                u.hasOwnProperty("caller") && i.set("caller", u.caller),
                                i.set("authUser", r),
                                i.set("followSuggestion", o),
                                i.set("cloaked", l),
                                i.set("options", u.hasOwnProperty("options") ? u.options : {});
                                var c = "";
                                return c += '\n\n    <li class="follow-item',
                                l && (c += " cloaked"),
                                c += '" data-user="',
                                c += n.suppressValue(n.memberLookup(o, "uid"), t.opts.autoescape),
                                c += '">\n\n        ',
                                c += n.suppressValue((a = 239,
                                s = 18,
                                n.callWrap(n.contextOrFrameLookup(e, i, "user_name"), "user_name", e, [r, o, n.makeKeywordArgs({
                                    options: {
                                        withAvatar: !0,
                                        withSummary: n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "withSummary"),
                                        avatarHeight: 32,
                                        avatarWidth: 32
                                    }
                                })])), t.opts.autoescape),
                                c += "\n\n        ",
                                n.memberLookup(r, "uid") != n.memberLookup(o, "uid") && (c += "\n\n            ",
                                c += n.suppressValue((a = 248,
                                s = 26,
                                n.callWrap(n.contextOrFrameLookup(e, i, "follow_button"), "follow_button", e, [n.contextOrFrameLookup(e, i, "user"), o])), t.opts.autoescape),
                                c += "\n\n        "),
                                c += "\n\n    </li>\n\n",
                                i = h,
                                new n.SafeString(c)
                            });
                            e.addExport("follow_suggestion"),
                            e.setVariable("follow_suggestion", y),
                            o += "\n\n";
                            var S = n.makeMacro(["authUser", "followSuggestions"], ["options"], function(r, o, l) {
                                var u = i;
                                i = new n.Frame,
                                l = l || {},
                                l.hasOwnProperty("caller") && i.set("caller", l.caller),
                                i.set("authUser", r),
                                i.set("followSuggestions", o),
                                i.set("options", l.hasOwnProperty("options") ? l.options : {});
                                var h = "";
                                h += '\n\n    <div class="sidebar-box suggested-follow',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "container_class") && (h += " ",
                                h += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "container_class"), t.opts.autoescape)),
                                h += '">\n        <h5 class="sidebar-title">',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "title") ? h += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "title"), t.opts.autoescape) : h += "Who to follow ",
                                h += "</h5>\n        <ul>\n\n            ";
                                var c;
                                if (c = t.getFilter("length").call(e, o),
                                i.set("suggestionsCount", c, !0),
                                i.topLevel && e.setVariable("suggestionsCount", c),
                                i.topLevel && e.addExport("suggestionsCount", c),
                                h += "\n\n            ",
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "maxSuggestions")) {
                                    h += "\n                ";
                                    var d;
                                    d = n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "maxSuggestions"),
                                    i.set("max", d, !0),
                                    i.topLevel && e.setVariable("max", d),
                                    i.topLevel && e.addExport("max", d),
                                    h += "\n            "
                                } else {
                                    h += "\n                ";
                                    var p;
                                    p = n.contextOrFrameLookup(e, i, "suggestionsCount"),
                                    i.set("max", p, !0),
                                    i.topLevel && e.setVariable("max", p),
                                    i.topLevel && e.addExport("max", p),
                                    h += "\n            "
                                }
                                h += "\n\n            ",
                                i = i.push();
                                var f = o;
                                if (f)
                                    for (var g = f.length, m = 0; m < f.length; m++) {
                                        var v = f[m];
                                        i.set("following", v),
                                        i.set("loop.index", m + 1),
                                        i.set("loop.index0", m),
                                        i.set("loop.revindex", g - m),
                                        i.set("loop.revindex0", g - m - 1),
                                        i.set("loop.first", 0 === m),
                                        i.set("loop.last", m === g - 1),
                                        i.set("loop.length", g),
                                        h += "\n\n                ",
                                        h += n.suppressValue((a = 272,
                                        s = 34,
                                        n.callWrap(n.contextOrFrameLookup(e, i, "follow_suggestion"), "follow_suggestion", e, [r, v, n.memberLookup(n.contextOrFrameLookup(e, i, "loop"), "index") > n.contextOrFrameLookup(e, i, "max"), n.contextOrFrameLookup(e, i, "options")])), t.opts.autoescape),
                                        h += "\n\n            "
                                    }
                                return i = i.pop(),
                                h += '\n        </ul>\n\n        <a href="#" class="show-more" data-action="show-more"><i class="icon fa fa-plus"></i> Show More</i></a>\n\n    </div>\n\n',
                                i = u,
                                new n.SafeString(h)
                            });
                            e.addExport("follow_suggestions"),
                            e.setVariable("follow_suggestions", S),
                            o += "\n",
                            l ? l.rootRenderFunc(t, e, i, n, r) : r(null, o)
                        })
                    })
                } catch (t) {
                    r(n.handleError(t, a, s))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e, i) {
    "use strict";
    var n, r, a, s = i(4), o = i(358), l = i(43), u = s.a.osg, h = {}, c = -1, d = 0, p = 40, f = u.Timer.instance().tick(), g = !1, m = !1;
    l.a.getModelDisplayed().then(function() {
        m = !0
    });
    var v, _;
    ["hidden", "mozHidden", "msHidden", "webkitHidden"].forEach(function(t) {
        document && document[t] && (v = t,
        _ = t.toLowerCase().split("hidden").shift() + "visibilitychange")
    });
    var b = function() {
        if (a = window.setTimeout(b, p),
        n && !g && !h.isDrawAlreadyQueued() && r && r.canBeEnabled()) {
            u.Timer.instance().tick() - f - p <= p || (r.enable(),
            c = -1)
        }
    };
    i.i(o.a)() || (a = window.setTimeout(b, p));
    var x, y = function(t) {
        if (n && !g && (!m || !document[v])) {
            var e = h.isDrawAlreadyQueued();
            if (e || n.requestRedraw(),
            r && !t && (r.reset(),
            !e)) {
                var i = u.Timer.instance().tick();
                d += i - f,
                c++,
                0 === c ? (c = 0,
                d = 0) : 4 === c && (p = Math.min(200, Math.max(16, d / c)),
                c = 0,
                d = 0),
                f = i
            }
        }
    };
    h.setPoseForScreenshot = function(t) {
        t && !g ? (x = n.getManipulator().update,
        n.getManipulator().update = function() {}
        ) : !t && g && (n.getManipulator().update = x),
        g = t
    }
    ,
    h.isDrawAlreadyQueued = function() {
        return n._requestRedraw
    }
    ,
    h.getPoseForScreenshot = function() {
        return g
    }
    ,
    h.draw = function() {
        y()
    }
    ,
    h.drawSameFrame = function() {
        y(!0)
    }
    ,
    h.setViewer = function(t) {
        n = t
    }
    ,
    h.setSuperSample = function(t) {
        r = t
    }
    ,
    _ && document.addEventListener(_, h.draw),
    e.a = h
}
, , , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(18)
      , r = i.n(n)
      , a = i(2)
      , s = i.n(a)
      , o = i(1)
      , l = (i.n(o),
    i(7))
      , u = i.n(l)
      , h = i(11)
      , c = i(15)
      , d = i(91)
      , p = i(154);
    e.a = c.a.extend(i.i(o.extend)({}, p.a, {
        defaults: {
            collections: {}
        },
        initialize: function() {
            c.a.prototype.initialize.apply(this, arguments),
            this.on("change:isPrivate", function() {
                this.get("isPrivate") || this.set("password", "")
            }
            .bind(this)),
            this.maxFailCount = 5
        },
        url: function() {
            return this.isNew() ? "/i/models" : "/i/models/" + this.get("uid")
        },
        like: function() {
            return h.a.authenticate(function(t) {
                return this.set({
                    likeCount: this.get("likeCount") + 1
                }),
                t.addLike(this.get("uid"), !0),
                r.a.ajax({
                    type: "POST",
                    url: i.i(o.result)(this, "url") + "/likes",
                    cacheBusting: !1
                })
            }
            .bind(this))
        },
        unlike: function() {
            return h.a.authenticate(function(t) {
                return this.set({
                    likeCount: this.get("likeCount") - 1
                }),
                t.addLike(this.get("uid"), !1),
                r.a.ajax({
                    type: "DELETE",
                    url: i.i(o.result)(this, "url") + "/likes"
                })
            }
            .bind(this))
        },
        hit: function() {
            var t = h.a.me();
            if (t.isAuthenticated()) {
                var e = this.get("user") && t.get("uid") === this.get("user").uid
                  , n = t.get("isStaff");
                if (e || n)
                    return u.a.resolve()
            }
            return this.get("isPublished") ? r.a.ajax({
                type: "POST",
                url: i.i(o.result)(this, "url") + "/views",
                cacheBusting: !1
            }) : u.a.resolve()
        },
        hitDownload: function() {
            return r.a.ajax({
                type: "POST",
                url: i.i(o.result)(this, "url") + "/download",
                cacheBusting: !1
            })
        },
        isPublished: function() {
            return (this.get("isPublished") || !!this.get("publishedAt")) && !this.get("isDeleted")
        },
        publish: function() {
            return this.set("isPublished", !0),
            this.set("publishedAt", new Date),
            r.a.ajax({
                type: "PATCH",
                url: i.i(o.result)(this, "url"),
                data: {
                    isPublished: !0
                },
                cacheBusting: !1
            })
        },
        getDownloadStatus: function() {
            return r.a.ajax({
                type: "GET",
                url: i.i(o.result)(this, "url") + "/download",
                allowPrefetching: !1
            }).then(function(t, e, i) {
                return s.a.Deferred().resolve(t, e, i)
            })
        },
        getRelatedContent: function() {
            return r.a.ajax({
                type: "GET",
                url: i.i(o.result)(this, "url") + "/related",
                allowPrefetching: !1
            }).then(function(t, e, i) {
                return s.a.Deferred().resolve(t, e, i)
            })
        },
        pollRelatedContent: function() {
            var t = !0;
            return d.a.while(function() {
                return t
            }, function() {
                return new u.a(function(e) {
                    this.getRelatedContent().then(function(i, n, r) {
                        return 202 === r.status ? u.a.delay(5e3).then(e) : (t = !1,
                        e(i))
                    })
                }
                .bind(this))
            }
            .bind(this)).catch(function() {
                t = !1
            })
        },
        getLikeUsers: function() {
            return r.a.ajax({
                type: "GET",
                url: i.i(o.result)(this, "url") + "/liked_by",
                allowPrefetching: !0
            }).then(function(t) {
                return t
            })
        },
        sharing: function() {
            return r.a.ajax({
                type: "GET",
                url: i.i(o.result)(this, "url") + "/sharing"
            }).then(function(t) {
                return this.set("sharing", t),
                u.a.resolve(t)
            }
            .bind(this))
        },
        toJSON: function() {
            var t = c.a.prototype.toJSON.apply(this, arguments);
            return t.categories && (t.categories = t.categories.map(function(t) {
                return "object" == typeof t ? t.uid : t
            })),
            t
        },
        addCollection: function(t, e) {
            var i = {};
            i[t] = e,
            this.addCollections(i)
        },
        addCollections: function(t) {
            var e = i.i(o.clone)(this.get("collections"));
            i.i(o.extend)(e, t),
            this.set("collections", e)
        },
        isInflated: function() {
            var t = Object.keys(this.attributes);
            return t.indexOf("description") > -1 && t.indexOf("tags") > -1
        },
        isInCollection: function(t) {
            return !!this.get("collections")[t]
        },
        getCollections: function(t) {
            var e = [];
            return i.i(o.each)(t, function(t) {
                t in this.get("collections") || e.push(t)
            }
            .bind(this)),
            new u.a(function(t, i) {
                e.length > 0 ? r.a.ajax({
                    type: "GET",
                    url: "/i/models/" + this.id + "/collections?uid=" + e.join("&uid=")
                }).then(function(e) {
                    this.addCollections(e.results),
                    t()
                }
                .bind(this), i) : (this.trigger("change:collections"),
                t())
            }
            .bind(this))
        }
    }))
}
, function(t, e) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/utils.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = "";
                try {
                    var s = null
                      , o = n.makeMacro(["number"], [], function(r, a) {
                        var s = i;
                        i = new n.Frame,
                        a = a || {},
                        a.hasOwnProperty("caller") && i.set("caller", a.caller),
                        i.set("number", r);
                        var o = "";
                        return o += "\n    ",
                        o += n.suppressValue(t.getFilter("humanize_number").call(e, r), t.opts.autoescape),
                        o += "\n",
                        i = s,
                        new n.SafeString(o)
                    });
                    e.addExport("humanize_count"),
                    e.setVariable("humanize_count", o),
                    a += "\n\n";
                    var l = n.makeMacro(["host", "type", "uid"], ["options"], function(r, a, s, o) {
                        var l = i;
                        i = new n.Frame,
                        o = o || {},
                        o.hasOwnProperty("caller") && i.set("caller", o.caller),
                        i.set("host", r),
                        i.set("type", a),
                        i.set("uid", s),
                        i.set("options", o.hasOwnProperty("options") ? o.options : {});
                        var u = "";
                        u += "\n    ";
                        var h;
                        if (h = r + "/requests/new?type=report_abuse&utm_campaign=report_abuse&utm_source=website&" + a + "=" + s,
                        i.set("link", h, !0),
                        i.topLevel && e.setVariable("link", h),
                        i.topLevel && e.addExport("link", h),
                        u += "\n\n    ",
                        n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "subject")) {
                            u += "\n        ";
                            var c;
                            c = "&report_string=" + t.getFilter("urlencode").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "subject")),
                            i.set("label", c, !0),
                            i.topLevel && e.setVariable("label", c),
                            i.topLevel && e.addExport("label", c),
                            u += "\n    "
                        }
                        return u += '\n\n    <a href="',
                        u += n.suppressValue(n.contextOrFrameLookup(e, i, "link"), t.opts.autoescape),
                        u += n.suppressValue(n.contextOrFrameLookup(e, i, "label"), t.opts.autoescape),
                        u += '" class="report-link" target="_blank">\n        ',
                        u += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "text"), "Report abuse"), t.opts.autoescape),
                        u += "\n    </a>\n",
                        i = l,
                        new n.SafeString(u)
                    });
                    e.addExport("report_link"),
                    e.setVariable("report_link", l),
                    a += "\n",
                    s ? s.rootRenderFunc(t, e, i, n, r) : r(null, a)
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e, i) {
    "use strict";
    var n = function(t) {
        this.traversalMask = -1,
        this.nodeMaskOverride = 0,
        this.traversalMode = t,
        void 0 === t && (this.traversalMode = n.TRAVERSE_ALL_CHILDREN),
        this.nodePath = [],
        this.visitorType = n.NODE_VISITOR,
        this._databaseRequestHandler = void 0,
        this._frameStamp = void 0,
        this.traverse = n._traversalFunctions[this.traversalMode],
        this.pushOntoNodePath = n._pushOntoNodePath[this.traversalMode],
        this.popFromNodePath = n._popFromNodePath[this.traversalMode]
    };
    n.TRAVERSE_PARENTS = 1,
    n.TRAVERSE_ALL_CHILDREN = 2,
    n.TRAVERSE_ACTIVE_CHILDREN = 3,
    n.NODE_VISITOR = 0,
    n.UPDATE_VISITOR = 1,
    n.CULL_VISITOR = 2;
    var r = function(t) {
        t.ascend(this)
    }
      , a = function(t) {
        t.traverse(this)
    };
    n._traversalFunctions = [void 0, r, a, a];
    var s = function(t) {
        this.nodePath.unshift(t)
    }
      , o = function(t) {
        this.nodePath.push(t)
    };
    n._pushOntoNodePath = [void 0, s, o, o];
    var l = function() {
        return this.nodePath.shift()
    }
      , u = function() {
        this.nodePath.pop()
    };
    n._popFromNodePath = [void 0, l, u, u],
    n.prototype = {
        reset: function() {
            this.nodePath.length = 0
        },
        setFrameStamp: function(t) {
            this._frameStamp = t
        },
        getFrameStamp: function() {
            return this._frameStamp
        },
        setNodeMaskOverride: function(t) {
            this.nodeMaskOverride = t
        },
        getNodeMaskOverride: function() {
            return this.nodeMaskOverride
        },
        setTraversalMask: function(t) {
            this.traversalMask = t
        },
        getTraversalMask: function() {
            return this.traversalMask
        },
        getNodePath: function() {
            return this.nodePath
        },
        pushOntoNodePath: function(t) {
            n._pushOntoNodePath[this.traversalMode].call(this, t)
        },
        popFromNodePath: function() {
            n._popFromNodePath[this.traversalMode].call(this)
        },
        validNodeMask: function(t) {
            var e = t.getNodeMask();
            return 0 != (this.traversalMask & (this.nodeMaskOverride | e))
        },
        apply: function(t) {
            this.traverse(t)
        },
        traverse: function(t) {
            n._traversalFunctions[this.traversalMode].call(this, t)
        },
        getVisitorType: function() {
            return this.visitorType
        },
        setDatabaseRequestHandler: function(t) {
            this._databaseRequestHandler = t
        },
        getDatabaseRequestHandler: function() {
            return this._databaseRequestHandler
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(85)
      , a = function() {
        r.call(this)
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getType: function() {
            return this.attributeType
        },
        getTypeMember: function() {
            return this.attributeType
        },
        apply: function() {},
        getHash: function() {
            return this.getTypeMember()
        }
    }), "osg", "StateAttribute"),
    a.OFF = 0,
    a.ON = 1,
    a.OVERRIDE = 2,
    a.PROTECTED = 4,
    a.INHERIT = 8,
    t.exports = a
}
, , function(t, e, i) {
    var n, r, a;
    /**
 * isMobile.js v0.4.1
 *
 * A simple library to detect Apple phones and tablets,
 * Android phones and tablets, other mobile devices (like blackberry, mini-opera and windows phone),
 * and any kind of seven inch device, via user agent sniffing.
 *
 * @author: Kai Mallea (kmallea@gmail.com)
 *
 * @license: http://creativecommons.org/publicdomain/zero/1.0/
 */
    !function(i) {
        var s = /(?=.*\bAndroid\b)(?=.*\bMobile\b)/i
          , o = /(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i
          , l = /(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i
          , u = new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i")
          , h = function(t, e) {
            return t.test(e)
        }
          , c = function(t) {
            var e = t || navigator.userAgent
              , i = e.split("[FBAN");
            if (void 0 !== i[1] && (e = i[0]),
            i = e.split("Twitter"),
            void 0 !== i[1] && (e = i[0]),
            this.apple = {
                phone: h(/iPhone/i, e),
                ipod: h(/iPod/i, e),
                tablet: !h(/iPhone/i, e) && h(/iPad/i, e),
                device: h(/iPhone/i, e) || h(/iPod/i, e) || h(/iPad/i, e)
            },
            this.amazon = {
                phone: h(o, e),
                tablet: !h(o, e) && h(l, e),
                device: h(o, e) || h(l, e)
            },
            this.android = {
                phone: h(o, e) || h(s, e),
                tablet: !h(o, e) && !h(s, e) && (h(l, e) || h(/Android/i, e)),
                device: h(o, e) || h(l, e) || h(s, e) || h(/Android/i, e)
            },
            this.windows = {
                phone: h(/Windows Phone/i, e),
                tablet: h(/(?=.*\bWindows\b)(?=.*\bARM\b)/i, e),
                device: h(/Windows Phone/i, e) || h(/(?=.*\bWindows\b)(?=.*\bARM\b)/i, e)
            },
            this.other = {
                blackberry: h(/BlackBerry/i, e),
                blackberry10: h(/BB10/i, e),
                opera: h(/Opera Mini/i, e),
                firefox: h(/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i, e),
                chrome: h(/(CriOS|Chrome)(?=.*\bMobile\b)/i, e),
                device: h(/BlackBerry/i, e) || h(/BB10/i, e) || h(/Opera Mini/i, e) || h(/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i, e) || h(/(CriOS|Chrome)(?=.*\bMobile\b)/i, e)
            },
            this.seven_inch = h(u, e),
            this.any = this.apple.device || this.android.device || this.windows.device || this.other.device || this.seven_inch,
            this.phone = this.apple.phone || this.android.phone || this.windows.phone,
            this.tablet = this.apple.tablet || this.android.tablet || this.windows.tablet,
            "undefined" == typeof window)
                return this
        }
          , d = function() {
            var t = new c;
            return t.Class = c,
            t
        };
        void 0 !== t && t.exports && "undefined" == typeof window ? t.exports = c : void 0 !== t && t.exports && "undefined" != typeof window ? t.exports = d() : (r = [],
        n = i.isMobile = d(),
        void 0 !== (a = "function" == typeof n ? n.apply(e, r) : n) && (t.exports = a))
    }(this)
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    function(t) {
        this._views = [],
        t && (this._name = t.FeatureName,
        this._modelName = t.ModelName,
        this._modelType = t.ModelType,
        this._viewListType = t.ViewListType.slice(0))
    }
    );
    r.prototype = {
        getName: function() {
            return this._name
        },
        getModel: function() {
            return this._model
        },
        addView: function(t) {
            t && this._views.push(t)
        },
        init: function(t) {
            if (this._model || (this._model = t.getModelByName(this._modelName)),
            !this._model) {
                var e = this._modelType;
                this._model = new e,
                this._model.init && this._model.init(t)
            }
            var i = function(e) {
                var i = new e({
                    model: this._model,
                    context: t
                });
                this.addView(i)
            };
            this._viewListType.forEach(function(t) {
                i.call(this, t)
            }, this),
            t.addFeature(this)
        },
        prepareForScreenShot: function() {
            var t = this.getWidgetNode();
            return !(!t || !t.getNodeMask()) && (this._oldMaskEditorWidget = t.getNodeMask(),
            t.setNodeMask(0),
            !0)
        },
        resetAfterScreenShot: function() {
            var t = this.getWidgetNode();
            t && t.setNodeMask(this._oldMaskEditorWidget)
        },
        getWidgetNode: function() {}
    },
    r.create = function(t) {
        var e = function() {
            r.call(this, e)
        };
        return e.prototype = i.i(n.extend)({}, r.prototype),
        i.i(n.extend)(e, t),
        e.getName = function() {
            return t.FeatureName
        }
        ,
        e
    }
    ,
    e.a = r
}
, function(t, e, i) {
    "use strict";
    var n = {};
    n.PICK_GEOMETRY_FIXED = 1,
    n.PICK_GEOMETRY_ANIMATED = 2,
    n.PICK_GEOMETRY_RIG_BOX = 4,
    n.PICK_GIZMO_LIGHT = 8,
    n.SHADOW_CAST = 16,
    n.SHADOW_BOUNDS = 32,
    n.PICK_GEOMETRY_SLOW = n.PICK_GEOMETRY_FIXED | n.PICK_GEOMETRY_ANIMATED,
    n.PICK_GEOMETRY_FAST = n.PICK_GEOMETRY_FIXED | n.PICK_GEOMETRY_RIG_BOX,
    n.PICK_GEOMETRY = n.PICK_GEOMETRY_FIXED | n.PICK_GEOMETRY_ANIMATED | n.PICK_GEOMETRY_RIG_BOX,
    n.PICK = n.PICK_GEOMETRY | n.PICK_GIZMO_LIGHT,
    n.SHADOW = n.SHADOW_BOUNDS | n.SHADOW_CAST,
    n.PICK_GEOMETRY_SHADOW = n.PICK_GEOMETRY | n.SHADOW,
    n.NO_SHADOW = ~n.SHADOW,
    n.NO_PICK = ~n.PICK,
    n.NO_PICK_NO_SHADOW_CAST = ~(n.PICK | n.SHADOW_CAST),
    n.NO_PICK_NO_SHADOW_BOUNDS = ~(n.PICK | n.SHADOW_BOUNDS),
    n.NO_PICK_NO_SHADOW = ~(n.PICK | n.SHADOW),
    e.a = n
}
, , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = function(t) {
        this._data = void 0,
        this._transpose = !1,
        this._glCall = "",
        this._cache = void 0,
        this._name = t,
        this._type = void 0,
        this._isMatrix = !1
    };
    r.isUniform = function(t) {
        return "object" == typeof t && window.Object.getPrototypeOf(t) === r.prototype
    }
    ,
    r.prototype = {
        getName: function() {
            return this._name
        },
        getType: function() {
            return this._type
        },
        apply: function(t, e) {
            this._cache || (this._cache = t[this._glCall]),
            this._isMatrix ? this._cache.call(t, e, this._transpose, this._data) : this._cache.call(t, e, this._data)
        },
        setInternalArray: function(t) {
            n.warn("setInternalArray deprecated, please use getInternalArray instead: " + t.length),
            this._data = t
        },
        getInternalArray: function() {
            return this._data
        },
        setFloat: function(t) {
            this._data[0] = t
        },
        setFloat1: function(t) {
            this._data[0] = t[0]
        },
        setFloat2: function(t) {
            this._data[0] = t[0],
            this._data[1] = t[1]
        },
        setFloat3: function(t) {
            this._data[0] = t[0],
            this._data[1] = t[1],
            this._data[2] = t[2]
        },
        setFloat4: function(t) {
            this._data[0] = t[0],
            this._data[1] = t[1],
            this._data[2] = t[2],
            this._data[3] = t[3]
        },
        setFloat9: function(t) {
            this._data[0] = t[0],
            this._data[1] = t[1],
            this._data[2] = t[2],
            this._data[3] = t[3],
            this._data[4] = t[4],
            this._data[5] = t[5],
            this._data[6] = t[6],
            this._data[7] = t[7],
            this._data[8] = t[8]
        },
        setFloat16: function(t) {
            this._data[0] = t[0],
            this._data[1] = t[1],
            this._data[2] = t[2],
            this._data[3] = t[3],
            this._data[4] = t[4],
            this._data[5] = t[5],
            this._data[6] = t[6],
            this._data[7] = t[7],
            this._data[8] = t[8],
            this._data[9] = t[9],
            this._data[10] = t[10],
            this._data[11] = t[11],
            this._data[12] = t[12],
            this._data[13] = t[13],
            this._data[14] = t[14],
            this._data[15] = t[15]
        }
    },
    r.prototype.setVec2 = r.prototype.setFloat2,
    r.prototype.setVec3 = r.prototype.setFloat3,
    r.prototype.setVec4 = r.prototype.setFloat4,
    r.prototype.setMatrix4 = r.prototype.setFloat16,
    r.prototype.setMatrix3 = r.prototype.setFloat9,
    r.prototype.setInt = r.prototype.setFloat,
    r.prototype.setInt1 = r.prototype.setFloat1,
    r.prototype.setInt2 = r.prototype.setFloat2,
    r.prototype.setInt3 = r.prototype.setFloat3,
    r.prototype.setInt4 = r.prototype.setFloat4;
    var a = function(t, e, i, n, a, s) {
        var o = e && e.length ? t : void 0
          , l = new r(void 0 !== o ? e : t);
        if (l._data = i,
        void 0 !== o)
            if (o.length)
                for (var u = 0, h = o.length; u < h; ++u)
                    l._data[u] = o[u];
            else
                l._data[0] = o;
        return l._glCall = n,
        l._type = a,
        l._isMatrix = !!s,
        l
    }
      , s = function(t) {
        for (var e = new Float32Array(4 * t), i = 0; i < e.length; i += 4)
            e[i] = e[i + 3] = 1;
        return e
    }
      , o = function(t) {
        for (var e = new Float32Array(9 * t), i = 0; i < e.length; i += 9)
            e[i] = e[i + 4] = e[i + 8] = 1;
        return e
    }
      , l = function(t) {
        for (var e = new Float32Array(16 * t), i = 0; i < e.length; i += 16)
            e[i] = e[i + 5] = e[i + 10] = e[i + 15] = 1;
        return e
    }
      , u = function(t, e, i) {
        return i && !i.length ? i : "string" != typeof e ? (e.length || 1) / t : 1
    };
    r.createFloat1 = function(t, e) {
        return a(t, e, new Float32Array(1 * u(1, t, e)), "uniform1fv", "float")
    }
    ,
    r.createFloat2 = function(t, e) {
        return a(t, e, new Float32Array(2 * u(2, t, e)), "uniform2fv", "vec2")
    }
    ,
    r.createFloat3 = function(t, e) {
        return a(t, e, new Float32Array(3 * u(3, t, e)), "uniform3fv", "vec3")
    }
    ,
    r.createFloat4 = function(t, e) {
        return a(t, e, new Float32Array(4 * u(4, t, e)), "uniform4fv", "vec4")
    }
    ,
    r.createInt1 = function(t, e) {
        return a(t, e, new Int32Array(1 * u(1, t, e)), "uniform1iv", "int")
    }
    ,
    r.createInt2 = function(t, e) {
        return a(t, e, new Int32Array(2 * u(2, t, e)), "uniform2iv", "vec2i")
    }
    ,
    r.createInt3 = function(t, e) {
        return a(t, e, new Int32Array(3 * u(3, t, e)), "uniform3iv", "vec3i")
    }
    ,
    r.createInt4 = function(t, e) {
        return a(t, e, new Int32Array(4 * u(4, t, e)), "uniform4iv", "vec4i")
    }
    ,
    r.createMatrix2 = function(t, e) {
        return a(t, e, s(u(4, t, e)), "uniformMatrix2fv", "mat2", !0)
    }
    ,
    r.createMatrix3 = function(t, e) {
        return a(t, e, o(u(9, t, e)), "uniformMatrix3fv", "mat3", !0)
    }
    ,
    r.createMatrix4 = function(t, e) {
        return a(t, e, l(u(16, t, e)), "uniformMatrix4fv", "mat4", !0)
    }
    ,
    r.float = r.createFloatArray = r.createFloat = r.createFloat1,
    r.vec2 = r.createFloat2Array = r.createFloat2,
    r.vec3 = r.createFloat3Array = r.createFloat3,
    r.vec4 = r.createFloat4Array = r.createFloat4,
    r.int = r.createIntArray = r.createInt = r.createInt1,
    r.vec2i = r.createInt2Array = r.createInt2,
    r.vec3i = r.createInt3Array = r.createInt3,
    r.vec4i = r.createInt4Array = r.createInt4,
    r.mat2 = r.createMat2Array = r.createMat2 = r.createMatrix2,
    r.mat3 = r.createMat3Array = r.createMat3 = r.createMatrix3,
    r.mat4 = r.createMat4Array = r.createMat4 = r.createMatrix4,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(6)
      , r = i(1)
      , a = (i.n(r),
    i(2))
      , s = i.n(a)
      , o = i(9)
      , l = i(88)
      , u = i(127);
    i.n(u);
    e.a = n.a.extend({
        parent: "body",
        events: {
            'click [data-action="close"]': "onClickClose"
        },
        className: "flashmessage-container notification",
        template: function() {
            return o.default.getFromMacro("skfb_front/macros/notification", "flashmessage", [this.options.class, this.options.content, {
                safecontent: "True"
            }])
        },
        initialize: function() {
            n.a.prototype.initialize.apply(this, arguments),
            this.render(),
            this.options.delay && this.close(this.options.delay)
        },
        render: function() {
            this.$el.html(i.i(r.result)(this, "template")),
            s()(i.i(r.result)(this, "parent")).append(this.$el),
            this.$el.addClass("hidden"),
            i.i(r.defer)(this.$el.removeClass.bind(this.$el, "hidden"))
        },
        onClickClose: function(t) {
            t && t.preventDefault && t.preventDefault(),
            this.close(0)
        },
        close: function(t) {
            return t = t || 0,
            setTimeout(function() {
                this.$el.addClass("hidden"),
                i.i(l.a)(this.$el, function() {
                    this.$el.parent()[0].removeChild(this.el)
                }
                .bind(this))
            }
            .bind(this), t),
            this
        }
    })
}
, , , function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = function() {
        this._name = void 0,
        this._userdata = void 0,
        this._instanceID = r.getInstanceID()
    };
    r.prototype = n.objectLibraryClass({
        cloneType: function() {
            return new (0,
            this.constructor)
        },
        getInstanceID: function() {
            return this._instanceID
        },
        setName: function(t) {
            this._name = t
        },
        getName: function() {
            return this._name
        },
        setUserData: function(t) {
            this._userdata = t
        },
        getUserData: function() {
            return this._userdata
        }
    }, "osg", "Object");
    var a = 0;
    r.getInstanceID = function() {
        return a += 1
    }
    ,
    t.exports = r
}
, , function(t, e, i) {
    "use strict";
    var n = {};
    n.OPAQUE_BIN = 0,
    n.BACKGROUND = 1,
    n.TRANSPARENT_BIN_NO_EARLYZ_PRE = 9,
    n.TRANSPARENT_BIN = 10,
    n.TRANSPARENT_BIN_NO_EARLYZ_POST = 11,
    n.EXTRA = 19,
    n.EDITOR_GIZMO = n.HOTSPOT = 20,
    n.GRID = n.TOOLTIP = n.VR_MENU = 21,
    n.WIREFRAME = n.VR_CURSOR = 22,
    n.OUTLINE = 23,
    n.DEBUG = 24,
    n.DEBUG_2 = 25,
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(1)
      , s = (i.n(a),
    i.i(a.find)({
        WebkitTransition: "webkitTransitionEnd",
        MozTransition: "transitionend",
        OTransition: "oTransitionEnd otransitionend",
        transition: "transitionend"
    }, function(t, e) {
        return e in document.body.style
    }));
    e.a = function(t, e) {
        setTimeout(function() {
            r()(t).one(s, e)
        })
    }
}
, function(t, e, i) {
    "use strict";
    Object.defineProperty(e, "__esModule", {
        value: !0
    });
    var n = i(7)
      , r = i.n(n)
      , a = i(4)
      , s = i(1)
      , o = (i.n(s),
    i(924))
      , l = i(551)
      , u = i(918)
      , h = i(568)
      , c = i(917)
      , d = i(168)
      , p = i(923)
      , f = i(385)
      , g = i(329)
      , m = i(1007)
      , v = i(914)
      , _ = i(907)
      , b = a.a.osg
      , x = function(t) {
        t = this.computeURL(t);
        var e = new b.Image;
        return e.setURL(t),
        r.a.resolve(e)
    }
      , y = []
      , S = function(t) {
        return function() {
            var e = this.getJSON()
              , i = e.UniqueID
              , n = new b.BufferArray(b.BufferArray[e.Type]);
            n.setItemSize(e.ItemSize),
            n.setElements(y);
            var a = n.getInstanceID();
            if (t[a] = {},
            e.Array) {
                var s = Object.keys(e.Array)[0]
                  , o = e.Array[s];
                o.Elements ? t[a].inlined = o.Elements : (t[a].vb = o,
                t[a].type = s)
            } else
                t[a].inlined = e.Elements;
            var l = r.a.defer();
            return void 0 !== i && (this._identifierMap[i] = l.promise),
            l.resolve(n),
            l.promise
        }
    }
      , w = function(t) {
        return function(e, i) {
            return e = i.currentAnimationUID ? i.currentAnimationUID : this.computeURL(e),
            t.getBinaryArray(e, i).getPromise()
        }
    }
      , C = function(t, e) {
        this.resource = t,
        this.promise = e
    }
      , M = function(t) {
        if (!t) {
            if (M.instance)
                return M.instance;
            M.instance = this
        }
        return this._maps = {},
        this._resourceLoader = new o.a,
        this
    };
    M.Entry = C,
    M.prototype = {
        setModelUID: function(t) {
            this._modelUID = t
        },
        setStateContextOSG: function(t) {
            this._state = t
        },
        getInstance: function() {
            return M.instance
        },
        register: function(t, e) {
            this._maps[t] = e
        },
        exist: function(t) {
            return this._maps[t]
        },
        hashTextureOptions: function(t) {
            for (var e = "", i = l.a.getValidOptions(), n = i.length, r = 0; r < n; ++r)
                e += t[i[r]];
            return e
        },
        getOrCreateAnimationCollection: function() {
            var t = "animationCollection"
              , e = this.exist(t);
            if (e)
                return e;
            var i = new _.a([],{
                filters: new v.a({
                    modelUID: this._modelUID
                })
            });
            return e = new C(i,r.a.resolve(i.fetch())),
            this.register(t, e),
            e
        },
        getOrCreateHotspotCollection: function() {
            var t = "hotspotCollection"
              , e = this.exist(t);
            if (e)
                return e;
            var i = new d.a([],{
                filters: new c.a({
                    modelUID: this._modelUID
                })
            });
            return e = new C(i,r.a.resolve(i.fetch())),
            this.register(t, e),
            e
        },
        getOrCreateImageCollection: function() {
            var t = "imageCollection"
              , e = this.exist(t);
            if (e)
                return e;
            var i = new h.default([],{
                filters: new u.a({
                    modelUID: this._modelUID
                })
            });
            return e = new C(i,r.a.resolve(i.fetch())),
            this.register(t, e),
            e.promise.then(function() {
                i.forEach(function(t) {
                    0 === t.getImages().length && i.remove(t)
                })
            }),
            e
        },
        getOrCreateTextureProxy: function(t, e) {
            var i = this.hashTextureOptions(e)
              , n = [t, i].join("")
              , a = this.exist(n);
            if (a)
                return a;
            var s = this.getOrCreateImageCollection();
            if (s && s.resource) {
                var o = s.resource.get(t);
                if (o) {
                    var u = new g.a;
                    return l.a.setOptions(e, u),
                    u.setImageProxy(o),
                    a = new C(u,r.a.resolve(u)),
                    this.register(n, a),
                    a
                }
            }
        },
        getOrCreateImage: function(t, e) {
            var i = this._resourceLoader.getImage(t, e)
              , n = i.getPromise()
              , r = ["image", t].join("")
              , a = this.exist(r);
            return a || (a = new C(null,n),
            n.then(function(t) {
                a.image = t
            }),
            this.register(r, a),
            a)
        },
        getOrCreateTexture: function(t, e) {
            var i = function(t) {
                !this._state || t._textureObject && !t.isDirty() || this._state.applyTextureAttribute(0, t)
            }
            .bind(this)
              , n = l.a.createValidOptions(e)
              , a = this.hashTextureOptions(n)
              , s = [t, a].join("")
              , o = this.exist(s)
              , u = !!(e && e.transferToGPU && this._state);
            if (o)
                return u && (o.promise.isFulfilled() ? i(o.texture) : o._bindToGPU = !0),
                o;
            n.cubemap = e && e.cubemap;
            var h = n.cubemap ? new m.a : new g.a;
            h.setTextureSize(1, 1),
            l.a.setOptions(n, h),
            e && void 0 !== e.convertNPOT && (h._convertNPOT = e.convertNPOT);
            var c = this._resourceLoader.getImage(t, e)
              , d = c.getPromise()
              , p = r.a.defer()
              , f = p.promise;
            o = new C(h,f),
            o.texture = h,
            o._bindToGPU = u;
            var v = this;
            return d.then(function(t) {
                if (n.cubemap)
                    for (var e = 0; e < 6; e++) {
                        var r = b.Texture.TEXTURE_CUBE_MAP_POSITIVE_X + e;
                        h.setImage(r, t[r], "RGBA")
                    }
                else
                    h.setImage(t);
                h.dirty(),
                o._bindToGPU && i(h),
                p.resolve(h)
            }).catch(function() {
                v.register(s, void 0),
                p.reject(h)
            }).done(),
            this.register(s, o),
            o
        },
        getOrCreateModel: function(t, e) {
            var n = t
              , a = this.exist(n);
            if (a)
                return a;
            var o = e && e.node ? e.node : new b.Node
              , l = {};
            l.readImageURL = x,
            l.readBinaryArrayURL = w(this._resourceLoader),
            l.bufferMap = {},
            l.readBufferArray = S(l.bufferMap);
            var u = i.i(s.extend)({}, l, e);
            b.time("Download " + t.split("/").pop() + " (Async)");
            var h = this._resourceLoader.getModel(t, u)
              , c = h.getPromise()
              , d = r.a.defer()
              , p = d.promise;
            a = new C(o,p),
            a.node = o;
            var f = r.a.defer();
            a.texturesReadyToload = f.promise;
            var g = t.split("/");
            g.length = g.length - 1,
            g.length <= 0 && b.error("getOrCreateModel: can't find prefix to load subdata");
            var m = g.join("/") + "/";
            return u.prefixURL = m,
            this._loadModel(c, t, u, d, o, f),
            this.register(n, a),
            a
        },
        _loadModel: function(t, e, i, n, r, a) {
            var s = function(t) {
                b.error("getOrCreateModel error : " + t),
                b.error(t.stack)
            }
              , o = e.split("/").pop();
            t.then(function(t) {
                b.timeEnd("Download " + o + " (Async)"),
                b.time("JSONparse " + o);
                var e = JSON.parse(t);
                return b.timeEnd("JSONparse " + o),
                b.time("parseSceneGraph " + o + " (Async)"),
                f.a.parse(e, i, n.promise)
            }).then(function(t) {
                b.timeEnd("parseSceneGraph " + o + " (Async)"),
                b.time("DownloadAndLoadBuffer " + o + " (Async)");
                var e = p.a.postParse(t, this._resourceLoader, i);
                a.resolve(),
                e.then(function() {
                    b.timeEnd("DownloadAndLoadBuffer " + o + " (Async)"),
                    r.addChild(t),
                    n.resolve(r)
                }).catch(s)
            }
            .bind(this)).catch(s)
        },
        run: function() {
            this._resourceLoader.run()
        }
    },
    new M,
    e.default = M
}
, function(t, e, i) {
    "use strict";
    var n = !1
      , r = function(t) {
        return void 0 !== t && (n = t),
        n
    };
    e.a = r
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n);
    e.a = {
        while: function(t, e) {
            return new r.a(function(i, n) {
                var a = function(s) {
                    return t() ? r.a.cast(e()).then(a).catch(n) : i(s)
                };
                setTimeout(a, 0)
            }
            ).cancellable()
        }
    }
}
, , function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(13)
      , a = i(66)
      , s = i(81)
      , o = i(431)
      , l = i(409)
      , u = i(848)
      , h = i(326)
      , c = window.ImageBitmap || function() {}
      , d = function(t) {
        return 0 !== t && (t & 1 + ~t) === t
    }
      , p = function() {
        a.call(this),
        l.call(this),
        this.setDefaultParameters(),
        this._dirty = !0,
        this._dirtyMipmap = !0,
        this._applyTexImage2DCallbacks = [],
        this._textureObject = void 0,
        this._textureNull = !0
    }
      , f = function(t, e) {
        var i = p[t];
        return void 0 === i ? (n.warn("bad Texture enum argument " + t + "\nfallback to " + e),
        e) : i
    };
    p.UNPACK_COLORSPACE_CONVERSION_WEBGL = 37443,
    p.UNPACK_FLIP_Y_WEBGL = 37440,
    p.BROWSER_DEFAULT_WEBGL = 37444,
    p.NONE = 0,
    p.DEPTH_COMPONENT = 6402,
    p.DEPTH_COMPONENT16 = 33189,
    p.DEPTH_STENCIL = 34041,
    p.DEPTH24_STENCIL8 = 35056,
    p.DEPTH_COMPONENT24 = 33190,
    p.DEPTH_COMPONENT32F = 36012,
    p.COMPRESSED_RGB_S3TC_DXT1_EXT = 33776,
    p.COMPRESSED_RGBA_S3TC_DXT1_EXT = 33777,
    p.COMPRESSED_RGBA_S3TC_DXT3_EXT = 33778,
    p.COMPRESSED_RGBA_S3TC_DXT5_EXT = 33779,
    p.COMPRESSED_RGB_ATC_WEBGL = 35986,
    p.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL = 35987,
    p.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL = 34798,
    p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG = 35840,
    p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG = 35841,
    p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG = 35842,
    p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG = 35843,
    p.COMPRESSED_RGB_ETC1_WEBGL = 36196,
    p.LINEAR = 9729,
    p.NEAREST = 9728,
    p.NEAREST_MIPMAP_NEAREST = 9984,
    p.LINEAR_MIPMAP_NEAREST = 9985,
    p.NEAREST_MIPMAP_LINEAR = 9986,
    p.LINEAR_MIPMAP_LINEAR = 9987,
    p.TEXTURE_MAX_ANISOTROPY_EXT = 34046,
    p.MAX_TEXTURE_MAX_ANISOTROPY_EXT = 34047,
    p.CLAMP_TO_EDGE = 33071,
    p.REPEAT = 10497,
    p.MIRRORED_REPEAT = 33648,
    p.TEXTURE_2D = 3553,
    p.TEXTURE_CUBE_MAP = 34067,
    p.TEXTURE_BINDING_CUBE_MAP = 34068,
    p.TEXTURE_CUBE_MAP_POSITIVE_X = 34069,
    p.TEXTURE_CUBE_MAP_NEGATIVE_X = 34070,
    p.TEXTURE_CUBE_MAP_POSITIVE_Y = 34071,
    p.TEXTURE_CUBE_MAP_NEGATIVE_Y = 34072,
    p.TEXTURE_CUBE_MAP_POSITIVE_Z = 34073,
    p.TEXTURE_CUBE_MAP_NEGATIVE_Z = 34074,
    p.MAX_CUBE_MAP_TEXTURE_SIZE = 34076,
    p.UNSIGNED_BYTE = 5121,
    p.UNSIGNED_SHORT = 5123,
    p.UNSIGNED_SHORT_4_4_4_4 = 32819,
    p.UNSIGNED_SHORT_5_5_5_1 = 32820,
    p.UNSIGNED_SHORT_5_6_5 = 33635,
    p.FLOAT = 5126,
    p.HALF_FLOAT_OES = 36193,
    p.HALF_FLOAT = 5131,
    p.UNSIGNED_INT_10F_11F_11F_REV = 35899,
    p.UNSIGNED_INT_24_8 = 34042,
    p.ALPHA = 6406,
    p.RGB = 6407,
    p.RGBA = 6408,
    p.LUMINANCE = 6409,
    p.LUMINANCE_ALPHA = 6410,
    p.RED_INTEGER = 36244,
    p.RGB_INTEGER = 36248,
    p.RGBA_INTEGER = 36249,
    p.RG_INTEGER = 33320,
    p.RED = 6403,
    p.R8 = 33321,
    p.R8UI = 33330,
    p.RG8 = 33323,
    p.RG8UI = 33336,
    p.RGB8 = 36758,
    p.RGB565 = 36194,
    p.RGB9_E5 = 35901,
    p.RGB8UI = 36221,
    p.RGBA8 = 32856,
    p.RGB5_A1 = 32855,
    p.RGBA4 = 32854,
    p.RGBA8UI = 36220,
    p.SRGB8_ALPHA8 = 35907,
    p.SRGB8 = 35905,
    p.R16F = 33325,
    p.RG16F = 33327,
    p.RGB16F = 34843,
    p.RGBA16F = 34842,
    p.R11F_G11F_B10F = 35898,
    p.R32F = 33326,
    p.RG32F = 33328,
    p.RGB32F = 34837,
    p.RGBA32F = 34836;
    var g = function() {
        var t = {};
        return t[p.R8] = p.LUMINANCE,
        t[p.R8UI] = p.LUMINANCE,
        t[p.R16F] = p.LUMINANCE,
        t[p.R32F] = p.LUMINANCE,
        t[p.SRGB8] = p.LUMINANCE,
        t[p.RG8] = p.RGB,
        t[p.RG8UI] = p.RGB,
        t[p.RG16F] = p.RGB,
        t[p.RG32F] = p.RGB,
        t[p.RGB8] = p.RGB,
        t[p.RGB565] = p.RGB,
        t[p.RGB9_E5] = p.RGB,
        t[p.RGB8UI] = p.RGB,
        t[p.RGB5_A1] = p.RGB,
        t[p.RGB16F] = p.RGB,
        t[p.RGB32F] = p.RGB,
        t[p.RGBA8] = p.RGBA,
        t[p.R11F_G11F_B10F] = p.RGBA,
        t[p.RGBA16F] = p.RGBA,
        t[p.RGBA32F] = p.RGBA,
        t[p.SRGB8_ALPHA8] = p.RGBA,
        t
    }()
      , m = function() {
        var t = {}
          , e = {}
          , i = {}
          , n = {}
          , r = {}
          , a = {};
        return t[p.FLOAT] = e,
        t[p.HALF_FLOAT] = t[p.HALF_FLOAT_OES] = i,
        t[p.UNSIGNED_SHORT] = n,
        t[p.UNSIGNED_INT] = r,
        t[p.UNSIGNED_INT_24_8] = a,
        i[p.LUMINANCE] = p.R16F,
        i[p.RGB] = p.RGB16F,
        i[p.RGBA] = p.RGBA16F,
        e[p.LUMINANCE] = p.R32F,
        e[p.RGB] = p.RGB32F,
        e[p.RGBA] = p.RGBA32F,
        n[p.DEPTH_COMPONENT] = p.DEPTH_COMPONENT16,
        r[p.DEPTH_COMPONENT] = p.DEPTH_COMPONENT32F,
        a[p.DEPTH_STENCIL] = p.DEPTH24_STENCIL8,
        t
    }();
    p._sTextureManager = new window.Map,
    p.getTextureManager = function(t) {
        return p._sTextureManager.has(t) || p._sTextureManager.set(t, new u),
        p._sTextureManager.get(t)
    }
    ,
    p.getEnumFromString = function(t) {
        var e = t;
        return "string" == typeof e && (e = f(e, t)),
        e
    }
    ,
    p.prototype = r.objectLibraryClass(r.objectInherit(l.prototype, r.objectInherit(a.prototype, {
        attributeType: "Texture",
        cloneType: function() {
            return new p
        },
        dirty: function() {
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        },
        isTextureNull: function() {
            return this._textureNull
        },
        getOrCreateUniforms: function(t) {
            if (void 0 === p.uniforms && (p.uniforms = []),
            void 0 === p.uniforms[t]) {
                var e = this.getType() + t;
                p.uniforms[t] = {
                    texture: s.createInt1(t, e)
                }
            }
            return p.uniforms[t]
        },
        setDefaultParameters: function() {
            this._image = void 0,
            this._magFilter = p.LINEAR,
            this._minFilter = p.LINEAR,
            this._maxAnisotropy = 1,
            this._wrapS = p.CLAMP_TO_EDGE,
            this._wrapT = p.CLAMP_TO_EDGE,
            this._textureWidth = 0,
            this._textureHeight = 0,
            this._unrefImageDataAfterApply = !1,
            this._internalFormat = void 0,
            this._dirtyMipmap = !0,
            this._textureTarget = p.TEXTURE_2D,
            this._type = p.UNSIGNED_BYTE,
            this._isCompressed = !1,
            this._flipY = !0,
            this._colorSpaceConversion = p.NONE
        },
        setColorSpaceConversion: function(t) {
            this._colorSpaceConversion = t
        },
        setFlipY: function(t) {
            this._flipY = t
        },
        getTextureTarget: function() {
            return this._textureTarget
        },
        getTextureObject: function() {
            return this._textureObject
        },
        setTextureSize: function(t, e) {
            var i = h.instance().getWebGLParameter("MAX_TEXTURE_SIZE");
            t === this._textureWidth && e === this._textureHeight || this.dirty(),
            void 0 !== t && (t > i ? (n.error("width (" + t + ') too big for GPU. Max Texture Size is "' + i + '"'),
            this._textureWidth = i) : this._textureWidth = t),
            void 0 !== e && (e > i ? (n.error("height (" + e + ') too big for GPU. Max Texture Size is "' + i + '"'),
            this._textureHeight = i) : this._textureHeight = e),
            this._textureNull = !1
        },
        init: function(t) {
            this._gl || this.setGraphicContext(t.getGraphicContext()),
            this._textureObject || (this._textureObject = p.getTextureManager(this._gl).generateTextureObject(this._gl, this, this._textureTarget, this._internalFormat, this._textureWidth, this._textureHeight),
            this.dirty(),
            this._dirtyTextureObject = !1,
            this._textureNull = !1)
        },
        addApplyTexImage2DCallback: function(t) {
            this._applyTexImage2DCallbacks.indexOf(t) < 0 && this._applyTexImage2DCallbacks.push(t)
        },
        removeApplyTexImage2DCallback: function(t) {
            var e = this._applyTexImage2DCallbacks.indexOf(t);
            e >= 0 && this._applyTexImage2DCallbacks.splice(e, 1)
        },
        getWidth: function() {
            return this._textureWidth
        },
        getHeight: function() {
            return this._textureHeight
        },
        releaseGLObjects: function() {
            void 0 !== this._textureObject && null !== this._textureObject && void 0 !== this._gl && p.getTextureManager(this._gl).releaseTextureObject(this._textureObject),
            this._textureObject = void 0
        },
        getWrapT: function() {
            return this._wrapT
        },
        getWrapS: function() {
            return this._wrapS
        },
        setWrapS: function(t) {
            this._wrapS = "string" == typeof t ? f(t, p.CLAMP_TO_EDGE) : t,
            this.dirtyTextureParameters()
        },
        setWrapT: function(t) {
            this._wrapT = "string" == typeof t ? f(t, p.CLAMP_TO_EDGE) : t,
            this.dirtyTextureParameters()
        },
        dirtyTextureParameters: function() {
            this.dirty(),
            this.dirtyMipmap(),
            this.dirtyTextureObject()
        },
        dirtyTextureObject: function() {
            this._dirtyTextureObject = !0,
            this.dirtyMipmap(),
            this.dirty()
        },
        getMinFilter: function() {
            return this._minFilter
        },
        getMagFilter: function() {
            return this._magFilter
        },
        setMaxAnisotropy: function(t) {
            this._maxAnisotropy = t,
            this.dirtyTextureParameters()
        },
        getMaxAnisotropy: function() {
            return this._maxAnisotropy
        },
        setMinFilter: function(t) {
            this._minFilter = "string" == typeof t ? f(t, p.LINEAR) : t,
            this.dirtyTextureParameters()
        },
        setMagFilter: function(t) {
            this._magFilter = "string" == typeof t ? f(t, p.LINEAR) : t,
            this.dirtyTextureParameters()
        },
        setImage: function(t, e) {
            var i = t;
            (t instanceof window.Image || t instanceof HTMLCanvasElement || t instanceof c || t instanceof Uint8Array) && (i = new o(t)),
            this._image = i,
            this.setImageFormat(e),
            i && (i.getWidth && i.getHeight ? this.setTextureSize(i.getWidth(), i.getHeight()) : i.width && i.height && this.setTextureSize(i.width, i.height)),
            this._textureNull = !1,
            this.dirty()
        },
        getImage: function() {
            return this._image
        },
        setImageFormat: function(t) {
            var e = t;
            e ? ("string" == typeof e && (e = p[e]),
            this._imageFormat = e) : this._imageFormat = p.RGBA
        },
        setInternalFormatType: function(t) {
            this._type = "string" == typeof t ? p[t] : t
        },
        getInternalFormatType: function() {
            return this._type
        },
        setUnrefImageDataAfterApply: function(t) {
            this._unrefImageDataAfterApply = t
        },
        checkIsCompressed: function(t) {
            switch (t || this._internalFormat) {
            case p.COMPRESSED_RGB_S3TC_DXT1_EXT:
            case p.COMPRESSED_RGBA_S3TC_DXT1_EXT:
            case p.COMPRESSED_RGBA_S3TC_DXT3_EXT:
            case p.COMPRESSED_RGBA_S3TC_DXT5_EXT:
            case p.COMPRESSED_RGB_ATC_WEBGL:
            case p.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:
            case p.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:
            case p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:
            case p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:
            case p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:
            case p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:
            case p.COMPRESSED_RGB_ETC1_WEBGL:
                return !0;
            default:
                return !1
            }
        },
        setInternalFormat: function(t) {
            var e = t;
            e ? ("string" == typeof e && (e = p[e]),
            this._isCompressed = this.checkIsCompressed(e)) : (this._isCompressed = !1,
            e = p.RGBA),
            this._internalFormat = e
        },
        getInternalFormat: function() {
            return this._internalFormat
        },
        isDirtyMipmap: function() {
            return this._dirtyMipmap
        },
        dirtyMipmap: function() {
            this._dirtyMipmap = !0
        },
        applyFilterParameter: function(t, e) {
            if (d(this._textureWidth) && d(this._textureHeight) || (this._wrapT = p.CLAMP_TO_EDGE,
            this._wrapS = p.CLAMP_TO_EDGE,
            this._minFilter !== p.LINEAR_MIPMAP_LINEAR && this._minFilter !== p.LINEAR_MIPMAP_NEAREST || (this._minFilter = p.LINEAR)),
            t.texParameteri(e, t.TEXTURE_MAG_FILTER, this._magFilter),
            t.texParameteri(e, t.TEXTURE_MIN_FILTER, this._minFilter),
            this._maxAnisotropy > 1 && p.ANISOTROPIC_SUPPORT_EXT) {
                var i = this._maxAnisotropy < p.ANISOTROPIC_SUPPORT_MAX ? this._maxAnisotropy : p.ANISOTROPIC_SUPPORT_MAX;
                t.texParameterf(e, p.TEXTURE_MAX_ANISOTROPY_EXT, i)
            }
            t.texParameteri(e, t.TEXTURE_WRAP_S, this._wrapS),
            t.texParameteri(e, t.TEXTURE_WRAP_T, this._wrapT)
        },
        generateMipmap: function(t, e) {
            if (this._dirtyMipmap = !1,
            this.hasMipmapFilter()) {
                var i = this._image;
                if (i && i.hasMipmap())
                    for (var n = this._getInternalFormatGL(), r = i.getMipmap(), a = 1, s = r.length; a < s; a++) {
                        var o = r[a];
                        this._isCompressed ? this.applyTexImage2D(t, this._textureTarget, a, n, o.getWidth(), o.getHeight(), 0, o.getImage()) : this.applyTexImage2D(t, this._textureTarget, a, n, o.getWidth(), o.getHeight(), 0, this._internalFormat, this._type, o.getImage())
                    }
                else
                    t.generateMipmap(e)
            }
        },
        hasMipmapFilter: function() {
            return this._minFilter === p.NEAREST_MIPMAP_NEAREST || this._minFilter === p.LINEAR_MIPMAP_NEAREST || this._minFilter === p.NEAREST_MIPMAP_LINEAR || this._minFilter === p.LINEAR_MIPMAP_LINEAR
        },
        applyTexImage2D: function(t) {
            var e = Array.prototype.slice.call(arguments, 1);
            r.timeStamp("osgjs.metrics:Texture.texImage2d"),
            t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL, this._flipY),
            t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL, this._colorSpaceConversion),
            this._isCompressed ? t.compressedTexImage2D.apply(t, e) : t.texImage2D.apply(t, e);
            var i = this._applyTexImage2DCallbacks.length;
            if (i > 0)
                for (var n = 0, a = i; n < a; n++)
                    this._applyTexImage2DCallbacks[n].call(this)
        },
        computeTextureFormat: function() {
            this._internalFormat ? this._imageFormat = this._internalFormat : (this._internalFormat = this._imageFormat || p.RGBA,
            this._imageFormat = this._internalFormat)
        },
        applyImage: function(t) {
            var e = this._getInternalFormatGL()
              , i = this._image || null
              , n = i && this._image.getImage()
              , r = this._getTypeGL();
            this._isCompressed ? this.applyTexImage2D(t, this._textureTarget, 0, e, this._textureWidth, this._textureHeight, 0, n) : !n || i.isTypedArray() ? this.applyTexImage2D(t, this._textureTarget, 0, e, this._textureWidth, this._textureHeight, 0, this._internalFormat, r, n) : this.applyTexImage2D(t, this._textureTarget, 0, e, this._internalFormat, r, n),
            i && i.setDirty(!1)
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            if (this._dirtyTextureObject && (this.releaseGLObjects(),
            this._dirtyTextureObject = !1),
            void 0 === this._textureObject || this.isDirty())
                if (this._textureNull)
                    e.bindTexture(this._textureTarget, null);
                else {
                    var i = this._image;
                    if (void 0 !== i)
                        if (i.isReady()) {
                            this.computeTextureFormat();
                            var n = i.getWidth() || this._textureWidth
                              , r = i.getHeight() || this._textureHeight;
                            this.setTextureSize(n, r),
                            this._textureObject || this.init(t),
                            this._textureObject.bind(e),
                            this.applyImage(e),
                            this.applyFilterParameter(e, this._textureTarget),
                            this.generateMipmap(e, this._textureTarget),
                            this._unrefImageDataAfterApply && (this._image = void 0),
                            this._dirty = !1
                        } else
                            e.bindTexture(this._textureTarget, null);
                    else
                        0 !== this._textureHeight && 0 !== this._textureWidth && (this.computeTextureFormat(),
                        this._textureObject || this.init(t),
                        this._textureObject.bind(e),
                        this.applyImage(e),
                        this.applyFilterParameter(e, this._textureTarget),
                        this.generateMipmap(e, this._textureTarget),
                        this._dirty = !1)
                }
            else
                this._textureObject.bind(e),
                this.isDirtyMipmap() && this.generateMipmap(e, this._textureTarget),
                void 0 !== this._image && this._image.isDirty() && this.applyImage(e)
        },
        _getInternalFormatGL: function() {
            var t = this._internalFormat;
            if (!h.instance().isWebGL2())
                return g[t] || t;
            var e = m[this._type];
            return e && e[t] || t
        },
        _getTypeGL: function() {
            return this._type !== p.HALF_FLOAT || h.instance().isWebGL2() ? this._type : p.HALF_FLOAT_OES
        }
    })), "osg", "Texture"),
    r.setTypeID(p),
    p.textureNull = new p,
    p.createFromImage = function(t, e) {
        var i = new p;
        return i.setImage(t, e),
        i
    }
    ,
    p.createFromCanvas = function(t, e) {
        return p.createFromImage(t, e)
    }
    ,
    t.exports = p
}
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(t, e) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/notification.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = "";
                try {
                    var s = null;
                    a += "\n\n";
                    var o = n.makeMacro(["type", "content"], ["options"], function(r, a, s) {
                        var o = i;
                        i = new n.Frame,
                        s = s || {},
                        s.hasOwnProperty("caller") && i.set("caller", s.caller),
                        i.set("type", r),
                        i.set("content", a),
                        i.set("options", s.hasOwnProperty("options") ? s.options : {});
                        var l = "";
                        l += "\n\n    ";
                        var u;
                        return u = t.getFilter("merge").call(e, {
                            safecontent: !1
                        }, n.contextOrFrameLookup(e, i, "options")),
                        i.set("options", u, !0),
                        i.topLevel && e.setVariable("options", u),
                        i.topLevel && e.addExport("options", u),
                        l += '\n\n    <div class="flashmessage ',
                        l += n.suppressValue(r, t.opts.autoescape),
                        l += '">\n        <div class="inner">\n            <button class="flashmessage-close" data-action="close" title="Close"></button>\n            <div class="message">\n                ',
                        n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "safecontent") ? (l += "\n                    ",
                        l += n.suppressValue(t.getFilter("safe").call(e, a), t.opts.autoescape),
                        l += "\n                ") : (l += "\n                    ",
                        l += n.suppressValue(a, t.opts.autoescape),
                        l += "\n                "),
                        l += "\n            </div>\n        </div>\n    </div>\n\n",
                        i = o,
                        new n.SafeString(l)
                    });
                    e.addExport("flashmessage"),
                    e.setVariable("flashmessage", o),
                    a += "\n",
                    s ? s.rootRenderFunc(t, e, i, n, r) : r(null, a)
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(85)
      , a = i(353)
      , s = i(408)
      , o = i(287)
      , l = i(65)
      , u = i(5).mat4
      , h = i(410)
      , c = i(413)
      , d = i(144)
      , p = function() {
        r.call(this),
        this.children = [],
        this._parents = [],
        this.nodeMask = -1,
        this._boundingSphere = new s,
        this._boundingSphereComputed = !1,
        this._boundingBox = new a,
        this._boundingBoxComputed = !1,
        this._updateCallbacks = [],
        this._cullCallback = void 0,
        this._cullingActive = !0,
        this._numChildrenWithCullingDisabled = 0,
        this._numChildrenRequiringUpdateTraversal = 0,
        this._tmpBox = new a
    };
    p._reservedMatrixStack = new h;
    var f = function() {
        var t = p._reservedMatrixStack.get.bind(p._reservedMatrixStack);
        return u.identity(t)
    };
    p.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getOrCreateStateSet: function() {
            return this.stateset || this.setStateSet(new o),
            this.stateset
        },
        getStateSet: function() {
            return this.stateset
        },
        accept: function(t) {
            t.validNodeMask(this) && (t.pushOntoNodePath(this),
            t.apply(this),
            t.popFromNodePath())
        },
        dirtyBound: function() {
            if (!0 === this._boundingSphereComputed || !0 === this._boundingBoxComputed) {
                this._boundingSphereComputed = !1,
                this._boundingBoxComputed = !1;
                for (var t = this._parents, e = 0, i = t.length; e < i; e++)
                    t[e].dirtyBound()
            }
        },
        setNodeMask: function(t) {
            this.nodeMask = t
        },
        getNodeMask: function() {
            return this.nodeMask
        },
        setStateSet: function(t) {
            if (this.stateset !== t) {
                var e = 0;
                this.stateset && (this.stateset.requiresUpdateTraversal() && e--,
                this.stateset.removeParent(this)),
                t && (t.addParent(this),
                t.requiresUpdateTraversal() && ++e),
                0 !== e && this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal() + e),
                this.stateset = t
            }
        },
        _updateNumChildrenRequeringUpdateTraversal: function(t) {
            if (0 === this._numChildrenRequiringUpdateTraversal && this._parents.length)
                for (var e = 0, i = this._parents.length; e < i; e++) {
                    var n = this._parents[e]
                      , r = n.getNumChildrenRequiringUpdateTraversal();
                    n.setNumChildrenRequiringUpdateTraversal(r + t)
                }
        },
        setNumChildrenRequiringUpdateTraversal: function(t) {
            if (this._numChildrenRequiringUpdateTraversal !== t) {
                if (!this._updateCallbacks.length && this._parents.length) {
                    var e = 0;
                    if (this._numChildrenRequiringUpdateTraversal > 0 && --e,
                    t > 0 && ++e,
                    0 !== e)
                        for (var i = this._parents, n = 0, r = i.length; n < r; n++) {
                            var a = i[n]
                              , s = a.getNumChildrenRequiringUpdateTraversal();
                            a.setNumChildrenRequiringUpdateTraversal(s + e)
                        }
                }
                this._numChildrenRequiringUpdateTraversal = t
            }
        },
        getNumChildrenRequiringUpdateTraversal: function() {
            return this._numChildrenRequiringUpdateTraversal
        },
        getUpdateCallback: function() {
            return this._updateCallbacks[0]
        },
        addUpdateCallback: function(t) {
            var e = Boolean(this._updateCallbacks.length);
            this._updateCallbacks.push(t),
            e || this._updateNumChildrenRequeringUpdateTraversal(1)
        },
        removeUpdateCallback: function(t) {
            var e = this._updateCallbacks.indexOf(t);
            -1 !== e && (this._updateCallbacks.splice(e, 1),
            this._updateCallbacks.length || this._updateNumChildrenRequeringUpdateTraversal(-1))
        },
        getUpdateCallbackList: function() {
            return this._updateCallbacks
        },
        setCullCallback: function(t) {
            this._cullCallback = t
        },
        getCullCallback: function() {
            return this._cullCallback
        },
        hasChild: function(t) {
            for (var e = 0, i = this.children.length; e < i; e++)
                if (this.children[e] === t)
                    return !0;
            return !1
        },
        addChild: function(t) {
            if (-1 === this.children.indexOf(t))
                return this.children.push(t),
                t.addParent(this),
                this.dirtyBound(),
                (t.getNumChildrenRequiringUpdateTraversal() > 0 || t.getUpdateCallbackList().length) && this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal() + 1),
                t
        },
        getChildren: function() {
            return this.children
        },
        getNumChildren: function() {
            return this.children.length
        },
        getChild: function(t) {
            return this.children[t]
        },
        getParents: function() {
            return this._parents
        },
        addParent: function(t) {
            this._parents.push(t)
        },
        removeParent: function(t) {
            var e = this._parents.indexOf(t);
            -1 !== e && this._parents.splice(e, 1)
        },
        removeChildren: function() {
            var t = this.children
              , e = t.length;
            if (e) {
                for (var i = 0, n = 0; n < e; n++) {
                    var r = t[n];
                    r.removeParent(this),
                    (r.getNumChildrenRequiringUpdateTraversal() > 0 || r.getUpdateCallbackList().length) && ++i
                }
                t.length = 0,
                i && this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal() - i),
                this.dirtyBound()
            }
        },
        removeChild: function(t) {
            var e = this.children
              , i = e.indexOf(t);
            -1 !== i && (t.removeParent(this),
            e.splice(i, 1),
            (t.getNumChildrenRequiringUpdateTraversal() > 0 || t.getUpdateCallbackList().length) && this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal() - 1))
        },
        traverse: function(t) {
            for (var e = this.children, i = 0, n = e.length; i < n; i++) {
                e[i].accept(t)
            }
        },
        ascend: function(t) {
            for (var e = this._parents, i = 0, n = e.length; i < n; i++) {
                e[i].accept(t)
            }
        },
        getBoundingBox: function() {
            return this._boundingBoxComputed || (this.computeBoundingBox(this._boundingBox),
            this._boundingBoxComputed = !0),
            this._boundingBox
        },
        computeBoundingBox: function(t) {
            var e = i(456)
              , n = e.instance = e.instance || new e;
            return n.setNodeMaskOverride(-1),
            n.reset(),
            n.apply(this),
            t.copy(n.getBoundingBox()),
            t
        },
        getBoundingSphere: function() {
            return this.getBound()
        },
        getBound: function() {
            return this._boundingSphereComputed || (this.computeBoundingSphere(this._boundingSphere),
            this._boundingSphereComputed = !0),
            this._boundingSphere
        },
        computeBoundingSphere: function(t) {
            var e = this.children
              , i = e.length;
            if (t.init(),
            0 === i)
                return t;
            var n, r, a = this._tmpBox;
            for (a.init(),
            r = 0; r < i; r++)
                n = e[r],
                n.referenceFrame !== d.ABSOLUTE_RF && a.expandByBoundingSphere(n.getBound());
            if (!a.valid())
                return t;
            for (t.set(a.center(t.center()), 0),
            r = 0; r < i; r++)
                n = e[r],
                n.referenceFrame !== d.ABSOLUTE_RF && t.expandRadiusBySphere(n.getBound());
            return t
        },
        getWorldMatrices: function() {
            var t = function() {
                this.nodePaths = [],
                this.halt = void 0,
                l.call(this, l.TRAVERSE_PARENTS)
            };
            t.prototype = n.objectInherit(l.prototype, {
                reset: function() {
                    this.nodePath.length = 0,
                    this.nodePaths.length = 0
                },
                apply: function(t) {
                    0 === t._parents.length || t === this.halt || t.referenceFrame === d.ABSOLUTE_RF ? this.nodePaths.push(this.nodePath.slice(0)) : this.traverse(t)
                }
            });
            var e = new t;
            return e.setNodeMaskOverride(-1),
            function(t, i) {
                e.reset(),
                e.halt = t,
                this.accept(e);
                for (var n = [], r = i || u.create, a = 0, s = e.nodePaths.length; a < s; a++) {
                    var o = e.nodePaths[a]
                      , l = r();
                    0 !== o.length && c.computeLocalToWorld(o, !0, l),
                    n.push(l)
                }
                return n
            }
        }(),
        getWorldMatrix: function(t, e) {
            var i = this.getWorldMatrices(t, f);
            return 0 === i.length ? u.identity(e) : u.copy(e, i[0]),
            p._reservedMatrixStack.reset(),
            e
        },
        setCullingActive: function(t) {
            if (this._cullingActive !== t) {
                if (0 === this._numChildrenWithCullingDisabled && this._parents.length > 0) {
                    var e = 0;
                    if (this._cullingActive || --e,
                    t || ++e,
                    0 !== e)
                        for (var i = 0, n = this._parents.length; i < n; i++)
                            this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled() + e)
                }
                this._cullingActive = t
            }
        },
        getCullingActive: function() {
            return this._cullingActive
        },
        isCullingActive: function() {
            return 0 === this._numChildrenWithCullingDisabled && this._cullingActive && this.getBound().valid()
        },
        setNumChildrenWithCullingDisabled: function(t) {
            if (this._numChildrenWithCullingDisabled !== t) {
                if (this._cullingActive && this._parents.length > 0) {
                    var e = 0;
                    if (this._numChildrenWithCullingDisabled > 0 && --e,
                    t > 0 && ++e,
                    0 !== e)
                        for (var i = 0, n = this._parents.length; i < n; i++)
                            this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled() + e)
                }
                this._numChildrenWithCullingDisabled = t
            }
        },
        getNumChildrenWithCullingDisabled: function() {
            return this._numChildrenWithCullingDisabled
        },
        releaseGLObjects: function() {
            void 0 !== this.stateset && this.stateset.releaseGLObjects()
        }
    }), "osg", "Node"),
    n.setTypeID(p),
    t.exports = p
}
, , function(t, e, i) {
    i(19),
    function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/popups/message.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = "";
                try {
                    var s = null;
                    t.getTemplate("skfb_front/layouts/popup.jinja", !0, "skfb_front/popups/message.jinja", !1, function(o, l) {
                        if (o)
                            return void r(o);
                        s = l;
                        for (var u in s.blocks)
                            e.addBlock(u, s.blocks[u]);
                        a += "\n\n";
                        var h;
                        if (h = n.contextOrFrameLookup(e, i, "title"),
                        i.set("popupTitle", h, !0),
                        i.topLevel && e.setVariable("popupTitle", h),
                        i.topLevel && e.addExport("popupTitle", h),
                        a += "\n\n",
                        !n.contextOrFrameLookup(e, i, "popupClass")) {
                            a += "\n    ";
                            var c;
                            c = "popup-message",
                            i.set("popupClass", c, !0),
                            i.topLevel && e.setVariable("popupClass", c),
                            i.topLevel && e.addExport("popupClass", c),
                            a += "\n"
                        }
                        a += "\n\n",
                        (s ? function(t, e, i, n, r) {
                            r("")
                        }
                        : e.getBlock("popup_content"))(t, e, i, n, function(o, l) {
                            if (o)
                                return void r(o);
                            a += l,
                            a += "\n\n",
                            (s ? function(t, e, i, n, r) {
                                r("")
                            }
                            : e.getBlock("popup_footer"))(t, e, i, n, function(o, l) {
                                if (o)
                                    return void r(o);
                                a += l,
                                a += "\n",
                                s ? s.rootRenderFunc(t, e, i, n, r) : r(null, a)
                            })
                        })
                    })
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            function e(t, e, i, n, r) {
                var a = "";
                try {
                    var i = i.push(!0);
                    a += "\n\n    ",
                    n.contextOrFrameLookup(e, i, "safe") ? (a += "\n        ",
                    a += n.suppressValue(t.getFilter("safe").call(e, n.contextOrFrameLookup(e, i, "text")), t.opts.autoescape),
                    a += "\n    ") : (a += "\n        ",
                    a += n.suppressValue(n.contextOrFrameLookup(e, i, "text"), t.opts.autoescape),
                    a += "\n    "),
                    a += "\n\n",
                    r(null, a)
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            function i(t, e, i, n, r) {
                var a = "";
                try {
                    var i = i.push(!0);
                    a += '\n    <div class="actions">\n\n        ',
                    a += "\n        ",
                    a += "\n\n        ",
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "cancel") && (a += '\n            <button class="button btn-medium btn-tertiary cancel',
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "cancelClass") && (a += " ",
                    a += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "cancelClass"), t.opts.autoescape)),
                    a += '" type="reset">',
                    a += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "cancelLabel"), "Cancel"), t.opts.autoescape),
                    a += "</button>\n        "),
                    a += "\n\n        ",
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "close") && (a += '\n            <button class="button btn-medium btn-tertiary',
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "cancelClass") && (a += " ",
                    a += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "closeClass"), t.opts.autoescape)),
                    a += '" type="reset" data-action="close">',
                    a += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "closeLabel"), "Close"), t.opts.autoescape),
                    a += "</button>\n        "),
                    a += "\n\n        ",
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "continue") && (a += '\n            <button class="button btn-medium btn-primary submit',
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "continueClass") && (a += " ",
                    a += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "continueClass"), t.opts.autoescape)),
                    a += '" type="submit">',
                    a += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "continueLabel"), "Continue"), t.opts.autoescape),
                    a += "</button>\n        "),
                    a += "\n\n        ",
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "ok") && (a += '\n            <button class="button btn-medium btn-primary submit',
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "okClass") && (a += " ",
                    a += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "okClass"), t.opts.autoescape)),
                    a += '" type="submit">',
                    a += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "okLabel"), "OK"), t.opts.autoescape),
                    a += "</button>\n        "),
                    a += "\n\n        ",
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "delete") && (a += '\n            <button class="button btn-medium btn-danger submit',
                    n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "deleteClass") && (a += " ",
                    a += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "deleteClass"), t.opts.autoescape)),
                    a += '" type="submit">',
                    a += n.suppressValue(t.getFilter("default").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "buttons"), "deleteLabel"), "Delete"), t.opts.autoescape),
                    a += "</button>\n        "),
                    a += "\n\n    </div>\n",
                    r(null, a)
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            return {
                b_popup_content: e,
                b_popup_footer: i,
                root: t
            }
        }()
    }()
}
, , function(t, e, i) {
    "use strict";
    var n = i(297)
      , r = i.n(n)
      , a = i(278)
      , s = i.n(a)
      , o = new RegExp("(\\s+|')","g")
      , l = new RegExp("^([^\\w@]*)((?:.|\r|\n)*?)((?:[^\\w._-]|&gt;|&lt;|&amp|&quot)*)$")
      , u = new RegExp("^https?://")
      , h = new RegExp("^\\S+@[a-zA-Z0-9._-]+\\.[a-zA-Z0-9._-]+$")
      , c = new RegExp("(^www\\.)|(\\.(com|net|org)$)")
      , d = new RegExp("(@[a-zA-Z0-9._-]+)")
      , p = {};
    p.underscorify = function(t) {
        return t.replace(/([A-Z])/g, "_$1").toLowerCase()
    }
    ,
    p.slugify = function(t) {
        return t.replace(/[^\w\s-]+/g, "").trim().toLowerCase().replace(/[-\s]+/g, "-")
    }
    ,
    p.urlize = function(t, e, i, n) {
        var a = Array.prototype.slice.call(arguments, 0);
        if (a.length && a[a.length - 1].__keywords) {
            var s = a.pop()
              , p = a[1]
              , f = a[2]
              , g = a[3];
            e = p || s.trim_url_limit,
            i = f || s.nofollow,
            n = g || s.target
        }
        null == i && (i = !0);
        var m = function(t) {
            return t = t.replace(/^(https?:\/\/)?(www\.)?/, ""),
            null == e ? t : t.length <= e ? t : t.substr(0, e) + "..."
        };
        "string" == typeof t && (t = function(t) {
            return t.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")
        }(t));
        var v = t.split(o)
          , _ = ["noopener", "noreferrer"]
          , b = n ? ' target="' + n + '"' : "";
        return i && _.push("nofollow"),
        r.a.runtime.markSafe(v.map(function(t) {
            var e = t.match(l);
            if (null === e)
                return t;
            e = e.slice(1);
            var i = e[0]
              , n = e[1]
              , r = e[2]
              , a = _.join(" ");
            return n.match(u) ? i + '<a href="' + n + '" rel="' + a + '"' + b + ">" + m(n) + "</a>" + r : n.match(h) && -1 === n.indexOf(":") ? i + '<a href="mailto:' + n + '">' + n + "</a>" + r : n.match(c) ? i + '<a href="http://' + n + '" rel="' + a + '"' + b + ">" + m(n) + "</a>" + r : n.match(d) ? i + '<a href="https://' + window.location.host + "/" + n.substring(1) + '" rel="' + a + '">' + m(n) + "</a>" + r : t
        }).join(""))
    }
    ,
    p.stripTags = function(t) {
        return r.a.runtime.markSafe(s.a.sanitize(t, {
            ALLOWED_TAGS: []
        }))
    }
    ,
    p.paragraphy = function(t) {
        var e = t.match(/.+/g);
        return e ? r.a.runtime.markSafe(e.map(function(t) {
            return "<p>" + t + "</p>"
        }).join("")) : t
    }
    ,
    p.pluralize = function(t, e, i) {
        return void 0 === e && (e = ""),
        void 0 === i && (i = "s"),
        1 === t ? e : i
    }
    ,
    p.findWithDelimiters = function(t, e, i) {
        return t.split(e).pop().split(i)[0]
    }
    ,
    e.a = p
}
, , function(t, e, i) {
    "use strict";
    var n = {};
    n.POINTS = 0,
    n.LINES = 1,
    n.LINE_LOOP = 2,
    n.LINE_STRIP = 3,
    n.TRIANGLES = 4,
    n.TRIANGLE_STRIP = 5,
    n.TRIANGLE_FAN = 6,
    t.exports = n
}
, , , , function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(808)
      , a = i.n(r)
      , s = i(809)
      , o = i.n(s)
      , l = i(803)
      , u = i.n(l)
      , h = i(805)
      , c = i.n(h)
      , d = i(804)
      , p = i.n(d)
      , f = i(807)
      , g = i.n(f)
      , m = i(806)
      , v = i.n(m)
      , _ = i(802)
      , b = i.n(_)
      , x = n.a.osg
      , y = new n.a.osgShader.ShaderProcessor
      , S = {
        "sketchfabFunctions.glsl": a.a,
        "sketchfabTextures.glsl": o.a,
        "lightsPBR.glsl": c.a,
        "lightEnv.glsl": u.a,
        "lightPBREnv.glsl": p.a,
        "pbrUE4.glsl": g.a,
        "panoramaSampler.glsl": v.a,
        "cubemapSampler.glsl": b.a
    };
    y.addShaders(S);
    var w = function() {
        this._shaderCache = {}
    };
    w.prototype = {
        getShaderProcessor: function() {
            return y
        },
        getOrCreateShader: function(t, e, i, n, r) {
            var a = "";
            r && (a = r.toString());
            var s = i + a
              , o = this._shaderCache[s];
            return o || (o = this.createShader(t, e, i, n, r),
            this._shaderCache[s] = o),
            o
        },
        createShader: function(t, e, i, n, r) {
            var a = "#define SHADER_NAME " + n + "\n";
            if (r)
                if (Array.isArray(r))
                    for (var s = 0; s < r.length; s++)
                        a += "#define " + r[s] + "\n";
                else
                    a += "#define " + r + "\n";
            var o = {};
            return o[i + "-vert"] = a + t,
            o[i + "-frag"] = a + e,
            y.addShaders(o),
            new x.Program(new x.Shader(x.Shader.VERTEX_SHADER,y.getShader(i + "-vert")),new x.Shader(x.Shader.FRAGMENT_SHADER,y.getShader(i + "-frag")))
        }
    },
    e.a = new w
}
, function(t, e, i) {
    "use strict";
    var n, r = i(301), a = [{
        type: "VERTEX_SHADER",
        text: ["attribute vec3 aPosition;", "void main() {", "gl_Position = vec4(aPosition, 1.0);", "}"].join("\n")
    }, {
        type: "FRAGMENT_SHADER",
        text: ["precision mediump float;", "varying vec3 vColor;", "void main() {", "gl_FragColor = vec4(vColor, 1.0);", "}"].join("\n")
    }, {
        type: "FRAGMENT_SHADER",
        text: ["precision mediump float;", "varying vec3 vColor;", "void f(in vec3 a, out vec3 b) {", "b = 2.0 * a;", "}", "void main() {", "vec3 color;", "f(vColor, color);", "gl_FragColor = vec4(color, 1.0);", "}"].join("\n")
    }], s = function(t, e, i) {
        var n = e;
        "string" == typeof n && (n = t[e]);
        var r = t.createShader(n);
        return t.shaderSource(r, i),
        t.compileShader(r),
        !(!t.getShaderParameter(r, t.COMPILE_STATUS) && !t.isContextLost()) || (console.warn("Could't compile shader " + i),
        console.warn(t.getShaderInfoLog(r)),
        console.warn("You may want to consider a browser that fully supports WebGL."),
        !1)
    };
    e.a = function() {
        if (void 0 !== n)
            return n;
        if (n = !1,
        i.i(r.a)())
            return !1;
        for (var t = ["webgl", "experimental-webgl"], e = {
            antialias: !1
        }, o = null, l = 0; l < t.length && !(o = document.createElement("canvas").getContext(t[l], e)); l++)
            ;
        return !!o && (n = a.every(function(t) {
            return s(o, t.type, t.text)
        }))
    }
}
, , , , function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(128)
      , a = i(326)
      , s = i(321)
      , o = i(600)
      , l = function() {
        r.call(this),
        this._attributes = {},
        this._primitives = [],
        this._cacheDrawCall = {},
        this._useVAO = void 0,
        this._vao = {},
        this._cacheVertexAttributeBufferList = {},
        this._shape = void 0
    };
    l.enableVAO = !0,
    l.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        releaseGLObjects: function() {
            void 0 !== this.stateset && this.stateset.releaseGLObjects();
            for (var t in this._attributes) {
                this._attributes[t].releaseGLObjects()
            }
            for (var e = 0, i = this._primitives.length; e < i; e++) {
                var n = this._primitives[e];
                void 0 !== n.getIndices && void 0 !== n.getIndices() && null !== n.getIndices() && n.indices.releaseGLObjects()
            }
            this.releaseVAO()
        },
        releaseVAO: function() {
            if (this._useVAO && this._glContext)
                for (var t in this._vao)
                    this._vao[t] && (this._glContext.deleteVertexArray(this._vao[t]),
                    this._vao[t] = void 0)
        },
        dirty: function() {
            this._cacheDrawCall = {},
            this.releaseVAO()
        },
        getPrimitives: function() {
            return this.getPrimitiveSetList()
        },
        getAttributes: function() {
            return this.getVertexAttributeList()
        },
        getShape: function() {
            return this._shape
        },
        setShape: function(t) {
            this._shape = t
        },
        getVertexAttributeList: function() {
            return this._attributes
        },
        getPrimitiveSetList: function() {
            return this._primitives
        },
        setVertexAttribArray: function(t, e) {
            this._attributes[t] !== e && (this._attributes[t] = e,
            this.dirty())
        },
        _generateVertexSetup: function(t, e, i) {
            for (var n = ["//generated by Geometry::implementation", "state.lazyDisablingOfVertexAttributes();", "var attr;"], r = 0, a = t.length; r < a; r++)
                n.push("attr = this._attributes['" + t[r] + "'];"),
                n.push("if ( attr.BufferArrayProxy ) attr = attr.getBufferArray();"),
                n.push("if ( !attr.isValid() ) return;"),
                n.push("state.setVertexAttribArray(" + e[r] + ", attr, attr.getNormalize() );");
            return n.push("state.applyDisablingOfVertexAttributes();"),
            i && n.push("state.setIndexArray( this._primitives[ 0 ].getIndices() );"),
            n
        },
        _generatePrimitive: function(t, e, i) {
            var n = [e ? "state.enableVertexColor();" : "state.disableVertexColor();"];
            if (i)
                return n.concat(["var primitive = this._primitives[ 0 ];", "var indexes = primitive.getIndices();", "if ( indexes.isDirty() ) {;", "  indexes.bind( gl );", "  indexes.compile( gl );", "};", "primitive.drawElements( state );"]);
            n.push("var primitives = this._primitives;");
            for (var r = 0, a = t.length; r < a; r++)
                n.push("primitives[" + r + "].draw(state);");
            return n
        },
        generateDrawCommand: function() {
            var t = []
              , e = [];
            return function(i, n, r) {
                var a = n._attributesCache
                  , l = this.getVertexAttributeList();
                e.length = 0,
                t.length = 0;
                var u, h, c, d = this._useVAO, p = d ? [] : void 0, f = !1;
                for (var g in a)
                    if (u = a[g],
                    void 0 !== l[g]) {
                        var m = this._attributes[g];
                        if (m instanceof o && (m = m.getBufferArray(),
                        d = !1),
                        !m.isValid())
                            return;
                        d && p.push(m),
                        f || "Color" !== g || (f = !0),
                        e.push(g),
                        t.push(u)
                    }
                var v, _;
                if (d) {
                    this._cacheVertexAttributeBufferList[r] = p;
                    var b = 1 === this._primitives.length && this._primitives[0]instanceof s
                      , x = this._generateVertexSetup(e, t, b);
                    i.clearVertexAttribCache();
                    var y = i.getGraphicContext()
                      , S = y.createVertexArray();
                    i.setVertexArrayObject(S),
                    this._vao[r] = S;
                    new Function("state",x.join("\n")).call(this, i);
                    var w = ["var gl = state.getGraphicContext();", "var vao = this._vao[ " + r + " ] ", "var hasChanged = state.setVertexArrayObject( vao );", "if ( hasChanged ) {", "  var vaList = this._cacheVertexAttributeBufferList[ " + r + " ];", "  var va;"];
                    for (h = 0,
                    c = p.length; h < c; h++)
                        w.push("  va = vaList[ " + h + "];"),
                        w.push("  if ( va.isDirty() ) {;"),
                        w.push("    va.bind( gl );"),
                        w.push("    va.compile( gl );"),
                        w.push("  };");
                    w.push("}"),
                    v = w.concat(this._generatePrimitive(this._primitives, f, b)).join("\n"),
                    _ = "GeometryDrawImplementationCacheVAO"
                } else
                    v = this._generateVertexSetup(e, t, !1).concat(this._generatePrimitive(this._primitives, f, !1)).join("\n"),
                    _ = "GeometryDrawImplementationCache";
                var C = new Function("state","return function " + _ + "( state ) { " + v + "}")();
                return this._cacheDrawCall[r] = C,
                C
            }
        }(),
        drawImplementation: function(t) {
            var e = t.getLastProgramApplied()
              , i = e.getInstanceID()
              , n = this._cacheDrawCall[i];
            if (this._useVAO && !this._vao[i] && t.setVertexArrayObject(null),
            n)
                return void n.call(this, t);
            this._primitives.length && (void 0 === this._useVAO && l.enableVAO && (this._useVAO = a.instance().hasVAO(),
            this._glContext = t.getGraphicContext()),
            n = this.generateDrawCommand(t, e, i),
            n.call(this, t),
            t.setVertexArrayObject(null))
        },
        setBound: function(t) {
            this._boundingBox = t,
            this._boundingBoxComputed = !0
        },
        computeBoundingBox: function(t) {
            t.init();
            var e = this.getVertexAttributeList().Vertex;
            if (e && e.getElements() && e.getItemSize() > 2) {
                for (var i = e.getElements(), n = e.getItemSize(), r = t.getMin(), a = t.getMax(), s = r[0], o = r[1], l = r[2], u = a[0], h = a[1], c = a[2], d = 0, p = i.length; d < p; d += n) {
                    var f = i[d]
                      , g = i[d + 1]
                      , m = i[d + 2];
                    f < s && (s = f),
                    f > u && (u = f),
                    g < o && (o = g),
                    g > h && (h = g),
                    m < l && (l = m),
                    m > c && (c = m)
                }
                r[0] = s,
                r[1] = o,
                r[2] = l,
                a[0] = u,
                a[1] = h,
                a[2] = c
            }
            return t
        },
        computeBoundingSphere: function(t) {
            t.init();
            var e = this.getBoundingBox();
            return t.expandByBoundingBox(e),
            t
        }
    }), "osg", "Geometry"),
    l.appendVertexAttributeToList = function(t, e, i) {
        for (var n in t) {
            var r = n;
            void 0 !== i && (r += "_" + i),
            e[r] = t[n]
        }
    }
    ,
    n.setTypeID(l),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    t.exports = {
        RELATIVE_RF: 0,
        ABSOLUTE_RF: 1
    }
}
, , function(t, e, i) {
    "use strict";
    var n, r, a = i(7), s = i.n(a), o = i(4), l = i(1067), u = o.a.osg, h = 0, c = s.a.defer(), d = {
        BIAS_MIN: .9,
        BIAS_MAX: 1.1,
        getBoxReady: function() {
            return c.promise
        },
        updateMaxWorldDisplacement: function(t) {
            t <= h || (h = t,
            this._updateModelBoxes())
        },
        getModelBoxWithDisplacement: function() {
            return n
        },
        getModelBoxWithoutDisplacement: function() {
            return r
        },
        _updateModelBoxes: function() {
            if (n) {
                var t = n.getMin()
                  , e = n.getMax()
                  , i = u.vec3.fromValues(h, h, h);
                u.vec3.add(e, e, i),
                u.vec3.sub(t, t, i)
            }
        },
        computePreciseBox: function(t) {
            var e = new l.a;
            t.accept(e),
            r = e.getPreciseBox(),
            n = new u.BoundingBox,
            n.copy(r),
            this._updateModelBoxes(),
            c.resolve()
        }
    };
    e.a = d
}
, function(t, e, i) {
    "use strict";
    var n, r = i(1), a = (i.n(r),
    i(389)), s = i(167);
    n = s.a.extend({
        model: a.a,
        url: "/i/categories",
        _immutableCollectionName: "categories",
        getTree: function() {
            var t = this.toJSON()
              , e = [];
            return i.i(r.each)(t, function(t) {
                t.children.length && e.push({
                    children: t.children,
                    value: t.uid,
                    label: t.name
                })
            }),
            i.i(r.each)(e, function(t) {
                var e = t.children.slice();
                i.i(r.each)(e, function(e, i) {
                    if ("string" == typeof e) {
                        var n = this.get(e).toJSON()
                          , r = {
                            value: n.uid,
                            label: n.name
                        };
                        n.children.length && (r.children = n.children),
                        t.children.splice(i, 1, r)
                    }
                }
                .bind(this))
            }
            .bind(this)),
            e
        }
    }),
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(1)
      , s = (i.n(a),
    i(390));
    e.a = s.a.extend({
        el: '<div class="widget"/>',
        constructor: function(t, e) {
            this.environment = i.i(a.extend)({}, t ? t.environment : {}, (e || {}).environment),
            this.options = e || {},
            this.collection = this.options.collection,
            this.model = this.options.model,
            s.a.call(this, e)
        },
        initialize: function(t) {
            s.a.prototype.initialize.call(this, t),
            this.render(),
            void 0 !== this.options.id && (this.id = this.options.id,
            this.$el.attr("id", this.id)),
            void 0 !== this.options.className && (this.className = this.options.className,
            this.$el.addClass(this.className)),
            void 0 !== this.options.title && this.$el.attr("title", this.options.title)
        },
        $: function(t) {
            var e = this.$el;
            return this.$el.find(t).filter(function() {
                return r()(this).parent().closest(".widget").is(e)
            })
        },
        delegateEvents: function(t) {
            t || (t = i.i(a.result)(this, "events") || {});
            var e = this.$el;
            return s.a.prototype.delegateEvents.call(this, Object.keys(t).reduce(function(n, s) {
                var o = t[s];
                return i.i(a.isFunction)(o) || (o = this[t[s]]),
                o ? (n[s] = function(t) {
                    t && t.currentTarget && !r()(t.currentTarget).closest(".widget").is(e) || o.apply(this, arguments)
                }
                .bind(this),
                n) : n
            }
            .bind(this), {})),
            this.model && this.model.on("change", this.modelChangeEvent, this),
            this
        },
        undelegateEvents: function() {
            return s.a.prototype.undelegateEvents.apply(this, arguments),
            this.model && this.model.off("change", this.modelChangeEvent, this),
            this
        },
        modelChangeEvent: function() {
            var t = this.options.name
              , e = t + "."
              , i = !t
              , n = Object.keys(this.model.changedAttributes() || {})
              , r = n.some(function(i) {
                return i === t || 0 === i.indexOf(e)
            });
            (i || r) && this.render()
        },
        change: function(t, e) {
            1 === arguments.length && (e = t,
            t = void 0);
            var i = !0
              , n = function() {
                i = !1
            }
              , r = {
                target: this,
                which: t,
                value: e,
                preventDefault: n
            };
            return this.trigger("change.before", r),
            !!i && (this.defaultAction(t, e),
            this.trigger("change"),
            !0)
        },
        defaultAction: function(t, e) {
            this.set(e)
        },
        field: function(t) {
            return this.options.name + (t ? "." + t : "")
        },
        get: function(t) {
            return this.model.get(this.field(t))
        },
        set: function(t, e) {
            return 1 === arguments.length && (e = t,
            t = void 0),
            this.model.set(this.field(t), e)
        },
        disable: function() {
            this._disabled = !0,
            this.$el.addClass("disabled")
        },
        enable: function() {
            this._disabled = !1,
            this.$el.removeClass("disabled")
        }
    }, {
        reify: function() {
            var t = arguments
              , e = this
              , i = function() {
                e.apply(this, t)
            };
            return i.prototype = this.prototype,
            new i
        }
    })
}
, , function(t, e, i) {
    t.exports = i.p + "ageplus-8e99c9723af48d9f8fdeca1338d9f030.svg"
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(356)
      , a = n.a.osg
      , s = ["Displacement", "Opacity", "DiffuseColor", "DiffusePBR", "AlbedoPBR", "SpecularColor", "DiffuseIntensity", "SpecularPBR", "MetalnessPBR", "GlossinessPBR", "RoughnessPBR", "NormalMap", "BumpMap", "AOPBR", "EmitColor", "CavityPBR", "SpecularHardness", "SpecularF0"]
      , o = function(t) {
        switch (t) {
        case "Opacity":
        case "Displacement":
            return r.a.LIT | r.a.SHADELESS | r.a.MATCAP;
        case "EmitColor":
            return r.a.LIT | r.a.SHADELESS;
        case "NormalMap":
        case "BumpMap":
            return r.a.LIT | r.a.MATCAP;
        case "DiffusePBR":
        case "AlbedoPBR":
        case "AOPBR":
        case "CavityPBR":
            return r.a.PBR;
        case "SpecularPBR":
        case "MetalnessPBR":
        case "GlossinessPBR":
        case "RoughnessPBR":
        case "SpecularF0":
            return r.a.PBR_LIT;
        case "DiffuseColor":
        case "DiffuseIntensity":
            return r.a.CLASSIC;
        case "SpecularColor":
        case "SpecularHardness":
            return r.a.CLASSIC_LIT
        }
    }
      , l = function(t) {
        switch (t) {
        case "DiffuseColor":
        case "DiffusePBR":
        case "AlbedoPBR":
        case "EmitColor":
        case "SpecularColor":
        case "SpecularPBR":
            return !0;
        default:
            return !1
        }
    }
      , u = function(t) {
        switch (t) {
        case "DiffuseColor":
        case "DiffuseIntensity":
        case "SpecularColor":
        case "NormalMap":
        case "EmitColor":
        case "DiffusePBR":
        case "AlbedoPBR":
        case "SpecularPBR":
            return a.Texture.RGB;
        case "SpecularHardness":
        case "BumpMap":
        case "GlossinessPBR":
        case "RoughnessPBR":
        case "MetalnessPBR":
        case "SpecularF0":
        case "AOPBR":
        case "CavityPBR":
        case "Displacement":
            return a.Texture.LUMINANCE;
        default:
        case "Opacity":
            return a.Texture.ALPHA
        }
    }
      , h = function(t) {
        switch (u(t)) {
        case a.Texture.RGB:
            return "rgb";
        case a.Texture.LUMINANCE:
            return "r";
        default:
        case a.Texture.ALPHA:
            return "a"
        }
    }
      , c = function(t) {
        var e = {};
        switch (t) {
        case "NormalMap":
        case "SpecularPBR":
            break;
        case "SpecularHardness":
        case "BumpMap":
        case "GlossinessPBR":
        case "RoughnessPBR":
        case "MetalnessPBR":
        case "SpecularF0":
        case "AOPBR":
        case "CavityPBR":
        case "Displacement":
            break;
        case "DiffuseColor":
        case "DiffuseIntensity":
        case "SpecularColor":
        case "EmitColor":
        case "DiffusePBR":
        case "AlbedoPBR":
            e.LUMINANCE = "Luminance",
            e.RGB = "RGB";
            break;
        default:
        case "Opacity":
            e.ALPHA = "Alpha",
            e.LUMINANCE = "Luminance"
        }
        return e
    }
      , d = function(t) {
        switch (t) {
        case "DiffuseColor":
        case "DiffusePBR":
        case "AlbedoPBR":
            return 0;
        case "EmitColor":
            return 1;
        case "SpecularColor":
        case "SpecularPBR":
            return 2;
        case "DiffuseIntensity":
            return 3;
        default:
            return -1
        }
    }
      , p = function(t) {
        var e = {};
        return e.NEAREST = "Nearest",
        e.LINEAR = "Bilinear",
        "Displacement" !== t && (e.LINEAR_MIPMAP_LINEAR = "Trilinear"),
        e
    }
      , f = function(t) {
        for (var e = {}, i = 0, n = s.length; i < n; ++i) {
            var r = s[i];
            e[r] = t(r)
        }
        return function(t) {
            return e[t]
        }
    };
    s.getShadingMask = f(o),
    s.isSRGB = f(l),
    s.getDefaultFormat = f(u),
    s.getDefaultStringFormat = f(h),
    s.getPossibleFormat = f(c),
    s.getPossibleFiltering = f(p),
    s.getColorPacking = f(d),
    e.a = s
}
, , , function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(1)
      , s = (i.n(a),
    i(18))
      , o = i.n(s)
      , l = i(91);
    e.a = {
        status: function() {
            return void 0 === this.get("status") ? this.pollStatus() : r.a.resolve(this.get("status"))
        },
        pollStatus: function() {
            return new r.a(function(t, e) {
                o.a.ajax({
                    type: "GET",
                    url: i.i(a.result)(this, "url") + "/status",
                    allowPrefetching: !1
                }).then(function(e) {
                    var i = {
                        PENDING: 0,
                        PROCESSING: 1,
                        SUCCEEDED: 2,
                        FAILED: 3
                    }[e.processing.toUpperCase()];
                    this.set("status", e),
                    this.set("processingStatus", i),
                    t(e)
                }
                .bind(this), e)
            }
            .bind(this))
        },
        checkStatus: function() {
            return this.pollStatus().then(function(t) {
                return -1 !== ["SUCCEEDED", "FAILED"].indexOf(t.processing.toUpperCase()) ? r.a.resolve(t) : r.a.reject(t)
            }
            .bind(this), function() {
                return this.maxFailCount <= 0 ? r.a.resolve({
                    processing: "FAILED",
                    error: "The server failed to answer in time"
                }) : (this.maxFailCount -= 1,
                r.a.reject("Server responded with an error"))
            }
            .bind(this))
        },
        checkStatusAndRetry: function() {
            var t = !0;
            return l.a.while(function() {
                return t
            }, function() {
                return new r.a(function(e) {
                    this.checkStatus().then(function(i) {
                        t = !1,
                        e(i)
                    }).catch(function() {
                        return r.a.delay(2e3).then(function() {
                            e()
                        })
                    })
                }
                .bind(this))
            }
            .bind(this)).catch(function() {
                t = !1
            })
        }
    }
}
, function(t, e, i) {
    "use strict";
    e.a = function(t, e, i) {
        return t && 0 !== t.images.length ? 1 === t.images.length ? t.images[0].url : t.images.reduce(function(t, n) {
            var r = Math.abs(e - t.width)
              , a = Math.abs(i - t.height)
              , s = r + a
              , o = Math.abs(e - n.width)
              , l = Math.abs(i - n.height)
              , u = o + l;
            return (t.width < e || t.height < i) && (s += e * i),
            (n.width < e || n.height < i) && (u += e * i),
            s < u ? t : n
        }).url : ""
    }
}
, , function(t, e, i) {
    t.exports = i.p + "by-7813b5794d8ba96aec20acb7f14ff76a.svg"
}
, function(t, e, i) {
    t.exports = i.p + "nc-e378f908a7f49e2a3812c0d4e70333dd.svg"
}
, function(t, e, i) {
    t.exports = i.p + "nd-7966b830678388d28550a10805a754db.svg"
}
, function(t, e, i) {
    t.exports = i.p + "sa-978acd9d54dfd3c39cd92e8acfe1fe7e.svg"
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(18)
      , s = i.n(a)
      , o = i(2)
      , l = i.n(o)
      , u = i(15)
      , h = "/i/hotspots";
    e.a = u.a.extend({
        defaults: function() {
            return {
                name: "",
                content: "",
                position: [0, 0, 0],
                eye: [0, 0, 0],
                target: [0, 0, 0],
                uidImage: void 0,
                imageFile: void 0,
                preview: "",
                hovered: !0,
                lastComputedScenePosition: [0, 0, 0],
                geometryUid: -1,
                indices: [-1, -1, -1],
                barycentricWeights: [0, 0, 0],
                localPosition: [0, 0, 0]
            }
        },
        url: function() {
            return this.isNew() ? h : h + "/" + this.get("uid")
        },
        remove: function() {
            return r.a.resolve(s.a.ajax({
                type: "DELETE",
                url: this.url()
            }))
        },
        appendArray: function(t, e, i) {
            for (var n = 0, r = i.length; n < r; ++n)
                t.append(e, i[n])
        },
        save: function(t, e) {
            null != t && "object" != typeof t || (e = t);
            var i = this.isNew()
              , n = new FormData
              , a = this.get("imageFile");
            void 0 === this.get("uidImage") && a && n.append("imageFile", a),
            n.append("model", e.modelUID),
            n.append("name", this.get("name"));
            var s = this.get("content").raw;
            n.append("content", null !== s ? s : ""),
            this.appendArray(n, "eye", this.get("eye")),
            this.appendArray(n, "target", this.get("target")),
            this.appendArray(n, "position", this.get("position"));
            var o = this
              , u = l.a.ajax({
                type: i ? "POST" : "PATCH",
                url: this.url(),
                data: n,
                cache: !1,
                contentType: !1,
                processData: !1,
                success: function(t) {
                    i && (o.set("uid", t.uid),
                    t.images.length > 0 && o.set("uidImage", t.images[0].uid))
                },
                error: function(t) {
                    console.error(t.stack)
                }
            });
            return r.a.resolve(u)
        },
        _validate: function(t, e) {
            return e = e || {},
            e.validate = !0,
            u.a.prototype._validate.call(this, t, e)
        },
        validate: function(t) {
            var e = t.eye
              , i = t.target
              , n = i[0] - e[0]
              , r = i[1] - e[1]
              , a = i[2] - e[2]
              , s = Math.sqrt(n * n + r * r + a * a);
            if (s <= 1e-8)
                return i[0] = t.position[0],
                i[1] = t.position[1],
                i[2] = t.position[2],
                !1;
            if (s <= .001) {
                var o = .01 / s;
                i[0] = e[0] + n * o,
                i[1] = e[1] + r * o,
                i[2] = e[2] + a * o
            }
            return !1
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(85)
      , a = i(409)
      , s = i(324)
      , o = function(t) {
        var e;
        return t instanceof n.Float32Array && (e = 5126),
        t instanceof n.Uint32Array && (e = 5125),
        t instanceof n.Uint16Array && (e = 5123),
        t instanceof n.Uint8Array && (e = 5121),
        e
    }
      , l = function(t, e, i, s) {
        if (a.call(this),
        this._instanceID = r.getInstanceID(),
        this.dirty(),
        this._itemSize = i,
        this._target = "string" == typeof t ? l[t] : t,
        this._type = void 0,
        this._normalize = !1,
        void 0 !== e) {
            var o = e;
            s || (o = this._target === l.ELEMENT_ARRAY_BUFFER ? e instanceof n.Uint16Array ? e : new n.Uint16Array(e) : e instanceof n.Float32Array ? e : new n.Float32Array(e)),
            this.setElements(o)
        }
    };
    l.ELEMENT_ARRAY_BUFFER = 34963,
    l.ARRAY_BUFFER = 34962,
    l._sDeletedGLBufferArrayCache = new window.Map,
    l.deleteGLBufferArray = function(t, e) {
        l._sDeletedGLBufferArrayCache.has(t) || l._sDeletedGLBufferArrayCache.set(t, []),
        l._sDeletedGLBufferArrayCache.get(t).push(e)
    }
    ,
    l.flushDeletedGLBufferArrays = function(t, e) {
        if (e <= 0)
            return e;
        if (!l._sDeletedGLBufferArrayCache.has(t))
            return e;
        for (var i = 0, n = s.instance().tick(), r = l._sDeletedGLBufferArrayCache.get(t), a = r.length, o = a - 1; o >= 0 && i < e; o--)
            t.deleteBuffer(r[o]),
            r.splice(o, 1),
            i = s.instance().deltaS(n, s.instance().tick());
        return e - i
    }
    ,
    l.flushAllDeletedGLBufferArrays = function(t) {
        if (l._sDeletedGLBufferArrayCache.has(t))
            for (var e = l._sDeletedGLBufferArrayCache.get(t), i = e.length, n = i - 1; n >= 0; n--)
                t.deleteBuffer(e[n]),
                e.splice(n, 1)
    }
    ,
    l.prototype = n.objectInherit(a.prototype, {
        getInstanceID: function() {
            return this._instanceID
        },
        setItemSize: function(t) {
            this._itemSize = t
        },
        isValid: function() {
            return void 0 !== this._buffer || void 0 !== this._elements
        },
        releaseGLObjects: function() {
            void 0 !== this._buffer && null !== this._buffer && void 0 !== this._gl && l.deleteGLBufferArray(this._gl, this._buffer),
            this._buffer = void 0
        },
        setNormalize: function(t) {
            this._normalize = t
        },
        getNormalize: function() {
            return this._normalize
        },
        bind: function(t) {
            this._gl || this.setGraphicContext(t);
            var e = this._target
              , i = this._buffer;
            if (i)
                return void t.bindBuffer(e, i);
            !i && this._elements.length > 0 && (this._buffer = t.createBuffer(),
            this._numItems = this._elements.length / this._itemSize,
            t.bindBuffer(e, this._buffer))
        },
        getItemSize: function() {
            return this._itemSize
        },
        dirty: function() {
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        },
        compile: function(t) {
            this._dirty && (n.timeStamp("osgjs.metrics:bufferData"),
            t.bufferData(this._target, this._elements, t.STATIC_DRAW),
            this._dirty = !1)
        },
        getElements: function() {
            return this._elements
        },
        setElements: function(t) {
            this._elements = t,
            this._type = o(t),
            this._dirty = !0
        },
        getType: function() {
            return this._type
        }
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).mat4
      , a = i(325)
      , s = i(144)
      , o = function() {
        a.call(this),
        this.matrix = r.create()
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, {
        getMatrix: function() {
            return this.matrix
        },
        setMatrix: function(t) {
            this.matrix = t,
            this.dirtyBound()
        },
        computeLocalToWorldMatrix: function(t) {
            return this.referenceFrame === s.RELATIVE_RF ? r.mul(t, t, this.matrix) : r.copy(t, this.matrix),
            !0
        },
        computeWorldToLocalMatrix: function() {
            var t = r.create();
            return function(e) {
                return r.invert(t, this.matrix),
                this.referenceFrame === s.RELATIVE_RF ? r.mul(e, t, e) : r.copy(e, t),
                !0
            }
        }()
    }), "osg", "MatrixTransform"),
    n.setTypeID(o),
    t.exports = o
}
, , function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(1);
    i.n(a);
    e.a = {
        name: "LazyLoading",
        handleLazyLoading: function(t) {
            t = t || {},
            i.i(a.defaults)(t, {
                onBeforeLoad: function() {},
                onAfterLoad: function() {}
            });
            var e = function() {
                this.$(".lazyload").each(function() {
                    var e = r()(this)
                      , i = e.attr("data-uri")
                      , n = new Image;
                    n.classList.add("lazyloaded"),
                    n.onload = n.onerror = function() {
                        var i, r = e.width();
                        if (i = n.naturalWidth > r ? n.naturalHeight * (r / n.naturalWidth) : n.naturalHeight,
                        t.onBeforeLoad(i),
                        e.is(":visible")) {
                            var a = function() {
                                e.append(n),
                                e.addClass("loaded").one("transitionend webkittransitionend moztransitionend", function() {
                                    e.replaceWith(n),
                                    t.onAfterLoad()
                                })
                            }
                            .bind(this);
                            i !== e.outerHeight() ? e.css("min-height", i).one("transitionend webkittransitionend moztransitionend", a) : a()
                        } else
                            e.replaceWith(n),
                            t.onAfterLoad()
                    }
                    ,
                    n.src = i
                })
            }
            .bind(this);
            "complete" === document.readyState ? e() : r()(window).load(e)
        }
    }
}
, , function(t, e, i) {
    "use strict";
    var n, r = i(1), a = (i.n(r),
    i(42));
    n = a.a.extend({}, {
        get: function(t) {
            t = i.i(r.extend)({}, t);
            var e = this
              , n = new e;
            return !1 !== t.allowPrefetching ? (void 0 === this[this._immutableCollectionName] && (this[this._immutableCollectionName] = n),
            this[this._immutableCollectionName].fetch(t),
            this[this._immmutableCollectionName]) : n.fetch(t)
        }
    }),
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = i(161)
      , r = i(42)
      , a = i(21);
    e.a = r.a.extend({
        comparator: "order",
        model: n.a,
        url: function() {
            var t = this.options.filters.get("modelUID");
            return (t ? "/i/models/" + t + "/hotspots" : "/i/hotspots") + a.a.craft("?", {
                offset: this.options.offset
            })
        }
    })
}
, function(t, e, i) {
    var n;
    /*! Hammer.JS - v2.0.4 - 2015-03-02
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2015 Jorik Tangelder;
 * Licensed under the MIT license */
    !function(r, a, s, o) {
        "use strict";
        function l(t, e, i) {
            return setTimeout(f(t, i), e)
        }
        function u(t, e, i) {
            return !!Array.isArray(t) && (h(t, i[e], i),
            !0)
        }
        function h(t, e, i) {
            var n;
            if (t)
                if (t.forEach)
                    t.forEach(e, i);
                else if (t.length !== o)
                    for (n = 0; n < t.length; )
                        e.call(i, t[n], n, t),
                        n++;
                else
                    for (n in t)
                        t.hasOwnProperty(n) && e.call(i, t[n], n, t)
        }
        function c(t, e, i) {
            for (var n = Object.keys(e), r = 0; r < n.length; )
                (!i || i && t[n[r]] === o) && (t[n[r]] = e[n[r]]),
                r++;
            return t
        }
        function d(t, e) {
            return c(t, e, !0)
        }
        function p(t, e, i) {
            var n, r = e.prototype;
            n = t.prototype = Object.create(r),
            n.constructor = t,
            n._super = r,
            i && c(n, i)
        }
        function f(t, e) {
            return function() {
                return t.apply(e, arguments)
            }
        }
        function g(t, e) {
            return typeof t == ft ? t.apply(e ? e[0] || o : o, e) : t
        }
        function m(t, e) {
            return t === o ? e : t
        }
        function v(t, e, i) {
            h(y(e), function(e) {
                t.addEventListener(e, i, !1)
            })
        }
        function _(t, e, i) {
            h(y(e), function(e) {
                t.removeEventListener(e, i, !1)
            })
        }
        function b(t, e) {
            for (; t; ) {
                if (t == e)
                    return !0;
                t = t.parentNode
            }
            return !1
        }
        function x(t, e) {
            return t.indexOf(e) > -1
        }
        function y(t) {
            return t.trim().split(/\s+/g)
        }
        function S(t, e, i) {
            if (t.indexOf && !i)
                return t.indexOf(e);
            for (var n = 0; n < t.length; ) {
                if (i && t[n][i] == e || !i && t[n] === e)
                    return n;
                n++
            }
            return -1
        }
        function w(t) {
            return Array.prototype.slice.call(t, 0)
        }
        function C(t, e, i) {
            for (var n = [], r = [], a = 0; a < t.length; ) {
                var s = e ? t[a][e] : t[a];
                S(r, s) < 0 && n.push(t[a]),
                r[a] = s,
                a++
            }
            return i && (n = e ? n.sort(function(t, i) {
                return t[e] > i[e]
            }) : n.sort()),
            n
        }
        function M(t, e) {
            for (var i, n, r = e[0].toUpperCase() + e.slice(1), a = 0; a < dt.length; ) {
                if (i = dt[a],
                (n = i ? i + r : e)in t)
                    return n;
                a++
            }
            return o
        }
        function T() {
            return _t++
        }
        function A(t) {
            var e = t.ownerDocument || t;
            return e.defaultView || e.parentWindow || r
        }
        function E(t, e) {
            var i = this;
            this.manager = t,
            this.callback = e,
            this.element = t.element,
            this.target = t.options.inputTarget,
            this.domHandler = function(e) {
                g(t.options.enable, [t]) && i.handler(e)
            }
            ,
            this.init()
        }
        function P(t) {
            var e = t.options.inputClass;
            return new (e || (yt ? H : St ? q : xt ? X : z))(t,N)
        }
        function N(t, e, i) {
            var n = i.pointers.length
              , r = i.changedPointers.length
              , a = e & Ct && n - r == 0
              , s = e & (Tt | At) && n - r == 0;
            i.isFirst = !!a,
            i.isFinal = !!s,
            a && (t.session = {}),
            i.eventType = e,
            k(t, i),
            t.emit("hammer.input", i),
            t.recognize(i),
            t.session.prevInput = i
        }
        function k(t, e) {
            var i = t.session
              , n = e.pointers
              , r = n.length;
            i.firstInput || (i.firstInput = R(e)),
            r > 1 && !i.firstMultiple ? i.firstMultiple = R(e) : 1 === r && (i.firstMultiple = !1);
            var a = i.firstInput
              , s = i.firstMultiple
              , o = s ? s.center : a.center
              , l = e.center = I(n);
            e.timeStamp = vt(),
            e.deltaTime = e.timeStamp - a.timeStamp,
            e.angle = V(o, l),
            e.distance = B(o, l),
            F(i, e),
            e.offsetDirection = L(e.deltaX, e.deltaY),
            e.scale = s ? G(s.pointers, n) : 1,
            e.rotation = s ? U(s.pointers, n) : 0,
            D(i, e);
            var u = t.element;
            b(e.srcEvent.target, u) && (u = e.srcEvent.target),
            e.target = u
        }
        function F(t, e) {
            var i = e.center
              , n = t.offsetDelta || {}
              , r = t.prevDelta || {}
              , a = t.prevInput || {};
            e.eventType !== Ct && a.eventType !== Tt || (r = t.prevDelta = {
                x: a.deltaX || 0,
                y: a.deltaY || 0
            },
            n = t.offsetDelta = {
                x: i.x,
                y: i.y
            }),
            e.deltaX = r.x + (i.x - n.x),
            e.deltaY = r.y + (i.y - n.y)
        }
        function D(t, e) {
            var i, n, r, a, s = t.lastInterval || e, l = e.timeStamp - s.timeStamp;
            if (e.eventType != At && (l > wt || s.velocity === o)) {
                var u = s.deltaX - e.deltaX
                  , h = s.deltaY - e.deltaY
                  , c = O(l, u, h);
                n = c.x,
                r = c.y,
                i = mt(c.x) > mt(c.y) ? c.x : c.y,
                a = L(u, h),
                t.lastInterval = e
            } else
                i = s.velocity,
                n = s.velocityX,
                r = s.velocityY,
                a = s.direction;
            e.velocity = i,
            e.velocityX = n,
            e.velocityY = r,
            e.direction = a
        }
        function R(t) {
            for (var e = [], i = 0; i < t.pointers.length; )
                e[i] = {
                    clientX: gt(t.pointers[i].clientX),
                    clientY: gt(t.pointers[i].clientY)
                },
                i++;
            return {
                timeStamp: vt(),
                pointers: e,
                center: I(e),
                deltaX: t.deltaX,
                deltaY: t.deltaY
            }
        }
        function I(t) {
            var e = t.length;
            if (1 === e)
                return {
                    x: gt(t[0].clientX),
                    y: gt(t[0].clientY)
                };
            for (var i = 0, n = 0, r = 0; r < e; )
                i += t[r].clientX,
                n += t[r].clientY,
                r++;
            return {
                x: gt(i / e),
                y: gt(n / e)
            }
        }
        function O(t, e, i) {
            return {
                x: e / t || 0,
                y: i / t || 0
            }
        }
        function L(t, e) {
            return t === e ? Et : mt(t) >= mt(e) ? t > 0 ? Pt : Nt : e > 0 ? kt : Ft
        }
        function B(t, e, i) {
            i || (i = Ot);
            var n = e[i[0]] - t[i[0]]
              , r = e[i[1]] - t[i[1]];
            return Math.sqrt(n * n + r * r)
        }
        function V(t, e, i) {
            i || (i = Ot);
            var n = e[i[0]] - t[i[0]]
              , r = e[i[1]] - t[i[1]];
            return 180 * Math.atan2(r, n) / Math.PI
        }
        function U(t, e) {
            return V(e[1], e[0], Lt) - V(t[1], t[0], Lt)
        }
        function G(t, e) {
            return B(e[0], e[1], Lt) / B(t[0], t[1], Lt)
        }
        function z() {
            this.evEl = Vt,
            this.evWin = Ut,
            this.allow = !0,
            this.pressed = !1,
            E.apply(this, arguments)
        }
        function H() {
            this.evEl = Ht,
            this.evWin = jt,
            E.apply(this, arguments),
            this.store = this.manager.session.pointerEvents = []
        }
        function j() {
            this.evTarget = qt,
            this.evWin = Yt,
            this.started = !1,
            E.apply(this, arguments)
        }
        function W(t, e) {
            var i = w(t.touches)
              , n = w(t.changedTouches);
            return e & (Tt | At) && (i = C(i.concat(n), "identifier", !0)),
            [i, n]
        }
        function q() {
            this.evTarget = Kt,
            this.targetIds = {},
            E.apply(this, arguments)
        }
        function Y(t, e) {
            var i = w(t.touches)
              , n = this.targetIds;
            if (e & (Ct | Mt) && 1 === i.length)
                return n[i[0].identifier] = !0,
                [i, i];
            var r, a, s = w(t.changedTouches), o = [], l = this.target;
            if (a = i.filter(function(t) {
                return b(t.target, l)
            }),
            e === Ct)
                for (r = 0; r < a.length; )
                    n[a[r].identifier] = !0,
                    r++;
            for (r = 0; r < s.length; )
                n[s[r].identifier] && o.push(s[r]),
                e & (Tt | At) && delete n[s[r].identifier],
                r++;
            return o.length ? [C(a.concat(o), "identifier", !0), o] : void 0
        }
        function X() {
            E.apply(this, arguments);
            var t = f(this.handler, this);
            this.touch = new q(this.manager,t),
            this.mouse = new z(this.manager,t)
        }
        function K(t, e) {
            this.manager = t,
            this.set(e)
        }
        function J(t) {
            if (x(t, te))
                return te;
            var e = x(t, ee)
              , i = x(t, ie);
            return e && i ? ee + " " + ie : e || i ? e ? ee : ie : x(t, $t) ? $t : Zt
        }
        function Q(t) {
            this.id = T(),
            this.manager = null,
            this.options = d(t || {}, this.defaults),
            this.options.enable = m(this.options.enable, !0),
            this.state = ne,
            this.simultaneous = {},
            this.requireFail = []
        }
        function Z(t) {
            return t & le ? "cancel" : t & se ? "end" : t & ae ? "move" : t & re ? "start" : ""
        }
        function $(t) {
            return t == Ft ? "down" : t == kt ? "up" : t == Pt ? "left" : t == Nt ? "right" : ""
        }
        function tt(t, e) {
            var i = e.manager;
            return i ? i.get(t) : t
        }
        function et() {
            Q.apply(this, arguments)
        }
        function it() {
            et.apply(this, arguments),
            this.pX = null,
            this.pY = null
        }
        function nt() {
            et.apply(this, arguments)
        }
        function rt() {
            Q.apply(this, arguments),
            this._timer = null,
            this._input = null
        }
        function at() {
            et.apply(this, arguments)
        }
        function st() {
            et.apply(this, arguments)
        }
        function ot() {
            Q.apply(this, arguments),
            this.pTime = !1,
            this.pCenter = !1,
            this._timer = null,
            this._input = null,
            this.count = 0
        }
        function lt(t, e) {
            return e = e || {},
            e.recognizers = m(e.recognizers, lt.defaults.preset),
            new ut(t,e)
        }
        function ut(t, e) {
            e = e || {},
            this.options = d(e, lt.defaults),
            this.options.inputTarget = this.options.inputTarget || t,
            this.handlers = {},
            this.session = {},
            this.recognizers = [],
            this.element = t,
            this.input = P(this),
            this.touchAction = new K(this,this.options.touchAction),
            ht(this, !0),
            h(e.recognizers, function(t) {
                var e = this.add(new t[0](t[1]));
                t[2] && e.recognizeWith(t[2]),
                t[3] && e.requireFailure(t[3])
            }, this)
        }
        function ht(t, e) {
            var i = t.element;
            i.style && h(t.options.cssProps, function(t, n) {
                i.style[M(i.style, n)] = e ? t : ""
            })
        }
        function ct(t, e) {
            var i = a.createEvent("Event");
            i.initEvent(t, !0, !0),
            i.gesture = e,
            e.target.dispatchEvent(i)
        }
        var dt = ["", "webkit", "moz", "MS", "ms", "o"]
          , pt = a.createElement("div")
          , ft = "function"
          , gt = Math.round
          , mt = Math.abs
          , vt = Date.now
          , _t = 1
          , bt = /mobile|tablet|ip(ad|hone|od)|android/i
          , xt = "ontouchstart"in r
          , yt = M(r, "PointerEvent") !== o
          , St = xt && bt.test(navigator.userAgent)
          , wt = 25
          , Ct = 1
          , Mt = 2
          , Tt = 4
          , At = 8
          , Et = 1
          , Pt = 2
          , Nt = 4
          , kt = 8
          , Ft = 16
          , Dt = Pt | Nt
          , Rt = kt | Ft
          , It = Dt | Rt
          , Ot = ["x", "y"]
          , Lt = ["clientX", "clientY"];
        E.prototype = {
            handler: function() {},
            init: function() {
                this.evEl && v(this.element, this.evEl, this.domHandler),
                this.evTarget && v(this.target, this.evTarget, this.domHandler),
                this.evWin && v(A(this.element), this.evWin, this.domHandler)
            },
            destroy: function() {
                this.evEl && _(this.element, this.evEl, this.domHandler),
                this.evTarget && _(this.target, this.evTarget, this.domHandler),
                this.evWin && _(A(this.element), this.evWin, this.domHandler)
            }
        };
        var Bt = {
            mousedown: Ct,
            mousemove: Mt,
            mouseup: Tt
        }
          , Vt = "mousedown"
          , Ut = "mousemove mouseup";
        p(z, E, {
            handler: function(t) {
                var e = Bt[t.type];
                e & Ct && 0 === t.button && (this.pressed = !0),
                e & Mt && 1 !== t.which && (e = Tt),
                this.pressed && this.allow && (e & Tt && (this.pressed = !1),
                this.callback(this.manager, e, {
                    pointers: [t],
                    changedPointers: [t],
                    pointerType: "mouse",
                    srcEvent: t
                }))
            }
        });
        var Gt = {
            pointerdown: Ct,
            pointermove: Mt,
            pointerup: Tt,
            pointercancel: At,
            pointerout: At
        }
          , zt = {
            2: "touch",
            3: "pen",
            4: "mouse",
            5: "kinect"
        }
          , Ht = "pointerdown"
          , jt = "pointermove pointerup pointercancel";
        r.MSPointerEvent && !r.PointerEvent && (Ht = "MSPointerDown",
        jt = "MSPointerMove MSPointerUp MSPointerCancel"),
        p(H, E, {
            handler: function(t) {
                var e = this.store
                  , i = !1
                  , n = t.type.toLowerCase().replace("ms", "")
                  , r = Gt[n]
                  , a = zt[t.pointerType] || t.pointerType
                  , s = "touch" == a
                  , o = S(e, t.pointerId, "pointerId");
                r & Ct && (0 === t.button || s) ? o < 0 && (e.push(t),
                o = e.length - 1) : r & (Tt | At) && (i = !0),
                o < 0 || (e[o] = t,
                this.callback(this.manager, r, {
                    pointers: e,
                    changedPointers: [t],
                    pointerType: a,
                    srcEvent: t
                }),
                i && e.splice(o, 1))
            }
        });
        var Wt = {
            touchstart: Ct,
            touchmove: Mt,
            touchend: Tt,
            touchcancel: At
        }
          , qt = "touchstart"
          , Yt = "touchstart touchmove touchend touchcancel";
        p(j, E, {
            handler: function(t) {
                var e = Wt[t.type];
                if (e === Ct && (this.started = !0),
                this.started) {
                    var i = W.call(this, t, e);
                    e & (Tt | At) && i[0].length - i[1].length == 0 && (this.started = !1),
                    this.callback(this.manager, e, {
                        pointers: i[0],
                        changedPointers: i[1],
                        pointerType: "touch",
                        srcEvent: t
                    })
                }
            }
        });
        var Xt = {
            touchstart: Ct,
            touchmove: Mt,
            touchend: Tt,
            touchcancel: At
        }
          , Kt = "touchstart touchmove touchend touchcancel";
        p(q, E, {
            handler: function(t) {
                var e = Xt[t.type]
                  , i = Y.call(this, t, e);
                i && this.callback(this.manager, e, {
                    pointers: i[0],
                    changedPointers: i[1],
                    pointerType: "touch",
                    srcEvent: t
                })
            }
        }),
        p(X, E, {
            handler: function(t, e, i) {
                var n = "touch" == i.pointerType
                  , r = "mouse" == i.pointerType;
                if (n)
                    this.mouse.allow = !1;
                else if (r && !this.mouse.allow)
                    return;
                e & (Tt | At) && (this.mouse.allow = !0),
                this.callback(t, e, i)
            },
            destroy: function() {
                this.touch.destroy(),
                this.mouse.destroy()
            }
        });
        var Jt = M(pt.style, "touchAction")
          , Qt = Jt !== o
          , Zt = "auto"
          , $t = "manipulation"
          , te = "none"
          , ee = "pan-x"
          , ie = "pan-y";
        K.prototype = {
            set: function(t) {
                "compute" == t && (t = this.compute()),
                Qt && this.manager.element.style && (this.manager.element.style[Jt] = t),
                this.actions = t.toLowerCase().trim()
            },
            update: function() {
                this.set(this.manager.options.touchAction)
            },
            compute: function() {
                var t = [];
                return h(this.manager.recognizers, function(e) {
                    g(e.options.enable, [e]) && (t = t.concat(e.getTouchAction()))
                }),
                J(t.join(" "))
            },
            preventDefaults: function(t) {
                if (!Qt) {
                    var e = t.srcEvent
                      , i = t.offsetDirection;
                    if (this.manager.session.prevented)
                        return void e.preventDefault();
                    var n = this.actions
                      , r = x(n, te)
                      , a = x(n, ie)
                      , s = x(n, ee);
                    return r || a && i & Dt || s && i & Rt ? this.preventSrc(e) : void 0
                }
            },
            preventSrc: function(t) {
                this.manager.session.prevented = !0,
                t.preventDefault()
            }
        };
        var ne = 1
          , re = 2
          , ae = 4
          , se = 8
          , oe = se
          , le = 16;
        Q.prototype = {
            defaults: {},
            set: function(t) {
                return c(this.options, t),
                this.manager && this.manager.touchAction.update(),
                this
            },
            recognizeWith: function(t) {
                if (u(t, "recognizeWith", this))
                    return this;
                var e = this.simultaneous;
                return t = tt(t, this),
                e[t.id] || (e[t.id] = t,
                t.recognizeWith(this)),
                this
            },
            dropRecognizeWith: function(t) {
                return u(t, "dropRecognizeWith", this) ? this : (t = tt(t, this),
                delete this.simultaneous[t.id],
                this)
            },
            requireFailure: function(t) {
                if (u(t, "requireFailure", this))
                    return this;
                var e = this.requireFail;
                return t = tt(t, this),
                -1 === S(e, t) && (e.push(t),
                t.requireFailure(this)),
                this
            },
            dropRequireFailure: function(t) {
                if (u(t, "dropRequireFailure", this))
                    return this;
                t = tt(t, this);
                var e = S(this.requireFail, t);
                return e > -1 && this.requireFail.splice(e, 1),
                this
            },
            hasRequireFailures: function() {
                return this.requireFail.length > 0
            },
            canRecognizeWith: function(t) {
                return !!this.simultaneous[t.id]
            },
            emit: function(t) {
                function e(e) {
                    i.manager.emit(i.options.event + (e ? Z(n) : ""), t)
                }
                var i = this
                  , n = this.state;
                n < se && e(!0),
                e(),
                n >= se && e(!0)
            },
            tryEmit: function(t) {
                if (this.canEmit())
                    return this.emit(t);
                this.state = 32
            },
            canEmit: function() {
                for (var t = 0; t < this.requireFail.length; ) {
                    if (!(this.requireFail[t].state & (32 | ne)))
                        return !1;
                    t++
                }
                return !0
            },
            recognize: function(t) {
                var e = c({}, t);
                if (!g(this.options.enable, [this, e]))
                    return this.reset(),
                    void (this.state = 32);
                this.state & (oe | le | 32) && (this.state = ne),
                this.state = this.process(e),
                this.state & (re | ae | se | le) && this.tryEmit(e)
            },
            process: function(t) {},
            getTouchAction: function() {},
            reset: function() {}
        },
        p(et, Q, {
            defaults: {
                pointers: 1
            },
            attrTest: function(t) {
                var e = this.options.pointers;
                return 0 === e || t.pointers.length === e
            },
            process: function(t) {
                var e = this.state
                  , i = t.eventType
                  , n = e & (re | ae)
                  , r = this.attrTest(t);
                return n && (i & At || !r) ? e | le : n || r ? i & Tt ? e | se : e & re ? e | ae : re : 32
            }
        }),
        p(it, et, {
            defaults: {
                event: "pan",
                threshold: 10,
                pointers: 1,
                direction: It
            },
            getTouchAction: function() {
                var t = this.options.direction
                  , e = [];
                return t & Dt && e.push(ie),
                t & Rt && e.push(ee),
                e
            },
            directionTest: function(t) {
                var e = this.options
                  , i = !0
                  , n = t.distance
                  , r = t.direction
                  , a = t.deltaX
                  , s = t.deltaY;
                return r & e.direction || (e.direction & Dt ? (r = 0 === a ? Et : a < 0 ? Pt : Nt,
                i = a != this.pX,
                n = Math.abs(t.deltaX)) : (r = 0 === s ? Et : s < 0 ? kt : Ft,
                i = s != this.pY,
                n = Math.abs(t.deltaY))),
                t.direction = r,
                i && n > e.threshold && r & e.direction
            },
            attrTest: function(t) {
                return et.prototype.attrTest.call(this, t) && (this.state & re || !(this.state & re) && this.directionTest(t))
            },
            emit: function(t) {
                this.pX = t.deltaX,
                this.pY = t.deltaY;
                var e = $(t.direction);
                e && this.manager.emit(this.options.event + e, t),
                this._super.emit.call(this, t)
            }
        }),
        p(nt, et, {
            defaults: {
                event: "pinch",
                threshold: 0,
                pointers: 2
            },
            getTouchAction: function() {
                return [te]
            },
            attrTest: function(t) {
                return this._super.attrTest.call(this, t) && (Math.abs(t.scale - 1) > this.options.threshold || this.state & re)
            },
            emit: function(t) {
                if (this._super.emit.call(this, t),
                1 !== t.scale) {
                    var e = t.scale < 1 ? "in" : "out";
                    this.manager.emit(this.options.event + e, t)
                }
            }
        }),
        p(rt, Q, {
            defaults: {
                event: "press",
                pointers: 1,
                time: 500,
                threshold: 5
            },
            getTouchAction: function() {
                return [Zt]
            },
            process: function(t) {
                var e = this.options
                  , i = t.pointers.length === e.pointers
                  , n = t.distance < e.threshold
                  , r = t.deltaTime > e.time;
                if (this._input = t,
                !n || !i || t.eventType & (Tt | At) && !r)
                    this.reset();
                else if (t.eventType & Ct)
                    this.reset(),
                    this._timer = l(function() {
                        this.state = oe,
                        this.tryEmit()
                    }, e.time, this);
                else if (t.eventType & Tt)
                    return oe;
                return 32
            },
            reset: function() {
                clearTimeout(this._timer)
            },
            emit: function(t) {
                this.state === oe && (t && t.eventType & Tt ? this.manager.emit(this.options.event + "up", t) : (this._input.timeStamp = vt(),
                this.manager.emit(this.options.event, this._input)))
            }
        }),
        p(at, et, {
            defaults: {
                event: "rotate",
                threshold: 0,
                pointers: 2
            },
            getTouchAction: function() {
                return [te]
            },
            attrTest: function(t) {
                return this._super.attrTest.call(this, t) && (Math.abs(t.rotation) > this.options.threshold || this.state & re)
            }
        }),
        p(st, et, {
            defaults: {
                event: "swipe",
                threshold: 10,
                velocity: .65,
                direction: Dt | Rt,
                pointers: 1
            },
            getTouchAction: function() {
                return it.prototype.getTouchAction.call(this)
            },
            attrTest: function(t) {
                var e, i = this.options.direction;
                return i & (Dt | Rt) ? e = t.velocity : i & Dt ? e = t.velocityX : i & Rt && (e = t.velocityY),
                this._super.attrTest.call(this, t) && i & t.direction && t.distance > this.options.threshold && mt(e) > this.options.velocity && t.eventType & Tt
            },
            emit: function(t) {
                var e = $(t.direction);
                e && this.manager.emit(this.options.event + e, t),
                this.manager.emit(this.options.event, t)
            }
        }),
        p(ot, Q, {
            defaults: {
                event: "tap",
                pointers: 1,
                taps: 1,
                interval: 300,
                time: 250,
                threshold: 2,
                posThreshold: 10
            },
            getTouchAction: function() {
                return [$t]
            },
            process: function(t) {
                var e = this.options
                  , i = t.pointers.length === e.pointers
                  , n = t.distance < e.threshold
                  , r = t.deltaTime < e.time;
                if (this.reset(),
                t.eventType & Ct && 0 === this.count)
                    return this.failTimeout();
                if (n && r && i) {
                    if (t.eventType != Tt)
                        return this.failTimeout();
                    var a = !this.pTime || t.timeStamp - this.pTime < e.interval
                      , s = !this.pCenter || B(this.pCenter, t.center) < e.posThreshold;
                    this.pTime = t.timeStamp,
                    this.pCenter = t.center,
                    s && a ? this.count += 1 : this.count = 1,
                    this._input = t;
                    if (0 === this.count % e.taps)
                        return this.hasRequireFailures() ? (this._timer = l(function() {
                            this.state = oe,
                            this.tryEmit()
                        }, e.interval, this),
                        re) : oe
                }
                return 32
            },
            failTimeout: function() {
                return this._timer = l(function() {
                    this.state = 32
                }, this.options.interval, this),
                32
            },
            reset: function() {
                clearTimeout(this._timer)
            },
            emit: function() {
                this.state == oe && (this._input.tapCount = this.count,
                this.manager.emit(this.options.event, this._input))
            }
        }),
        lt.VERSION = "2.0.4",
        lt.defaults = {
            domEvents: !1,
            touchAction: "compute",
            enable: !0,
            inputTarget: null,
            inputClass: null,
            preset: [[at, {
                enable: !1
            }], [nt, {
                enable: !1
            }, ["rotate"]], [st, {
                direction: Dt
            }], [it, {
                direction: Dt
            }, ["swipe"]], [ot], [ot, {
                event: "doubletap",
                taps: 2
            }, ["tap"]], [rt]],
            cssProps: {
                userSelect: "none",
                touchSelect: "none",
                touchCallout: "none",
                contentZooming: "none",
                userDrag: "none",
                tapHighlightColor: "rgba(0,0,0,0)"
            }
        };
        ut.prototype = {
            set: function(t) {
                return c(this.options, t),
                t.touchAction && this.touchAction.update(),
                t.inputTarget && (this.input.destroy(),
                this.input.target = t.inputTarget,
                this.input.init()),
                this
            },
            stop: function(t) {
                this.session.stopped = t ? 2 : 1
            },
            recognize: function(t) {
                var e = this.session;
                if (!e.stopped) {
                    this.touchAction.preventDefaults(t);
                    var i, n = this.recognizers, r = e.curRecognizer;
                    (!r || r && r.state & oe) && (r = e.curRecognizer = null);
                    for (var a = 0; a < n.length; )
                        i = n[a],
                        2 === e.stopped || r && i != r && !i.canRecognizeWith(r) ? i.reset() : i.recognize(t),
                        !r && i.state & (re | ae | se) && (r = e.curRecognizer = i),
                        a++
                }
            },
            get: function(t) {
                if (t instanceof Q)
                    return t;
                for (var e = this.recognizers, i = 0; i < e.length; i++)
                    if (e[i].options.event == t)
                        return e[i];
                return null
            },
            add: function(t) {
                if (u(t, "add", this))
                    return this;
                var e = this.get(t.options.event);
                return e && this.remove(e),
                this.recognizers.push(t),
                t.manager = this,
                this.touchAction.update(),
                t
            },
            remove: function(t) {
                if (u(t, "remove", this))
                    return this;
                var e = this.recognizers;
                return t = this.get(t),
                e.splice(S(e, t), 1),
                this.touchAction.update(),
                this
            },
            on: function(t, e) {
                var i = this.handlers;
                return h(y(t), function(t) {
                    i[t] = i[t] || [],
                    i[t].push(e)
                }),
                this
            },
            off: function(t, e) {
                var i = this.handlers;
                return h(y(t), function(t) {
                    e ? i[t].splice(S(i[t], e), 1) : delete i[t]
                }),
                this
            },
            emit: function(t, e) {
                this.options.domEvents && ct(t, e);
                var i = this.handlers[t] && this.handlers[t].slice();
                if (i && i.length) {
                    e.type = t,
                    e.preventDefault = function() {
                        e.srcEvent.preventDefault()
                    }
                    ;
                    for (var n = 0; n < i.length; )
                        i[n](e),
                        n++
                }
            },
            destroy: function() {
                this.element && ht(this, !1),
                this.handlers = {},
                this.session = {},
                this.input.destroy(),
                this.element = null
            }
        },
        c(lt, {
            INPUT_START: Ct,
            INPUT_MOVE: Mt,
            INPUT_END: Tt,
            INPUT_CANCEL: At,
            STATE_POSSIBLE: ne,
            STATE_BEGAN: re,
            STATE_CHANGED: ae,
            STATE_ENDED: se,
            STATE_RECOGNIZED: oe,
            STATE_CANCELLED: le,
            STATE_FAILED: 32,
            DIRECTION_NONE: Et,
            DIRECTION_LEFT: Pt,
            DIRECTION_RIGHT: Nt,
            DIRECTION_UP: kt,
            DIRECTION_DOWN: Ft,
            DIRECTION_HORIZONTAL: Dt,
            DIRECTION_VERTICAL: Rt,
            DIRECTION_ALL: It,
            Manager: ut,
            Input: E,
            TouchAction: K,
            TouchInput: q,
            MouseInput: z,
            PointerEventInput: H,
            TouchMouseInput: X,
            SingleTouchInput: j,
            Recognizer: Q,
            AttrRecognizer: et,
            Tap: ot,
            Pan: it,
            Swipe: st,
            Pinch: nt,
            Rotate: at,
            Press: rt,
            on: v,
            off: _,
            each: h,
            merge: d,
            extend: c,
            inherit: p,
            bindFn: f,
            prefixed: M
        }),
        "function" == ft && i(444) ? (n = function() {
            return lt
        }
        .call(e, i, e, t)) !== o && (t.exports = n) : void 0 !== t && t.exports ? t.exports = lt : r.Hammer = lt
    }(window, document)
}
, , , function(t, e, i) {
    "use strict";
    var n = i(6);
    e.a = n.a.extend({
        constructor: function(t) {
            this.viewer = t.viewer,
            this.widgets = t.widgets,
            n.a.apply(this, arguments)
        },
        enable: function() {
            this.$el.removeClass("disabled")
        },
        disable: function() {
            this.$el.addClass("disabled")
        },
        isEnabled: function() {
            return this.$el.hasClass("disabled")
        }
    })
}
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(325)
      , a = i(430)
      , s = i(5).mat4
      , o = i(93)
      , l = i(144)
      , u = i(5).vec4
      , h = function() {
        r.call(this),
        a.call(this),
        this.viewport = void 0,
        this._graphicContext = void 0,
        this.setClearColor(u.fromValues(0, 0, 0, 1)),
        this.setClearDepth(1),
        this.setClearMask(h.COLOR_BUFFER_BIT | h.DEPTH_BUFFER_BIT),
        this.setViewMatrix(s.create()),
        this.setProjectionMatrix(s.create()),
        this.renderOrder = h.NESTED_RENDER,
        this.renderOrderNum = 0,
        this._view = void 0,
        this._renderer = void 0,
        this._attachments = {}
    };
    h.PRE_RENDER = 0,
    h.NESTED_RENDER = 1,
    h.POST_RENDER = 2,
    h.COLOR_BUFFER_BIT = 16384,
    h.DEPTH_BUFFER_BIT = 256,
    h.STENCIL_BUFFER_BIT = 1024,
    h.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, n.objectInherit(r.prototype, {
        getView: function() {
            return this._view
        },
        setView: function(t) {
            this._view = t
        },
        getRenderer: function() {
            return this._renderer
        },
        setRenderer: function(t) {
            this._renderer = t
        },
        setFinalDrawCallback: function(t) {
            this._finalDrawCallback = t
        },
        getFinalDrawCallback: function() {
            return this._finalDrawCallback
        },
        setInitialDrawCallback: function(t) {
            this._initialDrawCallback = t
        },
        getInitialDrawCallback: function() {
            return this._initialDrawCallback
        },
        getAttachments: function() {
            return this._attachments
        },
        setGraphicContext: function(t) {
            this._graphicContext = t
        },
        getGraphicContext: function() {
            return this._graphicContext
        },
        setClearDepth: function(t) {
            this.clearDepth = t
        },
        getClearDepth: function() {
            return this.clearDepth
        },
        setClearMask: function(t) {
            this.clearMask = t
        },
        getClearMask: function() {
            return this.clearMask
        },
        setClearColor: function(t) {
            this.clearColor = t
        },
        getClearColor: function() {
            return this.clearColor
        },
        setViewport: function(t) {
            this.viewport = t,
            this.getOrCreateStateSet().setAttributeAndModes(t)
        },
        getViewport: function() {
            return this.viewport
        },
        setViewMatrix: function(t) {
            this.modelviewMatrix = t
        },
        setViewMatrixAsLookAt: function(t, e, i) {
            s.lookAt(this.getViewMatrix(), t, e, i)
        },
        setProjectionMatrix: function(t) {
            this.projectionMatrix = t
        },
        setProjectionMatrixAsOrtho: function(t, e, i, n, r, a) {
            s.ortho(this.getProjectionMatrix(), t, e, i, n, r, a)
        },
        isRenderToTextureCamera: function() {
            return window.Object.keys(this._attachments).length > 0
        },
        getViewMatrix: function() {
            return this.modelviewMatrix
        },
        getProjectionMatrix: function() {
            return this.projectionMatrix
        },
        getRenderOrder: function() {
            return this.renderOrder
        },
        setRenderOrder: function(t, e) {
            this.renderOrder = t,
            this.renderOrderNum = e
        },
        detachAll: function() {
            this._attachments = {},
            this.frameBufferObject && this.frameBufferObject.dirty()
        },
        resetAttachments: function() {
            this.frameBufferObject && (this.frameBufferObject.reset(),
            this.frameBufferObject = 0),
            this._attachments = {}
        },
        attachTexture: function(t, e, i) {
            this.frameBufferObject && this.frameBufferObject.dirty(),
            i || (i = o.TEXTURE_2D),
            this._attachments[t] = {
                attachment: t,
                texture: e,
                textureTarget: i
            }
        },
        attachRenderBuffer: function(t, e) {
            this.frameBufferObject && this.frameBufferObject.dirty(),
            this._attachments[t] = {
                format: e,
                attachment: t
            }
        },
        computeLocalToWorldMatrix: function(t) {
            return this.referenceFrame === l.RELATIVE_RF ? s.mul(t, t, this.modelviewMatrix) : s.copy(t, this.modelviewMatrix),
            !0
        },
        computeWorldToLocalMatrix: function() {
            var t = s.create();
            return function(e) {
                return s.invert(t, this.modelviewMatrix),
                this.referenceFrame === l.RELATIVE_RF ? s.mul(e, t, e) : s.copy(e, t),
                !0
            }
        }()
    })), "osg", "Camera"),
    n.setTypeID(h),
    t.exports = h
}
, , , , , , function(t, e, i) {
    var n, r;
    !function(a, s) {
        "use strict";
        n = s,
        void 0 !== (r = "function" == typeof n ? n.call(e, i, e, t) : n) && (t.exports = r)
    }(0, function() {
        "use strict";
        var t = {};
        return t.sanitize = function(t, e) {
            var i = ["a", "abbr", "acronym", "address", "area", "article", "aside", "audio", "b", "bdi", "bdo", "big", "blink", "blockquote", "body", "br", "button", "canvas", "caption", "center", "cite", "code", "col", "colgroup", "content", "data", "datalist", "dd", "decorator", "del", "details", "dfn", "dir", "div", "dl", "dt", "element", "em", "fieldset", "figcaption", "figure", "font", "footer", "form", "h1", "h2", "h3", "h4", "h5", "h6", "head", "header", "hgroup", "hr", "html", "i", "img", "input", "ins", "kbd", "label", "legend", "li", "main", "map", "mark", "marquee", "menu", "menuitem", "meter", "nav", "nobr", "ol", "optgroup", "option", "output", "p", "pre", "progress", "q", "rp", "rt", "ruby", "s", "samp", "section", "select", "shadow", "small", "source", "spacer", "span", "strike", "strong", "style", "sub", "summary", "sup", "table", "tbody", "td", "template", "textarea", "tfoot", "th", "thead", "time", "tr", "track", "tt", "u", "ul", "var", "video", "wbr", "svg", "altglyph", "altglyphdef", "altglyphitem", "animatecolor", "animatemotion", "animatetransform", "circle", "clippath", "defs", "desc", "ellipse", "font", "g", "glyph", "glyphref", "hkern", "image", "line", "lineargradient", "marker", "mask", "metadata", "mpath", "path", "pattern", "polygon", "polyline", "radialgradient", "rect", "stop", "switch", "symbol", "text", "textpath", "title", "tref", "tspan", "view", "vkern", "math", "menclose", "merror", "mfenced", "mfrac", "mglyph", "mi", "mlabeledtr", "mmuliscripts", "mn", "mo", "mover", "mpadded", "mphantom", "mroot", "mrow", "ms", "mpspace", "msqrt", "mystyle", "msub", "msup", "msubsup", "mtable", "mtd", "mtext", "mtr", "munder", "munderover", "#text"]
              , n = !0
              , r = ["accept", "action", "align", "alt", "autocomplete", "bgcolor", "border", "checked", "cite", "class", "color", "cols", "colspan", "coords", "datetime", "default", "dir", "disabled", "download", "enctype", "for", "headers", "height", "hidden", "high", "href", "hreflang", "id", "ismap", "label", "lang", "list", "loop", "low", "max", "maxlength", "media", "method", "min", "multiple", "name", "novalidate", "open", "optimum", "pattern", "placeholder", "poster", "preload", "pubdate", "radiogroup", "readonly", "rel", "required", "rev", "reversed", "rows", "rowspan", "spellcheck", "scope", "selected", "shape", "size", "span", "srclang", "start", "src", "step", "style", "summary", "tabindex", "title", "type", "usemap", "valign", "value", "width", "xmlns", "accent-height", "accumulate", "additivive", "alignment-baseline", "ascent", "azimuth", "baseline-shift", "bias", "clip", "clip-path", "clip-rule", "color", "color-interpolation", "color-interpolation-filters", "color-profile", "color-rendering", "cx", "cy", "d", "dy", "dy", "direction", "display", "divisor", "dur", "elevation", "end", "fill", "fill-opacity", "fill-rule", "filter", "flood-color", "flood-opacity", "font-family", "font-size", "font-size-adjust", "font-stretch", "font-style", "font-variant", "front-weight", "image-rendering", "in", "in2", "k1", "k2", "k3", "k4", "kerning", "letter-spacing", "lighting-color", "local", "marker-end", "marker-mid", "marker-start", "max", "mask", "mode", "min", "operator", "opacity", "order", "overflow", "paint-order", "path", "points", "r", "rx", "ry", "radius", "restart", "scale", "seed", "shape-rendering", "stop-color", "stop-opacity", "stroke-dasharray", "stroke-dashoffset", "stroke-linecap", "stroke-linejoin", "stroke-miterlimit", "stroke-opacity", "stroke", "stroke-width", "transform", "text-anchor", "text-decoration", "text-rendering", "u1", "u2", "viewbox", "visibility", "word-spacing", "wrap", "writing-mode", "x", "x1", "x2", "y", "y1", "y2", "z", "accent", "accentunder", "bevelled", "close", "columnsalign", "columnlines", "columnspan", "denomalign", "depth", "display", "displaystyle", "fence", "frame", "largeop", "length", "linethickness", "lspace", "lquote", "mathbackground", "mathcolor", "mathsize", "mathvariant", "maxsize", "minsize", "movablelimits", "notation", "numalign", "open", "rowalign", "rowlines", "rowspacing", "rowspan", "rspace", "rquote", "scriptlevel", "scriptminsize", "scriptsizemultiplier", "selection", "separator", "separators", "stretchy", "subscriptshift", "supscriptshift", "symmetric", "voffset", "xlink:href", "xml:id", "xlink:title", "xml:space"]
              , a = !1
              , s = !1
              , o = !1
              , l = !0
              , u = !0
              , h = ["a", "abbr", "acronym", "address", "article", "aside", "b", "bdi", "bdo", "big", "blink", "blockquote", "caption", "center", "cite", "code", "col", "dd", "del", "details", "dfn", "dir", "div", "dl", "dt", "em", "figcaption", "figure", "footer", "h1", "h2", "h3", "h4", "h5", "h6", "header", "i", "ins", "kbd", "label", "legend", "li", "main", "mark", "marquee", "nav", "ol", "output", "p", "pre", "q", "rp", "rt", "ruby", "s", "samp", "section", "small", "span", "strike", "strong", "sub", "summary", "sup", "table", "tbody", "td", "tfoot", "th", "thead", "time", "tr", "tt", "u", "ul", "var"]
              , c = function(t) {
                return document.createNodeIterator(t, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT, function() {
                    return NodeFilter.FILTER_ACCEPT
                }, !1)
            }
              , d = function(t) {
                return !(t instanceof Text) && !!(t.children && !(t.children instanceof HTMLCollection) || t.attributes instanceof NodeList || "string" != typeof t.nodeName || "string" != typeof t.textContent || "number" != typeof t.nodeType || "number" != typeof t.COMMENT_NODE || "function" != typeof t.setAttribute || "function" != typeof t.cloneNode || "function" != typeof t.removeAttributeNode || "function" != typeof t.insertAdjacentHTML || "function" != typeof t.attributes.item)
            }
              , p = function(t) {
                if (d(t)) {
                    try {
                        t.parentNode.removeChild(t)
                    } catch (e) {
                        t.outerHTML = ""
                    }
                    return !0
                }
                if (t.nodeType === t.COMMENT_NODE || -1 === i.indexOf(t.nodeName.toLowerCase())) {
                    if (u && t.insertAdjacentHTML && t.nodeName.toLowerCase && -1 !== h.indexOf(t.nodeName.toLowerCase()))
                        try {
                            t.insertAdjacentHTML("AfterEnd", t.innerHTML)
                        } catch (t) {}
                    return t.parentNode.removeChild(t),
                    !0
                }
                return o && !t.firstElementChild && (t.textContent = t.textContent.replace(/</g, "&lt;")),
                !1
            }
              , f = function(t) {
                var e, i, a = t.cloneNode(!0);
                if (t.attributes)
                    for (var s = t.attributes.length - 1; s >= 0; s--)
                        e = a.attributes[s],
                        i = !1,
                        t.removeAttribute(t.attributes[s].name),
                        e instanceof Attr && (l && ("id" === e.name && window[e.value] && (i = !0),
                        "name" === e.name && document[e.value] && (i = !0)),
                        !(r.indexOf(e.name.toLowerCase()) > -1 || n && e.name.match(/^data-[\w-]+/i)) || e.value.replace(/[\x00-\x20]/g, "").match(/^(\w+script|data):/gi) && ("src" !== e.name || 0 !== e.value.indexOf("data:") || "IMG" !== e.ownerElement.nodeName) || i || t.setAttribute(e.name, e.value))
            }
              , g = function(t) {
                for (var e, i = c(t); e = i.nextNode(); )
                    p(e) || (e.content instanceof DocumentFragment && g(e.content),
                    f(e))
            };
            e && function(t) {
                t.ALLOWED_ATTR && (r = t.ALLOWED_ATTR),
                t.ALLOWED_TAGS && (i = t.ALLOWED_TAGS),
                t.ALLOW_DATA_ATTR && (n = t.ALLOW_DATA_ATTR),
                t.SAFE_FOR_JQUERY && (o = t.SAFE_FOR_JQUERY),
                t.WHOLE_DOCUMENT && (a = t.WHOLE_DOCUMENT),
                t.RETURN_DOM && (s = t.RETURN_DOM),
                t.SANITIZE_DOM && (l = t.SANITIZE_DOM),
                t.KEEP_CONTENT && (u = t.KEEP_CONTENT),
                t.ADD_ATTR && (r = r.concat(t.ADD_ATTR)),
                t.ADD_TAGS && (i = i.concat(t.ADD_TAGS)),
                u && i.push("#text")
            }(e);
            var m = function(t) {
                var e = document.implementation.createHTMLDocument("");
                e.body.parentNode.removeChild(e.body.parentNode.firstElementChild),
                e.body.outerHTML = t,
                null === e.body && (e.body.innerHTML = t);
                var i = a ? e.body.parentNode : e.body;
                if (!(e.body instanceof HTMLBodyElement && e.body instanceof HTMLHtmlElement)) {
                    var n = document.implementation.createHTMLDocument("");
                    i = a ? n.getElementsByTagName.call(e, "html")[0] : n.getElementsByTagName.call(e, "body")[0]
                }
                return i
            }(t);
            if (void 0 === m)
                return "";
            for (var v, _ = c(m); v = _.nextNode(); )
                p(v) || (v.content instanceof DocumentFragment && g(v.content),
                f(v));
            return s ? m : a ? m.outerHTML : m.innerHTML
        }
        ,
        t
    })
}
, function(t, e, i) {
    "use strict";
    function n(t, e) {
        var i, r, a = /(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi, s = /(^[ ]*|[ ]*$)/g, o = /(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/, l = /^0x[0-9a-f]+$/i, u = function(t) {
            return n.insensitive && ("" + t).toLowerCase() || "" + t
        }, h = u(t).slice(0, 50).replace(s, "") || "", c = u(e).slice(0, 50).replace(s, "") || "", d = h.replace(a, "\0$1\0").replace(/\0$/, "").replace(/^\0/, "").split("\0"), p = c.replace(a, "\0$1\0").replace(/\0$/, "").replace(/^\0/, "").split("\0"), f = parseInt(h.match(l)) || 1 !== d.length && h.match(o) && Date.parse(h), g = parseInt(c.match(l)) || f && c.match(o) && Date.parse(c) || null;
        if (g) {
            if (f < g)
                return -1;
            if (f > g)
                return 1
        }
        for (var m = 0, v = Math.max(d.length, p.length); m < v; m++) {
            if (i = !(d[m] || "").match(/^0/) && parseFloat(d[m]) || d[m] || 0,
            r = !(p[m] || "").match(/^0/) && parseFloat(p[m]) || p[m] || 0,
            isNaN(i) !== isNaN(r))
                return isNaN(i) ? 1 : -1;
            if (typeof i != typeof r && (i += "",
            r += ""),
            i < r)
                return -1;
            if (i > r)
                return 1
        }
        return 0
    }
    e.a = n
}
, , , , , , , function(t, e, i) {
    "use strict";
    var n, r = i(396), a = i(167);
    n = a.a.extend({
        model: r.a,
        _immutableCollectionName: "skills",
        url: "/i/skills"
    }),
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = i(85)
      , r = i(66)
      , a = i(13)
      , s = function() {
        n.call(this),
        this._parents = [],
        this.attributeMap = {},
        this.textureAttributeMapList = [],
        this._binName = void 0,
        this._binNumber = 0,
        this._shaderGeneratorPair = null,
        this._updateCallbackList = [],
        this.uniforms = {},
        this._drawID = -1
    };
    s.AttributePair = function(t, e) {
        this._object = t,
        this._value = e
    }
    ,
    s.AttributePair.prototype = {
        getShaderGeneratorName: function() {
            return this._object
        },
        getAttribute: function() {
            return this._object
        },
        getUniform: function() {
            return this._object
        },
        getValue: function() {
            return this._value
        }
    },
    s.prototype = a.objectLibraryClass(a.objectInherit(n.prototype, {
        setDrawID: function(t) {
            this._drawID = t
        },
        getDrawID: function() {
            return this._drawID
        },
        getAttributePair: function(t, e) {
            return new s.AttributePair(t,e)
        },
        addUniform: function(t, e) {
            var i = void 0 !== e ? e : r.ON
              , n = t.getName();
            this.uniforms[n] = this.getAttributePair(t, i)
        },
        addParent: function(t) {
            this._parents.push(t)
        },
        removeParent: function(t) {
            var e = this._parents.indexOf(t);
            -1 !== e && this._parents.splice(e, 1)
        },
        removeUniform: function(t) {
            delete this.uniforms[t.getName()]
        },
        removeUniformByName: function(t) {
            delete this.uniforms[t]
        },
        getUniform: function(t) {
            var e = this.uniforms;
            if (e[t])
                return e[t].getAttribute()
        },
        getUniformList: function() {
            return this.uniforms
        },
        setTextureAttributeAndModes: function(t, e, i) {
            var n = void 0 !== i ? i : r.ON;
            this._setTextureAttribute(t, this.getAttributePair(e, n))
        },
        getNumTextureAttributeLists: function() {
            return this.textureAttributeMapList.length
        },
        getTextureAttribute: function(t, e) {
            if (void 0 !== this.textureAttributeMapList[t]) {
                var i = this.textureAttributeMapList[t];
                if (void 0 !== i[e])
                    return i[e].getAttribute()
            }
        },
        removeTextureAttribute: function(t, e) {
            if (void 0 !== this.textureAttributeMapList[t]) {
                var i = this.textureAttributeMapList[t];
                void 0 !== i[e] && delete i[e]
            }
        },
        getAttribute: function(t) {
            if (void 0 !== this.attributeMap[t])
                return this.attributeMap[t].getAttribute()
        },
        setAttributeAndModes: function(t, e) {
            var i = void 0 !== e ? e : r.ON;
            this._setAttribute(this.getAttributePair(t, i))
        },
        setAttribute: function(t, e) {
            var i = void 0 !== e ? e : r.ON;
            this._setAttribute(this.getAttributePair(t, i))
        },
        removeAttribute: function(t) {
            void 0 !== this.attributeMap[t] && delete this.attributeMap[t]
        },
        setRenderingHint: function(t) {
            "OPAQUE_BIN" === t ? this.setRenderBinDetails(0, "RenderBin") : "TRANSPARENT_BIN" === t ? this.setRenderBinDetails(10, "DepthSortedBin") : this.setRenderBinDetails(0, "")
        },
        getUpdateCallbackList: function() {
            return this._updateCallbackList
        },
        removeUpdateCallback: function(t) {
            var e = this._updateCallbackList.indexOf(t);
            if (-1 !== e && (this._updateCallbackList.splice(e, 1),
            0 === this._updateCallbackList.length))
                for (var i = this._parents, n = 0, r = i.length; n < r; n++) {
                    var a = i[n];
                    a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal() - 1)
                }
        },
        requiresUpdateTraversal: function() {
            return !!this._updateCallbackList.length
        },
        addUpdateCallback: function(t) {
            var e = Boolean(this._updateCallbackList.length);
            if (this._updateCallbackList.push(t),
            !e)
                for (var i = this._parents, n = 0, r = i.length; n < r; n++) {
                    var a = i[n];
                    a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal() + 1)
                }
        },
        hasUpdateCallback: function(t) {
            return -1 !== this._updateCallbackList.indexOf(t)
        },
        setRenderBinDetails: function(t, e) {
            this._binNumber = t,
            this._binName = e
        },
        getAttributeMap: function() {
            return this.attributeMap
        },
        getBinNumber: function() {
            return this._binNumber
        },
        getBinName: function() {
            return this._binName
        },
        setBinNumber: function(t) {
            this._binNumber = t
        },
        setBinName: function(t) {
            this._binName = t
        },
        getAttributeList: function() {
            var t = [];
            for (var e in this.attributeMap)
                t.push(this.attributeMap[e]);
            return t
        },
        setShaderGeneratorName: function(t, e) {
            this._shaderGeneratorPair = this.getAttributePair(t, e)
        },
        getShaderGeneratorPair: function() {
            return this._shaderGeneratorPair
        },
        getShaderGeneratorName: function() {
            return this._shaderGeneratorPair ? this._shaderGeneratorPair.getShaderGeneratorName() : void 0
        },
        releaseGLObjects: function() {
            for (var t = 0, e = this.textureAttributeMapList.length; t < e; t++)
                this.getTextureAttribute(t, "Texture").releaseGLObjects();
            var i = this.getAttributeList();
            for (t = 0,
            e = i.length; t < e; t++)
                i[t]._object.releaseGLObjects && i[t]._object.releaseGLObjects()
        },
        _getUniformMap: function() {
            return this.uniforms
        },
        _setTextureAttribute: function(t, e) {
            void 0 === this.textureAttributeMapList[t] && (this.textureAttributeMapList[t] = {});
            var i = e.getAttribute().getTypeMember();
            this.textureAttributeMapList[t][i] = e
        },
        _setAttribute: function(t) {
            var e = t.getAttribute().getTypeMember();
            this.attributeMap[e] = t
        }
    }), "osg", "StateSet"),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e) {
        if (!t || !e)
            return "";
        var i;
        for (var n in e)
            void 0 !== (i = e[n]) && (i.getVariable && (i = i.getVariable()),
            t = t.replace("%s", i));
        return t
    }
      , r = function(t, e) {
        var i = t
          , n = []
          , r = e;
        void 0 === e && (r = "");
        for (var a = 0, s = i.length; a < s; a++) {
            var o, l = i[a];
            o = void 0 === l ? "undefined" : "string" == typeof l ? l : l.getType ? l.getType() + " " + l.getVariable() : l.getVariable(),
            n.push(r + o)
        }
        return n
    }
      , a = function(t, e, n) {
        var a = i(534)
          , s = []
          , o = "";
        if (a.debugShaderNode && (s.push("\n// output"),
        Array.prototype.push.apply(s, r([e], "// "))),
        e && (e.getVariable && (e = e.getVariable()),
        o = e + " = "),
        o = o + t + "( ",
        n && n.length > 0) {
            a.debugShaderNode && (s.push("// inputs"),
            Array.prototype.push.apply(s, r(n, "// ")));
            for (var l = 0, u = n.length; l < u; l++)
                n[l].getVariable ? o += n[l].getVariable() : o += n[l],
                l !== u - 1 && (o += ", ")
        }
        return o += " );\n",
        a.debugShaderNode ? s.join("\n") + "\n" + o : o
    };
    t.exports = {
        callFunction: a,
        checkVariableType: r,
        sprintf: n
    }
}
, , , function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(328)
      , a = i(383)
      , s = n.a.osg
      , o = n.a.osgShader
      , l = o.ShaderGenerator
      , u = {
        osgSketchfab: !0,
        osgAnimation: !0,
        osgShadow: !0
    }
      , h = function() {
        l.apply(this, arguments),
        this.setShaderCompiler(a.a),
        this._idCompiler = r.a.SHADING_COMPILER
    };
    h.prototype = s.objectInherit(l.prototype, {
        filterAttributeTypes: function(t) {
            return !u[t.libraryName()] && t.typeID !== s.PointSizeAttribute.typeID || !(!t.isEnabled || t.isEnabled())
        },
        getOrCreateProgram: function(t) {
            return r.a.CURRENT_COMPILER = this._idCompiler,
            l.prototype.getOrCreateProgram.call(this, t)
        }
    }),
    e.a = h
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e, i) {
        return !!Number.isInteger(t) && (!(void 0 !== e && t < e) && !(void 0 !== i && t > i))
    }
      , r = function(t, e, i) {
        return !("number" != typeof t || isNaN(t) || !isFinite(t)) && (!(void 0 !== e && t < e) && !(void 0 !== i && t > i))
    }
      , a = function(t, e, i, n) {
        if (void 0 === t.length)
            return !1;
        if (t.length !== e)
            return !1;
        for (var a = 0; a < e; a++)
            if (!r(t[a], i, n))
                return !1;
        return !0
    }
      , s = function(t, e, i, r) {
        if (void 0 === t.length)
            return !1;
        if (t.length !== e)
            return !1;
        for (var a = 0; a < e; a++)
            if (!n(t[a], i, r))
                return !1;
        return !0
    }
      , o = function(t) {
        return "boolean" == typeof t
    }
      , l = function(t) {
        return "string" == typeof t
    }
      , u = function(t, e) {
        return !!Array.isArray(t) && t.length === e
    }
      , h = function(t, e) {
        return -1 !== e.indexOf(t) && l(t)
    }
      , c = function(t, e) {
        return -1 !== e.indexOf(t) && n(t)
    };
    e.a = {
        isInteger: n,
        isNumber: r,
        isArrayNumber: a,
        isArrayInteger: s,
        isBoolean: o,
        isString: l,
        isArray: u,
        isEnumString: h,
        isEnumInteger: c
    }
}
, function(t, e, i) {
    "use strict";
    var n = !1
      , r = function(t) {
        return void 0 !== t && (n = t),
        n
    };
    e.a = r
}
, , , , function(t, e, i) {
    /*! Browser bundle of nunjucks 3.0.0  */
    !function(e, i) {
        t.exports = i()
    }(0, function() {
        return function(t) {
            function e(n) {
                if (i[n])
                    return i[n].exports;
                var r = i[n] = {
                    exports: {},
                    id: n,
                    loaded: !1
                };
                return t[n].call(r.exports, r, r.exports, e),
                r.loaded = !0,
                r.exports
            }
            var i = {};
            return e.m = t,
            e.c = i,
            e.p = "",
            e(0)
        }([function(t, e, i) {
            "use strict";
            var n = i(1)
              , r = i(2)
              , a = i(15)
              , s = i(14)
              , o = i(3);
            t.exports = {},
            t.exports.Environment = r.Environment,
            t.exports.Template = r.Template,
            t.exports.Loader = a,
            t.exports.FileSystemLoader = s.FileSystemLoader,
            t.exports.PrecompiledLoader = s.PrecompiledLoader,
            t.exports.WebLoader = s.WebLoader,
            t.exports.compiler = i(7),
            t.exports.parser = i(8),
            t.exports.lexer = i(9),
            t.exports.runtime = i(12),
            t.exports.lib = n,
            t.exports.nodes = i(10),
            t.exports.installJinjaCompat = i(21);
            var l;
            t.exports.configure = function(t, e) {
                e = e || {},
                n.isObject(t) && (e = t,
                t = null);
                var i;
                return s.FileSystemLoader ? i = new s.FileSystemLoader(t,{
                    watch: e.watch,
                    noCache: e.noCache
                }) : s.WebLoader && (i = new s.WebLoader(t,{
                    useCache: e.web && e.web.useCache,
                    async: e.web && e.web.async
                })),
                l = new r.Environment(i,e),
                e && e.express && l.express(e.express),
                l
            }
            ,
            t.exports.compile = function(e, i, n, r) {
                return l || t.exports.configure(),
                new t.exports.Template(e,i,n,r)
            }
            ,
            t.exports.render = function(e, i, n) {
                return l || t.exports.configure(),
                l.render(e, i, n)
            }
            ,
            t.exports.renderString = function(e, i, n) {
                return l || t.exports.configure(),
                l.renderString(e, i, n)
            }
            ,
            o && (t.exports.precompile = o.precompile,
            t.exports.precompileString = o.precompileString)
        }
        , function(t, e) {
            "use strict";
            var i = Array.prototype
              , n = Object.prototype
              , r = {
                "&": "&amp;",
                '"': "&quot;",
                "'": "&#39;",
                "<": "&lt;",
                ">": "&gt;"
            }
              , a = function(t) {
                return r[t]
            }
              , e = t.exports = {};
            e.prettifyError = function(t, i, n) {
                if (n.Update || (n = new e.TemplateError(n)),
                n.Update(t),
                !i) {
                    var r = n;
                    n = new Error(r.message),
                    n.name = r.name
                }
                return n
            }
            ,
            e.TemplateError = function(t, e, i) {
                var n = this;
                if (t instanceof Error) {
                    n = t,
                    t = t.name + ": " + t.message;
                    try {
                        n.name = ""
                    } catch (t) {
                        n = this
                    }
                } else
                    Error.captureStackTrace && Error.captureStackTrace(n);
                return n.name = "Template render error",
                n.message = t,
                n.lineno = e,
                n.colno = i,
                n.firstUpdate = !0,
                n.Update = function(t) {
                    var e = "(" + (t || "unknown path") + ")";
                    return this.firstUpdate && (this.lineno && this.colno ? e += " [Line " + this.lineno + ", Column " + this.colno + "]" : this.lineno && (e += " [Line " + this.lineno + "]")),
                    e += "\n ",
                    this.firstUpdate && (e += " "),
                    this.message = e + (this.message || ""),
                    this.firstUpdate = !1,
                    this
                }
                ,
                n
            }
            ,
            e.TemplateError.prototype = Error.prototype,
            e.escape = function(t) {
                return t.replace(/[&"'<>]/g, a)
            }
            ,
            e.isFunction = function(t) {
                return "[object Function]" === n.toString.call(t)
            }
            ,
            e.isArray = Array.isArray || function(t) {
                return "[object Array]" === n.toString.call(t)
            }
            ,
            e.isString = function(t) {
                return "[object String]" === n.toString.call(t)
            }
            ,
            e.isObject = function(t) {
                return "[object Object]" === n.toString.call(t)
            }
            ,
            e.groupBy = function(t, i) {
                for (var n = {}, r = e.isFunction(i) ? i : function(t) {
                    return t[i]
                }
                , a = 0; a < t.length; a++) {
                    var s = t[a]
                      , o = r(s, a);
                    (n[o] || (n[o] = [])).push(s)
                }
                return n
            }
            ,
            e.toArray = function(t) {
                return Array.prototype.slice.call(t)
            }
            ,
            e.without = function(t) {
                var i = [];
                if (!t)
                    return i;
                for (var n = -1, r = t.length, a = e.toArray(arguments).slice(1); ++n < r; )
                    -1 === e.indexOf(a, t[n]) && i.push(t[n]);
                return i
            }
            ,
            e.extend = function(t, e) {
                for (var i in e)
                    t[i] = e[i];
                return t
            }
            ,
            e.repeat = function(t, e) {
                for (var i = "", n = 0; n < e; n++)
                    i += t;
                return i
            }
            ,
            e.each = function(t, e, n) {
                if (null != t)
                    if (i.each && t.each === i.each)
                        t.forEach(e, n);
                    else if (t.length === +t.length)
                        for (var r = 0, a = t.length; r < a; r++)
                            e.call(n, t[r], r, t)
            }
            ,
            e.map = function(t, e) {
                var n = [];
                if (null == t)
                    return n;
                if (i.map && t.map === i.map)
                    return t.map(e);
                for (var r = 0; r < t.length; r++)
                    n[n.length] = e(t[r], r);
                return t.length === +t.length && (n.length = t.length),
                n
            }
            ,
            e.asyncIter = function(t, e, i) {
                function n() {
                    r++,
                    r < t.length ? e(t[r], r, n, i) : i()
                }
                var r = -1;
                n()
            }
            ,
            e.asyncFor = function(t, i, n) {
                function r() {
                    o++;
                    var e = a[o];
                    o < s ? i(e, t[e], o, s, r) : n()
                }
                var a = e.keys(t)
                  , s = a.length
                  , o = -1;
                r()
            }
            ,
            e.indexOf = Array.prototype.indexOf ? function(t, e, i) {
                return Array.prototype.indexOf.call(t, e, i)
            }
            : function(t, e, i) {
                var n = this.length >>> 0;
                for (i = +i || 0,
                Math.abs(i) === 1 / 0 && (i = 0),
                i < 0 && (i += n) < 0 && (i = 0); i < n; i++)
                    if (t[i] === e)
                        return i;
                return -1
            }
            ,
            Array.prototype.map || (Array.prototype.map = function() {
                throw new Error("map is unimplemented for this js engine")
            }
            ),
            e.keys = function(t) {
                if (Object.prototype.keys)
                    return t.keys();
                var e = [];
                for (var i in t)
                    t.hasOwnProperty(i) && e.push(i);
                return e
            }
            ,
            e.inOperator = function(t, i) {
                if (e.isArray(i))
                    return -1 !== e.indexOf(i, t);
                if (e.isObject(i))
                    return t in i;
                if (e.isString(i))
                    return -1 !== i.indexOf(t);
                throw new Error('Cannot use "in" operator to search for "' + t + '" in unexpected types.')
            }
        }
        , function(t, e, i) {
            "use strict";
            function n(t, e, i) {
                s(function() {
                    t(e, i)
                })
            }
            var r, a = i(3), s = i(4), o = i(1), l = i(6), u = i(7), h = i(13), c = i(14), d = i(12), p = i(17), f = i(18), g = d.Frame;
            c.PrecompiledLoader = i(16);
            var m = l.extend({
                init: function(t, e) {
                    e = this.opts = e || {},
                    this.opts.dev = !!e.dev,
                    this.opts.autoescape = null == e.autoescape || e.autoescape,
                    this.opts.throwOnUndefined = !!e.throwOnUndefined,
                    this.opts.trimBlocks = !!e.trimBlocks,
                    this.opts.lstripBlocks = !!e.lstripBlocks,
                    this.loaders = [],
                    t ? this.loaders = o.isArray(t) ? t : [t] : c.FileSystemLoader ? this.loaders = [new c.FileSystemLoader("views")] : c.WebLoader && (this.loaders = [new c.WebLoader("/views")]),
                    window.nunjucksPrecompiled && this.loaders.unshift(new c.PrecompiledLoader(window.nunjucksPrecompiled)),
                    this.initCache(),
                    this.globals = p(),
                    this.filters = {},
                    this.asyncFilters = [],
                    this.extensions = {},
                    this.extensionsList = [];
                    for (var i in h)
                        this.addFilter(i, h[i])
                },
                initCache: function() {
                    o.each(this.loaders, function(t) {
                        t.cache = {},
                        "function" == typeof t.on && t.on("update", function(e) {
                            t.cache[e] = null
                        })
                    })
                },
                addExtension: function(t, e) {
                    return e._name = t,
                    this.extensions[t] = e,
                    this.extensionsList.push(e),
                    this
                },
                removeExtension: function(t) {
                    var e = this.getExtension(t);
                    e && (this.extensionsList = o.without(this.extensionsList, e),
                    delete this.extensions[t])
                },
                getExtension: function(t) {
                    return this.extensions[t]
                },
                hasExtension: function(t) {
                    return !!this.extensions[t]
                },
                addGlobal: function(t, e) {
                    return this.globals[t] = e,
                    this
                },
                getGlobal: function(t) {
                    if (void 0 === this.globals[t])
                        throw new Error("global not found: " + t);
                    return this.globals[t]
                },
                addFilter: function(t, e, i) {
                    var n = e;
                    return i && this.asyncFilters.push(t),
                    this.filters[t] = n,
                    this
                },
                getFilter: function(t) {
                    if (!this.filters[t])
                        throw new Error("filter not found: " + t);
                    return this.filters[t]
                },
                resolveTemplate: function(t, e, i) {
                    return !(t.isRelative && e && t.isRelative(i) && t.resolve) ? i : t.resolve(e, i)
                },
                getTemplate: function(t, e, i, n, a) {
                    var s = this
                      , l = null;
                    if (t && t.raw && (t = t.raw),
                    o.isFunction(i) && (a = i,
                    i = null,
                    e = e || !1),
                    o.isFunction(e) && (a = e,
                    e = !1),
                    t instanceof r)
                        l = t;
                    else {
                        if ("string" != typeof t)
                            throw new Error("template names must be a string: " + t);
                        for (var u = 0; u < this.loaders.length; u++) {
                            var h = this.resolveTemplate(this.loaders[u], i, t);
                            if (l = this.loaders[u].cache[h])
                                break
                        }
                    }
                    if (!l) {
                        var c, d = this, p = function(i, s) {
                            if (s || i || n || (i = new Error("template not found: " + t)),
                            i) {
                                if (!a)
                                    throw i;
                                a(i)
                            } else {
                                var o;
                                s ? (o = new r(s.src,d,s.path,e),
                                s.noCache || (s.loader.cache[t] = o)) : o = new r("",d,"",e),
                                a ? a(null, o) : c = o
                            }
                        };
                        return o.asyncIter(this.loaders, function(e, n, r, a) {
                            function o(t, i) {
                                t ? a(t) : i ? (i.loader = e,
                                a(null, i)) : r()
                            }
                            t = s.resolveTemplate(e, i, t),
                            e.async ? e.getSource(t, o) : o(null, e.getSource(t))
                        }, p),
                        c
                    }
                    if (e && l.compile(),
                    !a)
                        return l;
                    a(null, l)
                },
                express: function(t) {
                    function e(t, e) {
                        if (this.name = t,
                        this.path = t,
                        this.defaultEngine = e.defaultEngine,
                        this.ext = a.extname(t),
                        !this.ext && !this.defaultEngine)
                            throw new Error("No default engine was specified and no extension was provided.");
                        this.ext || (this.name += this.ext = ("." !== this.defaultEngine[0] ? "." : "") + this.defaultEngine)
                    }
                    var i = this;
                    return e.prototype.render = function(t, e) {
                        i.render(this.name, t, e)
                    }
                    ,
                    t.set("view", e),
                    t.set("nunjucksEnv", this),
                    this
                },
                render: function(t, e, i) {
                    o.isFunction(e) && (i = e,
                    e = null);
                    var r = null;
                    return this.getTemplate(t, function(t, a) {
                        if (t && i)
                            n(i, t);
                        else {
                            if (t)
                                throw t;
                            r = a.render(e, i)
                        }
                    }),
                    r
                },
                renderString: function(t, e, i, n) {
                    return o.isFunction(i) && (n = i,
                    i = {}),
                    i = i || {},
                    new r(t,this,i.path).render(e, n)
                },
                waterfall: f
            })
              , v = l.extend({
                init: function(t, e, i) {
                    this.env = i || new m,
                    this.ctx = {};
                    for (var n in t)
                        t.hasOwnProperty(n) && (this.ctx[n] = t[n]);
                    this.blocks = {},
                    this.exported = [];
                    for (var r in e)
                        this.addBlock(r, e[r])
                },
                lookup: function(t) {
                    return t in this.env.globals && !(t in this.ctx) ? this.env.globals[t] : this.ctx[t]
                },
                setVariable: function(t, e) {
                    this.ctx[t] = e
                },
                getVariables: function() {
                    return this.ctx
                },
                addBlock: function(t, e) {
                    return this.blocks[t] = this.blocks[t] || [],
                    this.blocks[t].push(e),
                    this
                },
                getBlock: function(t) {
                    if (!this.blocks[t])
                        throw new Error('unknown block "' + t + '"');
                    return this.blocks[t][0]
                },
                getSuper: function(t, e, i, n, r, a) {
                    var s = o.indexOf(this.blocks[e] || [], i)
                      , l = this.blocks[e][s + 1]
                      , u = this;
                    if (-1 === s || !l)
                        throw new Error('no super block available for "' + e + '"');
                    l(t, u, n, r, a)
                },
                addExport: function(t) {
                    this.exported.push(t)
                },
                getExported: function() {
                    for (var t = {}, e = 0; e < this.exported.length; e++) {
                        var i = this.exported[e];
                        t[i] = this.ctx[i]
                    }
                    return t
                }
            });
            r = l.extend({
                init: function(t, e, i, n) {
                    if (this.env = e || new m,
                    o.isObject(t))
                        switch (t.type) {
                        case "code":
                            this.tmplProps = t.obj;
                            break;
                        case "string":
                            this.tmplStr = t.obj
                        }
                    else {
                        if (!o.isString(t))
                            throw new Error("src must be a string or an object describing the source");
                        this.tmplStr = t
                    }
                    if (this.path = i,
                    n) {
                        var r = this;
                        try {
                            r._compile()
                        } catch (t) {
                            throw o.prettifyError(this.path, this.env.opts.dev, t)
                        }
                    } else
                        this.compiled = !1
                },
                render: function(t, e, i) {
                    "function" == typeof t ? (i = t,
                    t = {}) : "function" == typeof e && (i = e,
                    e = null);
                    var r = !0;
                    e && (r = !1);
                    var a = this;
                    try {
                        a.compile()
                    } catch (t) {
                        var s = o.prettifyError(this.path, this.env.opts.dev, t);
                        if (i)
                            return n(i, s);
                        throw s
                    }
                    var l = new v(t || {},a.blocks,a.env)
                      , u = e ? e.push(!0) : new g;
                    u.topLevel = !0;
                    var h = null;
                    return a.rootRenderFunc(a.env, l, u || new g, d, function(t, e) {
                        if (t && (t = o.prettifyError(a.path, a.env.opts.dev, t)),
                        i)
                            r ? n(i, t, e) : i(t, e);
                        else {
                            if (t)
                                throw t;
                            h = e
                        }
                    }),
                    h
                },
                getExported: function(t, e, i) {
                    "function" == typeof t && (i = t,
                    t = {}),
                    "function" == typeof e && (i = e,
                    e = null);
                    try {
                        this.compile()
                    } catch (t) {
                        if (i)
                            return i(t);
                        throw t
                    }
                    var n = e ? e.push() : new g;
                    n.topLevel = !0;
                    var r = new v(t || {},this.blocks,this.env);
                    this.rootRenderFunc(this.env, r, n, d, function(t) {
                        t ? i(t, null) : i(null, r.getExported())
                    })
                },
                compile: function() {
                    this.compiled || this._compile()
                },
                _compile: function() {
                    var t;
                    if (this.tmplProps)
                        t = this.tmplProps;
                    else {
                        var e = u.compile(this.tmplStr, this.env.asyncFilters, this.env.extensionsList, this.path, this.env.opts);
                        t = new Function(e)()
                    }
                    this.blocks = this._getBlocks(t),
                    this.rootRenderFunc = t.root,
                    this.compiled = !0
                },
                _getBlocks: function(t) {
                    var e = {};
                    for (var i in t)
                        "b_" === i.slice(0, 2) && (e[i.slice(2)] = t[i]);
                    return e
                }
            }),
            t.exports = {
                Environment: m,
                Template: r
            }
        }
        , function(t, e) {}
        , function(t, e, i) {
            "use strict";
            function n() {
                if (l.length)
                    throw l.shift()
            }
            function r(t) {
                var e;
                e = o.length ? o.pop() : new a,
                e.task = t,
                s(e)
            }
            function a() {
                this.task = null
            }
            var s = i(5)
              , o = []
              , l = []
              , u = s.makeRequestCallFromTimer(n);
            t.exports = r,
            a.prototype.call = function() {
                try {
                    this.task.call()
                } catch (t) {
                    r.onerror ? r.onerror(t) : (l.push(t),
                    u())
                } finally {
                    this.task = null,
                    o[o.length] = this
                }
            }
        }
        , function(t, e) {
            (function(e) {
                "use strict";
                function i(t) {
                    s.length || (a(),
                    o = !0),
                    s[s.length] = t
                }
                function n() {
                    for (; l < s.length; ) {
                        var t = l;
                        if (l += 1,
                        s[t].call(),
                        l > u) {
                            for (var e = 0, i = s.length - l; e < i; e++)
                                s[e] = s[e + l];
                            s.length -= l,
                            l = 0
                        }
                    }
                    s.length = 0,
                    l = 0,
                    o = !1
                }
                function r(t) {
                    return function() {
                        function e() {
                            clearTimeout(i),
                            clearInterval(n),
                            t()
                        }
                        var i = setTimeout(e, 0)
                          , n = setInterval(e, 50)
                    }
                }
                t.exports = i;
                var a, s = [], o = !1, l = 0, u = 1024, h = e.MutationObserver || e.WebKitMutationObserver;
                a = "function" == typeof h ? function(t) {
                    var e = 1
                      , i = new h(t)
                      , n = document.createTextNode("");
                    return i.observe(n, {
                        characterData: !0
                    }),
                    function() {
                        e = -e,
                        n.data = e
                    }
                }(n) : r(n),
                i.requestFlush = a,
                i.makeRequestCallFromTimer = r
            }
            ).call(e, function() {
                return this
            }())
        }
        , function(t, e) {
            "use strict";
            function i(t, e, n) {
                var r = function() {};
                r.prototype = t.prototype;
                var a = new r
                  , s = /xyz/.test(function() {
                    xyz
                }) ? /\bparent\b/ : /.*/;
                n = n || {};
                for (var o in n) {
                    var l = n[o]
                      , u = a[o];
                    "function" == typeof u && "function" == typeof l && s.test(l) ? a[o] = function(t, e) {
                        return function() {
                            var i = this.parent;
                            this.parent = e;
                            var n = t.apply(this, arguments);
                            return this.parent = i,
                            n
                        }
                    }(l, u) : a[o] = l
                }
                a.typename = e;
                var h = function() {
                    a.init && a.init.apply(this, arguments)
                };
                return h.prototype = a,
                h.prototype.constructor = h,
                h.extend = function(t, e) {
                    return "object" == typeof t && (e = t,
                    t = "anonymous"),
                    i(h, t, e)
                }
                ,
                h
            }
            t.exports = i(Object, "Object", {})
        }
        , function(t, e, i) {
            "use strict";
            function n(t) {
                return function(e, i) {
                    this.compile(e.left, i),
                    this.emit(t),
                    this.compile(e.right, i)
                }
            }
            var r = i(1)
              , a = i(8)
              , s = i(11)
              , o = i(10)
              , l = i(6)
              , u = i(12).Frame
              , h = {
                "==": "==",
                "===": "===",
                "!=": "!=",
                "!==": "!==",
                "<": "<",
                ">": ">",
                "<=": "<=",
                ">=": ">="
            }
              , c = l.extend({
                init: function(t, e) {
                    this.templateName = t,
                    this.codebuf = [],
                    this.lastId = 0,
                    this.buffer = null,
                    this.bufferStack = [],
                    this.scopeClosers = "",
                    this.inBlock = !1,
                    this.throwOnUndefined = e
                },
                fail: function(t, e, i) {
                    throw void 0 !== e && (e += 1),
                    void 0 !== i && (i += 1),
                    new r.TemplateError(t,e,i)
                },
                pushBufferId: function(t) {
                    this.bufferStack.push(this.buffer),
                    this.buffer = t,
                    this.emit("var " + this.buffer + ' = "";')
                },
                popBufferId: function() {
                    this.buffer = this.bufferStack.pop()
                },
                emit: function(t) {
                    this.codebuf.push(t)
                },
                emitLine: function(t) {
                    this.emit(t + "\n")
                },
                emitLines: function() {
                    r.each(r.toArray(arguments), function(t) {
                        this.emitLine(t)
                    }, this)
                },
                emitFuncBegin: function(t) {
                    this.buffer = "output",
                    this.scopeClosers = "",
                    this.emitLine("function " + t + "(env, context, frame, runtime, cb) {"),
                    this.emitLine("var lineno = null;"),
                    this.emitLine("var colno = null;"),
                    this.emitLine("var " + this.buffer + ' = "";'),
                    this.emitLine("try {")
                },
                emitFuncEnd: function(t) {
                    t || this.emitLine("cb(null, " + this.buffer + ");"),
                    this.closeScopeLevels(),
                    this.emitLine("} catch (e) {"),
                    this.emitLine("  cb(runtime.handleError(e, lineno, colno));"),
                    this.emitLine("}"),
                    this.emitLine("}"),
                    this.buffer = null
                },
                addScopeLevel: function() {
                    this.scopeClosers += "})"
                },
                closeScopeLevels: function() {
                    this.emitLine(this.scopeClosers + ";"),
                    this.scopeClosers = ""
                },
                withScopedSyntax: function(t) {
                    var e = this.scopeClosers;
                    this.scopeClosers = "",
                    t.call(this),
                    this.closeScopeLevels(),
                    this.scopeClosers = e
                },
                makeCallback: function(t) {
                    var e = this.tmpid();
                    return "function(" + e + (t ? "," + t : "") + ") {\nif(" + e + ") { cb(" + e + "); return; }"
                },
                tmpid: function() {
                    return "t_" + ++this.lastId
                },
                _templateName: function() {
                    return null == this.templateName ? "undefined" : JSON.stringify(this.templateName)
                },
                _compileChildren: function(t, e) {
                    for (var i = t.children, n = 0, r = i.length; n < r; n++)
                        this.compile(i[n], e)
                },
                _compileAggregate: function(t, e, i, n) {
                    i && this.emit(i);
                    for (var r = 0; r < t.children.length; r++)
                        r > 0 && this.emit(","),
                        this.compile(t.children[r], e);
                    n && this.emit(n)
                },
                _compileExpression: function(t, e) {
                    this.assertType(t, o.Literal, o.Symbol, o.Group, o.Array, o.Dict, o.FunCall, o.Caller, o.Filter, o.LookupVal, o.Compare, o.InlineIf, o.In, o.And, o.Or, o.Not, o.Add, o.Concat, o.Sub, o.Mul, o.Div, o.FloorDiv, o.Mod, o.Pow, o.Neg, o.Pos, o.Compare, o.NodeList),
                    this.compile(t, e)
                },
                assertType: function(t) {
                    for (var e = r.toArray(arguments).slice(1), i = !1, n = 0; n < e.length; n++)
                        t instanceof e[n] && (i = !0);
                    i || this.fail("assertType: invalid type: " + t.typename, t.lineno, t.colno)
                },
                compileCallExtension: function(t, e, i) {
                    var n = t.args
                      , a = t.contentArgs
                      , s = "boolean" != typeof t.autoescape || t.autoescape;
                    if (i || this.emit(this.buffer + " += runtime.suppressValue("),
                    this.emit('env.getExtension("' + t.extName + '")["' + t.prop + '"]('),
                    this.emit("context"),
                    (n || a) && this.emit(","),
                    n && (n instanceof o.NodeList || this.fail("compileCallExtension: arguments must be a NodeList, use `parser.parseSignature`"),
                    r.each(n.children, function(t, i) {
                        this._compileExpression(t, e),
                        (i !== n.children.length - 1 || a.length) && this.emit(",")
                    }, this)),
                    a.length && r.each(a, function(t, i) {
                        if (i > 0 && this.emit(","),
                        t) {
                            var n = this.tmpid();
                            this.emitLine("function(cb) {"),
                            this.emitLine("if(!cb) { cb = function(err) { if(err) { throw err; }}}"),
                            this.pushBufferId(n),
                            this.withScopedSyntax(function() {
                                this.compile(t, e),
                                this.emitLine("cb(null, " + n + ");")
                            }),
                            this.popBufferId(),
                            this.emitLine("return " + n + ";"),
                            this.emitLine("}")
                        } else
                            this.emit("null")
                    }, this),
                    i) {
                        var l = this.tmpid();
                        this.emitLine(", " + this.makeCallback(l)),
                        this.emitLine(this.buffer + " += runtime.suppressValue(" + l + ", " + s + " && env.opts.autoescape);"),
                        this.addScopeLevel()
                    } else
                        this.emit(")"),
                        this.emit(", " + s + " && env.opts.autoescape);\n")
                },
                compileCallExtensionAsync: function(t, e) {
                    this.compileCallExtension(t, e, !0)
                },
                compileNodeList: function(t, e) {
                    this._compileChildren(t, e)
                },
                compileLiteral: function(t) {
                    if ("string" == typeof t.value) {
                        var e = t.value.replace(/\\/g, "\\\\");
                        e = e.replace(/"/g, '\\"'),
                        e = e.replace(/\n/g, "\\n"),
                        e = e.replace(/\r/g, "\\r"),
                        e = e.replace(/\t/g, "\\t"),
                        this.emit('"' + e + '"')
                    } else
                        null === t.value ? this.emit("null") : this.emit(t.value.toString())
                },
                compileSymbol: function(t, e) {
                    var i, n = t.value;
                    (i = e.lookup(n)) ? this.emit(i) : this.emit('runtime.contextOrFrameLookup(context, frame, "' + n + '")')
                },
                compileGroup: function(t, e) {
                    this._compileAggregate(t, e, "(", ")")
                },
                compileArray: function(t, e) {
                    this._compileAggregate(t, e, "[", "]")
                },
                compileDict: function(t, e) {
                    this._compileAggregate(t, e, "{", "}")
                },
                compilePair: function(t, e) {
                    var i = t.key
                      , n = t.value;
                    i instanceof o.Symbol ? i = new o.Literal(i.lineno,i.colno,i.value) : i instanceof o.Literal && "string" == typeof i.value || this.fail("compilePair: Dict keys must be strings or names", i.lineno, i.colno),
                    this.compile(i, e),
                    this.emit(": "),
                    this._compileExpression(n, e)
                },
                compileInlineIf: function(t, e) {
                    this.emit("("),
                    this.compile(t.cond, e),
                    this.emit("?"),
                    this.compile(t.body, e),
                    this.emit(":"),
                    null !== t.else_ ? this.compile(t.else_, e) : this.emit('""'),
                    this.emit(")")
                },
                compileIn: function(t, e) {
                    this.emit("runtime.inOperator("),
                    this.compile(t.left, e),
                    this.emit(","),
                    this.compile(t.right, e),
                    this.emit(")")
                },
                compileOr: n(" || "),
                compileAnd: n(" && "),
                compileAdd: n(" + "),
                compileConcat: n(' + "" + '),
                compileSub: n(" - "),
                compileMul: n(" * "),
                compileDiv: n(" / "),
                compileMod: n(" % "),
                compileNot: function(t, e) {
                    this.emit("!"),
                    this.compile(t.target, e)
                },
                compileFloorDiv: function(t, e) {
                    this.emit("Math.floor("),
                    this.compile(t.left, e),
                    this.emit(" / "),
                    this.compile(t.right, e),
                    this.emit(")")
                },
                compilePow: function(t, e) {
                    this.emit("Math.pow("),
                    this.compile(t.left, e),
                    this.emit(", "),
                    this.compile(t.right, e),
                    this.emit(")")
                },
                compileNeg: function(t, e) {
                    this.emit("-"),
                    this.compile(t.target, e)
                },
                compilePos: function(t, e) {
                    this.emit("+"),
                    this.compile(t.target, e)
                },
                compileCompare: function(t, e) {
                    this.compile(t.expr, e);
                    for (var i = 0; i < t.ops.length; i++) {
                        var n = t.ops[i];
                        this.emit(" " + h[n.type] + " "),
                        this.compile(n.expr, e)
                    }
                },
                compileLookupVal: function(t, e) {
                    this.emit("runtime.memberLookup(("),
                    this._compileExpression(t.target, e),
                    this.emit("),"),
                    this._compileExpression(t.val, e),
                    this.emit(")")
                },
                _getNodeName: function(t) {
                    switch (t.typename) {
                    case "Symbol":
                        return t.value;
                    case "FunCall":
                        return "the return value of (" + this._getNodeName(t.name) + ")";
                    case "LookupVal":
                        return this._getNodeName(t.target) + '["' + this._getNodeName(t.val) + '"]';
                    case "Literal":
                        return t.value.toString();
                    default:
                        return "--expression--"
                    }
                },
                compileFunCall: function(t, e) {
                    this.emit("(lineno = " + t.lineno + ", colno = " + t.colno + ", "),
                    this.emit("runtime.callWrap("),
                    this._compileExpression(t.name, e),
                    this.emit(', "' + this._getNodeName(t.name).replace(/"/g, '\\"') + '", context, '),
                    this._compileAggregate(t.args, e, "[", "])"),
                    this.emit(")")
                },
                compileFilter: function(t, e) {
                    var i = t.name;
                    this.assertType(i, o.Symbol),
                    this.emit('env.getFilter("' + i.value + '").call(context, '),
                    this._compileAggregate(t.args, e),
                    this.emit(")")
                },
                compileFilterAsync: function(t, e) {
                    var i = t.name;
                    this.assertType(i, o.Symbol);
                    var n = t.symbol.value;
                    e.set(n, n),
                    this.emit('env.getFilter("' + i.value + '").call(context, '),
                    this._compileAggregate(t.args, e),
                    this.emitLine(", " + this.makeCallback(n)),
                    this.addScopeLevel()
                },
                compileKeywordArgs: function(t, e) {
                    var i = [];
                    r.each(t.children, function(t) {
                        i.push(t.key.value)
                    }),
                    this.emit("runtime.makeKeywordArgs("),
                    this.compileDict(t, e),
                    this.emit(")")
                },
                compileSet: function(t, e) {
                    var i = [];
                    r.each(t.targets, function(t) {
                        var n = t.value
                          , r = e.lookup(n);
                        null !== r && void 0 !== r || (r = this.tmpid(),
                        this.emitLine("var " + r + ";")),
                        i.push(r)
                    }, this),
                    t.value ? (this.emit(i.join(" = ") + " = "),
                    this._compileExpression(t.value, e),
                    this.emitLine(";")) : (this.emit(i.join(" = ") + " = "),
                    this.compile(t.body, e),
                    this.emitLine(";")),
                    r.each(t.targets, function(t, e) {
                        var n = i[e]
                          , r = t.value;
                        this.emitLine('frame.set("' + r + '", ' + n + ", true);"),
                        this.emitLine("if(frame.topLevel) {"),
                        this.emitLine('context.setVariable("' + r + '", ' + n + ");"),
                        this.emitLine("}"),
                        "_" !== r.charAt(0) && (this.emitLine("if(frame.topLevel) {"),
                        this.emitLine('context.addExport("' + r + '", ' + n + ");"),
                        this.emitLine("}"))
                    }, this)
                },
                compileIf: function(t, e, i) {
                    this.emit("if("),
                    this._compileExpression(t.cond, e),
                    this.emitLine(") {"),
                    this.withScopedSyntax(function() {
                        this.compile(t.body, e),
                        i && this.emit("cb()")
                    }),
                    t.else_ ? (this.emitLine("}\nelse {"),
                    this.withScopedSyntax(function() {
                        this.compile(t.else_, e),
                        i && this.emit("cb()")
                    })) : i && (this.emitLine("}\nelse {"),
                    this.emit("cb()")),
                    this.emitLine("}")
                },
                compileIfAsync: function(t, e) {
                    this.emit("(function(cb) {"),
                    this.compileIf(t, e, !0),
                    this.emit("})(" + this.makeCallback()),
                    this.addScopeLevel()
                },
                emitLoopBindings: function(t, e, i, n) {
                    var r = {
                        index: i + " + 1",
                        index0: i,
                        revindex: n + " - " + i,
                        revindex0: n + " - " + i + " - 1",
                        first: i + " === 0",
                        last: i + " === " + n + " - 1",
                        length: n
                    };
                    for (var a in r)
                        this.emitLine('frame.set("loop.' + a + '", ' + r[a] + ");")
                },
                compileFor: function(t, e) {
                    var i, n = this.tmpid(), r = this.tmpid(), a = this.tmpid();
                    if (e = e.push(),
                    this.emitLine("frame = frame.push();"),
                    this.emit("var " + a + " = "),
                    this._compileExpression(t.arr, e),
                    this.emitLine(";"),
                    this.emit("if(" + a + ") {"),
                    t.name instanceof o.Array) {
                        this.emitLine("var " + n + ";"),
                        this.emitLine("if(runtime.isArray(" + a + ")) {"),
                        this.emitLine("var " + r + " = " + a + ".length;"),
                        this.emitLine("for(" + n + "=0; " + n + " < " + a + ".length; " + n + "++) {");
                        for (var s = 0; s < t.name.children.length; s++) {
                            var l = this.tmpid();
                            this.emitLine("var " + l + " = " + a + "[" + n + "][" + s + "]"),
                            this.emitLine('frame.set("' + t.name.children[s].value + '", ' + a + "[" + n + "][" + s + "]);"),
                            e.set(t.name.children[s].value, l)
                        }
                        this.emitLoopBindings(t, a, n, r),
                        this.withScopedSyntax(function() {
                            this.compile(t.body, e)
                        }),
                        this.emitLine("}"),
                        this.emitLine("} else {");
                        var u = t.name.children[0]
                          , h = t.name.children[1]
                          , c = this.tmpid();
                        i = this.tmpid(),
                        e.set(u.value, c),
                        e.set(h.value, i),
                        this.emitLine(n + " = -1;"),
                        this.emitLine("var " + r + " = runtime.keys(" + a + ").length;"),
                        this.emitLine("for(var " + c + " in " + a + ") {"),
                        this.emitLine(n + "++;"),
                        this.emitLine("var " + i + " = " + a + "[" + c + "];"),
                        this.emitLine('frame.set("' + u.value + '", ' + c + ");"),
                        this.emitLine('frame.set("' + h.value + '", ' + i + ");"),
                        this.emitLoopBindings(t, a, n, r),
                        this.withScopedSyntax(function() {
                            this.compile(t.body, e)
                        }),
                        this.emitLine("}"),
                        this.emitLine("}")
                    } else
                        i = this.tmpid(),
                        e.set(t.name.value, i),
                        this.emitLine("var " + r + " = " + a + ".length;"),
                        this.emitLine("for(var " + n + "=0; " + n + " < " + a + ".length; " + n + "++) {"),
                        this.emitLine("var " + i + " = " + a + "[" + n + "];"),
                        this.emitLine('frame.set("' + t.name.value + '", ' + i + ");"),
                        this.emitLoopBindings(t, a, n, r),
                        this.withScopedSyntax(function() {
                            this.compile(t.body, e)
                        }),
                        this.emitLine("}");
                    this.emitLine("}"),
                    t.else_ && (this.emitLine("if (!" + r + ") {"),
                    this.compile(t.else_, e),
                    this.emitLine("}")),
                    this.emitLine("frame = frame.pop();")
                },
                _compileAsyncLoop: function(t, e, i) {
                    var n = this.tmpid()
                      , a = this.tmpid()
                      , s = this.tmpid()
                      , l = i ? "asyncAll" : "asyncEach";
                    if (e = e.push(),
                    this.emitLine("frame = frame.push();"),
                    this.emit("var " + s + " = "),
                    this._compileExpression(t.arr, e),
                    this.emitLine(";"),
                    t.name instanceof o.Array)
                        this.emit("runtime." + l + "(" + s + ", " + t.name.children.length + ", function("),
                        r.each(t.name.children, function(t) {
                            this.emit(t.value + ",")
                        }, this),
                        this.emit(n + "," + a + ",next) {"),
                        r.each(t.name.children, function(t) {
                            var i = t.value;
                            e.set(i, i),
                            this.emitLine('frame.set("' + i + '", ' + i + ");")
                        }, this);
                    else {
                        var u = t.name.value;
                        this.emitLine("runtime." + l + "(" + s + ", 1, function(" + u + ", " + n + ", " + a + ",next) {"),
                        this.emitLine('frame.set("' + u + '", ' + u + ");"),
                        e.set(u, u)
                    }
                    this.emitLoopBindings(t, s, n, a),
                    this.withScopedSyntax(function() {
                        var r;
                        i && (r = this.tmpid(),
                        this.pushBufferId(r)),
                        this.compile(t.body, e),
                        this.emitLine("next(" + n + (r ? "," + r : "") + ");"),
                        i && this.popBufferId()
                    });
                    var h = this.tmpid();
                    this.emitLine("}, " + this.makeCallback(h)),
                    this.addScopeLevel(),
                    i && this.emitLine(this.buffer + " += " + h + ";"),
                    t.else_ && (this.emitLine("if (!" + s + ".length) {"),
                    this.compile(t.else_, e),
                    this.emitLine("}")),
                    this.emitLine("frame = frame.pop();")
                },
                compileAsyncEach: function(t, e) {
                    this._compileAsyncLoop(t, e)
                },
                compileAsyncAll: function(t, e) {
                    this._compileAsyncLoop(t, e, !0)
                },
                _compileMacro: function(t) {
                    var e = []
                      , i = null
                      , n = "macro_" + this.tmpid();
                    r.each(t.args.children, function(n, r) {
                        r === t.args.children.length - 1 && n instanceof o.Dict ? i = n : (this.assertType(n, o.Symbol),
                        e.push(n))
                    }, this);
                    var a = r.map(e, function(t) {
                        return "l_" + t.value
                    });
                    a.push("kwargs");
                    var s = r.map(e, function(t) {
                        return '"' + t.value + '"'
                    })
                      , l = r.map(i && i.children || [], function(t) {
                        return '"' + t.key.value + '"'
                    })
                      , h = new u;
                    this.emitLines("var " + n + " = runtime.makeMacro(", "[" + s.join(", ") + "], ", "[" + l.join(", ") + "], ", "function (" + a.join(", ") + ") {", "var callerFrame = frame;", "frame = new runtime.Frame();", "kwargs = kwargs || {};", 'if (kwargs.hasOwnProperty("caller")) {', 'frame.set("caller", kwargs.caller); }'),
                    r.each(e, function(t) {
                        this.emitLine('frame.set("' + t.value + '", l_' + t.value + ");"),
                        h.set(t.value, "l_" + t.value)
                    }, this),
                    i && r.each(i.children, function(t) {
                        var e = t.key.value;
                        this.emit('frame.set("' + e + '", kwargs.hasOwnProperty("' + e + '") ? kwargs["' + e + '"] : '),
                        this._compileExpression(t.value, h),
                        this.emitLine(");")
                    }, this);
                    var c = this.tmpid();
                    return this.pushBufferId(c),
                    this.withScopedSyntax(function() {
                        this.compile(t.body, h)
                    }),
                    this.emitLine("frame = callerFrame;"),
                    this.emitLine("return new runtime.SafeString(" + c + ");"),
                    this.emitLine("});"),
                    this.popBufferId(),
                    n
                },
                compileMacro: function(t, e) {
                    var i = this._compileMacro(t, e)
                      , n = t.name.value;
                    e.set(n, i),
                    e.parent ? this.emitLine('frame.set("' + n + '", ' + i + ");") : ("_" !== t.name.value.charAt(0) && this.emitLine('context.addExport("' + n + '");'),
                    this.emitLine('context.setVariable("' + n + '", ' + i + ");"))
                },
                compileCaller: function(t, e) {
                    this.emit("(function (){");
                    var i = this._compileMacro(t, e);
                    this.emit("return " + i + ";})()")
                },
                compileImport: function(t, e) {
                    var i = this.tmpid()
                      , n = t.target.value;
                    this.emit("env.getTemplate("),
                    this._compileExpression(t.template, e),
                    this.emitLine(", false, " + this._templateName() + ", false, " + this.makeCallback(i)),
                    this.addScopeLevel(),
                    this.emitLine(i + ".getExported(" + (t.withContext ? "context.getVariables(), frame, " : "") + this.makeCallback(i)),
                    this.addScopeLevel(),
                    e.set(n, i),
                    e.parent ? this.emitLine('frame.set("' + n + '", ' + i + ");") : this.emitLine('context.setVariable("' + n + '", ' + i + ");")
                },
                compileFromImport: function(t, e) {
                    var i = this.tmpid();
                    this.emit("env.getTemplate("),
                    this._compileExpression(t.template, e),
                    this.emitLine(", false, " + this._templateName() + ", false, " + this.makeCallback(i)),
                    this.addScopeLevel(),
                    this.emitLine(i + ".getExported(" + (t.withContext ? "context.getVariables(), frame, " : "") + this.makeCallback(i)),
                    this.addScopeLevel(),
                    r.each(t.names.children, function(t) {
                        var n, r, a = this.tmpid();
                        t instanceof o.Pair ? (n = t.key.value,
                        r = t.value.value) : (n = t.value,
                        r = n),
                        this.emitLine("if(" + i + '.hasOwnProperty("' + n + '")) {'),
                        this.emitLine("var " + a + " = " + i + "." + n + ";"),
                        this.emitLine("} else {"),
                        this.emitLine("cb(new Error(\"cannot import '" + n + "'\")); return;"),
                        this.emitLine("}"),
                        e.set(r, a),
                        e.parent ? this.emitLine('frame.set("' + r + '", ' + a + ");") : this.emitLine('context.setVariable("' + r + '", ' + a + ");")
                    }, this)
                },
                compileBlock: function(t) {
                    var e = this.tmpid();
                    this.inBlock || this.emit('(parentTemplate ? function(e, c, f, r, cb) { cb(""); } : '),
                    this.emit('context.getBlock("' + t.name.value + '")'),
                    this.inBlock || this.emit(")"),
                    this.emitLine("(env, context, frame, runtime, " + this.makeCallback(e)),
                    this.emitLine(this.buffer + " += " + e + ";"),
                    this.addScopeLevel()
                },
                compileSuper: function(t, e) {
                    var i = t.blockName.value
                      , n = t.symbol.value;
                    this.emitLine('context.getSuper(env, "' + i + '", b_' + i + ", frame, runtime, " + this.makeCallback(n)),
                    this.emitLine(n + " = runtime.markSafe(" + n + ");"),
                    this.addScopeLevel(),
                    e.set(n, n)
                },
                compileExtends: function(t, e) {
                    var i = this.tmpid();
                    this.emit("env.getTemplate("),
                    this._compileExpression(t.template, e),
                    this.emitLine(", true, " + this._templateName() + ", false, " + this.makeCallback("_parentTemplate")),
                    this.emitLine("parentTemplate = _parentTemplate"),
                    this.emitLine("for(var " + i + " in parentTemplate.blocks) {"),
                    this.emitLine("context.addBlock(" + i + ", parentTemplate.blocks[" + i + "]);"),
                    this.emitLine("}"),
                    this.addScopeLevel()
                },
                compileInclude: function(t, e) {
                    var i = this.tmpid()
                      , n = this.tmpid();
                    this.emitLine("var tasks = [];"),
                    this.emitLine("tasks.push("),
                    this.emitLine("function(callback) {"),
                    this.emit("env.getTemplate("),
                    this._compileExpression(t.template, e),
                    this.emitLine(", false, " + this._templateName() + ", " + t.ignoreMissing + ", " + this.makeCallback(i)),
                    this.emitLine("callback(null," + i + ");});"),
                    this.emitLine("});"),
                    this.emitLine("tasks.push("),
                    this.emitLine("function(template, callback){"),
                    this.emitLine("template.render(context.getVariables(), frame, " + this.makeCallback(n)),
                    this.emitLine("callback(null," + n + ");});"),
                    this.emitLine("});"),
                    this.emitLine("tasks.push("),
                    this.emitLine("function(result, callback){"),
                    this.emitLine(this.buffer + " += result;"),
                    this.emitLine("callback(null);"),
                    this.emitLine("});"),
                    this.emitLine("env.waterfall(tasks, function(){"),
                    this.addScopeLevel()
                },
                compileTemplateData: function(t, e) {
                    this.compileLiteral(t, e)
                },
                compileCapture: function(t, e) {
                    this.emitLine("(function() {"),
                    this.emitLine('var output = "";'),
                    this.withScopedSyntax(function() {
                        this.compile(t.body, e)
                    }),
                    this.emitLine("return output;"),
                    this.emitLine("})()")
                },
                compileOutput: function(t, e) {
                    for (var i = t.children, n = 0, r = i.length; n < r; n++)
                        i[n]instanceof o.TemplateData ? i[n].value && (this.emit(this.buffer + " += "),
                        this.compileLiteral(i[n], e),
                        this.emitLine(";")) : (this.emit(this.buffer + " += runtime.suppressValue("),
                        this.throwOnUndefined && this.emit("runtime.ensureDefined("),
                        this.compile(i[n], e),
                        this.throwOnUndefined && this.emit("," + t.lineno + "," + t.colno + ")"),
                        this.emit(", env.opts.autoescape);\n"))
                },
                compileRoot: function(t, e) {
                    e && this.fail("compileRoot: root node can't have frame"),
                    e = new u,
                    this.emitFuncBegin("root"),
                    this.emitLine("var parentTemplate = null;"),
                    this._compileChildren(t, e),
                    this.emitLine("if(parentTemplate) {"),
                    this.emitLine("parentTemplate.rootRenderFunc(env, context, frame, runtime, cb);"),
                    this.emitLine("} else {"),
                    this.emitLine("cb(null, " + this.buffer + ");"),
                    this.emitLine("}"),
                    this.emitFuncEnd(!0),
                    this.inBlock = !0;
                    var i, n, r, a = [], s = t.findAll(o.Block);
                    for (i = 0; i < s.length; i++) {
                        if (r = s[i],
                        n = r.name.value,
                        -1 !== a.indexOf(n))
                            throw new Error('Block "' + n + '" defined more than once.');
                        a.push(n),
                        this.emitFuncBegin("b_" + n);
                        var l = new u;
                        this.emitLine("var frame = frame.push(true);"),
                        this.compile(r.body, l),
                        this.emitFuncEnd()
                    }
                    for (this.emitLine("return {"),
                    i = 0; i < s.length; i++)
                        r = s[i],
                        n = "b_" + r.name.value,
                        this.emitLine(n + ": " + n + ",");
                    this.emitLine("root: root\n};")
                },
                compile: function(t, e) {
                    var i = this["compile" + t.typename];
                    i ? i.call(this, t, e) : this.fail("compile: Cannot compile node: " + t.typename, t.lineno, t.colno)
                },
                getCode: function() {
                    return this.codebuf.join("")
                }
            });
            t.exports = {
                compile: function(t, e, i, n, r) {
                    var o = new c(n,r.throwOnUndefined);
                    if (i && i.length)
                        for (var l = 0; l < i.length; l++)
                            "preprocess"in i[l] && (t = i[l].preprocess(t, n));
                    return o.compile(s.transform(a.parse(t, i, r), e, n)),
                    o.getCode()
                },
                Compiler: c
            }
        }
        , function(t, e, i) {
            "use strict";
            var n = i(9)
              , r = i(10)
              , a = i(6)
              , s = i(1)
              , o = a.extend({
                init: function(t) {
                    this.tokens = t,
                    this.peeked = null,
                    this.breakOnBlocks = null,
                    this.dropLeadingWhitespace = !1,
                    this.extensions = []
                },
                nextToken: function(t) {
                    var e;
                    if (this.peeked) {
                        if (t || this.peeked.type !== n.TOKEN_WHITESPACE)
                            return e = this.peeked,
                            this.peeked = null,
                            e;
                        this.peeked = null
                    }
                    if (e = this.tokens.nextToken(),
                    !t)
                        for (; e && e.type === n.TOKEN_WHITESPACE; )
                            e = this.tokens.nextToken();
                    return e
                },
                peekToken: function() {
                    return this.peeked = this.peeked || this.nextToken(),
                    this.peeked
                },
                pushToken: function(t) {
                    if (this.peeked)
                        throw new Error("pushToken: can only push one token on between reads");
                    this.peeked = t
                },
                fail: function(t, e, i) {
                    if ((void 0 === e || void 0 === i) && this.peekToken()) {
                        var n = this.peekToken();
                        e = n.lineno,
                        i = n.colno
                    }
                    throw void 0 !== e && (e += 1),
                    void 0 !== i && (i += 1),
                    new s.TemplateError(t,e,i)
                },
                skip: function(t) {
                    var e = this.nextToken();
                    return !(!e || e.type !== t) || (this.pushToken(e),
                    !1)
                },
                expect: function(t) {
                    var e = this.nextToken();
                    return e.type !== t && this.fail("expected " + t + ", got " + e.type, e.lineno, e.colno),
                    e
                },
                skipValue: function(t, e) {
                    var i = this.nextToken();
                    return !(!i || i.type !== t || i.value !== e) || (this.pushToken(i),
                    !1)
                },
                skipSymbol: function(t) {
                    return this.skipValue(n.TOKEN_SYMBOL, t)
                },
                advanceAfterBlockEnd: function(t) {
                    var e;
                    return t || (e = this.peekToken(),
                    e || this.fail("unexpected end of file"),
                    e.type !== n.TOKEN_SYMBOL && this.fail("advanceAfterBlockEnd: expected symbol token or explicit name to be passed"),
                    t = this.nextToken().value),
                    e = this.nextToken(),
                    e && e.type === n.TOKEN_BLOCK_END ? "-" === e.value.charAt(0) && (this.dropLeadingWhitespace = !0) : this.fail("expected block end in " + t + " statement"),
                    e
                },
                advanceAfterVariableEnd: function() {
                    var t = this.nextToken();
                    t && t.type === n.TOKEN_VARIABLE_END ? this.dropLeadingWhitespace = "-" === t.value.charAt(t.value.length - this.tokens.tags.VARIABLE_END.length - 1) : (this.pushToken(t),
                    this.fail("expected variable end"))
                },
                parseFor: function() {
                    var t, e, i = this.peekToken();
                    if (this.skipSymbol("for") ? (t = new r.For(i.lineno,i.colno),
                    e = "endfor") : this.skipSymbol("asyncEach") ? (t = new r.AsyncEach(i.lineno,i.colno),
                    e = "endeach") : this.skipSymbol("asyncAll") ? (t = new r.AsyncAll(i.lineno,i.colno),
                    e = "endall") : this.fail("parseFor: expected for{Async}", i.lineno, i.colno),
                    t.name = this.parsePrimary(),
                    t.name instanceof r.Symbol || this.fail("parseFor: variable name expected for loop"),
                    this.peekToken().type === n.TOKEN_COMMA) {
                        var a = t.name;
                        for (t.name = new r.Array(a.lineno,a.colno),
                        t.name.addChild(a); this.skip(n.TOKEN_COMMA); ) {
                            var s = this.parsePrimary();
                            t.name.addChild(s)
                        }
                    }
                    return this.skipSymbol("in") || this.fail('parseFor: expected "in" keyword for loop', i.lineno, i.colno),
                    t.arr = this.parseExpression(),
                    this.advanceAfterBlockEnd(i.value),
                    t.body = this.parseUntilBlocks(e, "else"),
                    this.skipSymbol("else") && (this.advanceAfterBlockEnd("else"),
                    t.else_ = this.parseUntilBlocks(e)),
                    this.advanceAfterBlockEnd(),
                    t
                },
                parseMacro: function() {
                    var t = this.peekToken();
                    this.skipSymbol("macro") || this.fail("expected macro");
                    var e = this.parsePrimary(!0)
                      , i = this.parseSignature()
                      , n = new r.Macro(t.lineno,t.colno,e,i);
                    return this.advanceAfterBlockEnd(t.value),
                    n.body = this.parseUntilBlocks("endmacro"),
                    this.advanceAfterBlockEnd(),
                    n
                },
                parseCall: function() {
                    var t = this.peekToken();
                    this.skipSymbol("call") || this.fail("expected call");
                    var e = this.parseSignature(!0) || new r.NodeList
                      , i = this.parsePrimary();
                    this.advanceAfterBlockEnd(t.value);
                    var n = this.parseUntilBlocks("endcall");
                    this.advanceAfterBlockEnd();
                    var a = new r.Symbol(t.lineno,t.colno,"caller")
                      , s = new r.Caller(t.lineno,t.colno,a,e,n)
                      , o = i.args.children;
                    return o[o.length - 1]instanceof r.KeywordArgs || o.push(new r.KeywordArgs),
                    o[o.length - 1].addChild(new r.Pair(t.lineno,t.colno,a,s)),
                    new r.Output(t.lineno,t.colno,[i])
                },
                parseWithContext: function() {
                    var t = this.peekToken()
                      , e = null;
                    return this.skipSymbol("with") ? e = !0 : this.skipSymbol("without") && (e = !1),
                    null !== e && (this.skipSymbol("context") || this.fail("parseFrom: expected context after with/without", t.lineno, t.colno)),
                    e
                },
                parseImport: function() {
                    var t = this.peekToken();
                    this.skipSymbol("import") || this.fail("parseImport: expected import", t.lineno, t.colno);
                    var e = this.parseExpression();
                    this.skipSymbol("as") || this.fail('parseImport: expected "as" keyword', t.lineno, t.colno);
                    var i = this.parseExpression()
                      , n = this.parseWithContext()
                      , a = new r.Import(t.lineno,t.colno,e,i,n);
                    return this.advanceAfterBlockEnd(t.value),
                    a
                },
                parseFrom: function() {
                    var t = this.peekToken();
                    this.skipSymbol("from") || this.fail("parseFrom: expected from");
                    var e = this.parseExpression();
                    this.skipSymbol("import") || this.fail("parseFrom: expected import", t.lineno, t.colno);
                    for (var i, a = new r.NodeList; ; ) {
                        var s = this.peekToken();
                        if (s.type === n.TOKEN_BLOCK_END) {
                            a.children.length || this.fail("parseFrom: Expected at least one import name", t.lineno, t.colno),
                            "-" === s.value.charAt(0) && (this.dropLeadingWhitespace = !0),
                            this.nextToken();
                            break
                        }
                        a.children.length > 0 && !this.skip(n.TOKEN_COMMA) && this.fail("parseFrom: expected comma", t.lineno, t.colno);
                        var o = this.parsePrimary();
                        if ("_" === o.value.charAt(0) && this.fail("parseFrom: names starting with an underscore cannot be imported", o.lineno, o.colno),
                        this.skipSymbol("as")) {
                            var l = this.parsePrimary();
                            a.addChild(new r.Pair(o.lineno,o.colno,o,l))
                        } else
                            a.addChild(o);
                        i = this.parseWithContext()
                    }
                    return new r.FromImport(t.lineno,t.colno,e,a,i)
                },
                parseBlock: function() {
                    var t = this.peekToken();
                    this.skipSymbol("block") || this.fail("parseBlock: expected block", t.lineno, t.colno);
                    var e = new r.Block(t.lineno,t.colno);
                    e.name = this.parsePrimary(),
                    e.name instanceof r.Symbol || this.fail("parseBlock: variable name expected", t.lineno, t.colno),
                    this.advanceAfterBlockEnd(t.value),
                    e.body = this.parseUntilBlocks("endblock"),
                    this.skipSymbol("endblock"),
                    this.skipSymbol(e.name.value);
                    var i = this.peekToken();
                    return i || this.fail("parseBlock: expected endblock, got end of file"),
                    this.advanceAfterBlockEnd(i.value),
                    e
                },
                parseExtends: function() {
                    var t = this.peekToken();
                    this.skipSymbol("extends") || this.fail("parseTemplateRef: expected extends");
                    var e = new r.Extends(t.lineno,t.colno);
                    return e.template = this.parseExpression(),
                    this.advanceAfterBlockEnd(t.value),
                    e
                },
                parseInclude: function() {
                    var t = this.peekToken();
                    this.skipSymbol("include") || this.fail("parseInclude: expected include");
                    var e = new r.Include(t.lineno,t.colno);
                    return e.template = this.parseExpression(),
                    this.skipSymbol("ignore") && this.skipSymbol("missing") && (e.ignoreMissing = !0),
                    this.advanceAfterBlockEnd(t.value),
                    e
                },
                parseIf: function() {
                    var t, e = this.peekToken();
                    this.skipSymbol("if") || this.skipSymbol("elif") || this.skipSymbol("elseif") ? t = new r.If(e.lineno,e.colno) : this.skipSymbol("ifAsync") ? t = new r.IfAsync(e.lineno,e.colno) : this.fail("parseIf: expected if, elif, or elseif", e.lineno, e.colno),
                    t.cond = this.parseExpression(),
                    this.advanceAfterBlockEnd(e.value),
                    t.body = this.parseUntilBlocks("elif", "elseif", "else", "endif");
                    var i = this.peekToken();
                    switch (i && i.value) {
                    case "elseif":
                    case "elif":
                        t.else_ = this.parseIf();
                        break;
                    case "else":
                        this.advanceAfterBlockEnd(),
                        t.else_ = this.parseUntilBlocks("endif"),
                        this.advanceAfterBlockEnd();
                        break;
                    case "endif":
                        t.else_ = null,
                        this.advanceAfterBlockEnd();
                        break;
                    default:
                        this.fail("parseIf: expected elif, else, or endif, got end of file")
                    }
                    return t
                },
                parseSet: function() {
                    var t = this.peekToken();
                    this.skipSymbol("set") || this.fail("parseSet: expected set", t.lineno, t.colno);
                    for (var e, i = new r.Set(t.lineno,t.colno,[]); (e = this.parsePrimary()) && (i.targets.push(e),
                    this.skip(n.TOKEN_COMMA)); )
                        ;
                    return this.skipValue(n.TOKEN_OPERATOR, "=") ? (i.value = this.parseExpression(),
                    this.advanceAfterBlockEnd(t.value)) : this.skip(n.TOKEN_BLOCK_END) ? (i.body = new r.Capture(t.lineno,t.colno,this.parseUntilBlocks("endset")),
                    i.value = null,
                    this.advanceAfterBlockEnd()) : this.fail("parseSet: expected = or block end in set tag", t.lineno, t.colno),
                    i
                },
                parseStatement: function() {
                    var t = this.peekToken();
                    if (t.type !== n.TOKEN_SYMBOL && this.fail("tag name expected", t.lineno, t.colno),
                    this.breakOnBlocks && -1 !== s.indexOf(this.breakOnBlocks, t.value))
                        return null;
                    switch (t.value) {
                    case "raw":
                        return this.parseRaw();
                    case "verbatim":
                        return this.parseRaw("verbatim");
                    case "if":
                    case "ifAsync":
                        return this.parseIf();
                    case "for":
                    case "asyncEach":
                    case "asyncAll":
                        return this.parseFor();
                    case "block":
                        return this.parseBlock();
                    case "extends":
                        return this.parseExtends();
                    case "include":
                        return this.parseInclude();
                    case "set":
                        return this.parseSet();
                    case "macro":
                        return this.parseMacro();
                    case "call":
                        return this.parseCall();
                    case "import":
                        return this.parseImport();
                    case "from":
                        return this.parseFrom();
                    case "filter":
                        return this.parseFilterStatement();
                    default:
                        if (this.extensions.length)
                            for (var e = 0; e < this.extensions.length; e++) {
                                var i = this.extensions[e];
                                if (-1 !== s.indexOf(i.tags || [], t.value))
                                    return i.parse(this, r, n)
                            }
                        this.fail("unknown block tag: " + t.value, t.lineno, t.colno)
                    }
                },
                parseRaw: function(t) {
                    t = t || "raw";
                    for (var e = "end" + t, i = new RegExp("([\\s\\S]*?){%\\s*(" + t + "|" + e + ")\\s*(?=%})%}"), n = 1, a = "", s = null, o = this.advanceAfterBlockEnd(); (s = this.tokens._extractRegex(i)) && n > 0; ) {
                        var l = s[0]
                          , u = s[1]
                          , h = s[2];
                        h === t ? n += 1 : h === e && (n -= 1),
                        0 === n ? (a += u,
                        this.tokens.backN(l.length - u.length)) : a += l
                    }
                    return new r.Output(o.lineno,o.colno,[new r.TemplateData(o.lineno,o.colno,a)])
                },
                parsePostfix: function(t) {
                    for (var e, i = this.peekToken(); i; ) {
                        if (i.type === n.TOKEN_LEFT_PAREN)
                            t = new r.FunCall(i.lineno,i.colno,t,this.parseSignature());
                        else if (i.type === n.TOKEN_LEFT_BRACKET)
                            e = this.parseAggregate(),
                            e.children.length > 1 && this.fail("invalid index"),
                            t = new r.LookupVal(i.lineno,i.colno,t,e.children[0]);
                        else {
                            if (i.type !== n.TOKEN_OPERATOR || "." !== i.value)
                                break;
                            this.nextToken();
                            var a = this.nextToken();
                            a.type !== n.TOKEN_SYMBOL && this.fail("expected name as lookup value, got " + a.value, a.lineno, a.colno),
                            e = new r.Literal(a.lineno,a.colno,a.value),
                            t = new r.LookupVal(i.lineno,i.colno,t,e)
                        }
                        i = this.peekToken()
                    }
                    return t
                },
                parseExpression: function() {
                    return this.parseInlineIf()
                },
                parseInlineIf: function() {
                    var t = this.parseOr();
                    if (this.skipSymbol("if")) {
                        var e = this.parseOr()
                          , i = t;
                        t = new r.InlineIf(t.lineno,t.colno),
                        t.body = i,
                        t.cond = e,
                        this.skipSymbol("else") ? t.else_ = this.parseOr() : t.else_ = null
                    }
                    return t
                },
                parseOr: function() {
                    for (var t = this.parseAnd(); this.skipSymbol("or"); ) {
                        var e = this.parseAnd();
                        t = new r.Or(t.lineno,t.colno,t,e)
                    }
                    return t
                },
                parseAnd: function() {
                    for (var t = this.parseNot(); this.skipSymbol("and"); ) {
                        var e = this.parseNot();
                        t = new r.And(t.lineno,t.colno,t,e)
                    }
                    return t
                },
                parseNot: function() {
                    var t = this.peekToken();
                    return this.skipSymbol("not") ? new r.Not(t.lineno,t.colno,this.parseNot()) : this.parseIn()
                },
                parseIn: function() {
                    for (var t = this.parseCompare(); ; ) {
                        var e = this.nextToken();
                        if (!e)
                            break;
                        var i = e.type === n.TOKEN_SYMBOL && "not" === e.value;
                        if (i || this.pushToken(e),
                        !this.skipSymbol("in")) {
                            i && this.pushToken(e);
                            break
                        }
                        var a = this.parseCompare();
                        t = new r.In(t.lineno,t.colno,t,a),
                        i && (t = new r.Not(t.lineno,t.colno,t))
                    }
                    return t
                },
                parseCompare: function() {
                    for (var t = ["==", "===", "!=", "!==", "<", ">", "<=", ">="], e = this.parseConcat(), i = []; ; ) {
                        var n = this.nextToken();
                        if (!n)
                            break;
                        if (-1 === s.indexOf(t, n.value)) {
                            this.pushToken(n);
                            break
                        }
                        i.push(new r.CompareOperand(n.lineno,n.colno,this.parseConcat(),n.value))
                    }
                    return i.length ? new r.Compare(i[0].lineno,i[0].colno,e,i) : e
                },
                parseConcat: function() {
                    for (var t = this.parseAdd(); this.skipValue(n.TOKEN_TILDE, "~"); ) {
                        var e = this.parseAdd();
                        t = new r.Concat(t.lineno,t.colno,t,e)
                    }
                    return t
                },
                parseAdd: function() {
                    for (var t = this.parseSub(); this.skipValue(n.TOKEN_OPERATOR, "+"); ) {
                        var e = this.parseSub();
                        t = new r.Add(t.lineno,t.colno,t,e)
                    }
                    return t
                },
                parseSub: function() {
                    for (var t = this.parseMul(); this.skipValue(n.TOKEN_OPERATOR, "-"); ) {
                        var e = this.parseMul();
                        t = new r.Sub(t.lineno,t.colno,t,e)
                    }
                    return t
                },
                parseMul: function() {
                    for (var t = this.parseDiv(); this.skipValue(n.TOKEN_OPERATOR, "*"); ) {
                        var e = this.parseDiv();
                        t = new r.Mul(t.lineno,t.colno,t,e)
                    }
                    return t
                },
                parseDiv: function() {
                    for (var t = this.parseFloorDiv(); this.skipValue(n.TOKEN_OPERATOR, "/"); ) {
                        var e = this.parseFloorDiv();
                        t = new r.Div(t.lineno,t.colno,t,e)
                    }
                    return t
                },
                parseFloorDiv: function() {
                    for (var t = this.parseMod(); this.skipValue(n.TOKEN_OPERATOR, "//"); ) {
                        var e = this.parseMod();
                        t = new r.FloorDiv(t.lineno,t.colno,t,e)
                    }
                    return t
                },
                parseMod: function() {
                    for (var t = this.parsePow(); this.skipValue(n.TOKEN_OPERATOR, "%"); ) {
                        var e = this.parsePow();
                        t = new r.Mod(t.lineno,t.colno,t,e)
                    }
                    return t
                },
                parsePow: function() {
                    for (var t = this.parseUnary(); this.skipValue(n.TOKEN_OPERATOR, "**"); ) {
                        var e = this.parseUnary();
                        t = new r.Pow(t.lineno,t.colno,t,e)
                    }
                    return t
                },
                parseUnary: function(t) {
                    var e, i = this.peekToken();
                    return e = this.skipValue(n.TOKEN_OPERATOR, "-") ? new r.Neg(i.lineno,i.colno,this.parseUnary(!0)) : this.skipValue(n.TOKEN_OPERATOR, "+") ? new r.Pos(i.lineno,i.colno,this.parseUnary(!0)) : this.parsePrimary(),
                    t || (e = this.parseFilter(e)),
                    e
                },
                parsePrimary: function(t) {
                    var e, i = this.nextToken(), a = null;
                    if (i ? i.type === n.TOKEN_STRING ? e = i.value : i.type === n.TOKEN_INT ? e = parseInt(i.value, 10) : i.type === n.TOKEN_FLOAT ? e = parseFloat(i.value) : i.type === n.TOKEN_BOOLEAN ? "true" === i.value ? e = !0 : "false" === i.value ? e = !1 : this.fail("invalid boolean: " + i.value, i.lineno, i.colno) : i.type === n.TOKEN_NONE ? e = null : i.type === n.TOKEN_REGEX && (e = new RegExp(i.value.body,i.value.flags)) : this.fail("expected expression, got end of file"),
                    void 0 !== e ? a = new r.Literal(i.lineno,i.colno,e) : i.type === n.TOKEN_SYMBOL ? (a = new r.Symbol(i.lineno,i.colno,i.value),
                    t || (a = this.parsePostfix(a))) : (this.pushToken(i),
                    a = this.parseAggregate()),
                    a)
                        return a;
                    this.fail("unexpected token: " + i.value, i.lineno, i.colno)
                },
                parseFilterName: function() {
                    for (var t = this.expect(n.TOKEN_SYMBOL), e = t.value; this.skipValue(n.TOKEN_OPERATOR, "."); )
                        e += "." + this.expect(n.TOKEN_SYMBOL).value;
                    return new r.Symbol(t.lineno,t.colno,e)
                },
                parseFilterArgs: function(t) {
                    if (this.peekToken().type === n.TOKEN_LEFT_PAREN) {
                        return this.parsePostfix(t).args.children
                    }
                    return []
                },
                parseFilter: function(t) {
                    for (; this.skip(n.TOKEN_PIPE); ) {
                        var e = this.parseFilterName();
                        t = new r.Filter(e.lineno,e.colno,e,new r.NodeList(e.lineno,e.colno,[t].concat(this.parseFilterArgs(t))))
                    }
                    return t
                },
                parseFilterStatement: function() {
                    var t = this.peekToken();
                    this.skipSymbol("filter") || this.fail("parseFilterStatement: expected filter");
                    var e = this.parseFilterName()
                      , i = this.parseFilterArgs(e);
                    this.advanceAfterBlockEnd(t.value);
                    var n = new r.Capture(e.lineno,e.colno,this.parseUntilBlocks("endfilter"));
                    this.advanceAfterBlockEnd();
                    var a = new r.Filter(e.lineno,e.colno,e,new r.NodeList(e.lineno,e.colno,[n].concat(i)));
                    return new r.Output(e.lineno,e.colno,[a])
                },
                parseAggregate: function() {
                    var t, e = this.nextToken();
                    switch (e.type) {
                    case n.TOKEN_LEFT_PAREN:
                        t = new r.Group(e.lineno,e.colno);
                        break;
                    case n.TOKEN_LEFT_BRACKET:
                        t = new r.Array(e.lineno,e.colno);
                        break;
                    case n.TOKEN_LEFT_CURLY:
                        t = new r.Dict(e.lineno,e.colno);
                        break;
                    default:
                        return null
                    }
                    for (; ; ) {
                        var i = this.peekToken().type;
                        if (i === n.TOKEN_RIGHT_PAREN || i === n.TOKEN_RIGHT_BRACKET || i === n.TOKEN_RIGHT_CURLY) {
                            this.nextToken();
                            break
                        }
                        if (t.children.length > 0 && (this.skip(n.TOKEN_COMMA) || this.fail("parseAggregate: expected comma after expression", e.lineno, e.colno)),
                        t instanceof r.Dict) {
                            var a = this.parsePrimary();
                            this.skip(n.TOKEN_COLON) || this.fail("parseAggregate: expected colon after dict key", e.lineno, e.colno);
                            var s = this.parseExpression();
                            t.addChild(new r.Pair(a.lineno,a.colno,a,s))
                        } else {
                            var o = this.parseExpression();
                            t.addChild(o)
                        }
                    }
                    return t
                },
                parseSignature: function(t, e) {
                    var i = this.peekToken();
                    if (!e && i.type !== n.TOKEN_LEFT_PAREN) {
                        if (t)
                            return null;
                        this.fail("expected arguments", i.lineno, i.colno)
                    }
                    i.type === n.TOKEN_LEFT_PAREN && (i = this.nextToken());
                    for (var a = new r.NodeList(i.lineno,i.colno), s = new r.KeywordArgs(i.lineno,i.colno), o = !1; ; ) {
                        if (i = this.peekToken(),
                        !e && i.type === n.TOKEN_RIGHT_PAREN) {
                            this.nextToken();
                            break
                        }
                        if (e && i.type === n.TOKEN_BLOCK_END)
                            break;
                        if (o && !this.skip(n.TOKEN_COMMA))
                            this.fail("parseSignature: expected comma after expression", i.lineno, i.colno);
                        else {
                            var l = this.parseExpression();
                            this.skipValue(n.TOKEN_OPERATOR, "=") ? s.addChild(new r.Pair(l.lineno,l.colno,l,this.parseExpression())) : a.addChild(l)
                        }
                        o = !0
                    }
                    return s.children.length && a.addChild(s),
                    a
                },
                parseUntilBlocks: function() {
                    var t = this.breakOnBlocks;
                    this.breakOnBlocks = s.toArray(arguments);
                    var e = this.parse();
                    return this.breakOnBlocks = t,
                    e
                },
                parseNodes: function() {
                    for (var t, e = []; t = this.nextToken(); )
                        if (t.type === n.TOKEN_DATA) {
                            var i = t.value
                              , a = this.peekToken()
                              , s = a && a.value;
                            this.dropLeadingWhitespace && (i = i.replace(/^\s*/, ""),
                            this.dropLeadingWhitespace = !1),
                            a && (a.type === n.TOKEN_BLOCK_START && "-" === s.charAt(s.length - 1) || a.type === n.TOKEN_VARIABLE_START && "-" === s.charAt(this.tokens.tags.VARIABLE_START.length) || a.type === n.TOKEN_COMMENT && "-" === s.charAt(this.tokens.tags.COMMENT_START.length)) && (i = i.replace(/\s*$/, "")),
                            e.push(new r.Output(t.lineno,t.colno,[new r.TemplateData(t.lineno,t.colno,i)]))
                        } else if (t.type === n.TOKEN_BLOCK_START) {
                            this.dropLeadingWhitespace = !1;
                            var o = this.parseStatement();
                            if (!o)
                                break;
                            e.push(o)
                        } else if (t.type === n.TOKEN_VARIABLE_START) {
                            var l = this.parseExpression();
                            this.dropLeadingWhitespace = !1,
                            this.advanceAfterVariableEnd(),
                            e.push(new r.Output(t.lineno,t.colno,[l]))
                        } else
                            t.type === n.TOKEN_COMMENT ? this.dropLeadingWhitespace = "-" === t.value.charAt(t.value.length - this.tokens.tags.COMMENT_END.length - 1) : this.fail("Unexpected token at top-level: " + t.type, t.lineno, t.colno);
                    return e
                },
                parse: function() {
                    return new r.NodeList(0,0,this.parseNodes())
                },
                parseAsRoot: function() {
                    return new r.Root(0,0,this.parseNodes())
                }
            });
            t.exports = {
                parse: function(t, e, i) {
                    var r = new o(n.lex(t, i));
                    return void 0 !== e && (r.extensions = e),
                    r.parseAsRoot()
                }
            }
        }
        , function(t, e, i) {
            "use strict";
            function n(t, e, i, n) {
                return {
                    type: t,
                    value: e,
                    lineno: i,
                    colno: n
                }
            }
            function r(t, e) {
                this.str = t,
                this.index = 0,
                this.len = t.length,
                this.lineno = 0,
                this.colno = 0,
                this.in_code = !1,
                e = e || {};
                var i = e.tags || {};
                this.tags = {
                    BLOCK_START: i.blockStart || o,
                    BLOCK_END: i.blockEnd || l,
                    VARIABLE_START: i.variableStart || u,
                    VARIABLE_END: i.variableEnd || h,
                    COMMENT_START: i.commentStart || c,
                    COMMENT_END: i.commentEnd || d
                },
                this.trimBlocks = !!e.trimBlocks,
                this.lstripBlocks = !!e.lstripBlocks
            }
            var a = i(1)
              , s = "()[]{}%*-+~/#,:|.<>=!"
              , o = "{%"
              , l = "%}"
              , u = "{{"
              , h = "}}"
              , c = "{#"
              , d = "#}";
            r.prototype.nextToken = function() {
                var t, e = this.lineno, i = this.colno;
                if (this.in_code) {
                    var r = this.current();
                    if (this.is_finished())
                        return null;
                    if ('"' === r || "'" === r)
                        return n("string", this.parseString(r), e, i);
                    if (t = this._extract(" \n\t\r "))
                        return n("whitespace", t, e, i);
                    if ((t = this._extractString(this.tags.BLOCK_END)) || (t = this._extractString("-" + this.tags.BLOCK_END)))
                        return this.in_code = !1,
                        this.trimBlocks && (r = this.current(),
                        "\n" === r ? this.forward() : "\r" === r && (this.forward(),
                        r = this.current(),
                        "\n" === r ? this.forward() : this.back())),
                        n("block-end", t, e, i);
                    if ((t = this._extractString(this.tags.VARIABLE_END)) || (t = this._extractString("-" + this.tags.VARIABLE_END)))
                        return this.in_code = !1,
                        n("variable-end", t, e, i);
                    if ("r" === r && "/" === this.str.charAt(this.index + 1)) {
                        this.forwardN(2);
                        for (var o = ""; !this.is_finished(); ) {
                            if ("/" === this.current() && "\\" !== this.previous()) {
                                this.forward();
                                break
                            }
                            o += this.current(),
                            this.forward()
                        }
                        for (var l = ["g", "i", "m", "y"], u = ""; !this.is_finished(); ) {
                            if (!(-1 !== l.indexOf(this.current())))
                                break;
                            u += this.current(),
                            this.forward()
                        }
                        return n("regex", {
                            body: o,
                            flags: u
                        }, e, i)
                    }
                    if (-1 !== s.indexOf(r)) {
                        this.forward();
                        var h, c = ["==", "===", "!=", "!==", "<=", ">=", "//", "**"], d = r + this.current();
                        switch (-1 !== a.indexOf(c, d) && (this.forward(),
                        r = d,
                        -1 !== a.indexOf(c, d + this.current()) && (r = d + this.current(),
                        this.forward())),
                        r) {
                        case "(":
                            h = "left-paren";
                            break;
                        case ")":
                            h = "right-paren";
                            break;
                        case "[":
                            h = "left-bracket";
                            break;
                        case "]":
                            h = "right-bracket";
                            break;
                        case "{":
                            h = "left-curly";
                            break;
                        case "}":
                            h = "right-curly";
                            break;
                        case ",":
                            h = "comma";
                            break;
                        case ":":
                            h = "colon";
                            break;
                        case "~":
                            h = "tilde";
                            break;
                        case "|":
                            h = "pipe";
                            break;
                        default:
                            h = "operator"
                        }
                        return n(h, r, e, i)
                    }
                    if (t = this._extractUntil(" \n\t\r " + s),
                    t.match(/^[-+]?[0-9]+$/)) {
                        if ("." === this.current()) {
                            this.forward();
                            return n("float", t + "." + this._extract("0123456789"), e, i)
                        }
                        return n("int", t, e, i)
                    }
                    if (t.match(/^(true|false)$/))
                        return n("boolean", t, e, i);
                    if ("none" === t)
                        return n("none", t, e, i);
                    if (t)
                        return n("symbol", t, e, i);
                    throw new Error("Unexpected value while parsing: " + t)
                }
                var p = this.tags.BLOCK_START.charAt(0) + this.tags.VARIABLE_START.charAt(0) + this.tags.COMMENT_START.charAt(0) + this.tags.COMMENT_END.charAt(0);
                if (this.is_finished())
                    return null;
                if ((t = this._extractString(this.tags.BLOCK_START + "-")) || (t = this._extractString(this.tags.BLOCK_START)))
                    return this.in_code = !0,
                    n("block-start", t, e, i);
                if ((t = this._extractString(this.tags.VARIABLE_START + "-")) || (t = this._extractString(this.tags.VARIABLE_START)))
                    return this.in_code = !0,
                    n("variable-start", t, e, i);
                t = "";
                var f, g = !1;
                for (this._matches(this.tags.COMMENT_START) && (g = !0,
                t = this._extractString(this.tags.COMMENT_START)); null !== (f = this._extractUntil(p)); ) {
                    if (t += f,
                    (this._matches(this.tags.BLOCK_START) || this._matches(this.tags.VARIABLE_START) || this._matches(this.tags.COMMENT_START)) && !g) {
                        if (this.lstripBlocks && this._matches(this.tags.BLOCK_START) && this.colno > 0 && this.colno <= t.length) {
                            if (/^\s+$/.test(t.slice(-this.colno)) && (t = t.slice(0, -this.colno),
                            !t.length))
                                return this.nextToken()
                        }
                        break
                    }
                    if (this._matches(this.tags.COMMENT_END)) {
                        if (!g)
                            throw new Error("unexpected end of comment");
                        t += this._extractString(this.tags.COMMENT_END);
                        break
                    }
                    t += this.current(),
                    this.forward()
                }
                if (null === f && g)
                    throw new Error("expected end of comment, got end of file");
                return n(g ? "comment" : "data", t, e, i)
            }
            ,
            r.prototype.parseString = function(t) {
                this.forward();
                for (var e = ""; !this.is_finished() && this.current() !== t; ) {
                    var i = this.current();
                    if ("\\" === i) {
                        switch (this.forward(),
                        this.current()) {
                        case "n":
                            e += "\n";
                            break;
                        case "t":
                            e += "\t";
                            break;
                        case "r":
                            e += "\r";
                            break;
                        default:
                            e += this.current()
                        }
                        this.forward()
                    } else
                        e += i,
                        this.forward()
                }
                return this.forward(),
                e
            }
            ,
            r.prototype._matches = function(t) {
                return this.index + t.length > this.len ? null : this.str.slice(this.index, this.index + t.length) === t
            }
            ,
            r.prototype._extractString = function(t) {
                return this._matches(t) ? (this.index += t.length,
                t) : null
            }
            ,
            r.prototype._extractUntil = function(t) {
                return this._extractMatching(!0, t || "")
            }
            ,
            r.prototype._extract = function(t) {
                return this._extractMatching(!1, t)
            }
            ,
            r.prototype._extractMatching = function(t, e) {
                if (this.is_finished())
                    return null;
                var i = e.indexOf(this.current());
                if (t && -1 === i || !t && -1 !== i) {
                    var n = this.current();
                    this.forward();
                    for (var r = e.indexOf(this.current()); (t && -1 === r || !t && -1 !== r) && !this.is_finished(); )
                        n += this.current(),
                        this.forward(),
                        r = e.indexOf(this.current());
                    return n
                }
                return ""
            }
            ,
            r.prototype._extractRegex = function(t) {
                var e = this.currentStr().match(t);
                return e ? (this.forwardN(e[0].length),
                e) : null
            }
            ,
            r.prototype.is_finished = function() {
                return this.index >= this.len
            }
            ,
            r.prototype.forwardN = function(t) {
                for (var e = 0; e < t; e++)
                    this.forward()
            }
            ,
            r.prototype.forward = function() {
                this.index++,
                "\n" === this.previous() ? (this.lineno++,
                this.colno = 0) : this.colno++
            }
            ,
            r.prototype.backN = function(t) {
                for (var e = 0; e < t; e++)
                    this.back()
            }
            ,
            r.prototype.back = function() {
                if (this.index--,
                "\n" === this.current()) {
                    this.lineno--;
                    var t = this.src.lastIndexOf("\n", this.index - 1);
                    this.colno = -1 === t ? this.index : this.index - t
                } else
                    this.colno--
            }
            ,
            r.prototype.current = function() {
                return this.is_finished() ? "" : this.str.charAt(this.index)
            }
            ,
            r.prototype.currentStr = function() {
                return this.is_finished() ? "" : this.str.substr(this.index)
            }
            ,
            r.prototype.previous = function() {
                return this.str.charAt(this.index - 1)
            }
            ,
            t.exports = {
                lex: function(t, e) {
                    return new r(t,e)
                },
                TOKEN_STRING: "string",
                TOKEN_WHITESPACE: "whitespace",
                TOKEN_DATA: "data",
                TOKEN_BLOCK_START: "block-start",
                TOKEN_BLOCK_END: "block-end",
                TOKEN_VARIABLE_START: "variable-start",
                TOKEN_VARIABLE_END: "variable-end",
                TOKEN_COMMENT: "comment",
                TOKEN_LEFT_PAREN: "left-paren",
                TOKEN_RIGHT_PAREN: "right-paren",
                TOKEN_LEFT_BRACKET: "left-bracket",
                TOKEN_RIGHT_BRACKET: "right-bracket",
                TOKEN_LEFT_CURLY: "left-curly",
                TOKEN_RIGHT_CURLY: "right-curly",
                TOKEN_OPERATOR: "operator",
                TOKEN_COMMA: "comma",
                TOKEN_COLON: "colon",
                TOKEN_TILDE: "tilde",
                TOKEN_PIPE: "pipe",
                TOKEN_INT: "int",
                TOKEN_FLOAT: "float",
                TOKEN_BOOLEAN: "boolean",
                TOKEN_NONE: "none",
                TOKEN_SYMBOL: "symbol",
                TOKEN_SPECIAL: "special",
                TOKEN_REGEX: "regex"
            }
        }
        , function(t, e, i) {
            (function(e) {
                "use strict";
                function n(t, e, i) {
                    t instanceof e && i.push(t),
                    t instanceof o && t.findAll(e, i)
                }
                function r(t, i) {
                    function n(t, i, n) {
                        for (var r = t.split("\n"), a = 0; a < r.length; a++) {
                            if (r[a] && (n && a > 0 || !n))
                                for (var s = 0; s < i; s++)
                                    e.stdout.write(" ");
                            a === r.length - 1 ? e.stdout.write(r[a]) : e.stdout.write(r[a] + "\n")
                        }
                    }
                    if (i = i || 0,
                    n(t.typename + ": ", i),
                    t instanceof u)
                        n("\n"),
                        a.each(t.children, function(t) {
                            r(t, i + 2)
                        });
                    else if (t instanceof at)
                        n(t.extName + "." + t.prop),
                        n("\n"),
                        t.args && r(t.args, i + 2),
                        t.contentArgs && a.each(t.contentArgs, function(t) {
                            r(t, i + 2)
                        });
                    else {
                        var s = null
                          , l = null;
                        if (t.iterFields(function(t, e) {
                            t instanceof o ? (s = s || {},
                            s[e] = t) : (l = l || {},
                            l[e] = t)
                        }),
                        l ? n(JSON.stringify(l, null, 2) + "\n", null, !0) : n("\n"),
                        s)
                            for (var h in s)
                                r(s[h], i + 2)
                    }
                }
                var a = i(1)
                  , s = i(6)
                  , o = s.extend("Node", {
                    init: function(t, e) {
                        this.lineno = t,
                        this.colno = e;
                        for (var i = this.fields, n = 0, r = i.length; n < r; n++) {
                            var a = i[n]
                              , s = arguments[n + 2];
                            void 0 === s && (s = null),
                            this[a] = s
                        }
                    },
                    findAll: function(t, e) {
                        e = e || [];
                        var i, r;
                        if (this instanceof u) {
                            var a = this.children;
                            for (i = 0,
                            r = a.length; i < r; i++)
                                n(a[i], t, e)
                        } else {
                            var s = this.fields;
                            for (i = 0,
                            r = s.length; i < r; i++)
                                n(this[s[i]], t, e)
                        }
                        return e
                    },
                    iterFields: function(t) {
                        a.each(this.fields, function(e) {
                            t(this[e], e)
                        }, this)
                    }
                })
                  , l = o.extend("Value", {
                    fields: ["value"]
                })
                  , u = o.extend("NodeList", {
                    fields: ["children"],
                    init: function(t, e, i) {
                        this.parent(t, e, i || [])
                    },
                    addChild: function(t) {
                        this.children.push(t)
                    }
                })
                  , h = u.extend("Root")
                  , c = l.extend("Literal")
                  , d = l.extend("Symbol")
                  , p = u.extend("Group")
                  , f = u.extend("Array")
                  , g = o.extend("Pair", {
                    fields: ["key", "value"]
                })
                  , m = u.extend("Dict")
                  , v = o.extend("LookupVal", {
                    fields: ["target", "val"]
                })
                  , _ = o.extend("If", {
                    fields: ["cond", "body", "else_"]
                })
                  , b = _.extend("IfAsync")
                  , x = o.extend("InlineIf", {
                    fields: ["cond", "body", "else_"]
                })
                  , y = o.extend("For", {
                    fields: ["arr", "name", "body", "else_"]
                })
                  , S = y.extend("AsyncEach")
                  , w = y.extend("AsyncAll")
                  , C = o.extend("Macro", {
                    fields: ["name", "args", "body"]
                })
                  , M = C.extend("Caller")
                  , T = o.extend("Import", {
                    fields: ["template", "target", "withContext"]
                })
                  , A = o.extend("FromImport", {
                    fields: ["template", "names", "withContext"],
                    init: function(t, e, i, n, r) {
                        this.parent(t, e, i, n || new u, r)
                    }
                })
                  , E = o.extend("FunCall", {
                    fields: ["name", "args"]
                })
                  , P = E.extend("Filter")
                  , N = P.extend("FilterAsync", {
                    fields: ["name", "args", "symbol"]
                })
                  , k = m.extend("KeywordArgs")
                  , F = o.extend("Block", {
                    fields: ["name", "body"]
                })
                  , D = o.extend("Super", {
                    fields: ["blockName", "symbol"]
                })
                  , R = o.extend("TemplateRef", {
                    fields: ["template"]
                })
                  , I = R.extend("Extends")
                  , O = o.extend("Include", {
                    fields: ["template", "ignoreMissing"]
                })
                  , L = o.extend("Set", {
                    fields: ["targets", "value"]
                })
                  , B = u.extend("Output")
                  , V = o.extend("Capture", {
                    fields: ["body"]
                })
                  , U = c.extend("TemplateData")
                  , G = o.extend("UnaryOp", {
                    fields: ["target"]
                })
                  , z = o.extend("BinOp", {
                    fields: ["left", "right"]
                })
                  , H = z.extend("In")
                  , j = z.extend("Or")
                  , W = z.extend("And")
                  , q = G.extend("Not")
                  , Y = z.extend("Add")
                  , X = z.extend("Concat")
                  , K = z.extend("Sub")
                  , J = z.extend("Mul")
                  , Q = z.extend("Div")
                  , Z = z.extend("FloorDiv")
                  , $ = z.extend("Mod")
                  , tt = z.extend("Pow")
                  , et = G.extend("Neg")
                  , it = G.extend("Pos")
                  , nt = o.extend("Compare", {
                    fields: ["expr", "ops"]
                })
                  , rt = o.extend("CompareOperand", {
                    fields: ["expr", "type"]
                })
                  , at = o.extend("CallExtension", {
                    fields: ["extName", "prop", "args", "contentArgs"],
                    init: function(t, e, i, n) {
                        this.extName = t._name || t,
                        this.prop = e,
                        this.args = i || new u,
                        this.contentArgs = n || [],
                        this.autoescape = t.autoescape
                    }
                })
                  , st = at.extend("CallExtensionAsync");
                t.exports = {
                    Node: o,
                    Root: h,
                    NodeList: u,
                    Value: l,
                    Literal: c,
                    Symbol: d,
                    Group: p,
                    Array: f,
                    Pair: g,
                    Dict: m,
                    Output: B,
                    Capture: V,
                    TemplateData: U,
                    If: _,
                    IfAsync: b,
                    InlineIf: x,
                    For: y,
                    AsyncEach: S,
                    AsyncAll: w,
                    Macro: C,
                    Caller: M,
                    Import: T,
                    FromImport: A,
                    FunCall: E,
                    Filter: P,
                    FilterAsync: N,
                    KeywordArgs: k,
                    Block: F,
                    Super: D,
                    Extends: I,
                    Include: O,
                    Set: L,
                    LookupVal: v,
                    BinOp: z,
                    In: H,
                    Or: j,
                    And: W,
                    Not: q,
                    Add: Y,
                    Concat: X,
                    Sub: K,
                    Mul: J,
                    Div: Q,
                    FloorDiv: Z,
                    Mod: $,
                    Pow: tt,
                    Neg: et,
                    Pos: it,
                    Compare: nt,
                    CompareOperand: rt,
                    CallExtension: at,
                    CallExtensionAsync: st,
                    printNodes: r
                }
            }
            ).call(e, i(3))
        }
        , function(t, e, i) {
            "use strict";
            function n() {
                return "hole_" + g++
            }
            function r(t, e) {
                for (var i = null, n = 0; n < t.length; n++) {
                    var r = e(t[n]);
                    r !== t[n] && (i || (i = t.slice()),
                    i[n] = r)
                }
                return i || t
            }
            function a(t, e, i) {
                if (!(t instanceof p.Node))
                    return t;
                if (!i) {
                    var n = e(t);
                    if (n && n !== t)
                        return n
                }
                if (t instanceof p.NodeList) {
                    var s = r(t.children, function(t) {
                        return a(t, e, i)
                    });
                    s !== t.children && (t = new p[t.typename](t.lineno,t.colno,s))
                } else if (t instanceof p.CallExtension) {
                    var o = a(t.args, e, i)
                      , l = r(t.contentArgs, function(t) {
                        return a(t, e, i)
                    });
                    o === t.args && l === t.contentArgs || (t = new p[t.typename](t.extName,t.prop,o,l))
                } else {
                    var u = t.fields.map(function(e) {
                        return t[e]
                    })
                      , h = r(u, function(t) {
                        return a(t, e, i)
                    });
                    h !== u && (t = new p[t.typename](t.lineno,t.colno),
                    h.forEach(function(e, i) {
                        t[t.fields[i]] = e
                    }))
                }
                return i ? e(t) || t : t
            }
            function s(t, e) {
                return a(t, e, !0)
            }
            function o(t, e, i) {
                var r = []
                  , a = s(i ? t[i] : t, function(t) {
                    if (t instanceof p.Block)
                        return t;
                    if (t instanceof p.Filter && -1 !== f.indexOf(e, t.name.value) || t instanceof p.CallExtensionAsync) {
                        var i = new p.Symbol(t.lineno,t.colno,n());
                        return r.push(new p.FilterAsync(t.lineno,t.colno,t.name,t.args,i)),
                        i
                    }
                });
                return i ? t[i] = a : t = a,
                r.length ? (r.push(t),
                new p.NodeList(t.lineno,t.colno,r)) : t
            }
            function l(t, e) {
                return s(t, function(t) {
                    return t instanceof p.Output ? o(t, e) : t instanceof p.Set ? o(t, e, "value") : t instanceof p.For ? o(t, e, "arr") : t instanceof p.If ? o(t, e, "cond") : t instanceof p.CallExtension ? o(t, e, "args") : void 0
                })
            }
            function u(t) {
                return a(t, function(t) {
                    if (t instanceof p.Block) {
                        var e = !1
                          , i = n();
                        t.body = a(t.body, function(t) {
                            if (t instanceof p.FunCall && "super" === t.name.value)
                                return e = !0,
                                new p.Symbol(t.lineno,t.colno,i)
                        }),
                        e && t.body.children.unshift(new p.Super(0,0,t.name,new p.Symbol(0,0,i)))
                    }
                })
            }
            function h(t) {
                return s(t, function(t) {
                    if (t instanceof p.If || t instanceof p.For) {
                        var e = !1;
                        if (a(t, function(t) {
                            if (t instanceof p.FilterAsync || t instanceof p.IfAsync || t instanceof p.AsyncEach || t instanceof p.AsyncAll || t instanceof p.CallExtensionAsync)
                                return e = !0,
                                t
                        }),
                        e) {
                            if (t instanceof p.If)
                                return new p.IfAsync(t.lineno,t.colno,t.cond,t.body,t.else_);
                            if (t instanceof p.For)
                                return new p.AsyncEach(t.lineno,t.colno,t.arr,t.name,t.body,t.else_)
                        }
                    }
                })
            }
            function c(t, e) {
                return h(u(l(t, e)))
            }
            function d(t, e) {
                return c(t, e || [])
            }
            var p = i(10)
              , f = i(1)
              , g = 0;
            t.exports = {
                transform: d
            }
        }
        , function(t, e, i) {
            "use strict";
            function n(t, e, i) {
                return function() {
                    var n, r, o = s(arguments), l = a(arguments);
                    if (o > t.length) {
                        n = Array.prototype.slice.call(arguments, 0, t.length);
                        var u = Array.prototype.slice.call(arguments, n.length, o);
                        for (r = 0; r < u.length; r++)
                            r < e.length && (l[e[r]] = u[r]);
                        n.push(l)
                    } else if (o < t.length) {
                        for (n = Array.prototype.slice.call(arguments, 0, o),
                        r = o; r < t.length; r++) {
                            var h = t[r];
                            n.push(l[h]),
                            delete l[h]
                        }
                        n.push(l)
                    } else
                        n = arguments;
                    return i.apply(this, n)
                }
            }
            function r(t) {
                return t.__keywords = !0,
                t
            }
            function a(t) {
                var e = t.length;
                if (e) {
                    var i = t[e - 1];
                    if (i && i.hasOwnProperty("__keywords"))
                        return i
                }
                return {}
            }
            function s(t) {
                var e = t.length;
                if (0 === e)
                    return 0;
                var i = t[e - 1];
                return i && i.hasOwnProperty("__keywords") ? e - 1 : e
            }
            function o(t) {
                if ("string" != typeof t)
                    return t;
                this.val = t,
                this.length = t.length
            }
            function l(t, e) {
                return t instanceof o ? new o(e) : e.toString()
            }
            function u(t) {
                var e = typeof t;
                return "string" === e ? new o(t) : "function" !== e ? t : function() {
                    var e = t.apply(this, arguments);
                    return "string" == typeof e ? new o(e) : e
                }
            }
            function h(t, e) {
                return t = void 0 !== t && null !== t ? t : "",
                !e || t instanceof o || (t = _.escape(t.toString())),
                t
            }
            function c(t, e, i) {
                if (null === t || void 0 === t)
                    throw new _.TemplateError("attempted to output null or undefined value",e + 1,i + 1);
                return t
            }
            function d(t, e) {
                return t = t || {},
                "function" == typeof t[e] ? function() {
                    return t[e].apply(t, arguments)
                }
                : t[e]
            }
            function p(t, e, i, n) {
                if (!t)
                    throw new Error("Unable to call `" + e + "`, which is undefined or falsey");
                if ("function" != typeof t)
                    throw new Error("Unable to call `" + e + "`, which is not a function");
                return t.apply(i, n)
            }
            function f(t, e, i) {
                var n = e.lookup(i);
                return void 0 !== n ? n : t.lookup(i)
            }
            function g(t, e, i) {
                return t.lineno ? t : new _.TemplateError(t,e,i)
            }
            function m(t, e, i, n) {
                if (_.isArray(t)) {
                    var r = t.length;
                    _.asyncIter(t, function(t, n, a) {
                        switch (e) {
                        case 1:
                            i(t, n, r, a);
                            break;
                        case 2:
                            i(t[0], t[1], n, r, a);
                            break;
                        case 3:
                            i(t[0], t[1], t[2], n, r, a);
                            break;
                        default:
                            t.push(n, a),
                            i.apply(this, t)
                        }
                    }, n)
                } else
                    _.asyncFor(t, function(t, e, n, r, a) {
                        i(t, e, n, r, a)
                    }, n)
            }
            function v(t, e, i, n) {
                function r(t, e) {
                    l++,
                    o[t] = e,
                    l === a && n(null, o.join(""))
                }
                var a, s, o, l = 0;
                if (_.isArray(t))
                    if (a = t.length,
                    o = new Array(a),
                    0 === a)
                        n(null, "");
                    else
                        for (s = 0; s < t.length; s++) {
                            var u = t[s];
                            switch (e) {
                            case 1:
                                i(u, s, a, r);
                                break;
                            case 2:
                                i(u[0], u[1], s, a, r);
                                break;
                            case 3:
                                i(u[0], u[1], u[2], s, a, r);
                                break;
                            default:
                                u.push(s, r),
                                i.apply(this, u)
                            }
                        }
                else {
                    var h = _.keys(t);
                    if (a = h.length,
                    o = new Array(a),
                    0 === a)
                        n(null, "");
                    else
                        for (s = 0; s < h.length; s++) {
                            var c = h[s];
                            i(c, t[c], s, a, r)
                        }
                }
            }
            var _ = i(1)
              , b = i(6)
              , x = b.extend({
                init: function(t, e) {
                    this.variables = {},
                    this.parent = t,
                    this.topLevel = !1,
                    this.isolateWrites = e
                },
                set: function(t, e, i) {
                    var n = t.split(".")
                      , r = this.variables
                      , a = this;
                    if (i && (a = this.resolve(n[0], !0)))
                        return void a.set(t, e);
                    for (var s = 0; s < n.length - 1; s++) {
                        var o = n[s];
                        r[o] || (r[o] = {}),
                        r = r[o]
                    }
                    r[n[n.length - 1]] = e
                },
                get: function(t) {
                    var e = this.variables[t];
                    return void 0 !== e ? e : null
                },
                lookup: function(t) {
                    var e = this.parent
                      , i = this.variables[t];
                    return void 0 !== i ? i : e && e.lookup(t)
                },
                resolve: function(t, e) {
                    var i = e && this.isolateWrites ? void 0 : this.parent;
                    return void 0 !== this.variables[t] ? this : i && i.resolve(t)
                },
                push: function(t) {
                    return new x(this,t)
                },
                pop: function() {
                    return this.parent
                }
            });
            o.prototype = Object.create(String.prototype, {
                length: {
                    writable: !0,
                    configurable: !0,
                    value: 0
                }
            }),
            o.prototype.valueOf = function() {
                return this.val
            }
            ,
            o.prototype.toString = function() {
                return this.val
            }
            ,
            t.exports = {
                Frame: x,
                makeMacro: n,
                makeKeywordArgs: r,
                numArgs: s,
                suppressValue: h,
                ensureDefined: c,
                memberLookup: d,
                contextOrFrameLookup: f,
                callWrap: p,
                handleError: g,
                isArray: _.isArray,
                keys: _.keys,
                SafeString: o,
                copySafeness: l,
                markSafe: u,
                asyncEach: m,
                asyncAll: v,
                inOperator: _.inOperator
            }
        }
        , function(t, e, i) {
            "use strict";
            function n(t, e) {
                return null === t || void 0 === t || !1 === t ? e : t
            }
            var r = i(1)
              , a = i(12)
              , s = {
                abs: function(t) {
                    return Math.abs(t)
                },
                batch: function(t, e, i) {
                    var n, r = [], a = [];
                    for (n = 0; n < t.length; n++)
                        n % e == 0 && a.length && (r.push(a),
                        a = []),
                        a.push(t[n]);
                    if (a.length) {
                        if (i)
                            for (n = a.length; n < e; n++)
                                a.push(i);
                        r.push(a)
                    }
                    return r
                },
                capitalize: function(t) {
                    t = n(t, "");
                    var e = t.toLowerCase();
                    return a.copySafeness(t, e.charAt(0).toUpperCase() + e.slice(1))
                },
                center: function(t, e) {
                    if (t = n(t, ""),
                    e = e || 80,
                    t.length >= e)
                        return t;
                    var i = e - t.length
                      , s = r.repeat(" ", i / 2 - i % 2)
                      , o = r.repeat(" ", i / 2);
                    return a.copySafeness(t, s + t + o)
                },
                default: function(t, e, i) {
                    return i ? t || e : void 0 !== t ? t : e
                },
                dictsort: function(t, e, i) {
                    if (!r.isObject(t))
                        throw new r.TemplateError("dictsort filter: val must be an object");
                    var n = [];
                    for (var a in t)
                        n.push([a, t[a]]);
                    var s;
                    if (void 0 === i || "key" === i)
                        s = 0;
                    else {
                        if ("value" !== i)
                            throw new r.TemplateError("dictsort filter: You can only sort by either key or value");
                        s = 1
                    }
                    return n.sort(function(t, i) {
                        var n = t[s]
                          , a = i[s];
                        return e || (r.isString(n) && (n = n.toUpperCase()),
                        r.isString(a) && (a = a.toUpperCase())),
                        n > a ? 1 : n === a ? 0 : -1
                    }),
                    n
                },
                dump: function(t, e) {
                    return JSON.stringify(t, null, e)
                },
                escape: function(t) {
                    return t instanceof a.SafeString ? t : (t = null === t || void 0 === t ? "" : t,
                    a.markSafe(r.escape(t.toString())))
                },
                safe: function(t) {
                    return t instanceof a.SafeString ? t : (t = null === t || void 0 === t ? "" : t,
                    a.markSafe(t.toString()))
                },
                first: function(t) {
                    return t[0]
                },
                groupby: function(t, e) {
                    return r.groupBy(t, e)
                },
                indent: function(t, e, i) {
                    if ("" === (t = n(t, "")))
                        return "";
                    e = e || 4;
                    for (var s = "", o = t.split("\n"), l = r.repeat(" ", e), u = 0; u < o.length; u++)
                        s += 0 !== u || i ? l + o[u] + "\n" : o[u] + "\n";
                    return a.copySafeness(t, s)
                },
                join: function(t, e, i) {
                    return e = e || "",
                    i && (t = r.map(t, function(t) {
                        return t[i]
                    })),
                    t.join(e)
                },
                last: function(t) {
                    return t[t.length - 1]
                },
                length: function(t) {
                    var e = n(t, "");
                    return void 0 !== e ? "function" == typeof Map && e instanceof Map || "function" == typeof Set && e instanceof Set ? e.size : !r.isObject(e) || e instanceof a.SafeString ? e.length : Object.keys(e).length : 0
                },
                list: function(t) {
                    if (r.isString(t))
                        return t.split("");
                    if (r.isObject(t)) {
                        var e = [];
                        if (Object.keys)
                            e = Object.keys(t);
                        else
                            for (var i in t)
                                e.push(i);
                        return r.map(e, function(e) {
                            return {
                                key: e,
                                value: t[e]
                            }
                        })
                    }
                    if (r.isArray(t))
                        return t;
                    throw new r.TemplateError("list filter: type not iterable")
                },
                lower: function(t) {
                    return t = n(t, ""),
                    t.toLowerCase()
                },
                nl2br: function(t) {
                    return null === t || void 0 === t ? "" : a.copySafeness(t, t.replace(/\r\n|\n/g, "<br />\n"))
                },
                random: function(t) {
                    return t[Math.floor(Math.random() * t.length)]
                },
                rejectattr: function(t, e) {
                    return t.filter(function(t) {
                        return !t[e]
                    })
                },
                selectattr: function(t, e) {
                    return t.filter(function(t) {
                        return !!t[e]
                    })
                },
                replace: function(t, e, i, n) {
                    var r = t;
                    if (e instanceof RegExp)
                        return t.replace(e, i);
                    void 0 === n && (n = -1);
                    var s = "";
                    if ("number" == typeof e)
                        e += "";
                    else if ("string" != typeof e)
                        return t;
                    if ("number" == typeof t && (t += ""),
                    "string" != typeof t && !(t instanceof a.SafeString))
                        return t;
                    if ("" === e)
                        return s = i + t.split("").join(i) + i,
                        a.copySafeness(t, s);
                    var o = t.indexOf(e);
                    if (0 === n || -1 === o)
                        return t;
                    for (var l = 0, u = 0; o > -1 && (-1 === n || u < n); )
                        s += t.substring(l, o) + i,
                        l = o + e.length,
                        u++,
                        o = t.indexOf(e, l);
                    return l < t.length && (s += t.substring(l)),
                    a.copySafeness(r, s)
                },
                reverse: function(t) {
                    var e;
                    return e = r.isString(t) ? s.list(t) : r.map(t, function(t) {
                        return t
                    }),
                    e.reverse(),
                    r.isString(t) ? a.copySafeness(t, e.join("")) : e
                },
                round: function(t, e, i) {
                    e = e || 0;
                    var n = Math.pow(10, e);
                    return ("ceil" === i ? Math.ceil : "floor" === i ? Math.floor : Math.round)(t * n) / n
                },
                slice: function(t, e, i) {
                    for (var n = Math.floor(t.length / e), r = t.length % e, a = 0, s = [], o = 0; o < e; o++) {
                        var l = a + o * n;
                        o < r && a++;
                        var u = a + (o + 1) * n
                          , h = t.slice(l, u);
                        i && o >= r && h.push(i),
                        s.push(h)
                    }
                    return s
                },
                sum: function(t, e, i) {
                    var n = 0;
                    "number" == typeof i && (n += i),
                    e && (t = r.map(t, function(t) {
                        return t[e]
                    }));
                    for (var a = 0; a < t.length; a++)
                        n += t[a];
                    return n
                },
                sort: a.makeMacro(["value", "reverse", "case_sensitive", "attribute"], [], function(t, e, i, n) {
                    return t = r.map(t, function(t) {
                        return t
                    }),
                    t.sort(function(t, a) {
                        var s, o;
                        return n ? (s = t[n],
                        o = a[n]) : (s = t,
                        o = a),
                        !i && r.isString(s) && r.isString(o) && (s = s.toLowerCase(),
                        o = o.toLowerCase()),
                        s < o ? e ? 1 : -1 : s > o ? e ? -1 : 1 : 0
                    }),
                    t
                }),
                string: function(t) {
                    return a.copySafeness(t, t)
                },
                striptags: function(t, e) {
                    t = n(t, ""),
                    e = e || !1;
                    var i = s.trim(t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>|<!--[\s\S]*?-->/gi, ""))
                      , r = "";
                    return r = e ? i.replace(/^ +| +$/gm, "").replace(/ +/g, " ").replace(/(\r\n)/g, "\n").replace(/\n\n\n+/g, "\n\n") : i.replace(/\s+/gi, " "),
                    a.copySafeness(t, r)
                },
                title: function(t) {
                    t = n(t, "");
                    for (var e = t.split(" "), i = 0; i < e.length; i++)
                        e[i] = s.capitalize(e[i]);
                    return a.copySafeness(t, e.join(" "))
                },
                trim: function(t) {
                    return a.copySafeness(t, t.replace(/^\s*|\s*$/g, ""))
                },
                truncate: function(t, e, i, r) {
                    var s = t;
                    if (t = n(t, ""),
                    e = e || 255,
                    t.length <= e)
                        return t;
                    if (i)
                        t = t.substring(0, e);
                    else {
                        var o = t.lastIndexOf(" ", e);
                        -1 === o && (o = e),
                        t = t.substring(0, o)
                    }
                    return t += void 0 !== r && null !== r ? r : "...",
                    a.copySafeness(s, t)
                },
                upper: function(t) {
                    return t = n(t, ""),
                    t.toUpperCase()
                },
                urlencode: function(t) {
                    var e = encodeURIComponent;
                    if (r.isString(t))
                        return e(t);
                    var i;
                    if (r.isArray(t))
                        i = t.map(function(t) {
                            return e(t[0]) + "=" + e(t[1])
                        });
                    else {
                        i = [];
                        for (var n in t)
                            t.hasOwnProperty(n) && i.push(e(n) + "=" + e(t[n]))
                    }
                    return i.join("&")
                },
                urlize: function(t, e, i) {
                    isNaN(e) && (e = 1 / 0);
                    var n = !0 === i ? ' rel="nofollow"' : ""
                      , r = /^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i
                      , a = /^https?:\/\/.*$/
                      , s = /^www\./
                      , o = /\.(?:org|net|com)(?:\:|\/|$)/;
                    return t.split(/(\s+)/).filter(function(t) {
                        return t && t.length
                    }).map(function(t) {
                        var i = t.match(/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/)
                          , l = i && i[1] || t;
                        return a.test(l) ? '<a href="' + l + '"' + n + ">" + l.substr(0, e) + "</a>" : s.test(l) ? '<a href="http://' + l + '"' + n + ">" + l.substr(0, e) + "</a>" : r.test(l) ? '<a href="mailto:' + l + '">' + l + "</a>" : o.test(l) ? '<a href="http://' + l + '"' + n + ">" + l.substr(0, e) + "</a>" : t
                    }).join("")
                },
                wordcount: function(t) {
                    t = n(t, "");
                    var e = t ? t.match(/\w+/g) : null;
                    return e ? e.length : null
                },
                float: function(t, e) {
                    var i = parseFloat(t);
                    return isNaN(i) ? e : i
                },
                int: function(t, e) {
                    var i = parseInt(t, 10);
                    return isNaN(i) ? e : i
                }
            };
            s.d = s.default,
            s.e = s.escape,
            t.exports = s
        }
        , function(t, e, i) {
            "use strict";
            var n = i(15)
              , r = i(16)
              , a = n.extend({
                init: function(t, e) {
                    this.baseURL = t || ".",
                    e = e || {},
                    this.useCache = !!e.useCache,
                    this.async = !!e.async
                },
                resolve: function(t, e) {
                    throw new Error("relative templates not support in the browser yet")
                },
                getSource: function(t, e) {
                    var i, n = this.useCache;
                    return this.fetch(this.baseURL + "/" + t, function(r, a) {
                        if (r)
                            if (e)
                                e(r.content);
                            else {
                                if (404 !== r.status)
                                    throw r.content;
                                i = null
                            }
                        else
                            i = {
                                src: a,
                                path: t,
                                noCache: !n
                            },
                            e && e(null, i)
                    }),
                    i
                },
                fetch: function(t, e) {
                    var i, n = !0;
                    window.XMLHttpRequest ? i = new XMLHttpRequest : window.ActiveXObject && (i = new ActiveXObject("Microsoft.XMLHTTP")),
                    i.onreadystatechange = function() {
                        4 === i.readyState && n && (n = !1,
                        0 === i.status || 200 === i.status ? e(null, i.responseText) : e({
                            status: i.status,
                            content: i.responseText
                        }))
                    }
                    ,
                    t += (-1 === t.indexOf("?") ? "?" : "&") + "s=" + (new Date).getTime(),
                    i.open("GET", t, this.async),
                    i.send()
                }
            });
            t.exports = {
                WebLoader: a,
                PrecompiledLoader: r
            }
        }
        , function(t, e, i) {
            "use strict";
            var n = i(3)
              , r = i(6)
              , a = i(1)
              , s = r.extend({
                on: function(t, e) {
                    this.listeners = this.listeners || {},
                    this.listeners[t] = this.listeners[t] || [],
                    this.listeners[t].push(e)
                },
                emit: function(t) {
                    var e = Array.prototype.slice.call(arguments, 1);
                    this.listeners && this.listeners[t] && a.each(this.listeners[t], function(t) {
                        t.apply(null, e)
                    })
                },
                resolve: function(t, e) {
                    return n.resolve(n.dirname(t), e)
                },
                isRelative: function(t) {
                    return 0 === t.indexOf("./") || 0 === t.indexOf("../")
                }
            });
            t.exports = s
        }
        , function(t, e, i) {
            "use strict";
            var n = i(15)
              , r = n.extend({
                init: function(t) {
                    this.precompiled = t || {}
                },
                getSource: function(t) {
                    return this.precompiled[t] ? {
                        src: {
                            type: "code",
                            obj: this.precompiled[t]
                        },
                        path: t
                    } : null
                }
            });
            t.exports = r
        }
        , function(t, e) {
            "use strict";
            function i(t) {
                var e = -1;
                return {
                    current: null,
                    reset: function() {
                        e = -1,
                        this.current = null
                    },
                    next: function() {
                        return e++,
                        e >= t.length && (e = 0),
                        this.current = t[e],
                        this.current
                    }
                }
            }
            function n(t) {
                t = t || ",";
                var e = !0;
                return function() {
                    var i = e ? "" : t;
                    return e = !1,
                    i
                }
            }
            function r() {
                return {
                    range: function(t, e, i) {
                        void 0 === e ? (e = t,
                        t = 0,
                        i = 1) : i || (i = 1);
                        var n, r = [];
                        if (i > 0)
                            for (n = t; n < e; n += i)
                                r.push(n);
                        else
                            for (n = t; n > e; n += i)
                                r.push(n);
                        return r
                    },
                    cycler: function() {
                        return i(Array.prototype.slice.call(arguments))
                    },
                    joiner: function(t) {
                        return n(t)
                    }
                }
            }
            t.exports = r
        }
        , function(t, e, i) {
            var n, r;
            (function(i, a) {
                !function(s) {
                    "use strict";
                    var o = function() {
                        var t = Array.prototype.slice.call(arguments);
                        "function" == typeof t[0] && t[0].apply(null, t.splice(1))
                    }
                      , l = function(t) {
                        "function" == typeof i ? i(t) : void 0 !== a && a.nextTick ? a.nextTick(t) : setTimeout(t, 0)
                    }
                      , u = function(t) {
                        var e = function(i) {
                            var n = function() {
                                return t.length && t[i].apply(null, arguments),
                                n.next()
                            };
                            return n.next = function() {
                                return i < t.length - 1 ? e(i + 1) : null
                            }
                            ,
                            n
                        };
                        return e(0)
                    }
                      , h = Array.isArray || function(t) {
                        return "[object Array]" === Object.prototype.toString.call(t)
                    }
                      , c = function(t, e, i) {
                        var n = i ? l : o;
                        if (e = e || function() {}
                        ,
                        !h(t)) {
                            var r = new Error("First argument to waterfall must be an array of functions");
                            return e(r)
                        }
                        if (!t.length)
                            return e();
                        var a = function(t) {
                            return function(i) {
                                if (i)
                                    e.apply(null, arguments),
                                    e = function() {}
                                    ;
                                else {
                                    var r = Array.prototype.slice.call(arguments, 1)
                                      , s = t.next();
                                    s ? r.push(a(s)) : r.push(e),
                                    n(function() {
                                        t.apply(null, r)
                                    })
                                }
                            }
                        };
                        a(u(t))()
                    };
                    n = [],
                    void 0 !== (r = function() {
                        return c
                    }
                    .apply(e, n)) && (t.exports = r)
                }()
            }
            ).call(e, i(19).setImmediate, i(3))
        }
        , function(t, e, i) {
            (function(t, n) {
                function r(t, e) {
                    this._id = t,
                    this._clearFn = e
                }
                var a = i(20).nextTick
                  , s = Function.prototype.apply
                  , o = Array.prototype.slice
                  , l = {}
                  , u = 0;
                e.setTimeout = function() {
                    return new r(s.call(setTimeout, window, arguments),clearTimeout)
                }
                ,
                e.setInterval = function() {
                    return new r(s.call(setInterval, window, arguments),clearInterval)
                }
                ,
                e.clearTimeout = e.clearInterval = function(t) {
                    t.close()
                }
                ,
                r.prototype.unref = r.prototype.ref = function() {}
                ,
                r.prototype.close = function() {
                    this._clearFn.call(window, this._id)
                }
                ,
                e.enroll = function(t, e) {
                    clearTimeout(t._idleTimeoutId),
                    t._idleTimeout = e
                }
                ,
                e.unenroll = function(t) {
                    clearTimeout(t._idleTimeoutId),
                    t._idleTimeout = -1
                }
                ,
                e._unrefActive = e.active = function(t) {
                    clearTimeout(t._idleTimeoutId);
                    var e = t._idleTimeout;
                    e >= 0 && (t._idleTimeoutId = setTimeout(function() {
                        t._onTimeout && t._onTimeout()
                    }, e))
                }
                ,
                e.setImmediate = "function" == typeof t ? t : function(t) {
                    var i = u++
                      , n = !(arguments.length < 2) && o.call(arguments, 1);
                    return l[i] = !0,
                    a(function() {
                        l[i] && (n ? t.apply(null, n) : t.call(null),
                        e.clearImmediate(i))
                    }),
                    i
                }
                ,
                e.clearImmediate = "function" == typeof n ? n : function(t) {
                    delete l[t]
                }
            }
            ).call(e, i(19).setImmediate, i(19).clearImmediate)
        }
        , function(t, e) {
            function i() {
                u = !1,
                s.length ? l = s.concat(l) : h = -1,
                l.length && n()
            }
            function n() {
                if (!u) {
                    var t = setTimeout(i);
                    u = !0;
                    for (var e = l.length; e; ) {
                        for (s = l,
                        l = []; ++h < e; )
                            s && s[h].run();
                        h = -1,
                        e = l.length
                    }
                    s = null,
                    u = !1,
                    clearTimeout(t)
                }
            }
            function r(t, e) {
                this.fun = t,
                this.array = e
            }
            function a() {}
            var s, o = t.exports = {}, l = [], u = !1, h = -1;
            o.nextTick = function(t) {
                var e = new Array(arguments.length - 1);
                if (arguments.length > 1)
                    for (var i = 1; i < arguments.length; i++)
                        e[i - 1] = arguments[i];
                l.push(new r(t,e)),
                1 !== l.length || u || setTimeout(n, 0)
            }
            ,
            r.prototype.run = function() {
                this.fun.apply(null, this.array)
            }
            ,
            o.title = "browser",
            o.browser = !0,
            o.env = {},
            o.argv = [],
            o.version = "",
            o.versions = {},
            o.on = a,
            o.addListener = a,
            o.once = a,
            o.off = a,
            o.removeListener = a,
            o.removeAllListeners = a,
            o.emit = a,
            o.binding = function(t) {
                throw new Error("process.binding is not supported")
            }
            ,
            o.cwd = function() {
                return "/"
            }
            ,
            o.chdir = function(t) {
                throw new Error("process.chdir is not supported")
            }
            ,
            o.umask = function() {
                return 0
            }
        }
        , function(t, e) {
            function i() {
                "use strict";
                var t = this.runtime
                  , e = this.lib
                  , i = t.contextOrFrameLookup;
                t.contextOrFrameLookup = function(t, e, n) {
                    var r = i.apply(this, arguments);
                    if (void 0 === r)
                        switch (n) {
                        case "True":
                            return !0;
                        case "False":
                            return !1;
                        case "None":
                            return null
                        }
                    return r
                }
                ;
                var n = t.memberLookup
                  , r = {
                    pop: function(t) {
                        if (void 0 === t)
                            return this.pop();
                        if (t >= this.length || t < 0)
                            throw new Error("KeyError");
                        return this.splice(t, 1)
                    },
                    append: function(t) {
                        return this.push(t)
                    },
                    remove: function(t) {
                        for (var e = 0; e < this.length; e++)
                            if (this[e] === t)
                                return this.splice(e, 1);
                        throw new Error("ValueError")
                    },
                    count: function(t) {
                        for (var e = 0, i = 0; i < this.length; i++)
                            this[i] === t && e++;
                        return e
                    },
                    index: function(t) {
                        var e;
                        if (-1 === (e = this.indexOf(t)))
                            throw new Error("ValueError");
                        return e
                    },
                    find: function(t) {
                        return this.indexOf(t)
                    },
                    insert: function(t, e) {
                        return this.splice(t, 0, e)
                    }
                }
                  , a = {
                    items: function() {
                        var t = [];
                        for (var e in this)
                            t.push([e, this[e]]);
                        return t
                    },
                    values: function() {
                        var t = [];
                        for (var e in this)
                            t.push(this[e]);
                        return t
                    },
                    keys: function() {
                        var t = [];
                        for (var e in this)
                            t.push(e);
                        return t
                    },
                    get: function(t, e) {
                        var i = this[t];
                        return void 0 === i && (i = e),
                        i
                    },
                    has_key: function(t) {
                        return this.hasOwnProperty(t)
                    },
                    pop: function(t, e) {
                        var i = this[t];
                        if (void 0 === i && void 0 !== e)
                            i = e;
                        else {
                            if (void 0 === i)
                                throw new Error("KeyError");
                            delete this[t]
                        }
                        return i
                    },
                    popitem: function() {
                        for (var t in this) {
                            var e = this[t];
                            return delete this[t],
                            [t, e]
                        }
                        throw new Error("KeyError")
                    },
                    setdefault: function(t, e) {
                        return t in this ? this[t] : (void 0 === e && (e = null),
                        this[t] = e)
                    },
                    update: function(t) {
                        for (var e in t)
                            this[e] = t[e];
                        return null
                    }
                };
                a.iteritems = a.items,
                a.itervalues = a.values,
                a.iterkeys = a.keys,
                t.memberLookup = function(t, i, s) {
                    return t = t || {},
                    e.isArray(t) && r.hasOwnProperty(i) ? function() {
                        return r[i].apply(t, arguments)
                    }
                    : e.isObject(t) && a.hasOwnProperty(i) ? function() {
                        return a[i].apply(t, arguments)
                    }
                    : n.apply(this, arguments)
                }
            }
            t.exports = i
        }
        ])
    })
}
, , , , function(t, e, i) {
    "use strict";
    e.a = function() {
        var t = window.navigator.userAgent
          , e = t.indexOf("MSIE ")
          , i = t.indexOf("Trident/");
        return (e >= 0 || i >= 0) && (document.all && !window.atob)
    }
}
, , , , , , , , , , , function(t, e, i) {
    var n = i(2);
    /*! jQuery UI - v1.10.3 - 2013-05-03
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.effect.js, jquery.ui.accordion.js, jquery.ui.autocomplete.js, jquery.ui.button.js, jquery.ui.datepicker.js, jquery.ui.dialog.js, jquery.ui.effect-blind.js, jquery.ui.effect-bounce.js, jquery.ui.effect-clip.js, jquery.ui.effect-drop.js, jquery.ui.effect-explode.js, jquery.ui.effect-fade.js, jquery.ui.effect-fold.js, jquery.ui.effect-highlight.js, jquery.ui.effect-pulsate.js, jquery.ui.effect-scale.js, jquery.ui.effect-shake.js, jquery.ui.effect-slide.js, jquery.ui.effect-transfer.js, jquery.ui.menu.js, jquery.ui.position.js, jquery.ui.progressbar.js, jquery.ui.slider.js, jquery.ui.spinner.js, jquery.ui.tabs.js, jquery.ui.tooltip.js
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
    !function(t, e) {
        function i(e, i) {
            var r, a, s, o = e.nodeName.toLowerCase();
            return "area" === o ? (r = e.parentNode,
            a = r.name,
            !(!e.href || !a || "map" !== r.nodeName.toLowerCase()) && (!!(s = t("img[usemap=#" + a + "]")[0]) && n(s))) : (/input|select|textarea|button|object/.test(o) ? !e.disabled : "a" === o ? e.href || i : i) && n(e)
        }
        function n(e) {
            return t.expr.filters.visible(e) && !t(e).parents().addBack().filter(function() {
                return "hidden" === t.css(this, "visibility")
            }).length
        }
        var r = 0
          , a = /^ui-id-\d+$/;
        t.ui = t.ui || {},
        t.extend(t.ui, {
            version: "1.10.3",
            keyCode: {
                BACKSPACE: 8,
                COMMA: 188,
                DELETE: 46,
                DOWN: 40,
                END: 35,
                ENTER: 13,
                ESCAPE: 27,
                HOME: 36,
                LEFT: 37,
                NUMPAD_ADD: 107,
                NUMPAD_DECIMAL: 110,
                NUMPAD_DIVIDE: 111,
                NUMPAD_ENTER: 108,
                NUMPAD_MULTIPLY: 106,
                NUMPAD_SUBTRACT: 109,
                PAGE_DOWN: 34,
                PAGE_UP: 33,
                PERIOD: 190,
                RIGHT: 39,
                SPACE: 32,
                TAB: 9,
                UP: 38
            }
        }),
        t.fn.extend({
            focus: function(e) {
                return function(i, n) {
                    return "number" == typeof i ? this.each(function() {
                        var e = this;
                        setTimeout(function() {
                            t(e).focus(),
                            n && n.call(e)
                        }, i)
                    }) : e.apply(this, arguments)
                }
            }(t.fn.focus),
            scrollParent: function() {
                var e;
                return e = t.ui.ie && /(static|relative)/.test(this.css("position")) || /absolute/.test(this.css("position")) ? this.parents().filter(function() {
                    return /(relative|absolute|fixed)/.test(t.css(this, "position")) && /(auto|scroll)/.test(t.css(this, "overflow") + t.css(this, "overflow-y") + t.css(this, "overflow-x"))
                }).eq(0) : this.parents().filter(function() {
                    return /(auto|scroll)/.test(t.css(this, "overflow") + t.css(this, "overflow-y") + t.css(this, "overflow-x"))
                }).eq(0),
                /fixed/.test(this.css("position")) || !e.length ? t(document) : e
            },
            zIndex: function(e) {
                if (void 0 !== e)
                    return this.css("zIndex", e);
                if (this.length)
                    for (var i, n, r = t(this[0]); r.length && r[0] !== document; ) {
                        if (("absolute" === (i = r.css("position")) || "relative" === i || "fixed" === i) && (n = parseInt(r.css("zIndex"), 10),
                        !isNaN(n) && 0 !== n))
                            return n;
                        r = r.parent()
                    }
                return 0
            },
            uniqueId: function() {
                return this.each(function() {
                    this.id || (this.id = "ui-id-" + ++r)
                })
            },
            removeUniqueId: function() {
                return this.each(function() {
                    a.test(this.id) && t(this).removeAttr("id")
                })
            }
        }),
        t.extend(t.expr[":"], {
            data: t.expr.createPseudo ? t.expr.createPseudo(function(e) {
                return function(i) {
                    return !!t.data(i, e)
                }
            }) : function(e, i, n) {
                return !!t.data(e, n[3])
            }
            ,
            focusable: function(e) {
                return i(e, !isNaN(t.attr(e, "tabindex")))
            },
            tabbable: function(e) {
                var n = t.attr(e, "tabindex")
                  , r = isNaN(n);
                return (r || n >= 0) && i(e, !r)
            }
        }),
        t("<a>").outerWidth(1).jquery || t.each(["Width", "Height"], function(e, i) {
            function n(e, i, n, a) {
                return t.each(r, function() {
                    i -= parseFloat(t.css(e, "padding" + this)) || 0,
                    n && (i -= parseFloat(t.css(e, "border" + this + "Width")) || 0),
                    a && (i -= parseFloat(t.css(e, "margin" + this)) || 0)
                }),
                i
            }
            var r = "Width" === i ? ["Left", "Right"] : ["Top", "Bottom"]
              , a = i.toLowerCase()
              , s = {
                innerWidth: t.fn.innerWidth,
                innerHeight: t.fn.innerHeight,
                outerWidth: t.fn.outerWidth,
                outerHeight: t.fn.outerHeight
            };
            t.fn["inner" + i] = function(e) {
                /*! jQuery UI - v1.10.3 - 2013-05-03
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.effect.js, jquery.ui.accordion.js, jquery.ui.autocomplete.js, jquery.ui.button.js, jquery.ui.datepicker.js, jquery.ui.dialog.js, jquery.ui.effect-blind.js, jquery.ui.effect-bounce.js, jquery.ui.effect-clip.js, jquery.ui.effect-drop.js, jquery.ui.effect-explode.js, jquery.ui.effect-fade.js, jquery.ui.effect-fold.js, jquery.ui.effect-highlight.js, jquery.ui.effect-pulsate.js, jquery.ui.effect-scale.js, jquery.ui.effect-shake.js, jquery.ui.effect-slide.js, jquery.ui.effect-transfer.js, jquery.ui.menu.js, jquery.ui.position.js, jquery.ui.progressbar.js, jquery.ui.slider.js, jquery.ui.spinner.js, jquery.ui.tabs.js, jquery.ui.tooltip.js
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
                return void 0 === e ? s["inner" + i].call(this) : this.each(function() {
                    t(this).css(a, n(this, e) + "px")
                })
            }
            ,
            t.fn["outer" + i] = function(e, r) {
                return "number" != typeof e ? s["outer" + i].call(this, e) : this.each(function() {
                    t(this).css(a, n(this, e, !0, r) + "px")
                })
            }
        }),
        t.fn.addBack || (t.fn.addBack = function(t) {
            return this.add(null == t ? this.prevObject : this.prevObject.filter(t))
        }
        ),
        t("<a>").data("a-b", "a").removeData("a-b").data("a-b") && (t.fn.removeData = function(e) {
            return function(i) {
                return arguments.length ? e.call(this, t.camelCase(i)) : e.call(this)
            }
        }(t.fn.removeData)),
        t.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),
        t.support.selectstart = "onselectstart"in document.createElement("div"),
        t.fn.extend({
            disableSelection: function() {
                return this.bind((t.support.selectstart ? "selectstart" : "mousedown") + ".ui-disableSelection", function(t) {
                    t.preventDefault()
                })
            },
            enableSelection: function() {
                return this.unbind(".ui-disableSelection")
            }
        }),
        t.extend(t.ui, {
            plugin: {
                add: function(e, i, n) {
                    var r, a = t.ui[e].prototype;
                    for (r in n)
                        a.plugins[r] = a.plugins[r] || [],
                        a.plugins[r].push([i, n[r]])
                },
                call: function(t, e, i) {
                    var n, r = t.plugins[e];
                    if (r && t.element[0].parentNode && 11 !== t.element[0].parentNode.nodeType)
                        for (n = 0; n < r.length; n++)
                            t.options[r[n][0]] && r[n][1].apply(t.element, i)
                }
            },
            hasScroll: function(e, i) {
                if ("hidden" === t(e).css("overflow"))
                    return !1;
                var n = i && "left" === i ? "scrollLeft" : "scrollTop"
                  , r = !1;
                return e[n] > 0 || (e[n] = 1,
                r = e[n] > 0,
                e[n] = 0,
                r)
            }
        })
    }(n),
    function(t, e) {
        var i = 0
          , n = Array.prototype.slice
          , r = t.cleanData;
        t.cleanData = function(e) {
            for (var i, n = 0; null != (i = e[n]); n++)
                try {
                    t(i).triggerHandler("remove")
                } catch (t) {}
            r(e)
        }
        ,
        t.widget = function(e, i, n) {
            var r, a, s, o, l = {}, u = e.split(".")[0];
            e = e.split(".")[1],
            r = u + "-" + e,
            n || (n = i,
            i = t.Widget),
            t.expr[":"][r.toLowerCase()] = function(e) {
                return !!t.data(e, r)
            }
            ,
            t[u] = t[u] || {},
            a = t[u][e],
            s = t[u][e] = function(t, e) {
                if (!this._createWidget)
                    return new s(t,e);
                arguments.length && this._createWidget(t, e)
            }
            ,
            t.extend(s, a, {
                version: n.version,
                _proto: t.extend({}, n),
                _childConstructors: []
            }),
            o = new i,
            o.options = t.widget.extend({}, o.options),
            t.each(n, function(e, n) {
                if (!t.isFunction(n))
                    return void (l[e] = n);
                l[e] = function() {
                    var t = function() {
                        return i.prototype[e].apply(this, arguments)
                    }
                      , r = function(t) {
                        return i.prototype[e].apply(this, t)
                    };
                    return function() {
                        var e, i = this._super, a = this._superApply;
                        return this._super = t,
                        this._superApply = r,
                        e = n.apply(this, arguments),
                        this._super = i,
                        this._superApply = a,
                        e
                    }
                }()
            }),
            s.prototype = t.widget.extend(o, {
                widgetEventPrefix: a ? o.widgetEventPrefix : e
            }, l, {
                constructor: s,
                namespace: u,
                widgetName: e,
                widgetFullName: r
            }),
            a ? (t.each(a._childConstructors, function(e, i) {
                var n = i.prototype;
                t.widget(n.namespace + "." + n.widgetName, s, i._proto)
            }),
            delete a._childConstructors) : i._childConstructors.push(s),
            t.widget.bridge(e, s)
        }
        ,
        t.widget.extend = function(e) {
            for (var i, r, a = n.call(arguments, 1), s = 0, o = a.length; s < o; s++)
                for (i in a[s])
                    r = a[s][i],
                    a[s].hasOwnProperty(i) && void 0 !== r && (t.isPlainObject(r) ? e[i] = t.isPlainObject(e[i]) ? t.widget.extend({}, e[i], r) : t.widget.extend({}, r) : e[i] = r);
            return e
        }
        ,
        t.widget.bridge = function(e, i) {
            var r = i.prototype.widgetFullName || e;
            t.fn[e] = function(a) {
                var s = "string" == typeof a
                  , o = n.call(arguments, 1)
                  , l = this;
                return a = !s && o.length ? t.widget.extend.apply(null, [a].concat(o)) : a,
                s ? this.each(function() {
                    var i, n = t.data(this, r);
                    return n ? t.isFunction(n[a]) && "_" !== a.charAt(0) ? (i = n[a].apply(n, o),
                    i !== n && void 0 !== i ? (l = i && i.jquery ? l.pushStack(i.get()) : i,
                    !1) : void 0) : t.error("no such method '" + a + "' for " + e + " widget instance") : t.error("cannot call methods on " + e + " prior to initialization; attempted to call method '" + a + "'")
                }) : this.each(function() {
                    var e = t.data(this, r);
                    e ? e.option(a || {})._init() : t.data(this, r, new i(a,this))
                }),
                l
            }
        }
        ,
        t.Widget = function() {}
        ,
        t.Widget._childConstructors = [],
        t.Widget.prototype = {
            widgetName: "widget",
            widgetEventPrefix: "",
            defaultElement: "<div>",
            options: {
                disabled: !1,
                create: null
            },
            _createWidget: function(e, n) {
                n = t(n || this.defaultElement || this)[0],
                this.element = t(n),
                this.uuid = i++,
                this.eventNamespace = "." + this.widgetName + this.uuid,
                this.options = t.widget.extend({}, this.options, this._getCreateOptions(), e),
                this.bindings = t(),
                this.hoverable = t(),
                this.focusable = t(),
                n !== this && (t.data(n, this.widgetFullName, this),
                this._on(!0, this.element, {
                    remove: function(t) {
                        t.target === n && this.destroy()
                    }
                }),
                this.document = t(n.style ? n.ownerDocument : n.document || n),
                this.window = t(this.document[0].defaultView || this.document[0].parentWindow)),
                this._create(),
                this._trigger("create", null, this._getCreateEventData()),
                this._init()
            },
            _getCreateOptions: t.noop,
            _getCreateEventData: t.noop,
            _create: t.noop,
            _init: t.noop,
            destroy: function() {
                this._destroy(),
                this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),
                this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled ui-state-disabled"),
                this.bindings.unbind(this.eventNamespace),
                this.hoverable.removeClass("ui-state-hover"),
                this.focusable.removeClass("ui-state-focus")
            },
            _destroy: t.noop,
            widget: function() {
                return this.element
            },
            option: function(e, i) {
                var n, r, a, s = e;
                if (0 === arguments.length)
                    return t.widget.extend({}, this.options);
                if ("string" == typeof e)
                    if (s = {},
                    n = e.split("."),
                    e = n.shift(),
                    n.length) {
                        for (r = s[e] = t.widget.extend({}, this.options[e]),
                        a = 0; a < n.length - 1; a++)
                            r[n[a]] = r[n[a]] || {},
                            r = r[n[a]];
                        if (e = n.pop(),
                        void 0 === i)
                            return void 0 === r[e] ? null : r[e];
                        r[e] = i
                    } else {
                        if (void 0 === i)
                            return void 0 === this.options[e] ? null : this.options[e];
                        s[e] = i
                    }
                return this._setOptions(s),
                this
            },
            _setOptions: function(t) {
                var e;
                for (e in t)
                    this._setOption(e, t[e]);
                return this
            },
            _setOption: function(t, e) {
                return this.options[t] = e,
                "disabled" === t && (this.widget().toggleClass(this.widgetFullName + "-disabled ui-state-disabled", !!e).attr("aria-disabled", e),
                this.hoverable.removeClass("ui-state-hover"),
                this.focusable.removeClass("ui-state-focus")),
                this
            },
            enable: function() {
                return this._setOption("disabled", !1)
            },
            disable: function() {
                return this._setOption("disabled", !0)
            },
            _on: function(e, i, n) {
                var r, a = this;
                "boolean" != typeof e && (n = i,
                i = e,
                e = !1),
                n ? (i = r = t(i),
                this.bindings = this.bindings.add(i)) : (n = i,
                i = this.element,
                r = this.widget()),
                t.each(n, function(n, s) {
                    function o() {
                        if (e || !0 !== a.options.disabled && !t(this).hasClass("ui-state-disabled"))
                            return ("string" == typeof s ? a[s] : s).apply(a, arguments)
                    }
                    "string" != typeof s && (o.guid = s.guid = s.guid || o.guid || t.guid++);
                    var l = n.match(/^(\w+)\s*(.*)$/)
                      , u = l[1] + a.eventNamespace
                      , h = l[2];
                    h ? r.delegate(h, u, o) : i.bind(u, o)
                })
            },
            _off: function(t, e) {
                e = (e || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace,
                t.unbind(e).undelegate(e)
            },
            _delay: function(t, e) {
                function i() {
                    return ("string" == typeof t ? n[t] : t).apply(n, arguments)
                }
                var n = this;
                return setTimeout(i, e || 0)
            },
            _hoverable: function(e) {
                this.hoverable = this.hoverable.add(e),
                this._on(e, {
                    mouseenter: function(e) {
                        t(e.currentTarget).addClass("ui-state-hover")
                    },
                    mouseleave: function(e) {
                        t(e.currentTarget).removeClass("ui-state-hover")
                    }
                })
            },
            _focusable: function(e) {
                this.focusable = this.focusable.add(e),
                this._on(e, {
                    focusin: function(e) {
                        t(e.currentTarget).addClass("ui-state-focus")
                    },
                    focusout: function(e) {
                        t(e.currentTarget).removeClass("ui-state-focus")
                    }
                })
            },
            _trigger: function(e, i, n) {
                var r, a, s = this.options[e];
                if (n = n || {},
                i = t.Event(i),
                i.type = (e === this.widgetEventPrefix ? e : this.widgetEventPrefix + e).toLowerCase(),
                i.target = this.element[0],
                a = i.originalEvent)
                    for (r in a)
                        r in i || (i[r] = a[r]);
                return this.element.trigger(i, n),
                !(t.isFunction(s) && !1 === s.apply(this.element[0], [i].concat(n)) || i.isDefaultPrevented())
            }
        },
        t.each({
            show: "fadeIn",
            hide: "fadeOut"
        }, function(e, i) {
            t.Widget.prototype["_" + e] = function(n, r, a) {
                "string" == typeof r && (r = {
                    effect: r
                });
                var s, o = r ? !0 === r || "number" == typeof r ? i : r.effect || i : e;
                r = r || {},
                "number" == typeof r && (r = {
                    duration: r
                }),
                s = !t.isEmptyObject(r),
                r.complete = a,
                r.delay && n.delay(r.delay),
                s && t.effects && t.effects.effect[o] ? n[e](r) : o !== e && n[o] ? n[o](r.duration, r.easing, a) : n.queue(function(i) {
                    t(this)[e](),
                    a && a.call(n[0]),
                    i()
                })
            }
        })
    }(n),
    function(t, e) {
        var i = !1;
        t(document).mouseup(function() {
            i = !1
        }),
        t.widget("ui.mouse", {
            version: "1.10.3",
            options: {
                cancel: "input,textarea,button,select,option",
                distance: 1,
                delay: 0
            },
            _mouseInit: function() {
                var e = this;
                this.element.bind("mousedown." + this.widgetName, function(t) {
                    return e._mouseDown(t)
                }).bind("click." + this.widgetName, function(i) {
                    if (!0 === t.data(i.target, e.widgetName + ".preventClickEvent"))
                        return t.removeData(i.target, e.widgetName + ".preventClickEvent"),
                        i.stopImmediatePropagation(),
                        !1
                }),
                this.started = !1
            },
            _mouseDestroy: function() {
                this.element.unbind("." + this.widgetName),
                this._mouseMoveDelegate && t(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate)
            },
            _mouseDown: function(e) {
                if (!i) {
                    this._mouseStarted && this._mouseUp(e),
                    this._mouseDownEvent = e;
                    var n = this
                      , r = 1 === e.which
                      , a = !("string" != typeof this.options.cancel || !e.target.nodeName) && t(e.target).closest(this.options.cancel).length;
                    return !(r && !a && this._mouseCapture(e)) || (this.mouseDelayMet = !this.options.delay,
                    this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function() {
                        n.mouseDelayMet = !0
                    }, this.options.delay)),
                    this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = !1 !== this._mouseStart(e),
                    !this._mouseStarted) ? (e.preventDefault(),
                    !0) : (!0 === t.data(e.target, this.widgetName + ".preventClickEvent") && t.removeData(e.target, this.widgetName + ".preventClickEvent"),
                    this._mouseMoveDelegate = function(t) {
                        return n._mouseMove(t)
                    }
                    ,
                    this._mouseUpDelegate = function(t) {
                        return n._mouseUp(t)
                    }
                    ,
                    t(document).bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate),
                    e.preventDefault(),
                    i = !0,
                    !0))
                }
            },
            _mouseMove: function(e) {
                return t.ui.ie && (!document.documentMode || document.documentMode < 9) && !e.button ? this._mouseUp(e) : this._mouseStarted ? (this._mouseDrag(e),
                e.preventDefault()) : (this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = !1 !== this._mouseStart(this._mouseDownEvent, e),
                this._mouseStarted ? this._mouseDrag(e) : this._mouseUp(e)),
                !this._mouseStarted)
            },
            _mouseUp: function(e) {
                return t(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate),
                this._mouseStarted && (this._mouseStarted = !1,
                e.target === this._mouseDownEvent.target && t.data(e.target, this.widgetName + ".preventClickEvent", !0),
                this._mouseStop(e)),
                !1
            },
            _mouseDistanceMet: function(t) {
                return Math.max(Math.abs(this._mouseDownEvent.pageX - t.pageX), Math.abs(this._mouseDownEvent.pageY - t.pageY)) >= this.options.distance
            },
            _mouseDelayMet: function() {
                return this.mouseDelayMet
            },
            _mouseStart: function() {},
            _mouseDrag: function() {},
            _mouseStop: function() {},
            _mouseCapture: function() {
                return !0
            }
        })
    }(n),
    function(t, e) {
        t.widget("ui.draggable", t.ui.mouse, {
            version: "1.10.3",
            widgetEventPrefix: "drag",
            options: {
                addClasses: !0,
                appendTo: "parent",
                axis: !1,
                connectToSortable: !1,
                containment: !1,
                cursor: "auto",
                cursorAt: !1,
                grid: !1,
                handle: !1,
                helper: "original",
                iframeFix: !1,
                opacity: !1,
                refreshPositions: !1,
                revert: !1,
                revertDuration: 500,
                scope: "default",
                scroll: !0,
                scrollSensitivity: 20,
                scrollSpeed: 20,
                snap: !1,
                snapMode: "both",
                snapTolerance: 20,
                stack: !1,
                zIndex: !1,
                drag: null,
                start: null,
                stop: null
            },
            _create: function() {
                "original" !== this.options.helper || /^(?:r|a|f)/.test(this.element.css("position")) || (this.element[0].style.position = "relative"),
                this.options.addClasses && this.element.addClass("ui-draggable"),
                this.options.disabled && this.element.addClass("ui-draggable-disabled"),
                this._mouseInit()
            },
            _destroy: function() {
                this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),
                this._mouseDestroy()
            },
            _mouseCapture: function(e) {
                var i = this.options;
                return !(this.helper || i.disabled || t(e.target).closest(".ui-resizable-handle").length > 0) && (this.handle = this._getHandle(e),
                !!this.handle && (t(!0 === i.iframeFix ? "iframe" : i.iframeFix).each(function() {
                    t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({
                        width: this.offsetWidth + "px",
                        height: this.offsetHeight + "px",
                        position: "absolute",
                        opacity: "0.001",
                        zIndex: 1e3
                    }).css(t(this).offset()).appendTo("body")
                }),
                !0))
            },
            _mouseStart: function(e) {
                var i = this.options;
                return this.helper = this._createHelper(e),
                this.helper.addClass("ui-draggable-dragging"),
                this._cacheHelperProportions(),
                t.ui.ddmanager && (t.ui.ddmanager.current = this),
                this._cacheMargins(),
                this.cssPosition = this.helper.css("position"),
                this.scrollParent = this.helper.scrollParent(),
                this.offsetParent = this.helper.offsetParent(),
                this.offsetParentCssPosition = this.offsetParent.css("position"),
                this.offset = this.positionAbs = this.element.offset(),
                this.offset = {
                    top: this.offset.top - this.margins.top,
                    left: this.offset.left - this.margins.left
                },
                this.offset.scroll = !1,
                t.extend(this.offset, {
                    click: {
                        left: e.pageX - this.offset.left,
                        top: e.pageY - this.offset.top
                    },
                    parent: this._getParentOffset(),
                    relative: this._getRelativeOffset()
                }),
                this.originalPosition = this.position = this._generatePosition(e),
                this.originalPageX = e.pageX,
                this.originalPageY = e.pageY,
                i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt),
                this._setContainment(),
                !1 === this._trigger("start", e) ? (this._clear(),
                !1) : (this._cacheHelperProportions(),
                t.ui.ddmanager && !i.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e),
                this._mouseDrag(e, !0),
                t.ui.ddmanager && t.ui.ddmanager.dragStart(this, e),
                !0)
            },
            _mouseDrag: function(e, i) {
                if ("fixed" === this.offsetParentCssPosition && (this.offset.parent = this._getParentOffset()),
                this.position = this._generatePosition(e),
                this.positionAbs = this._convertPositionTo("absolute"),
                !i) {
                    var n = this._uiHash();
                    if (!1 === this._trigger("drag", e, n))
                        return this._mouseUp({}),
                        !1;
                    this.position = n.position
                }
                return this.options.axis && "y" === this.options.axis || (this.helper[0].style.left = this.position.left + "px"),
                this.options.axis && "x" === this.options.axis || (this.helper[0].style.top = this.position.top + "px"),
                t.ui.ddmanager && t.ui.ddmanager.drag(this, e),
                !1
            },
            _mouseStop: function(e) {
                var i = this
                  , n = !1;
                return t.ui.ddmanager && !this.options.dropBehaviour && (n = t.ui.ddmanager.drop(this, e)),
                this.dropped && (n = this.dropped,
                this.dropped = !1),
                !("original" === this.options.helper && !t.contains(this.element[0].ownerDocument, this.element[0])) && ("invalid" === this.options.revert && !n || "valid" === this.options.revert && n || !0 === this.options.revert || t.isFunction(this.options.revert) && this.options.revert.call(this.element, n) ? t(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function() {
                    !1 !== i._trigger("stop", e) && i._clear()
                }) : !1 !== this._trigger("stop", e) && this._clear(),
                !1)
            },
            _mouseUp: function(e) {
                return t("div.ui-draggable-iframeFix").each(function() {
                    this.parentNode.removeChild(this)
                }),
                t.ui.ddmanager && t.ui.ddmanager.dragStop(this, e),
                t.ui.mouse.prototype._mouseUp.call(this, e)
            },
            cancel: function() {
                return this.helper.is(".ui-draggable-dragging") ? this._mouseUp({}) : this._clear(),
                this
            },
            _getHandle: function(e) {
                return !this.options.handle || !!t(e.target).closest(this.element.find(this.options.handle)).length
            },
            _createHelper: function(e) {
                var i = this.options
                  , n = t.isFunction(i.helper) ? t(i.helper.apply(this.element[0], [e])) : "clone" === i.helper ? this.element.clone().removeAttr("id") : this.element;
                return n.parents("body").length || n.appendTo("parent" === i.appendTo ? this.element[0].parentNode : i.appendTo),
                n[0] === this.element[0] || /(fixed|absolute)/.test(n.css("position")) || n.css("position", "absolute"),
                n
            },
            _adjustOffsetFromHelper: function(e) {
                "string" == typeof e && (e = e.split(" ")),
                t.isArray(e) && (e = {
                    left: +e[0],
                    top: +e[1] || 0
                }),
                "left"in e && (this.offset.click.left = e.left + this.margins.left),
                "right"in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left),
                "top"in e && (this.offset.click.top = e.top + this.margins.top),
                "bottom"in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top)
            },
            _getParentOffset: function() {
                var e = this.offsetParent.offset();
                return "absolute" === this.cssPosition && this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(),
                e.top += this.scrollParent.scrollTop()),
                (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && "html" === this.offsetParent[0].tagName.toLowerCase() && t.ui.ie) && (e = {
                    top: 0,
                    left: 0
                }),
                {
                    top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                    left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
                }
            },
            _getRelativeOffset: function() {
                if ("relative" === this.cssPosition) {
                    var t = this.element.position();
                    return {
                        top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                        left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
                    }
                }
                return {
                    top: 0,
                    left: 0
                }
            },
            _cacheMargins: function() {
                this.margins = {
                    left: parseInt(this.element.css("marginLeft"), 10) || 0,
                    top: parseInt(this.element.css("marginTop"), 10) || 0,
                    right: parseInt(this.element.css("marginRight"), 10) || 0,
                    bottom: parseInt(this.element.css("marginBottom"), 10) || 0
                }
            },
            _cacheHelperProportions: function() {
                this.helperProportions = {
                    width: this.helper.outerWidth(),
                    height: this.helper.outerHeight()
                }
            },
            _setContainment: function() {
                var e, i, n, r = this.options;
                return r.containment ? "window" === r.containment ? void (this.containment = [t(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, t(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, t(window).scrollLeft() + t(window).width() - this.helperProportions.width - this.margins.left, t(window).scrollTop() + (t(window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]) : "document" === r.containment ? void (this.containment = [0, 0, t(document).width() - this.helperProportions.width - this.margins.left, (t(document).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]) : r.containment.constructor === Array ? void (this.containment = r.containment) : ("parent" === r.containment && (r.containment = this.helper[0].parentNode),
                i = t(r.containment),
                void ((n = i[0]) && (e = "hidden" !== i.css("overflow"),
                this.containment = [(parseInt(i.css("borderLeftWidth"), 10) || 0) + (parseInt(i.css("paddingLeft"), 10) || 0), (parseInt(i.css("borderTopWidth"), 10) || 0) + (parseInt(i.css("paddingTop"), 10) || 0), (e ? Math.max(n.scrollWidth, n.offsetWidth) : n.offsetWidth) - (parseInt(i.css("borderRightWidth"), 10) || 0) - (parseInt(i.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (e ? Math.max(n.scrollHeight, n.offsetHeight) : n.offsetHeight) - (parseInt(i.css("borderBottomWidth"), 10) || 0) - (parseInt(i.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom],
                this.relative_container = i))) : void (this.containment = null)
            },
            _convertPositionTo: function(e, i) {
                i || (i = this.position);
                var n = "absolute" === e ? 1 : -1
                  , r = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent;
                return this.offset.scroll || (this.offset.scroll = {
                    top: r.scrollTop(),
                    left: r.scrollLeft()
                }),
                {
                    top: i.top + this.offset.relative.top * n + this.offset.parent.top * n - ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : this.offset.scroll.top) * n,
                    left: i.left + this.offset.relative.left * n + this.offset.parent.left * n - ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : this.offset.scroll.left) * n
                }
            },
            _generatePosition: function(e) {
                var i, n, r, a, s = this.options, o = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent, l = e.pageX, u = e.pageY;
                return this.offset.scroll || (this.offset.scroll = {
                    top: o.scrollTop(),
                    left: o.scrollLeft()
                }),
                this.originalPosition && (this.containment && (this.relative_container ? (n = this.relative_container.offset(),
                i = [this.containment[0] + n.left, this.containment[1] + n.top, this.containment[2] + n.left, this.containment[3] + n.top]) : i = this.containment,
                e.pageX - this.offset.click.left < i[0] && (l = i[0] + this.offset.click.left),
                e.pageY - this.offset.click.top < i[1] && (u = i[1] + this.offset.click.top),
                e.pageX - this.offset.click.left > i[2] && (l = i[2] + this.offset.click.left),
                e.pageY - this.offset.click.top > i[3] && (u = i[3] + this.offset.click.top)),
                s.grid && (r = s.grid[1] ? this.originalPageY + Math.round((u - this.originalPageY) / s.grid[1]) * s.grid[1] : this.originalPageY,
                u = i ? r - this.offset.click.top >= i[1] || r - this.offset.click.top > i[3] ? r : r - this.offset.click.top >= i[1] ? r - s.grid[1] : r + s.grid[1] : r,
                a = s.grid[0] ? this.originalPageX + Math.round((l - this.originalPageX) / s.grid[0]) * s.grid[0] : this.originalPageX,
                l = i ? a - this.offset.click.left >= i[0] || a - this.offset.click.left > i[2] ? a : a - this.offset.click.left >= i[0] ? a - s.grid[0] : a + s.grid[0] : a)),
                {
                    top: u - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : this.offset.scroll.top),
                    left: l - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : this.offset.scroll.left)
                }
            },
            _clear: function() {
                this.helper.removeClass("ui-draggable-dragging"),
                this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(),
                this.helper = null,
                this.cancelHelperRemoval = !1
            },
            _trigger: function(e, i, n) {
                return n = n || this._uiHash(),
                t.ui.plugin.call(this, e, [i, n]),
                "drag" === e && (this.positionAbs = this._convertPositionTo("absolute")),
                t.Widget.prototype._trigger.call(this, e, i, n)
            },
            plugins: {},
            _uiHash: function() {
                return {
                    helper: this.helper,
                    position: this.position,
                    originalPosition: this.originalPosition,
                    offset: this.positionAbs
                }
            }
        }),
        t.ui.plugin.add("draggable", "connectToSortable", {
            start: function(e, i) {
                var n = t(this).data("ui-draggable")
                  , r = n.options
                  , a = t.extend({}, i, {
                    item: n.element
                });
                n.sortables = [],
                t(r.connectToSortable).each(function() {
                    var i = t.data(this, "ui-sortable");
                    i && !i.options.disabled && (n.sortables.push({
                        instance: i,
                        shouldRevert: i.options.revert
                    }),
                    i.refreshPositions(),
                    i._trigger("activate", e, a))
                })
            },
            stop: function(e, i) {
                var n = t(this).data("ui-draggable")
                  , r = t.extend({}, i, {
                    item: n.element
                });
                t.each(n.sortables, function() {
                    this.instance.isOver ? (this.instance.isOver = 0,
                    n.cancelHelperRemoval = !0,
                    this.instance.cancelHelperRemoval = !1,
                    this.shouldRevert && (this.instance.options.revert = this.shouldRevert),
                    this.instance._mouseStop(e),
                    this.instance.options.helper = this.instance.options._helper,
                    "original" === n.options.helper && this.instance.currentItem.css({
                        top: "auto",
                        left: "auto"
                    })) : (this.instance.cancelHelperRemoval = !1,
                    this.instance._trigger("deactivate", e, r))
                })
            },
            drag: function(e, i) {
                var n = t(this).data("ui-draggable")
                  , r = this;
                t.each(n.sortables, function() {
                    var a = !1
                      , s = this;
                    this.instance.positionAbs = n.positionAbs,
                    this.instance.helperProportions = n.helperProportions,
                    this.instance.offset.click = n.offset.click,
                    this.instance._intersectsWith(this.instance.containerCache) && (a = !0,
                    t.each(n.sortables, function() {
                        return this.instance.positionAbs = n.positionAbs,
                        this.instance.helperProportions = n.helperProportions,
                        this.instance.offset.click = n.offset.click,
                        this !== s && this.instance._intersectsWith(this.instance.containerCache) && t.contains(s.instance.element[0], this.instance.element[0]) && (a = !1),
                        a
                    })),
                    a ? (this.instance.isOver || (this.instance.isOver = 1,
                    this.instance.currentItem = t(r).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item", !0),
                    this.instance.options._helper = this.instance.options.helper,
                    this.instance.options.helper = function() {
                        return i.helper[0]
                    }
                    ,
                    e.target = this.instance.currentItem[0],
                    this.instance._mouseCapture(e, !0),
                    this.instance._mouseStart(e, !0, !0),
                    this.instance.offset.click.top = n.offset.click.top,
                    this.instance.offset.click.left = n.offset.click.left,
                    this.instance.offset.parent.left -= n.offset.parent.left - this.instance.offset.parent.left,
                    this.instance.offset.parent.top -= n.offset.parent.top - this.instance.offset.parent.top,
                    n._trigger("toSortable", e),
                    n.dropped = this.instance.element,
                    n.currentItem = n.element,
                    this.instance.fromOutside = n),
                    this.instance.currentItem && this.instance._mouseDrag(e)) : this.instance.isOver && (this.instance.isOver = 0,
                    this.instance.cancelHelperRemoval = !0,
                    this.instance.options.revert = !1,
                    this.instance._trigger("out", e, this.instance._uiHash(this.instance)),
                    this.instance._mouseStop(e, !0),
                    this.instance.options.helper = this.instance.options._helper,
                    this.instance.currentItem.remove(),
                    this.instance.placeholder && this.instance.placeholder.remove(),
                    n._trigger("fromSortable", e),
                    n.dropped = !1)
                })
            }
        }),
        t.ui.plugin.add("draggable", "cursor", {
            start: function() {
                var e = t("body")
                  , i = t(this).data("ui-draggable").options;
                e.css("cursor") && (i._cursor = e.css("cursor")),
                e.css("cursor", i.cursor)
            },
            stop: function() {
                var e = t(this).data("ui-draggable").options;
                e._cursor && t("body").css("cursor", e._cursor)
            }
        }),
        t.ui.plugin.add("draggable", "opacity", {
            start: function(e, i) {
                var n = t(i.helper)
                  , r = t(this).data("ui-draggable").options;
                n.css("opacity") && (r._opacity = n.css("opacity")),
                n.css("opacity", r.opacity)
            },
            stop: function(e, i) {
                var n = t(this).data("ui-draggable").options;
                n._opacity && t(i.helper).css("opacity", n._opacity)
            }
        }),
        t.ui.plugin.add("draggable", "scroll", {
            start: function() {
                var e = t(this).data("ui-draggable");
                e.scrollParent[0] !== document && "HTML" !== e.scrollParent[0].tagName && (e.overflowOffset = e.scrollParent.offset())
            },
            drag: function(e) {
                var i = t(this).data("ui-draggable")
                  , n = i.options
                  , r = !1;
                i.scrollParent[0] !== document && "HTML" !== i.scrollParent[0].tagName ? (n.axis && "x" === n.axis || (i.overflowOffset.top + i.scrollParent[0].offsetHeight - e.pageY < n.scrollSensitivity ? i.scrollParent[0].scrollTop = r = i.scrollParent[0].scrollTop + n.scrollSpeed : e.pageY - i.overflowOffset.top < n.scrollSensitivity && (i.scrollParent[0].scrollTop = r = i.scrollParent[0].scrollTop - n.scrollSpeed)),
                n.axis && "y" === n.axis || (i.overflowOffset.left + i.scrollParent[0].offsetWidth - e.pageX < n.scrollSensitivity ? i.scrollParent[0].scrollLeft = r = i.scrollParent[0].scrollLeft + n.scrollSpeed : e.pageX - i.overflowOffset.left < n.scrollSensitivity && (i.scrollParent[0].scrollLeft = r = i.scrollParent[0].scrollLeft - n.scrollSpeed))) : (n.axis && "x" === n.axis || (e.pageY - t(document).scrollTop() < n.scrollSensitivity ? r = t(document).scrollTop(t(document).scrollTop() - n.scrollSpeed) : t(window).height() - (e.pageY - t(document).scrollTop()) < n.scrollSensitivity && (r = t(document).scrollTop(t(document).scrollTop() + n.scrollSpeed))),
                n.axis && "y" === n.axis || (e.pageX - t(document).scrollLeft() < n.scrollSensitivity ? r = t(document).scrollLeft(t(document).scrollLeft() - n.scrollSpeed) : t(window).width() - (e.pageX - t(document).scrollLeft()) < n.scrollSensitivity && (r = t(document).scrollLeft(t(document).scrollLeft() + n.scrollSpeed)))),
                !1 !== r && t.ui.ddmanager && !n.dropBehaviour && t.ui.ddmanager.prepareOffsets(i, e)
            }
        }),
        t.ui.plugin.add("draggable", "snap", {
            start: function() {
                var e = t(this).data("ui-draggable")
                  , i = e.options;
                e.snapElements = [],
                t(i.snap.constructor !== String ? i.snap.items || ":data(ui-draggable)" : i.snap).each(function() {
                    var i = t(this)
                      , n = i.offset();
                    this !== e.element[0] && e.snapElements.push({
                        item: this,
                        width: i.outerWidth(),
                        height: i.outerHeight(),
                        top: n.top,
                        left: n.left
                    })
                })
            },
            drag: function(e, i) {
                var n, r, a, s, o, l, u, h, c, d, p = t(this).data("ui-draggable"), f = p.options, g = f.snapTolerance, m = i.offset.left, v = m + p.helperProportions.width, _ = i.offset.top, b = _ + p.helperProportions.height;
                for (c = p.snapElements.length - 1; c >= 0; c--)
                    o = p.snapElements[c].left,
                    l = o + p.snapElements[c].width,
                    u = p.snapElements[c].top,
                    h = u + p.snapElements[c].height,
                    v < o - g || m > l + g || b < u - g || _ > h + g || !t.contains(p.snapElements[c].item.ownerDocument, p.snapElements[c].item) ? (p.snapElements[c].snapping && p.options.snap.release && p.options.snap.release.call(p.element, e, t.extend(p._uiHash(), {
                        snapItem: p.snapElements[c].item
                    })),
                    p.snapElements[c].snapping = !1) : ("inner" !== f.snapMode && (n = Math.abs(u - b) <= g,
                    r = Math.abs(h - _) <= g,
                    a = Math.abs(o - v) <= g,
                    s = Math.abs(l - m) <= g,
                    n && (i.position.top = p._convertPositionTo("relative", {
                        top: u - p.helperProportions.height,
                        left: 0
                    }).top - p.margins.top),
                    r && (i.position.top = p._convertPositionTo("relative", {
                        top: h,
                        left: 0
                    }).top - p.margins.top),
                    a && (i.position.left = p._convertPositionTo("relative", {
                        top: 0,
                        left: o - p.helperProportions.width
                    }).left - p.margins.left),
                    s && (i.position.left = p._convertPositionTo("relative", {
                        top: 0,
                        left: l
                    }).left - p.margins.left)),
                    d = n || r || a || s,
                    "outer" !== f.snapMode && (n = Math.abs(u - _) <= g,
                    r = Math.abs(h - b) <= g,
                    a = Math.abs(o - m) <= g,
                    s = Math.abs(l - v) <= g,
                    n && (i.position.top = p._convertPositionTo("relative", {
                        top: u,
                        left: 0
                    }).top - p.margins.top),
                    r && (i.position.top = p._convertPositionTo("relative", {
                        top: h - p.helperProportions.height,
                        left: 0
                    }).top - p.margins.top),
                    a && (i.position.left = p._convertPositionTo("relative", {
                        top: 0,
                        left: o
                    }).left - p.margins.left),
                    s && (i.position.left = p._convertPositionTo("relative", {
                        top: 0,
                        left: l - p.helperProportions.width
                    }).left - p.margins.left)),
                    !p.snapElements[c].snapping && (n || r || a || s || d) && p.options.snap.snap && p.options.snap.snap.call(p.element, e, t.extend(p._uiHash(), {
                        snapItem: p.snapElements[c].item
                    })),
                    p.snapElements[c].snapping = n || r || a || s || d)
            }
        }),
        t.ui.plugin.add("draggable", "stack", {
            start: function() {
                var e, i = this.data("ui-draggable").options, n = t.makeArray(t(i.stack)).sort(function(e, i) {
                    return (parseInt(t(e).css("zIndex"), 10) || 0) - (parseInt(t(i).css("zIndex"), 10) || 0)
                });
                n.length && (e = parseInt(t(n[0]).css("zIndex"), 10) || 0,
                t(n).each(function(i) {
                    t(this).css("zIndex", e + i)
                }),
                this.css("zIndex", e + n.length))
            }
        }),
        t.ui.plugin.add("draggable", "zIndex", {
            start: function(e, i) {
                var n = t(i.helper)
                  , r = t(this).data("ui-draggable").options;
                n.css("zIndex") && (r._zIndex = n.css("zIndex")),
                n.css("zIndex", r.zIndex)
            },
            stop: function(e, i) {
                var n = t(this).data("ui-draggable").options;
                n._zIndex && t(i.helper).css("zIndex", n._zIndex)
            }
        })
    }(n),
    function(t, e) {
        function i(t, e, i) {
            return t > e && t < e + i
        }
        t.widget("ui.droppable", {
            version: "1.10.3",
            widgetEventPrefix: "drop",
            options: {
                accept: "*",
                activeClass: !1,
                addClasses: !0,
                greedy: !1,
                hoverClass: !1,
                scope: "default",
                tolerance: "intersect",
                activate: null,
                deactivate: null,
                drop: null,
                out: null,
                over: null
            },
            _create: function() {
                var e = this.options
                  , i = e.accept;
                this.isover = !1,
                this.isout = !0,
                this.accept = t.isFunction(i) ? i : function(t) {
                    return t.is(i)
                }
                ,
                this.proportions = {
                    width: this.element[0].offsetWidth,
                    height: this.element[0].offsetHeight
                },
                t.ui.ddmanager.droppables[e.scope] = t.ui.ddmanager.droppables[e.scope] || [],
                t.ui.ddmanager.droppables[e.scope].push(this),
                e.addClasses && this.element.addClass("ui-droppable")
            },
            _destroy: function() {
                for (var e = 0, i = t.ui.ddmanager.droppables[this.options.scope]; e < i.length; e++)
                    i[e] === this && i.splice(e, 1);
                this.element.removeClass("ui-droppable ui-droppable-disabled")
            },
            _setOption: function(e, i) {
                "accept" === e && (this.accept = t.isFunction(i) ? i : function(t) {
                    return t.is(i)
                }
                ),
                t.Widget.prototype._setOption.apply(this, arguments)
            },
            _activate: function(e) {
                var i = t.ui.ddmanager.current;
                this.options.activeClass && this.element.addClass(this.options.activeClass),
                i && this._trigger("activate", e, this.ui(i))
            },
            _deactivate: function(e) {
                var i = t.ui.ddmanager.current;
                this.options.activeClass && this.element.removeClass(this.options.activeClass),
                i && this._trigger("deactivate", e, this.ui(i))
            },
            _over: function(e) {
                var i = t.ui.ddmanager.current;
                i && (i.currentItem || i.element)[0] !== this.element[0] && this.accept.call(this.element[0], i.currentItem || i.element) && (this.options.hoverClass && this.element.addClass(this.options.hoverClass),
                this._trigger("over", e, this.ui(i)))
            },
            _out: function(e) {
                var i = t.ui.ddmanager.current;
                i && (i.currentItem || i.element)[0] !== this.element[0] && this.accept.call(this.element[0], i.currentItem || i.element) && (this.options.hoverClass && this.element.removeClass(this.options.hoverClass),
                this._trigger("out", e, this.ui(i)))
            },
            _drop: function(e, i) {
                var n = i || t.ui.ddmanager.current
                  , r = !1;
                return !(!n || (n.currentItem || n.element)[0] === this.element[0]) && (this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function() {
                    var e = t.data(this, "ui-droppable");
                    if (e.options.greedy && !e.options.disabled && e.options.scope === n.options.scope && e.accept.call(e.element[0], n.currentItem || n.element) && t.ui.intersect(n, t.extend(e, {
                        offset: e.element.offset()
                    }), e.options.tolerance))
                        return r = !0,
                        !1
                }),
                !r && (!!this.accept.call(this.element[0], n.currentItem || n.element) && (this.options.activeClass && this.element.removeClass(this.options.activeClass),
                this.options.hoverClass && this.element.removeClass(this.options.hoverClass),
                this._trigger("drop", e, this.ui(n)),
                this.element)))
            },
            ui: function(t) {
                return {
                    draggable: t.currentItem || t.element,
                    helper: t.helper,
                    position: t.position,
                    offset: t.positionAbs
                }
            }
        }),
        t.ui.intersect = function(t, e, n) {
            if (!e.offset)
                return !1;
            var r, a, s = (t.positionAbs || t.position.absolute).left, o = s + t.helperProportions.width, l = (t.positionAbs || t.position.absolute).top, u = l + t.helperProportions.height, h = e.offset.left, c = h + e.proportions.width, d = e.offset.top, p = d + e.proportions.height;
            switch (n) {
            case "fit":
                return h <= s && o <= c && d <= l && u <= p;
            case "intersect":
                return h < s + t.helperProportions.width / 2 && o - t.helperProportions.width / 2 < c && d < l + t.helperProportions.height / 2 && u - t.helperProportions.height / 2 < p;
            case "pointer":
                return r = (t.positionAbs || t.position.absolute).left + (t.clickOffset || t.offset.click).left,
                a = (t.positionAbs || t.position.absolute).top + (t.clickOffset || t.offset.click).top,
                i(a, d, e.proportions.height) && i(r, h, e.proportions.width);
            case "touch":
                return (l >= d && l <= p || u >= d && u <= p || l < d && u > p) && (s >= h && s <= c || o >= h && o <= c || s < h && o > c);
            default:
                return !1
            }
        }
        ,
        t.ui.ddmanager = {
            current: null,
            droppables: {
                default: []
            },
            prepareOffsets: function(e, i) {
                var n, r, a = t.ui.ddmanager.droppables[e.options.scope] || [], s = i ? i.type : null, o = (e.currentItem || e.element).find(":data(ui-droppable)").addBack();
                t: for (n = 0; n < a.length; n++)
                    if (!(a[n].options.disabled || e && !a[n].accept.call(a[n].element[0], e.currentItem || e.element))) {
                        for (r = 0; r < o.length; r++)
                            if (o[r] === a[n].element[0]) {
                                a[n].proportions.height = 0;
                                continue t
                            }
                        a[n].visible = "none" !== a[n].element.css("display"),
                        a[n].visible && ("mousedown" === s && a[n]._activate.call(a[n], i),
                        a[n].offset = a[n].element.offset(),
                        a[n].proportions = {
                            width: a[n].element[0].offsetWidth,
                            height: a[n].element[0].offsetHeight
                        })
                    }
            },
            drop: function(e, i) {
                var n = !1;
                return t.each((t.ui.ddmanager.droppables[e.options.scope] || []).slice(), function() {
                    this.options && (!this.options.disabled && this.visible && t.ui.intersect(e, this, this.options.tolerance) && (n = this._drop.call(this, i) || n),
                    !this.options.disabled && this.visible && this.accept.call(this.element[0], e.currentItem || e.element) && (this.isout = !0,
                    this.isover = !1,
                    this._deactivate.call(this, i)))
                }),
                n
            },
            dragStart: function(e, i) {
                e.element.parentsUntil("body").bind("scroll.droppable", function() {
                    e.options.refreshPositions || t.ui.ddmanager.prepareOffsets(e, i)
                })
            },
            drag: function(e, i) {
                e.options.refreshPositions && t.ui.ddmanager.prepareOffsets(e, i),
                t.each(t.ui.ddmanager.droppables[e.options.scope] || [], function() {
                    if (!this.options.disabled && !this.greedyChild && this.visible) {
                        var n, r, a, s = t.ui.intersect(e, this, this.options.tolerance), o = !s && this.isover ? "isout" : s && !this.isover ? "isover" : null;
                        o && (this.options.greedy && (r = this.options.scope,
                        a = this.element.parents(":data(ui-droppable)").filter(function() {
                            return t.data(this, "ui-droppable").options.scope === r
                        }),
                        a.length && (n = t.data(a[0], "ui-droppable"),
                        n.greedyChild = "isover" === o)),
                        n && "isover" === o && (n.isover = !1,
                        n.isout = !0,
                        n._out.call(n, i)),
                        this[o] = !0,
                        this["isout" === o ? "isover" : "isout"] = !1,
                        this["isover" === o ? "_over" : "_out"].call(this, i),
                        n && "isout" === o && (n.isout = !1,
                        n.isover = !0,
                        n._over.call(n, i)))
                    }
                })
            },
            dragStop: function(e, i) {
                e.element.parentsUntil("body").unbind("scroll.droppable"),
                e.options.refreshPositions || t.ui.ddmanager.prepareOffsets(e, i)
            }
        }
    }(n),
    function(t, e) {
        function i(t) {
            return parseInt(t, 10) || 0
        }
        function n(t) {
            return !isNaN(parseInt(t, 10))
        }
        t.widget("ui.resizable", t.ui.mouse, {
            version: "1.10.3",
            widgetEventPrefix: "resize",
            options: {
                alsoResize: !1,
                animate: !1,
                animateDuration: "slow",
                animateEasing: "swing",
                aspectRatio: !1,
                autoHide: !1,
                containment: !1,
                ghost: !1,
                grid: !1,
                handles: "e,s,se",
                helper: !1,
                maxHeight: null,
                maxWidth: null,
                minHeight: 10,
                minWidth: 10,
                zIndex: 90,
                resize: null,
                start: null,
                stop: null
            },
            _create: function() {
                var e, i, n, r, a, s = this, o = this.options;
                if (this.element.addClass("ui-resizable"),
                t.extend(this, {
                    _aspectRatio: !!o.aspectRatio,
                    aspectRatio: o.aspectRatio,
                    originalElement: this.element,
                    _proportionallyResizeElements: [],
                    _helper: o.helper || o.ghost || o.animate ? o.helper || "ui-resizable-helper" : null
                }),
                this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i) && (this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({
                    position: this.element.css("position"),
                    width: this.element.outerWidth(),
                    height: this.element.outerHeight(),
                    top: this.element.css("top"),
                    left: this.element.css("left")
                })),
                this.element = this.element.parent().data("ui-resizable", this.element.data("ui-resizable")),
                this.elementIsWrapper = !0,
                this.element.css({
                    marginLeft: this.originalElement.css("marginLeft"),
                    marginTop: this.originalElement.css("marginTop"),
                    marginRight: this.originalElement.css("marginRight"),
                    marginBottom: this.originalElement.css("marginBottom")
                }),
                this.originalElement.css({
                    marginLeft: 0,
                    marginTop: 0,
                    marginRight: 0,
                    marginBottom: 0
                }),
                this.originalResizeStyle = this.originalElement.css("resize"),
                this.originalElement.css("resize", "none"),
                this._proportionallyResizeElements.push(this.originalElement.css({
                    position: "static",
                    zoom: 1,
                    display: "block"
                })),
                this.originalElement.css({
                    margin: this.originalElement.css("margin")
                }),
                this._proportionallyResize()),
                this.handles = o.handles || (t(".ui-resizable-handle", this.element).length ? {
                    n: ".ui-resizable-n",
                    e: ".ui-resizable-e",
                    s: ".ui-resizable-s",
                    w: ".ui-resizable-w",
                    se: ".ui-resizable-se",
                    sw: ".ui-resizable-sw",
                    ne: ".ui-resizable-ne",
                    nw: ".ui-resizable-nw"
                } : "e,s,se"),
                this.handles.constructor === String)
                    for ("all" === this.handles && (this.handles = "n,e,s,w,se,sw,ne,nw"),
                    e = this.handles.split(","),
                    this.handles = {},
                    i = 0; i < e.length; i++)
                        n = t.trim(e[i]),
                        a = "ui-resizable-" + n,
                        r = t("<div class='ui-resizable-handle " + a + "'></div>"),
                        r.css({
                            zIndex: o.zIndex
                        }),
                        "se" === n && r.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),
                        this.handles[n] = ".ui-resizable-" + n,
                        this.element.append(r);
                this._renderAxis = function(e) {
                    var i, n, r, a;
                    e = e || this.element;
                    for (i in this.handles)
                        this.handles[i].constructor === String && (this.handles[i] = t(this.handles[i], this.element).show()),
                        this.elementIsWrapper && this.originalElement[0].nodeName.match(/textarea|input|select|button/i) && (n = t(this.handles[i], this.element),
                        a = /sw|ne|nw|se|n|s/.test(i) ? n.outerHeight() : n.outerWidth(),
                        r = ["padding", /ne|nw|n/.test(i) ? "Top" : /se|sw|s/.test(i) ? "Bottom" : /^e$/.test(i) ? "Right" : "Left"].join(""),
                        e.css(r, a),
                        this._proportionallyResize()),
                        t(this.handles[i]).length
                }
                ,
                this._renderAxis(this.element),
                this._handles = t(".ui-resizable-handle", this.element).disableSelection(),
                this._handles.mouseover(function() {
                    s.resizing || (this.className && (r = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),
                    s.axis = r && r[1] ? r[1] : "se")
                }),
                o.autoHide && (this._handles.hide(),
                t(this.element).addClass("ui-resizable-autohide").mouseenter(function() {
                    o.disabled || (t(this).removeClass("ui-resizable-autohide"),
                    s._handles.show())
                }).mouseleave(function() {
                    o.disabled || s.resizing || (t(this).addClass("ui-resizable-autohide"),
                    s._handles.hide())
                })),
                this._mouseInit()
            },
            _destroy: function() {
                this._mouseDestroy();
                var e, i = function(e) {
                    t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()
                };
                return this.elementIsWrapper && (i(this.element),
                e = this.element,
                this.originalElement.css({
                    position: e.css("position"),
                    width: e.outerWidth(),
                    height: e.outerHeight(),
                    top: e.css("top"),
                    left: e.css("left")
                }).insertAfter(e),
                e.remove()),
                this.originalElement.css("resize", this.originalResizeStyle),
                i(this.originalElement),
                this
            },
            _mouseCapture: function(e) {
                var i, n, r = !1;
                for (i in this.handles)
                    ((n = t(this.handles[i])[0]) === e.target || t.contains(n, e.target)) && (r = !0);
                return !this.options.disabled && r
            },
            _mouseStart: function(e) {
                var n, r, a, s = this.options, o = this.element.position(), l = this.element;
                return this.resizing = !0,
                /absolute/.test(l.css("position")) ? l.css({
                    position: "absolute",
                    top: l.css("top"),
                    left: l.css("left")
                }) : l.is(".ui-draggable") && l.css({
                    position: "absolute",
                    top: o.top,
                    left: o.left
                }),
                this._renderProxy(),
                n = i(this.helper.css("left")),
                r = i(this.helper.css("top")),
                s.containment && (n += t(s.containment).scrollLeft() || 0,
                r += t(s.containment).scrollTop() || 0),
                this.offset = this.helper.offset(),
                this.position = {
                    left: n,
                    top: r
                },
                this.size = this._helper ? {
                    width: l.outerWidth(),
                    height: l.outerHeight()
                } : {
                    width: l.width(),
                    height: l.height()
                },
                this.originalSize = this._helper ? {
                    width: l.outerWidth(),
                    height: l.outerHeight()
                } : {
                    width: l.width(),
                    height: l.height()
                },
                this.originalPosition = {
                    left: n,
                    top: r
                },
                this.sizeDiff = {
                    width: l.outerWidth() - l.width(),
                    height: l.outerHeight() - l.height()
                },
                this.originalMousePosition = {
                    left: e.pageX,
                    top: e.pageY
                },
                this.aspectRatio = "number" == typeof s.aspectRatio ? s.aspectRatio : this.originalSize.width / this.originalSize.height || 1,
                a = t(".ui-resizable-" + this.axis).css("cursor"),
                t("body").css("cursor", "auto" === a ? this.axis + "-resize" : a),
                l.addClass("ui-resizable-resizing"),
                this._propagate("start", e),
                !0
            },
            _mouseDrag: function(e) {
                var i, n = this.helper, r = {}, a = this.originalMousePosition, s = this.axis, o = this.position.top, l = this.position.left, u = this.size.width, h = this.size.height, c = e.pageX - a.left || 0, d = e.pageY - a.top || 0, p = this._change[s];
                return !!p && (i = p.apply(this, [e, c, d]),
                this._updateVirtualBoundaries(e.shiftKey),
                (this._aspectRatio || e.shiftKey) && (i = this._updateRatio(i, e)),
                i = this._respectSize(i, e),
                this._updateCache(i),
                this._propagate("resize", e),
                this.position.top !== o && (r.top = this.position.top + "px"),
                this.position.left !== l && (r.left = this.position.left + "px"),
                this.size.width !== u && (r.width = this.size.width + "px"),
                this.size.height !== h && (r.height = this.size.height + "px"),
                n.css(r),
                !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(),
                t.isEmptyObject(r) || this._trigger("resize", e, this.ui()),
                !1)
            },
            _mouseStop: function(e) {
                this.resizing = !1;
                var i, n, r, a, s, o, l, u = this.options, h = this;
                return this._helper && (i = this._proportionallyResizeElements,
                n = i.length && /textarea/i.test(i[0].nodeName),
                r = n && t.ui.hasScroll(i[0], "left") ? 0 : h.sizeDiff.height,
                a = n ? 0 : h.sizeDiff.width,
                s = {
                    width: h.helper.width() - a,
                    height: h.helper.height() - r
                },
                o = parseInt(h.element.css("left"), 10) + (h.position.left - h.originalPosition.left) || null,
                l = parseInt(h.element.css("top"), 10) + (h.position.top - h.originalPosition.top) || null,
                u.animate || this.element.css(t.extend(s, {
                    top: l,
                    left: o
                })),
                h.helper.height(h.size.height),
                h.helper.width(h.size.width),
                this._helper && !u.animate && this._proportionallyResize()),
                t("body").css("cursor", "auto"),
                this.element.removeClass("ui-resizable-resizing"),
                this._propagate("stop", e),
                this._helper && this.helper.remove(),
                !1
            },
            _updateVirtualBoundaries: function(t) {
                var e, i, r, a, s, o = this.options;
                s = {
                    minWidth: n(o.minWidth) ? o.minWidth : 0,
                    maxWidth: n(o.maxWidth) ? o.maxWidth : 1 / 0,
                    minHeight: n(o.minHeight) ? o.minHeight : 0,
                    maxHeight: n(o.maxHeight) ? o.maxHeight : 1 / 0
                },
                (this._aspectRatio || t) && (e = s.minHeight * this.aspectRatio,
                r = s.minWidth / this.aspectRatio,
                i = s.maxHeight * this.aspectRatio,
                a = s.maxWidth / this.aspectRatio,
                e > s.minWidth && (s.minWidth = e),
                r > s.minHeight && (s.minHeight = r),
                i < s.maxWidth && (s.maxWidth = i),
                a < s.maxHeight && (s.maxHeight = a)),
                this._vBoundaries = s
            },
            _updateCache: function(t) {
                this.offset = this.helper.offset(),
                n(t.left) && (this.position.left = t.left),
                n(t.top) && (this.position.top = t.top),
                n(t.height) && (this.size.height = t.height),
                n(t.width) && (this.size.width = t.width)
            },
            _updateRatio: function(t) {
                var e = this.position
                  , i = this.size
                  , r = this.axis;
                return n(t.height) ? t.width = t.height * this.aspectRatio : n(t.width) && (t.height = t.width / this.aspectRatio),
                "sw" === r && (t.left = e.left + (i.width - t.width),
                t.top = null),
                "nw" === r && (t.top = e.top + (i.height - t.height),
                t.left = e.left + (i.width - t.width)),
                t
            },
            _respectSize: function(t) {
                var e = this._vBoundaries
                  , i = this.axis
                  , r = n(t.width) && e.maxWidth && e.maxWidth < t.width
                  , a = n(t.height) && e.maxHeight && e.maxHeight < t.height
                  , s = n(t.width) && e.minWidth && e.minWidth > t.width
                  , o = n(t.height) && e.minHeight && e.minHeight > t.height
                  , l = this.originalPosition.left + this.originalSize.width
                  , u = this.position.top + this.size.height
                  , h = /sw|nw|w/.test(i)
                  , c = /nw|ne|n/.test(i);
                return s && (t.width = e.minWidth),
                o && (t.height = e.minHeight),
                r && (t.width = e.maxWidth),
                a && (t.height = e.maxHeight),
                s && h && (t.left = l - e.minWidth),
                r && h && (t.left = l - e.maxWidth),
                o && c && (t.top = u - e.minHeight),
                a && c && (t.top = u - e.maxHeight),
                t.width || t.height || t.left || !t.top ? t.width || t.height || t.top || !t.left || (t.left = null) : t.top = null,
                t
            },
            _proportionallyResize: function() {
                if (this._proportionallyResizeElements.length) {
                    var t, e, i, n, r, a = this.helper || this.element;
                    for (t = 0; t < this._proportionallyResizeElements.length; t++) {
                        if (r = this._proportionallyResizeElements[t],
                        !this.borderDif)
                            for (this.borderDif = [],
                            i = [r.css("borderTopWidth"), r.css("borderRightWidth"), r.css("borderBottomWidth"), r.css("borderLeftWidth")],
                            n = [r.css("paddingTop"), r.css("paddingRight"), r.css("paddingBottom"), r.css("paddingLeft")],
                            e = 0; e < i.length; e++)
                                this.borderDif[e] = (parseInt(i[e], 10) || 0) + (parseInt(n[e], 10) || 0);
                        r.css({
                            height: a.height() - this.borderDif[0] - this.borderDif[2] || 0,
                            width: a.width() - this.borderDif[1] - this.borderDif[3] || 0
                        })
                    }
                }
            },
            _renderProxy: function() {
                var e = this.element
                  , i = this.options;
                this.elementOffset = e.offset(),
                this._helper ? (this.helper = this.helper || t("<div style='overflow:hidden;'></div>"),
                this.helper.addClass(this._helper).css({
                    width: this.element.outerWidth() - 1,
                    height: this.element.outerHeight() - 1,
                    position: "absolute",
                    left: this.elementOffset.left + "px",
                    top: this.elementOffset.top + "px",
                    zIndex: ++i.zIndex
                }),
                this.helper.appendTo("body").disableSelection()) : this.helper = this.element
            },
            _change: {
                e: function(t, e) {
                    return {
                        width: this.originalSize.width + e
                    }
                },
                w: function(t, e) {
                    var i = this.originalSize;
                    return {
                        left: this.originalPosition.left + e,
                        width: i.width - e
                    }
                },
                n: function(t, e, i) {
                    var n = this.originalSize;
                    return {
                        top: this.originalPosition.top + i,
                        height: n.height - i
                    }
                },
                s: function(t, e, i) {
                    return {
                        height: this.originalSize.height + i
                    }
                },
                se: function(e, i, n) {
                    return t.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [e, i, n]))
                },
                sw: function(e, i, n) {
                    return t.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [e, i, n]))
                },
                ne: function(e, i, n) {
                    return t.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [e, i, n]))
                },
                nw: function(e, i, n) {
                    return t.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [e, i, n]))
                }
            },
            _propagate: function(e, i) {
                t.ui.plugin.call(this, e, [i, this.ui()]),
                "resize" !== e && this._trigger(e, i, this.ui())
            },
            plugins: {},
            ui: function() {
                return {
                    originalElement: this.originalElement,
                    element: this.element,
                    helper: this.helper,
                    position: this.position,
                    size: this.size,
                    originalSize: this.originalSize,
                    originalPosition: this.originalPosition
                }
            }
        }),
        t.ui.plugin.add("resizable", "animate", {
            stop: function(e) {
                var i = t(this).data("ui-resizable")
                  , n = i.options
                  , r = i._proportionallyResizeElements
                  , a = r.length && /textarea/i.test(r[0].nodeName)
                  , s = a && t.ui.hasScroll(r[0], "left") ? 0 : i.sizeDiff.height
                  , o = a ? 0 : i.sizeDiff.width
                  , l = {
                    width: i.size.width - o,
                    height: i.size.height - s
                }
                  , u = parseInt(i.element.css("left"), 10) + (i.position.left - i.originalPosition.left) || null
                  , h = parseInt(i.element.css("top"), 10) + (i.position.top - i.originalPosition.top) || null;
                i.element.animate(t.extend(l, h && u ? {
                    top: h,
                    left: u
                } : {}), {
                    duration: n.animateDuration,
                    easing: n.animateEasing,
                    step: function() {
                        var n = {
                            width: parseInt(i.element.css("width"), 10),
                            height: parseInt(i.element.css("height"), 10),
                            top: parseInt(i.element.css("top"), 10),
                            left: parseInt(i.element.css("left"), 10)
                        };
                        r && r.length && t(r[0]).css({
                            width: n.width,
                            height: n.height
                        }),
                        i._updateCache(n),
                        i._propagate("resize", e)
                    }
                })
            }
        }),
        t.ui.plugin.add("resizable", "containment", {
            start: function() {
                var e, n, r, a, s, o, l, u = t(this).data("ui-resizable"), h = u.options, c = u.element, d = h.containment, p = d instanceof t ? d.get(0) : /parent/.test(d) ? c.parent().get(0) : d;
                p && (u.containerElement = t(p),
                /document/.test(d) || d === document ? (u.containerOffset = {
                    left: 0,
                    top: 0
                },
                u.containerPosition = {
                    left: 0,
                    top: 0
                },
                u.parentData = {
                    element: t(document),
                    left: 0,
                    top: 0,
                    width: t(document).width(),
                    height: t(document).height() || document.body.parentNode.scrollHeight
                }) : (e = t(p),
                n = [],
                t(["Top", "Right", "Left", "Bottom"]).each(function(t, r) {
                    n[t] = i(e.css("padding" + r))
                }),
                u.containerOffset = e.offset(),
                u.containerPosition = e.position(),
                u.containerSize = {
                    height: e.innerHeight() - n[3],
                    width: e.innerWidth() - n[1]
                },
                r = u.containerOffset,
                a = u.containerSize.height,
                s = u.containerSize.width,
                o = t.ui.hasScroll(p, "left") ? p.scrollWidth : s,
                l = t.ui.hasScroll(p) ? p.scrollHeight : a,
                u.parentData = {
                    element: p,
                    left: r.left,
                    top: r.top,
                    width: o,
                    height: l
                }))
            },
            resize: function(e) {
                var i, n, r, a, s = t(this).data("ui-resizable"), o = s.options, l = s.containerOffset, u = s.position, h = s._aspectRatio || e.shiftKey, c = {
                    top: 0,
                    left: 0
                }, d = s.containerElement;
                d[0] !== document && /static/.test(d.css("position")) && (c = l),
                u.left < (s._helper ? l.left : 0) && (s.size.width = s.size.width + (s._helper ? s.position.left - l.left : s.position.left - c.left),
                h && (s.size.height = s.size.width / s.aspectRatio),
                s.position.left = o.helper ? l.left : 0),
                u.top < (s._helper ? l.top : 0) && (s.size.height = s.size.height + (s._helper ? s.position.top - l.top : s.position.top),
                h && (s.size.width = s.size.height * s.aspectRatio),
                s.position.top = s._helper ? l.top : 0),
                s.offset.left = s.parentData.left + s.position.left,
                s.offset.top = s.parentData.top + s.position.top,
                i = Math.abs((s._helper,
                s.offset.left - c.left + s.sizeDiff.width)),
                n = Math.abs((s._helper ? s.offset.top - c.top : s.offset.top - l.top) + s.sizeDiff.height),
                r = s.containerElement.get(0) === s.element.parent().get(0),
                a = /relative|absolute/.test(s.containerElement.css("position")),
                r && a && (i -= s.parentData.left),
                i + s.size.width >= s.parentData.width && (s.size.width = s.parentData.width - i,
                h && (s.size.height = s.size.width / s.aspectRatio)),
                n + s.size.height >= s.parentData.height && (s.size.height = s.parentData.height - n,
                h && (s.size.width = s.size.height * s.aspectRatio))
            },
            stop: function() {
                var e = t(this).data("ui-resizable")
                  , i = e.options
                  , n = e.containerOffset
                  , r = e.containerPosition
                  , a = e.containerElement
                  , s = t(e.helper)
                  , o = s.offset()
                  , l = s.outerWidth() - e.sizeDiff.width
                  , u = s.outerHeight() - e.sizeDiff.height;
                e._helper && !i.animate && /relative/.test(a.css("position")) && t(this).css({
                    left: o.left - r.left - n.left,
                    width: l,
                    height: u
                }),
                e._helper && !i.animate && /static/.test(a.css("position")) && t(this).css({
                    left: o.left - r.left - n.left,
                    width: l,
                    height: u
                })
            }
        }),
        t.ui.plugin.add("resizable", "alsoResize", {
            start: function() {
                var e = t(this).data("ui-resizable")
                  , i = e.options
                  , n = function(e) {
                    t(e).each(function() {
                        var e = t(this);
                        e.data("ui-resizable-alsoresize", {
                            width: parseInt(e.width(), 10),
                            height: parseInt(e.height(), 10),
                            left: parseInt(e.css("left"), 10),
                            top: parseInt(e.css("top"), 10)
                        })
                    })
                };
                "object" != typeof i.alsoResize || i.alsoResize.parentNode ? n(i.alsoResize) : i.alsoResize.length ? (i.alsoResize = i.alsoResize[0],
                n(i.alsoResize)) : t.each(i.alsoResize, function(t) {
                    n(t)
                })
            },
            resize: function(e, i) {
                var n = t(this).data("ui-resizable")
                  , r = n.options
                  , a = n.originalSize
                  , s = n.originalPosition
                  , o = {
                    height: n.size.height - a.height || 0,
                    width: n.size.width - a.width || 0,
                    top: n.position.top - s.top || 0,
                    left: n.position.left - s.left || 0
                }
                  , l = function(e, n) {
                    t(e).each(function() {
                        var e = t(this)
                          , r = t(this).data("ui-resizable-alsoresize")
                          , a = {}
                          , s = n && n.length ? n : e.parents(i.originalElement[0]).length ? ["width", "height"] : ["width", "height", "top", "left"];
                        t.each(s, function(t, e) {
                            var i = (r[e] || 0) + (o[e] || 0);
                            i && i >= 0 && (a[e] = i || null)
                        }),
                        e.css(a)
                    })
                };
                "object" != typeof r.alsoResize || r.alsoResize.nodeType ? l(r.alsoResize) : t.each(r.alsoResize, function(t, e) {
                    l(t, e)
                })
            },
            stop: function() {
                t(this).removeData("resizable-alsoresize")
            }
        }),
        t.ui.plugin.add("resizable", "ghost", {
            start: function() {
                var e = t(this).data("ui-resizable")
                  , i = e.options
                  , n = e.size;
                e.ghost = e.originalElement.clone(),
                e.ghost.css({
                    opacity: .25,
                    display: "block",
                    position: "relative",
                    height: n.height,
                    width: n.width,
                    margin: 0,
                    left: 0,
                    top: 0
                }).addClass("ui-resizable-ghost").addClass("string" == typeof i.ghost ? i.ghost : ""),
                e.ghost.appendTo(e.helper)
            },
            resize: function() {
                var e = t(this).data("ui-resizable");
                e.ghost && e.ghost.css({
                    position: "relative",
                    height: e.size.height,
                    width: e.size.width
                })
            },
            stop: function() {
                var e = t(this).data("ui-resizable");
                e.ghost && e.helper && e.helper.get(0).removeChild(e.ghost.get(0))
            }
        }),
        t.ui.plugin.add("resizable", "grid", {
            resize: function() {
                var e = t(this).data("ui-resizable")
                  , i = e.options
                  , n = e.size
                  , r = e.originalSize
                  , a = e.originalPosition
                  , s = e.axis
                  , o = "number" == typeof i.grid ? [i.grid, i.grid] : i.grid
                  , l = o[0] || 1
                  , u = o[1] || 1
                  , h = Math.round((n.width - r.width) / l) * l
                  , c = Math.round((n.height - r.height) / u) * u
                  , d = r.width + h
                  , p = r.height + c
                  , f = i.maxWidth && i.maxWidth < d
                  , g = i.maxHeight && i.maxHeight < p
                  , m = i.minWidth && i.minWidth > d
                  , v = i.minHeight && i.minHeight > p;
                i.grid = o,
                m && (d += l),
                v && (p += u),
                f && (d -= l),
                g && (p -= u),
                /^(se|s|e)$/.test(s) ? (e.size.width = d,
                e.size.height = p) : /^(ne)$/.test(s) ? (e.size.width = d,
                e.size.height = p,
                e.position.top = a.top - c) : /^(sw)$/.test(s) ? (e.size.width = d,
                e.size.height = p,
                e.position.left = a.left - h) : (e.size.width = d,
                e.size.height = p,
                e.position.top = a.top - c,
                e.position.left = a.left - h)
            }
        })
    }(n),
    function(t, e) {
        t.widget("ui.selectable", t.ui.mouse, {
            version: "1.10.3",
            options: {
                appendTo: "body",
                autoRefresh: !0,
                distance: 0,
                filter: "*",
                tolerance: "touch",
                selected: null,
                selecting: null,
                start: null,
                stop: null,
                unselected: null,
                unselecting: null
            },
            _create: function() {
                var e, i = this;
                this.element.addClass("ui-selectable"),
                this.dragged = !1,
                this.refresh = function() {
                    e = t(i.options.filter, i.element[0]),
                    e.addClass("ui-selectee"),
                    e.each(function() {
                        var e = t(this)
                          , i = e.offset();
                        t.data(this, "selectable-item", {
                            element: this,
                            $element: e,
                            left: i.left,
                            top: i.top,
                            right: i.left + e.outerWidth(),
                            bottom: i.top + e.outerHeight(),
                            startselected: !1,
                            selected: e.hasClass("ui-selected"),
                            selecting: e.hasClass("ui-selecting"),
                            unselecting: e.hasClass("ui-unselecting")
                        })
                    })
                }
                ,
                this.refresh(),
                this.selectees = e.addClass("ui-selectee"),
                this._mouseInit(),
                this.helper = t("<div class='ui-selectable-helper'></div>")
            },
            _destroy: function() {
                this.selectees.removeClass("ui-selectee").removeData("selectable-item"),
                this.element.removeClass("ui-selectable ui-selectable-disabled"),
                this._mouseDestroy()
            },
            _mouseStart: function(e) {
                var i = this
                  , n = this.options;
                this.opos = [e.pageX, e.pageY],
                this.options.disabled || (this.selectees = t(n.filter, this.element[0]),
                this._trigger("start", e),
                t(n.appendTo).append(this.helper),
                this.helper.css({
                    left: e.pageX,
                    top: e.pageY,
                    width: 0,
                    height: 0
                }),
                n.autoRefresh && this.refresh(),
                this.selectees.filter(".ui-selected").each(function() {
                    var n = t.data(this, "selectable-item");
                    n.startselected = !0,
                    e.metaKey || e.ctrlKey || (n.$element.removeClass("ui-selected"),
                    n.selected = !1,
                    n.$element.addClass("ui-unselecting"),
                    n.unselecting = !0,
                    i._trigger("unselecting", e, {
                        unselecting: n.element
                    }))
                }),
                t(e.target).parents().addBack().each(function() {
                    var n, r = t.data(this, "selectable-item");
                    if (r)
                        return n = !e.metaKey && !e.ctrlKey || !r.$element.hasClass("ui-selected"),
                        r.$element.removeClass(n ? "ui-unselecting" : "ui-selected").addClass(n ? "ui-selecting" : "ui-unselecting"),
                        r.unselecting = !n,
                        r.selecting = n,
                        r.selected = n,
                        n ? i._trigger("selecting", e, {
                            selecting: r.element
                        }) : i._trigger("unselecting", e, {
                            unselecting: r.element
                        }),
                        !1
                }))
            },
            _mouseDrag: function(e) {
                if (this.dragged = !0,
                !this.options.disabled) {
                    var i, n = this, r = this.options, a = this.opos[0], s = this.opos[1], o = e.pageX, l = e.pageY;
                    return a > o && (i = o,
                    o = a,
                    a = i),
                    s > l && (i = l,
                    l = s,
                    s = i),
                    this.helper.css({
                        left: a,
                        top: s,
                        width: o - a,
                        height: l - s
                    }),
                    this.selectees.each(function() {
                        var i = t.data(this, "selectable-item")
                          , u = !1;
                        i && i.element !== n.element[0] && ("touch" === r.tolerance ? u = !(i.left > o || i.right < a || i.top > l || i.bottom < s) : "fit" === r.tolerance && (u = i.left > a && i.right < o && i.top > s && i.bottom < l),
                        u ? (i.selected && (i.$element.removeClass("ui-selected"),
                        i.selected = !1),
                        i.unselecting && (i.$element.removeClass("ui-unselecting"),
                        i.unselecting = !1),
                        i.selecting || (i.$element.addClass("ui-selecting"),
                        i.selecting = !0,
                        n._trigger("selecting", e, {
                            selecting: i.element
                        }))) : (i.selecting && ((e.metaKey || e.ctrlKey) && i.startselected ? (i.$element.removeClass("ui-selecting"),
                        i.selecting = !1,
                        i.$element.addClass("ui-selected"),
                        i.selected = !0) : (i.$element.removeClass("ui-selecting"),
                        i.selecting = !1,
                        i.startselected && (i.$element.addClass("ui-unselecting"),
                        i.unselecting = !0),
                        n._trigger("unselecting", e, {
                            unselecting: i.element
                        }))),
                        i.selected && (e.metaKey || e.ctrlKey || i.startselected || (i.$element.removeClass("ui-selected"),
                        i.selected = !1,
                        i.$element.addClass("ui-unselecting"),
                        i.unselecting = !0,
                        n._trigger("unselecting", e, {
                            unselecting: i.element
                        })))))
                    }),
                    !1
                }
            },
            _mouseStop: function(e) {
                var i = this;
                return this.dragged = !1,
                t(".ui-unselecting", this.element[0]).each(function() {
                    var n = t.data(this, "selectable-item");
                    n.$element.removeClass("ui-unselecting"),
                    n.unselecting = !1,
                    n.startselected = !1,
                    i._trigger("unselected", e, {
                        unselected: n.element
                    })
                }),
                t(".ui-selecting", this.element[0]).each(function() {
                    var n = t.data(this, "selectable-item");
                    n.$element.removeClass("ui-selecting").addClass("ui-selected"),
                    n.selecting = !1,
                    n.selected = !0,
                    n.startselected = !0,
                    i._trigger("selected", e, {
                        selected: n.element
                    })
                }),
                this._trigger("stop", e),
                this.helper.remove(),
                !1
            }
        })
    }(n),
    function(t, e) {
        function i(t, e, i) {
            return t > e && t < e + i
        }
        function n(t) {
            return /left|right/.test(t.css("float")) || /inline|table-cell/.test(t.css("display"))
        }
        t.widget("ui.sortable", t.ui.mouse, {
            version: "1.10.3",
            widgetEventPrefix: "sort",
            ready: !1,
            options: {
                appendTo: "parent",
                axis: !1,
                connectWith: !1,
                containment: !1,
                cursor: "auto",
                cursorAt: !1,
                dropOnEmpty: !0,
                forcePlaceholderSize: !1,
                forceHelperSize: !1,
                grid: !1,
                handle: !1,
                helper: "original",
                items: "> *",
                opacity: !1,
                placeholder: !1,
                revert: !1,
                scroll: !0,
                scrollSensitivity: 20,
                scrollSpeed: 20,
                scope: "default",
                tolerance: "intersect",
                zIndex: 1e3,
                activate: null,
                beforeStop: null,
                change: null,
                deactivate: null,
                out: null,
                over: null,
                receive: null,
                remove: null,
                sort: null,
                start: null,
                stop: null,
                update: null
            },
            _create: function() {
                var t = this.options;
                this.containerCache = {},
                this.element.addClass("ui-sortable"),
                this.refresh(),
                this.floating = !!this.items.length && ("x" === t.axis || n(this.items[0].item)),
                this.offset = this.element.offset(),
                this._mouseInit(),
                this.ready = !0
            },
            _destroy: function() {
                this.element.removeClass("ui-sortable ui-sortable-disabled"),
                this._mouseDestroy();
                for (var t = this.items.length - 1; t >= 0; t--)
                    this.items[t].item.removeData(this.widgetName + "-item");
                return this
            },
            _setOption: function(e, i) {
                "disabled" === e ? (this.options[e] = i,
                this.widget().toggleClass("ui-sortable-disabled", !!i)) : t.Widget.prototype._setOption.apply(this, arguments)
            },
            _mouseCapture: function(e, i) {
                var n = null
                  , r = !1
                  , a = this;
                return !this.reverting && (!this.options.disabled && "static" !== this.options.type && (this._refreshItems(e),
                t(e.target).parents().each(function() {
                    if (t.data(this, a.widgetName + "-item") === a)
                        return n = t(this),
                        !1
                }),
                t.data(e.target, a.widgetName + "-item") === a && (n = t(e.target)),
                !!n && (!(this.options.handle && !i && (t(this.options.handle, n).find("*").addBack().each(function() {
                    this === e.target && (r = !0)
                }),
                !r)) && (this.currentItem = n,
                this._removeCurrentsFromItems(),
                !0))))
            },
            _mouseStart: function(e, i, n) {
                var r, a, s = this.options;
                if (this.currentContainer = this,
                this.refreshPositions(),
                this.helper = this._createHelper(e),
                this._cacheHelperProportions(),
                this._cacheMargins(),
                this.scrollParent = this.helper.scrollParent(),
                this.offset = this.currentItem.offset(),
                this.offset = {
                    top: this.offset.top - this.margins.top,
                    left: this.offset.left - this.margins.left
                },
                t.extend(this.offset, {
                    click: {
                        left: e.pageX - this.offset.left,
                        top: e.pageY - this.offset.top
                    },
                    parent: this._getParentOffset(),
                    relative: this._getRelativeOffset()
                }),
                this.helper.css("position", "absolute"),
                this.cssPosition = this.helper.css("position"),
                this.originalPosition = this._generatePosition(e),
                this.originalPageX = e.pageX,
                this.originalPageY = e.pageY,
                s.cursorAt && this._adjustOffsetFromHelper(s.cursorAt),
                this.domPosition = {
                    prev: this.currentItem.prev()[0],
                    parent: this.currentItem.parent()[0]
                },
                this.helper[0] !== this.currentItem[0] && this.currentItem.hide(),
                this._createPlaceholder(),
                s.containment && this._setContainment(),
                s.cursor && "auto" !== s.cursor && (a = this.document.find("body"),
                this.storedCursor = a.css("cursor"),
                a.css("cursor", s.cursor),
                this.storedStylesheet = t("<style>*{ cursor: " + s.cursor + " !important; }</style>").appendTo(a)),
                s.opacity && (this.helper.css("opacity") && (this._storedOpacity = this.helper.css("opacity")),
                this.helper.css("opacity", s.opacity)),
                s.zIndex && (this.helper.css("zIndex") && (this._storedZIndex = this.helper.css("zIndex")),
                this.helper.css("zIndex", s.zIndex)),
                this.scrollParent[0] !== document && "HTML" !== this.scrollParent[0].tagName && (this.overflowOffset = this.scrollParent.offset()),
                this._trigger("start", e, this._uiHash()),
                this._preserveHelperProportions || this._cacheHelperProportions(),
                !n)
                    for (r = this.containers.length - 1; r >= 0; r--)
                        this.containers[r]._trigger("activate", e, this._uiHash(this));
                return t.ui.ddmanager && (t.ui.ddmanager.current = this),
                t.ui.ddmanager && !s.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e),
                this.dragging = !0,
                this.helper.addClass("ui-sortable-helper"),
                this._mouseDrag(e),
                !0
            },
            _mouseDrag: function(e) {
                var i, n, r, a, s = this.options, o = !1;
                for (this.position = this._generatePosition(e),
                this.positionAbs = this._convertPositionTo("absolute"),
                this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs),
                this.options.scroll && (this.scrollParent[0] !== document && "HTML" !== this.scrollParent[0].tagName ? (this.overflowOffset.top + this.scrollParent[0].offsetHeight - e.pageY < s.scrollSensitivity ? this.scrollParent[0].scrollTop = o = this.scrollParent[0].scrollTop + s.scrollSpeed : e.pageY - this.overflowOffset.top < s.scrollSensitivity && (this.scrollParent[0].scrollTop = o = this.scrollParent[0].scrollTop - s.scrollSpeed),
                this.overflowOffset.left + this.scrollParent[0].offsetWidth - e.pageX < s.scrollSensitivity ? this.scrollParent[0].scrollLeft = o = this.scrollParent[0].scrollLeft + s.scrollSpeed : e.pageX - this.overflowOffset.left < s.scrollSensitivity && (this.scrollParent[0].scrollLeft = o = this.scrollParent[0].scrollLeft - s.scrollSpeed)) : (e.pageY - t(document).scrollTop() < s.scrollSensitivity ? o = t(document).scrollTop(t(document).scrollTop() - s.scrollSpeed) : t(window).height() - (e.pageY - t(document).scrollTop()) < s.scrollSensitivity && (o = t(document).scrollTop(t(document).scrollTop() + s.scrollSpeed)),
                e.pageX - t(document).scrollLeft() < s.scrollSensitivity ? o = t(document).scrollLeft(t(document).scrollLeft() - s.scrollSpeed) : t(window).width() - (e.pageX - t(document).scrollLeft()) < s.scrollSensitivity && (o = t(document).scrollLeft(t(document).scrollLeft() + s.scrollSpeed))),
                !1 !== o && t.ui.ddmanager && !s.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e)),
                this.positionAbs = this._convertPositionTo("absolute"),
                this.options.axis && "y" === this.options.axis || (this.helper[0].style.left = this.position.left + "px"),
                this.options.axis && "x" === this.options.axis || (this.helper[0].style.top = this.position.top + "px"),
                i = this.items.length - 1; i >= 0; i--)
                    if (n = this.items[i],
                    r = n.item[0],
                    (a = this._intersectsWithPointer(n)) && n.instance === this.currentContainer && !(r === this.currentItem[0] || this.placeholder[1 === a ? "next" : "prev"]()[0] === r || t.contains(this.placeholder[0], r) || "semi-dynamic" === this.options.type && t.contains(this.element[0], r))) {
                        if (this.direction = 1 === a ? "down" : "up",
                        "pointer" !== this.options.tolerance && !this._intersectsWithSides(n))
                            break;
                        this._rearrange(e, n),
                        this._trigger("change", e, this._uiHash());
                        break
                    }
                return this._contactContainers(e),
                t.ui.ddmanager && t.ui.ddmanager.drag(this, e),
                this._trigger("sort", e, this._uiHash()),
                this.lastPositionAbs = this.positionAbs,
                !1
            },
            _mouseStop: function(e, i) {
                if (e) {
                    if (t.ui.ddmanager && !this.options.dropBehaviour && t.ui.ddmanager.drop(this, e),
                    this.options.revert) {
                        var n = this
                          , r = this.placeholder.offset()
                          , a = this.options.axis
                          , s = {};
                        a && "x" !== a || (s.left = r.left - this.offset.parent.left - this.margins.left + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollLeft)),
                        a && "y" !== a || (s.top = r.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollTop)),
                        this.reverting = !0,
                        t(this.helper).animate(s, parseInt(this.options.revert, 10) || 500, function() {
                            n._clear(e)
                        })
                    } else
                        this._clear(e, i);
                    return !1
                }
            },
            cancel: function() {
                if (this.dragging) {
                    this._mouseUp({
                        target: null
                    }),
                    "original" === this.options.helper ? this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper") : this.currentItem.show();
                    for (var e = this.containers.length - 1; e >= 0; e--)
                        this.containers[e]._trigger("deactivate", null, this._uiHash(this)),
                        this.containers[e].containerCache.over && (this.containers[e]._trigger("out", null, this._uiHash(this)),
                        this.containers[e].containerCache.over = 0)
                }
                return this.placeholder && (this.placeholder[0].parentNode && this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
                "original" !== this.options.helper && this.helper && this.helper[0].parentNode && this.helper.remove(),
                t.extend(this, {
                    helper: null,
                    dragging: !1,
                    reverting: !1,
                    _noFinalSort: null
                }),
                this.domPosition.prev ? t(this.domPosition.prev).after(this.currentItem) : t(this.domPosition.parent).prepend(this.currentItem)),
                this
            },
            serialize: function(e) {
                var i = this._getItemsAsjQuery(e && e.connected)
                  , n = [];
                return e = e || {},
                t(i).each(function() {
                    var i = (t(e.item || this).attr(e.attribute || "id") || "").match(e.expression || /(.+)[\-=_](.+)/);
                    i && n.push((e.key || i[1] + "[]") + "=" + (e.key && e.expression ? i[1] : i[2]))
                }),
                !n.length && e.key && n.push(e.key + "="),
                n.join("&")
            },
            toArray: function(e) {
                var i = this._getItemsAsjQuery(e && e.connected)
                  , n = [];
                return e = e || {},
                i.each(function() {
                    n.push(t(e.item || this).attr(e.attribute || "id") || "")
                }),
                n
            },
            _intersectsWith: function(t) {
                var e = this.positionAbs.left
                  , i = e + this.helperProportions.width
                  , n = this.positionAbs.top
                  , r = n + this.helperProportions.height
                  , a = t.left
                  , s = a + t.width
                  , o = t.top
                  , l = o + t.height
                  , u = this.offset.click.top
                  , h = this.offset.click.left
                  , c = "x" === this.options.axis || n + u > o && n + u < l
                  , d = "y" === this.options.axis || e + h > a && e + h < s
                  , p = c && d;
                return "pointer" === this.options.tolerance || this.options.forcePointerForContainers || "pointer" !== this.options.tolerance && this.helperProportions[this.floating ? "width" : "height"] > t[this.floating ? "width" : "height"] ? p : a < e + this.helperProportions.width / 2 && i - this.helperProportions.width / 2 < s && o < n + this.helperProportions.height / 2 && r - this.helperProportions.height / 2 < l
            },
            _intersectsWithPointer: function(t) {
                var e = "x" === this.options.axis || i(this.positionAbs.top + this.offset.click.top, t.top, t.height)
                  , n = "y" === this.options.axis || i(this.positionAbs.left + this.offset.click.left, t.left, t.width)
                  , r = e && n
                  , a = this._getDragVerticalDirection()
                  , s = this._getDragHorizontalDirection();
                return !!r && (this.floating ? s && "right" === s || "down" === a ? 2 : 1 : a && ("down" === a ? 2 : 1))
            },
            _intersectsWithSides: function(t) {
                var e = i(this.positionAbs.top + this.offset.click.top, t.top + t.height / 2, t.height)
                  , n = i(this.positionAbs.left + this.offset.click.left, t.left + t.width / 2, t.width)
                  , r = this._getDragVerticalDirection()
                  , a = this._getDragHorizontalDirection();
                return this.floating && a ? "right" === a && n || "left" === a && !n : r && ("down" === r && e || "up" === r && !e)
            },
            _getDragVerticalDirection: function() {
                var t = this.positionAbs.top - this.lastPositionAbs.top;
                return 0 !== t && (t > 0 ? "down" : "up")
            },
            _getDragHorizontalDirection: function() {
                var t = this.positionAbs.left - this.lastPositionAbs.left;
                return 0 !== t && (t > 0 ? "right" : "left")
            },
            refresh: function(t) {
                return this._refreshItems(t),
                this.refreshPositions(),
                this
            },
            _connectWith: function() {
                var t = this.options;
                return t.connectWith.constructor === String ? [t.connectWith] : t.connectWith
            },
            _getItemsAsjQuery: function(e) {
                var i, n, r, a, s = [], o = [], l = this._connectWith();
                if (l && e)
                    for (i = l.length - 1; i >= 0; i--)
                        for (r = t(l[i]),
                        n = r.length - 1; n >= 0; n--)
                            (a = t.data(r[n], this.widgetFullName)) && a !== this && !a.options.disabled && o.push([t.isFunction(a.options.items) ? a.options.items.call(a.element) : t(a.options.items, a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), a]);
                for (o.push([t.isFunction(this.options.items) ? this.options.items.call(this.element, null, {
                    options: this.options,
                    item: this.currentItem
                }) : t(this.options.items, this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), this]),
                i = o.length - 1; i >= 0; i--)
                    o[i][0].each(function() {
                        s.push(this)
                    });
                return t(s)
            },
            _removeCurrentsFromItems: function() {
                var e = this.currentItem.find(":data(" + this.widgetName + "-item)");
                this.items = t.grep(this.items, function(t) {
                    for (var i = 0; i < e.length; i++)
                        if (e[i] === t.item[0])
                            return !1;
                    return !0
                })
            },
            _refreshItems: function(e) {
                this.items = [],
                this.containers = [this];
                var i, n, r, a, s, o, l, u, h = this.items, c = [[t.isFunction(this.options.items) ? this.options.items.call(this.element[0], e, {
                    item: this.currentItem
                }) : t(this.options.items, this.element), this]], d = this._connectWith();
                if (d && this.ready)
                    for (i = d.length - 1; i >= 0; i--)
                        for (r = t(d[i]),
                        n = r.length - 1; n >= 0; n--)
                            (a = t.data(r[n], this.widgetFullName)) && a !== this && !a.options.disabled && (c.push([t.isFunction(a.options.items) ? a.options.items.call(a.element[0], e, {
                                item: this.currentItem
                            }) : t(a.options.items, a.element), a]),
                            this.containers.push(a));
                for (i = c.length - 1; i >= 0; i--)
                    for (s = c[i][1],
                    o = c[i][0],
                    n = 0,
                    u = o.length; n < u; n++)
                        l = t(o[n]),
                        l.data(this.widgetName + "-item", s),
                        h.push({
                            item: l,
                            instance: s,
                            width: 0,
                            height: 0,
                            left: 0,
                            top: 0
                        })
            },
            refreshPositions: function(e) {
                this.offsetParent && this.helper && (this.offset.parent = this._getParentOffset());
                var i, n, r, a;
                for (i = this.items.length - 1; i >= 0; i--)
                    n = this.items[i],
                    n.instance !== this.currentContainer && this.currentContainer && n.item[0] !== this.currentItem[0] || (r = this.options.toleranceElement ? t(this.options.toleranceElement, n.item) : n.item,
                    e || (n.width = r.outerWidth(),
                    n.height = r.outerHeight()),
                    a = r.offset(),
                    n.left = a.left,
                    n.top = a.top);
                if (this.options.custom && this.options.custom.refreshContainers)
                    this.options.custom.refreshContainers.call(this);
                else
                    for (i = this.containers.length - 1; i >= 0; i--)
                        a = this.containers[i].element.offset(),
                        this.containers[i].containerCache.left = a.left,
                        this.containers[i].containerCache.top = a.top,
                        this.containers[i].containerCache.width = this.containers[i].element.outerWidth(),
                        this.containers[i].containerCache.height = this.containers[i].element.outerHeight();
                return this
            },
            _createPlaceholder: function(e) {
                e = e || this;
                var i, n = e.options;
                n.placeholder && n.placeholder.constructor !== String || (i = n.placeholder,
                n.placeholder = {
                    element: function() {
                        var n = e.currentItem[0].nodeName.toLowerCase()
                          , r = t("<" + n + ">", e.document[0]).addClass(i || e.currentItem[0].className + " ui-sortable-placeholder").removeClass("ui-sortable-helper");
                        return "tr" === n ? e.currentItem.children().each(function() {
                            t("<td>&#160;</td>", e.document[0]).attr("colspan", t(this).attr("colspan") || 1).appendTo(r)
                        }) : "img" === n && r.attr("src", e.currentItem.attr("src")),
                        i || r.css("visibility", "hidden"),
                        r
                    },
                    update: function(t, r) {
                        i && !n.forcePlaceholderSize || (r.height() || r.height(e.currentItem.innerHeight() - parseInt(e.currentItem.css("paddingTop") || 0, 10) - parseInt(e.currentItem.css("paddingBottom") || 0, 10)),
                        r.width() || r.width(e.currentItem.innerWidth() - parseInt(e.currentItem.css("paddingLeft") || 0, 10) - parseInt(e.currentItem.css("paddingRight") || 0, 10)))
                    }
                }),
                e.placeholder = t(n.placeholder.element.call(e.element, e.currentItem)),
                e.currentItem.after(e.placeholder),
                n.placeholder.update(e, e.placeholder)
            },
            _contactContainers: function(e) {
                var r, a, s, o, l, u, h, c, d, p, f = null, g = null;
                for (r = this.containers.length - 1; r >= 0; r--)
                    if (!t.contains(this.currentItem[0], this.containers[r].element[0]))
                        if (this._intersectsWith(this.containers[r].containerCache)) {
                            if (f && t.contains(this.containers[r].element[0], f.element[0]))
                                continue;
                            f = this.containers[r],
                            g = r
                        } else
                            this.containers[r].containerCache.over && (this.containers[r]._trigger("out", e, this._uiHash(this)),
                            this.containers[r].containerCache.over = 0);
                if (f)
                    if (1 === this.containers.length)
                        this.containers[g].containerCache.over || (this.containers[g]._trigger("over", e, this._uiHash(this)),
                        this.containers[g].containerCache.over = 1);
                    else {
                        for (s = 1e4,
                        o = null,
                        p = f.floating || n(this.currentItem),
                        l = p ? "left" : "top",
                        u = p ? "width" : "height",
                        h = this.positionAbs[l] + this.offset.click[l],
                        a = this.items.length - 1; a >= 0; a--)
                            t.contains(this.containers[g].element[0], this.items[a].item[0]) && this.items[a].item[0] !== this.currentItem[0] && (p && !i(this.positionAbs.top + this.offset.click.top, this.items[a].top, this.items[a].height) || (c = this.items[a].item.offset()[l],
                            d = !1,
                            Math.abs(c - h) > Math.abs(c + this.items[a][u] - h) && (d = !0,
                            c += this.items[a][u]),
                            Math.abs(c - h) < s && (s = Math.abs(c - h),
                            o = this.items[a],
                            this.direction = d ? "up" : "down")));
                        if (!o && !this.options.dropOnEmpty)
                            return;
                        if (this.currentContainer === this.containers[g])
                            return;
                        o ? this._rearrange(e, o, null, !0) : this._rearrange(e, null, this.containers[g].element, !0),
                        this._trigger("change", e, this._uiHash()),
                        this.containers[g]._trigger("change", e, this._uiHash(this)),
                        this.currentContainer = this.containers[g],
                        this.options.placeholder.update(this.currentContainer, this.placeholder),
                        this.containers[g]._trigger("over", e, this._uiHash(this)),
                        this.containers[g].containerCache.over = 1
                    }
            },
            _createHelper: function(e) {
                var i = this.options
                  , n = t.isFunction(i.helper) ? t(i.helper.apply(this.element[0], [e, this.currentItem])) : "clone" === i.helper ? this.currentItem.clone() : this.currentItem;
                return n.parents("body").length || t("parent" !== i.appendTo ? i.appendTo : this.currentItem[0].parentNode)[0].appendChild(n[0]),
                n[0] === this.currentItem[0] && (this._storedCSS = {
                    width: this.currentItem[0].style.width,
                    height: this.currentItem[0].style.height,
                    position: this.currentItem.css("position"),
                    top: this.currentItem.css("top"),
                    left: this.currentItem.css("left")
                }),
                n[0].style.width && !i.forceHelperSize || n.width(this.currentItem.width()),
                n[0].style.height && !i.forceHelperSize || n.height(this.currentItem.height()),
                n
            },
            _adjustOffsetFromHelper: function(e) {
                "string" == typeof e && (e = e.split(" ")),
                t.isArray(e) && (e = {
                    left: +e[0],
                    top: +e[1] || 0
                }),
                "left"in e && (this.offset.click.left = e.left + this.margins.left),
                "right"in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left),
                "top"in e && (this.offset.click.top = e.top + this.margins.top),
                "bottom"in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top)
            },
            _getParentOffset: function() {
                this.offsetParent = this.helper.offsetParent();
                var e = this.offsetParent.offset();
                return "absolute" === this.cssPosition && this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(),
                e.top += this.scrollParent.scrollTop()),
                (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && "html" === this.offsetParent[0].tagName.toLowerCase() && t.ui.ie) && (e = {
                    top: 0,
                    left: 0
                }),
                {
                    top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                    left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
                }
            },
            _getRelativeOffset: function() {
                if ("relative" === this.cssPosition) {
                    var t = this.currentItem.position();
                    return {
                        top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                        left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
                    }
                }
                return {
                    top: 0,
                    left: 0
                }
            },
            _cacheMargins: function() {
                this.margins = {
                    left: parseInt(this.currentItem.css("marginLeft"), 10) || 0,
                    top: parseInt(this.currentItem.css("marginTop"), 10) || 0
                }
            },
            _cacheHelperProportions: function() {
                this.helperProportions = {
                    width: this.helper.outerWidth(),
                    height: this.helper.outerHeight()
                }
            },
            _setContainment: function() {
                var e, i, n, r = this.options;
                "parent" === r.containment && (r.containment = this.helper[0].parentNode),
                "document" !== r.containment && "window" !== r.containment || (this.containment = [0 - this.offset.relative.left - this.offset.parent.left, 0 - this.offset.relative.top - this.offset.parent.top, t("document" === r.containment ? document : window).width() - this.helperProportions.width - this.margins.left, (t("document" === r.containment ? document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]),
                /^(document|window|parent)$/.test(r.containment) || (e = t(r.containment)[0],
                i = t(r.containment).offset(),
                n = "hidden" !== t(e).css("overflow"),
                this.containment = [i.left + (parseInt(t(e).css("borderLeftWidth"), 10) || 0) + (parseInt(t(e).css("paddingLeft"), 10) || 0) - this.margins.left, i.top + (parseInt(t(e).css("borderTopWidth"), 10) || 0) + (parseInt(t(e).css("paddingTop"), 10) || 0) - this.margins.top, i.left + (n ? Math.max(e.scrollWidth, e.offsetWidth) : e.offsetWidth) - (parseInt(t(e).css("borderLeftWidth"), 10) || 0) - (parseInt(t(e).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left, i.top + (n ? Math.max(e.scrollHeight, e.offsetHeight) : e.offsetHeight) - (parseInt(t(e).css("borderTopWidth"), 10) || 0) - (parseInt(t(e).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top])
            },
            _convertPositionTo: function(e, i) {
                i || (i = this.position);
                var n = "absolute" === e ? 1 : -1
                  , r = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent
                  , a = /(html|body)/i.test(r[0].tagName);
                return {
                    top: i.top + this.offset.relative.top * n + this.offset.parent.top * n - ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : a ? 0 : r.scrollTop()) * n,
                    left: i.left + this.offset.relative.left * n + this.offset.parent.left * n - ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : a ? 0 : r.scrollLeft()) * n
                }
            },
            _generatePosition: function(e) {
                var i, n, r = this.options, a = e.pageX, s = e.pageY, o = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent, l = /(html|body)/i.test(o[0].tagName);
                return "relative" !== this.cssPosition || this.scrollParent[0] !== document && this.scrollParent[0] !== this.offsetParent[0] || (this.offset.relative = this._getRelativeOffset()),
                this.originalPosition && (this.containment && (e.pageX - this.offset.click.left < this.containment[0] && (a = this.containment[0] + this.offset.click.left),
                e.pageY - this.offset.click.top < this.containment[1] && (s = this.containment[1] + this.offset.click.top),
                e.pageX - this.offset.click.left > this.containment[2] && (a = this.containment[2] + this.offset.click.left),
                e.pageY - this.offset.click.top > this.containment[3] && (s = this.containment[3] + this.offset.click.top)),
                r.grid && (i = this.originalPageY + Math.round((s - this.originalPageY) / r.grid[1]) * r.grid[1],
                s = this.containment ? i - this.offset.click.top >= this.containment[1] && i - this.offset.click.top <= this.containment[3] ? i : i - this.offset.click.top >= this.containment[1] ? i - r.grid[1] : i + r.grid[1] : i,
                n = this.originalPageX + Math.round((a - this.originalPageX) / r.grid[0]) * r.grid[0],
                a = this.containment ? n - this.offset.click.left >= this.containment[0] && n - this.offset.click.left <= this.containment[2] ? n : n - this.offset.click.left >= this.containment[0] ? n - r.grid[0] : n + r.grid[0] : n)),
                {
                    top: s - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : l ? 0 : o.scrollTop()),
                    left: a - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : l ? 0 : o.scrollLeft())
                }
            },
            _rearrange: function(t, e, i, n) {
                i ? i[0].appendChild(this.placeholder[0]) : e.item[0].parentNode.insertBefore(this.placeholder[0], "down" === this.direction ? e.item[0] : e.item[0].nextSibling),
                this.counter = this.counter ? ++this.counter : 1;
                var r = this.counter;
                this._delay(function() {
                    r === this.counter && this.refreshPositions(!n)
                })
            },
            _clear: function(t, e) {
                this.reverting = !1;
                var i, n = [];
                if (!this._noFinalSort && this.currentItem.parent().length && this.placeholder.before(this.currentItem),
                this._noFinalSort = null,
                this.helper[0] === this.currentItem[0]) {
                    for (i in this._storedCSS)
                        "auto" !== this._storedCSS[i] && "static" !== this._storedCSS[i] || (this._storedCSS[i] = "");
                    this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")
                } else
                    this.currentItem.show();
                for (this.fromOutside && !e && n.push(function(t) {
                    this._trigger("receive", t, this._uiHash(this.fromOutside))
                }),
                !this.fromOutside && this.domPosition.prev === this.currentItem.prev().not(".ui-sortable-helper")[0] && this.domPosition.parent === this.currentItem.parent()[0] || e || n.push(function(t) {
                    this._trigger("update", t, this._uiHash())
                }),
                this !== this.currentContainer && (e || (n.push(function(t) {
                    this._trigger("remove", t, this._uiHash())
                }),
                n.push(function(t) {
                    return function(e) {
                        t._trigger("receive", e, this._uiHash(this))
                    }
                }
                .call(this, this.currentContainer)),
                n.push(function(t) {
                    return function(e) {
                        t._trigger("update", e, this._uiHash(this))
                    }
                }
                .call(this, this.currentContainer)))),
                i = this.containers.length - 1; i >= 0; i--)
                    e || n.push(function(t) {
                        return function(e) {
                            t._trigger("deactivate", e, this._uiHash(this))
                        }
                    }
                    .call(this, this.containers[i])),
                    this.containers[i].containerCache.over && (n.push(function(t) {
                        return function(e) {
                            t._trigger("out", e, this._uiHash(this))
                        }
                    }
                    .call(this, this.containers[i])),
                    this.containers[i].containerCache.over = 0);
                if (this.storedCursor && (this.document.find("body").css("cursor", this.storedCursor),
                this.storedStylesheet.remove()),
                this._storedOpacity && this.helper.css("opacity", this._storedOpacity),
                this._storedZIndex && this.helper.css("zIndex", "auto" === this._storedZIndex ? "" : this._storedZIndex),
                this.dragging = !1,
                this.cancelHelperRemoval) {
                    if (!e) {
                        for (this._trigger("beforeStop", t, this._uiHash()),
                        i = 0; i < n.length; i++)
                            n[i].call(this, t);
                        this._trigger("stop", t, this._uiHash())
                    }
                    return this.fromOutside = !1,
                    !1
                }
                if (e || this._trigger("beforeStop", t, this._uiHash()),
                this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
                this.helper[0] !== this.currentItem[0] && this.helper.remove(),
                this.helper = null,
                !e) {
                    for (i = 0; i < n.length; i++)
                        n[i].call(this, t);
                    this._trigger("stop", t, this._uiHash())
                }
                return this.fromOutside = !1,
                !0
            },
            _trigger: function() {
                !1 === t.Widget.prototype._trigger.apply(this, arguments) && this.cancel()
            },
            _uiHash: function(e) {
                var i = e || this;
                return {
                    helper: i.helper,
                    placeholder: i.placeholder || t([]),
                    position: i.position,
                    originalPosition: i.originalPosition,
                    offset: i.positionAbs,
                    item: i.currentItem,
                    sender: e ? e.element : null
                }
            }
        })
    }(n),
    function(t, e) {
        t.effects = {
            effect: {}
        },
        /*!
 * jQuery Color Animations v2.1.2
 * https://github.com/jquery/jquery-color
 *
 * Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: Wed Jan 16 08:47:09 2013 -0600
 */
        function(t, e) {
            function i(t, e, i) {
                var n = h[e.type] || {};
                return null == t ? i || !e.def ? null : e.def : (t = n.floor ? ~~t : parseFloat(t),
                isNaN(t) ? e.def : n.mod ? (t + n.mod) % n.mod : 0 > t ? 0 : n.max < t ? n.max : t)
            }
            function n(e) {
                var i = l()
                  , n = i._rgba = [];
                return e = e.toLowerCase(),
                p(o, function(t, r) {
                    var a, s = r.re.exec(e), o = s && r.parse(s), l = r.space || "rgba";
                    if (o)
                        return a = i[l](o),
                        i[u[l].cache] = a[u[l].cache],
                        n = i._rgba = a._rgba,
                        !1
                }),
                n.length ? ("0,0,0,0" === n.join() && t.extend(n, a.transparent),
                i) : a[e]
            }
            function r(t, e, i) {
                return i = (i + 1) % 1,
                6 * i < 1 ? t + (e - t) * i * 6 : 2 * i < 1 ? e : 3 * i < 2 ? t + (e - t) * (2 / 3 - i) * 6 : t
            }
            var a, s = /^([\-+])=\s*(\d+\.?\d*)/, o = [{
                re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                parse: function(t) {
                    return [t[1], t[2], t[3], t[4]]
                }
            }, {
                re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                parse: function(t) {
                    return [2.55 * t[1], 2.55 * t[2], 2.55 * t[3], t[4]]
                }
            }, {
                re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,
                parse: function(t) {
                    return [parseInt(t[1], 16), parseInt(t[2], 16), parseInt(t[3], 16)]
                }
            }, {
                re: /#([a-f0-9])([a-f0-9])([a-f0-9])/,
                parse: function(t) {
                    return [parseInt(t[1] + t[1], 16), parseInt(t[2] + t[2], 16), parseInt(t[3] + t[3], 16)]
                }
            }, {
                re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                space: "hsla",
                parse: function(t) {
                    return [t[1], t[2] / 100, t[3] / 100, t[4]]
                }
            }], l = t.Color = function(e, i, n, r) {
                return new t.Color.fn.parse(e,i,n,r)
            }
            , u = {
                rgba: {
                    props: {
                        red: {
                            idx: 0,
                            type: "byte"
                        },
                        green: {
                            idx: 1,
                            type: "byte"
                        },
                        blue: {
                            idx: 2,
                            type: "byte"
                        }
                    }
                },
                hsla: {
                    props: {
                        hue: {
                            idx: 0,
                            type: "degrees"
                        },
                        saturation: {
                            idx: 1,
                            type: "percent"
                        },
                        lightness: {
                            idx: 2,
                            type: "percent"
                        }
                    }
                }
            }, h = {
                byte: {
                    floor: !0,
                    max: 255
                },
                percent: {
                    max: 1
                },
                degrees: {
                    mod: 360,
                    floor: !0
                }
            }, c = l.support = {}, d = t("<p>")[0], p = t.each;
            d.style.cssText = "background-color:rgba(1,1,1,.5)",
            c.rgba = d.style.backgroundColor.indexOf("rgba") > -1,
            p(u, function(t, e) {
                e.cache = "_" + t,
                e.props.alpha = {
                    idx: 3,
                    type: "percent",
                    def: 1
                }
            }),
            l.fn = t.extend(l.prototype, {
                parse: function(e, r, s, o) {
                    if (void 0 === e)
                        return this._rgba = [null, null, null, null],
                        this;
                    (e.jquery || e.nodeType) && (e = t(e).css(r),
                    r = void 0);
                    var h = this
                      , c = t.type(e)
                      , d = this._rgba = [];
                    /*!
 * jQuery Color Animations v2.1.2
 * https://github.com/jquery/jquery-color
 *
 * Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: Wed Jan 16 08:47:09 2013 -0600
 */
                    return void 0 !== r && (e = [e, r, s, o],
                    c = "array"),
                    "string" === c ? this.parse(n(e) || a._default) : "array" === c ? (p(u.rgba.props, function(t, n) {
                        d[n.idx] = i(e[n.idx], n)
                    }),
                    this) : "object" === c ? (e instanceof l ? p(u, function(t, i) {
                        e[i.cache] && (h[i.cache] = e[i.cache].slice())
                    }) : p(u, function(n, r) {
                        var a = r.cache;
                        p(r.props, function(t, n) {
                            if (!h[a] && r.to) {
                                if ("alpha" === t || null == e[t])
                                    return;
                                h[a] = r.to(h._rgba)
                            }
                            h[a][n.idx] = i(e[t], n, !0)
                        }),
                        h[a] && t.inArray(null, h[a].slice(0, 3)) < 0 && (h[a][3] = 1,
                        r.from && (h._rgba = r.from(h[a])))
                    }),
                    this) : void 0
                },
                is: function(t) {
                    var e = l(t)
                      , i = !0
                      , n = this;
                    return p(u, function(t, r) {
                        var a, s = e[r.cache];
                        return s && (a = n[r.cache] || r.to && r.to(n._rgba) || [],
                        p(r.props, function(t, e) {
                            if (null != s[e.idx])
                                return i = s[e.idx] === a[e.idx]
                        })),
                        i
                    }),
                    i
                },
                _space: function() {
                    var t = []
                      , e = this;
                    return p(u, function(i, n) {
                        e[n.cache] && t.push(i)
                    }),
                    t.pop()
                },
                transition: function(t, e) {
                    var n = l(t)
                      , r = n._space()
                      , a = u[r]
                      , s = 0 === this.alpha() ? l("transparent") : this
                      , o = s[a.cache] || a.to(s._rgba)
                      , c = o.slice();
                    return n = n[a.cache],
                    p(a.props, function(t, r) {
                        var a = r.idx
                          , s = o[a]
                          , l = n[a]
                          , u = h[r.type] || {};
                        null !== l && (null === s ? c[a] = l : (u.mod && (l - s > u.mod / 2 ? s += u.mod : s - l > u.mod / 2 && (s -= u.mod)),
                        c[a] = i((l - s) * e + s, r)))
                    }),
                    this[r](c)
                },
                blend: function(e) {
                    if (1 === this._rgba[3])
                        return this;
                    var i = this._rgba.slice()
                      , n = i.pop()
                      , r = l(e)._rgba;
                    return l(t.map(i, function(t, e) {
                        return (1 - n) * r[e] + n * t
                    }))
                },
                toRgbaString: function() {
                    var e = "rgba("
                      , i = t.map(this._rgba, function(t, e) {
                        return null == t ? e > 2 ? 1 : 0 : t
                    });
                    return 1 === i[3] && (i.pop(),
                    e = "rgb("),
                    e + i.join() + ")"
                },
                toHslaString: function() {
                    var e = "hsla("
                      , i = t.map(this.hsla(), function(t, e) {
                        return null == t && (t = e > 2 ? 1 : 0),
                        e && e < 3 && (t = Math.round(100 * t) + "%"),
                        t
                    });
                    return 1 === i[3] && (i.pop(),
                    e = "hsl("),
                    e + i.join() + ")"
                },
                toHexString: function(e) {
                    var i = this._rgba.slice()
                      , n = i.pop();
                    return e && i.push(~~(255 * n)),
                    "#" + t.map(i, function(t) {
                        return t = (t || 0).toString(16),
                        1 === t.length ? "0" + t : t
                    }).join("")
                },
                toString: function() {
                    return 0 === this._rgba[3] ? "transparent" : this.toRgbaString()
                }
            }),
            l.fn.parse.prototype = l.fn,
            u.hsla.to = function(t) {
                if (null == t[0] || null == t[1] || null == t[2])
                    return [null, null, null, t[3]];
                var e, i, n = t[0] / 255, r = t[1] / 255, a = t[2] / 255, s = t[3], o = Math.max(n, r, a), l = Math.min(n, r, a), u = o - l, h = o + l, c = .5 * h;
                return e = l === o ? 0 : n === o ? 60 * (r - a) / u + 360 : r === o ? 60 * (a - n) / u + 120 : 60 * (n - r) / u + 240,
                i = 0 === u ? 0 : c <= .5 ? u / h : u / (2 - h),
                [Math.round(e) % 360, i, c, null == s ? 1 : s]
            }
            ,
            u.hsla.from = function(t) {
                if (null == t[0] || null == t[1] || null == t[2])
                    return [null, null, null, t[3]];
                var e = t[0] / 360
                  , i = t[1]
                  , n = t[2]
                  , a = t[3]
                  , s = n <= .5 ? n * (1 + i) : n + i - n * i
                  , o = 2 * n - s;
                return [Math.round(255 * r(o, s, e + 1 / 3)), Math.round(255 * r(o, s, e)), Math.round(255 * r(o, s, e - 1 / 3)), a]
            }
            ,
            p(u, function(e, n) {
                var r = n.props
                  , a = n.cache
                  , o = n.to
                  , u = n.from;
                l.fn[e] = function(e) {
                    if (o && !this[a] && (this[a] = o(this._rgba)),
                    void 0 === e)
                        return this[a].slice();
                    var n, s = t.type(e), h = "array" === s || "object" === s ? e : arguments, c = this[a].slice();
                    return p(r, function(t, e) {
                        var n = h["object" === s ? t : e.idx];
                        null == n && (n = c[e.idx]),
                        c[e.idx] = i(n, e)
                    }),
                    u ? (n = l(u(c)),
                    n[a] = c,
                    n) : l(c)
                }
                ,
                p(r, function(i, n) {
                    l.fn[i] || (l.fn[i] = function(r) {
                        var a, o = t.type(r), l = "alpha" === i ? this._hsla ? "hsla" : "rgba" : e, u = this[l](), h = u[n.idx];
                        return "undefined" === o ? h : ("function" === o && (r = r.call(this, h),
                        o = t.type(r)),
                        null == r && n.empty ? this : ("string" === o && (a = s.exec(r)) && (r = h + parseFloat(a[2]) * ("+" === a[1] ? 1 : -1)),
                        u[n.idx] = r,
                        this[l](u)))
                    }
                    )
                })
            }),
            l.hook = function(e) {
                var i = e.split(" ");
                p(i, function(e, i) {
                    t.cssHooks[i] = {
                        set: function(e, r) {
                            var a, s, o = "";
                            if ("transparent" !== r && ("string" !== t.type(r) || (a = n(r)))) {
                                if (r = l(a || r),
                                !c.rgba && 1 !== r._rgba[3]) {
                                    for (s = "backgroundColor" === i ? e.parentNode : e; ("" === o || "transparent" === o) && s && s.style; )
                                        try {
                                            o = t.css(s, "backgroundColor"),
                                            s = s.parentNode
                                        } catch (t) {}
                                    r = r.blend(o && "transparent" !== o ? o : "_default")
                                }
                                r = r.toRgbaString()
                            }
                            try {
                                e.style[i] = r
                            } catch (t) {}
                        }
                    },
                    t.fx.step[i] = function(e) {
                        e.colorInit || (e.start = l(e.elem, i),
                        e.end = l(e.end),
                        e.colorInit = !0),
                        t.cssHooks[i].set(e.elem, e.start.transition(e.end, e.pos))
                    }
                })
            }
            ,
            l.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),
            t.cssHooks.borderColor = {
                expand: function(t) {
                    var e = {};
                    return p(["Top", "Right", "Bottom", "Left"], function(i, n) {
                        e["border" + n + "Color"] = t
                    }),
                    e
                }
            },
            a = t.Color.names = {
                aqua: "#00ffff",
                black: "#000000",
                blue: "#0000ff",
                fuchsia: "#ff00ff",
                gray: "#808080",
                green: "#008000",
                lime: "#00ff00",
                maroon: "#800000",
                navy: "#000080",
                olive: "#808000",
                purple: "#800080",
                red: "#ff0000",
                silver: "#c0c0c0",
                teal: "#008080",
                white: "#ffffff",
                yellow: "#ffff00",
                transparent: [null, null, null, 0],
                _default: "#ffffff"
            }
        }(n),
        function() {
            function e(e) {
                var i, n, r = e.ownerDocument.defaultView ? e.ownerDocument.defaultView.getComputedStyle(e, null) : e.currentStyle, a = {};
                if (r && r.length && r[0] && r[r[0]])
                    for (n = r.length; n--; )
                        i = r[n],
                        "string" == typeof r[i] && (a[t.camelCase(i)] = r[i]);
                else
                    for (i in r)
                        "string" == typeof r[i] && (a[i] = r[i]);
                return a
            }
            function i(e, i) {
                var n, r, s = {};
                for (n in i)
                    r = i[n],
                    e[n] !== r && (a[n] || !t.fx.step[n] && isNaN(parseFloat(r)) || (s[n] = r));
                return s
            }
            var r = ["add", "remove", "toggle"]
              , a = {
                border: 1,
                borderBottom: 1,
                borderColor: 1,
                borderLeft: 1,
                borderRight: 1,
                borderTop: 1,
                borderWidth: 1,
                margin: 1,
                padding: 1
            };
            t.each(["borderLeftStyle", "borderRightStyle", "borderBottomStyle", "borderTopStyle"], function(e, i) {
                t.fx.step[i] = function(t) {
                    ("none" !== t.end && !t.setAttr || 1 === t.pos && !t.setAttr) && (n.style(t.elem, i, t.end),
                    t.setAttr = !0)
                }
            }),
            t.fn.addBack || (t.fn.addBack = function(t) {
                return this.add(null == t ? this.prevObject : this.prevObject.filter(t))
            }
            ),
            t.effects.animateClass = function(n, a, s, o) {
                var l = t.speed(a, s, o);
                return this.queue(function() {
                    var a, s = t(this), o = s.attr("class") || "", u = l.children ? s.find("*").addBack() : s;
                    u = u.map(function() {
                        return {
                            el: t(this),
                            start: e(this)
                        }
                    }),
                    a = function() {
                        t.each(r, function(t, e) {
                            n[e] && s[e + "Class"](n[e])
                        })
                    }
                    ,
                    a(),
                    u = u.map(function() {
                        return this.end = e(this.el[0]),
                        this.diff = i(this.start, this.end),
                        this
                    }),
                    s.attr("class", o),
                    u = u.map(function() {
                        var e = this
                          , i = t.Deferred()
                          , n = t.extend({}, l, {
                            queue: !1,
                            complete: function() {
                                i.resolve(e)
                            }
                        });
                        return this.el.animate(this.diff, n),
                        i.promise()
                    }),
                    t.when.apply(t, u.get()).done(function() {
                        a(),
                        t.each(arguments, function() {
                            var e = this.el;
                            t.each(this.diff, function(t) {
                                e.css(t, "")
                            })
                        }),
                        l.complete.call(s[0])
                    })
                })
            }
            ,
            t.fn.extend({
                addClass: function(e) {
                    return function(i, n, r, a) {
                        return n ? t.effects.animateClass.call(this, {
                            add: i
                        }, n, r, a) : e.apply(this, arguments)
                    }
                }(t.fn.addClass),
                removeClass: function(e) {
                    return function(i, n, r, a) {
                        return arguments.length > 1 ? t.effects.animateClass.call(this, {
                            remove: i
                        }, n, r, a) : e.apply(this, arguments)
                    }
                }(t.fn.removeClass),
                toggleClass: function(e) {
                    return function(i, n, r, a, s) {
                        return "boolean" == typeof n || void 0 === n ? r ? t.effects.animateClass.call(this, n ? {
                            add: i
                        } : {
                            remove: i
                        }, r, a, s) : e.apply(this, arguments) : t.effects.animateClass.call(this, {
                            toggle: i
                        }, n, r, a)
                    }
                }(t.fn.toggleClass),
                switchClass: function(e, i, n, r, a) {
                    return t.effects.animateClass.call(this, {
                        add: i,
                        remove: e
                    }, n, r, a)
                }
            })
        }(),
        function() {
            function e(e, i, n, r) {
                return t.isPlainObject(e) && (i = e,
                e = e.effect),
                e = {
                    effect: e
                },
                null == i && (i = {}),
                t.isFunction(i) && (r = i,
                n = null,
                i = {}),
                ("number" == typeof i || t.fx.speeds[i]) && (r = n,
                n = i,
                i = {}),
                t.isFunction(n) && (r = n,
                n = null),
                i && t.extend(e, i),
                n = n || i.duration,
                e.duration = t.fx.off ? 0 : "number" == typeof n ? n : n in t.fx.speeds ? t.fx.speeds[n] : t.fx.speeds._default,
                e.complete = r || i.complete,
                e
            }
            function i(e) {
                return !(e && "number" != typeof e && !t.fx.speeds[e]) || ("string" == typeof e && !t.effects.effect[e] || (!!t.isFunction(e) || "object" == typeof e && !e.effect))
            }
            t.extend(t.effects, {
                version: "1.10.3",
                save: function(t, e) {
                    for (var i = 0; i < e.length; i++)
                        null !== e[i] && t.data("ui-effects-" + e[i], t[0].style[e[i]])
                },
                restore: function(t, e) {
                    var i, n;
                    for (n = 0; n < e.length; n++)
                        null !== e[n] && (i = t.data("ui-effects-" + e[n]),
                        void 0 === i && (i = ""),
                        t.css(e[n], i))
                },
                setMode: function(t, e) {
                    return "toggle" === e && (e = t.is(":hidden") ? "show" : "hide"),
                    e
                },
                getBaseline: function(t, e) {
                    var i, n;
                    switch (t[0]) {
                    case "top":
                        i = 0;
                        break;
                    case "middle":
                        i = .5;
                        break;
                    case "bottom":
                        i = 1;
                        break;
                    default:
                        i = t[0] / e.height
                    }
                    switch (t[1]) {
                    case "left":
                        n = 0;
                        break;
                    case "center":
                        n = .5;
                        break;
                    case "right":
                        n = 1;
                        break;
                    default:
                        n = t[1] / e.width
                    }
                    return {
                        x: n,
                        y: i
                    }
                },
                createWrapper: function(e) {
                    if (e.parent().is(".ui-effects-wrapper"))
                        return e.parent();
                    var i = {
                        width: e.outerWidth(!0),
                        height: e.outerHeight(!0),
                        float: e.css("float")
                    }
                      , n = t("<div></div>").addClass("ui-effects-wrapper").css({
                        fontSize: "100%",
                        background: "transparent",
                        border: "none",
                        margin: 0,
                        padding: 0
                    })
                      , r = {
                        width: e.width(),
                        height: e.height()
                    }
                      , a = document.activeElement;
                    try {
                        a.id
                    } catch (t) {
                        a = document.body
                    }
                    return e.wrap(n),
                    (e[0] === a || t.contains(e[0], a)) && t(a).focus(),
                    n = e.parent(),
                    "static" === e.css("position") ? (n.css({
                        position: "relative"
                    }),
                    e.css({
                        position: "relative"
                    })) : (t.extend(i, {
                        position: e.css("position"),
                        zIndex: e.css("z-index")
                    }),
                    t.each(["top", "left", "bottom", "right"], function(t, n) {
                        i[n] = e.css(n),
                        isNaN(parseInt(i[n], 10)) && (i[n] = "auto")
                    }),
                    e.css({
                        position: "relative",
                        top: 0,
                        left: 0,
                        right: "auto",
                        bottom: "auto"
                    })),
                    e.css(r),
                    n.css(i).show()
                },
                removeWrapper: function(e) {
                    var i = document.activeElement;
                    return e.parent().is(".ui-effects-wrapper") && (e.parent().replaceWith(e),
                    (e[0] === i || t.contains(e[0], i)) && t(i).focus()),
                    e
                },
                setTransition: function(e, i, n, r) {
                    return r = r || {},
                    t.each(i, function(t, i) {
                        var a = e.cssUnit(i);
                        a[0] > 0 && (r[i] = a[0] * n + a[1])
                    }),
                    r
                }
            }),
            t.fn.extend({
                effect: function() {
                    function i(e) {
                        function i() {
                            t.isFunction(a) && a.call(r[0]),
                            t.isFunction(e) && e()
                        }
                        var r = t(this)
                          , a = n.complete
                          , o = n.mode;
                        (r.is(":hidden") ? "hide" === o : "show" === o) ? (r[o](),
                        i()) : s.call(r[0], n, i)
                    }
                    var n = e.apply(this, arguments)
                      , r = n.mode
                      , a = n.queue
                      , s = t.effects.effect[n.effect];
                    return t.fx.off || !s ? r ? this[r](n.duration, n.complete) : this.each(function() {
                        n.complete && n.complete.call(this)
                    }) : !1 === a ? this.each(i) : this.queue(a || "fx", i)
                },
                show: function(t) {
                    return function(n) {
                        if (i(n))
                            return t.apply(this, arguments);
                        var r = e.apply(this, arguments);
                        return r.mode = "show",
                        this.effect.call(this, r)
                    }
                }(t.fn.show),
                hide: function(t) {
                    return function(n) {
                        if (i(n))
                            return t.apply(this, arguments);
                        var r = e.apply(this, arguments);
                        return r.mode = "hide",
                        this.effect.call(this, r)
                    }
                }(t.fn.hide),
                toggle: function(t) {
                    return function(n) {
                        if (i(n) || "boolean" == typeof n)
                            return t.apply(this, arguments);
                        var r = e.apply(this, arguments);
                        return r.mode = "toggle",
                        this.effect.call(this, r)
                    }
                }(t.fn.toggle),
                cssUnit: function(e) {
                    var i = this.css(e)
                      , n = [];
                    return t.each(["em", "px", "%", "pt"], function(t, e) {
                        i.indexOf(e) > 0 && (n = [parseFloat(i), e])
                    }),
                    n
                }
            })
        }(),
        function() {
            var e = {};
            t.each(["Quad", "Cubic", "Quart", "Quint", "Expo"], function(t, i) {
                e[i] = function(e) {
                    return Math.pow(e, t + 2)
                }
            }),
            t.extend(e, {
                Sine: function(t) {
                    return 1 - Math.cos(t * Math.PI / 2)
                },
                Circ: function(t) {
                    return 1 - Math.sqrt(1 - t * t)
                },
                Elastic: function(t) {
                    return 0 === t || 1 === t ? t : -Math.pow(2, 8 * (t - 1)) * Math.sin((80 * (t - 1) - 7.5) * Math.PI / 15)
                },
                Back: function(t) {
                    return t * t * (3 * t - 2)
                },
                Bounce: function(t) {
                    for (var e, i = 4; t < ((e = Math.pow(2, --i)) - 1) / 11; )
                        ;
                    return 1 / Math.pow(4, 3 - i) - 7.5625 * Math.pow((3 * e - 2) / 22 - t, 2)
                }
            }),
            t.each(e, function(e, i) {
                t.easing["easeIn" + e] = i,
                t.easing["easeOut" + e] = function(t) {
                    return 1 - i(1 - t)
                }
                ,
                t.easing["easeInOut" + e] = function(t) {
                    return t < .5 ? i(2 * t) / 2 : 1 - i(-2 * t + 2) / 2
                }
            })
        }()
    }(n),
    function(t, e) {
        var i = 0
          , n = {}
          , r = {};
        n.height = n.paddingTop = n.paddingBottom = n.borderTopWidth = n.borderBottomWidth = "hide",
        r.height = r.paddingTop = r.paddingBottom = r.borderTopWidth = r.borderBottomWidth = "show",
        t.widget("ui.accordion", {
            version: "1.10.3",
            options: {
                active: 0,
                animate: {},
                collapsible: !1,
                event: "click",
                header: "> li > :first-child,> :not(li):even",
                heightStyle: "auto",
                icons: {
                    activeHeader: "ui-icon-triangle-1-s",
                    header: "ui-icon-triangle-1-e"
                },
                activate: null,
                beforeActivate: null
            },
            _create: function() {
                var e = this.options;
                this.prevShow = this.prevHide = t(),
                this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role", "tablist"),
                e.collapsible || !1 !== e.active && null != e.active || (e.active = 0),
                this._processPanels(),
                e.active < 0 && (e.active += this.headers.length),
                this._refresh()
            },
            _getCreateEventData: function() {
                return {
                    header: this.active,
                    panel: this.active.length ? this.active.next() : t(),
                    content: this.active.length ? this.active.next() : t()
                }
            },
            _createIcons: function() {
                var e = this.options.icons;
                e && (t("<span>").addClass("ui-accordion-header-icon ui-icon " + e.header).prependTo(this.headers),
                this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),
                this.headers.addClass("ui-accordion-icons"))
            },
            _destroyIcons: function() {
                this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()
            },
            _destroy: function() {
                var t;
                this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),
                this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function() {
                    /^ui-accordion/.test(this.id) && this.removeAttribute("id")
                }),
                this._destroyIcons(),
                t = this.headers.next().css("display", "").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function() {
                    /^ui-accordion/.test(this.id) && this.removeAttribute("id")
                }),
                "content" !== this.options.heightStyle && t.css("height", "")
            },
            _setOption: function(t, e) {
                if ("active" === t)
                    return void this._activate(e);
                "event" === t && (this.options.event && this._off(this.headers, this.options.event),
                this._setupEvents(e)),
                this._super(t, e),
                "collapsible" !== t || e || !1 !== this.options.active || this._activate(0),
                "icons" === t && (this._destroyIcons(),
                e && this._createIcons()),
                "disabled" === t && this.headers.add(this.headers.next()).toggleClass("ui-state-disabled", !!e)
            },
            _keydown: function(e) {
                if (!e.altKey && !e.ctrlKey) {
                    var i = t.ui.keyCode
                      , n = this.headers.length
                      , r = this.headers.index(e.target)
                      , a = !1;
                    switch (e.keyCode) {
                    case i.RIGHT:
                    case i.DOWN:
                        a = this.headers[(r + 1) % n];
                        break;
                    case i.LEFT:
                    case i.UP:
                        a = this.headers[(r - 1 + n) % n];
                        break;
                    case i.SPACE:
                    case i.ENTER:
                        this._eventHandler(e);
                        break;
                    case i.HOME:
                        a = this.headers[0];
                        break;
                    case i.END:
                        a = this.headers[n - 1]
                    }
                    a && (t(e.target).attr("tabIndex", -1),
                    t(a).attr("tabIndex", 0),
                    a.focus(),
                    e.preventDefault())
                }
            },
            _panelKeyDown: function(e) {
                e.keyCode === t.ui.keyCode.UP && e.ctrlKey && t(e.currentTarget).prev().focus()
            },
            refresh: function() {
                var e = this.options;
                this._processPanels(),
                !1 === e.active && !0 === e.collapsible || !this.headers.length ? (e.active = !1,
                this.active = t()) : !1 === e.active ? this._activate(0) : this.active.length && !t.contains(this.element[0], this.active[0]) ? this.headers.length === this.headers.find(".ui-state-disabled").length ? (e.active = !1,
                this.active = t()) : this._activate(Math.max(0, e.active - 1)) : e.active = this.headers.index(this.active),
                this._destroyIcons(),
                this._refresh()
            },
            _processPanels: function() {
                this.headers = this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),
                this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()
            },
            _refresh: function() {
                var e, n = this.options, r = n.heightStyle, a = this.element.parent(), s = this.accordionId = "ui-accordion-" + (this.element.attr("id") || ++i);
                this.active = this._findActive(n.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),
                this.active.next().addClass("ui-accordion-content-active").show(),
                this.headers.attr("role", "tab").each(function(e) {
                    var i = t(this)
                      , n = i.attr("id")
                      , r = i.next()
                      , a = r.attr("id");
                    n || (n = s + "-header-" + e,
                    i.attr("id", n)),
                    a || (a = s + "-panel-" + e,
                    r.attr("id", a)),
                    i.attr("aria-controls", a),
                    r.attr("aria-labelledby", n)
                }).next().attr("role", "tabpanel"),
                this.headers.not(this.active).attr({
                    "aria-selected": "false",
                    tabIndex: -1
                }).next().attr({
                    "aria-expanded": "false",
                    "aria-hidden": "true"
                }).hide(),
                this.active.length ? this.active.attr({
                    "aria-selected": "true",
                    tabIndex: 0
                }).next().attr({
                    "aria-expanded": "true",
                    "aria-hidden": "false"
                }) : this.headers.eq(0).attr("tabIndex", 0),
                this._createIcons(),
                this._setupEvents(n.event),
                "fill" === r ? (e = a.height(),
                this.element.siblings(":visible").each(function() {
                    var i = t(this)
                      , n = i.css("position");
                    "absolute" !== n && "fixed" !== n && (e -= i.outerHeight(!0))
                }),
                this.headers.each(function() {
                    e -= t(this).outerHeight(!0)
                }),
                this.headers.next().each(function() {
                    t(this).height(Math.max(0, e - t(this).innerHeight() + t(this).height()))
                }).css("overflow", "auto")) : "auto" === r && (e = 0,
                this.headers.next().each(function() {
                    e = Math.max(e, t(this).css("height", "").height())
                }).height(e))
            },
            _activate: function(e) {
                var i = this._findActive(e)[0];
                i !== this.active[0] && (i = i || this.active[0],
                this._eventHandler({
                    target: i,
                    currentTarget: i,
                    preventDefault: t.noop
                }))
            },
            _findActive: function(e) {
                return "number" == typeof e ? this.headers.eq(e) : t()
            },
            _setupEvents: function(e) {
                var i = {
                    keydown: "_keydown"
                };
                e && t.each(e.split(" "), function(t, e) {
                    i[e] = "_eventHandler"
                }),
                this._off(this.headers.add(this.headers.next())),
                this._on(this.headers, i),
                this._on(this.headers.next(), {
                    keydown: "_panelKeyDown"
                }),
                this._hoverable(this.headers),
                this._focusable(this.headers)
            },
            _eventHandler: function(e) {
                var i = this.options
                  , n = this.active
                  , r = t(e.currentTarget)
                  , a = r[0] === n[0]
                  , s = a && i.collapsible
                  , o = s ? t() : r.next()
                  , l = n.next()
                  , u = {
                    oldHeader: n,
                    oldPanel: l,
                    newHeader: s ? t() : r,
                    newPanel: o
                };
                e.preventDefault(),
                a && !i.collapsible || !1 === this._trigger("beforeActivate", e, u) || (i.active = !s && this.headers.index(r),
                this.active = a ? t() : r,
                this._toggle(u),
                n.removeClass("ui-accordion-header-active ui-state-active"),
                i.icons && n.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),
                a || (r.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),
                i.icons && r.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),
                r.next().addClass("ui-accordion-content-active")))
            },
            _toggle: function(e) {
                var i = e.newPanel
                  , n = this.prevShow.length ? this.prevShow : e.oldPanel;
                this.prevShow.add(this.prevHide).stop(!0, !0),
                this.prevShow = i,
                this.prevHide = n,
                this.options.animate ? this._animate(i, n, e) : (n.hide(),
                i.show(),
                this._toggleComplete(e)),
                n.attr({
                    "aria-expanded": "false",
                    "aria-hidden": "true"
                }),
                n.prev().attr("aria-selected", "false"),
                i.length && n.length ? n.prev().attr("tabIndex", -1) : i.length && this.headers.filter(function() {
                    return 0 === t(this).attr("tabIndex")
                }).attr("tabIndex", -1),
                i.attr({
                    "aria-expanded": "true",
                    "aria-hidden": "false"
                }).prev().attr({
                    "aria-selected": "true",
                    tabIndex: 0
                })
            },
            _animate: function(t, e, i) {
                var a, s, o, l = this, u = 0, h = t.length && (!e.length || t.index() < e.index()), c = this.options.animate || {}, d = h && c.down || c, p = function() {
                    l._toggleComplete(i)
                };
                return "number" == typeof d && (o = d),
                "string" == typeof d && (s = d),
                s = s || d.easing || c.easing,
                o = o || d.duration || c.duration,
                e.length ? t.length ? (a = t.show().outerHeight(),
                e.animate(n, {
                    duration: o,
                    easing: s,
                    step: function(t, e) {
                        e.now = Math.round(t)
                    }
                }),
                void t.hide().animate(r, {
                    duration: o,
                    easing: s,
                    complete: p,
                    step: function(t, i) {
                        i.now = Math.round(t),
                        "height" !== i.prop ? u += i.now : "content" !== l.options.heightStyle && (i.now = Math.round(a - e.outerHeight() - u),
                        u = 0)
                    }
                })) : e.animate(n, o, s, p) : t.animate(r, o, s, p)
            },
            _toggleComplete: function(t) {
                var e = t.oldPanel;
                e.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),
                e.length && (e.parent()[0].className = e.parent()[0].className),
                this._trigger("activate", null, t)
            }
        })
    }(n),
    function(t, e) {
        var i = 0;
        t.widget("ui.autocomplete", {
            version: "1.10.3",
            defaultElement: "<input>",
            options: {
                appendTo: null,
                autoFocus: !1,
                delay: 300,
                minLength: 1,
                position: {
                    my: "left top",
                    at: "left bottom",
                    collision: "none"
                },
                source: null,
                change: null,
                close: null,
                focus: null,
                open: null,
                response: null,
                search: null,
                select: null
            },
            pending: 0,
            _create: function() {
                var e, i, n, r = this.element[0].nodeName.toLowerCase(), a = "textarea" === r, s = "input" === r;
                this.isMultiLine = !!a || !s && this.element.prop("isContentEditable"),
                this.valueMethod = this.element[a || s ? "val" : "text"],
                this.isNewMenu = !0,
                this.element.addClass("ui-autocomplete-input").attr("autocomplete", "off"),
                this._on(this.element, {
                    keydown: function(r) {
                        if (this.element.prop("readOnly"))
                            return e = !0,
                            n = !0,
                            void (i = !0);
                        e = !1,
                        n = !1,
                        i = !1;
                        var a = t.ui.keyCode;
                        switch (r.keyCode) {
                        case a.PAGE_UP:
                            e = !0,
                            this._move("previousPage", r);
                            break;
                        case a.PAGE_DOWN:
                            e = !0,
                            this._move("nextPage", r);
                            break;
                        case a.UP:
                            e = !0,
                            this._keyEvent("previous", r);
                            break;
                        case a.DOWN:
                            e = !0,
                            this._keyEvent("next", r);
                            break;
                        case a.ENTER:
                        case a.NUMPAD_ENTER:
                            this.menu.active && (e = !0,
                            r.preventDefault(),
                            this.menu.select(r));
                            break;
                        case a.TAB:
                            this.menu.active && this.menu.select(r);
                            break;
                        case a.ESCAPE:
                            this.menu.element.is(":visible") && (this._value(this.term),
                            this.close(r),
                            r.preventDefault());
                            break;
                        default:
                            i = !0,
                            this._searchTimeout(r)
                        }
                    },
                    keypress: function(n) {
                        if (e)
                            return e = !1,
                            void (this.isMultiLine && !this.menu.element.is(":visible") || n.preventDefault());
                        if (!i) {
                            var r = t.ui.keyCode;
                            switch (n.keyCode) {
                            case r.PAGE_UP:
                                this._move("previousPage", n);
                                break;
                            case r.PAGE_DOWN:
                                this._move("nextPage", n);
                                break;
                            case r.UP:
                                this._keyEvent("previous", n);
                                break;
                            case r.DOWN:
                                this._keyEvent("next", n)
                            }
                        }
                    },
                    input: function(t) {
                        if (n)
                            return n = !1,
                            void t.preventDefault();
                        this._searchTimeout(t)
                    },
                    focus: function() {
                        this.selectedItem = null,
                        this.previous = this._value()
                    },
                    blur: function(t) {
                        if (this.cancelBlur)
                            return void delete this.cancelBlur;
                        clearTimeout(this.searching),
                        this.close(t),
                        this._change(t)
                    }
                }),
                this._initSource(),
                this.menu = t("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({
                    role: null
                }).hide().data("ui-menu"),
                this._on(this.menu.element, {
                    mousedown: function(e) {
                        e.preventDefault(),
                        this.cancelBlur = !0,
                        this._delay(function() {
                            delete this.cancelBlur
                        });
                        var i = this.menu.element[0];
                        t(e.target).closest(".ui-menu-item").length || this._delay(function() {
                            var e = this;
                            this.document.one("mousedown", function(n) {
                                n.target === e.element[0] || n.target === i || t.contains(i, n.target) || e.close()
                            })
                        })
                    },
                    menufocus: function(e, i) {
                        if (this.isNewMenu && (this.isNewMenu = !1,
                        e.originalEvent && /^mouse/.test(e.originalEvent.type)))
                            return this.menu.blur(),
                            void this.document.one("mousemove", function() {
                                t(e.target).trigger(e.originalEvent)
                            });
                        var n = i.item.data("ui-autocomplete-item");
                        !1 !== this._trigger("focus", e, {
                            item: n
                        }) ? e.originalEvent && /^key/.test(e.originalEvent.type) && this._value(n.value) : this.liveRegion.text(n.value)
                    },
                    menuselect: function(t, e) {
                        var i = e.item.data("ui-autocomplete-item")
                          , n = this.previous;
                        this.element[0] !== this.document[0].activeElement && (this.element.focus(),
                        this.previous = n,
                        this._delay(function() {
                            this.previous = n,
                            this.selectedItem = i
                        })),
                        !1 !== this._trigger("select", t, {
                            item: i
                        }) && this._value(i.value),
                        this.term = this._value(),
                        this.close(t),
                        this.selectedItem = i
                    }
                }),
                this.liveRegion = t("<span>", {
                    role: "status",
                    "aria-live": "polite"
                }).addClass("ui-helper-hidden-accessible").insertBefore(this.element),
                this._on(this.window, {
                    beforeunload: function() {
                        this.element.removeAttr("autocomplete")
                    }
                })
            },
            _destroy: function() {
                clearTimeout(this.searching),
                this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),
                this.menu.element.remove(),
                this.liveRegion.remove()
            },
            _setOption: function(t, e) {
                this._super(t, e),
                "source" === t && this._initSource(),
                "appendTo" === t && this.menu.element.appendTo(this._appendTo()),
                "disabled" === t && e && this.xhr && this.xhr.abort()
            },
            _appendTo: function() {
                var e = this.options.appendTo;
                return e && (e = e.jquery || e.nodeType ? t(e) : this.document.find(e).eq(0)),
                e || (e = this.element.closest(".ui-front")),
                e.length || (e = this.document[0].body),
                e
            },
            _initSource: function() {
                var e, i, n = this;
                t.isArray(this.options.source) ? (e = this.options.source,
                this.source = function(i, n) {
                    n(t.ui.autocomplete.filter(e, i.term))
                }
                ) : "string" == typeof this.options.source ? (i = this.options.source,
                this.source = function(e, r) {
                    n.xhr && n.xhr.abort(),
                    n.xhr = t.ajax({
                        url: i,
                        data: e,
                        dataType: "json",
                        success: function(t) {
                            r(t)
                        },
                        error: function() {
                            r([])
                        }
                    })
                }
                ) : this.source = this.options.source
            },
            _searchTimeout: function(t) {
                clearTimeout(this.searching),
                this.searching = this._delay(function() {
                    this.term !== this._value() && (this.selectedItem = null,
                    this.search(null, t))
                }, this.options.delay)
            },
            search: function(t, e) {
                return t = null != t ? t : this._value(),
                this.term = this._value(),
                t.length < this.options.minLength ? this.close(e) : !1 !== this._trigger("search", e) ? this._search(t) : void 0
            },
            _search: function(t) {
                this.pending++,
                this.element.addClass("ui-autocomplete-loading"),
                this.cancelSearch = !1,
                this.source({
                    term: t
                }, this._response())
            },
            _response: function() {
                var t = this
                  , e = ++i;
                return function(n) {
                    e === i && t.__response(n),
                    --t.pending || t.element.removeClass("ui-autocomplete-loading")
                }
            },
            __response: function(t) {
                t && (t = this._normalize(t)),
                this._trigger("response", null, {
                    content: t
                }),
                !this.options.disabled && t && t.length && !this.cancelSearch ? (this._suggest(t),
                this._trigger("open")) : this._close()
            },
            close: function(t) {
                this.cancelSearch = !0,
                this._close(t)
            },
            _close: function(t) {
                this.menu.element.is(":visible") && (this.menu.element.hide(),
                this.menu.blur(),
                this.isNewMenu = !0,
                this._trigger("close", t))
            },
            _change: function(t) {
                this.previous !== this._value() && this._trigger("change", t, {
                    item: this.selectedItem
                })
            },
            _normalize: function(e) {
                return e.length && e[0].label && e[0].value ? e : t.map(e, function(e) {
                    return "string" == typeof e ? {
                        label: e,
                        value: e
                    } : t.extend({
                        label: e.label || e.value,
                        value: e.value || e.label
                    }, e)
                })
            },
            _suggest: function(e) {
                var i = this.menu.element.empty();
                this._renderMenu(i, e),
                this.isNewMenu = !0,
                this.menu.refresh(),
                i.show(),
                this._resizeMenu(),
                i.position(t.extend({
                    of: this.element
                }, this.options.position)),
                this.options.autoFocus && this.menu.next()
            },
            _resizeMenu: function() {
                var t = this.menu.element;
                t.outerWidth(Math.max(t.width("").outerWidth() + 1, this.element.outerWidth()))
            },
            _renderMenu: function(e, i) {
                var n = this;
                t.each(i, function(t, i) {
                    n._renderItemData(e, i)
                })
            },
            _renderItemData: function(t, e) {
                return this._renderItem(t, e).data("ui-autocomplete-item", e)
            },
            _renderItem: function(e, i) {
                return t("<li>").append(t("<a>").text(i.label)).appendTo(e)
            },
            _move: function(t, e) {
                return this.menu.element.is(":visible") ? this.menu.isFirstItem() && /^previous/.test(t) || this.menu.isLastItem() && /^next/.test(t) ? (this._value(this.term),
                void this.menu.blur()) : void this.menu[t](e) : void this.search(null, e)
            },
            widget: function() {
                return this.menu.element
            },
            _value: function() {
                return this.valueMethod.apply(this.element, arguments)
            },
            _keyEvent: function(t, e) {
                this.isMultiLine && !this.menu.element.is(":visible") || (this._move(t, e),
                e.preventDefault())
            }
        }),
        t.extend(t.ui.autocomplete, {
            escapeRegex: function(t) {
                return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
            },
            filter: function(e, i) {
                var n = new RegExp(t.ui.autocomplete.escapeRegex(i),"i");
                return t.grep(e, function(t) {
                    return n.test(t.label || t.value || t)
                })
            }
        }),
        t.widget("ui.autocomplete", t.ui.autocomplete, {
            options: {
                messages: {
                    noResults: "No search results.",
                    results: function(t) {
                        return t + (t > 1 ? " results are" : " result is") + " available, use up and down arrow keys to navigate."
                    }
                }
            },
            __response: function(t) {
                var e;
                this._superApply(arguments),
                this.options.disabled || this.cancelSearch || (e = t && t.length ? this.options.messages.results(t.length) : this.options.messages.noResults,
                this.liveRegion.text(e))
            }
        })
    }(n),
    function(t, e) {
        var i, n, r, a, s = "ui-button ui-widget ui-state-default ui-corner-all", o = "ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only", l = function() {
            var e = t(this);
            setTimeout(function() {
                e.find(":ui-button").button("refresh")
            }, 1)
        }, u = function(e) {
            var i = e.name
              , n = e.form
              , r = t([]);
            return i && (i = i.replace(/'/g, "\\'"),
            r = n ? t(n).find("[name='" + i + "']") : t("[name='" + i + "']", e.ownerDocument).filter(function() {
                return !this.form
            })),
            r
        };
        t.widget("ui.button", {
            version: "1.10.3",
            defaultElement: "<button>",
            options: {
                disabled: null,
                text: !0,
                label: null,
                icons: {
                    primary: null,
                    secondary: null
                }
            },
            _create: function() {
                this.element.closest("form").unbind("reset" + this.eventNamespace).bind("reset" + this.eventNamespace, l),
                "boolean" != typeof this.options.disabled ? this.options.disabled = !!this.element.prop("disabled") : this.element.prop("disabled", this.options.disabled),
                this._determineButtonType(),
                this.hasTitle = !!this.buttonElement.attr("title");
                var e = this
                  , o = this.options
                  , h = "checkbox" === this.type || "radio" === this.type
                  , c = h ? "" : "ui-state-active";
                null === o.label && (o.label = "input" === this.type ? this.buttonElement.val() : this.buttonElement.html()),
                this._hoverable(this.buttonElement),
                this.buttonElement.addClass(s).attr("role", "button").bind("mouseenter" + this.eventNamespace, function() {
                    o.disabled || this === i && t(this).addClass("ui-state-active")
                }).bind("mouseleave" + this.eventNamespace, function() {
                    o.disabled || t(this).removeClass(c)
                }).bind("click" + this.eventNamespace, function(t) {
                    o.disabled && (t.preventDefault(),
                    t.stopImmediatePropagation())
                }),
                this.element.bind("focus" + this.eventNamespace, function() {
                    e.buttonElement.addClass("ui-state-focus")
                }).bind("blur" + this.eventNamespace, function() {
                    e.buttonElement.removeClass("ui-state-focus")
                }),
                h && (this.element.bind("change" + this.eventNamespace, function() {
                    a || e.refresh()
                }),
                this.buttonElement.bind("mousedown" + this.eventNamespace, function(t) {
                    o.disabled || (a = !1,
                    n = t.pageX,
                    r = t.pageY)
                }).bind("mouseup" + this.eventNamespace, function(t) {
                    o.disabled || n === t.pageX && r === t.pageY || (a = !0)
                })),
                "checkbox" === this.type ? this.buttonElement.bind("click" + this.eventNamespace, function() {
                    if (o.disabled || a)
                        return !1
                }) : "radio" === this.type ? this.buttonElement.bind("click" + this.eventNamespace, function() {
                    if (o.disabled || a)
                        return !1;
                    t(this).addClass("ui-state-active"),
                    e.buttonElement.attr("aria-pressed", "true");
                    var i = e.element[0];
                    u(i).not(i).map(function() {
                        return t(this).button("widget")[0]
                    }).removeClass("ui-state-active").attr("aria-pressed", "false")
                }) : (this.buttonElement.bind("mousedown" + this.eventNamespace, function() {
                    if (o.disabled)
                        return !1;
                    t(this).addClass("ui-state-active"),
                    i = this,
                    e.document.one("mouseup", function() {
                        i = null
                    })
                }).bind("mouseup" + this.eventNamespace, function() {
                    if (o.disabled)
                        return !1;
                    t(this).removeClass("ui-state-active")
                }).bind("keydown" + this.eventNamespace, function(e) {
                    if (o.disabled)
                        return !1;
                    e.keyCode !== t.ui.keyCode.SPACE && e.keyCode !== t.ui.keyCode.ENTER || t(this).addClass("ui-state-active")
                }).bind("keyup" + this.eventNamespace + " blur" + this.eventNamespace, function() {
                    t(this).removeClass("ui-state-active")
                }),
                this.buttonElement.is("a") && this.buttonElement.keyup(function(e) {
                    e.keyCode === t.ui.keyCode.SPACE && t(this).click()
                })),
                this._setOption("disabled", o.disabled),
                this._resetButton()
            },
            _determineButtonType: function() {
                var t, e, i;
                this.element.is("[type=checkbox]") ? this.type = "checkbox" : this.element.is("[type=radio]") ? this.type = "radio" : this.element.is("input") ? this.type = "input" : this.type = "button",
                "checkbox" === this.type || "radio" === this.type ? (t = this.element.parents().last(),
                e = "label[for='" + this.element.attr("id") + "']",
                this.buttonElement = t.find(e),
                this.buttonElement.length || (t = t.length ? t.siblings() : this.element.siblings(),
                this.buttonElement = t.filter(e),
                this.buttonElement.length || (this.buttonElement = t.find(e))),
                this.element.addClass("ui-helper-hidden-accessible"),
                i = this.element.is(":checked"),
                i && this.buttonElement.addClass("ui-state-active"),
                this.buttonElement.prop("aria-pressed", i)) : this.buttonElement = this.element
            },
            widget: function() {
                return this.buttonElement
            },
            _destroy: function() {
                this.element.removeClass("ui-helper-hidden-accessible"),
                this.buttonElement.removeClass(s + " ui-state-hover ui-state-active  " + o).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),
                this.hasTitle || this.buttonElement.removeAttr("title")
            },
            _setOption: function(t, e) {
                if (this._super(t, e),
                "disabled" === t)
                    return void (e ? this.element.prop("disabled", !0) : this.element.prop("disabled", !1));
                this._resetButton()
            },
            refresh: function() {
                var e = this.element.is("input, button") ? this.element.is(":disabled") : this.element.hasClass("ui-button-disabled");
                e !== this.options.disabled && this._setOption("disabled", e),
                "radio" === this.type ? u(this.element[0]).each(function() {
                    t(this).is(":checked") ? t(this).button("widget").addClass("ui-state-active").attr("aria-pressed", "true") : t(this).button("widget").removeClass("ui-state-active").attr("aria-pressed", "false")
                }) : "checkbox" === this.type && (this.element.is(":checked") ? this.buttonElement.addClass("ui-state-active").attr("aria-pressed", "true") : this.buttonElement.removeClass("ui-state-active").attr("aria-pressed", "false"))
            },
            _resetButton: function() {
                if ("input" === this.type)
                    return void (this.options.label && this.element.val(this.options.label));
                var e = this.buttonElement.removeClass(o)
                  , i = t("<span></span>", this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text()
                  , n = this.options.icons
                  , r = n.primary && n.secondary
                  , a = [];
                n.primary || n.secondary ? (this.options.text && a.push("ui-button-text-icon" + (r ? "s" : n.primary ? "-primary" : "-secondary")),
                n.primary && e.prepend("<span class='ui-button-icon-primary ui-icon " + n.primary + "'></span>"),
                n.secondary && e.append("<span class='ui-button-icon-secondary ui-icon " + n.secondary + "'></span>"),
                this.options.text || (a.push(r ? "ui-button-icons-only" : "ui-button-icon-only"),
                this.hasTitle || e.attr("title", t.trim(i)))) : a.push("ui-button-text-only"),
                e.addClass(a.join(" "))
            }
        }),
        t.widget("ui.buttonset", {
            version: "1.10.3",
            options: {
                items: "button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"
            },
            _create: function() {
                this.element.addClass("ui-buttonset")
            },
            _init: function() {
                this.refresh()
            },
            _setOption: function(t, e) {
                "disabled" === t && this.buttons.button("option", t, e),
                this._super(t, e)
            },
            refresh: function() {
                var e = "rtl" === this.element.css("direction");
                this.buttons = this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function() {
                    return t(this).button("widget")[0]
                }).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e ? "ui-corner-right" : "ui-corner-left").end().filter(":last").addClass(e ? "ui-corner-left" : "ui-corner-right").end().end()
            },
            _destroy: function() {
                this.element.removeClass("ui-buttonset"),
                this.buttons.map(function() {
                    return t(this).button("widget")[0]
                }).removeClass("ui-corner-left ui-corner-right").end().button("destroy")
            }
        })
    }(n),
    function(t, e) {
        function i() {
            this._curInst = null,
            this._keyEvent = !1,
            this._disabledInputs = [],
            this._datepickerShowing = !1,
            this._inDialog = !1,
            this._mainDivId = "ui-datepicker-div",
            this._inlineClass = "ui-datepicker-inline",
            this._appendClass = "ui-datepicker-append",
            this._triggerClass = "ui-datepicker-trigger",
            this._dialogClass = "ui-datepicker-dialog",
            this._disableClass = "ui-datepicker-disabled",
            this._unselectableClass = "ui-datepicker-unselectable",
            this._currentClass = "ui-datepicker-current-day",
            this._dayOverClass = "ui-datepicker-days-cell-over",
            this.regional = [],
            this.regional[""] = {
                closeText: "Done",
                prevText: "Prev",
                nextText: "Next",
                currentText: "Today",
                monthNames: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
                monthNamesShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                dayNames: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
                dayNamesShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
                dayNamesMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"],
                weekHeader: "Wk",
                dateFormat: "mm/dd/yy",
                firstDay: 0,
                isRTL: !1,
                showMonthAfterYear: !1,
                yearSuffix: ""
            },
            this._defaults = {
                showOn: "focus",
                showAnim: "fadeIn",
                showOptions: {},
                defaultDate: null,
                appendText: "",
                buttonText: "...",
                buttonImage: "",
                buttonImageOnly: !1,
                hideIfNoPrevNext: !1,
                navigationAsDateFormat: !1,
                gotoCurrent: !1,
                changeMonth: !1,
                changeYear: !1,
                yearRange: "c-10:c+10",
                showOtherMonths: !1,
                selectOtherMonths: !1,
                showWeek: !1,
                calculateWeek: this.iso8601Week,
                shortYearCutoff: "+10",
                minDate: null,
                maxDate: null,
                duration: "fast",
                beforeShowDay: null,
                beforeShow: null,
                onSelect: null,
                onChangeMonthYear: null,
                onClose: null,
                numberOfMonths: 1,
                showCurrentAtPos: 0,
                stepMonths: 1,
                stepBigMonths: 12,
                altField: "",
                altFormat: "",
                constrainInput: !0,
                showButtonPanel: !1,
                autoSize: !1,
                disabled: !1
            },
            t.extend(this._defaults, this.regional[""]),
            this.dpDiv = n(t("<div id='" + this._mainDivId + "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))
        }
        function n(e) {
            var i = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
            return e.delegate(i, "mouseout", function() {
                t(this).removeClass("ui-state-hover"),
                -1 !== this.className.indexOf("ui-datepicker-prev") && t(this).removeClass("ui-datepicker-prev-hover"),
                -1 !== this.className.indexOf("ui-datepicker-next") && t(this).removeClass("ui-datepicker-next-hover")
            }).delegate(i, "mouseover", function() {
                t.datepicker._isDisabledDatepicker(a.inline ? e.parent()[0] : a.input[0]) || (t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),
                t(this).addClass("ui-state-hover"),
                -1 !== this.className.indexOf("ui-datepicker-prev") && t(this).addClass("ui-datepicker-prev-hover"),
                -1 !== this.className.indexOf("ui-datepicker-next") && t(this).addClass("ui-datepicker-next-hover"))
            })
        }
        function r(e, i) {
            t.extend(e, i);
            for (var n in i)
                null == i[n] && (e[n] = i[n]);
            return e
        }
        t.extend(t.ui, {
            datepicker: {
                version: "1.10.3"
            }
        });
        var a, s = "datepicker";
        t.extend(i.prototype, {
            markerClassName: "hasDatepicker",
            maxRows: 4,
            _widgetDatepicker: function() {
                return this.dpDiv
            },
            setDefaults: function(t) {
                return r(this._defaults, t || {}),
                this
            },
            _attachDatepicker: function(e, i) {
                var n, r, a;
                n = e.nodeName.toLowerCase(),
                r = "div" === n || "span" === n,
                e.id || (this.uuid += 1,
                e.id = "dp" + this.uuid),
                a = this._newInst(t(e), r),
                a.settings = t.extend({}, i || {}),
                "input" === n ? this._connectDatepicker(e, a) : r && this._inlineDatepicker(e, a)
            },
            _newInst: function(e, i) {
                return {
                    id: e[0].id.replace(/([^A-Za-z0-9_\-])/g, "\\\\$1"),
                    input: e,
                    selectedDay: 0,
                    selectedMonth: 0,
                    selectedYear: 0,
                    drawMonth: 0,
                    drawYear: 0,
                    inline: i,
                    dpDiv: i ? n(t("<div class='" + this._inlineClass + " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")) : this.dpDiv
                }
            },
            _connectDatepicker: function(e, i) {
                var n = t(e);
                i.append = t([]),
                i.trigger = t([]),
                n.hasClass(this.markerClassName) || (this._attachments(n, i),
                n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),
                this._autoSize(i),
                t.data(e, s, i),
                i.settings.disabled && this._disableDatepicker(e))
            },
            _attachments: function(e, i) {
                var n, r, a, s = this._get(i, "appendText"), o = this._get(i, "isRTL");
                i.append && i.append.remove(),
                s && (i.append = t("<span class='" + this._appendClass + "'>" + s + "</span>"),
                e[o ? "before" : "after"](i.append)),
                e.unbind("focus", this._showDatepicker),
                i.trigger && i.trigger.remove(),
                n = this._get(i, "showOn"),
                "focus" !== n && "both" !== n || e.focus(this._showDatepicker),
                "button" !== n && "both" !== n || (r = this._get(i, "buttonText"),
                a = this._get(i, "buttonImage"),
                i.trigger = t(this._get(i, "buttonImageOnly") ? t("<img/>").addClass(this._triggerClass).attr({
                    src: a,
                    alt: r,
                    title: r
                }) : t("<button type='button'></button>").addClass(this._triggerClass).html(a ? t("<img/>").attr({
                    src: a,
                    alt: r,
                    title: r
                }) : r)),
                e[o ? "before" : "after"](i.trigger),
                i.trigger.click(function() {
                    return t.datepicker._datepickerShowing && t.datepicker._lastInput === e[0] ? t.datepicker._hideDatepicker() : t.datepicker._datepickerShowing && t.datepicker._lastInput !== e[0] ? (t.datepicker._hideDatepicker(),
                    t.datepicker._showDatepicker(e[0])) : t.datepicker._showDatepicker(e[0]),
                    !1
                }))
            },
            _autoSize: function(t) {
                if (this._get(t, "autoSize") && !t.inline) {
                    var e, i, n, r, a = new Date(2009,11,20), s = this._get(t, "dateFormat");
                    s.match(/[DM]/) && (e = function(t) {
                        for (i = 0,
                        n = 0,
                        r = 0; r < t.length; r++)
                            t[r].length > i && (i = t[r].length,
                            n = r);
                        return n
                    }
                    ,
                    a.setMonth(e(this._get(t, s.match(/MM/) ? "monthNames" : "monthNamesShort"))),
                    a.setDate(e(this._get(t, s.match(/DD/) ? "dayNames" : "dayNamesShort")) + 20 - a.getDay())),
                    t.input.attr("size", this._formatDate(t, a).length)
                }
            },
            _inlineDatepicker: function(e, i) {
                var n = t(e);
                n.hasClass(this.markerClassName) || (n.addClass(this.markerClassName).append(i.dpDiv),
                t.data(e, s, i),
                this._setDate(i, this._getDefaultDate(i), !0),
                this._updateDatepicker(i),
                this._updateAlternate(i),
                i.settings.disabled && this._disableDatepicker(e),
                i.dpDiv.css("display", "block"))
            },
            _dialogDatepicker: function(e, i, n, a, o) {
                var l, u, h, c, d, p = this._dialogInst;
                return p || (this.uuid += 1,
                l = "dp" + this.uuid,
                this._dialogInput = t("<input type='text' id='" + l + "' style='position: absolute; top: -100px; width: 0px;'/>"),
                this._dialogInput.keydown(this._doKeyDown),
                t("body").append(this._dialogInput),
                p = this._dialogInst = this._newInst(this._dialogInput, !1),
                p.settings = {},
                t.data(this._dialogInput[0], s, p)),
                r(p.settings, a || {}),
                i = i && i.constructor === Date ? this._formatDate(p, i) : i,
                this._dialogInput.val(i),
                this._pos = o ? o.length ? o : [o.pageX, o.pageY] : null,
                this._pos || (u = document.documentElement.clientWidth,
                h = document.documentElement.clientHeight,
                c = document.documentElement.scrollLeft || document.body.scrollLeft,
                d = document.documentElement.scrollTop || document.body.scrollTop,
                this._pos = [u / 2 - 100 + c, h / 2 - 150 + d]),
                this._dialogInput.css("left", this._pos[0] + 20 + "px").css("top", this._pos[1] + "px"),
                p.settings.onSelect = n,
                this._inDialog = !0,
                this.dpDiv.addClass(this._dialogClass),
                this._showDatepicker(this._dialogInput[0]),
                t.blockUI && t.blockUI(this.dpDiv),
                t.data(this._dialogInput[0], s, p),
                this
            },
            _destroyDatepicker: function(e) {
                var i, n = t(e), r = t.data(e, s);
                n.hasClass(this.markerClassName) && (i = e.nodeName.toLowerCase(),
                t.removeData(e, s),
                "input" === i ? (r.append.remove(),
                r.trigger.remove(),
                n.removeClass(this.markerClassName).unbind("focus", this._showDatepicker).unbind("keydown", this._doKeyDown).unbind("keypress", this._doKeyPress).unbind("keyup", this._doKeyUp)) : "div" !== i && "span" !== i || n.removeClass(this.markerClassName).empty())
            },
            _enableDatepicker: function(e) {
                var i, n, r = t(e), a = t.data(e, s);
                r.hasClass(this.markerClassName) && (i = e.nodeName.toLowerCase(),
                "input" === i ? (e.disabled = !1,
                a.trigger.filter("button").each(function() {
                    this.disabled = !1
                }).end().filter("img").css({
                    opacity: "1.0",
                    cursor: ""
                })) : "div" !== i && "span" !== i || (n = r.children("." + this._inlineClass),
                n.children().removeClass("ui-state-disabled"),
                n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", !1)),
                this._disabledInputs = t.map(this._disabledInputs, function(t) {
                    return t === e ? null : t
                }))
            },
            _disableDatepicker: function(e) {
                var i, n, r = t(e), a = t.data(e, s);
                r.hasClass(this.markerClassName) && (i = e.nodeName.toLowerCase(),
                "input" === i ? (e.disabled = !0,
                a.trigger.filter("button").each(function() {
                    this.disabled = !0
                }).end().filter("img").css({
                    opacity: "0.5",
                    cursor: "default"
                })) : "div" !== i && "span" !== i || (n = r.children("." + this._inlineClass),
                n.children().addClass("ui-state-disabled"),
                n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", !0)),
                this._disabledInputs = t.map(this._disabledInputs, function(t) {
                    return t === e ? null : t
                }),
                this._disabledInputs[this._disabledInputs.length] = e)
            },
            _isDisabledDatepicker: function(t) {
                if (!t)
                    return !1;
                for (var e = 0; e < this._disabledInputs.length; e++)
                    if (this._disabledInputs[e] === t)
                        return !0;
                return !1
            },
            _getInst: function(e) {
                try {
                    return t.data(e, s)
                } catch (t) {
                    throw "Missing instance data for this datepicker"
                }
            },
            _optionDatepicker: function(e, i, n) {
                var a, s, o, l, u = this._getInst(e);
                if (2 === arguments.length && "string" == typeof i)
                    return "defaults" === i ? t.extend({}, t.datepicker._defaults) : u ? "all" === i ? t.extend({}, u.settings) : this._get(u, i) : null;
                a = i || {},
                "string" == typeof i && (a = {},
                a[i] = n),
                u && (this._curInst === u && this._hideDatepicker(),
                s = this._getDateDatepicker(e, !0),
                o = this._getMinMaxDate(u, "min"),
                l = this._getMinMaxDate(u, "max"),
                r(u.settings, a),
                null !== o && void 0 !== a.dateFormat && void 0 === a.minDate && (u.settings.minDate = this._formatDate(u, o)),
                null !== l && void 0 !== a.dateFormat && void 0 === a.maxDate && (u.settings.maxDate = this._formatDate(u, l)),
                "disabled"in a && (a.disabled ? this._disableDatepicker(e) : this._enableDatepicker(e)),
                this._attachments(t(e), u),
                this._autoSize(u),
                this._setDate(u, s),
                this._updateAlternate(u),
                this._updateDatepicker(u))
            },
            _changeDatepicker: function(t, e, i) {
                this._optionDatepicker(t, e, i)
            },
            _refreshDatepicker: function(t) {
                var e = this._getInst(t);
                e && this._updateDatepicker(e)
            },
            _setDateDatepicker: function(t, e) {
                var i = this._getInst(t);
                i && (this._setDate(i, e),
                this._updateDatepicker(i),
                this._updateAlternate(i))
            },
            _getDateDatepicker: function(t, e) {
                var i = this._getInst(t);
                return i && !i.inline && this._setDateFromField(i, e),
                i ? this._getDate(i) : null
            },
            _doKeyDown: function(e) {
                var i, n, r, a = t.datepicker._getInst(e.target), s = !0, o = a.dpDiv.is(".ui-datepicker-rtl");
                if (a._keyEvent = !0,
                t.datepicker._datepickerShowing)
                    switch (e.keyCode) {
                    case 9:
                        t.datepicker._hideDatepicker(),
                        s = !1;
                        break;
                    case 13:
                        return r = t("td." + t.datepicker._dayOverClass + ":not(." + t.datepicker._currentClass + ")", a.dpDiv),
                        r[0] && t.datepicker._selectDay(e.target, a.selectedMonth, a.selectedYear, r[0]),
                        i = t.datepicker._get(a, "onSelect"),
                        i ? (n = t.datepicker._formatDate(a),
                        i.apply(a.input ? a.input[0] : null, [n, a])) : t.datepicker._hideDatepicker(),
                        !1;
                    case 27:
                        t.datepicker._hideDatepicker();
                        break;
                    case 33:
                        t.datepicker._adjustDate(e.target, e.ctrlKey ? -t.datepicker._get(a, "stepBigMonths") : -t.datepicker._get(a, "stepMonths"), "M");
                        break;
                    case 34:
                        t.datepicker._adjustDate(e.target, e.ctrlKey ? +t.datepicker._get(a, "stepBigMonths") : +t.datepicker._get(a, "stepMonths"), "M");
                        break;
                    case 35:
                        (e.ctrlKey || e.metaKey) && t.datepicker._clearDate(e.target),
                        s = e.ctrlKey || e.metaKey;
                        break;
                    case 36:
                        (e.ctrlKey || e.metaKey) && t.datepicker._gotoToday(e.target),
                        s = e.ctrlKey || e.metaKey;
                        break;
                    case 37:
                        (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, o ? 1 : -1, "D"),
                        s = e.ctrlKey || e.metaKey,
                        e.originalEvent.altKey && t.datepicker._adjustDate(e.target, e.ctrlKey ? -t.datepicker._get(a, "stepBigMonths") : -t.datepicker._get(a, "stepMonths"), "M");
                        break;
                    case 38:
                        (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, -7, "D"),
                        s = e.ctrlKey || e.metaKey;
                        break;
                    case 39:
                        (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, o ? -1 : 1, "D"),
                        s = e.ctrlKey || e.metaKey,
                        e.originalEvent.altKey && t.datepicker._adjustDate(e.target, e.ctrlKey ? +t.datepicker._get(a, "stepBigMonths") : +t.datepicker._get(a, "stepMonths"), "M");
                        break;
                    case 40:
                        (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, 7, "D"),
                        s = e.ctrlKey || e.metaKey;
                        break;
                    default:
                        s = !1
                    }
                else
                    36 === e.keyCode && e.ctrlKey ? t.datepicker._showDatepicker(this) : s = !1;
                s && (e.preventDefault(),
                e.stopPropagation())
            },
            _doKeyPress: function(e) {
                var i, n, r = t.datepicker._getInst(e.target);
                if (t.datepicker._get(r, "constrainInput"))
                    return i = t.datepicker._possibleChars(t.datepicker._get(r, "dateFormat")),
                    n = String.fromCharCode(null == e.charCode ? e.keyCode : e.charCode),
                    e.ctrlKey || e.metaKey || n < " " || !i || i.indexOf(n) > -1
            },
            _doKeyUp: function(e) {
                var i, n = t.datepicker._getInst(e.target);
                if (n.input.val() !== n.lastVal)
                    try {
                        i = t.datepicker.parseDate(t.datepicker._get(n, "dateFormat"), n.input ? n.input.val() : null, t.datepicker._getFormatConfig(n)),
                        i && (t.datepicker._setDateFromField(n),
                        t.datepicker._updateAlternate(n),
                        t.datepicker._updateDatepicker(n))
                    } catch (t) {}
                return !0
            },
            _showDatepicker: function(e) {
                if (e = e.target || e,
                "input" !== e.nodeName.toLowerCase() && (e = t("input", e.parentNode)[0]),
                !t.datepicker._isDisabledDatepicker(e) && t.datepicker._lastInput !== e) {
                    var i, n, a, s, o, l, u;
                    i = t.datepicker._getInst(e),
                    t.datepicker._curInst && t.datepicker._curInst !== i && (t.datepicker._curInst.dpDiv.stop(!0, !0),
                    i && t.datepicker._datepickerShowing && t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),
                    n = t.datepicker._get(i, "beforeShow"),
                    a = n ? n.apply(e, [e, i]) : {},
                    !1 !== a && (r(i.settings, a),
                    i.lastVal = null,
                    t.datepicker._lastInput = e,
                    t.datepicker._setDateFromField(i),
                    t.datepicker._inDialog && (e.value = ""),
                    t.datepicker._pos || (t.datepicker._pos = t.datepicker._findPos(e),
                    t.datepicker._pos[1] += e.offsetHeight),
                    s = !1,
                    t(e).parents().each(function() {
                        return !(s |= "fixed" === t(this).css("position"))
                    }),
                    o = {
                        left: t.datepicker._pos[0],
                        top: t.datepicker._pos[1]
                    },
                    t.datepicker._pos = null,
                    i.dpDiv.empty(),
                    i.dpDiv.css({
                        position: "absolute",
                        display: "block",
                        top: "-1000px"
                    }),
                    t.datepicker._updateDatepicker(i),
                    o = t.datepicker._checkOffset(i, o, s),
                    i.dpDiv.css({
                        position: t.datepicker._inDialog && t.blockUI ? "static" : s ? "fixed" : "absolute",
                        display: "none",
                        left: o.left + "px",
                        top: o.top + "px"
                    }),
                    i.inline || (l = t.datepicker._get(i, "showAnim"),
                    u = t.datepicker._get(i, "duration"),
                    i.dpDiv.zIndex(t(e).zIndex() + 1),
                    t.datepicker._datepickerShowing = !0,
                    t.effects && t.effects.effect[l] ? i.dpDiv.show(l, t.datepicker._get(i, "showOptions"), u) : i.dpDiv[l || "show"](l ? u : null),
                    t.datepicker._shouldFocusInput(i) && i.input.focus(),
                    t.datepicker._curInst = i))
                }
            },
            _updateDatepicker: function(e) {
                this.maxRows = 4,
                a = e,
                e.dpDiv.empty().append(this._generateHTML(e)),
                this._attachHandlers(e),
                e.dpDiv.find("." + this._dayOverClass + " a").mouseover();
                var i, n = this._getNumberOfMonths(e), r = n[1];
                e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),
                r > 1 && e.dpDiv.addClass("ui-datepicker-multi-" + r).css("width", 17 * r + "em"),
                e.dpDiv[(1 !== n[0] || 1 !== n[1] ? "add" : "remove") + "Class"]("ui-datepicker-multi"),
                e.dpDiv[(this._get(e, "isRTL") ? "add" : "remove") + "Class"]("ui-datepicker-rtl"),
                e === t.datepicker._curInst && t.datepicker._datepickerShowing && t.datepicker._shouldFocusInput(e) && e.input.focus(),
                e.yearshtml && (i = e.yearshtml,
                setTimeout(function() {
                    i === e.yearshtml && e.yearshtml && e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),
                    i = e.yearshtml = null
                }, 0))
            },
            _shouldFocusInput: function(t) {
                return t.input && t.input.is(":visible") && !t.input.is(":disabled") && !t.input.is(":focus")
            },
            _checkOffset: function(e, i, n) {
                var r = e.dpDiv.outerWidth()
                  , a = e.dpDiv.outerHeight()
                  , s = e.input ? e.input.outerWidth() : 0
                  , o = e.input ? e.input.outerHeight() : 0
                  , l = document.documentElement.clientWidth + (n ? 0 : t(document).scrollLeft())
                  , u = document.documentElement.clientHeight + (n ? 0 : t(document).scrollTop());
                return i.left -= this._get(e, "isRTL") ? r - s : 0,
                i.left -= n && i.left === e.input.offset().left ? t(document).scrollLeft() : 0,
                i.top -= n && i.top === e.input.offset().top + o ? t(document).scrollTop() : 0,
                i.left -= Math.min(i.left, i.left + r > l && l > r ? Math.abs(i.left + r - l) : 0),
                i.top -= Math.min(i.top, i.top + a > u && u > a ? Math.abs(a + o) : 0),
                i
            },
            _findPos: function(e) {
                for (var i, n = this._getInst(e), r = this._get(n, "isRTL"); e && ("hidden" === e.type || 1 !== e.nodeType || t.expr.filters.hidden(e)); )
                    e = e[r ? "previousSibling" : "nextSibling"];
                return i = t(e).offset(),
                [i.left, i.top]
            },
            _hideDatepicker: function(e) {
                var i, n, r, a, o = this._curInst;
                !o || e && o !== t.data(e, s) || this._datepickerShowing && (i = this._get(o, "showAnim"),
                n = this._get(o, "duration"),
                r = function() {
                    t.datepicker._tidyDialog(o)
                }
                ,
                t.effects && (t.effects.effect[i] || t.effects[i]) ? o.dpDiv.hide(i, t.datepicker._get(o, "showOptions"), n, r) : o.dpDiv["slideDown" === i ? "slideUp" : "fadeIn" === i ? "fadeOut" : "hide"](i ? n : null, r),
                i || r(),
                this._datepickerShowing = !1,
                a = this._get(o, "onClose"),
                a && a.apply(o.input ? o.input[0] : null, [o.input ? o.input.val() : "", o]),
                this._lastInput = null,
                this._inDialog && (this._dialogInput.css({
                    position: "absolute",
                    left: "0",
                    top: "-100px"
                }),
                t.blockUI && (t.unblockUI(),
                t("body").append(this.dpDiv))),
                this._inDialog = !1)
            },
            _tidyDialog: function(t) {
                t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")
            },
            _checkExternalClick: function(e) {
                if (t.datepicker._curInst) {
                    var i = t(e.target)
                      , n = t.datepicker._getInst(i[0]);
                    (i[0].id === t.datepicker._mainDivId || 0 !== i.parents("#" + t.datepicker._mainDivId).length || i.hasClass(t.datepicker.markerClassName) || i.closest("." + t.datepicker._triggerClass).length || !t.datepicker._datepickerShowing || t.datepicker._inDialog && t.blockUI) && (!i.hasClass(t.datepicker.markerClassName) || t.datepicker._curInst === n) || t.datepicker._hideDatepicker()
                }
            },
            _adjustDate: function(e, i, n) {
                var r = t(e)
                  , a = this._getInst(r[0]);
                this._isDisabledDatepicker(r[0]) || (this._adjustInstDate(a, i + ("M" === n ? this._get(a, "showCurrentAtPos") : 0), n),
                this._updateDatepicker(a))
            },
            _gotoToday: function(e) {
                var i, n = t(e), r = this._getInst(n[0]);
                this._get(r, "gotoCurrent") && r.currentDay ? (r.selectedDay = r.currentDay,
                r.drawMonth = r.selectedMonth = r.currentMonth,
                r.drawYear = r.selectedYear = r.currentYear) : (i = new Date,
                r.selectedDay = i.getDate(),
                r.drawMonth = r.selectedMonth = i.getMonth(),
                r.drawYear = r.selectedYear = i.getFullYear()),
                this._notifyChange(r),
                this._adjustDate(n)
            },
            _selectMonthYear: function(e, i, n) {
                var r = t(e)
                  , a = this._getInst(r[0]);
                a["selected" + ("M" === n ? "Month" : "Year")] = a["draw" + ("M" === n ? "Month" : "Year")] = parseInt(i.options[i.selectedIndex].value, 10),
                this._notifyChange(a),
                this._adjustDate(r)
            },
            _selectDay: function(e, i, n, r) {
                var a, s = t(e);
                t(r).hasClass(this._unselectableClass) || this._isDisabledDatepicker(s[0]) || (a = this._getInst(s[0]),
                a.selectedDay = a.currentDay = t("a", r).html(),
                a.selectedMonth = a.currentMonth = i,
                a.selectedYear = a.currentYear = n,
                this._selectDate(e, this._formatDate(a, a.currentDay, a.currentMonth, a.currentYear)))
            },
            _clearDate: function(e) {
                var i = t(e);
                this._selectDate(i, "")
            },
            _selectDate: function(e, i) {
                var n, r = t(e), a = this._getInst(r[0]);
                i = null != i ? i : this._formatDate(a),
                a.input && a.input.val(i),
                this._updateAlternate(a),
                n = this._get(a, "onSelect"),
                n ? n.apply(a.input ? a.input[0] : null, [i, a]) : a.input && a.input.trigger("change"),
                a.inline ? this._updateDatepicker(a) : (this._hideDatepicker(),
                this._lastInput = a.input[0],
                "object" != typeof a.input[0] && a.input.focus(),
                this._lastInput = null)
            },
            _updateAlternate: function(e) {
                var i, n, r, a = this._get(e, "altField");
                a && (i = this._get(e, "altFormat") || this._get(e, "dateFormat"),
                n = this._getDate(e),
                r = this.formatDate(i, n, this._getFormatConfig(e)),
                t(a).each(function() {
                    t(this).val(r)
                }))
            },
            noWeekends: function(t) {
                var e = t.getDay();
                return [e > 0 && e < 6, ""]
            },
            iso8601Week: function(t) {
                var e, i = new Date(t.getTime());
                return i.setDate(i.getDate() + 4 - (i.getDay() || 7)),
                e = i.getTime(),
                i.setMonth(0),
                i.setDate(1),
                Math.floor(Math.round((e - i) / 864e5) / 7) + 1
            },
            parseDate: function(e, i, n) {
                if (null == e || null == i)
                    throw "Invalid arguments";
                if ("" === (i = "object" == typeof i ? i.toString() : i + ""))
                    return null;
                var r, a, s, o, l = 0, u = (n ? n.shortYearCutoff : null) || this._defaults.shortYearCutoff, h = "string" != typeof u ? u : (new Date).getFullYear() % 100 + parseInt(u, 10), c = (n ? n.dayNamesShort : null) || this._defaults.dayNamesShort, d = (n ? n.dayNames : null) || this._defaults.dayNames, p = (n ? n.monthNamesShort : null) || this._defaults.monthNamesShort, f = (n ? n.monthNames : null) || this._defaults.monthNames, g = -1, m = -1, v = -1, _ = -1, b = !1, x = function(t) {
                    var i = r + 1 < e.length && e.charAt(r + 1) === t;
                    return i && r++,
                    i
                }, y = function(t) {
                    var e = x(t)
                      , n = "@" === t ? 14 : "!" === t ? 20 : "y" === t && e ? 4 : "o" === t ? 3 : 2
                      , r = new RegExp("^\\d{1," + n + "}")
                      , a = i.substring(l).match(r);
                    if (!a)
                        throw "Missing number at position " + l;
                    return l += a[0].length,
                    parseInt(a[0], 10)
                }, S = function(e, n, r) {
                    var a = -1
                      , s = t.map(x(e) ? r : n, function(t, e) {
                        return [[e, t]]
                    }).sort(function(t, e) {
                        return -(t[1].length - e[1].length)
                    });
                    if (t.each(s, function(t, e) {
                        var n = e[1];
                        if (i.substr(l, n.length).toLowerCase() === n.toLowerCase())
                            return a = e[0],
                            l += n.length,
                            !1
                    }),
                    -1 !== a)
                        return a + 1;
                    throw "Unknown name at position " + l
                }, w = function() {
                    if (i.charAt(l) !== e.charAt(r))
                        throw "Unexpected literal at position " + l;
                    l++
                };
                for (r = 0; r < e.length; r++)
                    if (b)
                        "'" !== e.charAt(r) || x("'") ? w() : b = !1;
                    else
                        switch (e.charAt(r)) {
                        case "d":
                            v = y("d");
                            break;
                        case "D":
                            S("D", c, d);
                            break;
                        case "o":
                            _ = y("o");
                            break;
                        case "m":
                            m = y("m");
                            break;
                        case "M":
                            m = S("M", p, f);
                            break;
                        case "y":
                            g = y("y");
                            break;
                        case "@":
                            o = new Date(y("@")),
                            g = o.getFullYear(),
                            m = o.getMonth() + 1,
                            v = o.getDate();
                            break;
                        case "!":
                            o = new Date((y("!") - this._ticksTo1970) / 1e4),
                            g = o.getFullYear(),
                            m = o.getMonth() + 1,
                            v = o.getDate();
                            break;
                        case "'":
                            x("'") ? w() : b = !0;
                            break;
                        default:
                            w()
                        }
                if (l < i.length && (s = i.substr(l),
                !/^\s+/.test(s)))
                    throw "Extra/unparsed characters found in date: " + s;
                if (-1 === g ? g = (new Date).getFullYear() : g < 100 && (g += (new Date).getFullYear() - (new Date).getFullYear() % 100 + (g <= h ? 0 : -100)),
                _ > -1)
                    for (m = 1,
                    v = _; ; ) {
                        if (a = this._getDaysInMonth(g, m - 1),
                        v <= a)
                            break;
                        m++,
                        v -= a
                    }
                if (o = this._daylightSavingAdjust(new Date(g,m - 1,v)),
                o.getFullYear() !== g || o.getMonth() + 1 !== m || o.getDate() !== v)
                    throw "Invalid date";
                return o
            },
            ATOM: "yy-mm-dd",
            COOKIE: "D, dd M yy",
            ISO_8601: "yy-mm-dd",
            RFC_822: "D, d M y",
            RFC_850: "DD, dd-M-y",
            RFC_1036: "D, d M y",
            RFC_1123: "D, d M yy",
            RFC_2822: "D, d M yy",
            RSS: "D, d M y",
            TICKS: "!",
            TIMESTAMP: "@",
            W3C: "yy-mm-dd",
            _ticksTo1970: 24 * (718685 + Math.floor(492.5) - Math.floor(19.7) + Math.floor(4.925)) * 60 * 60 * 1e7,
            formatDate: function(t, e, i) {
                if (!e)
                    return "";
                var n, r = (i ? i.dayNamesShort : null) || this._defaults.dayNamesShort, a = (i ? i.dayNames : null) || this._defaults.dayNames, s = (i ? i.monthNamesShort : null) || this._defaults.monthNamesShort, o = (i ? i.monthNames : null) || this._defaults.monthNames, l = function(e) {
                    var i = n + 1 < t.length && t.charAt(n + 1) === e;
                    return i && n++,
                    i
                }, u = function(t, e, i) {
                    var n = "" + e;
                    if (l(t))
                        for (; n.length < i; )
                            n = "0" + n;
                    return n
                }, h = function(t, e, i, n) {
                    return l(t) ? n[e] : i[e]
                }, c = "", d = !1;
                if (e)
                    for (n = 0; n < t.length; n++)
                        if (d)
                            "'" !== t.charAt(n) || l("'") ? c += t.charAt(n) : d = !1;
                        else
                            switch (t.charAt(n)) {
                            case "d":
                                c += u("d", e.getDate(), 2);
                                break;
                            case "D":
                                c += h("D", e.getDay(), r, a);
                                break;
                            case "o":
                                c += u("o", Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime() - new Date(e.getFullYear(),0,0).getTime()) / 864e5), 3);
                                break;
                            case "m":
                                c += u("m", e.getMonth() + 1, 2);
                                break;
                            case "M":
                                c += h("M", e.getMonth(), s, o);
                                break;
                            case "y":
                                c += l("y") ? e.getFullYear() : (e.getYear() % 100 < 10 ? "0" : "") + e.getYear() % 100;
                                break;
                            case "@":
                                c += e.getTime();
                                break;
                            case "!":
                                c += 1e4 * e.getTime() + this._ticksTo1970;
                                break;
                            case "'":
                                l("'") ? c += "'" : d = !0;
                                break;
                            default:
                                c += t.charAt(n)
                            }
                return c
            },
            _possibleChars: function(t) {
                var e, i = "", n = !1, r = function(i) {
                    var n = e + 1 < t.length && t.charAt(e + 1) === i;
                    return n && e++,
                    n
                };
                for (e = 0; e < t.length; e++)
                    if (n)
                        "'" !== t.charAt(e) || r("'") ? i += t.charAt(e) : n = !1;
                    else
                        switch (t.charAt(e)) {
                        case "d":
                        case "m":
                        case "y":
                        case "@":
                            i += "0123456789";
                            break;
                        case "D":
                        case "M":
                            return null;
                        case "'":
                            r("'") ? i += "'" : n = !0;
                            break;
                        default:
                            i += t.charAt(e)
                        }
                return i
            },
            _get: function(t, e) {
                return void 0 !== t.settings[e] ? t.settings[e] : this._defaults[e]
            },
            _setDateFromField: function(t, e) {
                if (t.input.val() !== t.lastVal) {
                    var i = this._get(t, "dateFormat")
                      , n = t.lastVal = t.input ? t.input.val() : null
                      , r = this._getDefaultDate(t)
                      , a = r
                      , s = this._getFormatConfig(t);
                    try {
                        a = this.parseDate(i, n, s) || r
                    } catch (t) {
                        n = e ? "" : n
                    }
                    t.selectedDay = a.getDate(),
                    t.drawMonth = t.selectedMonth = a.getMonth(),
                    t.drawYear = t.selectedYear = a.getFullYear(),
                    t.currentDay = n ? a.getDate() : 0,
                    t.currentMonth = n ? a.getMonth() : 0,
                    t.currentYear = n ? a.getFullYear() : 0,
                    this._adjustInstDate(t)
                }
            },
            _getDefaultDate: function(t) {
                return this._restrictMinMax(t, this._determineDate(t, this._get(t, "defaultDate"), new Date))
            },
            _determineDate: function(e, i, n) {
                var r = null == i || "" === i ? n : "string" == typeof i ? function(i) {
                    try {
                        return t.datepicker.parseDate(t.datepicker._get(e, "dateFormat"), i, t.datepicker._getFormatConfig(e))
                    } catch (t) {}
                    for (var n = (i.toLowerCase().match(/^c/) ? t.datepicker._getDate(e) : null) || new Date, r = n.getFullYear(), a = n.getMonth(), s = n.getDate(), o = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g, l = o.exec(i); l; ) {
                        switch (l[2] || "d") {
                        case "d":
                        case "D":
                            s += parseInt(l[1], 10);
                            break;
                        case "w":
                        case "W":
                            s += 7 * parseInt(l[1], 10);
                            break;
                        case "m":
                        case "M":
                            a += parseInt(l[1], 10),
                            s = Math.min(s, t.datepicker._getDaysInMonth(r, a));
                            break;
                        case "y":
                        case "Y":
                            r += parseInt(l[1], 10),
                            s = Math.min(s, t.datepicker._getDaysInMonth(r, a))
                        }
                        l = o.exec(i)
                    }
                    return new Date(r,a,s)
                }(i) : "number" == typeof i ? isNaN(i) ? n : function(t) {
                    var e = new Date;
                    return e.setDate(e.getDate() + t),
                    e
                }(i) : new Date(i.getTime());
                return r = r && "Invalid Date" === r.toString() ? n : r,
                r && (r.setHours(0),
                r.setMinutes(0),
                r.setSeconds(0),
                r.setMilliseconds(0)),
                this._daylightSavingAdjust(r)
            },
            _daylightSavingAdjust: function(t) {
                return t ? (t.setHours(t.getHours() > 12 ? t.getHours() + 2 : 0),
                t) : null
            },
            _setDate: function(t, e, i) {
                var n = !e
                  , r = t.selectedMonth
                  , a = t.selectedYear
                  , s = this._restrictMinMax(t, this._determineDate(t, e, new Date));
                t.selectedDay = t.currentDay = s.getDate(),
                t.drawMonth = t.selectedMonth = t.currentMonth = s.getMonth(),
                t.drawYear = t.selectedYear = t.currentYear = s.getFullYear(),
                r === t.selectedMonth && a === t.selectedYear || i || this._notifyChange(t),
                this._adjustInstDate(t),
                t.input && t.input.val(n ? "" : this._formatDate(t))
            },
            _getDate: function(t) {
                return !t.currentYear || t.input && "" === t.input.val() ? null : this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay))
            },
            _attachHandlers: function(e) {
                var i = this._get(e, "stepMonths")
                  , n = "#" + e.id.replace(/\\\\/g, "\\");
                e.dpDiv.find("[data-handler]").map(function() {
                    var e = {
                        prev: function() {
                            t.datepicker._adjustDate(n, -i, "M")
                        },
                        next: function() {
                            t.datepicker._adjustDate(n, +i, "M")
                        },
                        hide: function() {
                            t.datepicker._hideDatepicker()
                        },
                        today: function() {
                            t.datepicker._gotoToday(n)
                        },
                        selectDay: function() {
                            return t.datepicker._selectDay(n, +this.getAttribute("data-month"), +this.getAttribute("data-year"), this),
                            !1
                        },
                        selectMonth: function() {
                            return t.datepicker._selectMonthYear(n, this, "M"),
                            !1
                        },
                        selectYear: function() {
                            return t.datepicker._selectMonthYear(n, this, "Y"),
                            !1
                        }
                    };
                    t(this).bind(this.getAttribute("data-event"), e[this.getAttribute("data-handler")])
                })
            },
            _generateHTML: function(t) {
                var e, i, n, r, a, s, o, l, u, h, c, d, p, f, g, m, v, _, b, x, y, S, w, C, M, T, A, E, P, N, k, F, D, R, I, O, L, B, V, U = new Date, G = this._daylightSavingAdjust(new Date(U.getFullYear(),U.getMonth(),U.getDate())), z = this._get(t, "isRTL"), H = this._get(t, "showButtonPanel"), j = this._get(t, "hideIfNoPrevNext"), W = this._get(t, "navigationAsDateFormat"), q = this._getNumberOfMonths(t), Y = this._get(t, "showCurrentAtPos"), X = this._get(t, "stepMonths"), K = 1 !== q[0] || 1 !== q[1], J = this._daylightSavingAdjust(t.currentDay ? new Date(t.currentYear,t.currentMonth,t.currentDay) : new Date(9999,9,9)), Q = this._getMinMaxDate(t, "min"), Z = this._getMinMaxDate(t, "max"), $ = t.drawMonth - Y, tt = t.drawYear;
                if ($ < 0 && ($ += 12,
                tt--),
                Z)
                    for (e = this._daylightSavingAdjust(new Date(Z.getFullYear(),Z.getMonth() - q[0] * q[1] + 1,Z.getDate())),
                    e = Q && e < Q ? Q : e; this._daylightSavingAdjust(new Date(tt,$,1)) > e; )
                        --$ < 0 && ($ = 11,
                        tt--);
                for (t.drawMonth = $,
                t.drawYear = tt,
                i = this._get(t, "prevText"),
                i = W ? this.formatDate(i, this._daylightSavingAdjust(new Date(tt,$ - X,1)), this._getFormatConfig(t)) : i,
                n = this._canAdjustMonth(t, -1, tt, $) ? "<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='" + i + "'><span class='ui-icon ui-icon-circle-triangle-" + (z ? "e" : "w") + "'>" + i + "</span></a>" : j ? "" : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='" + i + "'><span class='ui-icon ui-icon-circle-triangle-" + (z ? "e" : "w") + "'>" + i + "</span></a>",
                r = this._get(t, "nextText"),
                r = W ? this.formatDate(r, this._daylightSavingAdjust(new Date(tt,$ + X,1)), this._getFormatConfig(t)) : r,
                a = this._canAdjustMonth(t, 1, tt, $) ? "<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='" + r + "'><span class='ui-icon ui-icon-circle-triangle-" + (z ? "w" : "e") + "'>" + r + "</span></a>" : j ? "" : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='" + r + "'><span class='ui-icon ui-icon-circle-triangle-" + (z ? "w" : "e") + "'>" + r + "</span></a>",
                s = this._get(t, "currentText"),
                o = this._get(t, "gotoCurrent") && t.currentDay ? J : G,
                s = W ? this.formatDate(s, o, this._getFormatConfig(t)) : s,
                l = t.inline ? "" : "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" + this._get(t, "closeText") + "</button>",
                u = H ? "<div class='ui-datepicker-buttonpane ui-widget-content'>" + (z ? l : "") + (this._isInRange(t, o) ? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>" + s + "</button>" : "") + (z ? "" : l) + "</div>" : "",
                h = parseInt(this._get(t, "firstDay"), 10),
                h = isNaN(h) ? 0 : h,
                c = this._get(t, "showWeek"),
                d = this._get(t, "dayNames"),
                p = this._get(t, "dayNamesMin"),
                f = this._get(t, "monthNames"),
                g = this._get(t, "monthNamesShort"),
                m = this._get(t, "beforeShowDay"),
                v = this._get(t, "showOtherMonths"),
                _ = this._get(t, "selectOtherMonths"),
                b = this._getDefaultDate(t),
                x = "",
                S = 0; S < q[0]; S++) {
                    for (w = "",
                    this.maxRows = 4,
                    C = 0; C < q[1]; C++) {
                        if (M = this._daylightSavingAdjust(new Date(tt,$,t.selectedDay)),
                        T = " ui-corner-all",
                        A = "",
                        K) {
                            if (A += "<div class='ui-datepicker-group",
                            q[1] > 1)
                                switch (C) {
                                case 0:
                                    A += " ui-datepicker-group-first",
                                    T = " ui-corner-" + (z ? "right" : "left");
                                    break;
                                case q[1] - 1:
                                    A += " ui-datepicker-group-last",
                                    T = " ui-corner-" + (z ? "left" : "right");
                                    break;
                                default:
                                    A += " ui-datepicker-group-middle",
                                    T = ""
                                }
                            A += "'>"
                        }
                        for (A += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + T + "'>" + (/all|left/.test(T) && 0 === S ? z ? a : n : "") + (/all|right/.test(T) && 0 === S ? z ? n : a : "") + this._generateMonthYearHeader(t, $, tt, Q, Z, S > 0 || C > 0, f, g) + "</div><table class='ui-datepicker-calendar'><thead><tr>",
                        E = c ? "<th class='ui-datepicker-week-col'>" + this._get(t, "weekHeader") + "</th>" : "",
                        y = 0; y < 7; y++)
                            P = (y + h) % 7,
                            E += "<th" + ((y + h + 6) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "") + "><span title='" + d[P] + "'>" + p[P] + "</span></th>";
                        for (A += E + "</tr></thead><tbody>",
                        N = this._getDaysInMonth(tt, $),
                        tt === t.selectedYear && $ === t.selectedMonth && (t.selectedDay = Math.min(t.selectedDay, N)),
                        k = (this._getFirstDayOfMonth(tt, $) - h + 7) % 7,
                        F = Math.ceil((k + N) / 7),
                        D = K && this.maxRows > F ? this.maxRows : F,
                        this.maxRows = D,
                        R = this._daylightSavingAdjust(new Date(tt,$,1 - k)),
                        I = 0; I < D; I++) {
                            for (A += "<tr>",
                            O = c ? "<td class='ui-datepicker-week-col'>" + this._get(t, "calculateWeek")(R) + "</td>" : "",
                            y = 0; y < 7; y++)
                                L = m ? m.apply(t.input ? t.input[0] : null, [R]) : [!0, ""],
                                B = R.getMonth() !== $,
                                V = B && !_ || !L[0] || Q && R < Q || Z && R > Z,
                                O += "<td class='" + ((y + h + 6) % 7 >= 5 ? " ui-datepicker-week-end" : "") + (B ? " ui-datepicker-other-month" : "") + (R.getTime() === M.getTime() && $ === t.selectedMonth && t._keyEvent || b.getTime() === R.getTime() && b.getTime() === M.getTime() ? " " + this._dayOverClass : "") + (V ? " " + this._unselectableClass + " ui-state-disabled" : "") + (B && !v ? "" : " " + L[1] + (R.getTime() === J.getTime() ? " " + this._currentClass : "") + (R.getTime() === G.getTime() ? " ui-datepicker-today" : "")) + "'" + (B && !v || !L[2] ? "" : " title='" + L[2].replace(/'/g, "&#39;") + "'") + (V ? "" : " data-handler='selectDay' data-event='click' data-month='" + R.getMonth() + "' data-year='" + R.getFullYear() + "'") + ">" + (B && !v ? "&#xa0;" : V ? "<span class='ui-state-default'>" + R.getDate() + "</span>" : "<a class='ui-state-default" + (R.getTime() === G.getTime() ? " ui-state-highlight" : "") + (R.getTime() === J.getTime() ? " ui-state-active" : "") + (B ? " ui-priority-secondary" : "") + "' href='#'>" + R.getDate() + "</a>") + "</td>",
                                R.setDate(R.getDate() + 1),
                                R = this._daylightSavingAdjust(R);
                            A += O + "</tr>"
                        }
                        $++,
                        $ > 11 && ($ = 0,
                        tt++),
                        A += "</tbody></table>" + (K ? "</div>" + (q[0] > 0 && C === q[1] - 1 ? "<div class='ui-datepicker-row-break'></div>" : "") : ""),
                        w += A
                    }
                    x += w
                }
                return x += u,
                t._keyEvent = !1,
                x
            },
            _generateMonthYearHeader: function(t, e, i, n, r, a, s, o) {
                var l, u, h, c, d, p, f, g, m = this._get(t, "changeMonth"), v = this._get(t, "changeYear"), _ = this._get(t, "showMonthAfterYear"), b = "<div class='ui-datepicker-title'>", x = "";
                if (a || !m)
                    x += "<span class='ui-datepicker-month'>" + s[e] + "</span>";
                else {
                    for (l = n && n.getFullYear() === i,
                    u = r && r.getFullYear() === i,
                    x += "<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",
                    h = 0; h < 12; h++)
                        (!l || h >= n.getMonth()) && (!u || h <= r.getMonth()) && (x += "<option value='" + h + "'" + (h === e ? " selected='selected'" : "") + ">" + o[h] + "</option>");
                    x += "</select>"
                }
                if (_ || (b += x + (!a && m && v ? "" : "&#xa0;")),
                !t.yearshtml)
                    if (t.yearshtml = "",
                    a || !v)
                        b += "<span class='ui-datepicker-year'>" + i + "</span>";
                    else {
                        for (c = this._get(t, "yearRange").split(":"),
                        d = (new Date).getFullYear(),
                        p = function(t) {
                            var e = t.match(/c[+\-].*/) ? i + parseInt(t.substring(1), 10) : t.match(/[+\-].*/) ? d + parseInt(t, 10) : parseInt(t, 10);
                            return isNaN(e) ? d : e
                        }
                        ,
                        f = p(c[0]),
                        g = Math.max(f, p(c[1] || "")),
                        f = n ? Math.max(f, n.getFullYear()) : f,
                        g = r ? Math.min(g, r.getFullYear()) : g,
                        t.yearshtml += "<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>"; f <= g; f++)
                            t.yearshtml += "<option value='" + f + "'" + (f === i ? " selected='selected'" : "") + ">" + f + "</option>";
                        t.yearshtml += "</select>",
                        b += t.yearshtml,
                        t.yearshtml = null
                    }
                return b += this._get(t, "yearSuffix"),
                _ && (b += (!a && m && v ? "" : "&#xa0;") + x),
                b += "</div>"
            },
            _adjustInstDate: function(t, e, i) {
                var n = t.drawYear + ("Y" === i ? e : 0)
                  , r = t.drawMonth + ("M" === i ? e : 0)
                  , a = Math.min(t.selectedDay, this._getDaysInMonth(n, r)) + ("D" === i ? e : 0)
                  , s = this._restrictMinMax(t, this._daylightSavingAdjust(new Date(n,r,a)));
                t.selectedDay = s.getDate(),
                t.drawMonth = t.selectedMonth = s.getMonth(),
                t.drawYear = t.selectedYear = s.getFullYear(),
                "M" !== i && "Y" !== i || this._notifyChange(t)
            },
            _restrictMinMax: function(t, e) {
                var i = this._getMinMaxDate(t, "min")
                  , n = this._getMinMaxDate(t, "max")
                  , r = i && e < i ? i : e;
                return n && r > n ? n : r
            },
            _notifyChange: function(t) {
                var e = this._get(t, "onChangeMonthYear");
                e && e.apply(t.input ? t.input[0] : null, [t.selectedYear, t.selectedMonth + 1, t])
            },
            _getNumberOfMonths: function(t) {
                var e = this._get(t, "numberOfMonths");
                return null == e ? [1, 1] : "number" == typeof e ? [1, e] : e
            },
            _getMinMaxDate: function(t, e) {
                return this._determineDate(t, this._get(t, e + "Date"), null)
            },
            _getDaysInMonth: function(t, e) {
                return 32 - this._daylightSavingAdjust(new Date(t,e,32)).getDate()
            },
            _getFirstDayOfMonth: function(t, e) {
                return new Date(t,e,1).getDay()
            },
            _canAdjustMonth: function(t, e, i, n) {
                var r = this._getNumberOfMonths(t)
                  , a = this._daylightSavingAdjust(new Date(i,n + (e < 0 ? e : r[0] * r[1]),1));
                return e < 0 && a.setDate(this._getDaysInMonth(a.getFullYear(), a.getMonth())),
                this._isInRange(t, a)
            },
            _isInRange: function(t, e) {
                var i, n, r = this._getMinMaxDate(t, "min"), a = this._getMinMaxDate(t, "max"), s = null, o = null, l = this._get(t, "yearRange");
                return l && (i = l.split(":"),
                n = (new Date).getFullYear(),
                s = parseInt(i[0], 10),
                o = parseInt(i[1], 10),
                i[0].match(/[+\-].*/) && (s += n),
                i[1].match(/[+\-].*/) && (o += n)),
                (!r || e.getTime() >= r.getTime()) && (!a || e.getTime() <= a.getTime()) && (!s || e.getFullYear() >= s) && (!o || e.getFullYear() <= o)
            },
            _getFormatConfig: function(t) {
                var e = this._get(t, "shortYearCutoff");
                return e = "string" != typeof e ? e : (new Date).getFullYear() % 100 + parseInt(e, 10),
                {
                    shortYearCutoff: e,
                    dayNamesShort: this._get(t, "dayNamesShort"),
                    dayNames: this._get(t, "dayNames"),
                    monthNamesShort: this._get(t, "monthNamesShort"),
                    monthNames: this._get(t, "monthNames")
                }
            },
            _formatDate: function(t, e, i, n) {
                e || (t.currentDay = t.selectedDay,
                t.currentMonth = t.selectedMonth,
                t.currentYear = t.selectedYear);
                var r = e ? "object" == typeof e ? e : this._daylightSavingAdjust(new Date(n,i,e)) : this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));
                return this.formatDate(this._get(t, "dateFormat"), r, this._getFormatConfig(t))
            }
        }),
        t.fn.datepicker = function(e) {
            if (!this.length)
                return this;
            t.datepicker.initialized || (t(document).mousedown(t.datepicker._checkExternalClick),
            t.datepicker.initialized = !0),
            0 === t("#" + t.datepicker._mainDivId).length && t("body").append(t.datepicker.dpDiv);
            var i = Array.prototype.slice.call(arguments, 1);
            return "string" != typeof e || "isDisabled" !== e && "getDate" !== e && "widget" !== e ? "option" === e && 2 === arguments.length && "string" == typeof arguments[1] ? t.datepicker["_" + e + "Datepicker"].apply(t.datepicker, [this[0]].concat(i)) : this.each(function() {
                "string" == typeof e ? t.datepicker["_" + e + "Datepicker"].apply(t.datepicker, [this].concat(i)) : t.datepicker._attachDatepicker(this, e)
            }) : t.datepicker["_" + e + "Datepicker"].apply(t.datepicker, [this[0]].concat(i))
        }
        ,
        t.datepicker = new i,
        t.datepicker.initialized = !1,
        t.datepicker.uuid = (new Date).getTime(),
        t.datepicker.version = "1.10.3"
    }(n),
    function(t, e) {
        var i = {
            buttons: !0,
            height: !0,
            maxHeight: !0,
            maxWidth: !0,
            minHeight: !0,
            minWidth: !0,
            width: !0
        }
          , n = {
            maxHeight: !0,
            maxWidth: !0,
            minHeight: !0,
            minWidth: !0
        };
        t.widget("ui.dialog", {
            version: "1.10.3",
            options: {
                appendTo: "body",
                autoOpen: !0,
                buttons: [],
                closeOnEscape: !0,
                closeText: "close",
                dialogClass: "",
                draggable: !0,
                hide: null,
                height: "auto",
                maxHeight: null,
                maxWidth: null,
                minHeight: 150,
                minWidth: 150,
                modal: !1,
                position: {
                    my: "center",
                    at: "center",
                    of: window,
                    collision: "fit",
                    using: function(e) {
                        var i = t(this).css(e).offset().top;
                        i < 0 && t(this).css("top", e.top - i)
                    }
                },
                resizable: !0,
                show: null,
                title: null,
                width: 300,
                beforeClose: null,
                close: null,
                drag: null,
                dragStart: null,
                dragStop: null,
                focus: null,
                open: null,
                resize: null,
                resizeStart: null,
                resizeStop: null
            },
            _create: function() {
                this.originalCss = {
                    display: this.element[0].style.display,
                    width: this.element[0].style.width,
                    minHeight: this.element[0].style.minHeight,
                    maxHeight: this.element[0].style.maxHeight,
                    height: this.element[0].style.height
                },
                this.originalPosition = {
                    parent: this.element.parent(),
                    index: this.element.parent().children().index(this.element)
                },
                this.originalTitle = this.element.attr("title"),
                this.options.title = this.options.title || this.originalTitle,
                this._createWrapper(),
                this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),
                this._createTitlebar(),
                this._createButtonPane(),
                this.options.draggable && t.fn.draggable && this._makeDraggable(),
                this.options.resizable && t.fn.resizable && this._makeResizable(),
                this._isOpen = !1
            },
            _init: function() {
                this.options.autoOpen && this.open()
            },
            _appendTo: function() {
                var e = this.options.appendTo;
                return e && (e.jquery || e.nodeType) ? t(e) : this.document.find(e || "body").eq(0)
            },
            _destroy: function() {
                var t, e = this.originalPosition;
                this._destroyOverlay(),
                this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),
                this.uiDialog.stop(!0, !0).remove(),
                this.originalTitle && this.element.attr("title", this.originalTitle),
                t = e.parent.children().eq(e.index),
                t.length && t[0] !== this.element[0] ? t.before(this.element) : e.parent.append(this.element)
            },
            widget: function() {
                return this.uiDialog
            },
            disable: t.noop,
            enable: t.noop,
            close: function(e) {
                var i = this;
                this._isOpen && !1 !== this._trigger("beforeClose", e) && (this._isOpen = !1,
                this._destroyOverlay(),
                this.opener.filter(":focusable").focus().length || t(this.document[0].activeElement).blur(),
                this._hide(this.uiDialog, this.options.hide, function() {
                    i._trigger("close", e)
                }))
            },
            isOpen: function() {
                return this._isOpen
            },
            moveToTop: function() {
                this._moveToTop()
            },
            _moveToTop: function(t, e) {
                var i = !!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;
                return i && !e && this._trigger("focus", t),
                i
            },
            open: function() {
                var e = this;
                if (this._isOpen)
                    return void (this._moveToTop() && this._focusTabbable());
                this._isOpen = !0,
                this.opener = t(this.document[0].activeElement),
                this._size(),
                this._position(),
                this._createOverlay(),
                this._moveToTop(null, !0),
                this._show(this.uiDialog, this.options.show, function() {
                    e._focusTabbable(),
                    e._trigger("focus")
                }),
                this._trigger("open")
            },
            _focusTabbable: function() {
                var t = this.element.find("[autofocus]");
                t.length || (t = this.element.find(":tabbable")),
                t.length || (t = this.uiDialogButtonPane.find(":tabbable")),
                t.length || (t = this.uiDialogTitlebarClose.filter(":tabbable")),
                t.length || (t = this.uiDialog),
                t.eq(0).focus()
            },
            _keepFocus: function(e) {
                function i() {
                    var e = this.document[0].activeElement;
                    this.uiDialog[0] === e || t.contains(this.uiDialog[0], e) || this._focusTabbable()
                }
                e.preventDefault(),
                i.call(this),
                this._delay(i)
            },
            _createWrapper: function() {
                this.uiDialog = t("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front " + this.options.dialogClass).hide().attr({
                    tabIndex: -1,
                    role: "dialog"
                }).appendTo(this._appendTo()),
                this._on(this.uiDialog, {
                    keydown: function(e) {
                        if (this.options.closeOnEscape && !e.isDefaultPrevented() && e.keyCode && e.keyCode === t.ui.keyCode.ESCAPE)
                            return e.preventDefault(),
                            void this.close(e);
                        if (e.keyCode === t.ui.keyCode.TAB) {
                            var i = this.uiDialog.find(":tabbable")
                              , n = i.filter(":first")
                              , r = i.filter(":last");
                            e.target !== r[0] && e.target !== this.uiDialog[0] || e.shiftKey ? e.target !== n[0] && e.target !== this.uiDialog[0] || !e.shiftKey || (r.focus(1),
                            e.preventDefault()) : (n.focus(1),
                            e.preventDefault())
                        }
                    },
                    mousedown: function(t) {
                        this._moveToTop(t) && this._focusTabbable()
                    }
                }),
                this.element.find("[aria-describedby]").length || this.uiDialog.attr({
                    "aria-describedby": this.element.uniqueId().attr("id")
                })
            },
            _createTitlebar: function() {
                var e;
                this.uiDialogTitlebar = t("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),
                this._on(this.uiDialogTitlebar, {
                    mousedown: function(e) {
                        t(e.target).closest(".ui-dialog-titlebar-close") || this.uiDialog.focus()
                    }
                }),
                this.uiDialogTitlebarClose = t("<button></button>").button({
                    label: this.options.closeText,
                    icons: {
                        primary: "ui-icon-closethick"
                    },
                    text: !1
                }).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),
                this._on(this.uiDialogTitlebarClose, {
                    click: function(t) {
                        t.preventDefault(),
                        this.close(t)
                    }
                }),
                e = t("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),
                this._title(e),
                this.uiDialog.attr({
                    "aria-labelledby": e.attr("id")
                })
            },
            _title: function(t) {
                this.options.title || t.html("&#160;"),
                t.text(this.options.title)
            },
            _createButtonPane: function() {
                this.uiDialogButtonPane = t("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),
                this.uiButtonSet = t("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),
                this._createButtons()
            },
            _createButtons: function() {
                var e = this
                  , i = this.options.buttons;
                if (this.uiDialogButtonPane.remove(),
                this.uiButtonSet.empty(),
                t.isEmptyObject(i) || t.isArray(i) && !i.length)
                    return void this.uiDialog.removeClass("ui-dialog-buttons");
                t.each(i, function(i, n) {
                    var r, a;
                    n = t.isFunction(n) ? {
                        click: n,
                        text: i
                    } : n,
                    n = t.extend({
                        type: "button"
                    }, n),
                    r = n.click,
                    n.click = function() {
                        r.apply(e.element[0], arguments)
                    }
                    ,
                    a = {
                        icons: n.icons,
                        text: n.showText
                    },
                    delete n.icons,
                    delete n.showText,
                    t("<button></button>", n).button(a).appendTo(e.uiButtonSet)
                }),
                this.uiDialog.addClass("ui-dialog-buttons"),
                this.uiDialogButtonPane.appendTo(this.uiDialog)
            },
            _makeDraggable: function() {
                function e(t) {
                    return {
                        position: t.position,
                        offset: t.offset
                    }
                }
                var i = this
                  , n = this.options;
                this.uiDialog.draggable({
                    cancel: ".ui-dialog-content, .ui-dialog-titlebar-close",
                    handle: ".ui-dialog-titlebar",
                    containment: "document",
                    start: function(n, r) {
                        t(this).addClass("ui-dialog-dragging"),
                        i._blockFrames(),
                        i._trigger("dragStart", n, e(r))
                    },
                    drag: function(t, n) {
                        i._trigger("drag", t, e(n))
                    },
                    stop: function(r, a) {
                        n.position = [a.position.left - i.document.scrollLeft(), a.position.top - i.document.scrollTop()],
                        t(this).removeClass("ui-dialog-dragging"),
                        i._unblockFrames(),
                        i._trigger("dragStop", r, e(a))
                    }
                })
            },
            _makeResizable: function() {
                function e(t) {
                    return {
                        originalPosition: t.originalPosition,
                        originalSize: t.originalSize,
                        position: t.position,
                        size: t.size
                    }
                }
                var i = this
                  , n = this.options
                  , r = n.resizable
                  , a = this.uiDialog.css("position")
                  , s = "string" == typeof r ? r : "n,e,s,w,se,sw,ne,nw";
                this.uiDialog.resizable({
                    cancel: ".ui-dialog-content",
                    containment: "document",
                    alsoResize: this.element,
                    maxWidth: n.maxWidth,
                    maxHeight: n.maxHeight,
                    minWidth: n.minWidth,
                    minHeight: this._minHeight(),
                    handles: s,
                    start: function(n, r) {
                        t(this).addClass("ui-dialog-resizing"),
                        i._blockFrames(),
                        i._trigger("resizeStart", n, e(r))
                    },
                    resize: function(t, n) {
                        i._trigger("resize", t, e(n))
                    },
                    stop: function(r, a) {
                        n.height = t(this).height(),
                        n.width = t(this).width(),
                        t(this).removeClass("ui-dialog-resizing"),
                        i._unblockFrames(),
                        i._trigger("resizeStop", r, e(a))
                    }
                }).css("position", a)
            },
            _minHeight: function() {
                var t = this.options;
                return "auto" === t.height ? t.minHeight : Math.min(t.minHeight, t.height)
            },
            _position: function() {
                var t = this.uiDialog.is(":visible");
                t || this.uiDialog.show(),
                this.uiDialog.position(this.options.position),
                t || this.uiDialog.hide()
            },
            _setOptions: function(e) {
                var r = this
                  , a = !1
                  , s = {};
                t.each(e, function(t, e) {
                    r._setOption(t, e),
                    t in i && (a = !0),
                    t in n && (s[t] = e)
                }),
                a && (this._size(),
                this._position()),
                this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", s)
            },
            _setOption: function(t, e) {
                var i, n, r = this.uiDialog;
                "dialogClass" === t && r.removeClass(this.options.dialogClass).addClass(e),
                "disabled" !== t && (this._super(t, e),
                "appendTo" === t && this.uiDialog.appendTo(this._appendTo()),
                "buttons" === t && this._createButtons(),
                "closeText" === t && this.uiDialogTitlebarClose.button({
                    label: "" + e
                }),
                "draggable" === t && (i = r.is(":data(ui-draggable)"),
                i && !e && r.draggable("destroy"),
                !i && e && this._makeDraggable()),
                "position" === t && this._position(),
                "resizable" === t && (n = r.is(":data(ui-resizable)"),
                n && !e && r.resizable("destroy"),
                n && "string" == typeof e && r.resizable("option", "handles", e),
                n || !1 === e || this._makeResizable()),
                "title" === t && this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))
            },
            _size: function() {
                var t, e, i, n = this.options;
                this.element.show().css({
                    width: "auto",
                    minHeight: 0,
                    maxHeight: "none",
                    height: 0
                }),
                n.minWidth > n.width && (n.width = n.minWidth),
                t = this.uiDialog.css({
                    height: "auto",
                    width: n.width
                }).outerHeight(),
                e = Math.max(0, n.minHeight - t),
                i = "number" == typeof n.maxHeight ? Math.max(0, n.maxHeight - t) : "none",
                "auto" === n.height ? this.element.css({
                    minHeight: e,
                    maxHeight: i,
                    height: "auto"
                }) : this.element.height(Math.max(0, n.height - t)),
                this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", "minHeight", this._minHeight())
            },
            _blockFrames: function() {
                this.iframeBlocks = this.document.find("iframe").map(function() {
                    var e = t(this);
                    return t("<div>").css({
                        position: "absolute",
                        width: e.outerWidth(),
                        height: e.outerHeight()
                    }).appendTo(e.parent()).offset(e.offset())[0]
                })
            },
            _unblockFrames: function() {
                this.iframeBlocks && (this.iframeBlocks.remove(),
                delete this.iframeBlocks)
            },
            _allowInteraction: function(e) {
                return !!t(e.target).closest(".ui-dialog").length || !!t(e.target).closest(".ui-datepicker").length
            },
            _createOverlay: function() {
                if (this.options.modal) {
                    var e = this
                      , i = this.widgetFullName;
                    t.ui.dialog.overlayInstances || this._delay(function() {
                        t.ui.dialog.overlayInstances && this.document.bind("focusin.dialog", function(n) {
                            e._allowInteraction(n) || (n.preventDefault(),
                            t(".ui-dialog:visible:last .ui-dialog-content").data(i)._focusTabbable())
                        })
                    }),
                    this.overlay = t("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),
                    this._on(this.overlay, {
                        mousedown: "_keepFocus"
                    }),
                    t.ui.dialog.overlayInstances++
                }
            },
            _destroyOverlay: function() {
                this.options.modal && this.overlay && (t.ui.dialog.overlayInstances--,
                t.ui.dialog.overlayInstances || this.document.unbind("focusin.dialog"),
                this.overlay.remove(),
                this.overlay = null)
            }
        }),
        t.ui.dialog.overlayInstances = 0,
        !1 !== t.uiBackCompat && t.widget("ui.dialog", t.ui.dialog, {
            _position: function() {
                var e, i = this.options.position, n = [], r = [0, 0];
                i ? (("string" == typeof i || "object" == typeof i && "0"in i) && (n = i.split ? i.split(" ") : [i[0], i[1]],
                1 === n.length && (n[1] = n[0]),
                t.each(["left", "top"], function(t, e) {
                    +n[t] === n[t] && (r[t] = n[t],
                    n[t] = e)
                }),
                i = {
                    my: n[0] + (r[0] < 0 ? r[0] : "+" + r[0]) + " " + n[1] + (r[1] < 0 ? r[1] : "+" + r[1]),
                    at: n.join(" ")
                }),
                i = t.extend({}, t.ui.dialog.prototype.options.position, i)) : i = t.ui.dialog.prototype.options.position,
                e = this.uiDialog.is(":visible"),
                e || this.uiDialog.show(),
                this.uiDialog.position(i),
                e || this.uiDialog.hide()
            }
        })
    }(n),
    function(t, e) {
        var i = /up|down|vertical/
          , n = /up|left|vertical|horizontal/;
        t.effects.effect.blind = function(e, r) {
            var a, s, o, l = t(this), u = ["position", "top", "bottom", "left", "right", "height", "width"], h = t.effects.setMode(l, e.mode || "hide"), c = e.direction || "up", d = i.test(c), p = d ? "height" : "width", f = d ? "top" : "left", g = n.test(c), m = {}, v = "show" === h;
            l.parent().is(".ui-effects-wrapper") ? t.effects.save(l.parent(), u) : t.effects.save(l, u),
            l.show(),
            a = t.effects.createWrapper(l).css({
                overflow: "hidden"
            }),
            s = a[p](),
            o = parseFloat(a.css(f)) || 0,
            m[p] = v ? s : 0,
            g || (l.css(d ? "bottom" : "right", 0).css(d ? "top" : "left", "auto").css({
                position: "absolute"
            }),
            m[f] = v ? o : s + o),
            v && (a.css(p, 0),
            g || a.css(f, o + s)),
            a.animate(m, {
                duration: e.duration,
                easing: e.easing,
                queue: !1,
                complete: function() {
                    "hide" === h && l.hide(),
                    t.effects.restore(l, u),
                    t.effects.removeWrapper(l),
                    r()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.bounce = function(e, i) {
            var n, r, a, s = t(this), o = ["position", "top", "bottom", "left", "right", "height", "width"], l = t.effects.setMode(s, e.mode || "effect"), u = "hide" === l, h = "show" === l, c = e.direction || "up", d = e.distance, p = e.times || 5, f = 2 * p + (h || u ? 1 : 0), g = e.duration / f, m = e.easing, v = "up" === c || "down" === c ? "top" : "left", _ = "up" === c || "left" === c, b = s.queue(), x = b.length;
            for ((h || u) && o.push("opacity"),
            t.effects.save(s, o),
            s.show(),
            t.effects.createWrapper(s),
            d || (d = s["top" === v ? "outerHeight" : "outerWidth"]() / 3),
            h && (a = {
                opacity: 1
            },
            a[v] = 0,
            s.css("opacity", 0).css(v, _ ? 2 * -d : 2 * d).animate(a, g, m)),
            u && (d /= Math.pow(2, p - 1)),
            a = {},
            a[v] = 0,
            n = 0; n < p; n++)
                r = {},
                r[v] = (_ ? "-=" : "+=") + d,
                s.animate(r, g, m).animate(a, g, m),
                d = u ? 2 * d : d / 2;
            u && (r = {
                opacity: 0
            },
            r[v] = (_ ? "-=" : "+=") + d,
            s.animate(r, g, m)),
            s.queue(function() {
                u && s.hide(),
                t.effects.restore(s, o),
                t.effects.removeWrapper(s),
                i()
            }),
            x > 1 && b.splice.apply(b, [1, 0].concat(b.splice(x, f + 1))),
            s.dequeue()
        }
    }(n),
    function(t, e) {
        t.effects.effect.clip = function(e, i) {
            var n, r, a, s = t(this), o = ["position", "top", "bottom", "left", "right", "height", "width"], l = t.effects.setMode(s, e.mode || "hide"), u = "show" === l, h = e.direction || "vertical", c = "vertical" === h, d = c ? "height" : "width", p = c ? "top" : "left", f = {};
            t.effects.save(s, o),
            s.show(),
            n = t.effects.createWrapper(s).css({
                overflow: "hidden"
            }),
            r = "IMG" === s[0].tagName ? n : s,
            a = r[d](),
            u && (r.css(d, 0),
            r.css(p, a / 2)),
            f[d] = u ? a : 0,
            f[p] = u ? 0 : a / 2,
            r.animate(f, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: function() {
                    u || s.hide(),
                    t.effects.restore(s, o),
                    t.effects.removeWrapper(s),
                    i()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.drop = function(e, i) {
            var n, r = t(this), a = ["position", "top", "bottom", "left", "right", "opacity", "height", "width"], s = t.effects.setMode(r, e.mode || "hide"), o = "show" === s, l = e.direction || "left", u = "up" === l || "down" === l ? "top" : "left", h = "up" === l || "left" === l ? "pos" : "neg", c = {
                opacity: o ? 1 : 0
            };
            t.effects.save(r, a),
            r.show(),
            t.effects.createWrapper(r),
            n = e.distance || r["top" === u ? "outerHeight" : "outerWidth"](!0) / 2,
            o && r.css("opacity", 0).css(u, "pos" === h ? -n : n),
            c[u] = (o ? "pos" === h ? "+=" : "-=" : "pos" === h ? "-=" : "+=") + n,
            r.animate(c, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: function() {
                    "hide" === s && r.hide(),
                    t.effects.restore(r, a),
                    t.effects.removeWrapper(r),
                    i()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.explode = function(e, i) {
            function n() {
                b.push(this),
                b.length === c * d && r()
            }
            function r() {
                p.css({
                    visibility: "visible"
                }),
                t(b).remove(),
                g || p.hide(),
                i()
            }
            var a, s, o, l, u, h, c = e.pieces ? Math.round(Math.sqrt(e.pieces)) : 3, d = c, p = t(this), f = t.effects.setMode(p, e.mode || "hide"), g = "show" === f, m = p.show().css("visibility", "hidden").offset(), v = Math.ceil(p.outerWidth() / d), _ = Math.ceil(p.outerHeight() / c), b = [];
            for (a = 0; a < c; a++)
                for (l = m.top + a * _,
                h = a - (c - 1) / 2,
                s = 0; s < d; s++)
                    o = m.left + s * v,
                    u = s - (d - 1) / 2,
                    p.clone().appendTo("body").wrap("<div></div>").css({
                        position: "absolute",
                        visibility: "visible",
                        left: -s * v,
                        top: -a * _
                    }).parent().addClass("ui-effects-explode").css({
                        position: "absolute",
                        overflow: "hidden",
                        width: v,
                        height: _,
                        left: o + (g ? u * v : 0),
                        top: l + (g ? h * _ : 0),
                        opacity: g ? 0 : 1
                    }).animate({
                        left: o + (g ? 0 : u * v),
                        top: l + (g ? 0 : h * _),
                        opacity: g ? 1 : 0
                    }, e.duration || 500, e.easing, n)
        }
    }(n),
    function(t, e) {
        t.effects.effect.fade = function(e, i) {
            var n = t(this)
              , r = t.effects.setMode(n, e.mode || "toggle");
            n.animate({
                opacity: r
            }, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: i
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.fold = function(e, i) {
            var n, r, a = t(this), s = ["position", "top", "bottom", "left", "right", "height", "width"], o = t.effects.setMode(a, e.mode || "hide"), l = "show" === o, u = "hide" === o, h = e.size || 15, c = /([0-9]+)%/.exec(h), d = !!e.horizFirst, p = l !== d, f = p ? ["width", "height"] : ["height", "width"], g = e.duration / 2, m = {}, v = {};
            t.effects.save(a, s),
            a.show(),
            n = t.effects.createWrapper(a).css({
                overflow: "hidden"
            }),
            r = p ? [n.width(), n.height()] : [n.height(), n.width()],
            c && (h = parseInt(c[1], 10) / 100 * r[u ? 0 : 1]),
            l && n.css(d ? {
                height: 0,
                width: h
            } : {
                height: h,
                width: 0
            }),
            m[f[0]] = l ? r[0] : h,
            v[f[1]] = l ? r[1] : 0,
            n.animate(m, g, e.easing).animate(v, g, e.easing, function() {
                u && a.hide(),
                t.effects.restore(a, s),
                t.effects.removeWrapper(a),
                i()
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.highlight = function(e, i) {
            var n = t(this)
              , r = ["backgroundImage", "backgroundColor", "opacity"]
              , a = t.effects.setMode(n, e.mode || "show")
              , s = {
                backgroundColor: n.css("backgroundColor")
            };
            "hide" === a && (s.opacity = 0),
            t.effects.save(n, r),
            n.show().css({
                backgroundImage: "none",
                backgroundColor: e.color || "#ffff99"
            }).animate(s, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: function() {
                    "hide" === a && n.hide(),
                    t.effects.restore(n, r),
                    i()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.pulsate = function(e, i) {
            var n, r = t(this), a = t.effects.setMode(r, e.mode || "show"), s = "show" === a, o = "hide" === a, l = s || "hide" === a, u = 2 * (e.times || 5) + (l ? 1 : 0), h = e.duration / u, c = 0, d = r.queue(), p = d.length;
            for (!s && r.is(":visible") || (r.css("opacity", 0).show(),
            c = 1),
            n = 1; n < u; n++)
                r.animate({
                    opacity: c
                }, h, e.easing),
                c = 1 - c;
            r.animate({
                opacity: c
            }, h, e.easing),
            r.queue(function() {
                o && r.hide(),
                i()
            }),
            p > 1 && d.splice.apply(d, [1, 0].concat(d.splice(p, u + 1))),
            r.dequeue()
        }
    }(n),
    function(t, e) {
        t.effects.effect.puff = function(e, i) {
            var n = t(this)
              , r = t.effects.setMode(n, e.mode || "hide")
              , a = "hide" === r
              , s = parseInt(e.percent, 10) || 150
              , o = s / 100
              , l = {
                height: n.height(),
                width: n.width(),
                outerHeight: n.outerHeight(),
                outerWidth: n.outerWidth()
            };
            t.extend(e, {
                effect: "scale",
                queue: !1,
                fade: !0,
                mode: r,
                complete: i,
                percent: a ? s : 100,
                from: a ? l : {
                    height: l.height * o,
                    width: l.width * o,
                    outerHeight: l.outerHeight * o,
                    outerWidth: l.outerWidth * o
                }
            }),
            n.effect(e)
        }
        ,
        t.effects.effect.scale = function(e, i) {
            var n = t(this)
              , r = t.extend(!0, {}, e)
              , a = t.effects.setMode(n, e.mode || "effect")
              , s = parseInt(e.percent, 10) || (0 === parseInt(e.percent, 10) ? 0 : "hide" === a ? 0 : 100)
              , o = e.direction || "both"
              , l = e.origin
              , u = {
                height: n.height(),
                width: n.width(),
                outerHeight: n.outerHeight(),
                outerWidth: n.outerWidth()
            }
              , h = {
                y: "horizontal" !== o ? s / 100 : 1,
                x: "vertical" !== o ? s / 100 : 1
            };
            r.effect = "size",
            r.queue = !1,
            r.complete = i,
            "effect" !== a && (r.origin = l || ["middle", "center"],
            r.restore = !0),
            r.from = e.from || ("show" === a ? {
                height: 0,
                width: 0,
                outerHeight: 0,
                outerWidth: 0
            } : u),
            r.to = {
                height: u.height * h.y,
                width: u.width * h.x,
                outerHeight: u.outerHeight * h.y,
                outerWidth: u.outerWidth * h.x
            },
            r.fade && ("show" === a && (r.from.opacity = 0,
            r.to.opacity = 1),
            "hide" === a && (r.from.opacity = 1,
            r.to.opacity = 0)),
            n.effect(r)
        }
        ,
        t.effects.effect.size = function(e, i) {
            var n, r, a, s = t(this), o = ["position", "top", "bottom", "left", "right", "width", "height", "overflow", "opacity"], l = ["position", "top", "bottom", "left", "right", "overflow", "opacity"], u = ["width", "height", "overflow"], h = ["fontSize"], c = ["borderTopWidth", "borderBottomWidth", "paddingTop", "paddingBottom"], d = ["borderLeftWidth", "borderRightWidth", "paddingLeft", "paddingRight"], p = t.effects.setMode(s, e.mode || "effect"), f = e.restore || "effect" !== p, g = e.scale || "both", m = e.origin || ["middle", "center"], v = s.css("position"), _ = f ? o : l, b = {
                height: 0,
                width: 0,
                outerHeight: 0,
                outerWidth: 0
            };
            "show" === p && s.show(),
            n = {
                height: s.height(),
                width: s.width(),
                outerHeight: s.outerHeight(),
                outerWidth: s.outerWidth()
            },
            "toggle" === e.mode && "show" === p ? (s.from = e.to || b,
            s.to = e.from || n) : (s.from = e.from || ("show" === p ? b : n),
            s.to = e.to || ("hide" === p ? b : n)),
            a = {
                from: {
                    y: s.from.height / n.height,
                    x: s.from.width / n.width
                },
                to: {
                    y: s.to.height / n.height,
                    x: s.to.width / n.width
                }
            },
            "box" !== g && "both" !== g || (a.from.y !== a.to.y && (_ = _.concat(c),
            s.from = t.effects.setTransition(s, c, a.from.y, s.from),
            s.to = t.effects.setTransition(s, c, a.to.y, s.to)),
            a.from.x !== a.to.x && (_ = _.concat(d),
            s.from = t.effects.setTransition(s, d, a.from.x, s.from),
            s.to = t.effects.setTransition(s, d, a.to.x, s.to))),
            "content" !== g && "both" !== g || a.from.y !== a.to.y && (_ = _.concat(h).concat(u),
            s.from = t.effects.setTransition(s, h, a.from.y, s.from),
            s.to = t.effects.setTransition(s, h, a.to.y, s.to)),
            t.effects.save(s, _),
            s.show(),
            t.effects.createWrapper(s),
            s.css("overflow", "hidden").css(s.from),
            m && (r = t.effects.getBaseline(m, n),
            s.from.top = (n.outerHeight - s.outerHeight()) * r.y,
            s.from.left = (n.outerWidth - s.outerWidth()) * r.x,
            s.to.top = (n.outerHeight - s.to.outerHeight) * r.y,
            s.to.left = (n.outerWidth - s.to.outerWidth) * r.x),
            s.css(s.from),
            "content" !== g && "both" !== g || (c = c.concat(["marginTop", "marginBottom"]).concat(h),
            d = d.concat(["marginLeft", "marginRight"]),
            u = o.concat(c).concat(d),
            s.find("*[width]").each(function() {
                var i = t(this)
                  , n = {
                    height: i.height(),
                    width: i.width(),
                    outerHeight: i.outerHeight(),
                    outerWidth: i.outerWidth()
                };
                f && t.effects.save(i, u),
                i.from = {
                    height: n.height * a.from.y,
                    width: n.width * a.from.x,
                    outerHeight: n.outerHeight * a.from.y,
                    outerWidth: n.outerWidth * a.from.x
                },
                i.to = {
                    height: n.height * a.to.y,
                    width: n.width * a.to.x,
                    outerHeight: n.height * a.to.y,
                    outerWidth: n.width * a.to.x
                },
                a.from.y !== a.to.y && (i.from = t.effects.setTransition(i, c, a.from.y, i.from),
                i.to = t.effects.setTransition(i, c, a.to.y, i.to)),
                a.from.x !== a.to.x && (i.from = t.effects.setTransition(i, d, a.from.x, i.from),
                i.to = t.effects.setTransition(i, d, a.to.x, i.to)),
                i.css(i.from),
                i.animate(i.to, e.duration, e.easing, function() {
                    f && t.effects.restore(i, u)
                })
            })),
            s.animate(s.to, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: function() {
                    0 === s.to.opacity && s.css("opacity", s.from.opacity),
                    "hide" === p && s.hide(),
                    t.effects.restore(s, _),
                    f || ("static" === v ? s.css({
                        position: "relative",
                        top: s.to.top,
                        left: s.to.left
                    }) : t.each(["top", "left"], function(t, e) {
                        s.css(e, function(e, i) {
                            var n = parseInt(i, 10)
                              , r = t ? s.to.left : s.to.top;
                            return "auto" === i ? r + "px" : n + r + "px"
                        })
                    })),
                    t.effects.removeWrapper(s),
                    i()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.shake = function(e, i) {
            var n, r = t(this), a = ["position", "top", "bottom", "left", "right", "height", "width"], s = t.effects.setMode(r, e.mode || "effect"), o = e.direction || "left", l = e.distance || 20, u = e.times || 3, h = 2 * u + 1, c = Math.round(e.duration / h), d = "up" === o || "down" === o ? "top" : "left", p = "up" === o || "left" === o, f = {}, g = {}, m = {}, v = r.queue(), _ = v.length;
            for (t.effects.save(r, a),
            r.show(),
            t.effects.createWrapper(r),
            f[d] = (p ? "-=" : "+=") + l,
            g[d] = (p ? "+=" : "-=") + 2 * l,
            m[d] = (p ? "-=" : "+=") + 2 * l,
            r.animate(f, c, e.easing),
            n = 1; n < u; n++)
                r.animate(g, c, e.easing).animate(m, c, e.easing);
            r.animate(g, c, e.easing).animate(f, c / 2, e.easing).queue(function() {
                "hide" === s && r.hide(),
                t.effects.restore(r, a),
                t.effects.removeWrapper(r),
                i()
            }),
            _ > 1 && v.splice.apply(v, [1, 0].concat(v.splice(_, h + 1))),
            r.dequeue()
        }
    }(n),
    function(t, e) {
        t.effects.effect.slide = function(e, i) {
            var n, r = t(this), a = ["position", "top", "bottom", "left", "right", "width", "height"], s = t.effects.setMode(r, e.mode || "show"), o = "show" === s, l = e.direction || "left", u = "up" === l || "down" === l ? "top" : "left", h = "up" === l || "left" === l, c = {};
            t.effects.save(r, a),
            r.show(),
            n = e.distance || r["top" === u ? "outerHeight" : "outerWidth"](!0),
            t.effects.createWrapper(r).css({
                overflow: "hidden"
            }),
            o && r.css(u, h ? isNaN(n) ? "-" + n : -n : n),
            c[u] = (o ? h ? "+=" : "-=" : h ? "-=" : "+=") + n,
            r.animate(c, {
                queue: !1,
                duration: e.duration,
                easing: e.easing,
                complete: function() {
                    "hide" === s && r.hide(),
                    t.effects.restore(r, a),
                    t.effects.removeWrapper(r),
                    i()
                }
            })
        }
    }(n),
    function(t, e) {
        t.effects.effect.transfer = function(e, i) {
            var n = t(this)
              , r = t(e.to)
              , a = "fixed" === r.css("position")
              , s = t("body")
              , o = a ? s.scrollTop() : 0
              , l = a ? s.scrollLeft() : 0
              , u = r.offset()
              , h = {
                top: u.top - o,
                left: u.left - l,
                height: r.innerHeight(),
                width: r.innerWidth()
            }
              , c = n.offset()
              , d = t("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({
                top: c.top - o,
                left: c.left - l,
                height: n.innerHeight(),
                width: n.innerWidth(),
                position: a ? "fixed" : "absolute"
            }).animate(h, e.duration, e.easing, function() {
                d.remove(),
                i()
            })
        }
    }(n),
    function(t, e) {
        t.widget("ui.menu", {
            version: "1.10.3",
            defaultElement: "<ul>",
            delay: 300,
            options: {
                icons: {
                    submenu: "ui-icon-carat-1-e"
                },
                menus: "ul",
                position: {
                    my: "left top",
                    at: "right top"
                },
                role: "menu",
                blur: null,
                focus: null,
                select: null
            },
            _create: function() {
                this.activeMenu = this.element,
                this.mouseHandled = !1,
                this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons", !!this.element.find(".ui-icon").length).attr({
                    role: this.options.role,
                    tabIndex: 0
                }).bind("click" + this.eventNamespace, t.proxy(function(t) {
                    this.options.disabled && t.preventDefault()
                }, this)),
                this.options.disabled && this.element.addClass("ui-state-disabled").attr("aria-disabled", "true"),
                this._on({
                    "mousedown .ui-menu-item > a": function(t) {
                        t.preventDefault()
                    },
                    "click .ui-state-disabled > a": function(t) {
                        t.preventDefault()
                    },
                    "click .ui-menu-item:has(a)": function(e) {
                        var i = t(e.target).closest(".ui-menu-item");
                        !this.mouseHandled && i.not(".ui-state-disabled").length && (this.mouseHandled = !0,
                        this.select(e),
                        i.has(".ui-menu").length ? this.expand(e) : this.element.is(":focus") || (this.element.trigger("focus", [!0]),
                        this.active && 1 === this.active.parents(".ui-menu").length && clearTimeout(this.timer)))
                    },
                    "mouseenter .ui-menu-item": function(e) {
                        var i = t(e.currentTarget);
                        i.siblings().children(".ui-state-active").removeClass("ui-state-active"),
                        this.focus(e, i)
                    },
                    mouseleave: "collapseAll",
                    "mouseleave .ui-menu": "collapseAll",
                    focus: function(t, e) {
                        var i = this.active || this.element.children(".ui-menu-item").eq(0);
                        e || this.focus(t, i)
                    },
                    blur: function(e) {
                        this._delay(function() {
                            t.contains(this.element[0], this.document[0].activeElement) || this.collapseAll(e)
                        })
                    },
                    keydown: "_keydown"
                }),
                this.refresh(),
                this._on(this.document, {
                    click: function(e) {
                        t(e.target).closest(".ui-menu").length || this.collapseAll(e),
                        this.mouseHandled = !1
                    }
                })
            },
            _destroy: function() {
                this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),
                this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function() {
                    var e = t(this);
                    e.data("ui-menu-submenu-carat") && e.remove()
                }),
                this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")
            },
            _keydown: function(e) {
                function i(t) {
                    return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
                }
                var n, r, a, s, o, l = !0;
                switch (e.keyCode) {
                case t.ui.keyCode.PAGE_UP:
                    this.previousPage(e);
                    break;
                case t.ui.keyCode.PAGE_DOWN:
                    this.nextPage(e);
                    break;
                case t.ui.keyCode.HOME:
                    this._move("first", "first", e);
                    break;
                case t.ui.keyCode.END:
                    this._move("last", "last", e);
                    break;
                case t.ui.keyCode.UP:
                    this.previous(e);
                    break;
                case t.ui.keyCode.DOWN:
                    this.next(e);
                    break;
                case t.ui.keyCode.LEFT:
                    this.collapse(e);
                    break;
                case t.ui.keyCode.RIGHT:
                    this.active && !this.active.is(".ui-state-disabled") && this.expand(e);
                    break;
                case t.ui.keyCode.ENTER:
                case t.ui.keyCode.SPACE:
                    this._activate(e);
                    break;
                case t.ui.keyCode.ESCAPE:
                    this.collapse(e);
                    break;
                default:
                    l = !1,
                    r = this.previousFilter || "",
                    a = String.fromCharCode(e.keyCode),
                    s = !1,
                    clearTimeout(this.filterTimer),
                    a === r ? s = !0 : a = r + a,
                    o = new RegExp("^" + i(a),"i"),
                    n = this.activeMenu.children(".ui-menu-item").filter(function() {
                        return o.test(t(this).children("a").text())
                    }),
                    n = s && -1 !== n.index(this.active.next()) ? this.active.nextAll(".ui-menu-item") : n,
                    n.length || (a = String.fromCharCode(e.keyCode),
                    o = new RegExp("^" + i(a),"i"),
                    n = this.activeMenu.children(".ui-menu-item").filter(function() {
                        return o.test(t(this).children("a").text())
                    })),
                    n.length ? (this.focus(e, n),
                    n.length > 1 ? (this.previousFilter = a,
                    this.filterTimer = this._delay(function() {
                        delete this.previousFilter
                    }, 1e3)) : delete this.previousFilter) : delete this.previousFilter
                }
                l && e.preventDefault()
            },
            _activate: function(t) {
                this.active.is(".ui-state-disabled") || (this.active.children("a[aria-haspopup='true']").length ? this.expand(t) : this.select(t))
            },
            refresh: function() {
                var e, i = this.options.icons.submenu, n = this.element.find(this.options.menus);
                n.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({
                    role: this.options.role,
                    "aria-hidden": "true",
                    "aria-expanded": "false"
                }).each(function() {
                    var e = t(this)
                      , n = e.prev("a")
                      , r = t("<span>").addClass("ui-menu-icon ui-icon " + i).data("ui-menu-submenu-carat", !0);
                    n.attr("aria-haspopup", "true").prepend(r),
                    e.attr("aria-labelledby", n.attr("id"))
                }),
                e = n.add(this.element),
                e.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role", "presentation").children("a").uniqueId().addClass("ui-corner-all").attr({
                    tabIndex: -1,
                    role: this._itemRole()
                }),
                e.children(":not(.ui-menu-item)").each(function() {
                    var e = t(this);
                    /[^\-\u2014\u2013\s]/.test(e.text()) || e.addClass("ui-widget-content ui-menu-divider")
                }),
                e.children(".ui-state-disabled").attr("aria-disabled", "true"),
                this.active && !t.contains(this.element[0], this.active[0]) && this.blur()
            },
            _itemRole: function() {
                return {
                    menu: "menuitem",
                    listbox: "option"
                }[this.options.role]
            },
            _setOption: function(t, e) {
                "icons" === t && this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),
                this._super(t, e)
            },
            focus: function(t, e) {
                var i, n;
                this.blur(t, t && "focus" === t.type),
                this._scrollIntoView(e),
                this.active = e.first(),
                n = this.active.children("a").addClass("ui-state-focus"),
                this.options.role && this.element.attr("aria-activedescendant", n.attr("id")),
                this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),
                t && "keydown" === t.type ? this._close() : this.timer = this._delay(function() {
                    this._close()
                }, this.delay),
                i = e.children(".ui-menu"),
                i.length && /^mouse/.test(t.type) && this._startOpening(i),
                this.activeMenu = e.parent(),
                this._trigger("focus", t, {
                    item: e
                })
            },
            _scrollIntoView: function(e) {
                var i, n, r, a, s, o;
                this._hasScroll() && (i = parseFloat(t.css(this.activeMenu[0], "borderTopWidth")) || 0,
                n = parseFloat(t.css(this.activeMenu[0], "paddingTop")) || 0,
                r = e.offset().top - this.activeMenu.offset().top - i - n,
                a = this.activeMenu.scrollTop(),
                s = this.activeMenu.height(),
                o = e.height(),
                r < 0 ? this.activeMenu.scrollTop(a + r) : r + o > s && this.activeMenu.scrollTop(a + r - s + o))
            },
            blur: function(t, e) {
                e || clearTimeout(this.timer),
                this.active && (this.active.children("a").removeClass("ui-state-focus"),
                this.active = null,
                this._trigger("blur", t, {
                    item: this.active
                }))
            },
            _startOpening: function(t) {
                clearTimeout(this.timer),
                "true" === t.attr("aria-hidden") && (this.timer = this._delay(function() {
                    this._close(),
                    this._open(t)
                }, this.delay))
            },
            _open: function(e) {
                var i = t.extend({
                    of: this.active
                }, this.options.position);
                clearTimeout(this.timer),
                this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden", "true"),
                e.show().removeAttr("aria-hidden").attr("aria-expanded", "true").position(i)
            },
            collapseAll: function(e, i) {
                clearTimeout(this.timer),
                this.timer = this._delay(function() {
                    var n = i ? this.element : t(e && e.target).closest(this.element.find(".ui-menu"));
                    n.length || (n = this.element),
                    this._close(n),
                    this.blur(e),
                    this.activeMenu = n
                }, this.delay)
            },
            _close: function(t) {
                t || (t = this.active ? this.active.parent() : this.element),
                t.find(".ui-menu").hide().attr("aria-hidden", "true").attr("aria-expanded", "false").end().find("a.ui-state-active").removeClass("ui-state-active")
            },
            collapse: function(t) {
                var e = this.active && this.active.parent().closest(".ui-menu-item", this.element);
                e && e.length && (this._close(),
                this.focus(t, e))
            },
            expand: function(t) {
                var e = this.active && this.active.children(".ui-menu ").children(".ui-menu-item").first();
                e && e.length && (this._open(e.parent()),
                this._delay(function() {
                    this.focus(t, e)
                }))
            },
            next: function(t) {
                this._move("next", "first", t)
            },
            previous: function(t) {
                this._move("prev", "last", t)
            },
            isFirstItem: function() {
                return this.active && !this.active.prevAll(".ui-menu-item").length
            },
            isLastItem: function() {
                return this.active && !this.active.nextAll(".ui-menu-item").length
            },
            _move: function(t, e, i) {
                var n;
                this.active && (n = "first" === t || "last" === t ? this.active["first" === t ? "prevAll" : "nextAll"](".ui-menu-item").eq(-1) : this.active[t + "All"](".ui-menu-item").eq(0)),
                n && n.length && this.active || (n = this.activeMenu.children(".ui-menu-item")[e]()),
                this.focus(i, n)
            },
            nextPage: function(e) {
                var i, n, r;
                if (!this.active)
                    return void this.next(e);
                this.isLastItem() || (this._hasScroll() ? (n = this.active.offset().top,
                r = this.element.height(),
                this.active.nextAll(".ui-menu-item").each(function() {
                    return i = t(this),
                    i.offset().top - n - r < 0
                }),
                this.focus(e, i)) : this.focus(e, this.activeMenu.children(".ui-menu-item")[this.active ? "last" : "first"]()))
            },
            previousPage: function(e) {
                var i, n, r;
                if (!this.active)
                    return void this.next(e);
                this.isFirstItem() || (this._hasScroll() ? (n = this.active.offset().top,
                r = this.element.height(),
                this.active.prevAll(".ui-menu-item").each(function() {
                    return i = t(this),
                    i.offset().top - n + r > 0
                }),
                this.focus(e, i)) : this.focus(e, this.activeMenu.children(".ui-menu-item").first()))
            },
            _hasScroll: function() {
                return this.element.outerHeight() < this.element.prop("scrollHeight")
            },
            select: function(e) {
                this.active = this.active || t(e.target).closest(".ui-menu-item");
                var i = {
                    item: this.active
                };
                this.active.has(".ui-menu").length || this.collapseAll(e, !0),
                this._trigger("select", e, i)
            }
        })
    }(n),
    function(t, e) {
        function i(t, e, i) {
            return [parseFloat(t[0]) * (p.test(t[0]) ? e / 100 : 1), parseFloat(t[1]) * (p.test(t[1]) ? i / 100 : 1)]
        }
        function n(e, i) {
            return parseInt(t.css(e, i), 10) || 0
        }
        function r(e) {
            var i = e[0];
            return 9 === i.nodeType ? {
                width: e.width(),
                height: e.height(),
                offset: {
                    top: 0,
                    left: 0
                }
            } : t.isWindow(i) ? {
                width: e.width(),
                height: e.height(),
                offset: {
                    top: e.scrollTop(),
                    left: e.scrollLeft()
                }
            } : i.preventDefault ? {
                width: 0,
                height: 0,
                offset: {
                    top: i.pageY,
                    left: i.pageX
                }
            } : {
                width: e.outerWidth(),
                height: e.outerHeight(),
                offset: e.offset()
            }
        }
        t.ui = t.ui || {};
        var a, s = Math.max, o = Math.abs, l = Math.round, u = /left|center|right/, h = /top|center|bottom/, c = /[\+\-]\d+(\.[\d]+)?%?/, d = /^\w+/, p = /%$/, f = t.fn.position;
        t.position = {
            scrollbarWidth: function() {
                if (void 0 !== a)
                    return a;
                var e, i, n = t("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"), r = n.children()[0];
                return t("body").append(n),
                e = r.offsetWidth,
                n.css("overflow", "scroll"),
                i = r.offsetWidth,
                e === i && (i = n[0].clientWidth),
                n.remove(),
                a = e - i
            },
            getScrollInfo: function(e) {
                var i = e.isWindow ? "" : e.element.css("overflow-x")
                  , n = e.isWindow ? "" : e.element.css("overflow-y")
                  , r = "scroll" === i || "auto" === i && e.width < e.element[0].scrollWidth;
                return {
                    width: "scroll" === n || "auto" === n && e.height < e.element[0].scrollHeight ? t.position.scrollbarWidth() : 0,
                    height: r ? t.position.scrollbarWidth() : 0
                }
            },
            getWithinInfo: function(e) {
                var i = t(e || window)
                  , n = t.isWindow(i[0]);
                return {
                    element: i,
                    isWindow: n,
                    offset: i.offset() || {
                        left: 0,
                        top: 0
                    },
                    scrollLeft: i.scrollLeft(),
                    scrollTop: i.scrollTop(),
                    width: n ? i.width() : i.outerWidth(),
                    height: n ? i.height() : i.outerHeight()
                }
            }
        },
        t.fn.position = function(e) {
            if (!e || !e.of)
                return f.apply(this, arguments);
            e = t.extend({}, e);
            var a, p, g, m, v, _, b = t(e.of), x = t.position.getWithinInfo(e.within), y = t.position.getScrollInfo(x), S = (e.collision || "flip").split(" "), w = {};
            return _ = r(b),
            b[0].preventDefault && (e.at = "left top"),
            p = _.width,
            g = _.height,
            m = _.offset,
            v = t.extend({}, m),
            t.each(["my", "at"], function() {
                var t, i, n = (e[this] || "").split(" ");
                1 === n.length && (n = u.test(n[0]) ? n.concat(["center"]) : h.test(n[0]) ? ["center"].concat(n) : ["center", "center"]),
                n[0] = u.test(n[0]) ? n[0] : "center",
                n[1] = h.test(n[1]) ? n[1] : "center",
                t = c.exec(n[0]),
                i = c.exec(n[1]),
                w[this] = [t ? t[0] : 0, i ? i[0] : 0],
                e[this] = [d.exec(n[0])[0], d.exec(n[1])[0]]
            }),
            1 === S.length && (S[1] = S[0]),
            "right" === e.at[0] ? v.left += p : "center" === e.at[0] && (v.left += p / 2),
            "bottom" === e.at[1] ? v.top += g : "center" === e.at[1] && (v.top += g / 2),
            a = i(w.at, p, g),
            v.left += a[0],
            v.top += a[1],
            this.each(function() {
                var r, u, h = t(this), c = h.outerWidth(), d = h.outerHeight(), f = n(this, "marginLeft"), _ = n(this, "marginTop"), C = c + f + n(this, "marginRight") + y.width, M = d + _ + n(this, "marginBottom") + y.height, T = t.extend({}, v), A = i(w.my, h.outerWidth(), h.outerHeight());
                "right" === e.my[0] ? T.left -= c : "center" === e.my[0] && (T.left -= c / 2),
                "bottom" === e.my[1] ? T.top -= d : "center" === e.my[1] && (T.top -= d / 2),
                T.left += A[0],
                T.top += A[1],
                t.support.offsetFractions || (T.left = l(T.left),
                T.top = l(T.top)),
                r = {
                    marginLeft: f,
                    marginTop: _
                },
                t.each(["left", "top"], function(i, n) {
                    t.ui.position[S[i]] && t.ui.position[S[i]][n](T, {
                        targetWidth: p,
                        targetHeight: g,
                        elemWidth: c,
                        elemHeight: d,
                        collisionPosition: r,
                        collisionWidth: C,
                        collisionHeight: M,
                        offset: [a[0] + A[0], a[1] + A[1]],
                        my: e.my,
                        at: e.at,
                        within: x,
                        elem: h
                    })
                }),
                e.using && (u = function(t) {
                    var i = m.left - T.left
                      , n = i + p - c
                      , r = m.top - T.top
                      , a = r + g - d
                      , l = {
                        target: {
                            element: b,
                            left: m.left,
                            top: m.top,
                            width: p,
                            height: g
                        },
                        element: {
                            element: h,
                            left: T.left,
                            top: T.top,
                            width: c,
                            height: d
                        },
                        horizontal: n < 0 ? "left" : i > 0 ? "right" : "center",
                        vertical: a < 0 ? "top" : r > 0 ? "bottom" : "middle"
                    };
                    p < c && o(i + n) < p && (l.horizontal = "center"),
                    g < d && o(r + a) < g && (l.vertical = "middle"),
                    s(o(i), o(n)) > s(o(r), o(a)) ? l.important = "horizontal" : l.important = "vertical",
                    e.using.call(this, t, l)
                }
                ),
                h.offset(t.extend(T, {
                    using: u
                }))
            })
        }
        ,
        t.ui.position = {
            fit: {
                left: function(t, e) {
                    var i, n = e.within, r = n.isWindow ? n.scrollLeft : n.offset.left, a = n.width, o = t.left - e.collisionPosition.marginLeft, l = r - o, u = o + e.collisionWidth - a - r;
                    e.collisionWidth > a ? l > 0 && u <= 0 ? (i = t.left + l + e.collisionWidth - a - r,
                    t.left += l - i) : t.left = u > 0 && l <= 0 ? r : l > u ? r + a - e.collisionWidth : r : l > 0 ? t.left += l : u > 0 ? t.left -= u : t.left = s(t.left - o, t.left)
                },
                top: function(t, e) {
                    var i, n = e.within, r = n.isWindow ? n.scrollTop : n.offset.top, a = e.within.height, o = t.top - e.collisionPosition.marginTop, l = r - o, u = o + e.collisionHeight - a - r;
                    e.collisionHeight > a ? l > 0 && u <= 0 ? (i = t.top + l + e.collisionHeight - a - r,
                    t.top += l - i) : t.top = u > 0 && l <= 0 ? r : l > u ? r + a - e.collisionHeight : r : l > 0 ? t.top += l : u > 0 ? t.top -= u : t.top = s(t.top - o, t.top)
                }
            },
            flip: {
                left: function(t, e) {
                    var i, n, r = e.within, a = r.offset.left + r.scrollLeft, s = r.width, l = r.isWindow ? r.scrollLeft : r.offset.left, u = t.left - e.collisionPosition.marginLeft, h = u - l, c = u + e.collisionWidth - s - l, d = "left" === e.my[0] ? -e.elemWidth : "right" === e.my[0] ? e.elemWidth : 0, p = "left" === e.at[0] ? e.targetWidth : "right" === e.at[0] ? -e.targetWidth : 0, f = -2 * e.offset[0];
                    h < 0 ? ((i = t.left + d + p + f + e.collisionWidth - s - a) < 0 || i < o(h)) && (t.left += d + p + f) : c > 0 && ((n = t.left - e.collisionPosition.marginLeft + d + p + f - l) > 0 || o(n) < c) && (t.left += d + p + f)
                },
                top: function(t, e) {
                    var i, n, r = e.within, a = r.offset.top + r.scrollTop, s = r.height, l = r.isWindow ? r.scrollTop : r.offset.top, u = t.top - e.collisionPosition.marginTop, h = u - l, c = u + e.collisionHeight - s - l, d = "top" === e.my[1], p = d ? -e.elemHeight : "bottom" === e.my[1] ? e.elemHeight : 0, f = "top" === e.at[1] ? e.targetHeight : "bottom" === e.at[1] ? -e.targetHeight : 0, g = -2 * e.offset[1];
                    h < 0 ? (n = t.top + p + f + g + e.collisionHeight - s - a,
                    t.top + p + f + g > h && (n < 0 || n < o(h)) && (t.top += p + f + g)) : c > 0 && (i = t.top - e.collisionPosition.marginTop + p + f + g - l,
                    t.top + p + f + g > c && (i > 0 || o(i) < c) && (t.top += p + f + g))
                }
            },
            flipfit: {
                left: function() {
                    t.ui.position.flip.left.apply(this, arguments),
                    t.ui.position.fit.left.apply(this, arguments)
                },
                top: function() {
                    t.ui.position.flip.top.apply(this, arguments),
                    t.ui.position.fit.top.apply(this, arguments)
                }
            }
        },
        function() {
            var e, i, n, r, a, s = document.getElementsByTagName("body")[0], o = document.createElement("div");
            e = document.createElement(s ? "div" : "body"),
            n = {
                visibility: "hidden",
                width: 0,
                height: 0,
                border: 0,
                margin: 0,
                background: "none"
            },
            s && t.extend(n, {
                position: "absolute",
                left: "-1000px",
                top: "-1000px"
            });
            for (a in n)
                e.style[a] = n[a];
            e.appendChild(o),
            i = s || document.documentElement,
            i.insertBefore(e, i.firstChild),
            o.style.cssText = "position: absolute; left: 10.7432222px;",
            r = t(o).offset().left,
            t.support.offsetFractions = r > 10 && r < 11,
            e.innerHTML = "",
            i.removeChild(e)
        }()
    }(n),
    function(t, e) {
        t.widget("ui.progressbar", {
            version: "1.10.3",
            options: {
                max: 100,
                value: 0,
                change: null,
                complete: null
            },
            min: 0,
            _create: function() {
                this.oldValue = this.options.value = this._constrainedValue(),
                this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({
                    role: "progressbar",
                    "aria-valuemin": this.min
                }),
                this.valueDiv = t("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),
                this._refreshValue()
            },
            _destroy: function() {
                this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),
                this.valueDiv.remove()
            },
            value: function(t) {
                if (void 0 === t)
                    return this.options.value;
                this.options.value = this._constrainedValue(t),
                this._refreshValue()
            },
            _constrainedValue: function(t) {
                return void 0 === t && (t = this.options.value),
                this.indeterminate = !1 === t,
                "number" != typeof t && (t = 0),
                !this.indeterminate && Math.min(this.options.max, Math.max(this.min, t))
            },
            _setOptions: function(t) {
                var e = t.value;
                delete t.value,
                this._super(t),
                this.options.value = this._constrainedValue(e),
                this._refreshValue()
            },
            _setOption: function(t, e) {
                "max" === t && (e = Math.max(this.min, e)),
                this._super(t, e)
            },
            _percentage: function() {
                return this.indeterminate ? 100 : 100 * (this.options.value - this.min) / (this.options.max - this.min)
            },
            _refreshValue: function() {
                var e = this.options.value
                  , i = this._percentage();
                this.valueDiv.toggle(this.indeterminate || e > this.min).toggleClass("ui-corner-right", e === this.options.max).width(i.toFixed(0) + "%"),
                this.element.toggleClass("ui-progressbar-indeterminate", this.indeterminate),
                this.indeterminate ? (this.element.removeAttr("aria-valuenow"),
                this.overlayDiv || (this.overlayDiv = t("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))) : (this.element.attr({
                    "aria-valuemax": this.options.max,
                    "aria-valuenow": e
                }),
                this.overlayDiv && (this.overlayDiv.remove(),
                this.overlayDiv = null)),
                this.oldValue !== e && (this.oldValue = e,
                this._trigger("change")),
                e === this.options.max && this._trigger("complete")
            }
        })
    }(n),
    function(t, e) {
        t.widget("ui.slider", t.ui.mouse, {
            version: "1.10.3",
            widgetEventPrefix: "slide",
            options: {
                animate: !1,
                distance: 0,
                max: 100,
                min: 0,
                orientation: "horizontal",
                range: !1,
                step: 1,
                value: 0,
                values: null,
                change: null,
                slide: null,
                start: null,
                stop: null
            },
            _create: function() {
                this._keySliding = !1,
                this._mouseSliding = !1,
                this._animateOff = !0,
                this._handleIndex = null,
                this._detectOrientation(),
                this._mouseInit(),
                this.element.addClass("ui-slider ui-slider-" + this.orientation + " ui-widget ui-widget-content ui-corner-all"),
                this._refresh(),
                this._setOption("disabled", this.options.disabled),
                this._animateOff = !1
            },
            _refresh: function() {
                this._createRange(),
                this._createHandles(),
                this._setupEvents(),
                this._refreshValue()
            },
            _createHandles: function() {
                var e, i, n = this.options, r = this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"), a = [];
                for (i = n.values && n.values.length || 1,
                r.length > i && (r.slice(i).remove(),
                r = r.slice(0, i)),
                e = r.length; e < i; e++)
                    a.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");
                this.handles = r.add(t(a.join("")).appendTo(this.element)),
                this.handle = this.handles.eq(0),
                this.handles.each(function(e) {
                    t(this).data("ui-slider-handle-index", e)
                })
            },
            _createRange: function() {
                var e = this.options
                  , i = "";
                e.range ? (!0 === e.range && (e.values ? e.values.length && 2 !== e.values.length ? e.values = [e.values[0], e.values[0]] : t.isArray(e.values) && (e.values = e.values.slice(0)) : e.values = [this._valueMin(), this._valueMin()]),
                this.range && this.range.length ? this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({
                    left: "",
                    bottom: ""
                }) : (this.range = t("<div></div>").appendTo(this.element),
                i = "ui-slider-range ui-widget-header ui-corner-all"),
                this.range.addClass(i + ("min" === e.range || "max" === e.range ? " ui-slider-range-" + e.range : ""))) : this.range = t([])
            },
            _setupEvents: function() {
                var t = this.handles.add(this.range).filter("a");
                this._off(t),
                this._on(t, this._handleEvents),
                this._hoverable(t),
                this._focusable(t)
            },
            _destroy: function() {
                this.handles.remove(),
                this.range.remove(),
                this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),
                this._mouseDestroy()
            },
            _mouseCapture: function(e) {
                var i, n, r, a, s, o, l, u = this, h = this.options;
                return !h.disabled && (this.elementSize = {
                    width: this.element.outerWidth(),
                    height: this.element.outerHeight()
                },
                this.elementOffset = this.element.offset(),
                i = {
                    x: e.pageX,
                    y: e.pageY
                },
                n = this._normValueFromMouse(i),
                r = this._valueMax() - this._valueMin() + 1,
                this.handles.each(function(e) {
                    var i = Math.abs(n - u.values(e));
                    (r > i || r === i && (e === u._lastChangedValue || u.values(e) === h.min)) && (r = i,
                    a = t(this),
                    s = e)
                }),
                !1 !== this._start(e, s) && (this._mouseSliding = !0,
                this._handleIndex = s,
                a.addClass("ui-state-active").focus(),
                o = a.offset(),
                l = !t(e.target).parents().addBack().is(".ui-slider-handle"),
                this._clickOffset = l ? {
                    left: 0,
                    top: 0
                } : {
                    left: e.pageX - o.left - a.width() / 2,
                    top: e.pageY - o.top - a.height() / 2 - (parseInt(a.css("borderTopWidth"), 10) || 0) - (parseInt(a.css("borderBottomWidth"), 10) || 0) + (parseInt(a.css("marginTop"), 10) || 0)
                },
                this.handles.hasClass("ui-state-hover") || this._slide(e, s, n),
                this._animateOff = !0,
                !0))
            },
            _mouseStart: function() {
                return !0
            },
            _mouseDrag: function(t) {
                var e = {
                    x: t.pageX,
                    y: t.pageY
                }
                  , i = this._normValueFromMouse(e);
                return this._slide(t, this._handleIndex, i),
                !1
            },
            _mouseStop: function(t) {
                return this.handles.removeClass("ui-state-active"),
                this._mouseSliding = !1,
                this._stop(t, this._handleIndex),
                this._change(t, this._handleIndex),
                this._handleIndex = null,
                this._clickOffset = null,
                this._animateOff = !1,
                !1
            },
            _detectOrientation: function() {
                this.orientation = "vertical" === this.options.orientation ? "vertical" : "horizontal"
            },
            _normValueFromMouse: function(t) {
                var e, i, n, r, a;
                return "horizontal" === this.orientation ? (e = this.elementSize.width,
                i = t.x - this.elementOffset.left - (this._clickOffset ? this._clickOffset.left : 0)) : (e = this.elementSize.height,
                i = t.y - this.elementOffset.top - (this._clickOffset ? this._clickOffset.top : 0)),
                n = i / e,
                n > 1 && (n = 1),
                n < 0 && (n = 0),
                "vertical" === this.orientation && (n = 1 - n),
                r = this._valueMax() - this._valueMin(),
                a = this._valueMin() + n * r,
                this._trimAlignValue(a)
            },
            _start: function(t, e) {
                var i = {
                    handle: this.handles[e],
                    value: this.value()
                };
                return this.options.values && this.options.values.length && (i.value = this.values(e),
                i.values = this.values()),
                this._trigger("start", t, i)
            },
            _slide: function(t, e, i) {
                var n, r, a;
                this.options.values && this.options.values.length ? (n = this.values(e ? 0 : 1),
                2 === this.options.values.length && !0 === this.options.range && (0 === e && i > n || 1 === e && i < n) && (i = n),
                i !== this.values(e) && (r = this.values(),
                r[e] = i,
                a = this._trigger("slide", t, {
                    handle: this.handles[e],
                    value: i,
                    values: r
                }),
                n = this.values(e ? 0 : 1),
                !1 !== a && this.values(e, i, !0))) : i !== this.value() && !1 !== (a = this._trigger("slide", t, {
                    handle: this.handles[e],
                    value: i
                })) && this.value(i)
            },
            _stop: function(t, e) {
                var i = {
                    handle: this.handles[e],
                    value: this.value()
                };
                this.options.values && this.options.values.length && (i.value = this.values(e),
                i.values = this.values()),
                this._trigger("stop", t, i)
            },
            _change: function(t, e) {
                if (!this._keySliding && !this._mouseSliding) {
                    var i = {
                        handle: this.handles[e],
                        value: this.value()
                    };
                    this.options.values && this.options.values.length && (i.value = this.values(e),
                    i.values = this.values()),
                    this._lastChangedValue = e,
                    this._trigger("change", t, i)
                }
            },
            value: function(t) {
                return arguments.length ? (this.options.value = this._trimAlignValue(t),
                this._refreshValue(),
                void this._change(null, 0)) : this._value()
            },
            values: function(e, i) {
                var n, r, a;
                if (arguments.length > 1)
                    return this.options.values[e] = this._trimAlignValue(i),
                    this._refreshValue(),
                    void this._change(null, e);
                if (!arguments.length)
                    return this._values();
                if (!t.isArray(arguments[0]))
                    return this.options.values && this.options.values.length ? this._values(e) : this.value();
                for (n = this.options.values,
                r = arguments[0],
                a = 0; a < n.length; a += 1)
                    n[a] = this._trimAlignValue(r[a]),
                    this._change(null, a);
                this._refreshValue()
            },
            _setOption: function(e, i) {
                var n, r = 0;
                switch ("range" === e && !0 === this.options.range && ("min" === i ? (this.options.value = this._values(0),
                this.options.values = null) : "max" === i && (this.options.value = this._values(this.options.values.length - 1),
                this.options.values = null)),
                t.isArray(this.options.values) && (r = this.options.values.length),
                t.Widget.prototype._setOption.apply(this, arguments),
                e) {
                case "orientation":
                    this._detectOrientation(),
                    this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-" + this.orientation),
                    this._refreshValue();
                    break;
                case "value":
                    this._animateOff = !0,
                    this._refreshValue(),
                    this._change(null, 0),
                    this._animateOff = !1;
                    break;
                case "values":
                    for (this._animateOff = !0,
                    this._refreshValue(),
                    n = 0; n < r; n += 1)
                        this._change(null, n);
                    this._animateOff = !1;
                    break;
                case "min":
                case "max":
                    this._animateOff = !0,
                    this._refreshValue(),
                    this._animateOff = !1;
                    break;
                case "range":
                    this._animateOff = !0,
                    this._refresh(),
                    this._animateOff = !1
                }
            },
            _value: function() {
                var t = this.options.value;
                return t = this._trimAlignValue(t)
            },
            _values: function(t) {
                var e, i, n;
                if (arguments.length)
                    return e = this.options.values[t],
                    e = this._trimAlignValue(e);
                if (this.options.values && this.options.values.length) {
                    for (i = this.options.values.slice(),
                    n = 0; n < i.length; n += 1)
                        i[n] = this._trimAlignValue(i[n]);
                    return i
                }
                return []
            },
            _trimAlignValue: function(t) {
                if (t <= this._valueMin())
                    return this._valueMin();
                if (t >= this._valueMax())
                    return this._valueMax();
                var e = this.options.step > 0 ? this.options.step : 1
                  , i = (t - this._valueMin()) % e
                  , n = t - i;
                return 2 * Math.abs(i) >= e && (n += i > 0 ? e : -e),
                parseFloat(n.toFixed(5))
            },
            _valueMin: function() {
                return this.options.min
            },
            _valueMax: function() {
                return this.options.max
            },
            _refreshValue: function() {
                var e, i, n, r, a, s = this.options.range, o = this.options, l = this, u = !this._animateOff && o.animate, h = {};
                this.options.values && this.options.values.length ? this.handles.each(function(n) {
                    i = (l.values(n) - l._valueMin()) / (l._valueMax() - l._valueMin()) * 100,
                    h["horizontal" === l.orientation ? "left" : "bottom"] = i + "%",
                    t(this).stop(1, 1)[u ? "animate" : "css"](h, o.animate),
                    !0 === l.options.range && ("horizontal" === l.orientation ? (0 === n && l.range.stop(1, 1)[u ? "animate" : "css"]({
                        left: i + "%"
                    }, o.animate),
                    1 === n && l.range[u ? "animate" : "css"]({
                        width: i - e + "%"
                    }, {
                        queue: !1,
                        duration: o.animate
                    })) : (0 === n && l.range.stop(1, 1)[u ? "animate" : "css"]({
                        bottom: i + "%"
                    }, o.animate),
                    1 === n && l.range[u ? "animate" : "css"]({
                        height: i - e + "%"
                    }, {
                        queue: !1,
                        duration: o.animate
                    }))),
                    e = i
                }) : (n = this.value(),
                r = this._valueMin(),
                a = this._valueMax(),
                i = a !== r ? (n - r) / (a - r) * 100 : 0,
                h["horizontal" === this.orientation ? "left" : "bottom"] = i + "%",
                this.handle.stop(1, 1)[u ? "animate" : "css"](h, o.animate),
                "min" === s && "horizontal" === this.orientation && this.range.stop(1, 1)[u ? "animate" : "css"]({
                    width: i + "%"
                }, o.animate),
                "max" === s && "horizontal" === this.orientation && this.range[u ? "animate" : "css"]({
                    width: 100 - i + "%"
                }, {
                    queue: !1,
                    duration: o.animate
                }),
                "min" === s && "vertical" === this.orientation && this.range.stop(1, 1)[u ? "animate" : "css"]({
                    height: i + "%"
                }, o.animate),
                "max" === s && "vertical" === this.orientation && this.range[u ? "animate" : "css"]({
                    height: 100 - i + "%"
                }, {
                    queue: !1,
                    duration: o.animate
                }))
            },
            _handleEvents: {
                keydown: function(e) {
                    var i, n, r, a = t(e.target).data("ui-slider-handle-index");
                    switch (e.keyCode) {
                    case t.ui.keyCode.HOME:
                    case t.ui.keyCode.END:
                    case t.ui.keyCode.PAGE_UP:
                    case t.ui.keyCode.PAGE_DOWN:
                    case t.ui.keyCode.UP:
                    case t.ui.keyCode.RIGHT:
                    case t.ui.keyCode.DOWN:
                    case t.ui.keyCode.LEFT:
                        if (e.preventDefault(),
                        !this._keySliding && (this._keySliding = !0,
                        t(e.target).addClass("ui-state-active"),
                        !1 === this._start(e, a)))
                            return
                    }
                    switch (r = this.options.step,
                    i = n = this.options.values && this.options.values.length ? this.values(a) : this.value(),
                    e.keyCode) {
                    case t.ui.keyCode.HOME:
                        n = this._valueMin();
                        break;
                    case t.ui.keyCode.END:
                        n = this._valueMax();
                        break;
                    case t.ui.keyCode.PAGE_UP:
                        n = this._trimAlignValue(i + (this._valueMax() - this._valueMin()) / 5);
                        break;
                    case t.ui.keyCode.PAGE_DOWN:
                        n = this._trimAlignValue(i - (this._valueMax() - this._valueMin()) / 5);
                        break;
                    case t.ui.keyCode.UP:
                    case t.ui.keyCode.RIGHT:
                        if (i === this._valueMax())
                            return;
                        n = this._trimAlignValue(i + r);
                        break;
                    case t.ui.keyCode.DOWN:
                    case t.ui.keyCode.LEFT:
                        if (i === this._valueMin())
                            return;
                        n = this._trimAlignValue(i - r)
                    }
                    this._slide(e, a, n)
                },
                click: function(t) {
                    t.preventDefault()
                },
                keyup: function(e) {
                    var i = t(e.target).data("ui-slider-handle-index");
                    this._keySliding && (this._keySliding = !1,
                    this._stop(e, i),
                    this._change(e, i),
                    t(e.target).removeClass("ui-state-active"))
                }
            }
        })
    }(n),
    function(t) {
        function e(t) {
            return function() {
                var e = this.element.val();
                t.apply(this, arguments),
                this._refresh(),
                e !== this.element.val() && this._trigger("change")
            }
        }
        t.widget("ui.spinner", {
            version: "1.10.3",
            defaultElement: "<input>",
            widgetEventPrefix: "spin",
            options: {
                culture: null,
                icons: {
                    down: "ui-icon-triangle-1-s",
                    up: "ui-icon-triangle-1-n"
                },
                incremental: !0,
                max: null,
                min: null,
                numberFormat: null,
                page: 10,
                step: 1,
                change: null,
                spin: null,
                start: null,
                stop: null
            },
            _create: function() {
                this._setOption("max", this.options.max),
                this._setOption("min", this.options.min),
                this._setOption("step", this.options.step),
                this._value(this.element.val(), !0),
                this._draw(),
                this._on(this._events),
                this._refresh(),
                this._on(this.window, {
                    beforeunload: function() {
                        this.element.removeAttr("autocomplete")
                    }
                })
            },
            _getCreateOptions: function() {
                var e = {}
                  , i = this.element;
                return t.each(["min", "max", "step"], function(t, n) {
                    var r = i.attr(n);
                    void 0 !== r && r.length && (e[n] = r)
                }),
                e
            },
            _events: {
                keydown: function(t) {
                    this._start(t) && this._keydown(t) && t.preventDefault()
                },
                keyup: "_stop",
                focus: function() {
                    this.previous = this.element.val()
                },
                blur: function(t) {
                    if (this.cancelBlur)
                        return void delete this.cancelBlur;
                    this._stop(),
                    this._refresh(),
                    this.previous !== this.element.val() && this._trigger("change", t)
                },
                mousewheel: function(t, e) {
                    if (e) {
                        if (!this.spinning && !this._start(t))
                            return !1;
                        this._spin((e > 0 ? 1 : -1) * this.options.step, t),
                        clearTimeout(this.mousewheelTimer),
                        this.mousewheelTimer = this._delay(function() {
                            this.spinning && this._stop(t)
                        }, 100),
                        t.preventDefault()
                    }
                },
                "mousedown .ui-spinner-button": function(e) {
                    function i() {
                        this.element[0] === this.document[0].activeElement || (this.element.focus(),
                        this.previous = n,
                        this._delay(function() {
                            this.previous = n
                        }))
                    }
                    var n;
                    n = this.element[0] === this.document[0].activeElement ? this.previous : this.element.val(),
                    e.preventDefault(),
                    i.call(this),
                    this.cancelBlur = !0,
                    this._delay(function() {
                        delete this.cancelBlur,
                        i.call(this)
                    }),
                    !1 !== this._start(e) && this._repeat(null, t(e.currentTarget).hasClass("ui-spinner-up") ? 1 : -1, e)
                },
                "mouseup .ui-spinner-button": "_stop",
                "mouseenter .ui-spinner-button": function(e) {
                    if (t(e.currentTarget).hasClass("ui-state-active"))
                        return !1 !== this._start(e) && void this._repeat(null, t(e.currentTarget).hasClass("ui-spinner-up") ? 1 : -1, e)
                },
                "mouseleave .ui-spinner-button": "_stop"
            },
            _draw: function() {
                var t = this.uiSpinner = this.element.addClass("ui-spinner-input").attr("autocomplete", "off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());
                this.element.attr("role", "spinbutton"),
                this.buttons = t.find(".ui-spinner-button").attr("tabIndex", -1).button().removeClass("ui-corner-all"),
                this.buttons.height() > Math.ceil(.5 * t.height()) && t.height() > 0 && t.height(t.height()),
                this.options.disabled && this.disable()
            },
            _keydown: function(e) {
                var i = this.options
                  , n = t.ui.keyCode;
                switch (e.keyCode) {
                case n.UP:
                    return this._repeat(null, 1, e),
                    !0;
                case n.DOWN:
                    return this._repeat(null, -1, e),
                    !0;
                case n.PAGE_UP:
                    return this._repeat(null, i.page, e),
                    !0;
                case n.PAGE_DOWN:
                    return this._repeat(null, -i.page, e),
                    !0
                }
                return !1
            },
            _uiSpinnerHtml: function() {
                return "<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"
            },
            _buttonHtml: function() {
                return "<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon " + this.options.icons.up + "'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon " + this.options.icons.down + "'>&#9660;</span></a>"
            },
            _start: function(t) {
                return !(!this.spinning && !1 === this._trigger("start", t)) && (this.counter || (this.counter = 1),
                this.spinning = !0,
                !0)
            },
            _repeat: function(t, e, i) {
                t = t || 500,
                clearTimeout(this.timer),
                this.timer = this._delay(function() {
                    this._repeat(40, e, i)
                }, t),
                this._spin(e * this.options.step, i)
            },
            _spin: function(t, e) {
                var i = this.value() || 0;
                this.counter || (this.counter = 1),
                i = this._adjustValue(i + t * this._increment(this.counter)),
                this.spinning && !1 === this._trigger("spin", e, {
                    value: i
                }) || (this._value(i),
                this.counter++)
            },
            _increment: function(e) {
                var i = this.options.incremental;
                return i ? t.isFunction(i) ? i(e) : Math.floor(e * e * e / 5e4 - e * e / 500 + 17 * e / 200 + 1) : 1
            },
            _precision: function() {
                var t = this._precisionOf(this.options.step);
                return null !== this.options.min && (t = Math.max(t, this._precisionOf(this.options.min))),
                t
            },
            _precisionOf: function(t) {
                var e = t.toString()
                  , i = e.indexOf(".");
                return -1 === i ? 0 : e.length - i - 1
            },
            _adjustValue: function(t) {
                var e, i, n = this.options;
                return e = null !== n.min ? n.min : 0,
                i = t - e,
                i = Math.round(i / n.step) * n.step,
                t = e + i,
                t = parseFloat(t.toFixed(this._precision())),
                null !== n.max && t > n.max ? n.max : null !== n.min && t < n.min ? n.min : t
            },
            _stop: function(t) {
                this.spinning && (clearTimeout(this.timer),
                clearTimeout(this.mousewheelTimer),
                this.counter = 0,
                this.spinning = !1,
                this._trigger("stop", t))
            },
            _setOption: function(t, e) {
                if ("culture" === t || "numberFormat" === t) {
                    var i = this._parse(this.element.val());
                    return this.options[t] = e,
                    void this.element.val(this._format(i))
                }
                "max" !== t && "min" !== t && "step" !== t || "string" == typeof e && (e = this._parse(e)),
                "icons" === t && (this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(e.up),
                this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(e.down)),
                this._super(t, e),
                "disabled" === t && (e ? (this.element.prop("disabled", !0),
                this.buttons.button("disable")) : (this.element.prop("disabled", !1),
                this.buttons.button("enable")))
            },
            _setOptions: e(function(t) {
                this._super(t),
                this._value(this.element.val())
            }),
            _parse: function(t) {
                return "string" == typeof t && "" !== t && (t = window.Globalize && this.options.numberFormat ? Globalize.parseFloat(t, 10, this.options.culture) : +t),
                "" === t || isNaN(t) ? null : t
            },
            _format: function(t) {
                return "" === t ? "" : window.Globalize && this.options.numberFormat ? Globalize.format(t, this.options.numberFormat, this.options.culture) : t
            },
            _refresh: function() {
                this.element.attr({
                    "aria-valuemin": this.options.min,
                    "aria-valuemax": this.options.max,
                    "aria-valuenow": this._parse(this.element.val())
                })
            },
            _value: function(t, e) {
                var i;
                "" !== t && null !== (i = this._parse(t)) && (e || (i = this._adjustValue(i)),
                t = this._format(i)),
                this.element.val(t),
                this._refresh()
            },
            _destroy: function() {
                this.element.removeClass("ui-spinner-input").prop("disabled", !1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),
                this.uiSpinner.replaceWith(this.element)
            },
            stepUp: e(function(t) {
                this._stepUp(t)
            }),
            _stepUp: function(t) {
                this._start() && (this._spin((t || 1) * this.options.step),
                this._stop())
            },
            stepDown: e(function(t) {
                this._stepDown(t)
            }),
            _stepDown: function(t) {
                this._start() && (this._spin((t || 1) * -this.options.step),
                this._stop())
            },
            pageUp: e(function(t) {
                this._stepUp((t || 1) * this.options.page)
            }),
            pageDown: e(function(t) {
                this._stepDown((t || 1) * this.options.page)
            }),
            value: function(t) {
                if (!arguments.length)
                    return this._parse(this.element.val());
                e(this._value).call(this, t)
            },
            widget: function() {
                return this.uiSpinner
            }
        })
    }(n),
    function(t, e) {
        function i() {
            return ++r
        }
        function n(t) {
            return t.hash.length > 1 && decodeURIComponent(t.href.replace(a, "")) === decodeURIComponent(location.href.replace(a, ""))
        }
        var r = 0
          , a = /#.*$/;
        t.widget("ui.tabs", {
            version: "1.10.3",
            delay: 300,
            options: {
                active: null,
                collapsible: !1,
                event: "click",
                heightStyle: "content",
                hide: null,
                show: null,
                activate: null,
                beforeActivate: null,
                beforeLoad: null,
                load: null
            },
            _create: function() {
                var e = this
                  , i = this.options;
                this.running = !1,
                this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible", i.collapsible).delegate(".ui-tabs-nav > li", "mousedown" + this.eventNamespace, function(e) {
                    t(this).is(".ui-state-disabled") && e.preventDefault()
                }).delegate(".ui-tabs-anchor", "focus" + this.eventNamespace, function() {
                    t(this).closest("li").is(".ui-state-disabled") && this.blur()
                }),
                this._processTabs(),
                i.active = this._initialActive(),
                t.isArray(i.disabled) && (i.disabled = t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"), function(t) {
                    return e.tabs.index(t)
                }))).sort()),
                !1 !== this.options.active && this.anchors.length ? this.active = this._findActive(i.active) : this.active = t(),
                this._refresh(),
                this.active.length && this.load(i.active)
            },
            _initialActive: function() {
                var e = this.options.active
                  , i = this.options.collapsible
                  , n = location.hash.substring(1);
                return null === e && (n && this.tabs.each(function(i, r) {
                    if (t(r).attr("aria-controls") === n)
                        return e = i,
                        !1
                }),
                null === e && (e = this.tabs.index(this.tabs.filter(".ui-tabs-active"))),
                null !== e && -1 !== e || (e = !!this.tabs.length && 0)),
                !1 !== e && -1 === (e = this.tabs.index(this.tabs.eq(e))) && (e = !i && 0),
                !i && !1 === e && this.anchors.length && (e = 0),
                e
            },
            _getCreateEventData: function() {
                return {
                    tab: this.active,
                    panel: this.active.length ? this._getPanelForTab(this.active) : t()
                }
            },
            _tabKeydown: function(e) {
                var i = t(this.document[0].activeElement).closest("li")
                  , n = this.tabs.index(i)
                  , r = !0;
                if (!this._handlePageNav(e)) {
                    switch (e.keyCode) {
                    case t.ui.keyCode.RIGHT:
                    case t.ui.keyCode.DOWN:
                        n++;
                        break;
                    case t.ui.keyCode.UP:
                    case t.ui.keyCode.LEFT:
                        r = !1,
                        n--;
                        break;
                    case t.ui.keyCode.END:
                        n = this.anchors.length - 1;
                        break;
                    case t.ui.keyCode.HOME:
                        n = 0;
                        break;
                    case t.ui.keyCode.SPACE:
                        return e.preventDefault(),
                        clearTimeout(this.activating),
                        void this._activate(n);
                    case t.ui.keyCode.ENTER:
                        return e.preventDefault(),
                        clearTimeout(this.activating),
                        void this._activate(n !== this.options.active && n);
                    default:
                        return
                    }
                    e.preventDefault(),
                    clearTimeout(this.activating),
                    n = this._focusNextTab(n, r),
                    e.ctrlKey || (i.attr("aria-selected", "false"),
                    this.tabs.eq(n).attr("aria-selected", "true"),
                    this.activating = this._delay(function() {
                        this.option("active", n)
                    }, this.delay))
                }
            },
            _panelKeydown: function(e) {
                this._handlePageNav(e) || e.ctrlKey && e.keyCode === t.ui.keyCode.UP && (e.preventDefault(),
                this.active.focus())
            },
            _handlePageNav: function(e) {
                return e.altKey && e.keyCode === t.ui.keyCode.PAGE_UP ? (this._activate(this._focusNextTab(this.options.active - 1, !1)),
                !0) : e.altKey && e.keyCode === t.ui.keyCode.PAGE_DOWN ? (this._activate(this._focusNextTab(this.options.active + 1, !0)),
                !0) : void 0
            },
            _findNextTab: function(e, i) {
                for (var n = this.tabs.length - 1; -1 !== t.inArray(function() {
                    return e > n && (e = 0),
                    e < 0 && (e = n),
                    e
                }(), this.options.disabled); )
                    e = i ? e + 1 : e - 1;
                return e
            },
            _focusNextTab: function(t, e) {
                return t = this._findNextTab(t, e),
                this.tabs.eq(t).focus(),
                t
            },
            _setOption: function(t, e) {
                return "active" === t ? void this._activate(e) : "disabled" === t ? void this._setupDisabled(e) : (this._super(t, e),
                "collapsible" === t && (this.element.toggleClass("ui-tabs-collapsible", e),
                e || !1 !== this.options.active || this._activate(0)),
                "event" === t && this._setupEvents(e),
                void ("heightStyle" === t && this._setupHeightStyle(e)))
            },
            _tabId: function(t) {
                return t.attr("aria-controls") || "ui-tabs-" + i()
            },
            _sanitizeSelector: function(t) {
                return t ? t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g, "\\$&") : ""
            },
            refresh: function() {
                var e = this.options
                  , i = this.tablist.children(":has(a[href])");
                e.disabled = t.map(i.filter(".ui-state-disabled"), function(t) {
                    return i.index(t)
                }),
                this._processTabs(),
                !1 !== e.active && this.anchors.length ? this.active.length && !t.contains(this.tablist[0], this.active[0]) ? this.tabs.length === e.disabled.length ? (e.active = !1,
                this.active = t()) : this._activate(this._findNextTab(Math.max(0, e.active - 1), !1)) : e.active = this.tabs.index(this.active) : (e.active = !1,
                this.active = t()),
                this._refresh()
            },
            _refresh: function() {
                this._setupDisabled(this.options.disabled),
                this._setupEvents(this.options.event),
                this._setupHeightStyle(this.options.heightStyle),
                this.tabs.not(this.active).attr({
                    "aria-selected": "false",
                    tabIndex: -1
                }),
                this.panels.not(this._getPanelForTab(this.active)).hide().attr({
                    "aria-expanded": "false",
                    "aria-hidden": "true"
                }),
                this.active.length ? (this.active.addClass("ui-tabs-active ui-state-active").attr({
                    "aria-selected": "true",
                    tabIndex: 0
                }),
                this._getPanelForTab(this.active).show().attr({
                    "aria-expanded": "true",
                    "aria-hidden": "false"
                })) : this.tabs.eq(0).attr("tabIndex", 0)
            },
            _processTabs: function() {
                var e = this;
                this.tablist = this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role", "tablist"),
                this.tabs = this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({
                    role: "tab",
                    tabIndex: -1
                }),
                this.anchors = this.tabs.map(function() {
                    return t("a", this)[0]
                }).addClass("ui-tabs-anchor").attr({
                    role: "presentation",
                    tabIndex: -1
                }),
                this.panels = t(),
                this.anchors.each(function(i, r) {
                    var a, s, o, l = t(r).uniqueId().attr("id"), u = t(r).closest("li"), h = u.attr("aria-controls");
                    n(r) ? (a = r.hash,
                    s = e.element.find(e._sanitizeSelector(a))) : (o = e._tabId(u),
                    a = "#" + o,
                    s = e.element.find(a),
                    s.length || (s = e._createPanel(o),
                    s.insertAfter(e.panels[i - 1] || e.tablist)),
                    s.attr("aria-live", "polite")),
                    s.length && (e.panels = e.panels.add(s)),
                    h && u.data("ui-tabs-aria-controls", h),
                    u.attr({
                        "aria-controls": a.substring(1),
                        "aria-labelledby": l
                    }),
                    s.attr("aria-labelledby", l)
                }),
                this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role", "tabpanel")
            },
            _getList: function() {
                return this.element.find("ol,ul").eq(0)
            },
            _createPanel: function(e) {
                return t("<div>").attr("id", e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy", !0)
            },
            _setupDisabled: function(e) {
                t.isArray(e) && (e.length ? e.length === this.anchors.length && (e = !0) : e = !1);
                for (var i, n = 0; i = this.tabs[n]; n++)
                    !0 === e || -1 !== t.inArray(n, e) ? t(i).addClass("ui-state-disabled").attr("aria-disabled", "true") : t(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");
                this.options.disabled = e
            },
            _setupEvents: function(e) {
                var i = {
                    click: function(t) {
                        t.preventDefault()
                    }
                };
                e && t.each(e.split(" "), function(t, e) {
                    i[e] = "_eventHandler"
                }),
                this._off(this.anchors.add(this.tabs).add(this.panels)),
                this._on(this.anchors, i),
                this._on(this.tabs, {
                    keydown: "_tabKeydown"
                }),
                this._on(this.panels, {
                    keydown: "_panelKeydown"
                }),
                this._focusable(this.tabs),
                this._hoverable(this.tabs)
            },
            _setupHeightStyle: function(e) {
                var i, n = this.element.parent();
                "fill" === e ? (i = n.height(),
                i -= this.element.outerHeight() - this.element.height(),
                this.element.siblings(":visible").each(function() {
                    var e = t(this)
                      , n = e.css("position");
                    "absolute" !== n && "fixed" !== n && (i -= e.outerHeight(!0))
                }),
                this.element.children().not(this.panels).each(function() {
                    i -= t(this).outerHeight(!0)
                }),
                this.panels.each(function() {
                    t(this).height(Math.max(0, i - t(this).innerHeight() + t(this).height()))
                }).css("overflow", "auto")) : "auto" === e && (i = 0,
                this.panels.each(function() {
                    i = Math.max(i, t(this).height("").height())
                }).height(i))
            },
            _eventHandler: function(e) {
                var i = this.options
                  , n = this.active
                  , r = t(e.currentTarget)
                  , a = r.closest("li")
                  , s = a[0] === n[0]
                  , o = s && i.collapsible
                  , l = o ? t() : this._getPanelForTab(a)
                  , u = n.length ? this._getPanelForTab(n) : t()
                  , h = {
                    oldTab: n,
                    oldPanel: u,
                    newTab: o ? t() : a,
                    newPanel: l
                };
                e.preventDefault(),
                a.hasClass("ui-state-disabled") || a.hasClass("ui-tabs-loading") || this.running || s && !i.collapsible || !1 === this._trigger("beforeActivate", e, h) || (i.active = !o && this.tabs.index(a),
                this.active = s ? t() : a,
                this.xhr && this.xhr.abort(),
                u.length || l.length || t.error("jQuery UI Tabs: Mismatching fragment identifier."),
                l.length && this.load(this.tabs.index(a), e),
                this._toggle(e, h))
            },
            _toggle: function(e, i) {
                function n() {
                    a.running = !1,
                    a._trigger("activate", e, i)
                }
                function r() {
                    i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),
                    s.length && a.options.show ? a._show(s, a.options.show, n) : (s.show(),
                    n())
                }
                var a = this
                  , s = i.newPanel
                  , o = i.oldPanel;
                this.running = !0,
                o.length && this.options.hide ? this._hide(o, this.options.hide, function() {
                    i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),
                    r()
                }) : (i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),
                o.hide(),
                r()),
                o.attr({
                    "aria-expanded": "false",
                    "aria-hidden": "true"
                }),
                i.oldTab.attr("aria-selected", "false"),
                s.length && o.length ? i.oldTab.attr("tabIndex", -1) : s.length && this.tabs.filter(function() {
                    return 0 === t(this).attr("tabIndex")
                }).attr("tabIndex", -1),
                s.attr({
                    "aria-expanded": "true",
                    "aria-hidden": "false"
                }),
                i.newTab.attr({
                    "aria-selected": "true",
                    tabIndex: 0
                })
            },
            _activate: function(e) {
                var i, n = this._findActive(e);
                n[0] !== this.active[0] && (n.length || (n = this.active),
                i = n.find(".ui-tabs-anchor")[0],
                this._eventHandler({
                    target: i,
                    currentTarget: i,
                    preventDefault: t.noop
                }))
            },
            _findActive: function(e) {
                return !1 === e ? t() : this.tabs.eq(e)
            },
            _getIndex: function(t) {
                return "string" == typeof t && (t = this.anchors.index(this.anchors.filter("[href$='" + t + "']"))),
                t
            },
            _destroy: function() {
                this.xhr && this.xhr.abort(),
                this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),
                this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),
                this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),
                this.tabs.add(this.panels).each(function() {
                    t.data(this, "ui-tabs-destroy") ? t(this).remove() : t(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")
                }),
                this.tabs.each(function() {
                    var e = t(this)
                      , i = e.data("ui-tabs-aria-controls");
                    i ? e.attr("aria-controls", i).removeData("ui-tabs-aria-controls") : e.removeAttr("aria-controls")
                }),
                this.panels.show(),
                "content" !== this.options.heightStyle && this.panels.css("height", "")
            },
            enable: function(e) {
                var i = this.options.disabled;
                !1 !== i && (void 0 === e ? i = !1 : (e = this._getIndex(e),
                i = t.isArray(i) ? t.map(i, function(t) {
                    return t !== e ? t : null
                }) : t.map(this.tabs, function(t, i) {
                    return i !== e ? i : null
                })),
                this._setupDisabled(i))
            },
            disable: function(e) {
                var i = this.options.disabled;
                if (!0 !== i) {
                    if (void 0 === e)
                        i = !0;
                    else {
                        if (e = this._getIndex(e),
                        -1 !== t.inArray(e, i))
                            return;
                        i = t.isArray(i) ? t.merge([e], i).sort() : [e]
                    }
                    this._setupDisabled(i)
                }
            },
            load: function(e, i) {
                e = this._getIndex(e);
                var r = this
                  , a = this.tabs.eq(e)
                  , s = a.find(".ui-tabs-anchor")
                  , o = this._getPanelForTab(a)
                  , l = {
                    tab: a,
                    panel: o
                };
                n(s[0]) || (this.xhr = t.ajax(this._ajaxSettings(s, i, l)),
                this.xhr && "canceled" !== this.xhr.statusText && (a.addClass("ui-tabs-loading"),
                o.attr("aria-busy", "true"),
                this.xhr.success(function(t) {
                    setTimeout(function() {
                        o.html(t),
                        r._trigger("load", i, l)
                    }, 1)
                }).complete(function(t, e) {
                    setTimeout(function() {
                        "abort" === e && r.panels.stop(!1, !0),
                        a.removeClass("ui-tabs-loading"),
                        o.removeAttr("aria-busy"),
                        t === r.xhr && delete r.xhr
                    }, 1)
                })))
            },
            _ajaxSettings: function(e, i, n) {
                var r = this;
                return {
                    url: e.attr("href"),
                    beforeSend: function(e, a) {
                        return r._trigger("beforeLoad", i, t.extend({
                            jqXHR: e,
                            ajaxSettings: a
                        }, n))
                    }
                }
            },
            _getPanelForTab: function(e) {
                var i = t(e).attr("aria-controls");
                return this.element.find(this._sanitizeSelector("#" + i))
            }
        })
    }(n),
    function(t) {
        function e(e, i) {
            var n = (e.attr("aria-describedby") || "").split(/\s+/);
            n.push(i),
            e.data("ui-tooltip-id", i).attr("aria-describedby", t.trim(n.join(" ")))
        }
        function i(e) {
            var i = e.data("ui-tooltip-id")
              , n = (e.attr("aria-describedby") || "").split(/\s+/)
              , r = t.inArray(i, n);
            -1 !== r && n.splice(r, 1),
            e.removeData("ui-tooltip-id"),
            n = t.trim(n.join(" ")),
            n ? e.attr("aria-describedby", n) : e.removeAttr("aria-describedby")
        }
        var n = 0;
        t.widget("ui.tooltip", {
            version: "1.10.3",
            options: {
                content: function() {
                    var e = t(this).attr("title") || "";
                    return t("<a>").text(e).html()
                },
                hide: !0,
                items: "[title]:not([disabled])",
                position: {
                    my: "left top+15",
                    at: "left bottom",
                    collision: "flipfit flip"
                },
                show: !0,
                tooltipClass: null,
                track: !1,
                close: null,
                open: null
            },
            _create: function() {
                this._on({
                    mouseover: "open",
                    focusin: "open"
                }),
                this.tooltips = {},
                this.parents = {},
                this.options.disabled && this._disable()
            },
            _setOption: function(e, i) {
                var n = this;
                if ("disabled" === e)
                    return this[i ? "_disable" : "_enable"](),
                    void (this.options[e] = i);
                this._super(e, i),
                "content" === e && t.each(this.tooltips, function(t, e) {
                    n._updateContent(e)
                })
            },
            _disable: function() {
                var e = this;
                t.each(this.tooltips, function(i, n) {
                    var r = t.Event("blur");
                    r.target = r.currentTarget = n[0],
                    e.close(r, !0)
                }),
                this.element.find(this.options.items).addBack().each(function() {
                    var e = t(this);
                    e.is("[title]") && e.data("ui-tooltip-title", e.attr("title")).attr("title", "")
                })
            },
            _enable: function() {
                this.element.find(this.options.items).addBack().each(function() {
                    var e = t(this);
                    e.data("ui-tooltip-title") && e.attr("title", e.data("ui-tooltip-title"))
                })
            },
            open: function(e) {
                var i = this
                  , n = t(e ? e.target : this.element).closest(this.options.items);
                n.length && !n.data("ui-tooltip-id") && (n.attr("title") && n.data("ui-tooltip-title", n.attr("title")),
                n.data("ui-tooltip-open", !0),
                e && "mouseover" === e.type && n.parents().each(function() {
                    var e, n = t(this);
                    n.data("ui-tooltip-open") && (e = t.Event("blur"),
                    e.target = e.currentTarget = this,
                    i.close(e, !0)),
                    n.attr("title") && (n.uniqueId(),
                    i.parents[this.id] = {
                        element: this,
                        title: n.attr("title")
                    },
                    n.attr("title", ""))
                }),
                this._updateContent(n, e))
            },
            _updateContent: function(t, e) {
                var i, n = this.options.content, r = this, a = e ? e.type : null;
                if ("string" == typeof n)
                    return this._open(e, t, n);
                (i = n.call(t[0], function(i) {
                    t.data("ui-tooltip-open") && r._delay(function() {
                        e && (e.type = a),
                        this._open(e, t, i)
                    })
                })) && this._open(e, t, i)
            },
            _open: function(i, n, r) {
                function a(t) {
                    u.of = t,
                    s.is(":hidden") || s.position(u)
                }
                var s, o, l, u = t.extend({}, this.options.position);
                if (r) {
                    if (s = this._find(n),
                    s.length)
                        return void s.find(".ui-tooltip-content").html(r);
                    n.is("[title]") && (i && "mouseover" === i.type ? n.attr("title", "") : n.removeAttr("title")),
                    s = this._tooltip(n),
                    e(n, s.attr("id")),
                    s.find(".ui-tooltip-content").html(r),
                    this.options.track && i && /^mouse/.test(i.type) ? (this._on(this.document, {
                        mousemove: a
                    }),
                    a(i)) : s.position(t.extend({
                        of: n
                    }, this.options.position)),
                    s.hide(),
                    this._show(s, this.options.show),
                    this.options.show && this.options.show.delay && (l = this.delayedShow = setInterval(function() {
                        s.is(":visible") && (a(u.of),
                        clearInterval(l))
                    }, t.fx.interval)),
                    this._trigger("open", i, {
                        tooltip: s
                    }),
                    o = {
                        keyup: function(e) {
                            if (e.keyCode === t.ui.keyCode.ESCAPE) {
                                var i = t.Event(e);
                                i.currentTarget = n[0],
                                this.close(i, !0)
                            }
                        },
                        remove: function() {
                            this._removeTooltip(s)
                        }
                    },
                    i && "mouseover" !== i.type || (o.mouseleave = "close"),
                    i && "focusin" !== i.type || (o.focusout = "close"),
                    this._on(!0, n, o)
                }
            },
            close: function(e) {
                var n = this
                  , r = t(e ? e.currentTarget : this.element)
                  , a = this._find(r);
                this.closing || (clearInterval(this.delayedShow),
                r.data("ui-tooltip-title") && r.attr("title", r.data("ui-tooltip-title")),
                i(r),
                a.stop(!0),
                this._hide(a, this.options.hide, function() {
                    n._removeTooltip(t(this))
                }),
                r.removeData("ui-tooltip-open"),
                this._off(r, "mouseleave focusout keyup"),
                r[0] !== this.element[0] && this._off(r, "remove"),
                this._off(this.document, "mousemove"),
                e && "mouseleave" === e.type && t.each(this.parents, function(e, i) {
                    t(i.element).attr("title", i.title),
                    delete n.parents[e]
                }),
                this.closing = !0,
                this._trigger("close", e, {
                    tooltip: a
                }),
                this.closing = !1)
            },
            _tooltip: function(e) {
                var i = "ui-tooltip-" + n++
                  , r = t("<div>").attr({
                    id: i,
                    role: "tooltip"
                }).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content " + (this.options.tooltipClass || ""));
                return t("<div>").addClass("ui-tooltip-content").appendTo(r),
                r.appendTo(this.document[0].body),
                this.tooltips[i] = e,
                r
            },
            _find: function(e) {
                var i = e.data("ui-tooltip-id");
                return i ? t("#" + i) : t()
            },
            _removeTooltip: function(t) {
                t.remove(),
                delete this.tooltips[t.attr("id")]
            },
            _destroy: function() {
                var e = this;
                t.each(this.tooltips, function(i, n) {
                    var r = t.Event("blur");
                    r.target = r.currentTarget = n[0],
                    e.close(r, !0),
                    t("#" + i).remove(),
                    n.data("ui-tooltip-title") && (n.attr("title", n.data("ui-tooltip-title")),
                    n.removeData("ui-tooltip-title"))
                })
            }
        })
    }(n)
}
, , , , , , , function(t, e) {
    var i = {};
    i.EPSILON = 1e-6,
    i.ARRAY_TYPE = "undefined" != typeof Float32Array ? Float32Array : Array,
    i.RANDOM = Math.random,
    i.ENABLE_SIMD = !1,
    i.SIMD_AVAILABLE = i.ARRAY_TYPE === Float32Array && "SIMD"in this,
    i.USE_SIMD = i.ENABLE_SIMD && i.SIMD_AVAILABLE,
    i.setMatrixArrayType = function(t) {
        i.ARRAY_TYPE = t
    }
    ;
    var n = Math.PI / 180;
    i.toRadian = function(t) {
        return t * n
    }
    ,
    i.equals = function(t, e) {
        return Math.abs(t - e) <= i.EPSILON * Math.max(1, Math.abs(t), Math.abs(e))
    }
    ,
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(134)
      , r = function(t, e, i) {
        this.mode = t,
        void 0 !== t && ("string" == typeof t && (t = n[t]),
        this.mode = t),
        this.first = e,
        this.count = i
    };
    r.prototype = {
        draw: function(t) {
            if (0 !== this.count) {
                t.getGraphicContext().drawArrays(this.mode, this.first, this.count)
            }
        },
        getMode: function() {
            return this.mode
        },
        setCount: function(t) {
            this.count = t
        },
        getCount: function() {
            return this.count
        },
        setFirst: function(t) {
            this.first = t
        },
        getFirst: function() {
            return this.first
        },
        getNumIndices: function() {
            return this.count
        },
        index: function(t) {
            return this.first + t
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(134)
      , r = function(t, e) {
        this.mode = n.POINTS,
        void 0 !== t && ("string" == typeof t && (t = n[t]),
        this.mode = t),
        this.count = 0,
        this.offset = 0,
        this.indices = e,
        this.uType = r.UNSIGNED_SHORT,
        void 0 !== e && this.setIndices(e)
    };
    r.UNSIGNED_BYTE = 5121,
    r.UNSIGNED_SHORT = 5123,
    r.UNSIGNED_INT = 5125,
    r.prototype = {
        getMode: function() {
            return this.mode
        },
        draw: function(t) {
            0 !== this.count && (t.setIndexArray(this.indices),
            this.drawElements(t))
        },
        drawElements: function(t) {
            t.getGraphicContext().drawElements(this.mode, this.count, this.uType, this.offset)
        },
        setIndices: function(t) {
            this.indices = t;
            var e = t.getElements();
            this.count = e.length;
            var i = e.BYTES_PER_ELEMENT;
            1 === i ? this.uType = r.UNSIGNED_BYTE : 2 === i ? this.uType = r.UNSIGNED_SHORT : 4 === i && (this.uType = r.UNSIGNED_INT)
        },
        getIndices: function() {
            return this.indices
        },
        setFirst: function(t) {
            this.offset = t
        },
        getFirst: function() {
            return this.offset
        },
        setCount: function(t) {
            this.count = t
        },
        getCount: function() {
            return this.count
        },
        getNumIndices: function() {
            return this.indices.getElements().length
        },
        index: function(t) {
            return this.indices.getElements()[t]
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(28)
      , a = i(409)
      , s = i(66)
      , o = i(533)
      , l = i(324)
      , u = new o
      , h = function(t, e) {
        a.call(this),
        s.call(this),
        this._program = null,
        this._nullProgram = !0,
        this._vertex = void 0,
        this._fragment = void 0,
        this._uniformsCache = void 0,
        this._attributesCache = void 0,
        this._activeUniforms = void 0,
        this._foreignUniforms = void 0,
        this._trackAttributes = void 0,
        t && this.setVertexShader(t),
        e && this.setFragmentShader(e),
        this._dirty = !0
    }
      , c = function(t) {
        var e, i, n, r = {}, a = t.match(/attribute\s+\w+\s+\w+/g);
        if (null !== a)
            for (e = 0,
            i = a.length; e < i; e++)
                n = a[e].match(/attribute\s+\w+\s+(\w+)/)[1],
                r[n] = !0;
        else
            for (a = t.match(/in\s+\w+\s+\w+\s*;/g),
            e = 0,
            i = a.length; e < i; e++)
                n = a[e].match(/in\s+\w+\s+(\w+)\s*;/)[1],
                r[n] = !0;
        return r
    };
    h._sDeletedGLProgramCache = new window.Map,
    h.deleteGLProgram = function(t, e) {
        h._sDeletedGLProgramCache.has(t) || h._sDeletedGLProgramCache.set(t, []),
        h._sDeletedGLProgramCache.get(t).push(e)
    }
    ,
    h.flushDeletedGLPrograms = function(t, e) {
        if (e <= 0)
            return e;
        if (!h._sDeletedGLProgramCache.has(t))
            return e;
        for (var i = 0, n = l.instance().tick(), r = h._sDeletedGLProgramCache.get(t), a = r.length, s = a - 1; s >= 0 && i < e; s--)
            t.deleteProgram(r[s]),
            r.splice(s, 1),
            i = l.instance().deltaS(n, l.instance().tick());
        return e - i
    }
    ,
    h.flushAllDeletedGLPrograms = function(t) {
        if (h._sDeletedGLProgramCache.has(t))
            for (var e = h._sDeletedGLProgramCache.get(t), i = e.length, n = i - 1; n >= 0; n--)
                t.deleteProgram(e[n]),
                e.splice(n, 1)
    }
    ,
    h.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, n.objectInherit(s.prototype, {
        attributeType: "Program",
        cloneType: function() {
            return new h
        },
        setVertexShader: function(t) {
            this._vertex = t,
            this._nullProgram = !1,
            t.setText(u.processShader(t.getText()))
        },
        setFragmentShader: function(t) {
            this._fragment = t,
            this._nullProgram = !1,
            t.setText(u.processShader(t.getText()))
        },
        getVertexShader: function() {
            return this._vertex
        },
        getFragmentShader: function() {
            return this._fragment
        },
        getProgram: function() {
            return this._program
        },
        setActiveUniforms: function(t) {
            this._activeUniforms = t
        },
        getActiveUniforms: function() {
            return this._activeUniforms
        },
        setForeignUniforms: function(t) {
            this._foreignUniforms = t
        },
        getForeignUniforms: function() {
            return this._foreignUniforms
        },
        setUniformsCache: function(t) {
            this._uniformsCache = t
        },
        getUniformsCache: function() {
            return this._uniformsCache
        },
        setAttributesCache: function(t) {
            this._attributesCache = t
        },
        getAttributesCache: function() {
            return this._attributesCache
        },
        setTrackAttributes: function(t) {
            this._trackAttributes = t
        },
        getTrackAttributes: function() {
            return this._trackAttributes
        },
        releaseGLObjects: function() {
            void 0 !== this._vertex && this._vertex.releaseGLObjects(),
            void 0 !== this._fragment && this._fragment.releaseGLObjects(),
            null !== this._program && (void 0 !== this._gl && h.deleteGLProgram(this._gl, this._program),
            this._program = void 0)
        },
        apply: function(t) {
            if (!this._nullProgram) {
                this._gl || this.setGraphicContext(t.getGraphicContext());
                var e = this._gl;
                if (!this._program || this._dirty) {
                    var i;
                    this._vertex.shader || (i = this._vertex.compile(e)),
                    this._fragment.shader || (i = this._fragment.compile(e));
                    var a = c(this._vertex.getText());
                    if (i && (this._program = e.createProgram(),
                    a.Vertex && e.bindAttribLocation(this._program, 0, "Vertex"),
                    e.attachShader(this._program, this._vertex.shader),
                    e.attachShader(this._program, this._fragment.shader),
                    n.timeStamp("osgjs.metrics:linkShader"),
                    e.linkProgram(this._program),
                    !e.getProgramParameter(this._program, e.LINK_STATUS) && !e.isContextLost())) {
                        var s = e.getProgramInfoLog(this._program);
                        r.errorFold(s, "can't link program\nvertex shader:\n" + this._vertex.text + "\n fragment shader:\n" + this._fragment.text);
                        var o = void 0 !== e.rawgl ? e.rawgl : e;
                        void 0 !== o && void 0 !== o.getExtension && (o = o.getExtension("WEBGL_debug_shaders")),
                        o && "Failed to create D3D shaders.\n" === s && (r.error(o.getTranslatedShaderSource(this._vertex.shader)),
                        r.error(o.getTranslatedShaderSource(this._fragment.shader))),
                        i = !1
                    }
                    if (!i) {
                        var l = e.createProgram();
                        this._vertex.failSafe(e, this._vertex.getText()),
                        this._fragment.failSafe(e, this._fragment.getText()),
                        e.attachShader(l, this._vertex.shader),
                        e.attachShader(l, this._fragment.shader),
                        e.linkProgram(l),
                        e.validateProgram(l),
                        r.warn("FailSafe shader Activated "),
                        this._program = l
                    }
                    this._uniformsCache = {},
                    this._attributesCache = {},
                    this.cacheUniformList(e, this._vertex.text),
                    this.cacheUniformList(e, this._fragment.text),
                    this.cacheAttributeList(e, window.Object.keys(a)),
                    this._dirty = !1
                }
                t.applyProgram(this._program)
            }
        },
        cacheUniformList: function(t, e) {
            var i = e.match(/uniform\s+\w+\s+\w+((\s)?\[(.*?)\])?/g)
              , n = this._uniformsCache;
            if (null !== i)
                for (var r = 0, a = i.length; r < a; r++) {
                    var s = i[r].match(/uniform\s+\w+\s+(\w+)/)[1]
                      , o = i[r].match(/uniform\s+\w+\s+(\w+)(\s?\[.*?\])?/)[1]
                      , l = t.getUniformLocation(this._program, s);
                    void 0 !== l && null !== l && void 0 === n[o] && (n[o] = l)
                }
        },
        cacheAttributeList: function(t, e) {
            for (var i = this._attributesCache, n = 0, r = e.length; n < r; n++) {
                var a = e[n]
                  , s = t.getAttribLocation(this._program, a);
                -1 !== s && void 0 !== s && void 0 === i[a] && (i[a] = s)
            }
        }
    })), "osg", "Program"),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(13)
      , a = i(324)
      , s = i(409)
      , o = function(t, e) {
        s.call(this);
        var i = t;
        "string" == typeof t && (i = o[t]),
        this.type = i,
        this.setText(e)
    };
    o.VERTEX_SHADER = 35633,
    o.FRAGMENT_SHADER = 35632;
    o.VS_DBG = "#define _DEBUG 1\n#ifdef _DEBUG\nattribute vec3 Vertex;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(void) {  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);}\n",
    o.FS_DBG = "#define _DEBUG 1\n#ifdef _DEBUG\n precision lowp float; void main(void) { gl_FragColor = vec4(1.0, 0.6, 0.6, 1.0);}\n",
    o._sDeletedGLShaderCache = new window.Map,
    o.deleteGLShader = function(t, e) {
        o._sDeletedGLShaderCache.has(t) || o._sDeletedGLShaderCache.set(t, []),
        o._sDeletedGLShaderCache.get(t).push(e)
    }
    ,
    o.flushDeletedGLShaders = function(t, e) {
        if (e <= 0)
            return e;
        if (!o._sDeletedGLShaderCache.has(t))
            return e;
        for (var i = 0, n = a.instance().tick(), r = o._sDeletedGLShaderCache.get(t), s = r.length, l = s - 1; l >= 0 && i < e; l--)
            t.deleteShader(r[l]),
            r.splice(l, 1),
            i = a.instance().deltaS(n, a.instance().tick());
        return e - i
    }
    ,
    o.flushAllDeletedGLShaders = function(t) {
        if (o._sDeletedGLShaderCache.has(t))
            for (var e = o._sDeletedGLShaderCache.get(t), i = e.length, n = i - 1; n >= 0; n--)
                t.deleteShader(e[n]),
                e.splice(n, 1)
    }
    ,
    o.prototype = r.objectInherit(s.prototype, {
        setText: function(t) {
            this.text = t
        },
        getText: function() {
            return this.text
        },
        failSafe: function(t, e) {
            this.shader = t.createShader(this.type);
            var i = e.match(/#define[\s]+SHADER_NAME[\s]+([\S]+)(\n|$)/);
            i && (i = i ? i[1] : "");
            var n = this.type === o.VERTEX_SHADER ? o.VS_DBG : o.FS_DBG;
            n += "\n#define SHADER_NAME FailSafe" + i + "\n#else\n" + e + "\n#endif\n",
            t.shaderSource(this.shader, n),
            t.compileShader(this.shader)
        },
        processErrors: function(t, e) {
            var i = /ERROR: [\d]+:([\d]+): (.+)/gim
              , r = e.split("\n")
              , a = r.length;
            if (0 !== a) {
                var s, o;
                if (null === i.exec(t) && (i = /Shader compilation errors\n\((\d+)\, \d+\): (.+)/gim),
                null === i.exec(t))
                    return void n.error(t);
                for (i.lastIndex = 0; null !== (o = i.exec(t)); ) {
                    o.index === i.lastIndex && i.lastIndex++;
                    var l = parseInt(o[1], 10);
                    if (!(l > a)) {
                        n.error("ERROR " + o[2] + " in line " + l);
                        var u = Math.max(0, l - 7)
                          , h = Math.max(0, l - 2);
                        for (s = u; s <= h; s++)
                            n.warn(r[s].replace(/^[ \t]+/g, ""));
                        for (h = Math.max(0, l - 1),
                        n.error(r[h].replace(/^[ \t]+/g, "")),
                        u = Math.min(a, l),
                        h = Math.min(a, l + 5),
                        s = u; s < h; s++)
                            n.warn(r[s].replace(/^[ \t]+/g, ""))
                    }
                }
            }
        },
        compile: function(t) {
            this._gl || this.setGraphicContext(t),
            this.shader = t.createShader(this.type);
            var e = this.text;
            if (o.enableGLSLOptimizer && o.glslOptimizer) {
                var i = this.type === o.VERTEX_SHADER ? "vertex" : "fragment";
                n.infoFold(i + " shader before optimization", e);
                var a = o.glslOptimizer(e, "2", this.type === o.VERTEX_SHADER);
                -1 !== a.indexOf("Error:") ? n.error(a) : a.length <= 1 ? n.warnFold("glsl optimizer returned an empty shader, the original will be used", e) : (n.infoFold(i + " shader after optimization", a),
                e = a)
            }
            if (t.shaderSource(this.shader, e),
            r.timeStamp("osgjs.metrics:compileShader"),
            t.compileShader(this.shader),
            !t.getShaderParameter(this.shader, t.COMPILE_STATUS) && !t.isContextLost()) {
                var s = t.getShaderInfoLog(this.shader);
                this.processErrors(s, e);
                for (var l = e, u = l.split("\n"), h = "\n", c = 0, d = u.length; c < d; ++c)
                    h += c + " " + u[c] + "\n";
                return n.errorFold("can't compile shader", h),
                !1
            }
            return !0
        },
        releaseGLObjects: function() {
            void 0 !== this._gl && o.deleteGLShader(this._gl, this.shader),
            this.shader = void 0
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = function() {
        var t = window || global;
        if (void 0 === t.performance)
            return function() {
                return Date.now()
            }
            ;
        var e = t.performance.now || t.performance.mozNow || t.performance.msNow || t.performance.oNow || t.performance.webkitNow || function() {
            return Date.now()
        }
        ;
        return function() {
            return e.apply(t.performance, arguments)
        }
    }()
      , r = function() {};
    r.instance = function() {
        return r._instance || (r._instance = new r),
        r._instance
    }
    ,
    r.prototype = {
        deltaS: function(t, e) {
            return (e - t) / 1e3
        },
        deltaM: function(t, e) {
            return e - t
        },
        tick: function() {
            return n()
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(128)
      , a = i(5).mat4
      , s = i(144)
      , o = function() {
        r.call(this),
        this.referenceFrame = s.RELATIVE_RF
    };
    o.prototype = n.objectInherit(r.prototype, {
        setReferenceFrame: function(t) {
            this.referenceFrame = t
        },
        getReferenceFrame: function() {
            return this.referenceFrame
        },
        computeBoundingSphere: function() {
            var t = a.create();
            return function(e) {
                return r.prototype.computeBoundingSphere.call(this, e),
                e.valid() ? (a.identity(t),
                this.computeLocalToWorldMatrix(t),
                e.transformMat4(e, t),
                e) : e
            }
        }()
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n, r = i(28), a = i(668), s = i(520), o = function() {
        n || (n = i(93)),
        this._checkRTT = {},
        this._webGLExtensions = {},
        this._webGLParameters = {},
        this._webGLShaderMaxInt = "NONE",
        this._webGLShaderMaxFloat = "NONE",
        this._bugsDB = {},
        this._webGLPlatforms = {},
        this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS = 8,
        this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE = 16,
        this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS = 16,
        this._webGLParameters.MAX_RENDERBUFFER_SIZE = 1,
        this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS = 8,
        this._webGLParameters.MAX_TEXTURE_SIZE = 64,
        this._webGLParameters.MAX_VARYING_VECTORS = 8,
        this._webGLParameters.MAX_VERTEX_ATTRIBS = 8,
        this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS = 0,
        this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS = 128,
        this._webGLParameters.MAX_VIEWPORT_DIMS = [1, 1],
        this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS = 0,
        this._webGLParameters.MAX_SHADER_PRECISION_FLOAT = "none",
        this._webGLParameters.MAX_SHADER_PRECISION_INT = "none",
        this._gl = void 0
    };
    o.instance = function(t) {
        if (!o._instance) {
            var e, i = t;
            if (!i) {
                "undefined" != typeof window && window.gli && (e = window.gli.host.inspectContext,
                window.gli.host.inspectContext = !1);
                var n = document.createElement("canvas");
                n.width = 32,
                n.height = 32;
                var l = new s;
                l.extend({
                    antialias: !1
                }),
                l.extendWithOptionsURL(),
                i = a.setupWebGL(n, l, function() {})
            }
            o._instance = new o,
            i ? o._instance.init(i) : r.warn("no support for webgl context detected."),
            e && (window.gli.host.inspectContext = e)
        }
        return t && t !== o._instance.getContext() && o._instance.initContextDependant(t),
        o._instance
    }
    ,
    o.prototype = {
        getContext: function() {
            return this._gl
        },
        initContextDependant: function(t) {
            this._gl = t,
            this._isGL2 = void 0 !== window.WebGL2RenderingContext && t instanceof window.WebGL2RenderingContext,
            this.initWebGLExtensions(t),
            this.hasLinearHalfFloatRTT(t),
            this.hasLinearFloatRTT(t),
            this.hasHalfFloatRTT(t),
            this.hasFloatRTT(t)
        },
        init: function(t) {
            if (this.initWebGLParameters(t),
            this.initPlatformSupport(),
            this.initBugDB(),
            this.initContextDependant(t),
            this._isGL2)
                for (var e = ["OES_element_index_uint", "EXT_sRGB", "EXT_blend_minmax", "EXT_frag_depth", "WEBGL_depth_texture", "EXT_shader_texture_lod", "OES_standard_derivatives", "OES_texture_float", "OES_texture_half_float", "OES_texture_half_float_linear", "OES_texture_float_linear", "OES_vertex_array_object", "WEBGL_draw_buffers", "OES_fbo_render_mipmap", "ANGLE_instanced_arrays"], i = o._instance.getWebGLExtensions(), n = function() {}, r = 0, a = e.length; r < a; r++)
                    i[e[r]] = n
        },
        isWebGL2: function() {
            return this._isGL2
        },
        initBugDB: function() {
            var t = this._webGLPlatforms
              , e = this._webGLParameters;
            t.Apple && (e.UNMASKED_VENDOR_WEBGL && -1 === e.UNMASKED_VENDOR_WEBGL.indexOf("Intel") || (this._bugsDB.OES_standard_derivatives = !0))
        },
        initPlatformSupport: function() {
            var t = this._webGLPlatforms;
            t.Apple = -1 !== navigator.vendor.indexOf("Apple") || -1 !== navigator.vendor.indexOf("OS X"),
            t.Mobile = /Mobi/.test(navigator.userAgent) || /ablet/.test(navigator.userAgent)
        },
        getWebGLPlatform: function(t) {
            return this._webGLPlatforms[t]
        },
        getWebGLPlatforms: function() {
            return this._webGLPlatforms
        },
        getWebGLParameter: function(t) {
            return this._webGLParameters[t]
        },
        getWebGLParameters: function() {
            return this._webGLParameters
        },
        getShaderMaxPrecisionFloat: function() {
            return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT
        },
        getShaderMaxPrecisionInt: function() {
            return this._webGLParameters.MAX_SHADER_PRECISION_INT
        },
        checkSupportRTT: function(t, e, i) {
            var n = e + "," + i;
            if (this._isGL2)
                return !!this._webGLExtensions.EXT_color_buffer_float;
            if (void 0 !== this._checkRTT[n])
                return this._checkRTT[n];
            if (!t)
                return !1;
            var r = t.createTexture();
            t.bindTexture(t.TEXTURE_2D, r),
            t.texImage2D(t.TEXTURE_2D, 0, t.RGBA, 2, 2, 0, t.RGBA, e, null),
            t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MAG_FILTER, i),
            t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, i);
            var a = t.createFramebuffer();
            t.bindFramebuffer(t.FRAMEBUFFER, a),
            t.framebufferTexture2D(t.FRAMEBUFFER, t.COLOR_ATTACHMENT0, t.TEXTURE_2D, r, 0);
            var s = this._checkRTT[n] = t.checkFramebufferStatus(t.FRAMEBUFFER) === t.FRAMEBUFFER_COMPLETE;
            return t.deleteTexture(r),
            t.deleteFramebuffer(a),
            t.bindTexture(t.TEXTURE_2D, null),
            t.bindFramebuffer(t.FRAMEBUFFER, null),
            s
        },
        hasLinearHalfFloatRTT: function(t) {
            return this._webGLExtensions.OES_texture_half_float_linear && this.checkSupportRTT(t, n.HALF_FLOAT_OES, n.LINEAR)
        },
        hasLinearFloatRTT: function(t) {
            return this._webGLExtensions.OES_texture_float_linear && this.checkSupportRTT(t, n.FLOAT, n.LINEAR)
        },
        hasHalfFloatRTT: function(t) {
            return this._webGLExtensions.OES_texture_half_float && this.checkSupportRTT(t, n.HALF_FLOAT_OES, n.NEAREST)
        },
        hasFloatRTT: function(t) {
            return this._webGLExtensions.OES_texture_float && this.checkSupportRTT(t, n.FLOAT, n.NEAREST)
        },
        queryPrecision: function(t, e, i) {
            var n = t.getShaderPrecisionFormat(e, i);
            return !!n && 0 !== n.precision
        },
        hasVAO: function() {
            return !!this._webGLExtensions.OES_vertex_array_object
        },
        getDisjointTimerQuery: function() {
            return this._webGLExtensions.EXT_disjoint_timer_query_webgl2 || this._webGLExtensions.EXT_disjoint_timer_query
        },
        initWebGLParameters: function(t) {
            if (t) {
                for (var e = ["MAX_COMBINED_TEXTURE_IMAGE_UNITS", "MAX_CUBE_MAP_TEXTURE_SIZE", "MAX_FRAGMENT_UNIFORM_VECTORS", "MAX_RENDERBUFFER_SIZE", "MAX_TEXTURE_IMAGE_UNITS", "MAX_TEXTURE_SIZE", "MAX_VARYING_VECTORS", "MAX_VERTEX_ATTRIBS", "MAX_VERTEX_TEXTURE_IMAGE_UNITS", "MAX_VERTEX_UNIFORM_VECTORS", "MAX_VIEWPORT_DIMS", "SHADING_LANGUAGE_VERSION", "VERSION", "VENDOR", "RENDERER", "ALIASED_LINE_WIDTH_RANGE", "ALIASED_POINT_SIZE_RANGE", "RED_BITS", "GREEN_BITS", "BLUE_BITS", "ALPHA_BITS", "DEPTH_BITS", "STENCIL_BITS"], i = this._webGLParameters, n = 0, r = e.length; n < r; ++n) {
                    var a = e[n];
                    i[a] = t.getParameter(t[a])
                }
                this.queryPrecision(t, t.FRAGMENT_SHADER, t.HIGH_FLOAT) ? i.MAX_SHADER_PRECISION_FLOAT = "high" : this.queryPrecision(t, t.FRAGMENT_SHADER, t.MEDIUM_FLOAT) ? i.MAX_SHADER_PRECISION_FLOAT = "medium" : this.queryPrecision(t, t.FRAGMENT_SHADER, t.LOW_FLOAT) && (i.MAX_SHADER_PRECISION_FLOAT = "low"),
                this.queryPrecision(t, t.FRAGMENT_SHADER, t.HIGH_INT) ? i.MAX_SHADER_PRECISION_INT = "high" : this.queryPrecision(t, t.FRAGMENT_SHADER, t.MEDIUM_INT) ? i.MAX_SHADER_PRECISION_INT = "medium" : this.queryPrecision(t, t.FRAGMENT_SHADER, t.LOW_INT) && (i.MAX_SHADER_PRECISION_INT = "low");
                var s = t.getExtension("WEBGL_debug_renderer_info");
                s && (i.UNMASKED_RENDERER_WEBGL = t.getParameter(s.UNMASKED_VENDOR_WEBGL),
                i.UNMASKED_VENDOR_WEBGL = t.getParameter(s.UNMASKED_RENDERER_WEBGL))
            }
        },
        applyExtension: function(t, e) {
            var i = t.getExtension(e)
              , n = e.split("_")[0]
              , r = "_" + n
              , a = new RegExp(n + "$")
              , s = new RegExp(r);
            for (var o in i) {
                if ("function" == typeof i[o]) {
                    var l = o.replace(a, "");
                    o.substring && (t[l] = i[o].bind(i))
                } else {
                    var u = o.replace(s, "");
                    void 0 === t[u] && (t[u] = i[o])
                }
            }
        },
        getWebGLExtension: function(t) {
            return this._webGLExtensions[t]
        },
        getWebGLExtensions: function() {
            return this._webGLExtensions
        },
        initWebGLExtensions: function(t, e) {
            if (t) {
                var i = e;
                void 0 === i && (i = !0);
                for (var r = t.getSupportedExtensions(), a = this._webGLExtensions, s = 0, o = r.length; s < o; ++s) {
                    var l = r[s];
                    i && this._bugsDB[l] || (a[l] = t.getExtension(l),
                    this._isGL2 || this.applyExtension(t, l))
                }
                var u = this.getWebGLExtension("EXT_texture_filter_anisotropic");
                u && (n.ANISOTROPIC_SUPPORT_EXT = !0,
                n.ANISOTROPIC_SUPPORT_MAX = t.getParameter(u.MAX_TEXTURE_MAX_ANISOTROPY_EXT))
            }
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = 0
      , a = function() {
        this._name = "AbstractNode",
        this._inputs = [],
        this._outputs = null,
        this._id = r++,
        this._text = void 0
    };
    a.prototype = {
        getID: function() {
            return this._id
        },
        getName: function() {
            return this._name
        },
        getType: function() {
            return this.type
        },
        toString: function() {
            var t = "name : " + this._name;
            return this.type && (t += " (" + this.type + ")"),
            t
        },
        getInputs: function() {
            return this._inputs
        },
        getOutputs: function() {
            return this._outputs
        },
        checkInputsOutputs: function() {
            var t, e;
            if (this.validInputs)
                for (t = 0; t < this.validInputs.length; t++)
                    if (e = this.validInputs[t],
                    !this._inputs[e])
                        return n.error("Shader node " + this.type + " validation error input " + e + " is missing"),
                        !1;
            if (this.validOutputs)
                for (t = 0; t < this.validOutputs.length; t++)
                    if (e = this.validOutputs[t],
                    !this._outputs[e])
                        return n.error("Shader node " + this.type + " validation error output " + e + " is missing"),
                        !1;
            return !0
        },
        inputs: function() {
            for (var t = 0, e = arguments.length; t < e; t++) {
                var i = arguments[t];
                if (!i) {
                    n.error("Shader node " + this.type + " input number " + e + " is undefined ");
                    break
                }
                if (Array.isArray(i))
                    return this.inputs.apply(this, i),
                    this;
                if ("object" == typeof i && null !== i && i instanceof a == !1)
                    return this._inputs = i,
                    this;
                this._inputs.push(i)
            }
            return this
        },
        outputs: function(t) {
            if (this._outputs = t,
            this._outputs instanceof a == !0)
                this.autoLink(this._outputs);
            else
                for (var e in this._outputs)
                    this.autoLink(this._outputs[e]);
            return this
        },
        autoLink: function(t) {
            return void 0 === t ? this : (t.inputs(this),
            this)
        },
        computeShader: function() {
            return this._text
        },
        comment: function(t) {
            this._comment = "//" + t
        },
        getComment: function() {
            return this._comment
        }
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(151)
      , a = n.a.osg
      , s = function() {
        a.StateAttribute.call(this),
        this._channelMapping = {},
        this._materialModel = void 0,
        this._additive = !1,
        this._opaqueEarlyZ = !0,
        this._hashes = ["", ""],
        this._dirtyUniforms = !0,
        this._activeChannels = []
    };
    s.SHADING_COMPILER = 0,
    s.EARLYZ_COMPILER = 1,
    s.WIREFRAME_COMPILER = 2,
    s.CURRENT_COMPILER = s.SHADING_COMPILER;
    var o = [];
    o[s.SHADING_COMPILER] = r.a,
    o[s.EARLYZ_COMPILER] = ["Opacity", "Displacement"],
    o[s.WIREFRAME_COMPILER] = ["Displacement"],
    s.hasVertexColor = !1,
    s.hasVertexAlpha = !1,
    s.prototype = a.objectLibraryClass(a.objectInherit(a.StateAttribute.prototype, {
        attributeType: "SketchfabMaterial",
        dirtyMaterial: function() {
            for (var t = this._hashes.length, e = 0; e < t; ++e)
                this._hashes[e] = "";
            this._dirtyUniforms = !0
        },
        getHash: function() {
            if (!this._materialModel)
                return "";
            var t = this._hashes[s.CURRENT_COMPILER];
            if (t)
                return t;
            t = this.attributeType,
            s.CURRENT_COMPILER !== s.WIREFRAME_COMPILER && (t += this.getVertexAlphaEnable() ? "1" : "0"),
            s.CURRENT_COMPILER === s.SHADING_COMPILER && (t += (this.getShadeless() ? "1" : "0") + (this.getVertexColorEnable() ? "1" : "0") + (this.getHasOnlyPoints() ? "1" : "0") + ("srgb" === this.getVertexColorColorSpace() ? "1" : "0"));
            for (var e = this._materialModel.getChannels(), i = o[s.CURRENT_COMPILER], n = i.length, r = this._channelMapping, a = 0; a < n; ++a) {
                var l = i[a];
                t += "." + r[l] + e[l].getShaderHash()
            }
            return this._hashes[s.CURRENT_COMPILER] = t,
            t
        },
        setMaterialModel: function(t) {
            this._materialModel = t
        },
        setChannelMapping: function(t, e) {
            this._channelMapping[t] = e
        },
        updateOpacity: function() {
            var t = this._materialModel.getChannels().Opacity
              , e = t.getTransparency()
              , i = t.isEffective()
              , n = "additive" === e
              , r = "alphaBlend" === e
              , a = "alphaMask" === e
              , s = "dithering" === e;
            this._additive = i && n,
            this._opaqueEarlyZ = !i || a || s,
            !this._opaqueEarlyZ && r && 1 === t.getFactor() && (this._opaqueEarlyZ = !!t.getTexture() || t.get("vertexAlphaEnable"))
        },
        cloneType: function() {
            return new s
        },
        getType: function() {
            return this.attributeType
        },
        getTypeMember: function() {
            return this.attributeType
        },
        getMaterialModel: function() {
            return this._materialModel
        },
        getShadeless: function() {
            return this._materialModel && this._materialModel.get("shadeless")
        },
        getReflection: function() {
            return this._materialModel && this._materialModel.get("reflection")
        },
        getVertexColorEnable: function() {
            return this._materialModel && this._materialModel.get("vertexColorEnable")
        },
        getVertexAlphaEnable: function() {
            return this._materialModel && this._materialModel.get("vertexAlphaEnable")
        },
        getVertexColorColorSpace: function() {
            return this._materialModel && this._materialModel.get("vertexColorColorSpace")
        },
        getCullFace: function() {
            return this._materialModel && this._materialModel.get("cullFace")
        },
        getHasOnlyPoints: function() {
            return this._materialModel && this._materialModel.hasOnlyPoints()
        },
        getAdditive: function() {
            return this._additive
        },
        getOpaqueEarlyZ: function() {
            return this._opaqueEarlyZ
        },
        getChannelMapping: function(t) {
            return this._channelMapping[t]
        },
        getOrCreateUniforms: function() {
            if (s.uniforms)
                return s.uniforms;
            var t = s.uniforms = {};
            t.uReflection = a.Uniform.createFloat("uReflection");
            for (var e = i(550).default, n = r.a.length, o = 0; o < n; ++o) {
                var l = r.a[o]
                  , u = e[l].model;
                u.prototype.addUniforms.call(u, t, l)
            }
            return t
        },
        _cacheChannelUniforms: function() {
            var t = this.getOrCreateUniforms()
              , e = this._materialModel.getChannels()
              , i = r.a.length
              , n = this._activeChannels;
            n.length = 0;
            for (var a = 0; a < i; ++a) {
                var s = e[r.a[a]];
                s.isEnableEffective() && (s.cacheUniforms(t),
                n.push(s))
            }
        },
        apply: function() {
            if (this._materialModel) {
                this._dirtyUniforms && (this._dirtyUniforms = !1,
                this._cacheChannelUniforms());
                this.getOrCreateUniforms().uReflection.setFloat(this.getReflection());
                for (var t = this._activeChannels, e = t.length, i = 0; i < e; ++i)
                    t[i].updateUniforms()
            }
        }
    }), "osgSketchfab", "Material"),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(4)
      , s = i(553)
      , o = i(43)
      , l = i(51)
      , u = a.a.osg
      , h = function(t) {
        return 0 !== t && (t & 1 + ~t) === t
    }
      , c = function(t) {
        return 1 << Math.floor(Math.log2(t))
    }
      , d = function() {
        u.Texture.call(this),
        this._isVideo = !1,
        this._requireOriginalCompression = !1,
        this._imageProxy = void 0,
        this._convertNPOT = !0,
        this._truePackingRead = void 0
    };
    d.WAIT_ANIMATION = !0;
    var p = u.ImageStream.prototype.play;
    u.ImageStream.prototype.play = function() {
        this._status !== u.ImageStream.PLAYING && (l.a.draw(),
        p.call(this))
    }
    ;
    var f = -1 === navigator.userAgent.indexOf("Firefox/46");
    d.prototype = u.objectLibraryClass(u.objectInherit(u.Texture.prototype, {
        isVideo: function() {
            return this._isVideo
        },
        getOriginalFormat: function() {
            return this._truePackingRead || this.getInternalFormat()
        },
        setImage: function(t, e) {
            var i = t instanceof u.Image;
            if (!i || t.isDirty() || t !== this.getImage()) {
                var n = t instanceof u.ImageStream;
                if (this._convertNPOT && i && !n) {
                    var r = t.getWidth()
                      , a = t.getHeight();
                    if (!h(r) || !h(a)) {
                        var s = document.createElement("canvas");
                        r = s.width = c(r),
                        a = s.height = c(a);
                        s.getContext("2d").drawImage(t.getImage(), 0, 0, r, a),
                        t = s
                    }
                }
                !f && this.hasMipmapFilter() && this.setMinFilter(this.getMagFilter()),
                u.Texture.prototype.setImage.call(this, t, e),
                l.a.draw()
            }
        },
        applyTexImage2D: function() {
            u.Texture.prototype.applyTexImage2D.apply(this, arguments),
            l.a.draw()
        },
        getResourceManager: function() {
            return this._resourceManager || i(89).default.instance
        },
        setImageProxy: function(t) {
            this._imageProxy = t,
            this._isVideo = t.isVideo(),
            this.updateRequireOriginalCompression();
            var e = this.getImageJSONMaxSupported();
            e.options && "A" === e.options.format ? (this._truePackingRead = u.Texture.ALPHA,
            this.setInternalFormat(u.Texture.LUMINANCE)) : this._truePackingRead = void 0
        },
        getImageProxy: function() {
            return this._imageProxy
        },
        getImageCount: function() {
            var t = this._imageProxy;
            return t && t.getImages ? t.getImages().length : this._image ? 1 : 0
        },
        setImageSmallest: function() {
            var t = this.getImageSmallest();
            if (t)
                return !0 === t.promise.isFulfilled() && t.image ? this.setImage(t.image) : t.promise.then(this.setImage.bind(this)),
                t
        },
        setImageMaxSupported: function() {
            var t = this.getImageMaxSupported();
            if (t) {
                var e = d.WAIT_ANIMATION ? o.a.getFirstCameraAnimation() : r.a.resolve()
                  , i = r.a.settle([e, t.promise, o.a.getLowResBound()])
                  , n = this;
                return t.promise = i.then(function() {
                    return n.setImage(t.image),
                    t.image
                }),
                t
            }
        },
        getImageSmallest: function() {
            if (this._imageProxy) {
                var t = this._requireOriginalCompression ? void 0 : this.getOriginalFormat()
                  , e = this._imageProxy.findImageNearestToResolution(128, 128, t);
                return this.getResourceImage(e)
            }
        },
        updateRequireOriginalCompression: function() {
            var t = i.i(s.a)()
              , e = this._imageProxy.findImageNearestPowerOfTwoUpToResolution(t, t, this.getOriginalFormat())
              , n = this._imageProxy.findImageNearestPowerOfTwoUpToResolution(t, t)
              , r = Math.min(t, c(n.width))
              , a = Math.min(t, c(n.height));
            return this._requireOriginalCompression = e.width < r || e.height < a,
            this._requireOriginalCompression
        },
        getImageJSONMaxSupported: function(t) {
            t = i.i(s.a)(t);
            var e = this._requireOriginalCompression ? void 0 : this.getOriginalFormat();
            return this._imageProxy.findImageNearestPowerOfTwoUpToResolution(t, t, e)
        },
        getImageMaxSupported: function() {
            if (this._imageProxy)
                return this.getResourceImage(this.getImageJSONMaxSupported())
        },
        getImageWidget: function() {
            if (this._imageProxy)
                return this.getResourceImage(this._imageProxy.findImageWidget(), !0)
        },
        getResourceImage: function(t, e) {
            return !e && t.url && t.width * t.height > 1048576 && (t.options = t.options || {},
            t.options.decodeAsync = !0),
            this.getResourceManager().getOrCreateImage(t.url, t.options)
        },
        getHash: function() {
            return "osgSketchfabTexture"
        }
    }), "osgSketchfab", "Texture"),
    d.dummyTexture = new d,
    d.dummyTexture.setTextureSize(1, 1),
    e.a = d
}
, , , , , , , , , function(t, e) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/popovers.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = "";
                try {
                    var s = null
                      , o = n.makeMacro([], ["options"], function(r) {
                        var a = i;
                        i = new n.Frame,
                        r = r || {},
                        r.hasOwnProperty("caller") && i.set("caller", r.caller),
                        i.set("options", r.hasOwnProperty("options") ? r.options : {});
                        var s = "";
                        return s += '\n\n    <div class="popover share-popover hidden',
                        n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "class") && (s += " ",
                        s += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "class"), t.opts.autoescape)),
                        s += '">\n        <p>Thanks!</p>\n        <p>Also share?</p>\n\n        <a data-action="share-on-twitter" class="icon fa fa-twitter"></a>\n        <a data-action="share-on-google-plus" class="icon fa fa-google-plus"></a>\n        <a data-action="share-on-facebook" class="icon fa fa-facebook"></a>\n        <a data-action="share-on-pinterest" class="icon fa fa-pinterest"></a>\n    </div>\n\n',
                        i = a,
                        new n.SafeString(s)
                    });
                    e.addExport("share_popover"),
                    e.setVariable("share_popover", o),
                    a += "\n",
                    s ? s.rootRenderFunc(t, e, i, n, r) : r(null, a)
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, , , , , function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(27);
    e.a = {
        isMaintenance: function() {
            return r()('meta[property="skfb:maintenance"]').attr("content")
        },
        showPopup: function() {
            var t = this.isMaintenance()
              , e = new a.default({
                title: t ? "Maintenance" : "Error",
                text: t ? 'Sketchfab is undergoing maintenance.<br>See: <a href="https://forum.sketchfab.com/t/sketchfab-operations/6678" target=_blank>Operations forum post</a>' : "An unknown error occurred. Please try again later. If the error persists, please contact support@sketchfab.com",
                buttons: {
                    ok: !0
                },
                safe: !0
            });
            return e.open().then(function() {
                e.close()
            }),
            e
        }
    }
}
, , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).vec3
      , a = i(5).mat4
      , s = function() {
        this._min = r.create(),
        this._max = r.create(),
        this.init()
    };
    s.prototype = n.objectLibraryClass({
        init: function() {
            r.copy(this._min, r.INFINITY),
            r.copy(this._max, r.NEGATIVE_INFINITY)
        },
        copy: function(t) {
            var e = this._min
              , i = t._min;
            e[0] = i[0],
            e[1] = i[1],
            e[2] = i[2];
            var n = this._max
              , r = t._max;
            n[0] = r[0],
            n[1] = r[1],
            n[2] = r[2]
        },
        valid: function() {
            return this._max[0] >= this._min[0] && this._max[1] >= this._min[1] && this._max[2] >= this._min[2]
        },
        expandByBoundingSphere: function(t) {
            if (t.valid()) {
                var e = this._max
                  , i = this._min
                  , n = t._radius
                  , r = t._center[0]
                  , a = t._center[1]
                  , s = t._center[2];
                i[0] = Math.min(i[0], r - n),
                i[1] = Math.min(i[1], a - n),
                i[2] = Math.min(i[2], s - n),
                e[0] = Math.max(e[0], r + n),
                e[1] = Math.max(e[1], a + n),
                e[2] = Math.max(e[2], s + n)
            }
        },
        expandByvec3: function(t) {
            var e = this._min
              , i = this._max;
            e[0] = Math.min(e[0], t[0]),
            e[1] = Math.min(e[1], t[1]),
            e[2] = Math.min(e[2], t[2]),
            i[0] = Math.max(i[0], t[0]),
            i[1] = Math.max(i[1], t[1]),
            i[2] = Math.max(i[2], t[2])
        },
        expandByBoundingBox: function(t) {
            if (t.valid()) {
                var e = this._min
                  , i = this._max
                  , n = t._min
                  , r = t._max;
                n[0] < e[0] && (e[0] = n[0]),
                r[0] > i[0] && (i[0] = r[0]),
                n[1] < e[1] && (e[1] = n[1]),
                r[1] > i[1] && (i[1] = r[1]),
                n[2] < e[2] && (e[2] = n[2]),
                r[2] > i[2] && (i[2] = r[2])
            }
        },
        center: function(t) {
            var e = this._min
              , i = this._max;
            return t[0] = .5 * (e[0] + i[0]),
            t[1] = .5 * (e[1] + i[1]),
            t[2] = .5 * (e[2] + i[2]),
            t
        },
        radius: function() {
            return Math.sqrt(this.radius2())
        },
        radius2: function() {
            var t = this._min
              , e = this._max
              , i = e[0] - t[0]
              , n = e[1] - t[1]
              , r = e[2] - t[2];
            return .25 * (i * i + n * n + r * r)
        },
        getMin: function() {
            return this._min
        },
        getMax: function() {
            return this._max
        },
        setMin: function(t) {
            return r.copy(this._min, t),
            this
        },
        setMax: function(t) {
            return r.copy(this._max, t),
            this
        },
        xMax: function() {
            return this._max[0]
        },
        yMax: function() {
            return this._max[1]
        },
        zMax: function() {
            return this._max[2]
        },
        xMin: function() {
            return this._min[0]
        },
        yMin: function() {
            return this._min[1]
        },
        zMin: function() {
            return this._min[2]
        },
        corner: function(t, e) {
            return e[0] = 1 & t ? this._max[0] : this._min[0],
            e[1] = 2 & t ? this._max[1] : this._min[1],
            e[2] = 4 & t ? this._max[2] : this._min[2],
            e
        },
        transformMat4: function() {
            var t = r.create()
              , e = r.create();
            return function(i, n) {
                var s = this.getMin()
                  , o = this.getMax();
                a.getTranslation(t, n),
                r.copy(e, t);
                for (var l = 0; l < 3; ++l)
                    for (var u = 4 * l, h = s[l], c = o[l], d = 0; d < 3; ++d) {
                        var p = n[u + d]
                          , f = p * c
                          , g = p * h;
                        f < g ? (t[d] += f,
                        e[d] += g) : (t[d] += g,
                        e[d] += f)
                    }
                var m = i.getMax()
                  , v = i.getMin();
                return m[0] = e[0],
                m[1] = e[1],
                m[2] = e[2],
                v[0] = t[0],
                v[1] = t[1],
                v[2] = t[2],
                i
            }
        }()
    }, "osg", "BoundingBox"),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(5).mat4
      , r = i(5).quat
      , a = i(5).vec3
      , s = i(625)
      , o = {};
    o.InvalidTargetID = -1;
    var l = function(t, e, i) {
        return {
            type: t,
            id: o.InvalidTargetID,
            channels: [],
            value: e,
            defaultValue: i
        }
    }
      , u = function(t) {
        return l(s.Quat, r.copy(r.create(), t), r.copy(r.create(), t))
    }
      , h = function(t) {
        return l(s.Matrix, n.copy(n.create(), t), n.copy(n.create(), t))
    }
      , c = function(t) {
        return l(s.Vec3, a.copy(a.create(), t), a.copy(a.create(), t))
    }
      , d = function(t) {
        return l(s.Float, t, t)
    };
    o.createQuatTarget = u,
    o.createVec3Target = c,
    o.createFloatTarget = d,
    o.createMatrixTarget = h,
    t.exports = o
}
, , function(t, e, i) {
    "use strict";
    var n = i(15)
      , r = new n.a;
    r.PBR_LIT = 1,
    r.CLASSIC_LIT = 2,
    r.PBR_SHADELESS = 4,
    r.CLASSIC_SHADELESS = 8,
    r.MATCAP = 16,
    r.nameMatch = {
        "pbr-shadeless": r.PBR_SHADELESS,
        "classic-shadeless": r.CLASSIC_SHADELESS,
        "pbr-lit": r.PBR_LIT,
        "shading-vr": r.PBR_LIT,
        "classic-lit": r.CLASSIC_LIT
    },
    r.LIT = r.PBR_LIT | r.CLASSIC_LIT,
    r.SHADELESS = r.PBR_SHADELESS | r.CLASSIC_SHADELESS,
    r.PBR = r.PBR_LIT | r.PBR_SHADELESS,
    r.CLASSIC = r.CLASSIC_LIT | r.CLASSIC_SHADELESS,
    r.set("mask", r.PBR_LIT),
    r.on("change:mask", function() {
        var t = r.get("mask");
        switch (t) {
        case r.PBR_LIT:
        case r.CLASSIC_LIT:
        case r.PBR_SHADELESS:
        case r.CLASSIC_SHADELESS:
        case r.MATCAP:
            break;
        default:
            console.error("Invalid ShadingGlobal mask value !" + t)
        }
    }),
    e.a = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(37)
      , s = i(751)
      , o = i(750)
      , l = i(498)
      , u = i(551)
      , h = r.a.osg
      , c = function(t, e) {
        h.NodeVisitor.call(this, h.NodeVisitor.TRAVERSE_ALL_CHILDREN),
        this._lights = [],
        this._materials = [],
        this._materialManager = t,
        this._stateSetsProcessed = {},
        this._authoringTool = e,
        this._style = "",
        this._hasMetal = void 0,
        this._globalEnforceRoughness = void 0,
        this._dictionary = a.a.channelNames,
        this._dictionaryKeys = Object.keys(a.a.channelNames)
    };
    c.prototype = h.objectInherit(h.NodeVisitor.prototype, {
        getStyle: function() {
            return this._style
        },
        hasMetallicWorkflow: function() {
            return this._hasMetal
        },
        getLights: function() {
            return this._lights
        },
        getMaterials: function() {
            return this._materials
        },
        copyDiffuse: function(t) {
            var e = t.getChannels().DiffuseColor
              , i = t.getChannels().AlbedoPBR
              , n = t.getChannels().DiffusePBR
              , r = e.getColor()
              , a = e.getFactor()
              , s = e.getTexture();
            r && (i.setColor(r),
            n.setColor(r)),
            i.setFactor(a),
            n.setFactor(a),
            s && (i.setTexture(s),
            n.setTexture(s))
        },
        matchNameAgainstDict: function(t, e, n) {
            for (var r = i.i(o.a)(t), a = 0; a < e.length; a++) {
                var l = e[a]
                  , u = i.i(s.a)(r, l);
                if (u < n && u < l.length)
                    return !0
            }
            return !1
        },
        channelTextureExtract: function(t, e) {
            var i = t.getChannels()[e];
            if (i) {
                var n = i.getTexture();
                if (n)
                    return n.getImage().getName()
            }
        },
        channelTextureMatch: function(t, e, i, n) {
            var r = this.channelTextureExtract(t, e);
            return r && this.matchNameAgainstDict(r, i, n)
        },
        hasTextureChannel: function(t, e) {
            return void 0 !== this.channelTextureExtract(t, e)
        },
        channelTextureCopy: function(t, e, i) {
            var n, r = t.getChannels();
            if (this.channelTextureExtract(t, e))
                for (var a = i.length; a--; )
                    n = r[i[a]],
                    n.setTexture(r[e].getTexture().clone())
        },
        checkPBRSlot: function(t) {
            if (t)
                for (var e = 0; e < this._dictionaryKeys.length; e++) {
                    var i = this._dictionaryKeys[e]
                      , n = this._dictionary[i];
                    if (this.matchNameAgainstDict(t, n, a.a.maxLevenshteinDistance))
                        return i
                }
        },
        assignPBRTextureFromFilenames: function(t, e) {
            t.forEach(function(t) {
                var i = t.getName()
                  , n = this.checkPBRSlot(i);
                if (void 0 === n && t.getImage() && (i = t.getImage().getURL(),
                n = this.checkPBRSlot(i)),
                void 0 !== n) {
                    var r, a = e.getChannels();
                    r = a[n],
                    void 0 === r.getTexture() && r.setTexture(this.createTextureModelFromTextureOSG(t))
                }
            }, this)
        },
        checkChannelsAndSetWorkFlowRoughGloss: function(t) {
            if (t) {
                var e = t.getChannels()
                  , i = this.hasTextureChannel(t, "GlossinessPBR")
                  , n = this.hasTextureChannel(t, "SpecularPBR")
                  , r = this.hasTextureChannel(t, "RoughnessPBR");
                this.hasTextureChannel(t, "BumpMap") && e.BumpMap.setFactor(10),
                this.hasTextureChannel(t, "MetalnessPBR") && (this._hasMetal = !0),
                n && (e.SpecularPBR.setFactor(1),
                void 0 === this._hasMetal && (this._hasMetal = !1)),
                t.setWorkFlowRoughGloss(r || this._globalEnforceRoughness || !r && !i && void 0 === this._globalEnforceRoughness, !1)
            }
        },
        setChannelsFromImagesNames: function(t, e, i) {
            for (var n = 0, r = e.length; n < r; n++)
                for (var s = 0, o = i.length; s < o; s++) {
                    var u = i[s].get("name");
                    if (this.matchNameAgainstDict(u, this._dictionary[e[n]], a.a.maxLevenshteinDistance)) {
                        var h = t.getChannels()[e[n]];
                        h.setTexture(new l.a({
                            image: i[s]
                        })),
                        h.setFactor(1),
                        t.setChannelEnable(h.get("name"), !0)
                    }
                }
        },
        getPBRChannels: function(t) {
            var e = [];
            return i.i(n.each)(t.getChannels(), function(t, i) {
                -1 !== i.indexOf("PBR") && e.push(i)
            }),
            e
        },
        checkForPBRTextureFromChannelsAndFilenames: function(t) {
            if (t) {
                for (var e = this.getPBRChannels(t), i = e.length; i--; )
                    if (void 0 !== this.channelTextureExtract(t, e[i]))
                        return;
                this.channelTextureCopy(t, "DiffuseColor", ["AlbedoPBR", "DiffusePBR"]),
                this.channelTextureCopy(t, "DiffuseIntensity", ["AOPBR"]);
                var n = this._dictionary;
                this.channelTextureMatch(t, "SpecularColor", n.MetalnessPBR, 2) ? this.channelTextureCopy(t, "SpecularColor", ["MetalnessPBR"]) : this.channelTextureMatch(t, "SpecularHardness", n.MetalnessPBR, 2) ? this.channelTextureCopy(t, "SpecularHardness", ["MetalnessPBR"]) : this.channelTextureMatch(t, "SpecularColor", n.SpecularPBR, 2) ? this.channelTextureCopy(t, "SpecularColor", ["SpecularPBR"]) : this.channelTextureMatch(t, "SpecularHardness", n.SpecularPBR, 2) && this.channelTextureCopy(t, "SpecularHardness", ["SpecularPBR"]),
                this.channelTextureMatch(t, "SpecularColor", n.RoughnessPBR, 2) ? this.channelTextureCopy(t, "SpecularColor", ["RoughnessPBR"]) : this.channelTextureMatch(t, "SpecularHardness", n.RoughnessPBR, 2) ? this.channelTextureCopy(t, "SpecularHardness", ["RoughnessPBR"]) : this.channelTextureMatch(t, "SpecularColor", n.GlossinessPBR, 2) ? this.channelTextureCopy(t, "SpecularColor", ["GlossinessPBR"]) : this.channelTextureMatch(t, "SpecularHardness", n.GlossinessPBR, 2) && this.channelTextureCopy(t, "SpecularHardness", ["GlossinessPBR"])
            }
        },
        checkForPBRTextureFromMaterialAndFilenames: function(t) {
            if (t) {
                var e = []
                  , r = this;
                i.i(n.each)(t.getChannels(), function(i, n) {
                    r.channelTextureExtract(t, n) || e.push(n)
                });
                var a = []
                  , s = this._materialManager.getImageCollection().clone();
                s.comparator = function(t, e) {
                    return (t.get("version") || 0) - (e.get("version") || 0)
                }
                ,
                s.sort();
                for (var o = t.get("name").toLowerCase(), l = 0; l < s.length; l++)
                    -1 !== s.models[l].get("name").toLowerCase().indexOf(o) && a.push(s.models[l]);
                this.setChannelsFromImagesNames(t, e, a)
            }
        },
        hasMaterialAttributes: function(t) {
            return t.getAttribute("Material")
        },
        hasTextureAttributes: function(t) {
            for (var e = 0, i = t.getNumTextureAttributeLists(); e < i; e++)
                if (t.getTextureAttribute(e, "Texture"))
                    return !0;
            return !1
        },
        processDefaultMaterial: function(t, e) {
            e.removeAttribute("Material");
            for (var i = 0, n = e.getNumTextureAttributeLists(); i < n; i++)
                e.removeTextureAttribute(i, "Texture")
        },
        convertUserDataToObject: function(t) {
            var e = {};
            return t ? (t.forEach(function(t) {
                var i = t.Name
                  , n = t.Value;
                e[i] = n
            }),
            e) : e
        },
        getMetaData: function(t) {
            if (t && t.getUserData())
                return this.convertUserDataToObject(t.getUserData())
        },
        getTextureLists: function(t) {
            for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                var n = t.getTextureAttribute(i, "Texture");
                void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                e[i] = n)
            }
            return e
        },
        setMaterialChannelTexture: function(t, e, i, n, r) {
            t.removeTextureAttribute(i, "Texture");
            var a = e.getChannels()[n];
            a.setTexture(r),
            a.resetTextureFormat(),
            a.setTexCoordUnit(i),
            a.setEnable(!0)
        },
        createMaterial: function(t, e) {
            var i = this._materialManager.createMaterial(t, e);
            return this._materials.push(i),
            i
        },
        createTextureModelFromTextureOSG: function(t) {
            var e = u.a.getOptions(t)
              , r = t.getImage()
              , a = r.getURL()
              , s = this._materialManager.getImageCollection()
              , o = s.getImageFromURL(a);
            return o ? new l.a(i.i(n.extend)(e, {
                image: o
            })) : void h.error("SceneProcessorVisitor.createTextureModelFromTextureOSG can't find image " + a + " image collections")
        },
        mapTexturesOnMaterial: function(t, e) {
            for (var i = this.getTextureLists(t), n = t.getNumTextureAttributeLists(), r = function(t, e, i, n, r) {
                if (void 0 !== n) {
                    var a = this.createTextureModelFromTextureOSG(n);
                    this.setMaterialChannelTexture(t, e, i, r, a)
                }
            }
            .bind(this), a = 0, s = n; a < s; a++) {
                var o = a;
                void 0 !== t.getTextureAttribute(a, "Texture") && (1 === n ? r(t, e, o, i[o], "DiffuseColor") : n >= 2 && (0 === o ? r(t, e, o, i[o], "EmitColor") : 1 === o ? r(t, e, o, i[o], "DiffuseColor") : 2 === o && r(t, e, o, i[o], "SpecularColor")))
            }
        },
        postApply: function() {},
        applyExistingMaterial: function(t, e) {
            if (t) {
                var i = this._materialManager.getMaterialByStateSet(t);
                if (!i)
                    return void (this._stateSetsProcessed[t.getInstanceID()] = !0);
                var n = i.get("stateSet") || t
                  , r = n.getInstanceID();
                return !0 === this._stateSetsProcessed[r] ? i : (this._stateSetsProcessed[r] = !0,
                i.set("name", this._materialManager.getUniqueMaterialName(t.getAttributeMap().Material, t, e)),
                i.setStateSet(t),
                this._materials.push(i),
                i)
            }
        },
        processLightSource: function() {},
        pushLight: function(t) {
            var e = this.nodePath[this.nodePath.length - 1];
            e instanceof h.LightSource && (e.setNodeMask(0),
            e.setLight(t)),
            t._worldMatrix = h.computeLocalToWorld(this.nodePath),
            this._lights.push(t)
        },
        apply: function(t) {
            t.typeID === h.LightSource.typeID && this.processLightSource(t);
            var e = t.getStateSet();
            if (e) {
                var i = this.applyExistingMaterial(e, t);
                if (i)
                    t.setStateSet(i.get("stateSet"));
                else {
                    var n = this.getMetaData(e);
                    (this.hasMaterialAttributes(e) || this.hasTextureAttributes(e)) && (n ? this.processMaterial(t, e, n) : this.processDefaultMaterial(t, e)),
                    i = this._materialManager.getMaterialByStateSet(e),
                    this.checkForPBRTextureFromChannelsAndFilenames(i),
                    this._materialManager.getImageCollection().length && (this.checkForPBRTextureFromMaterialAndFilenames(i),
                    this.checkChannelsAndSetWorkFlowRoughGloss(i))
                }
            }
            this.traverse(t)
        }
    }),
    e.a = c
}
, , , , , , , , , , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = function(t, e, i, n) {
        r.call(this),
        this._sourceFactor = a.DISABLE,
        this._destinationFactor = a.DISABLE,
        this._sourceFactorAlpha = this._sourceFactor,
        this._destinationFactorAlpha = this._destinationFactor,
        this._separate = !1,
        void 0 !== t && this.setSource(t),
        void 0 !== e && this.setDestination(e),
        void 0 !== i && this.setSourceAlpha(i),
        void 0 !== n && this.setDestinationAlpha(n)
    };
    a.DISABLE = -1,
    a.ZERO = 0,
    a.ONE = 1,
    a.SRC_COLOR = 768,
    a.ONE_MINUS_SRC_COLOR = 769,
    a.SRC_ALPHA = 770,
    a.ONE_MINUS_SRC_ALPHA = 771,
    a.DST_ALPHA = 772,
    a.ONE_MINUS_DST_ALPHA = 773,
    a.DST_COLOR = 774,
    a.ONE_MINUS_DST_COLOR = 775,
    a.SRC_ALPHA_SATURATE = 776,
    a.BLEND_DST_RGB = 32968,
    a.BLEND_SRC_RGB = 32969,
    a.BLEND_DST_ALPHA = 32970,
    a.BLEND_SRC_ALPHA = 32971,
    a.CONSTANT_COLOR = 32769,
    a.ONE_MINUS_CONSTANT_COLOR = 32770,
    a.CONSTANT_ALPHA = 32771,
    a.ONE_MINUS_CONSTANT_ALPHA = 32772,
    a.BLEND_COLOR = 32773,
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "BlendFunc",
        cloneType: function() {
            return new a
        },
        setSource: function(t) {
            this.setSourceRGB(t),
            this.setSourceAlpha(t)
        },
        getSource: function() {
            return this._sourceFactor
        },
        setDestination: function(t) {
            this.setDestinationRGB(t),
            this.setDestinationAlpha(t)
        },
        getDestination: function() {
            return this._destinationFactor
        },
        getSeparate: function() {
            return this._separate
        },
        checkSeparate: function() {
            return this._sourceFactor !== this._sourceFactorAlpha || this._destinationFactor !== this._destinationFactorAlpha
        },
        setSourceRGB: function(t) {
            this._sourceFactor = "string" == typeof t ? a[t] : t,
            this._separate = this.checkSeparate()
        },
        getSourceRGB: function() {
            return this._sourceFactor
        },
        setSourceAlpha: function(t) {
            this._sourceFactorAlpha = "string" == typeof t ? a[t] : t,
            this._separate = this.checkSeparate()
        },
        getSourceAlpha: function() {
            return this._sourceFactorAlpha
        },
        setDestinationRGB: function(t) {
            this._destinationFactor = "string" == typeof t ? a[t] : t,
            this._separate = this.checkSeparate()
        },
        getDestinationRGB: function() {
            return this._destinationFactor
        },
        setDestinationAlpha: function(t) {
            this._destinationFactorAlpha = "string" == typeof t ? a[t] : t,
            this._separate = this.checkSeparate()
        },
        getDestinationAlpha: function() {
            return this._destinationFactorAlpha
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            this._sourceFactor === a.DISABLE || this._destinationFactor === a.DISABLE ? e.disable(e.BLEND) : (e.enable(e.BLEND),
            this._separate ? e.blendFuncSeparate(this._sourceFactor, this._destinationFactor, this._sourceFactorAlpha, this._destinationFactorAlpha) : e.blendFunc(this._sourceFactor, this._destinationFactor))
        }
    }), "osg", "BlendFunc"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = function(t, e, i, n) {
        r.call(this),
        this._func = a.LESS,
        this._near = 0,
        this._far = 1,
        this._writeMask = !0,
        void 0 !== t && (this._func = "string" == typeof t ? a[t] : t),
        void 0 !== e && (this._near = e),
        void 0 !== i && (this._far = i),
        void 0 !== n && (this._writeMask = n)
    };
    a.DISABLE = 0,
    a.NEVER = 512,
    a.LESS = 513,
    a.EQUAL = 514,
    a.LEQUAL = 515,
    a.GREATER = 516,
    a.NOTEQUAL = 517,
    a.GEQUAL = 518,
    a.ALWAYS = 519,
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Depth",
        cloneType: function() {
            return new a
        },
        setRange: function(t, e) {
            this._near = t,
            this._far = e
        },
        setWriteMask: function(t) {
            this._writeMask = t
        },
        getWriteMask: function() {
            return this._writeMask
        },
        getFunc: function() {
            return this._func
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            0 === this._func ? e.disable(e.DEPTH_TEST) : (e.enable(e.DEPTH_TEST),
            e.depthFunc(this._func),
            e.depthMask(this._writeMask),
            e.depthRange(this._near, this._far))
        }
    }), "osg", "Depth"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(13)
      , a = i(409)
      , s = i(66)
      , o = i(324)
      , l = i(326)
      , u = function() {
        a.call(this),
        s.call(this),
        this._fbo = void 0,
        this._rbo = void 0,
        this._attachments = [],
        this._dirty = !0,
        this._hasMRT = l.instance().getWebGLExtension("WEBGL_draw_buffers")
    };
    u.COLOR_ATTACHMENT0 = 36064,
    u.DEPTH_ATTACHMENT = 36096,
    u.DEPTH_COMPONENT16 = 33189,
    u._sDeletedGLFrameBufferCache = new window.Map,
    u.deleteGLFrameBuffer = function(t, e) {
        u._sDeletedGLFrameBufferCache.has(t) || u._sDeletedGLFrameBufferCache.set(t, []),
        u._sDeletedGLFrameBufferCache.get(t).push(e)
    }
    ,
    u.flushDeletedGLFrameBuffers = function(t, e) {
        if (e <= 0)
            return e;
        if (!u._sDeletedGLFrameBufferCache.has(t))
            return e;
        for (var i = 0, n = o.instance().tick(), r = u._sDeletedGLFrameBufferCache.get(t), a = r.length, s = a - 1; s >= 0 && i < e; s--)
            t.deleteFramebuffer(r[s]),
            r.splice(s, 1),
            i = o.instance().deltaS(n, o.instance().tick());
        return e - i
    }
    ,
    u.flushAllDeletedGLFrameBuffers = function(t) {
        if (u._sDeletedGLFrameBufferCache.has(t))
            for (var e = u._sDeletedGLFrameBufferCache.get(t), i = e.length, n = i - 1; n >= 0; n--)
                t.deleteFramebuffer(e[n]),
                e.splice(n, 1)
    }
    ,
    u._sDeletedGLRenderBufferCache = new window.Map,
    u.deleteGLRenderBuffer = function(t, e) {
        u._sDeletedGLRenderBufferCache.has(t) || u._sDeletedGLRenderBufferCache.set(t, []),
        u._sDeletedGLRenderBufferCache.get(t).push(e)
    }
    ,
    u.flushDeletedGLRenderBuffers = function(t, e) {
        if (e <= 0)
            return e;
        if (!u._sDeletedGLRenderBufferCache.has(t))
            return e;
        for (var i = 0, n = o.instance().tick(), r = u._sDeletedGLRenderBufferCache.get(t), a = r.length, s = a - 1; s >= 0 && i < e; s--)
            t.deleteRenderbuffer(r[s]),
            r.splice(s, 1),
            i = o.instance().deltaS(n, o.instance().tick());
        return e - i
    }
    ,
    u.flushAllDeletedGLRenderBuffers = function(t) {
        if (u._sDeletedGLRenderBufferCache.has(t))
            for (var e = u._sDeletedGLRenderBufferCache.get(t), i = e.length, n = i - 1; n >= 0; n--)
                t.deleteRenderbuffer(e[n]),
                e.splice(n, 1)
    }
    ,
    u.prototype = r.objectInherit(a.prototype, r.objectInherit(s.prototype, {
        attributeType: "FrameBufferObject",
        cloneType: function() {
            return new u
        },
        dirty: function() {
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        },
        setAttachment: function(t) {
            this._attachments.push(t)
        },
        releaseGLObjects: function() {
            void 0 !== this._fbo && void 0 !== this._gl && u.deleteGLFrameBuffer(this._gl, this._fbo),
            this._fbo = void 0,
            void 0 !== this._rbo && void 0 !== this._gl && u.deleteGLRenderBuffer(this._gl, this._rbo),
            this._rbo = void 0
        },
        _reportFrameBufferError: function(t) {
            switch (t) {
            case 36054:
                n.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");
                break;
            case 36055:
                n.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
                break;
            case 36057:
                n.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
                break;
            case 36061:
                n.debug("FRAMEBUFFER_UNSUPPORTED");
                break;
            default:
                n.debug("FRAMEBUFFER unknown error " + t.toString(16))
            }
        },
        reset: function() {
            this.releaseGLObjects(),
            this._attachments = []
        },
        getFrameBufferObject: function() {
            return this._fbo
        },
        createFrameBufferObject: function(t) {
            this.setGraphicContext(t.getGraphicContext()),
            this._fbo = this._gl.createFramebuffer()
        },
        createRenderBuffer: function(t, e, i) {
            var n = this._gl
              , r = n.createRenderbuffer();
            return n.bindRenderbuffer(n.RENDERBUFFER, r),
            n.renderbufferStorage(n.RENDERBUFFER, t, e, i),
            r
        },
        framebufferRenderBuffer: function(t, e) {
            var i = this._gl;
            i.bindRenderbuffer(i.RENDERBUFFER, e),
            i.framebufferRenderbuffer(i.FRAMEBUFFER, t, i.RENDERBUFFER, e)
        },
        framebufferTexture2D: function(t, e, i, n) {
            var r = this._gl;
            if (t.applyTextureAttribute(1, n),
            n.isDirty() || !n.getTextureObject())
                return !1;
            var a = r.DRAW_FRAMEBUFFER || r.FRAMEBUFFER;
            return r.framebufferTexture2D(a, e, i, n.getTextureObject().id(), 0),
            !0
        },
        bindFrameBufferObject: function() {
            var t = this._gl;
            t.bindFramebuffer(t.FRAMEBUFFER, this._fbo)
        },
        checkStatus: function() {
            var t = this._gl
              , e = t.checkFramebufferStatus(t.FRAMEBUFFER);
            e !== t.FRAMEBUFFER_COMPLETE && this._reportFrameBufferError(e)
        },
        _checkAllowedSize: function(t, e) {
            var i = l.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE");
            return !(0 === t || 0 === e || e > i || t > i) || (n.error("width (" + t + ") or height (" + t + ') makes frame buffer not bindable. Max RenderBuffer is "' + i + '"'),
            !1)
        },
        apply: function(t) {
            this._gl || this.setGraphicContext(t.getGraphicContext());
            var e = this._gl
              , i = this._attachments;
            if (0 === i.length && !this._fbo)
                return void e.bindFramebuffer(e.FRAMEBUFFER, null);
            if (!this.isDirty())
                return e.bindFramebuffer(e.FRAMEBUFFER, this._fbo),
                void (!0 === n.reportWebGLError && this.checkStatus());
            this._fbo || this.createFrameBufferObject(t),
            this.bindFrameBufferObject();
            for (var r = this._hasMRT ? [] : void 0, a = !1, s = 0, o = i.length; s < o; ++s) {
                var l = i[s];
                if (l.texture) {
                    var u = l.texture;
                    if (!this._checkAllowedSize(u.getWidth(), u.getHeight()))
                        return void this.releaseGLObjects();
                    if (this._hasMRT && l.attachment >= e.COLOR_ATTACHMENT0 && l.attachment <= e.COLOR_ATTACHMENT15 && r.push(l.attachment),
                    !this.framebufferTexture2D(t, l.attachment, l.textureTarget, u))
                        return void this.releaseGLObjects()
                } else {
                    if (!this._checkAllowedSize(l.width, l.height))
                        return void this.releaseGLObjects();
                    this._rbo = this.createRenderBuffer(l.format, l.width, l.height),
                    this.framebufferRenderBuffer(l.attachment, this._rbo),
                    a = !0
                }
            }
            r && r.length > 0 && e.drawBuffers(r),
            this.checkStatus(),
            a && e.bindRenderbuffer(e.RENDERBUFFER, null),
            this._dirty = !1
        }
    })),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e, i) {
        return Math.min(i, Math.max(e, t))
    }
      , r = function(t, e, i) {
        if (i <= t)
            return 0;
        if (i >= e)
            return 1;
        var n = (i - t) / (e - t);
        return n * n * (3 - 2 * n)
    }
      , a = function(t) {
        return t !== t
    };
    t.exports = {
        clamp: n,
        smoothStep: r,
        isNaN: a
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(5).vec3
      , r = i(162)
      , a = i(143)
      , s = i(134)
      , o = i(320)
      , l = i(321)
      , u = i(322)
      , h = i(323)
      , c = i(13)
      , d = function(t, e, i, n, o, u) {
        var h, d, p, f = void 0 !== t ? t : 0, g = void 0 !== e ? e : 0, m = void 0 !== i ? i : 0, v = void 0 !== n ? n : 1, _ = void 0 !== o ? o : 1, b = void 0 !== u ? u : 1, x = new a;
        h = v / 2,
        d = _ / 2,
        p = b / 2;
        var y = new c.Float32Array(72)
          , S = new c.Float32Array(48)
          , w = new c.Float32Array(72);
        y[0] = f - h,
        y[1] = g - d,
        y[2] = m + p,
        w[0] = 0,
        w[1] = -1,
        w[2] = 0,
        S[0] = 0,
        S[1] = 1,
        y[3] = f - h,
        y[4] = g - d,
        y[5] = m - p,
        w[3] = 0,
        w[4] = -1,
        w[5] = 0,
        S[2] = 0,
        S[3] = 0,
        y[6] = f + h,
        y[7] = g - d,
        y[8] = m - p,
        w[6] = 0,
        w[7] = -1,
        w[8] = 0,
        S[4] = 1,
        S[5] = 0,
        y[9] = f + h,
        y[10] = g - d,
        y[11] = m + p,
        w[9] = 0,
        w[10] = -1,
        w[11] = 0,
        S[6] = 1,
        S[7] = 1,
        y[12] = f + h,
        y[13] = g + d,
        y[14] = m + p,
        w[12] = 0,
        w[13] = 1,
        w[14] = 0,
        S[8] = 0,
        S[9] = 1,
        y[15] = f + h,
        y[16] = g + d,
        y[17] = m - p,
        w[15] = 0,
        w[16] = 1,
        w[17] = 0,
        S[10] = 0,
        S[11] = 0,
        y[18] = f - h,
        y[19] = g + d,
        y[20] = m - p,
        w[18] = 0,
        w[19] = 1,
        w[20] = 0,
        S[12] = 1,
        S[13] = 0,
        y[21] = f - h,
        y[22] = g + d,
        y[23] = m + p,
        w[21] = 0,
        w[22] = 1,
        w[23] = 0,
        S[14] = 1,
        S[15] = 1,
        y[24] = f + h,
        y[25] = g - d,
        y[26] = m + p,
        w[24] = 1,
        w[25] = 0,
        w[26] = 0,
        S[16] = 0,
        S[17] = 1,
        y[27] = f + h,
        y[28] = g - d,
        y[29] = m - p,
        w[27] = 1,
        w[28] = 0,
        w[29] = 0,
        S[18] = 0,
        S[19] = 0,
        y[30] = f + h,
        y[31] = g + d,
        y[32] = m - p,
        w[30] = 1,
        w[31] = 0,
        w[32] = 0,
        S[20] = 1,
        S[21] = 0,
        y[33] = f + h,
        y[34] = g + d,
        y[35] = m + p,
        w[33] = 1,
        w[34] = 0,
        w[35] = 0,
        S[22] = 1,
        S[23] = 1,
        y[36] = f - h,
        y[37] = g + d,
        y[38] = m + p,
        w[36] = -1,
        w[37] = 0,
        w[38] = 0,
        S[24] = 0,
        S[25] = 1,
        y[39] = f - h,
        y[40] = g + d,
        y[41] = m - p,
        w[39] = -1,
        w[40] = 0,
        w[41] = 0,
        S[26] = 0,
        S[27] = 0,
        y[42] = f - h,
        y[43] = g - d,
        y[44] = m - p,
        w[42] = -1,
        w[43] = 0,
        w[44] = 0,
        S[28] = 1,
        S[29] = 0,
        y[45] = f - h,
        y[46] = g - d,
        y[47] = m + p,
        w[45] = -1,
        w[46] = 0,
        w[47] = 0,
        S[30] = 1,
        S[31] = 1,
        y[48] = f - h,
        y[49] = g + d,
        y[50] = m + p,
        w[48] = 0,
        w[49] = 0,
        w[50] = 1,
        S[32] = 0,
        S[33] = 1,
        y[51] = f - h,
        y[52] = g - d,
        y[53] = m + p,
        w[51] = 0,
        w[52] = 0,
        w[53] = 1,
        S[34] = 0,
        S[35] = 0,
        y[54] = f + h,
        y[55] = g - d,
        y[56] = m + p,
        w[54] = 0,
        w[55] = 0,
        w[56] = 1,
        S[36] = 1,
        S[37] = 0,
        y[57] = f + h,
        y[58] = g + d,
        y[59] = m + p,
        w[57] = 0,
        w[58] = 0,
        w[59] = 1,
        S[38] = 1,
        S[39] = 1,
        y[60] = f + h,
        y[61] = g + d,
        y[62] = m - p,
        w[60] = 0,
        w[61] = 0,
        w[62] = -1,
        S[40] = 0,
        S[41] = 1,
        y[63] = f + h,
        y[64] = g - d,
        y[65] = m - p,
        w[63] = 0,
        w[64] = 0,
        w[65] = -1,
        S[42] = 0,
        S[43] = 0,
        y[66] = f - h,
        y[67] = g - d,
        y[68] = m - p,
        w[66] = 0,
        w[67] = 0,
        w[68] = -1,
        S[44] = 1,
        S[45] = 0,
        y[69] = f - h,
        y[70] = g + d,
        y[71] = m - p,
        w[69] = 0,
        w[70] = 0,
        w[71] = -1,
        S[46] = 1,
        S[47] = 1;
        var C = new c.Uint16Array(36);
        C[0] = 0,
        C[1] = 1,
        C[2] = 2,
        C[3] = 0,
        C[4] = 2,
        C[5] = 3,
        C[6] = 4,
        C[7] = 5,
        C[8] = 6,
        C[9] = 4,
        C[10] = 6,
        C[11] = 7,
        C[12] = 8,
        C[13] = 9,
        C[14] = 10,
        C[15] = 8,
        C[16] = 10,
        C[17] = 11,
        C[18] = 12,
        C[19] = 13,
        C[20] = 14,
        C[21] = 12,
        C[22] = 14,
        C[23] = 15,
        C[24] = 16,
        C[25] = 17,
        C[26] = 18,
        C[27] = 16,
        C[28] = 18,
        C[29] = 19,
        C[30] = 20,
        C[31] = 21,
        C[32] = 22,
        C[33] = 20,
        C[34] = 22,
        C[35] = 23,
        x.getAttributes().Vertex = new r(r.ARRAY_BUFFER,y,3),
        x.getAttributes().Normal = new r(r.ARRAY_BUFFER,w,3),
        x.getAttributes().TexCoord0 = new r(r.ARRAY_BUFFER,S,2);
        var M = new l(s.TRIANGLES,new r(r.ELEMENT_ARRAY_BUFFER,C,1));
        return x.getPrimitives().push(M),
        x
    }
      , p = function() {
        var t = new a
          , e = new c.Float32Array([-1, -1, -1, 4, 4, -1])
          , i = new c.Float32Array([-1, -1, -1, 4, 4, -1])
          , n = new c.Uint16Array(3);
        n[0] = 2,
        n[1] = 1,
        n[2] = 0,
        t.getAttributes().Vertex = new r(r.ARRAY_BUFFER,i,2),
        t.getAttributes().TexCoord0 = new r(r.ARRAY_BUFFER,e,2);
        var o = new l(s.TRIANGLES,new r(r.ELEMENT_ARRAY_BUFFER,n,1));
        return t.getPrimitives().push(o),
        function() {
            return t
        }
    }()
      , f = function(t, e, i, o, u, h, d, p, f, g, m, v, _) {
        void 0 === v && void 0 === _ && (v = g,
        _ = m,
        g = 0,
        m = 0);
        var b = new a
          , x = new c.Float32Array(12);
        x[0] = t + d,
        x[1] = e + p,
        x[2] = i + f,
        x[3] = t,
        x[4] = e,
        x[5] = i,
        x[6] = t + o,
        x[7] = e + u,
        x[8] = i + h,
        x[9] = t + o + d,
        x[10] = e + u + p,
        x[11] = i + h + f,
        void 0 === v && (v = 1),
        void 0 === _ && (_ = 1);
        var y = new c.Float32Array(8);
        y[0] = g,
        y[1] = _,
        y[2] = g,
        y[3] = m,
        y[4] = v,
        y[5] = m,
        y[6] = v,
        y[7] = _;
        var S = n.fromValues(o, u, h);
        n.cross(S, S, n.fromValues(d, p, f)),
        n.normalize(S, S);
        var w = new c.Float32Array(12);
        w[0] = S[0],
        w[1] = S[1],
        w[2] = S[2],
        w[3] = S[0],
        w[4] = S[1],
        w[5] = S[2],
        w[6] = S[0],
        w[7] = S[1],
        w[8] = S[2],
        w[9] = S[0],
        w[10] = S[1],
        w[11] = S[2];
        var C = new c.Uint16Array(6);
        C[0] = 0,
        C[1] = 1,
        C[2] = 2,
        C[3] = 0,
        C[4] = 2,
        C[5] = 3,
        b.getAttributes().Vertex = new r(r.ARRAY_BUFFER,x,3),
        b.getAttributes().Normal = new r(r.ARRAY_BUFFER,w,3),
        b.getAttributes().TexCoord0 = new r(r.ARRAY_BUFFER,y,2);
        var M = new l(s.TRIANGLES,new r(r.ELEMENT_ARRAY_BUFFER,C,1));
        return b.getPrimitives().push(M),
        b
    }
      , g = function(t) {
        void 0 === t && (t = 1),
        void 0 === g.getShader && (g.getShader = function() {
            if (void 0 === g.getShader.program) {
                var t = ["#ifdef GL_ES", "precision highp float;", "#endif", "attribute vec3 Vertex;", "attribute vec4 Color;", "uniform mat4 uModelViewMatrix;", "uniform mat4 uProjectionMatrix;", "", "varying vec4 vColor;", "", "void main(void) {", "  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0));", "  vColor = Color;", "}"].join("\n")
                  , e = ["#ifdef GL_ES", "precision highp float;", "#endif", "varying vec4 vColor;", "void main(void) {", "gl_FragColor = vColor;", "}"].join("\n")
                  , i = new u(new h("VERTEX_SHADER",t),new h("FRAGMENT_SHADER",e));
                g.getShader.program = i
            }
            return g.getShader.program
        }
        );
        var e = new a
          , i = new c.Float32Array(18);
        i[3] = t,
        i[10] = t,
        i[17] = t;
        var n = new c.Float32Array(24);
        n[0] = n[3] = 1,
        n[4] = n[7] = 1,
        n[9] = n[11] = 1,
        n[13] = n[15] = 1,
        n[18] = n[19] = 1,
        n[22] = n[23] = 1,
        e.getAttributes().Vertex = new r(r.ARRAY_BUFFER,i,3),
        e.getAttributes().Color = new r(r.ARRAY_BUFFER,n,4);
        var l = new o(s.LINES,0,6);
        return e.getPrimitives().push(l),
        e.getOrCreateStateSet().setAttributeAndModes(g.getShader()),
        e
    }
      , m = function(t, e, i, u, h, d, p) {
        t = t || 1,
        u = void 0 !== u ? u : 0,
        h = void 0 !== h ? h : 2 * Math.PI,
        d = void 0 !== d ? d : 0,
        p = void 0 !== p ? p : Math.PI;
        for (var f = Math.max(3, Math.floor(e) || 8), g = Math.max(2, Math.floor(i) || 6), m = f * g / 3 >= 65536, v = m ? f * g * 6 : f * g * 4, _ = new c.Float32Array(3 * v), b = new c.Float32Array(3 * v), x = new c.Float32Array(2 * v), y = m ? void 0 : new c.Uint16Array(f * g * 6), S = 0, w = 0, C = new c.Float32Array(3), M = new c.Float32Array(3), T = new c.Float32Array(3), A = new c.Float32Array(3), E = new c.Float32Array(3), P = new c.Float32Array(3), N = new c.Float32Array(3), k = new c.Float32Array(3), F = new c.Float32Array(2), D = new c.Float32Array(2), R = new c.Float32Array(2), I = new c.Float32Array(2), O = function(e, i, r, a, s) {
            r[0] = -t * Math.cos(u + e * h) * Math.sin(d + i * p),
            r[1] = t * Math.cos(d + i * p),
            r[2] = t * Math.sin(u + e * h) * Math.sin(d + i * p),
            n.normalize(a, r),
            s[0] = e,
            s[1] = 1 - i
        }, L = 0; L < g; L++)
            for (var B = 0; B < f; B++) {
                O((B + 1) / f, L / g, C, E, F),
                O(B / f, L / g, M, P, D),
                O(B / f, (L + 1) / g, T, N, R),
                O((B + 1) / f, (L + 1) / g, A, k, I);
                var V = 3 * S;
                _[V] = C[0],
                _[V + 1] = C[1],
                _[V + 2] = C[2],
                _[V + 3] = M[0],
                _[V + 4] = M[1],
                _[V + 5] = M[2],
                _[V + 6] = T[0],
                _[V + 7] = T[1],
                _[V + 8] = T[2],
                b[V] = E[0],
                b[V + 1] = E[1],
                b[V + 2] = E[2],
                b[V + 3] = P[0],
                b[V + 4] = P[1],
                b[V + 5] = P[2],
                b[V + 6] = N[0],
                b[V + 7] = N[1],
                b[V + 8] = N[2];
                var U = 2 * S;
                if (x[U] = F[0],
                x[U + 1] = F[1],
                x[U + 2] = D[0],
                x[U + 3] = D[1],
                x[U + 4] = R[0],
                x[U + 5] = R[1],
                S += 3,
                m)
                    V = 3 * S,
                    _[V] = C[0],
                    _[V + 1] = C[1],
                    _[V + 2] = C[2],
                    _[V + 3] = T[0],
                    _[V + 4] = T[1],
                    _[V + 5] = T[2],
                    _[V + 6] = A[0],
                    _[V + 7] = A[1],
                    _[V + 8] = A[2],
                    b[V] = E[0],
                    b[V + 1] = E[1],
                    b[V + 2] = E[2],
                    b[V + 3] = N[0],
                    b[V + 4] = N[1],
                    b[V + 5] = N[2],
                    b[V + 6] = k[0],
                    b[V + 7] = k[1],
                    b[V + 8] = k[2],
                    U = 2 * S,
                    x[U] = F[0],
                    x[U + 1] = F[1],
                    x[U + 2] = R[0],
                    x[U + 3] = R[1],
                    x[U + 4] = I[0],
                    x[U + 5] = I[1],
                    S += 3;
                else {
                    V = 3 * S,
                    _[V] = A[0],
                    _[V + 1] = A[1],
                    _[V + 2] = A[2],
                    b[V] = k[0],
                    b[V + 1] = k[1],
                    b[V + 2] = k[2],
                    U = 2 * S,
                    x[U] = I[0],
                    x[U + 1] = I[1];
                    var G = 3 * w
                      , z = S - 3;
                    y[G] = z,
                    y[G + 1] = z + 1,
                    y[G + 2] = z + 2,
                    y[G + 3] = z,
                    y[G + 4] = z + 2,
                    y[G + 5] = z + 3,
                    w += 2,
                    S += 1
                }
            }
        var H = new a;
        return H.getAttributes().Vertex = new r("ARRAY_BUFFER",_,3),
        H.getAttributes().Normal = new r("ARRAY_BUFFER",b,3),
        H.getAttributes().TexCoord0 = new r("ARRAY_BUFFER",x,2),
        m ? H.getPrimitives().push(new o(s.TRIANGLES,0,_.length / 3)) : H.getPrimitives().push(new l(s.TRIANGLES,new r("ELEMENT_ARRAY_BUFFER",y,1))),
        H
    }
      , v = function(t, e, i, n, l, u, h, c, d, p, f) {
        t = void 0 !== t ? t : -.5,
        e = void 0 !== e ? e : -.5,
        i = void 0 !== i ? i : 0,
        n = void 0 !== n ? n : 1,
        l = void 0 !== l ? l : 0,
        u = void 0 !== u ? u : 0,
        h = void 0 !== h ? h : 0,
        c = void 0 !== c ? c : 1,
        d = void 0 !== d ? d : 0,
        p = void 0 !== p ? p : 5,
        f = void 0 !== f ? f : p,
        p += 2,
        f += 2;
        var g = new a
          , m = new Float32Array(2 * (p + f) * 3)
          , v = 0
          , _ = 0
          , b = n / (p - 1)
          , x = l / (p - 1)
          , y = u / (p - 1)
          , S = t + n + h
          , w = e + l + c
          , C = i + u + d;
        for (v = 0; v < p; ++v)
            _ = 6 * v,
            m[_] = t + b * v,
            m[_ + 1] = e + x * v,
            m[_ + 2] = i + y * v,
            m[_ + 3] = S - b * (p - v - 1),
            m[_ + 4] = w - x * (p - v - 1),
            m[_ + 5] = C - y * (p - v - 1);
        for (b = h / (f - 1),
        x = c / (f - 1),
        y = d / (f - 1),
        v = 0; v < f; ++v)
            _ = 6 * (p + v),
            m[_] = t + b * v,
            m[_ + 1] = e + x * v,
            m[_ + 2] = i + y * v,
            m[_ + 3] = S - b * (f - v - 1),
            m[_ + 4] = w - x * (f - v - 1),
            m[_ + 5] = C - y * (f - v - 1);
        g.getAttributes().Vertex = new r(r.ARRAY_BUFFER,m,3);
        var M = new o(s.LINES,0,2 * (p + f));
        return g.getPrimitives().push(M),
        g
    }
      , _ = function(t) {
        var e = new a
          , i = new Float32Array([-.5, -.5, -.5, .5, -.5, -.5, .5, .5, -.5, -.5, .5, -.5, -.5, -.5, .5, .5, -.5, .5, .5, .5, .5, -.5, .5, .5]);
        e.getAttributes().Vertex = new r(r.ARRAY_BUFFER,i,3),
        t || (t = [1, 0, 0, 1]);
        for (var n = new c.Float32Array(32), o = 0; o < 8; o++)
            for (var u = 0; u < 4; u++)
                n[3 * o + u] = t[u];
        e.getAttributes().Color = new r(r.ARRAY_BUFFER,n,4);
        var h = new c.Uint16Array([0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7]);
        return e.getPrimitives().push(new l(s.LINES,new r("ELEMENT_ARRAY_BUFFER",h,1))),
        e
    };
    t.exports = {
        createTexturedBoxGeometry: d,
        createTexturedQuadGeometry: f,
        createTexturedSphereGeometry: m,
        createTexturedFullScreenFakeQuadGeometry: p,
        createAxisGeometry: g,
        createTexturedSphere: m,
        createGridGeometry: v,
        createBoundingBoxGeometry: _
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(600)
      , a = i(28)
      , s = i(5).vec3
      , o = i(143)
      , l = i(287)
      , u = i(619)
      , h = i(66)
      , c = i(353)
      , d = function() {
        o.call(this),
        this._shape = null,
        this._targets = [],
        this._stateSetAnimation = new l,
        this._targetWeights = new Float32Array(d.MAX_MORPH_GPU),
        this._morphAttribute = void 0,
        this._morphTargetNames = void 0,
        this._maxMorphGPU = d.MAX_MORPH_GPU,
        this._isInitialized = !1
    }
      , p = d.EFFECTIVE_EPS = .05;
    d.MAX_MORPH_GPU = 4,
    d.prototype = n.objectLibraryClass(n.objectInherit(o.prototype, {
        init: function() {
            return this._morphAttribute ? void (this._isInitialized = !0) : (this._morphAttribute = new u(Math.min(this._maxMorphGPU, this.getMorphTargets().length)),
            this.getStateSetAnimation().setAttributeAndModes(this._morphAttribute, h.ON),
            this._morphAttribute.setTargetWeights(this.getTargetsWeight()),
            this._targets[0] ? (this._morphTargetNames = window.Object.keys(this._targets[0].getVertexAttributeList()),
            this._morphAttribute.copyTargetNames(this._morphTargetNames)) : (this._morphTargetNames = [],
            a.error("No Targets in the MorphGeometry !")),
            this._isInitialized = !0,
            !0)
        },
        getMaximumPossibleMorphGPU: function() {
            return this._maxMorphGPU
        },
        setMaximumPossibleMorphGPU: function(t) {
            this._maxMorphGPU = t,
            this._isInitialized = !1,
            this._morphAttribute && this._morphAttribute.setNumTargets(t)
        },
        getMorphTargetNames: function() {
            return this._morphTargetNames
        },
        getStateSetAnimation: function() {
            return this._stateSetAnimation
        },
        getMorphTargets: function() {
            return this._targets
        },
        isInitialized: function() {
            return this._isInitialized
        },
        getTargetsWeight: function() {
            return this._targetWeights
        },
        computeBoundingBox: function() {
            var t = new c;
            return function(e) {
                o.prototype.computeBoundingBox.call(this, e);
                for (var i = 0, n = this._targets.length; i < n; i++)
                    e.expandByBoundingBox(this._targets[i].computeBoundingBox(t));
                return e
            }
        }(),
        mergeChildrenVertexAttributeList: function() {
            for (var t = 0, e = this._targets.length; t < e; t++) {
                var i = this._targets[t]
                  , n = i.getVertexAttributeList();
                for (var a in n) {
                    var s = n[a];
                    s && !s.getBufferArray && (n[a] = new r(s))
                }
                o.appendVertexAttributeToList(i.getVertexAttributeList(), this.getVertexAttributeList(), t)
            }
        },
        _computeEffectiveSumWeights: function() {
            for (var t = 0, e = this._targetWeights, i = 0, n = e.length; i < n; ++i) {
                var r = e[i];
                Math.abs(r) < p || (t += r)
            }
            return Math.abs(t) > 1e-5 ? t : t < 0 ? -1e-5 : 1e-5
        },
        computeTransformedVertex: function(t, e) {
            e = e || s.create();
            var i = 3 * t
              , n = this._targetWeights
              , r = this.getVertexAttributeList()
              , a = r.Vertex.getElements()
              , o = 1 - this._computeEffectiveSumWeights();
            e[0] = o * a[i],
            e[1] = o * a[i + 1],
            e[2] = o * a[i + 2];
            for (var l = 0, u = n.length; l < u; ++l) {
                var h = n[l];
                if (!(Math.abs(h) < p)) {
                    var c = r["Vertex_" + l].getElements();
                    e[0] += h * c[i],
                    e[1] += h * c[i + 1],
                    e[2] += h * c[i + 2]
                }
            }
            return e
        },
        computeTransformedVertices: function() {
            for (var t = this._targetWeights, e = this.getVertexAttributeList(), i = e.Vertex.getElements(), n = i.length, r = this._morphedVerts = this._morphedVerts || new Float32Array(n), a = 1 - this._computeEffectiveSumWeights(), s = 0; s < n; ++s)
                r[s] = a * i[s];
            for (var o = 0, l = t.length; o < l; ++o) {
                var u = t[o];
                if (!(Math.abs(u) < p))
                    for (var h = e["Vertex_" + o].getElements(), c = 0; c < n; ++c)
                        r[c] += u * h[c]
            }
            return r
        }
    }), "osgAnimation", "MorphGeometry"),
    n.setTypeID(d),
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(13)
      , a = i(81)
      , s = i(376)
      , o = i(143)
      , l = i(162)
      , u = i(134)
      , h = i(320)
      , c = i(321)
      , d = i(287)
      , p = i(128)
      , f = i(5).mat4
      , g = i(163)
      , m = i(522)
      , v = i(435)
      , _ = {};
    _.ObjectWrapper = {},
    _.ObjectWrapper.serializers = {},
    _.readImage = function(t, e) {
        return _.registry().readImageURL(t, e)
    }
    ,
    _.readImageURL = _.readImage,
    _.readBinaryArrayURL = function(t, e) {
        return _.registry().readBinaryArrayURL(t, e)
    }
    ,
    _.readNodeURL = function(t, e) {
        var i = t.substr(t.lastIndexOf(".") + 1)
          , n = v.instance().getReaderWriterForExtension(i);
        return void 0 !== n ? n.readNodeURL(t, e) : _.registry().readNodeURL(t, e)
    }
    ,
    _.registry = function() {
        var t = i(529);
        return void 0 === _.registry._input && (_.registry._input = new t),
        _.registry._input
    }
    ,
    _.parseSceneGraph = function(t, e) {
        if (!(void 0 !== t.Version && t.Version > 0)) {
            r.time("osgjs.metric:ReaderParser.parseSceneGraphDeprecated");
            var i = _.parseSceneGraphDeprecated(t);
            return r.timeEnd("osgjs.metric:ReaderParser.parseSceneGraphDeprecated"),
            i
        }
        r.time("osgjs.metric:ReaderParser.parseSceneGraph");
        var a;
        for (var s in t)
            if ("Generator" !== s && "Version" !== s) {
                a = s;
                break
            }
        if (a) {
            var o = {};
            o[a] = t[a];
            var l = _.registry().clone();
            l.setJSON(o);
            var u = r.objectMix(r.objectMix({}, _.registry().getOptions()), e || {});
            l.setOptions(u);
            var h = l.readObject();
            return r.timeEnd("osgjs.metric:ReaderParser.parseSceneGraph"),
            h
        }
        n.log("can't parse scenegraph " + t)
    }
    ,
    _.parseSceneGraphDeprecated = function(t) {
        var e, v = function(t, e) {
            var i = e[t];
            return void 0 === i && (i = e[t.toLowerCase()]),
            i
        }, b = function(t, e) {
            var i = v("Name", e);
            i && void 0 !== t.setName && t.setName(i)
        }, x = function(t, e) {
            b(t, e),
            t.setAmbient(v("Ambient", e)),
            t.setDiffuse(v("Diffuse", e)),
            t.setEmission(v("Emission", e)),
            t.setSpecular(v("Specular", e)),
            t.setShininess(v("Shininess", e))
        }, y = function(t, e) {
            b(t, e),
            t.setSourceRGB(e.SourceRGB),
            t.setSourceAlpha(e.SourceAlpha),
            t.setDestinationRGB(e.DestinationRGB),
            t.setDestinationAlpha(e.DestinationAlpha)
        }, S = function(t, e) {
            var i = e.MagFilter || e.mag_filter || void 0;
            i && t.setMagFilter(i);
            var r = e.MinFilter || e.min_filter || void 0;
            r && t.setMinFilter(r);
            var a = e.WrapT || e.wrap_t || void 0;
            a && t.setWrapT(a);
            var s = e.WrapS || e.wrap_s || void 0;
            s && t.setWrapS(s);
            var o = v("File", e);
            _.readImage(o).then(function(e) {
                t.setImage(e)
            }).catch(function() {
                n.log("Can't read image")
            })
        }, w = t.children, C = t._primitives || t.primitives || t.Primitives || void 0, M = t._attributes || t.attributes || t.Attributes || void 0;
        if (C || M) {
            var T = new o;
            b(T, t),
            T.stateset = t.stateset,
            t = T;
            for (var A = 0, E = C.length; A < E; A++) {
                var P = C[A].mode;
                if (C[A].indices) {
                    var N = C[A].indices;
                    N = new l(l[N.type],N.elements,N.itemSize),
                    P = P ? u[P] : "TRIANGLES",
                    T.getPrimitiveSetList().push(new c(P,N))
                } else {
                    P = u[P];
                    var k = C[A].first
                      , F = C[A].count;
                    T.getPrimitiveSetList().push(new h(P,k,F))
                }
            }
            for (var D in M) {
                var R = M[D];
                T.getVertexAttributeList()[D] = new l(R.type,R.elements,R.itemSize)
            }
        }
        var I = v("StateSet", t);
        if (I) {
            var O = new d;
            !function(t, e) {
                b(t, e);
                var r = v("Textures", e) || v("TextureAttributeList", e) || void 0;
                if (r)
                    for (var o = 0, l = r.length; o < l; o++) {
                        var u = v("File", r[o]);
                        if (u) {
                            var h = i(93)
                              , c = new h;
                            S(c, r[o]),
                            t.setTextureAttributeAndModes(o, c),
                            t.addUniform(a.createInt1(o, "Texture" + o))
                        } else
                            n.log("no texture on unit " + o + " skip it")
                    }
                var d = v("BlendFunc", e);
                if (d) {
                    var p = new s;
                    y(p, d),
                    t.setAttributeAndModes(p)
                }
                var f = v("Material", e);
                if (f) {
                    var g = i(519)
                      , m = new g;
                    x(m, f),
                    t.setAttributeAndModes(m)
                }
            }(O, I),
            t.stateset = O
        }
        var L = t.matrix || t.Matrix || void 0;
        L && (e = new g,
        b(e, t),
        r.extend(e, t),
        f.copy(e.getMatrix(), L),
        t = e);
        var B = t.projection || t.Projection || void 0;
        if (B && (e = new m,
        b(e, t),
        r.extend(e, t),
        f.copy(e.setProjectionMatrix(), B),
        t = e),
        void 0 === t.typeID && (e = new p,
        b(e, t),
        r.extend(e, t),
        t = e),
        w) {
            t.children = [];
            for (var V = 0, U = w.length; V < U; V++)
                t.addChild(_.parseSceneGraphDeprecated(w[V]))
        }
        return t
    }
    ,
    t.exports = _
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(998)
      , a = i(1001)
      , s = i(1003)
      , o = i(29)
      , l = i(151)
      , u = i(999)
      , h = i(384)
      , c = n.a.osg
      , d = n.a.osgShader
      , p = d.Compiler
      , f = d.nodeFactory;
    f.registerNodes(r.a),
    f.registerNodes(a.a),
    f.registerNodes(s.a),
    f.registerNodes(u.a);
    var g = function() {
        d.Compiler.apply(this, arguments);
        var t = this._material ? this._material.getMaterialModel() : void 0;
        this._channels = t ? t.getChannels() : void 0,
        this._isLighted = t && !1 === this._material.getShadeless(),
        this._isVertexColored = t && this._material.getVertexColorEnable(),
        this._isVertexAlpha = t && this._material.getVertexAlphaEnable(),
        this._shadowEnvOutputs = []
    };
    g.prototype = c.objectInherit(p.prototype, {
        sortDeclarations: function(t) {
            if (p.prototype.sortDeclarations.call(this, t),
            !this._fragmentShaderMode && i.i(o.a)().varyingSorting)
                for (var e = -1, n = 0, r = t.length; n < r; ++n) {
                    var a = t[n];
                    if (-1 === e && "v" === a[0] && (e = n),
                    -1 !== a.indexOf("vViewNormal")) {
                        t[n] = t[e],
                        t[e] = a;
                        break
                    }
                }
        },
        isAlphaBlendedMaterial: function() {
            if (!this._channels)
                return !1;
            var t = this._channels.Opacity
              , e = t.get("type");
            return t.isEffective() && ("alphaBlend" === e || "additive" === e)
        },
        getTextureByName: function() {},
        declareTextures: function() {},
        getCompilerName: function() {
            return "Classic"
        },
        registerTextureAttributes: function(t, e) {
            var i = t.className();
            return "TextureMaterial" === i ? this.registerTextureMaterial(t, e) : "TextureEnvironment" === i ? this.registerTextureEnvironment(t, e) : "ShadowTexture" === i ? this.registerTextureShadow(t, e) : void 0
        },
        registerTextureMaterial: function(t, e) {
            return p.prototype.registerTexture.call(this, t, e)
        },
        registerTextureEnvironment: function(t, e) {
            this._textures[e] = t,
            this._texturesByName["TextureEnvironment" + t.getChannel()] = {
                texture: t,
                variable: void 0,
                textureUnit: e
            }
        },
        getOrCreateStateAttributeUniforms: function(t, e) {
            var i = p.prototype.getOrCreateStateAttributeUniforms.call(this, t, e);
            return "SketchfabLight" === t.getType() && (i.lightspecular && (i.lightspecular = i.lightdiffuse),
            i.lightambient && (i.lightambient = this.getOrCreateConstantZero("vec4")),
            "SPOT" !== t.getLightType() && (i.lightinvMatrix = i.lightmatrix)),
            i
        },
        applyEmissive: function(t) {
            var e = this.getOrCreateChannel("EmitColor");
            if (!e)
                return t;
            var i = this.createVariable("vec3");
            return this.getNode("InlineCode").code("%output = %mult == 1 ? %color * %emit : %color + %emit;").inputs({
                color: t,
                emit: e,
                mult: this.getOrCreateUniform("int", "uEmitMultiplicative")
            }).outputs({
                output: i
            }),
            i
        },
        createFragmentShaderGraph: function() {
            var t;
            if (this._isLighted) {
                var e = this.createLighting()
                  , i = this.getEnvironment();
                e && i ? (t = this.createVariable("vec3"),
                this.getNode("Add").inputs(e, i).outputs(t)) : t = e || i || this.getOrCreateConstantZero("vec3")
            } else
                t = this.getShadelessColor();
            return t = this.applyEmissive(t),
            [this.getFinalFrag(t)]
        },
        createLighting: function() {
            if (this._lights.length) {
                var t = {};
                return t.materialambient = this.getOrCreateMaterialAmbient(),
                t.materialdiffuse = this.getOrCreateMaterialDiffuseColor(),
                t.materialspecular = this.getOrCreateMaterialSpecularColor(),
                t.materialshininess = this.getOrCreateMaterialSpecularHardness(),
                t.normal = this.getOrCreateMaterialNormal(),
                p.prototype.createLighting.call(this, t, {
                    DIRECTION: "SunLight",
                    SPOT: "SpotLight",
                    POINT: "PointLight",
                    HEMI: "HemiLight",
                    ENV: "EnvLight"
                })
            }
        },
        connectShadowLightNode: function(t, e, i) {
            if (t.getLightType() !== h.a.ENV)
                return p.prototype.connectShadowLightNode.call(this, t, e, i);
            var n = this.createVariable("vec3", "lightAndShadowTempOutput")
              , r = "";
            return r += "%shadowedOutput = 1.0 - %shadowedOutput; \n",
            r += "%out =  - %shadowedOutput * %coloredLight ;\n",
            this.getNode("InlineCode").code(r).inputs({
                shadowedOutput: i,
                coloredLight: e
            }).outputs({
                out: n
            }),
            this._shadowEnvOutputs.push(n),
            this.getOrCreateConstantZero("vec3")
        },
        getFinalFrag: function(t) {
            var e = this.getNode("glFragColor");
            return this.applyPointSizeCircle(e),
            this.isAlphaBlendedMaterial() ? this.getFinalRGBA(t, e) : (this.applyAlphaMask(e),
            this.getRGBM(this.getSrgbColor(t), e))
        },
        getRGBM: function(t, e) {
            return this.getNode("EncodeRGBM").inputs({
                color: t,
                range: this.getOrCreateUniform("float", "uRGBMRange")
            }).outputs({
                color: e
            }),
            e
        },
        getFinalRGBA: function(t, e) {
            var i = this.getOrCreateChannel("Opacity")
              , n = this.getAlphaFinalAlpha(i);
            this.applyDiscardTransparentOpaque(i, n, e);
            var r = this.getSrgbColor(this.getPremultAlpha(t, i));
            return this.getNode("InlineCode").code("%color = %drawOpaque == 1 ? %rgbm : vec4(%rgb, %alpha);").inputs({
                rgb: r,
                rgbm: this.getRGBM(r, this.createVariable("vec4")),
                alpha: n,
                drawOpaque: this.getOrCreateUniform("int", "uDrawOpaque")
            }).outputs({
                color: e
            }),
            e
        },
        applyDiscardTransparentOpaque: function(t, e, n) {
            var r = (1 - i.i(o.a)().epsilonAlpha).toExponential()
              , a = "if(%alphaOriginal == 0.0 || (%drawOpaque == 1 && %alphaFinal < " + r + ") || (%drawOpaque == 0 && %alphaFinal >= " + r + ")) discard;";
            this.getNode("InlineCode").code(a).inputs({
                alphaOriginal: t,
                alphaFinal: e,
                drawOpaque: this.getOrCreateUniform("int", "uDrawOpaque")
            }).outputs({
                out: n
            })
        },
        getAlphaFinalAlpha: function(t) {
            var e = this.createVariable("float");
            return this.getNode("InlineCode").code("%finalAlpha = %alpha * float(1 - %additive);").inputs({
                alpha: t,
                additive: this.getOrCreateUniform("int", "uOpacityAdditive")
            }).outputs({
                finalAlpha: e
            }),
            e
        },
        getShadelessColor: function() {
            return this.getOrCreateMaterialDiffuseColor()
        },
        getVertexAlpha: function(t) {
            if (!this._isVertexAlpha)
                return t;
            var e = this.createVariable("float");
            return this.getNode("InlineCode").code("%out = %alpha * (%hasVertexColor == 1.0 ? %vertexColor.a : 1.0);").inputs({
                hasVertexColor: this.getOrCreateUniform("float", "uArrayColorEnabled"),
                vertexColor: this.getOrCreateVarying("vec4", "vVertexColor"),
                alpha: t
            }).outputs({
                out: e
            }),
            e
        },
        getVertexColor: function(t) {
            if (void 0 !== t) {
                if (!this._isVertexColored)
                    return t;
                var e = this.getOrCreateVarying("vec4", "vVertexColor")
                  , i = this.getOrCreateUniform("float", "uArrayColorEnabled");
                if ("srgb" === this._material.getVertexColorColorSpace()) {
                    var n = this.createVariable("vec3");
                    this.getNode("sRGBToLinear").inputs({
                        color: e
                    }).outputs({
                        color: n
                    }),
                    e = n
                }
                var r = this.createVariable("vec3")
                  , a = ["", "%color.rgb = %diffuse.rgb;", "if ( %hasVertexColor == 1.0)", "  %color *= %vertexColor.rgb;"].join("\n");
                return this.getNode("InlineCode").code(a).inputs({
                    diffuse: t,
                    hasVertexColor: i,
                    vertexColor: e
                }).outputs({
                    color: r
                }).comment("diffuse color = diffuse color * vertex color"),
                r
            }
        },
        getOrCreateMaterialDiffuseColor: function() {
            var t = this.getVariable("materialDiffuseColor");
            if (t)
                return t;
            t = this.createVariable("vec3", "materialDiffuseColor");
            var e = this.getOrCreateChannel("DiffuseColor");
            if (!e)
                return t.setValue("vec3(0.0)");
            var i = this.getOrCreateChannel("DiffuseIntensity") || this.getOrCreateConstantOne("float");
            return this.getNode("Mult").inputs(this.getVertexColor(e), i).outputs(t),
            t
        },
        getOrCreateMaterialNormal: function() {
            return this.getOrCreateGeometryNormal()
        },
        getOrCreateMaterialAmbient: function() {
            return this.getOrCreateConstantOne("vec3")
        },
        getOrCreateMaterialSpecularColor: function() {
            return this.getOrCreateChannel("SpecularColor") || this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialSpecularHardness: function() {
            return this.getOrCreateChannel("SpecularHardness") || this.getOrCreateConstantZero("float")
        },
        applyAlphaMask: function(t) {
            if (this.isAlphaBlendedMaterial())
                return t;
            var e = this.getOrCreateChannel("Opacity");
            if (void 0 === e)
                return t;
            var i = ["if (%dithering == 1) {", "    float jitterForce = abs(%halton.z) == 2.0 ? 1000.0 : 1.0;", "    vec3 dith = vec3(gl_FragCoord.xy, gl_FragCoord.x + gl_FragCoord.z * jitterForce) + %halton.xyx * 1000.0;", "    dith = fract(dith * 0.1031);", "    dith += dot(dith, dith.yzx + 19.19);", "    if (%alpha * %factor < fract((dith.x + dith.y) * dith.z)) {", "        discard;", "    }", "} else if (%alpha < %factor) {", "    discard;", "}"].join("\n");
            return this.getNode("InlineCode").code(i).inputs({
                alpha: e,
                factor: this.getOrCreateUniform("float", "uOpacityFactor"),
                dithering: this.getOrCreateUniform("int", "uOpacityDithering"),
                halton: this.getOrCreateUniform("vec4", "uHalton")
            }).outputs({
                out: t
            }),
            t
        },
        getOrCreateNormalMap: function() {
            var t = this.getVariable("normalMap");
            return t || (t = this.createVariable("vec3", "normalMap"),
            this.getNode("RGBToNormal").inputs({
                normal: this.getOrCreateChannel("NormalMap"),
                flipY: this.getOrCreateUniform("int", "uNormalMapFlipY")
            }).outputs({
                normal: t
            }),
            t)
        },
        getOrCreateGeometryNormal: function() {
            var t = this.getVariable("geoNormal");
            if (t)
                return t;
            t = this.createVariable("vec3", "geoNormal");
            var e = this.getNormalMapNormal();
            return e || (e = this.getBumpMapNormal()) || (e = this.getOrCreateNormalizedFrontViewNormal()),
            this.getNode("SetFromNode").inputs(e).outputs(t),
            t
        },
        getSrgbColor: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("LinearTosRGBWithTest").inputs({
                color: t,
                keepLinear: this.getOrCreateUniform("int", "uOutputLinear")
            }).outputs({
                color: e
            }),
            e
        },
        getTextureEnvironmentSpecular: function() {
            return this._texturesByName.TextureEnvironmentSpecular
        },
        getEnvironment: function() {
            var t = this.getTextureEnvironmentSpecular();
            if (void 0 !== t) {
                var e = t.texture
                  , i = e.getCommonUniforms()
                  , n = this.createVariable("mat3");
                this.getNode("EnvironmentTransformPBR").inputs({
                    inTransform: this.getOrCreateUniform(i.environmentTransform)
                }).outputs({
                    outTransform: n
                });
                var r = this.createVariable("vec3")
                  , a = this.getEnvironmentDiffuse(n, i)
                  , s = this.getEnvironmentSpecular(n, e, i)
                  , o = this.createVariable("vec3");
                return this.getNode("Add").inputs(a, s).outputs(o),
                this.getNode("Mult").inputs(o, this.getOrCreateUniform(i.exposure)).outputs(r),
                r
            }
        },
        getEnvironmentShadow: function(t) {
            var e = [t]
              , i = "";
            i += "%tempOutput = %maxLightEnv * %factor; \n",
            i += "%out.r = %tempOutput.r + %shadowedOutput.r < 0.0 ? - %tempOutput.r : %shadowedOutput.r; \n",
            i += "%out.g = %tempOutput.g + %shadowedOutput.g < 0.0 ? - %tempOutput.g : %shadowedOutput.g; \n",
            i += "%out.b = %tempOutput.b + %shadowedOutput.b < 0.0 ? - %tempOutput.b : %shadowedOutput.b; \n";
            for (var n = this.createVariable("vec3"), r = 0, a = this._shadowEnvOutputs.length; r < a; r++) {
                var s = this.createVariable("vec3")
                  , o = this.getOrCreateUniform("float", "uFactorShadowEnv" + r);
                this.getNode("InlineCode").code(i).inputs({
                    tempOutput: n,
                    maxLightEnv: t,
                    shadowedOutput: this._shadowEnvOutputs[r],
                    factor: o
                }).outputs({
                    out: s
                }),
                e.push(s)
            }
            var l = this.createVariable("vec3");
            return this.getNode("Add").inputs(e).outputs(l),
            l
        },
        getEnvironmentDiffuse: function(t, e) {
            var i = this.getOrCreateUniform(e.diffuseSPH);
            i.globalDeclaration = function() {
                return "uniform vec3 " + i.getVariable() + "[9];"
            }
            ;
            var n = this.createVariable("vec3");
            return this.getNode("DiffuseUE4v1").inputs({
                normal: this.getOrCreateMaterialNormal(),
                albedo: this.getOrCreateMaterialDiffuseColor(),
                ao: this.getOrCreateConstantOne("float"),
                envTransform: t,
                sphCoef: i
            }).outputs({
                color: n
            }),
            this.getEnvironmentShadow(n)
        },
        getEnvironmentSpecular: function(t, e, i) {
            var n = this.createVariable("vec3");
            this.getNode("TextureEnvironmentCube").inputs({
                sampler: this.getOrCreateSampler("samplerCube", i.textureSpecular.getName()),
                envTransform: t,
                normal: this.getOrCreateMaterialNormal(),
                eye: this.getOrCreateNormalizedViewEyeDirection(),
                texSize: this.getOrCreateUniform(e.getOrCreateUniforms().size)
            }).outputs({
                color: n
            });
            var r = this.createVariable("vec3")
              , a = this.getOrCreateUniform("float", "uReflection");
            return this.getNode("Mult").inputs(n, this.getOrCreateMaterialSpecularColor(), a).outputs(r),
            r
        },
        getNormalMapNormal: function() {
            if (this.getOrCreateChannel("NormalMap")) {
                var t = this.getOrCreateNormalizedFrontViewNormal()
                  , e = this.getOrCreateNormalMap()
                  , i = this.getOrCreateUniform("float", "uNormalMapFactor")
                  , n = this.createVariable("vec3");
                this.getNode("InlineCode").code("%out.xy = %factor * %input.xy;\n%out.z = %input.z;").inputs({
                    input: e,
                    factor: i
                }).outputs({
                    out: n
                });
                var r = this.createVariable("vec3");
                return this.getNode("NormalTangentSpace").inputs({
                    tangent: this.getOrCreateFrontViewTangent(),
                    normal: t,
                    texNormal: n
                }).outputs({
                    normal: r
                }),
                r
            }
        },
        getBumpMapNormal: function() {
            var t = this.getOrCreateChannel("BumpMap");
            if (t) {
                var e = this.getOrCreateNormalizedFrontViewNormal()
                  , i = this.getOrCreateUniform("float", "uBumpMapFactor")
                  , n = this.createVariable("vec2");
                this.getNode("Mult").inputs(t, i).outputs(n);
                var r = this.createVariable("vec3");
                return this.getNode("Bumpmap").inputs({
                    tangent: this.getOrCreateFrontViewTangent(),
                    normal: e,
                    gradient: n
                }).outputs({
                    normal: r
                }),
                r
            }
        },
        getColorAtlasUV: function(t) {
            var e = l.a.getColorPacking(t)
              , i = "";
            return i = 0 === e ? "vec2(0.125, 0.5)" : 1 === e ? "vec2(0.375, 0.5)" : 2 === e ? "vec2(0.625, 0.5)" : "vec2(0.875, 0.5)",
            this.getOrCreateConstant("vec2", "uvColorAtlas" + e).setValue(i)
        },
        getOrCreateChannel: function(t) {
            if (this._channels) {
                var e = "channel" + t
                  , i = this.getVariable(e);
                if (i)
                    return i;
                var n = this._channels[t];
                if (n.isEnableEffective()) {
                    var r = l.a.getDefaultFormat(t) === c.Texture.RGB ? "vec3" : "float";
                    if ("BumpMap" === t && (r = "vec2"),
                    i = this.createVariable(r, e),
                    !n.isEffective()) {
                        var a = this.getOrCreateConstantOne(r)
                          , s = this.getOrCreateUniform("float", "u" + t + "Factor");
                        return this.getNode("Mult").inputs(a, s).outputs(i),
                        i
                    }
                    var o;
                    if (n.getColor() && l.a.getColorPacking(t) < 0)
                        o = this.getOrCreateConstantOne(r);
                    else {
                        var u = this._material.getChannelMapping(t);
                        if (void 0 === u || u < 0)
                            return;
                        var h = this._textures[u]
                          , d = h.getName()
                          , p = this.getVariable(d);
                        void 0 === p && (p = this.getOrCreateSampler("sampler2D", d));
                        var f;
                        if (n.getColor())
                            f = this.getColorAtlasUV(t);
                        else {
                            var g = n.getTexCoordUnit();
                            f = this._fragmentShaderMode ? this.getOrCreateVarying("vec2", "vTexCoord" + g) : this.getOrCreateAttribute("vec2", "TexCoord" + g)
                        }
                        o = this.readChannel(t, p, f, h.getChannelPacking(t))
                    }
                    "Opacity" === t && (o = this.getVertexAlpha(o));
                    if ("Opacity" === t && !this.isAlphaBlendedMaterial() || "NormalMap" === t || "BumpMap" === t || "Displacement" === t)
                        return this.getNode("SetFromNode").inputs(o).outputs(i),
                        i;
                    var m = this.getOrCreateUniform("float", "u" + t + "Factor");
                    return "SpecularColor" === t && (m = this.applyAdjustSpecular(m)),
                    "CavityPBR" === t || "AOPBR" === t ? this.applyInvertLerpFactor(o, m, i) : (this.getNode("Mult").inputs(o, m).outputs(i),
                    i)
                }
            }
        },
        applyAdjustSpecular: function(t) {
            if (!this.getOrCreateChannel("NormalMap"))
                return t;
            var e = this.getOrCreateNormalMap()
              , i = this.createVariable("float");
            return this.getNode("AdjustSpecular").inputs({
                specular: t,
                normal: e
            }).outputs({
                specular: i
            }),
            i
        },
        applyInvertLerpFactor: function(t, e, i) {
            return this.getNode("Blend").mode("MIX").inputs(this.getOrCreateConstantOne(t.getType()), t, e).outputs(i),
            i
        },
        readChannel: function(t, e, i, n) {
            var r;
            switch (t) {
            case "DiffuseColor":
            case "EmitColor":
            case "DiffuseIntensity":
            case "SpecularColor":
            case "NormalMap":
                r = this.readTexture("vec3", t, e, i, n);
                break;
            case "Opacity":
                r = this.readTextureOpacity("float", t, e, i, n);
                break;
            case "SpecularHardness":
            case "Displacement":
                r = this.readTexture("float", t, e, i, n);
                break;
            case "BumpMap":
                r = this.createTextureChannelsGradient(t, e, i, n)
            }
            return r
        },
        getLinearTexel: function(t, e) {
            if (!this._channels[t].getSRGB())
                return e;
            var i = this.createVariable(e.getType());
            return this.getNode("sRGBToLinear").inputs({
                color: e
            }).outputs({
                color: i
            }),
            i
        },
        readTexture: function(t, e, i, n, r) {
            var a = this.createVariable(t)
              , s = "%color = texture2D(%sampler, %uv)." + r + ";";
            return this.getNode("InlineCode").code(s).inputs({
                sampler: i,
                uv: n
            }).outputs({
                color: a
            }),
            this.getLinearTexel(e, a)
        },
        readTextureOpacity: function(t, e, i, n, r) {
            var a = this.readTexture(t, e, i, n, r)
              , s = this.createVariable("float");
            return this.getNode("InlineCode").code("%aout = %invert == 1 ? 1.0 - %alpha : %alpha;").inputs({
                alpha: a,
                invert: this.getOrCreateUniform("int", "uOpacityInvert")
            }).outputs({
                aout: s
            }),
            s
        },
        createTextureChannelsGradient: function(t, e, i, n) {
            var r = this.createVariable("vec2", "gradient" + t)
              , a = this._channels[t].getSRGB();
            return this.getNode("TextureGradient").setPackingRead(n).setSRGB(a).inputs({
                sampler: e,
                texSize: this.getOrCreateUniform("vec2", "u" + t + "Size"),
                uv: i
            }).outputs({
                color: r
            }),
            r
        },
        getOrCreateProjectionMatrix: function() {
            var t = this.getVariable("jitteredProjection");
            if (t)
                return t;
            t = this.createVariable("mat4", "jitteredProjection");
            var e = ["", " %projMat = %jitteredProjection;", " float doPerp = %projMat[3][3] == 0.0 ? 1.0 : 0.0;", " float doOrtho = doPerp == 1.0 ? 0.0 : 1.0;", " vec2 halt = (abs(%halton.z) == 2.0 ? 1.0 : 0.0) * (%halton.xy / %renderSize.xy);", " // persp", " %projMat[2][0] += doPerp * halt.x;", " %projMat[2][1] += doPerp * halt.y;", " // ortho", " %projMat[3][0] += doOrtho * halt.x;", " %projMat[3][1] += doOrtho * halt.y;", ""];
            return this.getNode("InlineCode").code(e.join("\n")).inputs({
                jitteredProjection: this.getOrCreateUniform("mat4", "uProjectionMatrix"),
                halton: this.getOrCreateUniform("vec4", "uHalton"),
                renderSize: this.getOrCreateUniform("vec2", "RenderSize")
            }).outputs({
                projMat: t
            }),
            t
        },
        assignMatcapTexture: function() {
            this._textures[6] = this._textureAttributes[6][0]
        },
        getMatcapColor: function(t) {
            var e = this._variables.sMatcap;
            e = e || this.getOrCreateSampler("sampler2D", "sMatcap");
            var i = this.createVariable("vec2");
            this.getNode("NormalMatcap").inputs({
                normal: t,
                eye: this.getOrCreateNormalizedViewEyeDirection()
            }).outputs({
                uv: i
            });
            var n = this.createVariable("vec3");
            this.getNode("TextureRGB").inputs({
                sampler: e,
                uv: i
            }).outputs({
                color: n
            });
            var r = this.createVariable("vec3");
            return this.getNode("sRGBToLinear").inputs({
                color: n
            }).outputs({
                color: r
            }),
            r
        },
        getOrCreateDisplacement: function() {
            var t = this.getVariable("displacement");
            if (t)
                return t;
            var e = this.getOrCreateChannel("Displacement");
            if (e) {
                t = this.createVariable("float", "displacement");
                return this.getNode("InlineCode").code("%out = (%displacement - 0.5) * %factor;").inputs({
                    displacement: e,
                    factor: this.getOrCreateUniform("float", "uDisplacementFactor")
                }).outputs({
                    out: t
                }),
                t
            }
        },
        displaceVertex: function(t, e) {
            var n, r = {
                vertex: t,
                displacement: this.getOrCreateDisplacement()
            };
            return i.i(o.a)().substanceDisplacement ? n = "%output = %vertex + vec3(0.0, 0.0, 1.0) * (%vertex.z > 0.01 ? %displacement : 0.0);" : (n = "%output = %vertex + %direction * %displacement;",
            r.direction = this.getOrCreateVertexNormalizedModelNormal()),
            this.getNode("InlineCode").code(n).inputs(r).outputs({
                output: e
            }),
            e
        },
        getOrCreateVertexNormalizedModelNormal: function() {
            var t = this._variables.vnModelNormal;
            if (t)
                return t;
            var e = this.createVariable("vec3", "vnModelNormal");
            return this.getNode("Normalize").inputs({
                vec: p.prototype.getOrCreateModelNormal.call(this)
            }).outputs({
                vec: e
            }),
            e
        },
        displaceNormalCorrection: function(t, e) {
            var i = this._channels.Displacement.getTexCoordUnit()
              , n = this._material.getChannelMapping("Displacement")
              , r = this._textures[n]
              , a = r.getName()
              , s = this.getVariable(a)
              , o = this.createTextureChannelsGradient("Displacement", s, this.getVariable("TexCoord" + i), r.getChannelPacking("Displacement"))
              , l = this.createVariable("vec2");
            return this.getNode("Mult").inputs(o, this.getOrCreateUniform("float", "uDisplacementNormal")).outputs(l),
            this.getNode("Bumpmap").inputs({
                tangent: this.getOrCreateModelTangent(),
                normal: t,
                gradient: l
            }).outputs({
                normal: e
            }),
            e
        },
        getOrCreateModelVertex: function() {
            if (!this.getOrCreateDisplacement())
                return p.prototype.getOrCreateModelVertex.call(this);
            var t = this._variables.displacedVertex;
            if (t)
                return t;
            t = this.createVariable("vec3", "displacedVertex");
            var e = this.createVariable("vec3", "modelVertex");
            return this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uModelMatrix"),
                vec: this.getOrCreateLocalVertex()
            }).outputs({
                vec: e
            }),
            this.displaceVertex(e, t)
        },
        getOrCreateModelNormal: function() {
            if (!this.getOrCreateDisplacement() || this._channels.NormalMap.isEnableEffective())
                return p.prototype.getOrCreateModelNormal.call(this);
            var t = this._variables.displaceNormalCorrection;
            return t || (t = this.createVariable("vec3", "displacedNormal"),
            this.displaceNormalCorrection(this.getOrCreateVertexNormalizedModelNormal(), t))
        },
        getOrCreateViewVertex: function() {
            if (!this.getOrCreateDisplacement())
                return p.prototype.getOrCreateViewVertex.call(this);
            var t = this._variables.viewVertex;
            return t || (t = this.createVariable("vec4", "viewVertex"),
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uViewMatrix"),
                vec: this.getOrCreateModelVertex()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateViewNormal: function() {
            if (!this.getOrCreateDisplacement())
                return p.prototype.getOrCreateViewNormal.call(this);
            var t = this._variables.viewNormal;
            return t || (t = this.createVariable("vec3", "viewNormal"),
            this.getNode("MatrixMultDirection").inputs({
                matrix: this.getOrCreateUniform("mat4", "uViewMatrix"),
                vec: this.getOrCreateModelNormal()
            }).outputs({
                vec: t
            }),
            t)
        }
    }),
    e.a = g
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = function() {
        r.Light.apply(this, arguments)
    };
    a.ENV = "ENV",
    a.prototype = r.objectLibraryClass(r.objectInherit(r.Light.prototype, {
        attributeType: "SketchfabLight",
        setLightType: function(t) {
            return t === a.ENV ? this.setLightAsEnv() : r.Light.prototype.setLightType.call(this, t)
        },
        getLightType: function() {
            return this.isEnvLight() ? a.ENV : r.Light.prototype.getLightType.call(this)
        },
        setLightAsEnv: function() {
            r.vec4.set(this._position, 0, 0, 1, 0),
            this._spotCutoff = 180,
            this._ground[3] = 0
        },
        isEnvLight: function() {
            return 0 === this._ground[3]
        },
        isDirectionLight: function() {
            return 0 === this._position[3] && (-1 === this._ground[3] || 0 === this._ground[3])
        }
    }), "osgSketchfab", "Light");
    var s = r.vec3.create();
    r.LightSource.prototype.computeBoundingSphere = function(t) {
        if (r.Node.prototype.computeBoundingSphere.call(this, t),
        !t.valid())
            return t;
        if (void 0 !== this._light && this._referenceFrame === r.Transform.RELATIVE_RF) {
            var e = this._light.getPosition();
            0 !== e[3] && t.expandByVec3(r.vec3.scale(s, e, 1 / e[3]))
        }
        return t
    }
    ,
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(43)
      , a = i(328)
      , s = n.a.osg
      , o = n.a.osgDB
      , l = n.a.osgAnimation
      , u = {};
    u.uidGeometryMap = {},
    u.hasPoints = !1,
    u.hasTriangles = !1,
    u.hasLines = !1,
    u.hasVertexNormals = !1;
    var h = [s.PrimitiveSet.TRIANGLES, s.PrimitiveSet.TRIANGLE_STRIP, s.PrimitiveSet.TRIANGLE_FAN]
      , c = [s.PrimitiveSet.LINES, s.PrimitiveSet.LINE_LOOP, s.PrimitiveSet.LINE_STRIP]
      , d = {
        wireframe: !0,
        epsilon: !0,
        nphi: !0,
        attributes: !0,
        vertex_mode: !0,
        triangle_mode: !0,
        rigIndex: !0,
        framerate: !0,
        bx: !0,
        by: !0,
        bz: !0,
        hx: !0,
        hy: !0,
        hz: !0,
        ox: !0,
        oy: !0,
        oz: !0,
        ow: !0,
        ot: !0,
        channel_mode: !0
    };
    u.convertUserDataToObject = function(t, e) {
        var i = e || {};
        if (!t)
            return i;
        for (var n = 0, r = t.length; n < r; ++n) {
            var a = t[n]
              , s = a.Name;
            d[s] || -1 !== s.indexOf("_bbl_") || -1 !== s.indexOf("_h_") || -1 !== s.indexOf("_mode") ? i[s] = JSON.parse(a.Value) : i[s] = a.Value
        }
        return i
    }
    ;
    var p = function() {
        s.NodeVisitor.call(this)
    };
    p.prototype = s.objectInherit(s.NodeVisitor.prototype, {
        apply: function(t) {
            var e = t instanceof s.Geometry;
            if (e && void 0 !== t._uniqueID && (u.uidGeometryMap[t._uniqueID] = t),
            e || t instanceof l.Bone) {
                var i = t.userDataMap = u.convertUserDataToObject(t.getUserData())
                  , n = t;
                if (t.getSourceGeometry && (n = t.getSourceGeometry(),
                u.convertUserDataToObject(n.getUserData(), i)),
                n instanceof l.MorphGeometry)
                    for (var r = n.getMorphTargets(), a = 0, o = r.length; a < o; ++a) {
                        var h = i["morph_" + a] = {};
                        u.convertUserDataToObject(r[a].getUserData(), h)
                    }
            }
            return this.traverse(t)
        }
    });
    var f = function(t, e) {
        var i = e.getItemSize()
          , n = e.getElements()
          , r = 1;
        1 === n.BYTES_PER_ELEMENT ? r = 255 : 2 === n.BYTES_PER_ELEMENT && (r = 65535);
        var s = !1
          , o = n.length
          , l = 0;
        if (4 === i) {
            var u = !0
              , h = !0;
            for (l = 3; l < o; l += 4) {
                var c = n[l];
                if (0 !== c && (u = !1),
                c !== r && (h = !1),
                !u && !h)
                    break
            }
            if (u && 4 === i)
                for (l = 3; l < o; l += 4)
                    n[l] = r;
            s = !u && !h
        }
        var d = !0;
        if (!s) {
            var p = !0;
            for (l = 0; l < o && (n[l] !== r && (p = !1),
            n[l + 1] !== r && (p = !1),
            n[l + 2] !== r && (p = !1),
            p); l += i)
                ;
            p && delete t.getVertexAttributeList().Color,
            d = !p
        }
        s && (a.a.hasVertexAlpha = t.userDataMap.hasVertexAlpha = !0),
        d && (a.a.hasVertexColor = !0)
    }
      , g = function(t) {
        for (var e = t.getPrimitiveSetList(), i = e.length, n = !1, r = !1, a = !1, o = void 0 !== t.getVertexAttributeList().Normal, l = 0; l < i; ++l) {
            var d = e[l].getMode();
            0 !== e[l].getCount() && (n || (n = d === s.PrimitiveSet.POINTS),
            a || (a = -1 !== h.indexOf(d)),
            r || (r = -1 !== c.indexOf(d)))
        }
        u.hasPoints || (u.hasPoints = n),
        u.hasTriangles || (u.hasTriangles = a),
        u.hasLines || (u.hasLines = r),
        u.hasVertexNormals || (u.hasVertexNormals = o),
        t.userDataMap.hasPoints = n,
        t.userDataMap.hasTriangles = a,
        t.userDataMap.hasLines = r
    }
      , m = function() {
        var t = u.uidGeometryMap;
        for (var e in t) {
            var i = t[e];
            if (!i.userDataMap.wireframe) {
                var n = i.getVertexAttributeList().Color;
                n && f(i, n),
                g(i)
            }
        }
    };
    u.parse = function(t, e, i) {
        return r.a.OSG_VERSION = t.Version,
        o.parseSceneGraph(t, e).then(function(t) {
            var e = new p;
            return t.accept(e),
            i.then(m),
            t
        })
    }
    ,
    e.a = u
}
, function(t, e, i) {
    "use strict";
    e.a = {
        getBaseVR: function(t) {
            i.e(8).then(function() {
                t(i(1444).default)
            }
            .bind(null, i)).catch(i.oe)
        },
        getVrBrowserAssets: function(t) {
            i.e(7).then(function() {
                t(i(1449).default)
            }
            .bind(null, i)).catch(i.oe)
        },
        getControllerVive: function(t) {
            i.e(12).then(function() {
                t(i(1447).default)
            }
            .bind(null, i)).catch(i.oe)
        },
        getControllerDaydream: function(t) {
            i.e(14).then(function() {
                t(i(1445).default)
            }
            .bind(null, i)).catch(i.oe)
        },
        getControllerOculusTouch: function(t) {
            i.e(13).then(function() {
                t(i(1446).default)
            }
            .bind(null, i)).catch(i.oe)
        },
        getHuman: function(t) {
            i.e(11).then(function() {
                t(i(1448).default)
            }
            .bind(null, i)).catch(i.oe)
        }
    }
}
, function(t, e, i) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/logo.jinja"] = function() {
            function t(t, e, n, r, a) {
                var s = null
                  , o = null
                  , l = "";
                try {
                    var u = null
                      , h = r.makeMacro([], ["headerStyle"], function(a) {
                        var s = n;
                        n = new r.Frame,
                        a = a || {},
                        a.hasOwnProperty("caller") && n.set("caller", a.caller),
                        n.set("headerStyle", a.hasOwnProperty("headerStyle") ? a.headerStyle : "normal");
                        var o = "";
                        return o += '\n<div class="logo">\n    <a class="link" href="/">\n        ',
                        "inverted" == r.contextOrFrameLookup(e, n, "headerStyle") ? (o += '\n        <img src="',
                        o += r.suppressValue(i(565), t.opts.autoescape),
                        o += '" width="121" height="30" class="visual" alt="Sketchfab">\n        ') : (o += '\n        <img src="',
                        o += r.suppressValue(i(564), t.opts.autoescape),
                        o += '" width="121" height="30" class="visual" alt="Sketchfab">\n        '),
                        o += "\n    </a>\n</div>\n",
                        n = s,
                        new r.SafeString(o)
                    });
                    e.addExport("header_logo"),
                    e.setVariable("header_logo", h),
                    l += "\n\n\n";
                    var c = r.makeMacro([], [], function(i) {
                        var a = n;
                        n = new r.Frame,
                        i = i || {},
                        i.hasOwnProperty("caller") && n.set("caller", i.caller);
                        var l = "";
                        return l += '\n<div class="logo">\n    <a href="/">\n        ',
                        l += r.suppressValue((s = 16,
                        o = 13,
                        r.callWrap(r.contextOrFrameLookup(e, n, "logo"), "logo", e, [96, 20])), t.opts.autoescape),
                        l += "\n    </a>\n</div>\n",
                        n = a,
                        new r.SafeString(l)
                    });
                    e.addExport("responsive_header_logo"),
                    e.setVariable("responsive_header_logo", c),
                    l += "\n\n\n";
                    var d = r.makeMacro(["width", "height"], ["options"], function(i, a, s) {
                        var o = n;
                        n = new r.Frame,
                        s = s || {},
                        s.hasOwnProperty("caller") && n.set("caller", s.caller),
                        n.set("width", i),
                        n.set("height", a),
                        n.set("options", s.hasOwnProperty("options") ? s.options : {});
                        var l = "";
                        l += "\n\n    ";
                        var u;
                        if (u = t.getFilter("merge").call(e, {
                            brand: !0,
                            color: "#555555"
                        }, r.contextOrFrameLookup(e, n, "options")),
                        n.set("options", u, !0),
                        n.topLevel && e.setVariable("options", u),
                        n.topLevel && e.addExport("options", u),
                        l += "\n\n    ",
                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "brand")) {
                            l += "\n        ";
                            var h;
                            h = 121,
                            n.set("view_width", h, !0),
                            n.topLevel && e.setVariable("view_width", h),
                            n.topLevel && e.addExport("view_width", h),
                            l += "\n    "
                        } else {
                            l += "\n        ";
                            var c;
                            c = 25,
                            n.set("view_width", c, !0),
                            n.topLevel && e.setVariable("view_width", c),
                            n.topLevel && e.addExport("view_width", c),
                            l += "\n    "
                        }
                        return l += '\n\n    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\n         x="0" y="0" width="',
                        l += r.suppressValue(i, t.opts.autoescape),
                        l += '" height="',
                        l += r.suppressValue(a, t.opts.autoescape),
                        l += '"\n         viewBox="0 0 ',
                        l += r.suppressValue(r.contextOrFrameLookup(e, n, "view_width"), t.opts.autoescape),
                        l += ' 25"\n         enable-background="new 0 0 ',
                        l += r.suppressValue(r.contextOrFrameLookup(e, n, "view_width"), t.opts.autoescape),
                        l += ' 25">\n\n        ',
                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "brand") && (l += '\n            <g id="logo-text">\n                <path fill="',
                        l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color"), t.opts.autoescape),
                        l += '"\n                    d="M36.471,7.719c-1.526,0-2.289,0.504-2.289,1.512c0,0.448,0.189,0.791,0.567,1.029\n                       c0.378,0.238,1.263,0.582,2.656,1.029c1.393,0.448,2.37,0.956,2.93,1.522c0.56,0.567,0.84,1.438,0.84,2.615\n                       c0,1.498-0.455,2.632-1.365,3.401c-0.911,0.771-2.1,1.155-3.57,1.155c-1.092,0-2.429-0.168-4.011-0.504l-0.756-0.147l0.294-2.247\n                       c1.876,0.253,3.311,0.379,4.305,0.379c1.484,0,2.226-0.616,2.226-1.849c0-0.447-0.171-0.798-0.515-1.05s-1.025-0.525-2.047-0.819\n                       c-1.624-0.462-2.769-1.011-3.434-1.648s-0.998-1.522-0.998-2.657c0-1.428,0.434-2.492,1.302-3.192c0.868-0.7,2.058-1.05,3.57-1.05\n                       c1.036,0,2.352,0.14,3.948,0.42l0.756,0.147L40.65,8.056C38.676,7.832,37.283,7.719,36.471,7.719z"\n                />\n                <path fill="',
                        l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color"), t.opts.autoescape),
                        l += '"\n                    d="M46.068,19.731h-2.814v-14.7h2.814v8.358l1.071-0.189l2.079-3.969h3.15l-2.73,4.977l2.877,5.523h-3.171\n                       l-2.121-4.095l-1.155,0.188V19.731z"\n                />\n                <path fill="',
                        l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color"), t.opts.autoescape),
                        l += '"\n                    d="M56.705,17.075c0.329,0.287,0.801,0.431,1.417,0.431c1.302,0,2.464-0.042,3.486-0.126l0.589-0.063\n                       l0.041,2.079c-1.61,0.392-3.066,0.588-4.368,0.588c-1.582,0-2.73-0.42-3.444-1.26c-0.714-0.84-1.071-2.205-1.071-4.095\n                       c0-3.766,1.547-5.649,4.641-5.649c3.052,0,4.578,1.582,4.578,4.746l-0.209,1.953H56.19C56.204,16.322,56.375,16.788,56.705,17.075z\n                       M59.802,13.536c0-0.84-0.133-1.424-0.399-1.753c-0.266-0.329-0.732-0.493-1.396-0.493c-0.666,0-1.134,0.171-1.407,0.514\n                       c-0.273,0.343-0.417,0.921-0.431,1.732H59.802z"\n                />\n                <path fill="',
                        l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color"), t.opts.autoescape),
                        l += '"\n                    d="M70.407,11.625h-2.583v4.305c0,0.42,0.011,0.718,0.031,0.893c0.021,0.175,0.098,0.325,0.231,0.451\n                       c0.133,0.126,0.339,0.189,0.619,0.189l1.596-0.042l0.126,2.246c-0.938,0.211-1.651,0.315-2.142,0.315\n                       c-1.26,0-2.121-0.283-2.583-0.851c-0.462-0.566-0.693-1.613-0.693-3.14v-4.368h-1.238V9.231h1.238V6.312h2.814v2.919h2.583V11.625z"\n                />\n                <path fill="',
                        l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color"), t.opts.autoescape),
                        l += '"\n                    d="M76.161,8.979c0.729,0,1.659,0.112,2.794,0.336l0.566,0.126l-0.084,2.226\n                       c-1.106-0.112-1.925-0.168-2.457-0.168c-0.966,0-1.606,0.207-1.921,0.62c-0.315,0.413-0.473,1.193-0.473,2.341\n                       c0,1.148,0.157,1.937,0.473,2.363c0.314,0.427,0.962,0.641,1.942,0.641l2.436-0.168l0.084,2.246\n                       c-1.498,0.295-2.639,0.441-3.423,0.441c-1.554,0-2.671-0.438-3.35-1.312s-1.019-2.278-1.019-4.211c0-1.932,0.35-3.328,1.05-4.189\n                       S74.607,8.979,76.161,8.979z"\n                />\n                <path fill="',
                        l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color"), t.opts.autoescape),
                        l += '"\n                    d="M84.414,19.731H81.6v-14.7h2.814v4.704c0.966-0.504,1.834-0.756,2.604-0.756c1.4,0,2.366,0.413,2.898,1.239\n                       c0.531,0.826,0.798,2.1,0.798,3.822v5.691h-2.814v-5.628c0-0.882-0.104-1.536-0.314-1.963s-0.63-0.641-1.26-0.641\n                       c-0.546,0-1.093,0.084-1.639,0.252l-0.272,0.084V19.731z"\n                />\n                <path fill="',
                        l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color"), t.opts.autoescape),
                        l += '"\n                    d="M96.531,11.625v8.106h-2.814v-8.106h-1.134V9.231h1.134V8.77c0-1.512,0.224-2.555,0.672-3.129\n                       s1.246-0.861,2.395-0.861c0.504,0,1.155,0.07,1.953,0.21l0.44,0.063l-0.042,2.289c-0.616-0.028-1.134-0.042-1.554-0.042\n                       s-0.7,0.112-0.84,0.336c-0.141,0.224-0.21,0.609-0.21,1.155v0.441h2.541v2.394H96.531z"\n                />\n                <path fill="',
                        l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color"), t.opts.autoescape),
                        l += '"\n                    d="M108.753,12.507v4.368c0.028,0.337,0.084,0.571,0.168,0.704s0.259,0.228,0.525,0.283l-0.084,2.121\n                       c-0.714,0-1.285-0.049-1.712-0.146c-0.427-0.099-0.857-0.295-1.291-0.589c-1.008,0.49-2.037,0.735-3.087,0.735\n                       c-2.171,0-3.255-1.147-3.255-3.444c0-1.119,0.301-1.914,0.902-2.383c0.603-0.469,1.526-0.746,2.772-0.83l2.247-0.168v-0.651\n                       c0-0.434-0.099-0.731-0.294-0.893c-0.196-0.161-0.512-0.241-0.945-0.241l-3.948,0.168l-0.084-1.953\n                       c1.498-0.406,2.923-0.609,4.273-0.609c1.352,0,2.324,0.28,2.919,0.84C108.456,10.379,108.753,11.276,108.753,12.507z\n                       M104.028,15.279c-0.784,0.07-1.176,0.49-1.176,1.26c0,0.771,0.343,1.155,1.028,1.155c0.532,0,1.113-0.084,1.743-0.252l0.315-0.084\n                       v-2.247L104.028,15.279z"\n                />\n                <path fill="',
                        l += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "color"), t.opts.autoescape),
                        l += '"\n                    d="M116.522,8.979c1.47,0,2.545,0.402,3.224,1.208s1.019,2.244,1.019,4.316c0,2.071-0.392,3.503-1.176,4.294\n                       s-2.136,1.187-4.053,1.187c-0.603,0-1.701-0.07-3.298-0.21l-0.798-0.084V5.031h2.814v4.515\n                       C115.15,9.168,115.906,8.979,116.522,8.979z M115.536,17.464c0.938,0,1.567-0.228,1.89-0.683s0.482-1.271,0.482-2.447\n                       c0-1.89-0.588-2.834-1.764-2.834c-0.56,0-1.092,0.07-1.596,0.21l-0.294,0.063v5.607C114.898,17.436,115.325,17.464,115.536,17.464z"\n                />\n            </g>\n        '),
                        l += '\n\n        <g>\n            <path fill="#FFFFFF"\n                  d="M12.5,0.833C6.056,0.833,0.834,6.057,0.834,12.5S6.056,24.167,12.5,24.167S24.167,18.943,24.167,12.5\n                     S18.944,0.833,12.5,0.833z" />\n        </g>\n\n        <g id="logo-circle">\n            <path fill="#1CAAD9"\n                d="M12.5-0.029C5.596-0.029,0,5.568,0,12.472c0,6.904,5.596,12.501,12.5,12.501s12.5-5.597,12.5-12.501\n                   C25.001,5.568,19.405-0.029,12.5-0.029z M11.414,19.911L6.025,16.8v-6.276l5.389,2.911V19.911z M12.374,11.958l-6.376-3.38\n                   l6.376-3.682l6.377,3.682L12.374,11.958z M18.755,16.812l-5.369,3.1v-6.452l5.369-2.901V16.812z"\n            />\n        </g>\n\n    </svg>\n\n',
                        n = o,
                        new r.SafeString(l)
                    });
                    e.addExport("logo"),
                    e.setVariable("logo", d),
                    l += "\n",
                    u ? u.rootRenderFunc(t, e, n, r, a) : a(null, l)
                } catch (t) {
                    a(r.handleError(t, s, o))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, function(t, e, i) {
    "use strict";
    e.a = {
        name: "internal",
        domain: "/i",
        parse: function(t) {
            return t.results || []
        }
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(15);
    e.a = n.a.extend({})
}
, , function(t, e, i) {
    var n, r;
    //! moment.js
    //! version : 2.2.1
    //! authors : Tim Wood, Iskren Chernev, Moment.js contributors
    //! license : MIT
    //! momentjs.com
    (function(i) {
        function a(t, e) {
            return function(i) {
                return c(t.call(this, i), e)
            }
        }
        function s() {}
        function o(t) {
            u(this, t)
        }
        function l(t) {
            var e = t.years || t.year || t.y || 0
              , i = t.months || t.month || t.M || 0
              , n = t.weeks || t.week || t.w || 0
              , r = t.days || t.day || t.d || 0
              , a = t.hours || t.hour || t.h || 0
              , s = t.minutes || t.minute || t.m || 0
              , o = t.seconds || t.second || t.s || 0
              , l = t.milliseconds || t.millisecond || t.ms || 0;
            this._input = t,
            this._milliseconds = +l + 1e3 * o + 6e4 * s + 36e5 * a,
            this._days = +r + 7 * n,
            this._months = +i + 12 * e,
            this._data = {},
            this._bubble()
        }
        function u(t, e) {
            for (var i in e)
                e.hasOwnProperty(i) && (t[i] = e[i]);
            return t
        }
        function h(t) {
            return t < 0 ? Math.ceil(t) : Math.floor(t)
        }
        function c(t, e) {
            for (var i = t + ""; i.length < e; )
                i = "0" + i;
            return i
        }
        function d(t, e, i, n) {
            var r, a, s = e._milliseconds, o = e._days, l = e._months;
            s && t._d.setTime(+t._d + s * i),
            (o || l) && (r = t.minute(),
            a = t.hour()),
            o && t.date(t.date() + o * i),
            l && t.month(t.month() + l * i),
            s && !n && V.updateOffset(t),
            (o || l) && (t.minute(r),
            t.hour(a))
        }
        function p(t) {
            return "[object Array]" === Object.prototype.toString.call(t)
        }
        function f(t, e) {
            var i, n = Math.min(t.length, e.length), r = Math.abs(t.length - e.length), a = 0;
            for (i = 0; i < n; i++)
                ~~t[i] != ~~e[i] && a++;
            return a + r
        }
        function g(t) {
            return t ? lt[t] || t.toLowerCase().replace(/(.)s$/, "$1") : t
        }
        function m(t, e) {
            return e.abbr = t,
            z[t] || (z[t] = new s),
            z[t].set(e),
            z[t]
        }
        function v(t) {
            delete z[t]
        }
        function _(t) {
            if (!t)
                return V.fn._lang;
            if (!z[t] && H)
                try {
                    !function() {
                        var t = new Error('Cannot find module "./lang"');
                        throw t.code = "MODULE_NOT_FOUND",
                        t
                    }()
                } catch (t) {
                    return V.fn._lang
                }
            return z[t] || V.fn._lang
        }
        function b(t) {
            return t.match(/\[.*\]/) ? t.replace(/^\[|\]$/g, "") : t.replace(/\\/g, "")
        }
        function x(t) {
            var e, i, n = t.match(q);
            for (e = 0,
            i = n.length; e < i; e++)
                dt[n[e]] ? n[e] = dt[n[e]] : n[e] = b(n[e]);
            return function(r) {
                var a = "";
                for (e = 0; e < i; e++)
                    a += n[e]instanceof Function ? n[e].call(r, t) : n[e];
                return a
            }
        }
        function y(t, e) {
            return e = S(e, t.lang()),
            ut[e] || (ut[e] = x(e)),
            ut[e](t)
        }
        function S(t, e) {
            function i(t) {
                return e.longDateFormat(t) || t
            }
            for (var n = 5; n-- && (Y.lastIndex = 0,
            Y.test(t)); )
                t = t.replace(Y, i);
            return t
        }
        function w(t, e) {
            switch (t) {
            case "DDDD":
                return J;
            case "YYYY":
                return Q;
            case "YYYYY":
                return Z;
            case "S":
            case "SS":
            case "SSS":
            case "DDD":
                return K;
            case "MMM":
            case "MMMM":
            case "dd":
            case "ddd":
            case "dddd":
                return $;
            case "a":
            case "A":
                return _(e._l)._meridiemParse;
            case "X":
                return it;
            case "Z":
            case "ZZ":
                return tt;
            case "T":
                return et;
            case "MM":
            case "DD":
            case "YY":
            case "HH":
            case "hh":
            case "mm":
            case "ss":
            case "M":
            case "D":
            case "d":
            case "H":
            case "h":
            case "m":
            case "s":
                return X;
            default:
                return new RegExp(t.replace("\\", ""))
            }
        }
        function C(t) {
            var e = (tt.exec(t) || [])[0]
              , i = (e + "").match(at) || ["-", 0, 0]
              , n = 60 * i[1] + ~~i[2];
            return "+" === i[0] ? -n : n
        }
        function M(t, e, i) {
            var n, r = i._a;
            switch (t) {
            case "M":
            case "MM":
                null != e && (r[1] = ~~e - 1);
                break;
            case "MMM":
            case "MMMM":
                n = _(i._l).monthsParse(e),
                null != n ? r[1] = n : i._isValid = !1;
                break;
            case "D":
            case "DD":
                null != e && (r[2] = ~~e);
                break;
            case "DDD":
            case "DDDD":
                null != e && (r[1] = 0,
                r[2] = ~~e);
                break;
            case "YY":
                r[0] = ~~e + (~~e > 68 ? 1900 : 2e3);
                break;
            case "YYYY":
            case "YYYYY":
                r[0] = ~~e;
                break;
            case "a":
            case "A":
                i._isPm = _(i._l).isPM(e);
                break;
            case "H":
            case "HH":
            case "h":
            case "hh":
                r[3] = ~~e;
                break;
            case "m":
            case "mm":
                r[4] = ~~e;
                break;
            case "s":
            case "ss":
                r[5] = ~~e;
                break;
            case "S":
            case "SS":
            case "SSS":
                r[6] = ~~(1e3 * ("0." + e));
                break;
            case "X":
                i._d = new Date(1e3 * parseFloat(e));
                break;
            case "Z":
            case "ZZ":
                i._useUTC = !0,
                i._tzm = C(e)
            }
            null == e && (i._isValid = !1)
        }
        function T(t) {
            var e, i, n, r = [];
            if (!t._d) {
                for (n = E(t),
                e = 0; e < 3 && null == t._a[e]; ++e)
                    t._a[e] = r[e] = n[e];
                for (; e < 7; e++)
                    t._a[e] = r[e] = null == t._a[e] ? 2 === e ? 1 : 0 : t._a[e];
                r[3] += ~~((t._tzm || 0) / 60),
                r[4] += ~~((t._tzm || 0) % 60),
                i = new Date(0),
                t._useUTC ? (i.setUTCFullYear(r[0], r[1], r[2]),
                i.setUTCHours(r[3], r[4], r[5], r[6])) : (i.setFullYear(r[0], r[1], r[2]),
                i.setHours(r[3], r[4], r[5], r[6])),
                t._d = i
            }
        }
        function A(t) {
            var e = t._i;
            t._d || (t._a = [e.years || e.year || e.y, e.months || e.month || e.M, e.days || e.day || e.d, e.hours || e.hour || e.h, e.minutes || e.minute || e.m, e.seconds || e.second || e.s, e.milliseconds || e.millisecond || e.ms],
            T(t))
        }
        function E(t) {
            var e = new Date;
            return t._useUTC ? [e.getUTCFullYear(), e.getUTCMonth(), e.getUTCDate()] : [e.getFullYear(), e.getMonth(), e.getDate()]
        }
        function P(t) {
            var e, i, n, r = _(t._l), a = "" + t._i;
            for (n = S(t._f, r).match(q),
            t._a = [],
            e = 0; e < n.length; e++)
                i = (w(n[e], t).exec(a) || [])[0],
                i && (a = a.slice(a.indexOf(i) + i.length)),
                dt[n[e]] && M(n[e], i, t);
            a && (t._il = a),
            t._isPm && t._a[3] < 12 && (t._a[3] += 12),
            !1 === t._isPm && 12 === t._a[3] && (t._a[3] = 0),
            T(t)
        }
        function N(t) {
            var e, i, n, r, a, s = 99;
            for (r = 0; r < t._f.length; r++)
                e = u({}, t),
                e._f = t._f[r],
                P(e),
                i = new o(e),
                a = f(e._a, i.toArray()),
                i._il && (a += i._il.length),
                a < s && (s = a,
                n = i);
            u(t, n)
        }
        function k(t) {
            var e, i = t._i, n = nt.exec(i);
            if (n) {
                for (t._f = "YYYY-MM-DD" + (n[2] || " "),
                e = 0; e < 4; e++)
                    if (rt[e][1].exec(i)) {
                        t._f += rt[e][0];
                        break
                    }
                tt.exec(i) && (t._f += " Z"),
                P(t)
            } else
                t._d = new Date(i)
        }
        function F(t) {
            var e = t._i
              , n = j.exec(e);
            e === i ? t._d = new Date : n ? t._d = new Date(+n[1]) : "string" == typeof e ? k(t) : p(e) ? (t._a = e.slice(0),
            T(t)) : e instanceof Date ? t._d = new Date(+e) : "object" == typeof e ? A(t) : t._d = new Date(e)
        }
        function D(t, e, i, n, r) {
            return r.relativeTime(e || 1, !!i, t, n)
        }
        function R(t, e, i) {
            var n = G(Math.abs(t) / 1e3)
              , r = G(n / 60)
              , a = G(r / 60)
              , s = G(a / 24)
              , o = G(s / 365)
              , l = n < 45 && ["s", n] || 1 === r && ["m"] || r < 45 && ["mm", r] || 1 === a && ["h"] || a < 22 && ["hh", a] || 1 === s && ["d"] || s <= 25 && ["dd", s] || s <= 45 && ["M"] || s < 345 && ["MM", G(s / 30)] || 1 === o && ["y"] || ["yy", o];
            return l[2] = e,
            l[3] = t > 0,
            l[4] = i,
            D.apply({}, l)
        }
        function I(t, e, i) {
            var n, r = i - e, a = i - t.day();
            return a > r && (a -= 7),
            a < r - 7 && (a += 7),
            n = V(t).add("d", a),
            {
                week: Math.ceil(n.dayOfYear() / 7),
                year: n.year()
            }
        }
        function O(t) {
            var e = t._i
              , i = t._f;
            return null === e || "" === e ? null : ("string" == typeof e && (t._i = e = _().preparse(e)),
            V.isMoment(e) ? (t = u({}, e),
            t._d = new Date(+e._d)) : i ? p(i) ? N(t) : P(t) : F(t),
            new o(t))
        }
        function L(t, e) {
            V.fn[t] = V.fn[t + "s"] = function(t) {
                var i = this._isUTC ? "UTC" : "";
                return null != t ? (this._d["set" + i + e](t),
                V.updateOffset(this),
                this) : this._d["get" + i + e]()
            }
        }
        function B(t, e) {
            V.duration.fn["as" + t] = function() {
                return +this / e
            }
        }
        for (var V, U, G = Math.round, z = {}, H = void 0 !== t && t.exports, j = /^\/?Date\((\-?\d+)/i, W = /(\-)?(?:(\d*)\.)?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/, q = /(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g, Y = /(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g, X = /\d\d?/, K = /\d{1,3}/, J = /\d{3}/, Q = /\d{1,4}/, Z = /[+\-]?\d{1,6}/, $ = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i, tt = /Z|[\+\-]\d\d:?\d\d/i, et = /T/i, it = /[\+\-]?\d+(\.\d{1,3})?/, nt = /^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/, rt = [["HH:mm:ss.S", /(T| )\d\d:\d\d:\d\d\.\d{1,3}/], ["HH:mm:ss", /(T| )\d\d:\d\d:\d\d/], ["HH:mm", /(T| )\d\d:\d\d/], ["HH", /(T| )\d\d/]], at = /([\+\-]|\d\d)/gi, st = "Date|Hours|Minutes|Seconds|Milliseconds".split("|"), ot = {
            Milliseconds: 1,
            Seconds: 1e3,
            Minutes: 6e4,
            Hours: 36e5,
            Days: 864e5,
            Months: 2592e6,
            Years: 31536e6
        }, lt = {
            ms: "millisecond",
            s: "second",
            m: "minute",
            h: "hour",
            d: "day",
            w: "week",
            W: "isoweek",
            M: "month",
            y: "year"
        }, ut = {}, ht = "DDD w W M D d".split(" "), ct = "M D H h m s w W".split(" "), dt = {
            M: function() {
                return this.month() + 1
            },
            MMM: function(t) {
                return this.lang().monthsShort(this, t)
            },
            MMMM: function(t) {
                return this.lang().months(this, t)
            },
            D: function() {
                return this.date()
            },
            DDD: function() {
                return this.dayOfYear()
            },
            d: function() {
                return this.day()
            },
            dd: function(t) {
                return this.lang().weekdaysMin(this, t)
            },
            ddd: function(t) {
                return this.lang().weekdaysShort(this, t)
            },
            dddd: function(t) {
                return this.lang().weekdays(this, t)
            },
            w: function() {
                return this.week()
            },
            W: function() {
                return this.isoWeek()
            },
            YY: function() {
                return c(this.year() % 100, 2)
            },
            YYYY: function() {
                return c(this.year(), 4)
            },
            YYYYY: function() {
                return c(this.year(), 5)
            },
            gg: function() {
                return c(this.weekYear() % 100, 2)
            },
            gggg: function() {
                return this.weekYear()
            },
            ggggg: function() {
                return c(this.weekYear(), 5)
            },
            GG: function() {
                return c(this.isoWeekYear() % 100, 2)
            },
            GGGG: function() {
                return this.isoWeekYear()
            },
            GGGGG: function() {
                return c(this.isoWeekYear(), 5)
            },
            e: function() {
                return this.weekday()
            },
            E: function() {
                return this.isoWeekday()
            },
            a: function() {
                return this.lang().meridiem(this.hours(), this.minutes(), !0)
            },
            A: function() {
                return this.lang().meridiem(this.hours(), this.minutes(), !1)
            },
            H: function() {
                return this.hours()
            },
            h: function() {
                return this.hours() % 12 || 12
            },
            m: function() {
                return this.minutes()
            },
            s: function() {
                return this.seconds()
            },
            S: function() {
                return ~~(this.milliseconds() / 100)
            },
            SS: function() {
                return c(~~(this.milliseconds() / 10), 2)
            },
            SSS: function() {
                return c(this.milliseconds(), 3)
            },
            Z: function() {
                var t = -this.zone()
                  , e = "+";
                return t < 0 && (t = -t,
                e = "-"),
                e + c(~~(t / 60), 2) + ":" + c(~~t % 60, 2)
            },
            ZZ: function() {
                var t = -this.zone()
                  , e = "+";
                return t < 0 && (t = -t,
                e = "-"),
                e + c(~~(10 * t / 6), 4)
            },
            z: function() {
                return this.zoneAbbr()
            },
            zz: function() {
                return this.zoneName()
            },
            X: function() {
                return this.unix()
            }
        }; ht.length; )
            U = ht.pop(),
            dt[U + "o"] = function(t, e) {
                return function(i) {
                    return this.lang().ordinal(t.call(this, i), e)
                }
            }(dt[U], U);
        for (; ct.length; )
            U = ct.pop(),
            dt[U + U] = a(dt[U], 2);
        for (dt.DDDD = a(dt.DDD, 3),
        u(s.prototype, {
            set: function(t) {
                var e, i;
                for (i in t)
                    e = t[i],
                    "function" == typeof e ? this[i] = e : this["_" + i] = e
            },
            _months: "January_February_March_April_May_June_July_August_September_October_November_December".split("_"),
            months: function(t) {
                return this._months[t.month()]
            },
            _monthsShort: "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),
            monthsShort: function(t) {
                return this._monthsShort[t.month()]
            },
            monthsParse: function(t) {
                var e, i, n;
                for (this._monthsParse || (this._monthsParse = []),
                e = 0; e < 12; e++)
                    if (this._monthsParse[e] || (i = V.utc([2e3, e]),
                    n = "^" + this.months(i, "") + "|^" + this.monthsShort(i, ""),
                    this._monthsParse[e] = new RegExp(n.replace(".", ""),"i")),
                    this._monthsParse[e].test(t))
                        return e
            },
            _weekdays: "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),
            weekdays: function(t) {
                return this._weekdays[t.day()]
            },
            _weekdaysShort: "Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),
            weekdaysShort: function(t) {
                return this._weekdaysShort[t.day()]
            },
            _weekdaysMin: "Su_Mo_Tu_We_Th_Fr_Sa".split("_"),
            weekdaysMin: function(t) {
                return this._weekdaysMin[t.day()]
            },
            weekdaysParse: function(t) {
                var e, i, n;
                for (this._weekdaysParse || (this._weekdaysParse = []),
                e = 0; e < 7; e++)
                    if (this._weekdaysParse[e] || (i = V([2e3, 1]).day(e),
                    n = "^" + this.weekdays(i, "") + "|^" + this.weekdaysShort(i, "") + "|^" + this.weekdaysMin(i, ""),
                    this._weekdaysParse[e] = new RegExp(n.replace(".", ""),"i")),
                    this._weekdaysParse[e].test(t))
                        return e
            },
            _longDateFormat: {
                LT: "h:mm A",
                L: "MM/DD/YYYY",
                LL: "MMMM D YYYY",
                LLL: "MMMM D YYYY LT",
                LLLL: "dddd, MMMM D YYYY LT"
            },
            longDateFormat: function(t) {
                var e = this._longDateFormat[t];
                return !e && this._longDateFormat[t.toUpperCase()] && (e = this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g, function(t) {
                    return t.slice(1)
                }),
                this._longDateFormat[t] = e),
                e
            },
            isPM: function(t) {
                return "p" === (t + "").toLowerCase().charAt(0)
            },
            _meridiemParse: /[ap]\.?m?\.?/i,
            meridiem: function(t, e, i) {
                return t > 11 ? i ? "pm" : "PM" : i ? "am" : "AM"
            },
            _calendar: {
                sameDay: "[Today at] LT",
                nextDay: "[Tomorrow at] LT",
                nextWeek: "dddd [at] LT",
                lastDay: "[Yesterday at] LT",
                lastWeek: "[Last] dddd [at] LT",
                sameElse: "L"
            },
            calendar: function(t, e) {
                var i = this._calendar[t];
                return "function" == typeof i ? i.apply(e) : i
            },
            _relativeTime: {
                future: "in %s",
                past: "%s ago",
                s: "a few seconds",
                m: "a minute",
                mm: "%d minutes",
                h: "an hour",
                hh: "%d hours",
                d: "a day",
                dd: "%d days",
                M: "a month",
                MM: "%d months",
                y: "a year",
                yy: "%d years"
            },
            relativeTime: function(t, e, i, n) {
                var r = this._relativeTime[i];
                return "function" == typeof r ? r(t, e, i, n) : r.replace(/%d/i, t)
            },
            pastFuture: function(t, e) {
                var i = this._relativeTime[t > 0 ? "future" : "past"];
                return "function" == typeof i ? i(e) : i.replace(/%s/i, e)
            },
            ordinal: function(t) {
                return this._ordinal.replace("%d", t)
            },
            _ordinal: "%d",
            preparse: function(t) {
                return t
            },
            postformat: function(t) {
                return t
            },
            week: function(t) {
                return I(t, this._week.dow, this._week.doy).week
            },
            _week: {
                dow: 0,
                doy: 6
            }
        }),
        V = function(t, e, i) {
            return O({
                _i: t,
                _f: e,
                _l: i,
                _isUTC: !1
            })
        }
        ,
        V.utc = function(t, e, i) {
            return O({
                _useUTC: !0,
                _isUTC: !0,
                _l: i,
                _i: t,
                _f: e
            }).utc()
        }
        ,
        V.unix = function(t) {
            return V(1e3 * t)
        }
        ,
        V.duration = function(t, e) {
            var i, n, r = V.isDuration(t), a = "number" == typeof t, s = r ? t._input : a ? {} : t, o = W.exec(t);
            return a ? e ? s[e] = t : s.milliseconds = t : o && (i = "-" === o[1] ? -1 : 1,
            s = {
                y: 0,
                d: ~~o[2] * i,
                h: ~~o[3] * i,
                m: ~~o[4] * i,
                s: ~~o[5] * i,
                ms: ~~o[6] * i
            }),
            n = new l(s),
            r && t.hasOwnProperty("_lang") && (n._lang = t._lang),
            n
        }
        ,
        V.version = "2.2.1",
        V.defaultFormat = "YYYY-MM-DDTHH:mm:ssZ",
        V.updateOffset = function() {}
        ,
        V.lang = function(t, e) {
            if (!t)
                return V.fn._lang._abbr;
            t = t.toLowerCase(),
            t = t.replace("_", "-"),
            e ? m(t, e) : null === e ? (v(t),
            t = "en") : z[t] || _(t),
            V.duration.fn._lang = V.fn._lang = _(t)
        }
        ,
        V.langData = function(t) {
            return t && t._lang && t._lang._abbr && (t = t._lang._abbr),
            _(t)
        }
        ,
        V.isMoment = function(t) {
            return t instanceof o
        }
        ,
        V.isDuration = function(t) {
            return t instanceof l
        }
        ,
        u(V.fn = o.prototype, {
            clone: function() {
                return V(this)
            },
            valueOf: function() {
                return +this._d + 6e4 * (this._offset || 0)
            },
            unix: function() {
                return Math.floor(+this / 1e3)
            },
            toString: function() {
                return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")
            },
            toDate: function() {
                return this._offset ? new Date(+this) : this._d
            },
            toISOString: function() {
                return y(V(this).utc(), "YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")
            },
            toArray: function() {
                var t = this;
                return [t.year(), t.month(), t.date(), t.hours(), t.minutes(), t.seconds(), t.milliseconds()]
            },
            isValid: function() {
                return null == this._isValid && (this._a ? this._isValid = !f(this._a, (this._isUTC ? V.utc(this._a) : V(this._a)).toArray()) : this._isValid = !isNaN(this._d.getTime())),
                !!this._isValid
            },
            invalidAt: function() {
                var t, e = this._a, i = (this._isUTC ? V.utc(this._a) : V(this._a)).toArray();
                for (t = 6; t >= 0 && e[t] === i[t]; --t)
                    ;
                return t
            },
            utc: function() {
                return this.zone(0)
            },
            local: function() {
                return this.zone(0),
                this._isUTC = !1,
                this
            },
            format: function(t) {
                var e = y(this, t || V.defaultFormat);
                return this.lang().postformat(e)
            },
            add: function(t, e) {
                var i;
                return i = "string" == typeof t ? V.duration(+e, t) : V.duration(t, e),
                d(this, i, 1),
                this
            },
            subtract: function(t, e) {
                var i;
                return i = "string" == typeof t ? V.duration(+e, t) : V.duration(t, e),
                d(this, i, -1),
                this
            },
            diff: function(t, e, i) {
                var n, r, a = this._isUTC ? V(t).zone(this._offset || 0) : V(t).local(), s = 6e4 * (this.zone() - a.zone());
                return e = g(e),
                "year" === e || "month" === e ? (n = 432e5 * (this.daysInMonth() + a.daysInMonth()),
                r = 12 * (this.year() - a.year()) + (this.month() - a.month()),
                r += (this - V(this).startOf("month") - (a - V(a).startOf("month"))) / n,
                r -= 6e4 * (this.zone() - V(this).startOf("month").zone() - (a.zone() - V(a).startOf("month").zone())) / n,
                "year" === e && (r /= 12)) : (n = this - a,
                r = "second" === e ? n / 1e3 : "minute" === e ? n / 6e4 : "hour" === e ? n / 36e5 : "day" === e ? (n - s) / 864e5 : "week" === e ? (n - s) / 6048e5 : n),
                i ? r : h(r)
            },
            from: function(t, e) {
                return V.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)
            },
            fromNow: function(t) {
                return this.from(V(), t)
            },
            calendar: function() {
                var t = this.diff(V().zone(this.zone()).startOf("day"), "days", !0)
                  , e = t < -6 ? "sameElse" : t < -1 ? "lastWeek" : t < 0 ? "lastDay" : t < 1 ? "sameDay" : t < 2 ? "nextDay" : t < 7 ? "nextWeek" : "sameElse";
                return this.format(this.lang().calendar(e, this))
            },
            isLeapYear: function() {
                var t = this.year();
                return t % 4 == 0 && t % 100 != 0 || t % 400 == 0
            },
            isDST: function() {
                return this.zone() < this.clone().month(0).zone() || this.zone() < this.clone().month(5).zone()
            },
            day: function(t) {
                var e = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
                return null != t ? "string" == typeof t && "number" != typeof (t = this.lang().weekdaysParse(t)) ? this : this.add({
                    d: t - e
                }) : e
            },
            month: function(t) {
                var e, i = this._isUTC ? "UTC" : "";
                return null != t ? "string" == typeof t && "number" != typeof (t = this.lang().monthsParse(t)) ? this : (e = this.date(),
                this.date(1),
                this._d["set" + i + "Month"](t),
                this.date(Math.min(e, this.daysInMonth())),
                V.updateOffset(this),
                this) : this._d["get" + i + "Month"]()
            },
            startOf: function(t) {
                switch (t = g(t)) {
                case "year":
                    this.month(0);
                case "month":
                    this.date(1);
                case "week":
                case "isoweek":
                case "day":
                    this.hours(0);
                case "hour":
                    this.minutes(0);
                case "minute":
                    this.seconds(0);
                case "second":
                    this.milliseconds(0)
                }
                return "week" === t ? this.weekday(0) : "isoweek" === t && this.isoWeekday(1),
                this
            },
            endOf: function(t) {
                return t = g(t),
                this.startOf(t).add("isoweek" === t ? "week" : t, 1).subtract("ms", 1)
            },
            isAfter: function(t, e) {
                return e = void 0 !== e ? e : "millisecond",
                +this.clone().startOf(e) > +V(t).startOf(e)
            },
            isBefore: function(t, e) {
                return e = void 0 !== e ? e : "millisecond",
                +this.clone().startOf(e) < +V(t).startOf(e)
            },
            isSame: function(t, e) {
                return e = void 0 !== e ? e : "millisecond",
                +this.clone().startOf(e) == +V(t).startOf(e)
            },
            min: function(t) {
                return t = V.apply(null, arguments),
                t < this ? this : t
            },
            max: function(t) {
                return t = V.apply(null, arguments),
                t > this ? this : t
            },
            zone: function(t) {
                var e = this._offset || 0;
                return null == t ? this._isUTC ? e : this._d.getTimezoneOffset() : ("string" == typeof t && (t = C(t)),
                Math.abs(t) < 16 && (t *= 60),
                this._offset = t,
                this._isUTC = !0,
                e !== t && d(this, V.duration(e - t, "m"), 1, !0),
                this)
            },
            zoneAbbr: function() {
                return this._isUTC ? "UTC" : ""
            },
            zoneName: function() {
                return this._isUTC ? "Coordinated Universal Time" : ""
            },
            hasAlignedHourOffset: function(t) {
                return t = t ? V(t).zone() : 0,
                (this.zone() - t) % 60 == 0
            },
            daysInMonth: function() {
                return V.utc([this.year(), this.month() + 1, 0]).date()
            },
            dayOfYear: function(t) {
                var e = G((V(this).startOf("day") - V(this).startOf("year")) / 864e5) + 1;
                return null == t ? e : this.add("d", t - e)
            },
            weekYear: function(t) {
                var e = I(this, this.lang()._week.dow, this.lang()._week.doy).year;
                return null == t ? e : this.add("y", t - e)
            },
            isoWeekYear: function(t) {
                var e = I(this, 1, 4).year;
                return null == t ? e : this.add("y", t - e)
            },
            week: function(t) {
                var e = this.lang().week(this);
                return null == t ? e : this.add("d", 7 * (t - e))
            },
            isoWeek: function(t) {
                var e = I(this, 1, 4).week;
                return null == t ? e : this.add("d", 7 * (t - e))
            },
            weekday: function(t) {
                var e = (this._d.getDay() + 7 - this.lang()._week.dow) % 7;
                return null == t ? e : this.add("d", t - e)
            },
            isoWeekday: function(t) {
                return null == t ? this.day() || 7 : this.day(this.day() % 7 ? t : t - 7)
            },
            get: function(t) {
                return t = g(t),
                this[t.toLowerCase()]()
            },
            set: function(t, e) {
                t = g(t),
                this[t.toLowerCase()](e)
            },
            lang: function(t) {
                return t === i ? this._lang : (this._lang = _(t),
                this)
            }
        }),
        U = 0; U < st.length; U++)
            L(st[U].toLowerCase().replace(/s$/, ""), st[U]);
        L("year", "FullYear"),
        V.fn.days = V.fn.day,
        V.fn.months = V.fn.month,
        V.fn.weeks = V.fn.week,
        V.fn.isoWeeks = V.fn.isoWeek,
        V.fn.toJSON = V.fn.toISOString,
        u(V.duration.fn = l.prototype, {
            _bubble: function() {
                var t, e, i, n, r = this._milliseconds, a = this._days, s = this._months, o = this._data;
                o.milliseconds = r % 1e3,
                t = h(r / 1e3),
                o.seconds = t % 60,
                e = h(t / 60),
                o.minutes = e % 60,
                i = h(e / 60),
                o.hours = i % 24,
                a += h(i / 24),
                o.days = a % 30,
                s += h(a / 30),
                o.months = s % 12,
                n = h(s / 12),
                o.years = n
            },
            weeks: function() {
                return h(this.days() / 7)
            },
            valueOf: function() {
                return this._milliseconds + 864e5 * this._days + this._months % 12 * 2592e6 + 31536e6 * ~~(this._months / 12)
            },
            humanize: function(t) {
                var e = +this
                  , i = R(e, !t, this.lang());
                return t && (i = this.lang().pastFuture(e, i)),
                this.lang().postformat(i)
            },
            add: function(t, e) {
                var i = V.duration(t, e);
                return this._milliseconds += i._milliseconds,
                this._days += i._days,
                this._months += i._months,
                this._bubble(),
                this
            },
            subtract: function(t, e) {
                var i = V.duration(t, e);
                return this._milliseconds -= i._milliseconds,
                this._days -= i._days,
                this._months -= i._months,
                this._bubble(),
                this
            },
            get: function(t) {
                return t = g(t),
                this[t.toLowerCase() + "s"]()
            },
            as: function(t) {
                return t = g(t),
                this["as" + t.charAt(0).toUpperCase() + t.slice(1) + "s"]()
            },
            lang: V.fn.lang
        });
        for (U in ot)
            ot.hasOwnProperty(U) && (B(U, ot[U]),
            function(t) {
                V.duration.fn[t] = function() {
                    return this._data[t]
                }
            }(U.toLowerCase()));
        B("Weeks", 6048e5),
        V.duration.fn.asMonths = function() {
            return (+this - 31536e6 * this.years()) / 2592e6 + 12 * this.years()
        }
        ,
        V.lang("en", {
            ordinal: function(t) {
                var e = t % 10;
                return t + (1 == ~~(t % 100 / 10) ? "th" : 1 === e ? "st" : 2 === e ? "nd" : 3 === e ? "rd" : "th")
            }
        }),
        V.lang("en"),
        H && (t.exports = V),
        "undefined" == typeof ender && (this.moment = V),
        n = [],
        (r = function() {
            return V
        }
        .apply(e, n)) !== i && (t.exports = r)
    }
    ).call(this)
}
, , , , , function(t, e, i) {
    "use strict";
    var n = i(15);
    e.a = n.a.extend({})
}
, function(t, e, i) {
    "use strict";
    i.d(e, "a", function() {
        return r
    });
    var n = i(1)
      , r = (i.n(n),
    function(t, e) {
        t.__proto = {},
        i.i(n.each)(e, function(e, i) {
            "function" == typeof e ? (t[i] && (t.__proto[i] = t[i]),
            t[i] = e.bind(t)) : t[i] = e
        })
    }
    )
}
, function(t, e, i) {
    "use strict";
    var n = ["a", "e", "i", "o", "u", "h"]
      , r = function(t, e) {
        var i, r, a, s;
        t < 0 ? (i = "in ",
        r = "") : (i = "",
        r = " ago");
        var o = Math.abs(t);
        return 1 !== o ? (a = o.toString(),
        s = "s") : (a = -1 !== n.indexOf(e[0]) ? "an " : "a ",
        s = ""),
        i + a + " " + e + s + r
    }
      , a = {
        1e3: function(t) {
            return r(t, "second")
        },
        6e4: function(t) {
            return r(t, "minute")
        },
        36e5: function(t) {
            return r(t, "hour")
        },
        864e5: function(t) {
            return r(t, "day")
        },
        6048e5: function(t) {
            return r(t, "week")
        },
        24192e5: function(t) {
            return r(t, "month")
        },
        290304e5: function(t) {
            return r(t, "year")
        }
    };
    e.a = {
        timeAgo: function(t) {
            var e = (new Date).getTime()
              , i = t.getTime()
              , n = e - i
              , r = null;
            Object.keys(a).forEach(function(t) {
                t = parseInt(t),
                (null === r || t > r && Math.floor(n / t) >= 1) && (r = t)
            });
            var s = Math.floor(n / r);
            return a[r](s)
        }
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(21)
      , r = i(1)
      , a = (i.n(r),
    function(t) {
        return n.a.parse(t.split("?")[1] || "").cursor
    }
    )
      , s = function() {
        var t = {};
        return {
            get: function(e) {
                return t[e]
            },
            update: function(e, i) {
                i.results.forEach(function(i) {
                    t[i.uid] = e
                })
            }
        }
    }
      , o = function(t, e) {
        function n() {
            return {
                previousCursor: t.previous,
                currentCursor: t.current,
                nextCursor: t.next
            }
        }
        function o(t, e) {
            return function(i) {
                return e.isPrefetching || (l.update(t, i),
                u.currentCursor = t,
                e.setNext && (u.nextCursor = i.next ? a(i.next) : null),
                e.setPrevious && (u.previousCursor = i.previous ? a(i.previous) : null)),
                i
            }
        }
        var l = s()
          , u = n();
        return {
            type: "cursor",
            loadPrevious: function(t) {
                return e(u.previousCursor).then(o(u.previousCursor, i.i(r.extend)({}, t, {
                    setPrevious: !0
                })))
            },
            loadNext: function(t) {
                return e(u.nextCursor).then(o(u.nextCursor, i.i(r.extend)({}, t, {
                    setNext: !0
                })))
            },
            loadFirst: function(t) {
                return u = n(),
                l = s(),
                e(u.current).then(o(u.current, i.i(r.extend)({}, t, {
                    setNext: !0,
                    setPrevious: !0
                })))
            },
            hasPrevious: function() {
                return null !== u.previousCursor
            },
            hasNext: function() {
                return null !== u.nextCursor
            },
            getQueryParamsForElementUid: function(t) {
                return {
                    cursor: l.get(t)
                }
            },
            setInitialQuery: function(t, e) {
                var i = a(t);
                l.update(i, e)
            }
        }
    };
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(21))
      , a = function(t) {
        return r.a.parse(t.split("?")[1] || "").page
    }
      , s = function() {
        var t = {};
        return {
            get: function(e) {
                return t[e]
            },
            update: function(e, i) {
                i.results.forEach(function(i) {
                    t[i.uid] = e
                })
            }
        }
    }
      , o = function(t, e) {
        function r() {
            var e = i.i(n.isNumber)(t.lastPage) ? t.lastPage : 1 / 0
              , r = l(e, t.currentPageIndex);
            return {
                lastPage: e,
                currentPageIndex: r,
                hasPrevious: 0 !== r
            }
        }
        function o(t, e) {
            return function(i) {
                return e.isPrefetching || (u.update(t, i),
                h.currentPageIndex = t,
                i.previous || (h.hasPrevious = !1),
                i.next ? h.lastPage = 1 / 0 : h.lastPage = t),
                i
            }
        }
        var l = function(t, e) {
            return Math.min(t, Math.max(0, parseInt(e) || 0))
        }
          , u = s()
          , h = r();
        return {
            type: "offset",
            loadPrevious: function(t) {
                var i = l(h.lastPage, h.currentPageIndex - 1);
                return e(i).then(o(i, t))
            },
            loadNext: function(t) {
                var i = l(h.lastPage, h.currentPageIndex + 1);
                return e(i).then(o(i, t))
            },
            loadFirst: function(t) {
                h = r(),
                u = s();
                return e(0).then(o(0, t))
            },
            hasPrevious: function() {
                return h.hasPrevious
            },
            hasNext: function() {
                return h.currentPageIndex + 1 < h.lastPage
            },
            getQueryParamsForElementUid: function(t) {
                return {
                    page: u.get(t) || ""
                }
            },
            setInitialQuery: function(t, e) {
                var i = a(t);
                u.update(i, e)
            }
        }
    };
    e.a = o
}
, , , , , function(t, e, i) {
    var n = i(829)
      , r = function(t) {
        t = t || "",
        t = decodeURIComponent(t);
        var e = {};
        return t.split("&").forEach(function(t) {
            if (t.indexOf("=") > -1) {
                var i = t.split("=");
                e[i[0]] = i[1]
            } else
                e = t.indexOf(",") > -1 ? t.split(",") : t
        }
        .bind(this)),
        e
    }
      , a = function(t, e) {
        var i = t;
        i.indexOf("#") > -1 && (i = i.slice(1));
        var n = i.split(";")
          , r = [];
        for (var a in n) {
            var l = new o(s(n[a]));
            l.from && l.from === e || !l.data || r.push(l)
        }
        return r
    }
      , s = function(t) {
        var e = t
          , i = {};
        e.indexOf("#") > -1 && (e = e.slice(1));
        var n = e.split(":");
        return 1 === n.length ? i.data = n[0] : 2 === n.length ? (i.from = n[0].toUpperCase(),
        i.data = n[1]) : 3 === n.length && (i.from = n[0].toUpperCase(),
        i.to = n[1].toUpperCase(),
        i.data = n[2]),
        i.data && (i.stringData = i.data,
        i.data = r(i.data)),
        i._originalString = t + ";",
        i
    }
      , o = function(t) {
        var e = t;
        "string" == typeof t && (e = s(t)),
        this._msg = e,
        this.from = e.from,
        this.to = e.to,
        this.data = l(e.data)
    }
      , l = function(t) {
        return "string" == typeof t ? t = decodeURIComponent(t) : Array.isArray(t) ? t = t.map(decodeURIComponent) : "object" === (typeof t).toLowerCase() && Object.keys(t).forEach(function(e) {
            "string" == typeof t[e] ? t[e] = decodeURIComponent(t[e]) : Array.isArray(t[e]) && (t[e] = t[e].map(decodeURIComponent))
        }
        .bind(this)),
        t
    };
    o.prototype._getStringifiedData = function() {
        var t = "";
        if ("string" == typeof this.data)
            return encodeURIComponent(this.data);
        if (Array.isArray(this.data))
            return this.data.map(encodeURIComponent).join(",");
        if ("object" == typeof this.data)
            for (var e in this.data) {
                var i;
                "string" == typeof this.data[e] ? i = encodeURIComponent(this.data[e]) : Array.isArray(this.data[e]) && (i = this.data[e].map(encodeURIComponent).join(",")),
                t += e + "=" + i
            }
        return t
    }
    ,
    o.prototype.toString = function() {
        var t = "";
        return this.from && (t += this.from + ":"),
        this.to && (t += this.to + ":"),
        t += this._getStringifiedData() + ";"
    }
    ;
    var u = function(t) {
        if (t = t || {},
        !t.device)
            throw new Error('ViewerHashAPI options need to contain the "device" identifier property');
        t.listen && this.listen(t.listen),
        this.device = t.device
    };
    u.prototype.appendToHash = function(t, e) {
        t instanceof o && (t = t.toString()),
        "string" == typeof t && (e = h(e),
        -1 === e.location.hash.indexOf(t) && (e.location.hash = e.location.hash + t))
    }
    ,
    u.prototype.removeFromHash = function(t, e) {
        if (!(t instanceof o))
            throw new Error("Please supply an instance of ViewerHashMessage");
        e = h(e);
        var i = e.location.hash;
        i = t._msg && t._msg._originalString ? i.replace(t._msg._originalString, "") : i.replace(t.toString(), ""),
        e.location.hash = i
    }
    ;
    var h = function(t) {
        if (t = (!0 === t ? window : t) || window,
        t && t.tagName && "iframe" === t.tagName.toLowerCase() && (t = t.contentWindow),
        !t.addEventListener)
            throw new Error("Could not bind an event to supplied target. Please supply an instance of window or an iframe.");
        return t
    };
    u.prototype.listen = function(t) {
        return t = h(t),
        t.addEventListener("hashchange", this._onHashChange.bind(this, t), !1)
    }
    ,
    u.prototype._onHashChange = function(t) {
        (this.getMessages(t.location.hash).messages || []).forEach(function(t) {
            if (t)
                if (t.data && !Array.isArray(t)) {
                    var e = t.data;
                    if ("object" == typeof t.data) {
                        var i = Object.keys(t.data);
                        e = t.data._key ? t.data._key : i[0]
                    }
                    e && this.trigger("message:" + e, t)
                } else
                    this.trigger("message", t)
        }
        .bind(this))
    }
    ,
    u.prototype.getMessages = function(t) {
        var e = a(t, this.device)
          , i = t;
        for (var n in e)
            i = e[n]._msg && e[n]._msg._originalString ? i.replace(e[n]._msg._originalString, "") : i.replace(e[n].toString(), "");
        return {
            messages: e,
            hash: i
        }
    }
    ,
    u.prototype.createMessage = function(t) {
        return t = t || {},
        t.from = this.device,
        new o(t)
    }
    ,
    n.mixin(u.prototype),
    o.prototype.removeFromHash = function() {
        u.prototype.removeFromHash.call(this, this)
    }
    ,
    o.prototype.appendToHash = function() {
        u.prototype.appendToHash.call(this, this)
    }
    ,
    t.exports = u
}
, , , function(t, e, i) {
    "use strict";
    var n = i(353)
      , r = i(5).vec3
      , a = i(5).mat4
      , s = function() {
        this._center = r.create(),
        this._radius = -1
    };
    s.prototype = {
        init: function() {
            r.init(this._center),
            this._radius = -1
        },
        valid: function() {
            return this._radius >= 0
        },
        set: function(t, e) {
            this._center = t,
            this._radius = e
        },
        center: function() {
            return this._center
        },
        radius: function() {
            return this._radius
        },
        radius2: function() {
            return this._radius * this._radius
        },
        expandByBoundingBox: function() {
            var t = r.create()
              , e = new n;
            return function(i) {
                if (i.valid())
                    if (this.valid()) {
                        r.copy(e._min, i._min),
                        r.copy(e._max, i._max);
                        for (var n = 0; n < 8; n++)
                            r.sub(t, i.corner(n, t), this._center),
                            r.normalize(t, t),
                            r.scaleAndAdd(t, this._center, t, -this._radius),
                            e.expandByvec3(t);
                        e.center(this._center),
                        this._radius = e.radius()
                    } else
                        i.center(this._center),
                        this._radius = i.radius()
            }
        }(),
        expandByvec3: function() {
            var t = r.create();
            return function(e) {
                if (this.valid()) {
                    r.sub(t, e, this.center(t));
                    var i = r.length(t);
                    if (i > this.radius()) {
                        var n = .5 * (i - this.radius());
                        this._center[0] += t[0] * (n / i),
                        this._center[1] += t[1] * (n / i),
                        this._center[2] += t[2] * (n / i),
                        this._radius += n
                    }
                } else
                    this._center[0] = e[0],
                    this._center[1] = e[1],
                    this._center[2] = e[2],
                    this._radius = 0
            }
        }(),
        expandRadiusBySphere: function(t) {
            if (t.valid())
                if (this.valid()) {
                    var e = r.distance(this._center, t._center) + t._radius;
                    e > this._radius && (this._radius = e)
                } else
                    r.copy(this._center, t._center),
                    this._radius = t._radius
        },
        expandByBoundingSphere: function(t) {
            if (t.valid()) {
                if (!this.valid())
                    return this._center[0] = t._center[0],
                    this._center[1] = t._center[1],
                    this._center[2] = t._center[2],
                    void (this._radius = t.radius());
                var e = r.distance(t.center(), this.center());
                if (!(e + t.radius() <= this.radius())) {
                    if (e + this.radius() <= t.radius())
                        return this._center[0] = t._center[0],
                        this._center[1] = t._center[1],
                        this._center[2] = t._center[2],
                        void (this._radius = t._radius);
                    var i = .5 * (this.radius() + e + t.radius())
                      , n = (i - this.radius()) / e;
                    this._center[0] += (t._center[0] - this._center[0]) * n,
                    this._center[1] += (t._center[1] - this._center[1]) * n,
                    this._center[2] += (t._center[2] - this._center[2]) * n,
                    this._radius = i
                }
            }
        },
        contains: function(t) {
            return !!this.valid() && r.sqrDist(this.center(), t) <= this.radius2()
        },
        intersects: function(t) {
            if (!this.valid() || !t.valid())
                return !1;
            var e = this.radius() + t.radius();
            return r.sqrDist(t.center(), this.center()) <= e * e
        },
        transformMat4: function() {
            var t = r.create();
            return function(e, i) {
                if (!this.valid())
                    return e;
                e._center !== this._center && (r.copy(e._center, this._center),
                e._radius = this._radius);
                var n = e._center
                  , s = e._radius;
                return a.getSqrScale(t, i),
                s *= Math.sqrt(Math.max(Math.max(t[0], t[1]), t[2])),
                e._radius = s,
                r.transformMat4(n, n, i),
                e
            }
        }()
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = function() {
        this._gl = void 0
    };
    n.prototype = {
        setGraphicContext: function(t) {
            this._gl = t
        },
        getGraphicContext: function() {
            return this._gl
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(5).mat4
      , r = function() {
        this._stack = [n.create()],
        this._current = 0
    };
    r.prototype = {
        reset: function() {
            this._current = 0
        },
        get: function() {
            var t = this._stack[this._current++];
            return this._current === this._stack.length && this._stack.push(n.create()),
            t
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).vec4
      , a = i(5).vec3
      , s = n.objectInherit(r, {
        INSIDE: 1,
        INTERSECT: 2,
        OUTSIDE: 3,
        transformProvidingInverse: function() {
            var t = s.create();
            return function(e, i) {
                var n = e[0]
                  , r = e[1]
                  , a = e[2]
                  , o = e[3];
                return t[0] = i[0] * n + i[1] * r + i[2] * a + i[3] * o,
                t[1] = i[4] * n + i[5] * r + i[6] * a + i[7] * o,
                t[2] = i[8] * n + i[9] * r + i[10] * a + i[11] * o,
                t[3] = i[12] * n + i[13] * r + i[14] * a + i[15] * o,
                s.normalizeEquation(t),
                s.copy(t, e),
                e
            }
        },
        normalizeEquation: function(t) {
            var e = 1 / Math.sqrt(t[0] * t[0] + t[1] * t[1] + t[2] * t[2]);
            t[0] *= e,
            t[1] *= e,
            t[2] *= e,
            t[3] *= e
        },
        getNormal: function(t, e) {
            return e[0] = t[0],
            e[1] = t[1],
            e[2] = t[2],
            e
        },
        setNormal: function(t, e) {
            t[0] = e[0],
            t[1] = e[1],
            t[2] = e[2]
        },
        getDistance: function(t) {
            return t[3]
        },
        setDistance: function(t, e) {
            t[3] = e
        },
        distanceToPlane: function(t, e) {
            return a.dot(t, e) + t[3]
        },
        intersectsOrContainsBoundingSphere: function(t, e) {
            if (!e.valid())
                return s.OUTSIDE;
            var i = e.center()
              , n = e.radius()
              , r = this.distanceToPlane(t, i);
            return r < -n ? s.OUTSIDE : r <= n ? s.INTERSECT : s.INSIDE
        },
        instersectsBoundingSphere: function(t, e) {
            return this.intersectsOrContainsBoundingSphere(t, e) === s.INTERSECT
        },
        intersectsOrContainsBoundingBox: function() {
            var t = a.create()
              , e = a.create()
              , i = a.create();
            return function(n, r, o) {
                a.add(t, r.getMax(), r.getMin()),
                a.scale(t, t, .5),
                a.sub(t, r.getMax(), r.getMin()),
                a.scale(e, e, .5);
                var l = a.dot(t, n);
                o || (o = i,
                o[0] = Math.abs(n[0]),
                o[1] = Math.abs(n[1]),
                o[2] = Math.abs(n[2]));
                var u = a.dot(e, o);
                return l + u > 0 ? s.INTERSECT : l - u >= 0 ? s.INSIDE : s.OUTSIDE
            }
        },
        intersectsBoundingBox: function(t, e, i) {
            return this.intersectsOrContainsBoundingBox(t, e, i) === s.INTERSECT
        },
        intersectOrContainsVertices: function(t, e) {
            for (var i = -1, n = 0; n < e.length; n++) {
                var r = this.distanceToPlane(t, e[n]);
                if (r < 0) {
                    if (1 === i)
                        return s.INTERSECT;
                    i = 2
                } else {
                    if (!(r > 0))
                        return s.INTERSECT;
                    if (2 === i)
                        return s.INTERSECT;
                    i = 1
                }
            }
            return i > 0 ? s.INSIDE : s.OUTSIDE
        },
        intersectVertices: function(t, e) {
            return this.intersectOrContainsVertices(t, e) === s.INTERSECT
        }
    });
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = i(5).mat4
      , s = i(5).vec3
      , o = function(t, e, i, n) {
        r.call(this),
        this._x = void 0 !== t ? t : 0,
        this._y = void 0 !== e ? e : 0,
        this._width = void 0 !== i ? i : 800,
        this._height = void 0 !== n ? n : 600
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Viewport",
        cloneType: function() {
            return new o
        },
        apply: function(t) {
            t.getGraphicContext().viewport(this._x, this._y, this._width, this._height)
        },
        setViewport: function(t, e, i, n) {
            this._x = t,
            this._y = e,
            this._width = i,
            this._height = n
        },
        x: function() {
            return this._x
        },
        y: function() {
            return this._y
        },
        width: function() {
            return this._width
        },
        height: function() {
            return this._height
        },
        computeWindowMatrix: function() {
            var t = a.create()
              , e = a.create()
              , i = s.create();
            return function(n) {
                a.fromTranslation(t, s.ONE),
                a.fromScaling(e, [.5 * this._width, .5 * this._height, .5]);
                var r = a.fromTranslation(n, s.set(i, this._x, this._y, 0));
                return a.mul(r, r, a.mul(e, e, t))
            }
        }()
    }), "osg", "Viewport"),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(5).mat4
      , r = i(144)
      , a = function(t, e, i) {
        var a = e;
        void 0 === a && (a = !0);
        var s = i || n.create()
          , o = 0;
        if (a) {
            for (o = t.length - 1; o >= 0; o--) {
                var l = t[o];
                if ("Camera" === l.className() && (l.getReferenceFrame() !== r.RELATIVE_RF || 0 === l.getParents().length))
                    break
            }
            o += 1
        }
        for (var u = o, h = t.length; u < h; u++) {
            var c = t[u];
            c.computeLocalToWorldMatrix && c.computeLocalToWorldMatrix(s)
        }
        return s
    };
    t.exports = {
        computeLocalToWorld: a
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).vec3
      , a = i(353)
      , s = i(5).mat4
      , o = i(163)
      , l = i(526)
      , u = function(t) {
        void 0 !== t && this.setName(t),
        o.call(this),
        this._invBindInSkeletonSpace = s.create(),
        this._boneInSkeletonSpace = s.create(),
        this._boneBoundingBox = new a
    };
    u.prototype = n.objectLibraryClass(n.objectInherit(o.prototype, {
        getOrCreateDebugColor: function() {
            return this._boneColor ? this._boneColor : (this._boneColor = r.fromValues(Math.random(), Math.random(), Math.random()),
            this._boneColor)
        },
        getBoneBoundingBox: function() {
            return this._boneBoundingBox
        },
        setBoneBoundingBox: function(t) {
            this._boneBoundingBox = t
        },
        getMatrixInSkeletonSpace: function() {
            return this._boneInSkeletonSpace
        },
        getInvBindMatrixInSkeletonSpace: function() {
            return this._invBindInSkeletonSpace
        },
        setMatrixInSkeletonSpace: function(t) {
            s.copy(this._boneInSkeletonSpace, t)
        },
        setInvBindMatrixInSkeletonSpace: function(t) {
            s.copy(this._invBindInSkeletonSpace, t)
        },
        getBoneParent: function() {
            for (var t = this.getParents(), e = 0, i = t.length; e < i; e++) {
                if (t[e].getTypeID() === u.getTypeID())
                    return t[e]
            }
        },
        setDefaultUpdateCallback: function(t) {
            this.addUpdateCallback(new l(void 0 !== t ? t : this.getName()))
        }
    }), "osgAnimation", "Bone"),
    n.setTypeID(u),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).vec3
      , a = i(143)
      , s = i(28)
      , o = i(5).mat4
      , l = i(287)
      , u = i(381)
      , h = i(853)
      , c = i(851)
      , d = i(434)
      , p = i(413)
      , f = function() {
        a.call(this),
        this._shape = null,
        this.addUpdateCallback(new h),
        this._root = void 0,
        this._pathToRoot = void 0,
        this._isAnimatedPath = !1,
        this._boneNameID = {},
        this._matrixFromSkeletonToGeometry = o.create(),
        this._invMatrixFromSkeletonToGeometry = o.create(),
        this._rigTransformImplementation = new c,
        this._stateSetAnimation = new l,
        this._needToComputeMatrix = !0
    };
    f.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, {
        getStateSetAnimation: function() {
            return this._stateSetAnimation
        },
        getSkeleton: function() {
            return this._root
        },
        setSkeleton: function(t) {
            this._root = t
        },
        setPathToSkeleton: function(t) {
            this._pathToRoot = t,
            this._isAnimatedPath = d.checkPathIsAnimated(t)
        },
        setNeedToComputeMatrix: function(t) {
            this._needToComputeMatrix = t
        },
        getNeedToComputeMatrix: function() {
            return this._needToComputeMatrix
        },
        computeBoundingBox: function(t) {
            t.init();
            var e = this.getVertexAttributeList().Vertex
              , i = this.getVertexAttributeList().Weights;
            if (e && i && e.getElements() && e.getItemSize() > 2) {
                for (var n = i.getElements(), r = e.getElements(), a = e.getItemSize(), s = t.getMin(), o = t.getMax(), l = s[0], u = s[1], h = s[2], c = o[0], d = o[1], p = o[2], f = 0, g = 0, m = r.length; f < m; f += a,
                g += 4)
                    if (0 === n[f] && 0 === n[f + 1] && 0 === n[f + 2] && 0 === n[f + 3]) {
                        var v = r[f]
                          , _ = r[f + 1]
                          , b = r[f + 2];
                        v < l && (l = v),
                        v > c && (c = v),
                        _ < u && (u = _),
                        _ > d && (d = _),
                        b < h && (h = b),
                        b > p && (p = b)
                    }
                s[0] = l,
                s[1] = u,
                s[2] = h,
                o[0] = c,
                o[1] = d,
                o[2] = p
            }
            return t
        },
        computeMatrixFromRootSkeleton: function() {
            if (!this._root)
                return void s.warn("Warning " + this.className() + ".computeMatrixFromRootSkeleton if you have this message it means you miss to call buildTransformer( root ), or your RigGeometry (" + this.getName() + ") is not attached to a Skeleton subgraph");
            o.identity(this._matrixFromSkeletonToGeometry),
            p.computeLocalToWorld(this._pathToRoot, !0, this._matrixFromSkeletonToGeometry),
            o.invert(this._invMatrixFromSkeletonToGeometry, this._matrixFromSkeletonToGeometry),
            this._isAnimatedPath || (this._needToComputeMatrix = !1)
        },
        getMatrixFromSkeletonToGeometry: function() {
            return this._matrixFromSkeletonToGeometry
        },
        getInvMatrixFromSkeletonToGeometry: function() {
            return this._invMatrixFromSkeletonToGeometry
        },
        getSourceGeometry: function() {
            return this._geometry
        },
        setSourceGeometry: function(t) {
            this._geometry = t
        },
        getBoneNameID: function() {
            return this._boneNameID
        },
        setBoneNameID: function(t) {
            this._boneNameID = t
        },
        mergeChildrenVertexAttributeList: function() {
            this._geometry instanceof u && this._geometry.mergeChildrenVertexAttributeList();
            var t = this._geometry.getVertexAttributeList();
            a.appendVertexAttributeToList(t, this.getVertexAttributeList())
        },
        mergeChildrenData: function() {
            this.mergeChildrenVertexAttributeList();
            var t = this._geometry.getPrimitiveSetList();
            this.getPrimitiveSetList().length = 0;
            for (var e = 0, i = t.length; e < i; e++)
                this.getPrimitiveSetList()[e] = t[e];
            this.getStateSet() && console.error("A stateset in the rig is already present : " + this.getStateSet()),
            this.setStateSet(this._geometry.getStateSet())
        },
        update: function() {
            this._rigTransformImplementation.update(this)
        },
        computeTransformedVertex: function(t, e) {
            e = e || r.create();
            var i = this.getVertexAttributeList()
              , n = i.Weights.getElements()
              , a = i.Bones.getElements()
              , s = 0
              , o = 0
              , l = 0;
            if (this._geometry.computeTransformedVertex)
                this._geometry.computeTransformedVertex(t, e),
                s = e[0],
                o = e[1],
                l = e[2];
            else {
                var u = i.Vertex.getElements();
                s = u[3 * t],
                o = u[3 * t + 1],
                l = u[3 * t + 2]
            }
            for (var h = 4 * t, c = this._rigTransformImplementation._skinningAttribute.getMatrixPalette(), d = 0, p = 0, f = 0, g = 0, m = 0, v = 0, _ = 0, b = 0, x = 0, y = 0, S = 0, w = 0, C = 0, M = !1, T = 0; T < 4; ++T) {
                var A = n[h + T];
                if (0 !== A) {
                    var E = 12 * a[h + T];
                    d += c[E + 0] * A,
                    g += c[E + 1] * A,
                    _ += c[E + 2] * A,
                    y += c[E + 3] * A,
                    p += c[E + 4] * A,
                    m += c[E + 5] * A,
                    b += c[E + 6] * A,
                    S += c[E + 7] * A,
                    f += c[E + 8] * A,
                    v += c[E + 9] * A,
                    x += c[E + 10] * A,
                    w += c[E + 11] * A,
                    C += A,
                    M = !0
                }
            }
            M || (e[0] = s,
            e[1] = o,
            e[2] = l);
            var P = 1 / C;
            return e[0] = (d * s + g * o + _ * l + y) * P,
            e[1] = (p * s + m * o + b * l + S) * P,
            e[2] = (f * s + v * o + x * l + w) * P,
            e
        },
        computeTransformedVertices: function() {
            for (var t = this.getVertexAttributeList(), e = this._geometry.computeTransformedVertices ? this._geometry.computeTransformedVertices() : t.Vertex.getElements(), i = t.Weights.getElements(), n = t.Bones.getElements(), r = this._riggedVerts || new Float32Array(e.length), a = this._rigTransformImplementation._skinningAttribute.getMatrixPalette(), s = 0, o = 0, l = e.length; s < l; s += 3,
            o += 4) {
                var u, h = 0, c = 0, d = 0, p = 0, f = 0, g = 0, m = 0, v = 0, _ = 0, b = 0, x = 0, y = 0, S = 0, w = !1, C = i[o];
                0 !== C && (u = 12 * n[o],
                h += a[u + 0] * C,
                p += a[u + 1] * C,
                m += a[u + 2] * C,
                b += a[u + 3] * C,
                c += a[u + 4] * C,
                f += a[u + 5] * C,
                v += a[u + 6] * C,
                x += a[u + 7] * C,
                d += a[u + 8] * C,
                g += a[u + 9] * C,
                _ += a[u + 10] * C,
                y += a[u + 11] * C,
                S += C,
                w = !0),
                C = i[o + 1],
                0 !== C && (u = 12 * n[o + 1],
                h += a[u + 0] * C,
                p += a[u + 1] * C,
                m += a[u + 2] * C,
                b += a[u + 3] * C,
                c += a[u + 4] * C,
                f += a[u + 5] * C,
                v += a[u + 6] * C,
                x += a[u + 7] * C,
                d += a[u + 8] * C,
                g += a[u + 9] * C,
                _ += a[u + 10] * C,
                y += a[u + 11] * C,
                S += C,
                w = !0),
                C = i[o + 2],
                0 !== C && (u = 12 * n[o + 2],
                h += a[u + 0] * C,
                p += a[u + 1] * C,
                m += a[u + 2] * C,
                b += a[u + 3] * C,
                c += a[u + 4] * C,
                f += a[u + 5] * C,
                v += a[u + 6] * C,
                x += a[u + 7] * C,
                d += a[u + 8] * C,
                g += a[u + 9] * C,
                _ += a[u + 10] * C,
                y += a[u + 11] * C,
                S += C,
                w = !0),
                C = i[o + 3],
                0 !== C && (u = 12 * n[o + 3],
                h += a[u + 0] * C,
                p += a[u + 1] * C,
                m += a[u + 2] * C,
                b += a[u + 3] * C,
                c += a[u + 4] * C,
                f += a[u + 5] * C,
                v += a[u + 6] * C,
                x += a[u + 7] * C,
                d += a[u + 8] * C,
                g += a[u + 9] * C,
                _ += a[u + 10] * C,
                y += a[u + 11] * C,
                S += C,
                w = !0);
                var M = e[s]
                  , T = e[s + 1]
                  , A = e[s + 2];
                if (w) {
                    var E = 1 / S;
                    r[s] = (h * M + p * T + m * A + b) * E,
                    r[s + 1] = (c * M + f * T + v * A + x) * E,
                    r[s + 2] = (d * M + g * T + _ * A + y) * E
                } else
                    r[s] = M,
                    r[s + 1] = T,
                    r[s + 2] = A
            }
            return r
        }
    }), "osgAnimation", "RigGeometry"),
    n.setTypeID(f),
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(5).vec3
      , r = i(5).quat
      , a = i(354)
      , s = i(625)
      , o = {}
      , l = function(t, e, i, n, r, a) {
        var s = i[0]
          , o = i[i.length - 1];
        return a.start = s,
        a.keys = e,
        a.end = o,
        a.times = i,
        a.type = t,
        a.duration = o - s,
        a.target = n,
        a.name = r,
        a
    }
      , u = function(t, e, i, n, r) {
        return l(s.Vec3, t, e, i, n, r || {})
    }
      , h = function(t, e, i, n, r) {
        return l(s.Float, t, e, i, n, r || {})
    }
      , c = function(t, e, i, n, r) {
        return l(s.Quat, t, e, i, n, r || {})
    }
      , d = function(t, e, i, n, r) {
        return l(s.QuatSlerp, t, e, i, n, r || {})
    }
      , p = function(t, e, i, n, r) {
        return l(s.FloatCubicBezier, t, e, i, n, r || {})
    }
      , f = function(t, e, i, n, r) {
        return l(s.Vec3CubicBezier, t, e, i, n, r || {})
    }
      , g = {
        create: function() {
            return 0
        }
    }
      , m = {
        create: function() {
            return n.create32()
        }
    }
      , v = {
        create: function() {
            return r.create32()
        }
    }
      , _ = function(t, e) {
        return {
            channel: e,
            value: t.create(),
            targetID: a.InvalidTargetID,
            weight: 1,
            key: 0,
            start: 0,
            end: 0
        }
    }
      , b = function(t) {
        return _(m, t)
    }
      , x = function(t) {
        return _(v, t)
    }
      , y = function(t) {
        return _(g, t)
    }
      , S = function(t) {
        return _(g, t)
    }
      , w = function(t) {
        return _(m, t)
    }
      , C = function(t) {
        return o[t.type](t)
    };
    o.createInstanceChannel = C,
    o.createInstanceVec3Channel = b,
    o.createInstanceQuatChannel = x,
    o.createInstanceQuatSlerpChannel = x,
    o.createInstanceFloatChannel = y,
    o.createInstanceFloatCubicBezierChannel = S,
    o.createInstanceVec3CubicBezierChannel = w,
    o.createVec3Channel = u,
    o.createQuatChannel = c,
    o.createQuatSlerpChannel = d,
    o.createFloatChannel = h,
    o.createFloatCubicBezierChannel = p,
    o.createVec3CubicBezierChannel = f,
    o[s.Vec3] = b,
    o[s.Quat] = x,
    o[s.QuatSlerp] = x,
    o[s.Float] = y,
    o[s.FloatCubicBezier] = S,
    o[s.Vec3CubicBezier] = w,
    o.ChannelType = s,
    t.exports = o
}
, function(t, e, i) {
    var n = i(7)
      , r = function(t, e) {
        var i = n.defer()
          , r = new XMLHttpRequest;
        return r.open("GET", t, !0),
        e && e.responseType && (r.responseType = e.responseType),
        e && e.progress && r.addEventListener("progress", e.progress, !1),
        r.addEventListener("error", function() {
            i.reject()
        }, !1),
        r.addEventListener("load", function() {
            "arraybuffer" === r.responseType || "blob" === r.responseType ? i.resolve(r.response) : i.resolve(r.responseText)
        }),
        r.send(null),
        i.promise
    }
      , a = function(t, e) {
        var i = Promise.defer()
          , n = new window.FileReader;
        return n.onload = function(t) {
            if ("blob" === e.responseType) {
                var n = new window.Image;
                n.src = t.target.result,
                i.resolve(n)
            } else
                i.resolve(t.target.result)
        }
        ,
        e && e.responseType ? "arraybuffer" === e.responseType ? n.readAsArrayBuffer(t) : "string" === e.responseType ? n.readAsText(t) : n.readAsDataURL(t) : n.readAsText(t),
        i.promise
    }
      , s = function(t, e) {
        return "string" == typeof t ? r(t, e) : a(t, e)
    };
    t.exports = s
}
, , , , function(t, e, i) {
    "use strict";
    var n = i(15)
      , r = i(90)
      , a = i(29)
      , s = new n.a({
        hasTransparency: !1,
        hasExtra: !1
    })
      , o = {}
      , l = 0;
    s.registerStateSetTransparency = function(t) {
        var e = t.getInstanceID();
        o[e] || (o[e] = !0,
        l++,
        s.set("hasTransparency", l > 0))
    }
    ,
    s.registerStateSetOpaque = function(t) {
        var e = t.getInstanceID();
        o[e] && (o[e] = !1,
        l--,
        s.set("hasTransparency", l > 0))
    }
    ;
    var u = !1
      , h = !1
      , c = function() {
        s.set("hasExtra", u || h || i.i(a.a)().debug3d || i.i(r.a)() || !i.i(a.a)().vrStereo)
    };
    s.setHotspot = function(t) {
        h = t,
        c()
    }
    ,
    s.setWireframe = function(t) {
        u = t,
        c()
    }
    ,
    c(),
    e.a = s
}
, , , function(t, e, i) {
    i(49),
    i(39),
    i(338),
    i(50),
    i(387),
    function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/viewer.jinja"] = function() {
            function t(t, e, n, r, a) {
                var s = null
                  , o = null
                  , l = "";
                try {
                    var u = null;
                    t.getTemplate("skfb_front/macros/buttons.jinja", !1, "skfb_front/macros/viewer.jinja", !1, function(h, c) {
                        if (h)
                            return void a(h);
                        c.getExported(function(h, c) {
                            if (h)
                                return void a(h);
                            if (!c.hasOwnProperty("star_like_button"))
                                return void a(new Error("cannot import 'star_like_button'"));
                            var d = c.star_like_button;
                            e.setVariable("star_like_button", d),
                            l += "\n",
                            t.getTemplate("skfb_front/macros/model.jinja", !1, "skfb_front/macros/viewer.jinja", !1, function(h, c) {
                                if (h)
                                    return void a(h);
                                c.getExported(function(h, c) {
                                    if (h)
                                        return void a(h);
                                    if (!c.hasOwnProperty("model_name"))
                                        return void a(new Error("cannot import 'model_name'"));
                                    var d = c.model_name;
                                    e.setVariable("model_name", d),
                                    l += "\n",
                                    t.getTemplate("skfb_front/macros/popovers.jinja", !1, "skfb_front/macros/viewer.jinja", !1, function(h, c) {
                                        if (h)
                                            return void a(h);
                                        c.getExported(function(h, c) {
                                            if (h)
                                                return void a(h);
                                            if (!c.hasOwnProperty("share_popover"))
                                                return void a(new Error("cannot import 'share_popover'"));
                                            var d = c.share_popover;
                                            e.setVariable("share_popover", d),
                                            l += "\n",
                                            t.getTemplate("skfb_front/macros/user.jinja", !1, "skfb_front/macros/viewer.jinja", !1, function(h, c) {
                                                if (h)
                                                    return void a(h);
                                                c.getExported(function(h, c) {
                                                    if (h)
                                                        return void a(h);
                                                    if (!c.hasOwnProperty("user_name"))
                                                        return void a(new Error("cannot import 'user_name'"));
                                                    var d = c.user_name;
                                                    e.setVariable("user_name", d),
                                                    l += "\n",
                                                    t.getTemplate("skfb_front/macros/user.jinja", !1, "skfb_front/macros/viewer.jinja", !1, function(h, c) {
                                                        if (h)
                                                            return void a(h);
                                                        c.getExported(function(h, c) {
                                                            if (h)
                                                                return void a(h);
                                                            if (!c.hasOwnProperty("user_avatar"))
                                                                return void a(new Error("cannot import 'user_avatar'"));
                                                            var d = c.user_avatar;
                                                            e.setVariable("user_avatar", d),
                                                            l += "\n",
                                                            t.getTemplate("skfb_front/macros/logo.jinja", !1, "skfb_front/macros/viewer.jinja", !1, function(h, c) {
                                                                if (h)
                                                                    return void a(h);
                                                                c.getExported(function(h, c) {
                                                                    if (h)
                                                                        return void a(h);
                                                                    if (!c.hasOwnProperty("logo"))
                                                                        return void a(new Error("cannot import 'logo'"));
                                                                    var d = c.logo;
                                                                    e.setVariable("logo", d),
                                                                    l += "\n\n\n";
                                                                    var p = r.makeMacro(["authUser", "model"], ["options"], function(i, a, l) {
                                                                        var u = n;
                                                                        n = new r.Frame,
                                                                        l = l || {},
                                                                        l.hasOwnProperty("caller") && n.set("caller", l.caller),
                                                                        n.set("authUser", i),
                                                                        n.set("model", a),
                                                                        n.set("options", l.hasOwnProperty("options") ? l.options : {});
                                                                        var h = "";
                                                                        return h += '\n\n    <div class="titlebar">\n\n        <div class="summary">\n            ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showInfos") && (h += '\n                <div class="avatar">\n                    <a target="_blank" href="/models/',
                                                                        h += r.suppressValue(r.memberLookup(a, "uid"), t.opts.autoescape),
                                                                        h += '">',
                                                                        h += r.suppressValue((s = 15,
                                                                        o = 78,
                                                                        r.callWrap(r.contextOrFrameLookup(e, n, "user_avatar"), "user_avatar", e, [r.memberLookup(r.memberLookup(a, "user"), "avatars"), {
                                                                            size: 32
                                                                        }])), t.opts.autoescape),
                                                                        h += '</a>\n                </div>\n                <div class="model-info">\n                    <h1 class="title">',
                                                                        h += r.suppressValue((s = 18,
                                                                        o = 49,
                                                                        r.callWrap(r.contextOrFrameLookup(e, n, "model_name"), "model_name", e, [i, a, {
                                                                            target: "_blank",
                                                                            withRestrictedFlag: !1
                                                                        }])), t.opts.autoescape),
                                                                        h += '</h1>\n                    <h2>by <a target="_blank" href="/models/',
                                                                        h += r.suppressValue(r.memberLookup(a, "uid"), t.opts.autoescape),
                                                                        h += '">',
                                                                        h += r.suppressValue(r.memberLookup(r.memberLookup(a, "user"), "displayName"), t.opts.autoescape),
                                                                        h += "</a></h2>\n                </div>\n            "),
                                                                        h += '\n        </div>\n\n        <div class="actions">\n\n            ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showInfos") && (h += '\n                <a class="help tooltip tooltip-down share" data-title="Share" data-action="open-share-overlay">\n                    <i class="custom-icons icon-ion-android-share-alt-icon"></i>\n                </a>\n            '),
                                                                        h += "\n\n            ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "allowStops") && (h += '\n                <a class="help tooltip tooltip-down close hidden" data-title="Stop" data-action="stop">\n                    <i class="custom-icons icon-ion-close-round-icon"></i>\n                </a>\n            '),
                                                                        h += "\n\n        </div>\n\n    </div>\n\n",
                                                                        n = u,
                                                                        new r.SafeString(h)
                                                                    });
                                                                    e.addExport("viewer_infos"),
                                                                    e.setVariable("viewer_infos", p),
                                                                    l += "\n\n";
                                                                    var f = r.makeMacro(["authUser", "model"], ["options"], function(i, a, l) {
                                                                        var u = n;
                                                                        n = new r.Frame,
                                                                        l = l || {},
                                                                        l.hasOwnProperty("caller") && n.set("caller", l.caller),
                                                                        n.set("authUser", i),
                                                                        n.set("model", a),
                                                                        n.set("options", l.hasOwnProperty("options") ? l.options : {});
                                                                        var h = "";
                                                                        return h += "\n\n    ",
                                                                        r.memberLookup(a, "isDeleted") ? h += '\n        <div class="viewer">\n            <div class="osd active">\n                <div class="content">\n                    <div class="panel">\n                        <p>This model has been deleted</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ' : r.memberLookup(a, "isPublished") || r.memberLookup(r.memberLookup(a, "user"), "uid") == r.memberLookup(i, "uid") || r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "sharedDraft") ? (h += "\n        ",
                                                                        h += r.suppressValue((s = 57,
                                                                        o = 20,
                                                                        r.callWrap(r.contextOrFrameLookup(e, n, "show_viewer"), "show_viewer", e, [i, a, r.contextOrFrameLookup(e, n, "options")])), t.opts.autoescape),
                                                                        h += "\n    ") : h += '\n        <div class="viewer">\n            <div class="osd active">\n                <div class="content">\n                    <div class="panel">\n                        <p>This model has not been published yet</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',
                                                                        h += "\n\n",
                                                                        n = u,
                                                                        new r.SafeString(h)
                                                                    });
                                                                    e.addExport("viewer"),
                                                                    e.setVariable("viewer", f),
                                                                    l += "\n\n";
                                                                    var g = r.makeMacro(["authUser", "model"], ["options"], function(a, l, u) {
                                                                        var h = n;
                                                                        n = new r.Frame,
                                                                        u = u || {},
                                                                        u.hasOwnProperty("caller") && n.set("caller", u.caller),
                                                                        n.set("authUser", a),
                                                                        n.set("model", l),
                                                                        n.set("options", u.hasOwnProperty("options") ? u.options : {});
                                                                        var c = "";
                                                                        return c += '\n\n    <div class="viewer has-model ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "transparent") && (c += " transparent"),
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "isStarted") && (c += " started"),
                                                                        c += '">\n\n        ',
                                                                        c += r.suppressValue((s = 76,
                                                                        o = 21,
                                                                        r.callWrap(r.contextOrFrameLookup(e, n, "viewer_infos"), "viewer_infos", e, [a, l, r.contextOrFrameLookup(e, n, "options")])), t.opts.autoescape),
                                                                        c += '\n\n        <div class="landing" data-action="start">\n\n            <div class="preview">\n                ',
                                                                        c += r.suppressValue(t.getFilter("image_container").call(e, r.memberLookup(l, "thumbnails"), 1024, 768, !0, !0), t.opts.autoescape),
                                                                        c += '\n            </div>\n\n            <div class="start-button">\n                <button class="play">\n                    <i class="fa fa-play"></i>\n                    <span class="label">3D</span>\n                </button>\n            </div>\n\n            ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showWatermark") && (c += '\n                <div class="watermark">\n                    <a data-action="watermark" href="',
                                                                        c += r.suppressValue(r.memberLookup(l, "viewerUrl"), t.opts.autoescape),
                                                                        c += '" title="View on Sketchfab" target="_blank"></a>\n                </div>\n            '),
                                                                        c += '\n\n        </div>\n\n        <div class="overlays">\n            ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "restricted") && (c += '\n                <div class="overlay restricted">\n                    <div>\n                        <h3 class="heading">Age-restricted content</h3>\n                        <p>\n                            This 3D scene contains age-restricted content.<br/>\n                            You need to enable age-restricted content to view this.\n                        </p>\n                        <button type="submit" class="button btn-input btn-primary submit" data-action="allowRestricted">Enable age-restricted content</button>\n                        ',
                                                                        c += r.suppressValue((s = 109,
                                                                        o = 29,
                                                                        r.callWrap(r.contextOrFrameLookup(e, n, "logo"), "logo", e, [121, 25, {
                                                                            color: "#ffffff"
                                                                        }])), t.opts.autoescape),
                                                                        c += "\n                    </div>\n                </div>\n            "),
                                                                        c += '\n            <div class="overlay help hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <ul class="tabs">\n                        <li class="active"><a href="#" data-target="basic">Navigation basics</a></li>\n                        <li><a href="#" data-target="all">All controls</a></li>\n                    </ul>\n                    <div class="tabs-container">\n                        <div class="tab active" data-tab="basic">\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-refresh"></i>\n                                </div>\n                                <div>\n                                    <b>Orbit around</b>\n                                    <div>\n                                        Left click + drag or<br>\n                                        One finger drag (touch)\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-search-plus"></i>\n                                </div>\n                                <div>\n                                    <b>Zoom</b>\n                                    <div>\n                                        Double click on model<br>\n                                        or scroll anywhere or<br>\n                                        Pinch (touch)\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-arrows"></i>\n                                </div>\n                                <div>\n                                    <b>Pan</b>\n                                    <div>\n                                        Right click + drag or<br />\n                                        Two fingers drag (touch)\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="tab" data-tab="all">\n                            <div>\n                                <div class="section">\n                                    <h2>Orbit navigation</h2>\n                                    <b>Move camera:</b> 1 finger drag or Left Mouse Button<br>\n                                    <b>Pan:</b> 2-finger drag or Right Mouse Button or <kbd>SHIFT</kbd>+ Left Mouse Button<br>\n                                    <b>Zoom on object:</b> Double-tap or Double-click on object<br>\n                                    <b>Zoom out:</b> Double-tap or Double-click on background<br>\n                                    <b>Zoom:</b> Pinch in/out or Mousewheel or <kbd>CTRL</kbd> + Left Mouse Button<br>\n                                </div>\n                                <div class="section">\n                                    <h2>First-person navigation</h2>\n                                    <b>Move:</b> <kbd></kbd>,<kbd></kbd>,<kbd></kbd>,<kbd></kbd> (or <kbd>W</kbd>,<kbd>A</kbd>,<kbd>S</kbd>,<kbd>D</kbd>)<br>\n                                    <b>Look around:</b> 1-finger drag or Left Mouse Button<br>\n                                    <b>Adjust speed:</b> Mousewheel<br>\n                                </div>\n                                <div class="section rendering-shortcuts"></div>\n                                <div class="section">\n                                    <h2>Lighting</h2>\n                                    <b>Rotate lighting:</b> 3-finger drag or <kbd>ALT</kbd> + Left Mouse Button<br>\n                                    <b>Rotate env. only:</b> <kbd>ALT</kbd> + <kbd>SHIFT</kbd> + Left Mouse Button<br>\n                                </div>\n                                <div class="section annotation-shortcuts"></div>\n                                <div class="section animation-shortcuts"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="action">\n                        <button class="button" data-action="reset-camera">Reset camera view</button>\n                    </div>\n\n                </div>\n            </div>\n            <div class="overlay share hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <div class="share-link">\n                        <div class="text-field">\n                            <label>Link</label>\n                            <input type="text" class="text" value="" readonly>\n                            <button data-clipboard-target=".text-field .text">copy</button>\n                        </div>\n                    </div>\n                    <div class="share-social">\n                        <a data-action="share-on-facebook" target="_blank"><i class="fa fa-facebook"></i></a>\n                        <a data-action="share-on-twitter" target="_blank"><i class="fa fa-twitter"></i></a>\n                        <a data-action="share-on-reddit" target="_blank"><i class="fa fa-reddit"></i></a>\n                        <a data-action="share-on-tumblr" target="_blank"><i class="fa fa-tumblr"></i></a>\n                        <a data-action="share-on-google-plus" target="_blank"><i class="fa fa-google-plus"></i></a>\n                        <a data-action="share-on-linkedin" target="_blank"><i class="fa fa-linkedin"></i></a>\n                        <a data-action="share-on-pinterest" target="_blank"><i class="fa fa-pinterest"></i></a>\n                        <a class="share-mail" target="_blank"><i class="fa fa-envelope"></i></a>\n                    </div>\n                    <div class="share-embed">\n                        <a class="button" href="" target="_blank">\n                            <i class="fa fa-code"></i> Embed\n                        </a>\n                    </div>\n                </div>\n            </div>\n            <div class="overlay hotspots-overlay hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <h4 class="hotspot-title"></h4>\n                    <div class="hotspot-content markdown-rendered-content"></div>\n                </div>\n            </div>\n            <div class="overlay helper-vr-overlay hidden">\n                <i class="custom-icons icon-ion-close-round-icon close"></i>\n                <div class="inner custom-scrollbar">\n                     <div class="header-helper">\n                        To view this model in virtual reality:\n                    </div>\n                    <div class="content-helper">\n                        <div class="row-helper">\n                            <div class="content-row">\n                                <div class="image"><i class="fa fa-mobile"></i></div>\n                                <div class="text">\n                                    <div class="title">on mobile phone</div>\n                                    <div>with Cardboard or similar</div>\n                                </div>\n                            </div>\n                            <ul class="info">\n                                <li>On your mobile, open this link: <a class="url" target="_blank" href="#"></a></li>\n                                <li>Press the VR icon</li>\n                                <li>Insert your mobile in a Cardboard headset</li>\n                            </ul>\n                        </div>\n                        <div class="row-helper">\n                            <div class="content-row">\n                                <div class="image"><i class="fa fa-desktop"></i></div>\n                                <div class="text">\n                                    <div class="title">on desktop PC <span class="flag-info">BETA</span></div>\n                                    <div>with a VR headset</div>\n                                </div>\n                            </div>\n                            <ul class="info">\n                                <li><a target="_blank" href="https://webvr.info/">Get a WebVR-compatible browser</a></li>\n                                <li>Enable WebVR</li>\n                                <li>Open this model</li>\n                                <li>Click on the VR icon</li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div class="footer-helper">\n                        <a target="_blank" href="https://help.sketchfab.com/hc/en-us/articles/204777439-Mobile-VR-and-Desktop-WebVR?utm_source=website&amp;utm_campaign=vr_hints">\n                        More info on Virtual reality.\n                        </a>\n                    </div>\n                </div>\n            </div>\n            <div class="overlay sound-credits-overlay hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="content">\n                    <div>\n                        <a href="https://soundcloud.com" target="_blank">\n                            <img src="',
                                                                        c += r.suppressValue(i(591), t.opts.autoescape),
                                                                        c += '" width="64"/>\n                        </a>\n                    </div>\n                    <div class="tracks"></div>\n                </div>\n            </div>\n        </div>\n\n        <div class="webgl">\n\n            <canvas class="canvas" data-modelUid="',
                                                                        c += r.suppressValue(r.memberLookup(l, "uid"), t.opts.autoescape),
                                                                        c += '" data-action="create-hotspot">\n            </canvas>\n\n            <div class="loading-container">\n                <div class="secondary-progress">\n                    <div class="secondary-progress-percentage"></div>\n                    <div class="secondary-progress-display"></div>\n                </div>\n                <div class="main-progress">\n                    <img src="',
                                                                        c += r.suppressValue(t.getFilter("best_fit").call(e, r.memberLookup(l, "thumbnails"), 64, 36), t.opts.autoescape),
                                                                        c += '" class="loading-thumbnail" />\n                    <div class="main-progress-wrapper">\n                        <div class="main-progress-percentage loading-percentage">0%</div>\n                        <p>Loading 3D model</p>\n                        <progress class="main-progress-display" value="0" max="1"></progress>\n                    </div>\n                </div>\n            </div>\n\n            <div class="hotspots"></div>\n\n            <div class="gui">\n\n                <div class="animation-not-supported hidden">\n                    <a href="#" class="close"></a>\n                    <p>Model is too heavy for your device and can not be rendered properly</p>\n                </div>\n\n                ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showControls") && r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showAnnotations") && (c += '\n                    <div class="hotspot-controls-responsive">\n                        <div data-title="Previous Annotation" data-action="prev-annotation">\n                            <div class="icon fa fa-caret-left"></div>\n                        </div>\n                        <div data-title="Next Annotation" data-action="next-annotation">\n                            <div class="icon fa fa-caret-right"></div>\n                        </div>\n                    </div>\n                '),
                                                                        c += '\n\n                <div class="controls">\n\n                    ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showWatermark") && (c += '\n                        <div class="watermark">\n                            <a data-action="watermark" href="',
                                                                        c += r.suppressValue(r.memberLookup(l, "viewerUrl"), t.opts.autoescape),
                                                                        c += '" title="View on Sketchfab" target="_blank"></a>\n                        </div>\n                    '),
                                                                        c += "\n\n                    ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showControls") && (c += "\n\n                        ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showAnimations") && (c += '\n                            <div class="animation-controls widget ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "allowUiFadeout") || (c += "no-fadeout"),
                                                                        c += '">\n                                <div class="timeline">\n                                    <div class="timeline-wrapper">\n                                        <div class="track">\n                                            <div class="bar">\n                                            </div>\n                                            <div class="knob">\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <a href="#" class="control play fa"></a>\n                                <a href="#" class="control next fa"></a>\n                                <div class="animation-timer control progress help" data-unit="time">00:00.00</div>\n                                <div class="animation-list control has-menu">\n                                    <p class="animation-name"></p>\n                                    <div class="control-menu list">\n                                        <p class="static-pose animation-item" data-uid="-1">Static Pose</p>\n                                        <ul></ul>\n                                    </div>\n                                </div>\n                            </div>\n                        '),
                                                                        c += "\n\n                        ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showAnnotations") && (c += '\n                            <div class="hotspot-controls widget ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "allowUiFadeout") || (c += "no-fadeout"),
                                                                        c += '">\n\n                                <div data-title="Previous Annotation" data-action="prev-annotation">\n                                    <div class="icon fa fa-caret-left"></div>\n                                </div>\n\n                                <div class="hotspot-name default has-menu" data-action="toggle-annotation-list">\n                                    Select an annotation\n                                </div>\n\n                                <div data-title="Next Annotation" data-action="next-annotation">\n                                    <div class="icon fa fa-caret-right"></div>\n                                </div>\n\n                                <div class="list hotspots-list has-menu"></div>\n\n                            </div>\n                        '),
                                                                        c += '\n\n                        <div class="spacer"></div>\n\n                        ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showGeneralControls") && (c += '\n                            <div class="general-controls widget ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "allowUiFadeout") || (c += "no-fadeout"),
                                                                        c += '">\n\n                                ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showHelp") && (c += '\n                                    <a class="control tooltip help" data-title="Help">\n                                        <i class="fa fa-question"></i>\n                                    </a>\n                                '),
                                                                        c += "\n                                ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showSound") && (c += '\n                                    <a class="control volume" title="Volume (M)" draggable="false">\n                                        <i class="fa fa-volume-up"></i>\n                                        <div class="volume-menu">\n                                        </div>\n                                    </a>\n                                '),
                                                                        c += "\n                                ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showSettings") && (c += '\n                                    <a class="control tooltip settings has-menu" data-title="Settings">\n                                        <i class="fa fa-gear"></i>\n                                        <div class="control-menu settings-menu">\n                                            <div class="control-menu-wrapper">\n                                                <div class="control-menu-list"></div>\n                                                <div class="control-menu-pane"></div>\n                                            </div>\n                                        </div>\n                                        <span class="control-badge"></span>\n                                    </a>\n                                '),
                                                                        c += "\n                                ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showVr") && (c += '\n                                    <a class="control tooltip vr ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showTheatre") || r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showFullScreen") || (c += "tooltip-right-bound"),
                                                                        c += '" data-title="View in VR">\n                                        <i class="custom-icons icon-vr-icon"></i>\n                                    </a>\n                                '),
                                                                        c += "\n                                ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showTheatre") && (c += '\n                                    <a class="control tooltip theatre" data-title="Theater Mode">\n                                        <i class="custom-icons icon-theater-icon"></i>\n                                    </a>\n                                '),
                                                                        c += "\n                                ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showFullScreen") && (c += '\n                                    <a class="control tooltip tooltip-right-bound fullscreen" data-title="Fullscreen">\n                                        <i class="custom-icons icon-fullscreen-icon"></i>\n                                    </a>\n                                '),
                                                                        c += "\n                            </div>\n                        "),
                                                                        c += "\n                    "),
                                                                        c += "\n                </div>\n\n                ",
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "allowSnapshots") && (c += '\n                    <div class="snapshot-guides">\n                    </div>\n                    <div class="snapshot widget">\n                        <a class="button help">\n                            <span class="normal"><i class="icon fa fa-camera"></i> Save view</span>\n                            <span class="progress"><i class="icon fa fa-camera"></i> Saving&hellip;</span>\n                            <span class="success"><i class="icon fa fa-check"></i>Saved</span>\n                            <div class="tooltip tooltip-right">Save thumbnail and initial camera view</div>\n                        </a>\n                        <div class="img-container invisible"></div>\n                    </div>\n                    <div class="snapshot-flash">\n                    </div>\n                '),
                                                                        c += '\n\n                <div class="viewer-hint widget disabled">\n                    <div class="viewer-movehint">\n                        <i class="icon"></i>\n                        <span class="label">\n                            click &amp; hold<br>\n                            to rotate\n                        </span>\n                    </div>\n                </div>\n\n            </div>\n\n        </div>\n\n        <div class="osd widget">\n            <div class="osd-content">\n            </div>\n        </div>\n\n        <div class="fallback" style="display: none">\n\n            <div class="fallback-viewport">\n                <img src="" alt="" class="fallback-sprite">\n            </div>\n\n            <div class="fallback-warning">\n                <div class="inner">\n                    For compatibility reasons, 3D is not available (<a href="https://help.sketchfab.com/hc/en-us/articles/203059088-Compatibility?utm_source=website&amp;utm_campaign=error_fallback" target="_blank">see requirements</a>).<br>\n                    You are seeing a 360&deg; image instead.\n                </div>\n            </div>\n\n            <div class="fallback-error fallback-error-loading">\n                <div class="inner">\n                    <p>Connection error. Please try again.</p>\n                </div>\n            </div>\n\n            <div class="fallback-error fallback-error-nofallback">\n                <div class="inner">\n                    <p>Sorry, the model can\'t be displayed.</p>\n                    <p>Please check out <a href="https://help.sketchfab.com/hc/en-us/articles/203059088-Compatibility?utm_source=website&utm_campaign=error_fallback" target="_blank">our FAQ</a> to learn how to fix this issue.</p>\n                </div>\n            </div>\n\n            <div class="progress-bar">\n                <div class="progress-bar-percentage"></div>\n                <div class="progress-bar-display"></div>\n            </div>\n\n            <div class="progress-circle">\n                <div class="progress-circle-percentage loading-percentage"></div>\n                <svg class="progress-circle-display" version="1.1">\n                    <path class="progress-circle-path" fill="none" stroke="#1caad9" stroke-width="6" />\n                </svg>\n            </div>\n\n            ',
                                                                        r.memberLookup(r.contextOrFrameLookup(e, n, "options"), "showControls") && (c += '\n                <div class="controls">\n                    <div class="control control-fullscreen fullscreen" data-title="Toggle Fullscreen" data-action="fullscreen">\n                        <div class="icon custom-icons icon-fullscreen-icon"></div>\n                    </div>\n                </div>\n            '),
                                                                        c += "\n\n        </div>\n\n    </div>\n\n",
                                                                        n = h,
                                                                        new r.SafeString(c)
                                                                    });
                                                                    e.addExport("show_viewer"),
                                                                    e.setVariable("show_viewer", g),
                                                                    l += "\n\n";
                                                                    var m = r.makeMacro(["mode"], [], function(t, e) {
                                                                        var i = n;
                                                                        n = new r.Frame,
                                                                        e = e || {},
                                                                        e.hasOwnProperty("caller") && n.set("caller", e.caller),
                                                                        n.set("mode", t);
                                                                        var a = "";
                                                                        return a += "\n\n    ",
                                                                        "orbit" == t && (a += '\n\n        <div class="viewer-mode-help">\n            <h2>Orbit mode</h2>\n            <ul class="help-shortcuts">\n                <li class="mouse-left">Rotate</li>\n                <li class="mouse-wheel">Zoom <small class="hint">also works with CTRL+left click</small></li>\n                <li class="mouse-right">Pan <small class="hint">also works with SHIFT+left click</small></li>\n            </ul>\n        </div>\n\n    '),
                                                                        a += "\n\n    ",
                                                                        "fps" == t && (a += '\n\n        <div class="viewer-mode-help">\n            <h2>First person mode</h2>\n            <ul class="help-shortcuts">\n                <li class="mouse-left">Look around</li>\n                <li class="mouse-wheel">Walking speed</li>\n                <li class="kbd-wasd">Walk <small class="hint">also works with arrows or Z,Q,S,D</small></li>\n            </ul>\n        </div\n\n    '),
                                                                        a += "\n\n",
                                                                        n = i,
                                                                        new r.SafeString(a)
                                                                    });
                                                                    e.addExport("help_viewer_mode"),
                                                                    e.setVariable("help_viewer_mode", m),
                                                                    l += "\n\n";
                                                                    var v = r.makeMacro(["hotspots"], [], function(i, a) {
                                                                        var s = n;
                                                                        n = new r.Frame,
                                                                        a = a || {},
                                                                        a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                                        n.set("hotspots", i);
                                                                        var o = "";
                                                                        o += '\n<a href="#" data-action="toggle-autopilot" class="stopped"></a>\n<ul>\n    ',
                                                                        n = n.push();
                                                                        var l = i;
                                                                        if (l)
                                                                            for (var u = l.length, h = 0; h < l.length; h++) {
                                                                                var c = l[h];
                                                                                n.set("hotspot", c),
                                                                                n.set("loop.index", h + 1),
                                                                                n.set("loop.index0", h),
                                                                                n.set("loop.revindex", u - h),
                                                                                n.set("loop.revindex0", u - h - 1),
                                                                                n.set("loop.first", 0 === h),
                                                                                n.set("loop.last", h === u - 1),
                                                                                n.set("loop.length", u),
                                                                                o += '\n        <li class="link"><a data-hotspot-target="',
                                                                                o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "loop"), "index0"), t.opts.autoescape),
                                                                                o += '" title="',
                                                                                o += r.suppressValue(r.memberLookup(c, "name"), t.opts.autoescape),
                                                                                o += '"><span class="index">',
                                                                                o += r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e, n, "loop"), "index"), t.opts.autoescape),
                                                                                o += "</span> ",
                                                                                o += r.suppressValue(r.memberLookup(c, "name"), t.opts.autoescape),
                                                                                o += "</a></li>\n    "
                                                                            }
                                                                        return n = n.pop(),
                                                                        o += "\n</ul>\n",
                                                                        n = s,
                                                                        new r.SafeString(o)
                                                                    });
                                                                    e.addExport("hotspots_list"),
                                                                    e.setVariable("hotspots_list", v),
                                                                    l += "\n\n";
                                                                    var _ = r.makeMacro(["hasFullscreen"], [], function(e, a) {
                                                                        var s = n;
                                                                        n = new r.Frame,
                                                                        a = a || {},
                                                                        a.hasOwnProperty("caller") && n.set("caller", a.caller),
                                                                        n.set("hasFullscreen", e);
                                                                        var o = "";
                                                                        return o += '\n\n    <div class="vr-mode-help">\n        ',
                                                                        o += '\n        <img src="',
                                                                        o += r.suppressValue(i(592), t.opts.autoescape),
                                                                        o += '" width="96" height="116" alt="Place your landscape oriented phone in front of lenses">\n\n        <p>\n            ',
                                                                        o += e ? '\n                <button class="button btn-textified" data-action="fullscreen">Switch to fullscreen</button><br>\n                then place your phone into your Cardboard viewer\n            ' : "\n                Place your phone into your Cardboard viewer\n            ",
                                                                        o += "\n        </p>\n    </div>\n\n",
                                                                        n = s,
                                                                        new r.SafeString(o)
                                                                    });
                                                                    e.addExport("help_vr_mode"),
                                                                    e.setVariable("help_vr_mode", _),
                                                                    l += "\n",
                                                                    u ? u.rootRenderFunc(t, e, n, r, a) : a(null, l)
                                                                })
                                                            })
                                                        })
                                                    })
                                                })
                                            })
                                        })
                                    })
                                })
                            })
                        })
                    })
                } catch (t) {
                    a(r.handleError(t, s, o))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, , , , , , function(t, e, i) {
    "use strict";
    var n = function() {
        n.prototype.reset.call(this)
    };
    n.prototype = {
        reset: function() {
            this._computeNearFar = !0,
            this._nearFarRatio = .005,
            this.bbCornerFar = 3,
            this.bbCornerNear = 4,
            this._enableFrustumCulling = !1,
            this._settingsSourceOverrider = this,
            this._LODScale = 1,
            this._clampProjectionMatrixCallback = void 0
        },
        setCullSettings: function(t) {
            this._computeNearFar = t._computeNearFar,
            this._nearFarRatio = t._nearFarRatio,
            this._enableFrustumCulling = t._enableFrustumCulling,
            this._settingsSourceOverrider = t._settingsSourceOverrider,
            this._clampProjectionMatrixCallback = t._clampProjectionMatrixCallback
        },
        setNearFarRatio: function(t) {
            this._nearFarRatio = t
        },
        getNearFarRatio: function() {
            return this._nearFarRatio
        },
        setComputeNearFar: function(t) {
            this._computeNearFar = t
        },
        getComputeNearFar: function() {
            return this._computeNearFar
        },
        setEnableFrustumCulling: function(t) {
            this._enableFrustumCulling = t
        },
        getEnableFrustumCulling: function() {
            return this._enableFrustumCulling
        },
        getSettingSourceOverrider: function() {
            return this._settingsSourceOverrider
        },
        setClampProjectionMatrixCallback: function(t) {
            this._clampProjectionMatrixCallback = t
        },
        getClampProjectionMatrixCallback: function() {
            return this._clampProjectionMatrixCallback
        },
        setLODScale: function(t) {
            this._LODScale = t
        },
        getLODScale: function() {
            return this._LODScale
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = (i(28),
    i(13))
      , r = i(85)
      , a = window.ImageBitmap || function() {}
      , s = function(t) {
        r.call(this),
        this._imageObject = void 0,
        this._url = void 0,
        this._width = void 0,
        this._height = void 0,
        this._dirty = !0,
        this._mipmap = [],
        t && this.setImage(t),
        this._isGreyscale = void 0
    };
    s.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        dirty: function() {
            this._isGreyscale = void 0,
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        },
        setDirty: function(t) {
            this._dirty = t
        },
        getImage: function() {
            return this._imageObject instanceof s ? this._imageObject.getImage() : this._imageObject
        },
        getURL: function() {
            return this._url
        },
        setURL: function(t) {
            this._url = t
        },
        useOrCreateImage: function(t) {
            return t instanceof s == !1 ? new s(t) : t
        },
        setImage: function(t) {
            if (!this._url && t && (t.src || t.currentSrc) && (this._url = t.src || t.currentSrc),
            this._mipmap.length = 0,
            Array.isArray(t)) {
                for (var e = 0, i = t.length; e < i; e++)
                    this._mipmap.push(this.useOrCreateImage(t[e]));
                this.setWidth(this._mipmap[0].getWidth()),
                this.setHeight(this._mipmap[0].getHeight())
            } else
                this._mipmap.push(t);
            this._imageObject = this._mipmap[0],
            this.dirty()
        },
        isCanvas: function() {
            return this.getImage()instanceof window.HTMLCanvasElement
        },
        isBitmap: function() {
            return this.getImage()instanceof a
        },
        isVideo: function() {
            return this.getImage()instanceof window.HTMLVideoElement
        },
        isImage: function() {
            return this.getImage()instanceof window.Image
        },
        isTypedArray: function() {
            var t = this.getImage();
            return t instanceof Uint8Array || t instanceof Float32Array || t instanceof Uint16Array
        },
        setWidth: function(t) {
            this._width = t
        },
        setHeight: function(t) {
            this._height = t
        },
        getWidth: function() {
            var t = this.getImage();
            return this.isImage() ? t.naturalWidth : this.isVideo() ? t.videoWidth : this.isCanvas() || this.isBitmap() ? t.width : this._width
        },
        getHeight: function() {
            var t = this.getImage();
            return this.isImage() ? t.naturalHeight : this.isVideo() ? t.videoHeight : this.isCanvas() || this.isBitmap() ? t.height : this._height
        },
        isGreyscale: function(t) {
            if (void 0 !== this._isGreyscale)
                return this._isGreyscale;
            if (void 0 !== this._imageObject && this.isReady() && void 0 === this._isGreyscale) {
                var e = this._imageObject;
                this.isCanvas() || (e = document.createElement("canvas"));
                var i = e.getContext("2d");
                e.width = this._imageObject.width,
                e.height = this._imageObject.height,
                i.drawImage(this._imageObject, 0, 0);
                var n, r;
                t || (n = e.width,
                r = e.height),
                t > 0 && (t = Math.min(Math.min(e.width, e.height), t),
                n = r = t);
                for (var a = !0, s = e.width / n, o = e.height / r, l = 0; l < n; l++)
                    for (var u = 0; u < r; u++) {
                        var h = Math.floor(s * (l + .5))
                          , c = Math.floor(o * (u + .5))
                          , d = i.getImageData(h, c, 1, 1).data;
                        if (d[0] !== d[1] || d[0] !== d[2]) {
                            a = !1;
                            break
                        }
                    }
                this._isGreyscale = a
            }
            return this._isGreyscale
        },
        isReady: function() {
            if (this._imageObject && this._imageObject instanceof s)
                return this._imageObject.isReady();
            if (this.isCanvas() || this.isTypedArray() || this.isBitmap())
                return !0;
            if (this.isImage()) {
                var t = this.getImage();
                if (t.complete)
                    return void 0 === t.naturalWidth || 0 !== t.naturalWidth
            }
            if (this.isVideo() && 0 !== this.getWidth())
                return !0;
            var e = this.getImage();
            return !!e.complete && (void 0 === e.naturalWidth || 0 !== e.naturalWidth)
        },
        getMipmap: function() {
            return this._mipmap
        },
        hasMipmap: function() {
            return this._mipmap.length > 1
        },
        release: function() {
            this._mipmap.length = 0,
            this._imageObject = void 0
        }
    }), "osg", "Image"),
    n.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = i(81)
      , s = i(5).mat4
      , o = i(5).vec3
      , l = i(5).vec4
      , u = function(t, e) {
        r.call(this);
        var i = void 0 !== t ? t : 0;
        this._ambient = l.fromValues(.2, .2, .2, 1),
        this._diffuse = l.fromValues(.8, .8, .8, 1),
        this._specular = l.fromValues(.2, .2, .2, 1),
        this._position = l.fromValues(0, 0, 1, 0),
        this._direction = o.fromValues(0, 0, -1),
        this._ground = l.fromValues(.2, .2, .2, -1),
        this._spotCutoff = 180,
        this._spotBlend = .01,
        this._attenuation = l.fromValues(1, 0, 0, 0),
        this._lightNumber = i,
        this._enable = !e
    };
    u.DIRECTION = "DIRECTION",
    u.SPOT = "SPOT",
    u.POINT = "POINT",
    u.HEMI = "HEMI",
    u.uniforms = {},
    u.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Light",
        cloneType: function() {
            return new u(this._lightNumber,!0)
        },
        getTypeMember: function() {
            return this.attributeType + this._lightNumber
        },
        getUniformName: function(t) {
            return "u" + (this.getType() + this._lightNumber.toString()) + "_" + t
        },
        getHash: function() {
            return this.getTypeMember() + this.getLightType() + this.isEnabled().toString()
        },
        getOrCreateUniforms: function() {
            var t = u
              , e = this.getTypeMember();
            return t.uniforms[e] ? t.uniforms[e] : (t.uniforms[e] = {
                ambient: a.createFloat4(this.getUniformName("ambient")),
                diffuse: a.createFloat4(this.getUniformName("diffuse")),
                specular: a.createFloat4(this.getUniformName("specular")),
                attenuation: a.createFloat4(this.getUniformName("attenuation")),
                position: a.createFloat4(this.getUniformName("position")),
                direction: a.createFloat3(this.getUniformName("direction")),
                spotCutOff: a.createFloat1(this.getUniformName("spotCutOff")),
                spotBlend: a.createFloat1(this.getUniformName("spotBlend")),
                ground: a.createFloat4(this.getUniformName("ground")),
                matrix: a.createMatrix4(this.getUniformName("matrix")),
                invMatrix: a.createMatrix4(this.getUniformName("invMatrix"))
            },
            t.uniforms[e])
        },
        isEnabled: function() {
            return this._enable
        },
        setEnabled: function(t) {
            this._enable = t
        },
        setAmbient: function(t) {
            l.copy(this._ambient, t)
        },
        getAmbient: function() {
            return this._ambient
        },
        setDiffuse: function(t) {
            l.copy(this._diffuse, t)
        },
        getDiffuse: function() {
            return this._diffuse
        },
        setSpecular: function(t) {
            l.copy(this._specular, t)
        },
        getSpecular: function() {
            return this._specular
        },
        setPosition: function(t) {
            l.copy(this._position, t)
        },
        getPosition: function() {
            return this._position
        },
        setDirection: function(t) {
            o.copy(this._direction, t)
        },
        getDirection: function() {
            return this._direction
        },
        setSpotCutoff: function(t) {
            this._spotCutoff = t
        },
        getSpotCutoff: function() {
            return this._spotCutoff
        },
        setSpotBlend: function(t) {
            this._spotBlend = t
        },
        getSpotBlend: function() {
            return this._spotBlend
        },
        setGround: function(t) {
            o.copy(this._ground, t)
        },
        getGround: function() {
            return this._ground
        },
        setConstantAttenuation: function(t) {
            this._attenuation[0] = t
        },
        getConstantAttenuation: function() {
            return this._attenuation[0]
        },
        setLinearAttenuation: function(t) {
            this._attenuation[1] = t
        },
        getLinearAttenuation: function() {
            return this._attenuation[1]
        },
        setQuadraticAttenuation: function(t) {
            this._attenuation[2] = t
        },
        getQuadraticAttenuation: function() {
            return this._attenuation[2]
        },
        setLightType: function(t) {
            return t === u.DIRECTION ? this.setLightAsDirection() : t === u.SPOT ? this.setLightAsSpot() : t === u.HEMI ? this.setLightAsHemi() : this.setLightAsPoint()
        },
        getLightType: function() {
            return this.isDirectionLight() ? u.DIRECTION : this.isSpotLight() ? u.SPOT : this.isHemiLight() ? u.HEMI : u.POINT
        },
        setLightAsSpot: function() {
            l.set(this._position, 0, 0, 0, 1),
            o.set(this._direction, 0, 0, -1),
            this._ground[3] = -1,
            this._spotCutoff = 90
        },
        setLightAsPoint: function() {
            l.set(this._position, 0, 0, 0, 1),
            o.set(this._direction, 0, 0, -1),
            this._ground[3] = -1
        },
        setLightAsDirection: function() {
            l.set(this._position, 0, 0, 1, 0),
            this._spotCutoff = 180,
            this._ground[3] = -1
        },
        setLightAsHemi: function() {
            l.set(this._position, 0, 0, 1, 0),
            this._spotCutoff = 180,
            this._ground[3] = 1
        },
        setLightNumber: function(t) {
            this._lightNumber = t
        },
        getLightNumber: function() {
            return this._lightNumber
        },
        isSpotLight: function() {
            return this._spotCutoff < 180
        },
        isDirectionLight: function() {
            return 0 === this._position[3] && -1 === this._ground[3]
        },
        isHemiLight: function() {
            return 1 === this._ground[3]
        },
        applyPositionedUniform: function(t) {
            var e = this.getOrCreateUniforms()
              , i = e.matrix.getInternalArray()
              , n = e.invMatrix.getInternalArray();
            s.copy(i, t),
            s.copy(n, t),
            n[12] = 0,
            n[13] = 0,
            n[14] = 0,
            s.invert(n, n),
            s.transpose(n, n)
        },
        apply: function() {
            if (this._enable) {
                var t = this.getOrCreateUniforms();
                if (t.position.setFloat4(this._position),
                this.isSpotLight()) {
                    var e = Math.cos(this._spotCutoff * Math.PI / 180);
                    t.spotCutOff.setFloat(e),
                    t.spotBlend.setFloat((1 - e) * this._spotBlend),
                    t.direction.setFloat3(this._direction)
                }
                this.isHemiLight() && t.ground.setFloat4(this._ground),
                t.attenuation.setFloat4(this._attenuation),
                t.diffuse.setFloat4(this._diffuse),
                t.specular.setFloat4(this._specular),
                t.ambient.setFloat4(this._ambient)
            }
        }
    }), "osg", "Light"),
    n.setTypeID(u),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(467)
      , r = function() {
        this.depth = 0,
        this.children = {},
        this.children.keys = [],
        this.leafs = [],
        this.stateset = void 0,
        this.parent = void 0
    };
    r.prototype = {
        clean: function() {
            this.leafs.length = 0,
            this.stateset = void 0,
            this.parent = void 0,
            this.depth = 0;
            for (var t, e, i = this.children, r = i.keys, a = 0, s = r.length; a < s; a++)
                e = r[a],
                t = i[e],
                t.clean(),
                n.memoryPools.stateGraph.put(t);
            this.children = {},
            r.length = 0,
            this.children.keys = r
        },
        getStateSet: function() {
            return this.stateset
        },
        findOrInsert: function(t) {
            var e, i = t.getInstanceID(), r = this.children;
            return r[i] ? e = r[i] : (e = n.memoryPools.stateGraph.get(),
            e.parent = this,
            e.depth = this.depth + 1,
            e.stateset = t,
            r[i] = e,
            r.keys.push(i)),
            e
        }
    },
    r.moveStateGraph = function(t, e, i) {
        var n, r, a = [], s = i, o = e;
        if (s !== o && void 0 !== s)
            if (void 0 !== o) {
                if (o.parent === s.parent)
                    return void 0 !== o.stateset && t.popStateSet(),
                    void (void 0 !== s.stateset && t.pushStateSet(s.stateset));
                for (; o.depth > s.depth; )
                    void 0 !== o.stateset && t.popStateSet(),
                    o = o.parent;
                for (a = []; s.depth > o.depth; )
                    void 0 !== s.stateset && a.push(s.stateset),
                    s = s.parent;
                for (; o !== s; )
                    void 0 !== o.stateset && t.popStateSet(),
                    o = o.parent,
                    void 0 !== s.stateset && a.push(s.stateset),
                    s = s.parent;
                for (n = a.length - 1,
                r = 0; n >= r; --n)
                    t.pushStateSet(a[n])
            } else {
                do {
                    void 0 !== s.stateset && a.push(s.stateset),
                    s = s.parent
                } while (s);for (n = a.length - 1,
                r = 0; n >= r; --n)
                    t.pushStateSet(a[n])
            }
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(13)
      , a = i(85)
      , s = i(163)
      , o = function() {
        a.call(this)
    };
    o.checkPathIsAnimated = function(t) {
        for (var e = 0, i = t.length; e < i; ++e) {
            var n = t[e];
            if (n instanceof s)
                for (var r = n.getUpdateCallbackList(), a = 0, l = r.length; a < l; ++a)
                    if (r[a]instanceof o)
                        return !0
        }
        return !1
    }
    ,
    o.prototype = r.objectInherit(a.prototype, {
        linkChannel: function() {},
        linkAnimation: function(t) {
            var e = this.getName();
            if (0 === e.length)
                return n.log("no name on an update callback, discard"),
                0;
            for (var i = 0, r = t.getChannels(), a = 0, s = r.length; a < s; a++) {
                var o = r[a];
                o.getTargetName() === e && (this.linkChannel(o),
                i++)
            }
            return i
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = {
        instance: function() {
            return r._instance || (r._instance = r,
            r._instance.plugins = new window.Map),
            r._instance
        },
        addReaderWriter: function(t, e) {
            void 0 !== r.instance().plugins.get(t) && n.warn("the '" + t + "' plugin already exists"),
            r.instance().plugins.set(t, e)
        },
        getReaderWriterForExtension: function(t) {
            return r.instance().plugins.get(t)
        }
    };
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(81)
      , a = i(647)
      , s = i(13)
      , o = i(866)
      , l = i(865)
      , u = function(t, e, i) {
        this._attributes = t,
        this._textureAttributes = e,
        this._fragmentShaderMode = !1,
        this._activeNodeList = {},
        this._compiledNodeList = {},
        this._traversedNodeList = {},
        this._variables = {},
        this._varyings = {},
        this._vertexShader = [],
        this._fragmentShader = [],
        this._shaderProcessor = i,
        this._texturesByName = {},
        this._shadowsTextures = [],
        this._lights = [],
        this._shadows = [],
        this._textures = [],
        this._material = null,
        this._invariantPosition = !1,
        this._isBillboard = !1,
        this._customVertexShader = !1,
        this._customFragmentShader = !1,
        this.initAttributes(),
        this.initTextureAttributes()
    };
    u.prototype = s.extend({}, o, l, {
        createFragmentShader: function() {
            return this._fragmentShaderMode = !0,
            this._createFragmentShader()
        },
        createVertexShader: function() {
            return this._fragmentShaderMode = !1,
            this._createVertexShader()
        },
        getOrCreateProjectionMatrix: function() {
            return this.getOrCreateUniform("mat4", "uProjectionMatrix")
        },
        getCompilerName: function() {
            return this._material ? "CompilerOSGJS" : "NoMaterialCompilerOSGJS"
        },
        getFragmentShaderName: function() {
            var t = this.getCompilerName()
              , e = this._material && this._material.getName();
            return e && (e = e.replace(/[^a-zA-Z0-9]+/g, "_").slice(0, 20),
            t += "(" + e + ")"),
            t
        },
        getVertexShaderName: function() {
            return this.getFragmentShaderName()
        },
        getDebugIdentifier: function() {
            var t = this.getVertexShaderName()
              , e = this.getFragmentShaderName();
            return t === e ? e : t + "|" + e
        },
        logError: function(t) {
            n.error(this.getDebugIdentifier() + " : " + t)
        },
        logWarn: function(t) {
            n.warn(this.getDebugIdentifier() + " : " + t)
        },
        getOrCreateConstantOne: function(t) {
            return this.getOrCreateConstant(t, t + "White").setValue(t + "(1.0)")
        },
        getOrCreateConstantZero: function(t) {
            return this.getOrCreateConstant(t, t + "Black").setValue(t + "(0.0)")
        },
        initAttributes: function() {
            for (var t = this._attributes, e = this._lights, i = this._shadows, n = 0, r = t.length; n < r; n++) {
                var a = t[n].className();
                "Light" === a ? e.push(t[n]) : "Material" === a ? this._material = t[n] : "ShadowReceiveAttribute" === a ? i.push(t[n]) : "Billboard" === a ? this._isBillboard = !!t[n] : "SkinningAttribute" === a ? this._skinningAttribute = t[n] : "MorphAttribute" === a ? this._morphAttribute = t[n] : "PointSizeAttribute" === a && (this._pointSizeAttribute = t[n])
            }
        },
        initTextureAttributes: function() {
            var t = this._textureAttributes
              , e = t.length;
            this._textures.length = this._shadowsTextures.length = e;
            for (var i = 0; i < e; i++) {
                var n = t[i];
                if (void 0 !== n)
                    for (var r = 0, a = n.length; r < a; r++)
                        this.registerTextureAttributes(n[r], i)
            }
        },
        registerTextureAttributes: function(t, e) {
            var i = t.className();
            return "Texture" === i ? this.registerTexture(t, e) : -1 !== i.indexOf("ShadowTexture") ? this.registerTextureShadow(t, e) : void 0
        },
        registerTexture: function(t, e) {
            var i = t.getName();
            i || (i = "Texture" + e,
            t.setName(i)),
            this._textures[e] = t,
            this._texturesByName[i] = {
                texture: t,
                variable: void 0,
                textureUnit: e
            }
        },
        registerTextureShadow: function(t, e) {
            var i = t.getName();
            i || (i = "Texture" + e,
            t.setName(i)),
            this._shadowsTextures[e] = t,
            this._texturesByName[i] = {
                texture: t,
                variable: void 0,
                textureUnit: e,
                shadow: !0
            }
        },
        getTextureByName: function(t) {
            var e = this._texturesByName[t];
            if (!e || e.variable)
                return e;
            var i, n = e.texture, r = e.textureUnit, a = n.className(), s = "Texture" + r;
            if ("Texture" === a)
                i = this.getOrCreateSampler("sampler2D", s);
            else {
                if ("TextureCubeMap" !== a)
                    return;
                i = this.getOrCreateSampler("samplerCube", s)
            }
            var o = this._fragmentShaderMode ? this.getOrCreateVarying("vec2", "vTexCoord" + r) : this.getOrCreateAttribute("vec2", "TexCoord" + r);
            return e.variable = this.createTextureRGBA(n, i, o),
            e
        },
        createShaderFromGraphs: function(t) {
            this._compiledNodeList = {};
            var e = [];
            for (var i in this._variables) {
                var n = this._variables[i]
                  , r = n.declare();
                r && e.push(r)
            }
            var a = this.evaluateExtensions(t)
              , s = this.evaluateDefines(t)
              , o = [];
            o.push("\n"),
            o.push(this.evaluateGlobalVariableDeclaration(t)),
            this._invariantPosition && !this._fragmentShaderMode && o.push("\ninvariant gl_Position;"),
            o.push("\n"),
            o.push(this.evaluateGlobalFunctionDeclaration(t)),
            o.push("void main() {"),
            0 !== e.length && (o.push("// vars\n"),
            o.push(e.join(" ")),
            o.push("\n// end vars\n")),
            0 === t.length && this.logError("shader without any final Node output (need at least one)"),
            o.push(this.evaluate(t)),
            o.push("}");
            var l = o.join("\n");
            return this._shaderProcessor.processShader(l, s, a, this._fragmentShaderMode ? "fragment" : "vertex")
        },
        getNode: function() {
            var t = a.getNode.apply(a, arguments)
              , e = t.getID();
            return this._activeNodeList[e] = t,
            t
        },
        getVariable: function(t) {
            return this._variables[t]
        },
        getAttributeType: function(t) {
            for (var e = 0; e < this._attributes.length; e++)
                if (this._attributes[e].getType() === t)
                    return this._attributes[e]
        },
        createVariable: function(t, e, i) {
            var n = e;
            if (void 0 === n) {
                n = "tmp_" + window.Object.keys(this._variables).length
            } else if (this._variables[n]) {
                if (n += i,
                void 0 === i)
                    return this.createVariable(t, e, 1);
                if (this._variables[n])
                    return i++,
                    this.createVariable(t, e, i)
            }
            var r = this.getNode("Variable", t, n);
            return this._variables[n] = r,
            r
        },
        getOrCreateUniformFromUniformMap: function(t, e) {
            var i = {}
              , n = e || "";
            for (var r in t) {
                i[n + r] = this.getOrCreateUniform(t[r])
            }
            return i
        },
        getOrCreateTextureStateAttributeUniforms: function(t, e, i) {
            var n = t.getOrCreateUniforms(i);
            return this.getOrCreateUniformFromUniformMap(n, e)
        },
        getOrCreateStateAttributeUniforms: function(t, e) {
            var i = t.getOrCreateUniforms();
            return this.getOrCreateUniformFromUniformMap(i, e)
        },
        getOrCreateUniform: function(t, e, i) {
            var n = e;
            if (t instanceof r) {
                var a = t;
                t = a.getType(),
                n = a.getName()
            } else
                void 0 === n && this.logError("Cannot create unamed Uniform");
            var s = this._variables[n];
            if (s && s.getType() === t)
                return s;
            var o = this.getNode("Uniform", t, n, i);
            return this._variables[n] = o,
            o
        },
        getOrCreateSampler: function(t, e) {
            void 0 === e && this.logError("No name given for sampler type : " + t);
            var i = this._variables[e];
            if (i)
                return i;
            var n = this.getNode("Sampler", t, e);
            return this._variables[e] = n,
            n
        },
        getOrCreateAttribute: function(t, e) {
            this._fragmentShaderMode && this.logError("No Vertex Attribute in Fragment Shader");
            var i = this._variables[e];
            if (i)
                return i;
            var n = this.getNode("Attribute", t, e);
            return this._variables[e] = n,
            n
        },
        getOrCreateConstant: function(t, e) {
            var i = e;
            if (void 0 === i) {
                i = "tmp_" + window.Object.keys(this._variables).length
            } else {
                var n = this._variables[i];
                if (n)
                    return n
            }
            var r = this.getNode("Constant", t, i);
            return this._variables[i] = r,
            r
        },
        getOrCreateVarying: function(t, e) {
            void 0 === e && this.logError("Error: Mandatory to name varying (as you need to retrieve them)");
            var i = this._variables[e];
            return i ? (this._varyings[e] || this.logError("Error: requesting a varying not declared with getOrCreateVarying previously"),
            i.getType() !== t && this.logError("Error: Same varying, but different type"),
            i) : (this._fragmentShaderMode || this._customFragmentShader || this.logError("Error: requesting a varying not declared in Fragment Shader Graph (for Custom Vertex Shader, add this._customFragmentShader to the processor): " + e + " " + t),
            i = this._variables[e] = this._varyings[e] = this.getNode("Varying", t, e))
        },
        markNodeAsVisited: function(t) {
            var e = t.getID();
            this._activeNodeList[e] === t ? this._compiledNodeList[e] = t : this.logWarn("Node not requested by using Compiler getNode and/or not registered in nodeFactory " + t.toString())
        },
        checkOrMarkNodeAsTraversed: function(t) {
            var e = t.getID();
            return !!this._traversedNodeList[e] || (this._traversedNodeList[e] = t,
            !1)
        },
        traverse: function(t, e) {
            if (!this.checkOrMarkNodeAsTraversed(e)) {
                var i = e.getInputs();
                if (!Array.isArray(i)) {
                    var n = [];
                    for (var r in i)
                        n.push(i[r]);
                    i = n
                }
                for (var a = 0, s = i.length; a < s; a++) {
                    e.checkInputsOutputs();
                    var o = i[a];
                    void 0 !== o && o !== e && this.traverse(t, o)
                }
                t.call(t, e),
                this.markNodeAsVisited(e)
            }
        },
        preTraverse: function(t) {
            return this._traversedNodeList = {},
            t._map = {},
            t._text = [],
            t
        },
        evaluateAndGatherField: function(t, e) {
            var i = function(t) {
                var i = t.getType();
                if (void 0 !== i && "" !== i || this.logError("Your node " + t + " has no type"),
                t[e] && void 0 === this._map[i]) {
                    this._map[i] = !0;
                    var n = t[e]();
                    Array.prototype.push.apply(this._text, n)
                }
            };
            this.preTraverse(i);
            for (var n = 0, r = t.length; n < r; n++)
                this.traverse(i, t[n]);
            return i._text
        },
        evaluateGlobalFunctionDeclaration: function(t) {
            var e = function(t) {
                var e = t.getType();
                if (void 0 !== e && "" !== e || this.logError("Your node " + t + " has no type"),
                t.globalFunctionDeclaration && void 0 === this._map[e]) {
                    this._map[e] = !0;
                    var i = t.globalFunctionDeclaration();
                    void 0 !== i && this._text.push(i)
                }
            };
            this.preTraverse(e);
            for (var i = 0, n = t.length; i < n; i++)
                this.traverse(e, t[i]);
            return e._text.join("\n")
        },
        evaluateGlobalVariableDeclaration: function(t) {
            var e = function(t) {
                var e = t.getID();
                if (t.globalDeclaration && void 0 === this._map[e]) {
                    this._map[e] = !0;
                    var i = t.globalDeclaration();
                    void 0 !== i && this._text.push(i)
                }
            };
            this.preTraverse(e);
            var i = 0
              , n = t.length;
            for (i = 0; i < n; i++)
                this.traverse(e, t[i]);
            var r = e._text
              , a = r.length;
            if (a > 0) {
                this.sortDeclarations(r);
                var s = r[0][0];
                for (i = 0; i < a; ++i) {
                    var o = r[i][0];
                    o !== s && (s = o,
                    r[i - 1] += "\n")
                }
            }
            return r.join("\n")
        },
        sortDeclarations: function(t) {
            if (t.sort(),
            !this._fragmentShaderMode)
                for (var e = 0, i = t.length; e < i; ++e) {
                    var n = t[e];
                    if ("a" !== n[0])
                        break;
                    if (-1 !== n.indexOf("Vertex")) {
                        t.splice(e, 1),
                        t.unshift(n);
                        break
                    }
                }
        },
        evaluate: function(t) {
            var e = function(t) {
                var e = t.getID();
                if (void 0 === this._map[e]) {
                    var i = t.computeShader();
                    if (void 0 !== i) {
                        if (void 0 !== t.getComment) {
                            var n = t.getComment();
                            void 0 !== n && this._text.push(n)
                        }
                        this._text.push(i)
                    }
                    this._map[e] = !0
                }
            };
            this.preTraverse(e);
            for (var i = 0, n = t.length; i < n; i++)
                this.traverse(e, t[i]);
            return e._text.join("\n")
        },
        evaluateDefines: function(t) {
            return this.evaluateAndGatherField(t, "getDefines")
        },
        evaluateExtensions: function(t) {
            return this.evaluateAndGatherField(t, "getExtensions")
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = (i(28),
    i(322))
      , r = i(323)
      , a = i(436)
      , s = i(533)
      , o = ["ShadowReceive", "Skinning", "Morph", "ShadowTexture", "Texture", "Light", "Material", "Billboard", "PointSize"]
      , l = function() {
        this._cache = new window.Map,
        this._shaderProcessor = new s,
        this._acceptAttributeTypes = new window.Set(o),
        this._ShaderCompiler = a
    };
    l.prototype = {
        setShaderCompiler: function(t) {
            this._ShaderCompiler = t
        },
        getShaderCompiler: function() {
            return this._ShaderCompiler
        },
        getAcceptAttributeTypes: function() {
            return this._acceptAttributeTypes
        },
        getShaderProcessor: function() {
            return this._shaderProcessor
        },
        setShaderProcessor: function(t) {
            this._shaderProcessor = t
        },
        filterAttributeTypes: function(t) {
            if ("osg" !== t.libraryName() && "osgShadow" !== t.libraryName() && "osgAnimation" !== t.libraryName())
                return !0;
            var e = t.getType();
            return !this._acceptAttributeTypes.has(e) || !(!t.isEnabled || t.isEnabled())
        },
        getActiveAttributeList: function(t, e) {
            var i = ""
              , n = t.attributeMap;
            for (var r in n) {
                var a = n[r]
                  , s = a.lastApplied;
                this.filterAttributeTypes(s) || (s.getHash ? i += s.getHash() : i += s.getType(),
                e.push(s))
            }
            return i
        },
        getActiveTextureAttributeList: function(t, e) {
            var i, n, r = "", a = t.textureAttributeMapList;
            for (i = 0,
            n = a.length; i < n; i++) {
                var s = a[i];
                if (s) {
                    e[i] = [];
                    for (var o in s) {
                        var l = s[o];
                        if (0 !== l.values().length) {
                            var u = l.lastApplied;
                            this.filterAttributeTypes(u) || u.isTextureNull() || (u.getHash ? r += u.getHash() : r += u.getType(),
                            e[i].push(u))
                        }
                    }
                }
            }
            return r
        },
        getActiveUniforms: function(t, e, i) {
            for (var n = {}, r = 0, a = e.length; r < a; r++) {
                var s = e[r];
                if (s.getOrCreateUniforms) {
                    var o = s.getOrCreateUniforms();
                    if (void 0 !== o)
                        for (var l in o) {
                            var u = o[l];
                            n[u.getName()] = u
                        }
                }
            }
            for (var h = 0, c = i.length; h < c; h++) {
                var d = i[h];
                if (d)
                    for (var p = 0, f = d.length; p < f; p++) {
                        var g = d[p]
                          , m = g.getOrCreateUniforms(h);
                        for (var v in m) {
                            var _ = m[v];
                            n[_.getName()] = _
                        }
                    }
            }
            return n
        },
        getOrCreateProgram: function() {
            var t = []
              , e = [];
            return function(i) {
                var a = "";
                e.length = 0,
                t.length = 0,
                a += this.getActiveAttributeList(i, e),
                a += this.getActiveTextureAttributeList(i, t);
                var s = this._cache.get(a);
                if (void 0 !== s)
                    return s;
                var o = this._ShaderCompiler
                  , l = new o(e,t,this._shaderProcessor)
                  , u = l.createFragmentShader()
                  , h = l.createVertexShader()
                  , c = new n(new r(r.VERTEX_SHADER,h),new r(r.FRAGMENT_SHADER,u));
                return c.hash = a,
                c.setActiveUniforms(this.getActiveUniforms(i, e, t)),
                c.generated = !0,
                this._cache.set(a, c),
                c
            }
        }()
    },
    t.exports = l
}
, , function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(383)
      , a = i(384)
      , s = i(1e3)
      , o = i(1002)
      , l = n.a.osg
      , u = n.a.osgShader
      , h = u.Compiler
      , c = u.nodeFactory;
    c.registerNodes(s.a),
    c.registerNodes(o.a);
    var d = function() {
        r.a.apply(this, arguments)
    };
    d.prototype = l.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "PBR"
        },
        getTextureEnvironmentSpecular: function() {
            return this._texturesByName.TextureEnvironmentSpecularPBR
        },
        getTextureEnvironmentIntegrateBRDF: function() {
            return this._texturesByName.TextureEnvironmentIntegrateBRDF
        },
        getEnvironmentDiffuse: function(t, e) {
            var i = this.getOrCreateUniform(e.diffuseSPH);
            i.globalDeclaration = function() {
                return "uniform vec3 " + i.getVariable() + "[9];"
            }
            ;
            var n = this.createVariable("vec3");
            this.getNode("DiffuseUE4v1").inputs({
                normal: this.getOrCreateMaterialNormal(),
                albedo: this.getOrCreateMaterialDiffusePBR(),
                envTransform: t,
                sphCoef: i
            }).outputs({
                color: n
            });
            var r = this.createVariable("vec3");
            return this.getNode("Mult").inputs(n, this.getOrCreateMaterialAOPBR()).outputs(r),
            this.getEnvironmentShadow(r)
        },
        getEnvironmentSpecular: function(t, e, i) {
            var n;
            this.getTextureEnvironmentIntegrateBRDF() && (n = this.getOrCreateSampler("sampler2D", i.textureIntegrateBRDF.getName()));
            var r = {
                normal: this.getOrCreateMaterialNormal(),
                eye: this.getOrCreateNormalizedViewEyeDirection(),
                roughness: this.getOrCreateMaterialRoughness(),
                specular: this.getOrCreateMaterialSpecularPBR(),
                envTransform: t,
                integrateBRDF: n,
                texSize: this.getOrCreateUniform(e.getOrCreateUniforms().size),
                frontNormal: this.getOrCreateNormalizedFrontViewNormal(),
                lodRange: this.getOrCreateUniform(e.getOrCreateUniforms().lodRange)
            }
              , a = "";
            e.getIsCubemap() ? (a = "SpecularUE4v1Cubemap",
            r.texSpec = this.getOrCreateSampler("samplerCube", i.textureSpecularPBR.getName())) : (a = "SpecularUE4v1Panorama",
            r.texSpec = this.getOrCreateSampler("sampler2D", i.textureSpecularPBR.getName()));
            var s = this.createVariable("vec3");
            this.getNode(a).inputs(r).outputs({
                color: s
            });
            var o = this.createVariable("vec3");
            return this.getNode("Mult").inputs(s, this.getOrCreateMaterialAOSpecularPBR()).outputs(o),
            o
        },
        readChannel: function(t, e, i, n) {
            var a = r.a.prototype.readChannel.apply(this, arguments);
            if (a)
                return a;
            switch (t) {
            case "DiffusePBR":
            case "AlbedoPBR":
            case "SpecularPBR":
                a = this.readTexture("vec3", t, e, i, n);
                break;
            case "GlossinessPBR":
            case "RoughnessPBR":
            case "MetalnessPBR":
            case "SpecularF0":
            case "CavityPBR":
            case "AOPBR":
                a = this.readTexture("float", t, e, i, n)
            }
            return a
        },
        getOrCreateMaterialSpecularF0: function() {
            var t = this.getVariable("materialSpecularf0");
            if (t)
                return t;
            t = this.createVariable("float", "materialSpecularf0");
            var e = this.getOrCreateChannel("SpecularF0");
            if (!e)
                return t.setValue("0.04");
            var i = this.createVariable("float").setValue("0.0")
              , n = this.createVariable("float").setValue("0.08");
            return this.getNode("Blend").mode("MIX").inputs(i, n, e).outputs(t),
            t
        },
        getOrCreateMaterialAOPBR: function() {
            return this.getOrCreateChannel("AOPBR") || this.getOrCreateConstantOne("float")
        },
        getOrCreateMaterialAOSpecularPBR: function() {
            if (!this.getOrCreateChannel("AOPBR"))
                return this.getOrCreateConstantOne("float");
            var t = this.getVariable("materialAO");
            return t || (t = this.createVariable("float", "materialAO"),
            this.getNode("SpecularOcclusion").inputs({
                occlude: this.getOrCreateUniform("int", "uAOPBROccludeSpecular"),
                ao: this.getOrCreateMaterialAOPBR(),
                normal: this.getOrCreateGeometryNormal(),
                eye: this.getOrCreateNormalizedViewEyeDirection()
            }).outputs({
                ao: t
            }),
            t)
        },
        getOrCreateMaterialCavityPBR: function() {
            return this.getOrCreateChannel("CavityPBR") || this.getOrCreateConstantOne("float")
        },
        getShadelessColor: function() {
            var t = this.createVariable("vec3");
            return this.getNode("Mult").inputs(this.getOrCreateMaterialAlbedo(), this.getOrCreateMaterialAOPBR()).outputs(t),
            t
        },
        getOrCreateMaterialAlbedo: function() {
            var t = this.getVariable("materialAlbedo");
            if (t)
                return t;
            t = this.createVariable("vec3", "materialAlbedo");
            var e = this.getOrCreateChannel("AlbedoPBR") || this.getOrCreateChannel("DiffusePBR") || this.getOrCreateConstantZero("vec3");
            return this.getNode("SetFromNode").inputs(this.getVertexColor(e)).outputs(t),
            t
        },
        getOrCreateMaterialDiffusePBR: function() {
            var t = this.getVariable("materialDiffusePBR");
            if (t)
                return t;
            t = this.createVariable("vec3", "materialDiffusePBR");
            var e = this.getOrCreateChannel("MetalnessPBR");
            if (e) {
                this.getNode("InlineCode").code("%out = %albedo * (1.0 - %metal);").inputs({
                    albedo: this.getOrCreateMaterialAlbedo(),
                    metal: e
                }).outputs({
                    out: t
                })
            } else
                this.getNode("SetFromNode").inputs(this.getOrCreateMaterialAlbedo()).outputs(t);
            return t
        },
        getOrCreateMaterialRoughness: function() {
            var t = this.getVariable("materialRoughness");
            if (t)
                return t;
            t = this.createVariable("float", "materialRoughness");
            var e = this.getOrCreateChannel("RoughnessPBR");
            e || (e = this.getOrCreateChannel("GlossinessPBR")) && (e = this.getRoughnessFromGlossiness(e)),
            e = e ? this.getMinRoughness(e) : this.createVariable("float").setValue("0.2");
            var i = e;
            return this._texturesByName.NormalMap && (i = this.createVariable("float"),
            this.getNode("AdjustRoughnessNmap").inputs({
                roughness: e,
                normal: this.getOrCreateNormalMap()
            }).outputs({
                roughness: i
            })),
            this.getNode("AdjustRoughnessGeometry").inputs({
                roughness: i,
                normal: this.getOrCreateNormalizedFrontViewNormal()
            }).outputs({
                roughness: t
            }),
            t
        },
        getOrCreateMaterialSpecularPBR: function() {
            var t = this.getOrCreateChannel("SpecularPBR");
            if (t)
                return t;
            var e = this.getVariable("materialSpecularPBR");
            if (e)
                return e;
            e = this.createVariable("vec3", "materialSpecularPBR");
            var i = this.getOrCreateChannel("MetalnessPBR");
            if (!i)
                return e.setValue("vec3(0.05)");
            return this.getNode("InlineCode").code("%out = mix( vec3(%f0), %albedo, %metal);").inputs({
                metal: i,
                albedo: this.getOrCreateMaterialAlbedo(),
                f0: this.getOrCreateMaterialSpecularF0()
            }).outputs({
                out: e
            }),
            e
        },
        createCommonLightingVars: function(t, e) {
            if (0 === this._lights.length)
                return {};
            var i, n = r.a.prototype.createCommonLightingVars.call(this, t, e), s = this._lights.length;
            for (i = 0; i < s && this._lights[i].getLightType() === a.a.ENV; i++)
                ;
            if (i === s)
                return n;
            var o = this.createVariable("vec4", "prepSpec");
            n.prepSpec = o;
            var u = l.objectMix({}, t);
            return u.normal || (u.normal = this.getOrCreateMaterialNormal()),
            u.eyeVector || (u.eyeVector = this.getOrCreateNormalizedViewEyeDirection()),
            this.getNode("PrepSpecLightPBR").inputs(u).outputs({
                prepSpec: o
            }),
            n
        },
        createLighting: function() {
            if (this._lights.length) {
                var t = {
                    DIRECTION: "SunLightPBR",
                    SPOT: "SpotLightPBR",
                    POINT: "PointLightPBR",
                    HEMI: "SunLightPBR",
                    ENV: "EnvLightPBR"
                }
                  , e = {};
                return e.materialambient = this.getOrCreateMaterialAmbient(),
                e.normal = this.getOrCreateMaterialNormal(),
                e.materialalbedopbr = this.getOrCreateMaterialDiffusePBR(),
                e.materialspecularf0 = this.getOrCreateMaterialSpecularF0(),
                e.materialroughnesspbr = this.getOrCreateMaterialRoughness(),
                e.materialspecularpbr = this.getOrCreateMaterialSpecularPBR(),
                h.prototype.createLighting.call(this, e, t)
            }
        },
        getRoughnessFromGlossiness: function(t) {
            var e = this.createVariable("float");
            return this.getNode("InlineCode").code("%out = 1.0 - %input;").inputs({
                input: t
            }).outputs({
                out: e
            }),
            e
        },
        getMinRoughness: function(t) {
            var e = this.createVariable("float");
            return this.getNode("InlineCode").code("%out = max(1.e-4, %input);").inputs({
                input: t
            }).outputs({
                out: e
            }),
            e
        },
        getFinalFrag: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("Mult").inputs(t, this.getOrCreateMaterialCavityPBR()).outputs(e),
            r.a.prototype.getFinalFrag.call(this, e)
        }
    }),
    e.a = d
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = function() {
        return r.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS")
    };
    e.a = a
}
, function(t, e, i) {
    "use strict";
    i.d(e, "a", function() {
        return l
    }),
    i.d(e, "b", function() {
        return u
    });
    var n = i(4)
      , r = i(385)
      , a = i(471)
      , s = n.a.osg
      , o = n.a.osgAnimation
      , l = function() {
        var t = s.vec3.create()
          , e = s.mat4.create();
        return function(i, n) {
            var a = i.get("lastComputedScenePosition")
              , o = i.get("geometryUid");
            if (o < 0)
                return s.vec3.copy(a, i.get("position"));
            var l = r.a.uidGeometryMap[o];
            if (!l)
                return s.vec3.copy(a, i.get("position"));
            var u = i.get("indices")
              , h = u[0]
              , c = u[1]
              , d = u[2];
            if (l.getWorldMatrix(n, e),
            h < 0)
                return s.vec3.transformMat4(a, i.get("localPosition"), e);
            var p = l.getVertexAttributeList().Vertex.getElements()
              , f = p.length / 3;
            if (h >= f || c >= f || d >= f)
                return s.vec3.copy(a, i.get("position"));
            var g = i.get("barycentricWeights")
              , m = g[0]
              , v = g[1]
              , _ = g[2];
            if (s.vec3.set(a, 0, 0, 0),
            l.computeTransformedVertex)
                l.computeTransformedVertex(h, t),
                s.vec3.scale(t, t, m),
                s.vec3.add(a, t, a),
                l.computeTransformedVertex(c, t),
                s.vec3.scale(t, t, v),
                s.vec3.add(a, t, a),
                l.computeTransformedVertex(d, t),
                s.vec3.scale(t, t, _),
                s.vec3.add(a, t, a);
            else {
                var b = 3 * h
                  , x = 3 * c
                  , y = 3 * d;
                a[0] = m * p[b] + v * p[x] + _ * p[y],
                a[1] = m * p[b + 1] + v * p[x + 1] + _ * p[y + 1],
                a[2] = m * p[b + 2] + v * p[x + 2] + _ * p[y + 2]
            }
            return s.vec3.transformMat4(a, a, e),
            a
        }
    }()
      , u = function(t, e, n) {
        e.getScenePositionFromHit(n, t.get("position"));
        var r = n.nodepath[n.nodepath.length - 1]
          , s = void 0 !== r._uniqueID ? r._uniqueID : -1
          , l = r instanceof o.RigGeometry || r instanceof o.MorphGeometry
          , u = l || i.i(a.a)(n.nodepath);
        t.set("geometryUid", u ? s : -1);
        var h = n.TriangleIntersection
          , c = t.get("indices");
        c[0] = l ? h.i1 : -1,
        c[1] = l ? h.i2 : -1,
        c[2] = l ? h.i3 : -1;
        var d = t.get("barycentricWeights");
        d[0] = l ? h.r1 : 0,
        d[1] = l ? h.r2 : 0,
        d[2] = l ? h.r3 : 0;
        var p = t.get("localPosition");
        p[0] = u ? n.point[0] : 0,
        p[1] = u ? n.point[1] : 0,
        p[2] = u ? n.point[2] : 0
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(386)
      , r = i(4)
      , a = i(476)
      , s = i(405)
      , o = i.n(s)
      , l = i(7)
      , u = i.n(l)
      , h = i(68)
      , c = i.n(h)
      , d = i(2)
      , p = i.n(d)
      , f = i(1)
      , g = (i.n(f),
    i(757))
      , m = r.a.osg
      , v = new o.a({
        device: "VWR",
        listen: !0
    })
      , _ = {}
      , b = function(t) {
        return 1 << Math.ceil(Math.log2(t))
    }
      , x = function(t) {
        var e, i, n, r = 0;
        if (0 === t.length)
            return r;
        for (e = 0,
        n = t.length; e < n; e++)
            i = t.charCodeAt(e),
            r = (r << 5) - r + i,
            r |= 0;
        return "vr-browser-" + r
    }
      , y = function(t, e, i, n, r, s) {
        a.a.call(this, t, e, i, n, r, s),
        this._uPaginate = void 0,
        this._textureWidth = 1024,
        this._textureHeight = 1024,
        this._useCache = !1
    };
    y.prototype = m.objectInherit(a.a.prototype, {
        initialize: function(t, e, r) {
            g.a || (e = i.i(f.extend)({}, e),
            n.a.getBaseVR(function(i) {
                this._styles = i.vrStyles,
                this._appendVrElement();
                var n = p()(i.TEMPLATES.getFromMacro(t, "panel", [e]));
                this._templatePath = t,
                n.css("position", "absolute"),
                n.css("top", "0"),
                n.css("left", "0"),
                this._$uiPanelsDiv.append(n);
                var a = this._extractMetaData(n);
                if (this._useCache) {
                    var s = x(n.html())
                      , o = localStorage.getItem(s);
                    if (o) {
                        var l = new Image;
                        return l.onload = function() {
                            var t = new m.Texture;
                            t.setTextureSize(1, 1),
                            t.setImage(l),
                            this._applyTexture(t, a, r)
                        }
                        .bind(this),
                        l.src = o,
                        void n.remove()
                    }
                }
                this._rasterizeElement(i.rasterizeHTML, n).then(function(t) {
                    if (this._useCache) {
                        var e = t.toDataURL()
                          , i = x(n.html());
                        this._storeInCache(i, e)
                    }
                    var r = new m.Texture;
                    return r.setTextureSize(1, 1),
                    r.setImage(t),
                    r
                }
                .bind(this)).then(function(t) {
                    this._applyTexture(t, a, r)
                }
                .bind(this)),
                n.remove()
            }
            .bind(this)))
        },
        _storeInCache: function(t, e) {
            try {
                localStorage.setItem(t, e)
            } catch (n) {
                localStorage.removeItem(localStorage.key(0));
                for (var i = 0; i < localStorage.length && 0 !== localStorage.key(i).indexOf("vr-browser-"); i++)
                    localStorage.removeItem(localStorage.key(i));
                this._storeInCache(t, e)
            }
        },
        setUseCache: function(t) {
            this._useCache = t || !1
        },
        _applyTexture: function(t, e, i) {
            this.isInitialized() ? (this.changeTexture(t),
            this.updateMetaData(e)) : a.a.prototype.initialize.call(this, t, e),
            i && i(t, e)
        },
        _appendVrElement: function() {
            this._$uiPanelsDiv = p()("#vr-ui-panels"),
            this._$uiPanelsDiv.length || (this._$uiPanelsDiv = p()('<div id="vr-ui-panels" style="position:absolue; top:0;bottom:0;left:0;right:0; background:transparent"/>'),
            p()("body").append(this._$uiPanelsDiv),
            this._$uiPanelsDiv.append('<style id="vr-panel-style">' + this._styles + "</style>"))
        },
        _rasterizeElement: function(t, e) {
            var n = document.createElement("canvas");
            return n.width = e.outerWidth(),
            n.height = e.outerHeight(),
            t.drawHTML(this._$uiPanelsDiv.prop("outerHTML"), n, {
                cacheBucket: _,
                cache: "all"
            }).then(function(t) {
                if (c.a.apple.phone) {
                    var e = "data:image/svg+xml;base64," + window.btoa(t.svg)
                      , r = i.i(f.uniqueId)("rasterize");
                    return v.createMessage({
                        data: {
                            _key: r,
                            height: n.height + "",
                            width: n.width + "",
                            svg: e
                        }
                    }).appendToHash(),
                    new u.a(function(t) {
                        v.on("message:" + r, function(e) {
                            var i, n = new Image;
                            n.onload = function() {
                                t(n)
                            }
                            ,
                            e.b64 && (i = e.b64),
                            e.data.b64 && (i = e.data.b64),
                            i.indexOf("%3D") > -1 && (i = decodeURIComponent(i)),
                            -1 === i.indexOf("data:image/png") && (i = "data:image/png;base64," + i),
                            n.src = i
                        })
                    }
                    )
                }
                if (this._textureWidth = b(n.width),
                this._textureHeight = b(n.height),
                n.width === this._textureWidth && n.height === this._textureHeight)
                    return n;
                var a = document.createElement("canvas");
                return a.width = this._textureWidth,
                a.height = this._textureHeight,
                a.getContext("2d").drawImage(n, 0, 0, this._textureWidth, this._textureHeight),
                a
            }
            .bind(this), function(t) {
                console.log(t)
            })
        },
        _extractMetaData: function(t) {
            var e = t.find(".page")
              , i = t.outerHeight(!0)
              , n = t.outerWidth(!0)
              , r = {
                id: t.attr("id"),
                width: n,
                height: i,
                cells: [],
                pages: []
            };
            if (0 === e.length)
                this._extractButtons(t, r, 0, "default");
            else
                for (var a = 0; a < e.length; a++)
                    this._extractButtons(p()(e[a]), r, a, e[a].id);
            return this._extractCells(t, r),
            r
        },
        _extractButtons: function(t, e, i, n) {
            if (n) {
                var r = t.find("button")
                  , a = t.offset().top
                  , s = t.offset().left
                  , o = t.outerHeight(!0)
                  , l = t.outerWidth(!0);
                e.pages[i] = {
                    id: n,
                    num: i,
                    x: s,
                    y: a,
                    width: l,
                    height: o,
                    items: [],
                    areas: []
                };
                for (var u = 0; u < r.length; u++) {
                    var h = r[u].id
                      , c = r[u].disabled;
                    if (h && !c) {
                        var d = p()(r[u])
                          , f = m.vec4.create();
                        f[0] = d.offset().left - s,
                        f[1] = f[0] + d.outerWidth(),
                        f[2] = d.offset().top - a,
                        f[3] = f[2] + d.outerHeight(),
                        f[0] > e.width && (f[0] %= e.width),
                        f[1] > e.width && (f[1] %= e.width),
                        e.pages[i].items.push(h),
                        e.pages[i].areas.push(f)
                    }
                }
            }
        },
        _extractCells: function(t, e) {
            for (var i = t.find(".cell"), n = t.offset().top, r = t.offset().left, a = 0, s = 1 / 0, o = 1 / 0, l = 0, u = 0; u < i.length; u++) {
                var h = i[u].id;
                if (h) {
                    var c = p()(i[u])
                      , d = {};
                    d.id = h,
                    d.x = c.offset().left - r,
                    d.y = c.offset().top - n,
                    d.z = c.zIndex(),
                    d.width = c.outerWidth(!1),
                    d.height = c.outerHeight(!1);
                    var f = d.x + d.width;
                    f > a && (a = f),
                    d.x < s && (s = d.x);
                    var g = d.y + d.height;
                    g > l && (l = g),
                    d.y < o && (o = d.y),
                    e.cells[u] = d
                }
            }
            0 === i.length ? (e.cellsWidth = t.outerWidth(!1),
            e.cellsHeight = t.outerHeight(!1)) : (e.cellsWidth = a - s,
            e.cellsHeight = l - o)
        }
    }),
    e.a = y
}
, , function(t, e) {
    (function(e) {
        t.exports = e
    }
    ).call(e, {})
}
, , function(t, e, i) {
    "use strict";
    i.d(e, "a", function() {
        return _
    });
    var n = i(4)
      , r = i(545)
      , a = i(7)
      , s = i.n(a)
      , o = i(83)
      , l = i(146)
      , u = i(68)
      , h = i.n(u)
      , c = i(29)
      , d = i(63)
      , p = i(358)
      , f = i(90)
      , g = n.a.osg
      , m = function(t, e, i) {
        var n = r.a.getTrackUrl(i.get("soundcloudID"));
        this._player = e,
        this._src = n,
        this._player.setAttribute("src", n),
        this._manager = t,
        this._model = i,
        this._mediaElement = void 0,
        this._gain = void 0,
        this._panner = void 0,
        this._canPlayDefered = void 0,
        this._isPlaying = !1,
        this._seeking = !1,
        this._player.addEventListener("play", this.onPlay.bind(this)),
        this._player.addEventListener("ended", this.onEnded.bind(this))
    };
    m.prototype = {
        onPlay: function() {
            this._isPlaying && this.updateVolume()
        },
        onEnded: function() {
            if (this.isSoundAsync())
                return void (this._model.get("loop") || (this._isPlaying = !1,
                this._player.pause(),
                this._gain.gain.value = 0));
            this._gain.gain.value = 0
        },
        play: function() {
            if (this.isSoundAsync())
                return void this.updateVolume();
            this._isPlaying = !0
        },
        pause: function() {
            if (this.isSoundAsync())
                return void this.updateVolume();
            this._isPlaying = !1
        },
        getModel: function() {
            return this._model
        },
        zeroVolume: function() {
            this._gain && (this._gain.gain.value = 0)
        },
        updateVolume: function() {
            if (void 0 !== this._model.get("volume")) {
                if (this._volumeReal = this._model.get("volume") * this._manager.getVolume(),
                !this._gain)
                    return;
                this._isPlaying ? this._gain.gain.value = this._volumeReal : this._gain.gain.value = 0
            }
        },
        updatePosition: function(t) {
            if (this._panner) {
                var e = this._manager.getRadius();
                this._panner.setPosition(t[0] / e, t[1] / e, t[2] / e)
            }
        },
        getTime: function() {
            return this._player.currentTime + this._model.startTime
        },
        setTime: function(t, e) {
            if (this._manager.canPlay()) {
                if (this.isSoundAsync())
                    return void this.updateVolume();
                e && this.play();
                var i = this._model.get("loop")
                  , n = t - this._model.get("startTime")
                  , r = n < 0
                  , a = !r;
                return a && (i ? n %= this._player.duration : this._player.duration + this._model.get("startTime") <= t && (a = !1)),
                a ? (this._isPlaying && this._player.paused ? (this._gain.gain.value = this._volumeReal,
                this._player.play()) : this._isPlaying || this._player.paused || (this._player.pause(),
                this._gain.gain.value = 0),
                this._seeking && !this._player.seeking && (this._gain.gain.value = this._volumeReal,
                this._seeking = !1),
                !this._seeking && Math.abs(this._player.currentTime - n) > .2 && (this._gain.gain.value = 0,
                this._player.seeking ? (this._seeking = !0,
                !1) : (this._player.currentTime = n,
                this._seeking = !0,
                !1))) : (this._player.pause(),
                this._player.currentTime = 0,
                this._gain.gain.value = 0,
                !0)
            }
        },
        isSoundAsync: function() {
            return !1 === this._manager._hasAnim || !this._model.get("sync")
        },
        setRefDistance: function(t) {
            if (this._panner) {
                var e = t / this._manager.getRadius();
                this._panner.maxDistance = 1e5 * e,
                this._panner.refDistance = e
            }
        },
        updateFromModel: function() {
            var t = this._model.get("loop");
            this._player.loop = t;
            var e = this._model.get("ambient");
            e || this._panner ? !e || !this._panner && this._gain || (this._manager.disconnectSound(this),
            this._manager.connectAmbientSound(this)) : (this._manager.disconnectSound(this),
            this._manager.connect3DSound(this)),
            this.isSoundAsync() && this._manager.getPlayedOnceFromMobileGesture() && (this._player.paused && this._player.play(),
            this._isPlaying = !0),
            this.updateVolume(),
            this.setRefDistance(this._model.get("distance"))
        },
        whenReady: function() {
            return this._canPlayDefered || (this._canPlayDefered = s.a.defer(),
            this._player.addEventListener("canplaythrough", this._canPlayDefered.resolve.bind(this._canPlayDefered, this), !0)),
            this._canPlayDefered.promise
        }
    };
    var v = function() {
        this._volume = Number(o.a.get("volume", 1)),
        this._sounds = [],
        this._enabled = !0,
        this._context = void 0,
        this._hasSounds = !1,
        this._unlockBinded = this._unlock.bind(this);
        var t = window.location.href.match(/\/models\/((.+)(?:\/)+|(.+))/);
        if (t && t.length > 3) {
            var e = t[2] ? t[2] : t[3];
            d.a.get(e).then(function(t) {
                var e = t.get("options").sound;
                if (e && e.soundtracks && e.soundtracks.length)
                    if (h.a.apple.device) {
                        if (!i.i(f.a)()) {
                            for (var n, r = 0, a = e.soundtracks.length; r < a; r++)
                                if (e.soundtracks[r].ambient) {
                                    n = r;
                                    break
                                }
                            void 0 !== n ? (e.soundtracks = e.soundtracks.splice(r, 1),
                            this._hasSounds = !0) : e.soundtracks.length = 0
                        }
                    } else
                        this._hasSounds = !0
            }
            .bind(this))
        }
        this._radius = 1,
        l.a.getBoxReady().then(function() {
            this._radius = l.a.getModelBoxWithoutDisplacement().radius()
        }
        .bind(this)),
        this._resetPlayedOnceFromMobileGesture(),
        this._enablingMobileAudio = !1,
        this._firstEnter = !0,
        this._readyForErrorMessage = s.a.defer()
    };
    v.prototype = {
        exit: function() {
            this._context && (this._context.suspend(),
            this._firstEnter = !1,
            this._resetPlayedOnceFromMobileGesture(),
            this._playedOnceFromMobileGesture || this._enableMobileAudio())
        },
        enter: function() {
            this._context && this._context.resume()
        },
        setModel: function(t) {
            this._osdProxyModel = t,
            this._readyForErrorMessage.resolve(),
            this._playedOnceFromMobileGesture || (this._enableMobileAudio(),
            this._osdProxyModel.trigger("requestTapForSound", "Tap to play sounds", {
                position: "top",
                duration: Math.Infinity
            }))
        },
        getOrCreateAudioContext: function() {
            if (this._context)
                return this._context;
            var t = window.AudioContext || window.webkitAudioContext;
            if (!t)
                return void (this._enabled = !1);
            try {
                return this._context = new t({
                    latencyHint: "interactive"
                }),
                this._playedOnceFromMobileGesture || this._enableMobileAudio(),
                this._context
            } catch (t) {
                this._readyForErrorMessage.promise.then(function() {
                    this._osdProxyModel.trigger("sound-error", 'Your browser can not play additional sounds and this page must be reloaded. If the problem persists, try to restart your browser. <a style="color: -webkit-link; cursor: auto; text-decoration: underline;" href="javascript:window.location.reload()">reload</a>', {
                        position: "top",
                        duration: Math.Infinity
                    })
                }
                .bind(this))
            }
        },
        _createAudio: function(t) {
            var e = document.createElement("audio");
            return e.volume = 1,
            e.preload = "auto",
            e.crossOrigin = "anonymous",
            e.loop = t.get("loop"),
            e
        },
        addSound: function(t, e) {
            return this.canPlay() && (e || !1 === this._hasAnim) && t.play(),
            this._sounds.push(t),
            t
        },
        createSound: function(t, e) {
            var i = this._createAudio(t)
              , n = new m(this,i,t);
            return this.canPlay() && (t.get("ambient") ? this.connectAmbientSound(n) : this.connect3DSound(n)),
            this.addSound(n, e)
        },
        createPreview: function(t) {
            var e = this._createAudio(t)
              , i = new m(this,e,t);
            return this.connectAmbientSound(i),
            i
        },
        connect3DSound: function(t) {
            var e = this.getOrCreateAudioContext();
            if (e) {
                var i = e.createPanner();
                i.panningModel = "HRTF",
                i.distanceModel = "inverse",
                i.refDistance = 1,
                i.maxDistance = 1e5 * i.refDistance,
                i.rolloffFactor = 1,
                i.coneInnerAngle = 360,
                i.coneOuterAngle = 0,
                i.coneOuterGain = 0,
                i.setPosition(0, 0, 0),
                t._panner = i,
                t._mediaElement || (t._mediaElement = e.createMediaElementSource(t._player));
                var n = e.createGain();
                n.gain.value = 0,
                t._gain = n,
                t._mediaElement.connect(i),
                i.connect(n),
                n.connect(e.destination)
            }
        },
        connectAmbientSound: function(t) {
            var e = this.getOrCreateAudioContext();
            if (e) {
                t._mediaElement || (t._mediaElement = e.createMediaElementSource(t._player));
                var i = e.createGain();
                i.gain.value = 0,
                t._mediaElement.connect(i),
                t._gain = i,
                i.connect(e.destination)
            }
        },
        disconnectSound: function(t) {
            t && (t._player && this._gain && (this._gain.gain.value = 0),
            t._panner && (t._panner.disconnect(),
            t._panner = void 0),
            t._gain && (t._mediaElement.disconnect(),
            t._mediaElement.disconnect(this._context),
            t._gain.disconnect(),
            t._gain = void 0))
        },
        releaseSound: function(t) {
            t && (this.disconnectSound(t),
            t._mediaElement = void 0,
            this._sounds.splice(this._sounds.indexOf(t), 1))
        },
        update: function() {
            var t = g.vec3.create()
              , e = g.vec3.create()
              , i = g.vec3.create();
            return function() {
                if (!this._enabled)
                    return !0;
                var n = this._context
                  , r = this._camera;
                if (!r || !n)
                    return !0;
                g.mat4.getLookAt(t, e, i, r.getViewMatrix()),
                g.vec3.sub(e, e, t),
                g.vec3.normalize(e, e);
                var a = n.listener;
                return a.setPosition(t[0] / this._radius, t[1] / this._radius, t[2] / this._radius),
                a.setOrientation(e[0], e[1], e[2], i[0], i[1], i[2]),
                !0
            }
        }(),
        getVolume: function() {
            return this._volume
        },
        setCamera: function(t) {
            this._camera = t
        },
        setVolume: function(t) {
            if (this._volume = t,
            o.a.set("volume", t, {
                path: "/"
            }),
            this.canPlay())
                for (var e = 0, i = this._sounds.length; e < i; e++)
                    this._sounds[e].updateVolume()
        },
        setEnabled: function(t) {
            this._context && (t ? this._context.resume().then(function() {
                this._enabled = !0
            }
            .bind(this)) : this._context.suspend().then(function() {
                this._enabled = !1
            }
            .bind(this)))
        },
        isEnabled: function() {
            return this._enabled
        },
        setHasAnim: function(t) {
            this._hasAnim = t
        },
        _unlock: function() {
            var t = this.getOrCreateAudioContext();
            this._enablingMobileAudio = !1,
            t && (document.removeEventListener("touchend", this._unlockBinded, !0),
            this._playedOnceFromMobileGesture = !0,
            this.forcePlayMobile(),
            this._osdProxyModel && this._osdProxyModel.trigger("stopRequestTapForSound"))
        },
        _enableMobileAudio: function() {
            if (!this._enablingMobileAudio)
                return this._enablingMobileAudio = !0,
                document.addEventListener("touchend", this._unlockBinded, !0),
                this
        },
        forcePlayMobile: function() {
            for (var t = 0; t < this._sounds.length; t++) {
                var e = this._sounds[t];
                e.updateFromModel(),
                e._player.paused && e._player.play(),
                e.play()
            }
        },
        getPlayedOnceFromMobileGesture: function() {
            return this._playedOnceFromMobileGesture
        },
        _resetPlayedOnceFromMobileGesture: function() {
            this._playedOnceFromMobileGesture = !this._hasSounds || !h.a.any || i.i(c.a)().isApp || i.i(p.a)()
        },
        canPlay: function() {
            return this._enabled && this._playedOnceFromMobileGesture
        },
        getRadius: function() {
            return this._radius
        }
    };
    var _ = new v
}
, , , , , , function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(2))
      , a = i.n(r)
      , s = i(18)
      , o = i.n(s)
      , l = i(836)
      , u = i.n(l)
      , h = function(t, e) {
        if (Array.isArray(t))
            this.shortcuts = t || [];
        else {
            if (!i.i(n.isObject)(t))
                throw new Error("Shortcut manager needs a shortcut object to function");
            this.shortcutGroup = t,
            this.shortcuts = t.shortcuts || []
        }
        this.options = e || {},
        this.handlers = {},
        this.options = i.i(n.defaults)({}, this.options, {
            listen: !1
        }),
        this.options.listen && this.listen()
    }
      , c = new u.a;
    c.stopCallback = function(t, e) {
        return !((" " + e.className + " ").indexOf(" mousetrap ") > -1) && ("button" === document.activeElement.tagName.toLowerCase() || ("INPUT" === e.tagName || "SELECT" === e.tagName || "TEXTAREA" === e.tagName || e.contentEditable && "true" === e.contentEditable))
    }
    ,
    i.i(n.extend)(h.prototype, o.a.Events),
    h.prototype.listen = function(t) {
        void 0 === t ? this.shortcuts.forEach(this._listen.bind(this)) : Array.isArray(t) ? (this.shortcuts = this.shortcuts.concat(t),
        t.forEach(this._listen.bind(this))) : this._listen(t)
    }
    ,
    h.prototype.stopListening = function(t) {
        t.forEach(function(t) {
            c.unbind(this._getShortcut(t).keyCombinations),
            delete this.handlers[t]
        }
        .bind(this))
    }
    ,
    h.prototype.getTitle = function() {
        return this.shortcutGroup ? this.shortcutGroup.name || "" : ""
    }
    ,
    h.prototype.getShortcut = function(t) {
        return this.shortcuts.filter(function(e) {
            return e.id === t
        })[0] || ""
    }
    ,
    h.prototype.getShortDescriptionById = function(t) {
        var e = "";
        return this.shortcuts.forEach(function(i) {
            i.id === t && (e = this._formatKeyCombination(i.keyCombinations).replace("<br />", ""))
        }
        .bind(this)),
        e
    }
    ,
    h.prototype.generateHelpSection = function() {
        var t = a()("<div />")
          , e = this.getTitle();
        return e && t.append("<h2>" + e + "</h2>"),
        this.shortcuts.forEach(function(e) {
            e.name && t.append("<b>" + e.name + "</b>"),
            t.append(this._formatKeyCombination(e.keyCombinations))
        }
        .bind(this)),
        t.html() || ""
    }
    ,
    h.prototype.hasKeyCombination = function(t) {
        var e = !1;
        return this.shortcuts.forEach(function(i) {
            e || (Array.isArray(i.shortcuts) ? i.shortcuts.forEach(function(i) {
                e = i === t
            }) : e = i.shortcuts === t)
        }),
        e
    }
    ,
    h.prototype._formatKeyCombination = function(t) {
        var e = "";
        return e = Array.isArray(t) ? t.join("</kbd> or <kbd>") : t,
        e = "<kbd>" + e + "</kbd><br />"
    }
    ,
    h.prototype._listen = function(t) {
        this._validate(t) && !this.handlers[t.id] && (this.handlers[t.id] = this._notify.bind(this, t),
        c.bind(t.keyCombinations, this.handlers[t.id]))
    }
    ,
    h.prototype._getShortcut = function(t) {
        return i.i(n.find)(this.shortcuts, function(e) {
            return e.id === t
        })
    }
    ,
    h.prototype._validate = function(t) {
        return void 0 !== t.keyCombinations && void 0 !== t.id
    }
    ,
    h.prototype._notify = function(t, e) {
        this.trigger(t.id, t, e)
    }
    ,
    e.a = h
}
, , function(t, e, i) {
    "use strict";
    var n = i(172);
    e.a = n.a.extend({
        events: {
            "click .close": "hide",
            "touchstart .close": "hide"
        },
        show: function(t) {
            t && t.preventDefault && t.preventDefault(),
            this.$el.removeClass("hidden")
        },
        hide: function(t) {
            t && t.preventDefault && t.preventDefault(),
            this.$el.addClass("hidden")
        },
        isVisible: function() {
            return !this.$el.hasClass("hidden")
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(639)
      , r = i(616)
      , a = i(855)
      , s = i(857)
      , o = i(861)
      , l = i(884)
      , u = i(894)
      , h = i(534)
      , c = i(875)
      , d = i(877)
      , p = i(896)
      , f = i(864)
      , g = n;
    g.osg = r,
    g.osgAnimation = a,
    g.osgDB = s,
    g.osgGA = o,
    g.osgUtil = l,
    g.osgViewer = u,
    g.osgShader = h,
    g.osgShadow = c,
    g.osgText = d,
    g.osgWrappers = p,
    g.osgPlugins = f;
    var m = ["osg", "osgAnimation", "osgDB", "osgGA", "osgUtil", "osgViewer", "osgShader", "osgShadow", "osgText", "osgWrappers", "osgPlugins"];
    g.globalify = function() {
        m.forEach(function(t) {
            window[t] = g[t]
        })
    }
    ,
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(353)
      , r = i(143)
      , a = i(5).mat4
      , s = i(410)
      , o = i(325)
      , l = i(65)
      , u = i(13)
      , h = function(t) {
        l.call(this, t),
        this._reservedMatrixStack = new s,
        this._matrixStack = [],
        this._bb = new n
    };
    h.prototype = u.objectLibraryClass(u.objectInherit(l.prototype, {
        reset: function() {
            this._reservedMatrixStack.reset(),
            this._matrixStack.length = 0,
            this._bb.init()
        },
        getBoundingBox: function() {
            return this._bb
        },
        applyTransform: function(t) {
            var e = this._reservedMatrixStack.get()
              , i = this._matrixStack.length;
            i ? a.copy(e, this._matrixStack[i - 1]) : a.identity(e),
            t.computeLocalToWorldMatrix(e, this),
            this.pushMatrix(e),
            this.traverse(t),
            this.popMatrix()
        },
        apply: function(t) {
            return t instanceof o ? void this.applyTransform(t) : t instanceof r ? void this.applyBoundingBox(t.getBoundingBox()) : void this.traverse(t)
        },
        pushMatrix: function(t) {
            this._matrixStack.push(t)
        },
        popMatrix: function() {
            this._matrixStack.pop()
        },
        applyBoundingBox: function() {
            var t = new n;
            return function(e) {
                var i = this._matrixStack.length;
                if (i) {
                    if (e.valid()) {
                        var n = this._matrixStack[i - 1];
                        e.transformMat4(t, n),
                        this._bb.expandByBoundingBox(t)
                    }
                } else
                    this._bb.expandByBoundingBox(e)
            }
        }(),
        getMatrixStack: function() {
            return this._matrixStack
        }
    }), "osg", "ComputeBoundsVisitor"),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(13)
      , a = i(379)
      , s = i(65)
      , o = i(430)
      , l = i(601)
      , u = i(5).mat4
      , h = i(163)
      , c = i(515)
      , d = i(522)
      , p = i(517)
      , f = i(467)
      , g = i(143)
      , m = i(609)
      , v = i(458)
      , _ = i(523)
      , b = i(128)
      , x = i(518)
      , y = i(613)
      , S = i(521)
      , w = i(272)
      , C = i(144)
      , M = i(5).vec3
      , T = i(459)
      , A = i(415)
      , E = i(414)
      , P = i(381)
      , N = function() {
        s.call(this, s.TRAVERSE_ACTIVE_CHILDREN),
        o.call(this),
        l.call(this),
        this._rootStateGraph = void 0,
        this._currentStateGraph = void 0,
        this._currentRenderBin = void 0,
        this._currentRenderStage = void 0,
        this._rootRenderStage = void 0,
        this._computedNear = Number.POSITIVE_INFINITY,
        this._computedFar = Number.NEGATIVE_INFINITY;
        var t = M.fromValues(0, 0, -1);
        this._camera = void 0,
        this._bbCornerFar = (t[0] >= 0 ? 1 : 0) | (t[1] >= 0 ? 2 : 0) | (t[2] >= 0 ? 4 : 0),
        this._bbCornerNear = 7 & ~this._bbCornerFar,
        this._reserveLeafStack = [new m],
        this._reserveLeafStackCurrent = 0,
        this._reserveRenderStageStacks = {},
        this._reserveCullSettingsStack = [new o],
        this._reserveCullSettingsStackCurrent = 0,
        this._renderBinStack = [],
        this.visitorType = s.CULL_VISITOR,
        this._identityMatrix = u.create(),
        this._renderer = void 0,
        this._renderStageType = _,
        this._numCamera = 0,
        this._numMatrixTransform = 0,
        this._numProjection = 0,
        this._numNode = 0,
        this._numLightSource = 0,
        this._numGeometry = 0
    };
    N.prototype = r.objectInherit(l.prototype, r.objectInherit(s.prototype, {
        distance: function(t, e) {
            return -(t[0] * e[2] + t[1] * e[6] + t[2] * e[10] + e[14])
        },
        getComputedNear: function() {
            return this._computedNear
        },
        getComputedFar: function() {
            return this._computedFar
        },
        resetStats: function() {
            this._numCamera = 0,
            this._numMatrixTransform = 0,
            this._numProjection = 0,
            this._numNode = 0,
            this._numLightSource = 0,
            this._numGeometry = 0
        },
        handleCullCallbacksAndTraverse: function(t) {
            var e = t.getCullCallback();
            e && !e.cull(t, this) || this.traverse(t)
        },
        getCurrentCamera: function() {
            return this._currentRenderBin.getStage().getCamera()
        },
        updateCalculatedNearFar: function() {
            var t = M.create()
              , e = M.create();
            return function(i, n) {
                var r, a, s = n.getBoundingBox();
                if (r = this.distance(s.corner(this._bbCornerNear, t), i),
                a = this.distance(s.corner(this._bbCornerFar, e), i),
                r > a) {
                    var o = r;
                    r = a,
                    a = o
                }
                return !(a < 0) && (r < this._computedNear && (this._computedNear = r),
                a > this._computedFar && (this._computedFar = a),
                !0)
            }
        }(),
        setStateGraph: function(t) {
            this._rootStateGraph = t,
            this._currentStateGraph = t
        },
        setRenderStage: function(t) {
            this._rootRenderStage = t,
            this._currentRenderBin = t
        },
        setRenderer: function(t) {
            this._renderer = t
        },
        getRenderer: function() {
            return this._renderer
        },
        reset: function() {
            l.prototype.reset.call(this),
            this.resetRenderLeafStack(),
            this._reserveLeafStackCurrent = 0,
            this.resetCullSettingsStack(),
            this._reserveCullSettingsStackCurrent = 0;
            for (var t in this._reserveRenderStageStacks)
                this._reserveRenderStageStacks[t].reset();
            v.resetStack(),
            this._computedNear = Number.POSITIVE_INFINITY,
            this._computedFar = Number.NEGATIVE_INFINITY
        },
        getCurrentRenderBin: function() {
            return this._currentRenderBin
        },
        setCurrentRenderBin: function(t) {
            this._currentRenderBin = t
        },
        addPositionedAttribute: function(t, e) {
            var i = t || this._identityMatrix;
            this._currentRenderBin.getStage().positionedAttribute.push([i, e])
        },
        pushStateSet: function(t) {
            if (this._currentStateGraph = this._currentStateGraph.findOrInsert(t),
            void 0 !== t.getBinName()) {
                var e = this._renderBinStack
                  , i = this._currentRenderBin;
                e.push(i),
                this._currentRenderBin = i.getStage().findOrInsert(t.getBinNumber(), t.getBinName())
            }
        },
        popStateSet: function() {
            var t = this._currentStateGraph
              , e = t.getStateSet();
            if (this._currentStateGraph = t.parent,
            void 0 !== e.getBinName()) {
                var i = this._renderBinStack;
                0 === i.length ? this._currentRenderBin = this._currentRenderBin.getStage() : this._currentRenderBin = i.pop()
            }
        },
        popProjectionMatrix: function() {
            if (!0 === this._computeNearFar && this._computedFar >= this._computedNear) {
                var t = this.getCurrentProjectionMatrix();
                void 0 !== this._clampProjectionMatrixCallback ? this._clampProjectionMatrixCallback(t, this._computedNear, this._computedFar, this._nearFarRatio) : this.clampProjectionMatrix(t, this._computedNear, this._computedFar, this._nearFarRatio)
            }
            l.prototype.popProjectionMatrix.call(this)
        },
        clampProjectionMatrix: function(t, e, i, r, a) {
            if (i < e - 1e-6)
                return n.log("clampProjectionMatrix not applied, invalid depth range, znear = " + e + "  zfar = " + i, !1, !0),
                !1;
            var s, o;
            if (i < e + 1e-6) {
                var l = .5 * (e + i);
                e = l - 1e-6,
                i = l + 1e-6
            }
            if (Math.abs(t[3]) < 1e-6 && Math.abs(t[7]) < 1e-6 && Math.abs(t[11]) < 1e-6) {
                var u = .02 * (i - e);
                u < 1 && (u = 1),
                s = e - u,
                o = i + u,
                e = s,
                i = o,
                t[10] = -2 / (o - s),
                t[14] = -(o + s) / (o - s)
            } else {
                s = .98 * e,
                o = 1.02 * i;
                var h = i * r;
                s < h && (s = h),
                e = s,
                i = o;
                var c = t[10]
                  , d = t[14]
                  , p = t[11]
                  , f = t[15]
                  , g = (-s * c + d) / (-s * p + f)
                  , m = (-o * c + d) / (-o * p + f)
                  , v = Math.abs(2 / (g - m))
                  , _ = -(g + m) / 2
                  , b = _ * v;
                t[2] = t[2] * v + t[3] * b,
                t[6] = t[6] * v + t[7] * b,
                t[10] = c * v + p * b,
                t[14] = d * v + f * b
            }
            return void 0 !== a && (a[0] = e,
            a[1] = i),
            !0
        },
        popCameraModelViewProjectionMatrix: function() {
            this.popModelViewMatrix(),
            this.popProjectionMatrix()
        },
        pushCameraModelViewProjectionMatrix: function(t, e, i) {
            this.pushModelViewMatrix(e),
            this.pushProjectionMatrix(i)
        },
        apply: function(t) {
            this[t.typeID](t)
        },
        createOrReuseRenderStage: function(t) {
            var e, i = t ? t.className() : "RenderStage", n = t ? t.constructor : _;
            return this._reserveRenderStageStacks[i] ? e = this._reserveRenderStageStacks[i] : (e = new f.OsgObjectMemoryStack(n),
            this._reserveRenderStageStacks[i] = e),
            e.get().init()
        },
        createOrReuseRenderLeaf: function() {
            var t = this._reserveLeafStack[this._reserveLeafStackCurrent++];
            return this._reserveLeafStackCurrent === this._reserveLeafStack.length && this._reserveLeafStack.push(new m),
            t
        },
        resetRenderLeafStack: function() {
            for (var t = 0, e = this._reserveLeafStackCurrent; t <= e; t++)
                this._reserveLeafStack[t].reset()
        },
        createOrReuseCullSettings: function() {
            var t = this._reserveCullSettingsStack[this._reserveCullSettingsStackCurrent++];
            return this._reserveCullSettingsStackCurrent === this._reserveCullSettingsStack.length && this._reserveCullSettingsStack.push(new o),
            t
        },
        resetCullSettingsStack: function() {
            for (var t = 0, e = this._reserveCullSettingsStackCurrent; t <= e; t++)
                this._reserveCullSettingsStack[t].reset()
        },
        postPushGeometry: function(t, e) {
            var i, n;
            e instanceof A ? (n = e.getStateSetAnimation(),
            n && t.pushStateSet(n),
            (i = e.getSourceGeometry())instanceof P && (n = i.getStateSetAnimation()) && t.pushStateSet(n)) : e instanceof P && (n = e.getStateSetAnimation()) && t.pushStateSet(n)
        },
        prePopGeometry: function(t, e) {
            if (e instanceof A) {
                var i = e.getSourceGeometry();
                i instanceof P && i.getStateSetAnimation() && t.popStateSet(),
                e.getStateSetAnimation() && t.popStateSet()
            } else
                e instanceof P && e.getStateSetAnimation() && t.popStateSet()
        },
        pushLeaf: function(t, e) {
            var i = this._currentStateGraph.leafs;
            0 === i.length && this._currentRenderBin.addStateGraph(this._currentStateGraph);
            var n = this.createOrReuseRenderLeaf();
            n.init(this._currentStateGraph, t, this.getCurrentProjectionMatrix(), this.getCurrentViewMatrix(), this.getCurrentModelViewMatrix(), this.getCurrentModelMatrix(), e),
            i.push(n)
        }
    })),
    N.prototype[w.typeID] = function(t) {
        this._numCamera++;
        var e = t.getStateSet();
        e && this.pushStateSet(e);
        var i = this._reservedMatrixStack.get()
          , n = this._reservedMatrixStack.get();
        if (t.getReferenceFrame() === C.RELATIVE_RF) {
            var r = this.getCurrentProjectionMatrix();
            u.mul(n, r, t.getProjectionMatrix());
            var a = this.getCurrentModelViewMatrix();
            u.mul(i, a, t.getViewMatrix())
        } else
            u.copy(i, t.getViewMatrix()),
            u.copy(n, t.getProjectionMatrix());
        var s = this._computedNear
          , o = this._computedFar
          , l = this.createOrReuseCullSettings();
        if (l.setCullSettings(this),
        this._computedNear = Number.POSITIVE_INFINITY,
        this._computedFar = Number.NEGATIVE_INFINITY,
        this.setCullSettings(t),
        l.getSettingSourceOverrider() === this && l.getEnableFrustumCulling() && this.setEnableFrustumCulling(!0),
        this.pushCameraModelViewProjectionMatrix(t, i, n),
        t.getViewport() && this.pushViewport(t.getViewport()),
        t.getRenderOrder() === w.NESTED_RENDER)
            this.handleCullCallbacksAndTraverse(t);
        else {
            var h = this.getCurrentRenderBin()
              , c = h.getStage()
              , d = this.createOrReuseRenderStage(this._rootRenderStage);
            d.setCamera(t),
            d.setClearDepth(t.getClearDepth()),
            d.setClearColor(t.getClearColor()),
            d.setClearMask(t.getClearMask());
            var p;
            p = void 0 === t.getViewport() ? c.getViewport() : t.getViewport(),
            d.setViewport(p),
            this.setCurrentRenderBin(d),
            this.handleCullCallbacksAndTraverse(t),
            this.setCurrentRenderBin(h),
            t.getRenderOrder() === w.PRE_RENDER ? this.getCurrentRenderBin().getStage().addPreRenderStage(d, t.renderOrderNum) : this.getCurrentRenderBin().getStage().addPostRenderStage(d, t.renderOrderNum)
        }
        this.popCameraModelViewProjectionMatrix(t),
        t.getViewport() && this.popViewport(),
        this.setCullSettings(l),
        this._computedNear = s,
        this._computedFar = o,
        e && this.popStateSet()
    }
    ,
    N.prototype[h.typeID] = function(t) {
        if (this._numMatrixTransform++,
        !this.isCulled(t, this.nodePath)) {
            this.pushCurrentMask();
            var e = this._reservedMatrixStack.get()
              , i = this.getCurrentModelViewMatrix();
            u.copy(e, i),
            t.computeLocalToWorldMatrix(e),
            this.pushModelViewMatrix(e);
            var n = t.getStateSet();
            n && this.pushStateSet(n),
            this.handleCullCallbacksAndTraverse(t),
            n && this.popStateSet(),
            this.popModelViewMatrix(),
            this.popCurrentMask()
        }
    }
    ,
    N.prototype[d.typeID] = function(t) {
        this._numProjection++;
        var e = this.getCurrentProjectionMatrix()
          , i = this._reservedMatrixStack.get();
        u.mul(i, e, t.getProjectionMatrix()),
        this.pushProjectionMatrix(i);
        var n = t.getStateSet();
        n && this.pushStateSet(n),
        this.handleCullCallbacksAndTraverse(t),
        n && this.popStateSet(),
        this.popProjectionMatrix()
    }
    ,
    N.prototype[b.typeID] = function(t) {
        if (this._numNode++,
        !this.isCulled(t, this.nodePath)) {
            this.pushCurrentMask();
            var e = t.getStateSet();
            e && this.pushStateSet(e),
            this.handleCullCallbacksAndTraverse(t),
            e && this.popStateSet(),
            this.popCurrentMask()
        }
    }
    ,
    N.prototype[c.typeID] = N.prototype[h.typeID],
    N.prototype[x.typeID] = N.prototype[b.typeID],
    N.prototype[y.typeID] = N.prototype[b.typeID],
    N.prototype[S.typeID] = N.prototype[b.typeID],
    N.prototype[p.typeID] = function(t) {
        this._numLightSource++;
        var e = t.getStateSet();
        e && this.pushStateSet(e);
        var i = t.getLight();
        i && (t.getReferenceFrame() === C.RELATIVE_RF ? this.addPositionedAttribute(this.getCurrentModelViewMatrix(), i) : this.addPositionedAttribute(null, i)),
        this.handleCullCallbacksAndTraverse(t),
        e && this.popStateSet()
    }
    ,
    N.prototype[g.typeID] = function() {
        var t = M.create()
          , e = !1;
        return function(i) {
            this._numGeometry++;
            var r = this.getCurrentModelViewMatrix()
              , s = i.getBoundingBox();
            if (!this._computeNearFar || !s.valid() || this.updateCalculatedNearFar(r, i)) {
                var o = i.getCullCallback();
                if (!o || o.cull(i, this)) {
                    var l = i.getStateSet();
                    l && this.pushStateSet(l),
                    this.postPushGeometry(this, i);
                    var u = 0;
                    s.valid() && (u = this.distance(s.center(t), r)),
                    a.isNaN(u) ? e || (n.warn("warning geometry has a NaN depth, " + r + " center " + t),
                    e = !0) : this.pushLeaf(i, u),
                    this.prePopGeometry(this, i),
                    l && this.popStateSet()
                }
            }
        }
    }(),
    N.prototype[T.typeID] = N.prototype[h.typeID],
    N.prototype[A.typeID] = N.prototype[g.typeID],
    N.prototype[P.typeID] = N.prototype[g.typeID],
    N.prototype[E.typeID] = N.prototype[h.typeID],
    t.exports = N
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(28)
      , a = i(85)
      , s = i(379)
      , o = function(t) {
        a.call(this),
        this._leafs = [],
        this.positionedAttribute = [],
        this.stateGraphList = [],
        o.prototype.init.call(this, t)
    };
    o.SORT_BY_STATE = 0,
    o.SORT_BACK_TO_FRONT = 1,
    o.SORT_FRONT_TO_BACK = 2,
    o.defaultSortMode = o.SORT_BY_STATE,
    o.BinPrototypes = {
        RenderBin: function() {
            return o.getOrCreate().init()
        },
        DepthSortedBin: function() {
            return o.getOrCreate().init(o.SORT_BACK_TO_FRONT)
        }
    };
    var l = function(t, e) {
        return e._depth - t._depth
    }
      , u = function(t, e) {
        return t._depth - e._depth
    }
      , h = function(t, e) {
        return t._binNum - e._binNum
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(a.prototype, {
        init: function(t) {
            return this._leafs.length = 0,
            this.positionedAttribute.length = 0,
            this._renderStage = void 0,
            this._bins = {},
            this.stateGraphList.length = 0,
            this._parent = void 0,
            this._binNum = 0,
            this._sorted = !1,
            this._sortMode = void 0 !== t ? t : o.defaultSortMode,
            this._drawCallback = void 0,
            this
        },
        _createRenderBin: function(t) {
            var e = o.BinPrototypes.RenderBin;
            return t && o.BinPrototypes[t] && (e = o.BinPrototypes[t]),
            e()
        },
        getStateGraphList: function() {
            return this.stateGraphList
        },
        copyLeavesFromStateGraphListToRenderLeafList: function() {
            this._leafs.splice(0, this._leafs.length);
            for (var t = !1, e = 0, i = this.stateGraphList.length; e < i; e++)
                for (var n = this.stateGraphList[e].leafs, a = 0, o = n.length; a < o; a++) {
                    var l = n[a];
                    s.isNaN(l._depth) ? t = !0 : this._leafs.push(l)
                }
            t && r.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),
            this.stateGraphList.splice(0, this.stateGraphList.length)
        },
        getSortMode: function() {
            return this._sortMode
        },
        sortBackToFront: function() {
            this.copyLeavesFromStateGraphListToRenderLeafList(),
            this._leafs.sort(l)
        },
        sortFrontToBack: function() {
            this.copyLeavesFromStateGraphListToRenderLeafList(),
            this._leafs.sort(u)
        },
        sortImplementation: function() {
            var t = o;
            switch (this._sortMode) {
            case t.SORT_BACK_TO_FRONT:
                this.sortBackToFront();
                break;
            case t.SORT_FRONT_TO_BACK:
                this.sortFrontToBack();
                break;
            case t.SORT_BY_STATE:
            }
        },
        sort: function() {
            if (!this._sorted) {
                for (var t in this._bins)
                    this._bins[t].sort();
                this.sortImplementation(),
                this._sorted = !0
            }
        },
        setParent: function(t) {
            this._parent = t
        },
        getParent: function() {
            return this._parent
        },
        getBinNumber: function() {
            return this._binNum
        },
        findOrInsert: function(t, e) {
            var i = this._bins[t];
            return i || (i = this._createRenderBin(e),
            i._parent = this,
            i._binNum = t,
            i._renderStage = this._renderStage,
            this._bins[t] = i),
            i
        },
        getStage: function() {
            return this._renderStage
        },
        addStateGraph: function(t) {
            this.stateGraphList.push(t)
        },
        reset: function() {
            this.stateGraphList.length = 0,
            this._bins = {},
            this.positionedAttribute.length = 0,
            this._leafs.length = 0,
            this._sorted = !1
        },
        draw: function(t, e) {
            var i = e;
            return i = this._drawCallback && this._drawCallback.drawImplementation ? this._drawCallback.drawImplementation(this, t, i) : this.drawImplementation(t, i)
        },
        applyPositionedAttribute: function(t, e) {
            for (var i = 0, n = e.length; i < n; i++) {
                var r = e[i]
                  , a = r[1]
                  , s = r[0];
                t.setGlobalDefaultAttribute(a),
                a.apply(t),
                a.applyPositionedUniform(s, t),
                t.haveAppliedAttribute(a)
            }
        },
        drawImplementation: function(t, e) {
            var i = e
              , n = [];
            for (var r in this._bins)
                n.push(this._bins[r]);
            n.sort(h);
            for (var a, s = 0, o = n.length; s < o && (a = n[s],
            !(a.getBinNumber() > 0)); s++)
                i = a.draw(t, i);
            for (i = this.drawLeafs(t, i); s < o; s++)
                a = n[s],
                i = a.draw(t, i);
            return i
        },
        drawLeafs: function(t, e) {
            for (var i, n = this.stateGraphList, r = this._leafs, a = e, s = 0, o = r.length; s < o; s++)
                i = r[s],
                i.render(t, a),
                a = i;
            for (var l = 0, u = n.length; l < u; l++)
                for (var h = n[l], c = 0, d = h.leafs.length; c < d; c++)
                    i = h.leafs[c],
                    i.render(t, a),
                    a = i;
            return a
        }
    }), "osg", "RenderBin"),
    o.getOrCreate = function() {
        var t = o._reservedStack[o._reservedStackCurrent++];
        return o._reservedStackCurrent === o._reservedStack.length && o._reservedStack.push(new o),
        t
    }
    ,
    o.resetStack = function() {
        o._reservedStackCurrent = 0
    }
    ,
    o._reservedStack = [new o],
    o._reservedStackCurrent = 0,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(163)
      , a = i(624)
      , s = i(65)
      , o = i(460)
      , l = i(414)
      , u = function() {
        s.call(this, s.TRAVERSE_ALL_CHILDREN)
    };
    u.prototype = n.objectInherit(s.prototype, {
        apply: function(t) {
            if (t.getTypeID() === l.getTypeID()) {
                var e = t.getUpdateCallback();
                if (e instanceof o) {
                    for (var i = e._stackedTransforms, n = 0, r = i.length; n < r; n++) {
                        i[n].resetToDefaultValue()
                    }
                    e.computeChannels()
                }
            }
            this.traverse(t)
        }
    });
    var h = new u
      , c = function() {
        r.call(this)
    };
    c.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        setDefaultUpdateCallback: function() {
            this.addUpdateCallback(new a)
        },
        setRestPose: function() {
            this.accept(h)
        }
    }), "osgAnimation", "Skeleton"),
    n.setTypeID(c),
    t.exports = c
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).mat4
      , a = i(434)
      , s = function() {
        a.call(this),
        this._stackedTransforms = [],
        this._matrix = r.create(),
        this._dirty = !1
    };
    s.prototype = n.objectInherit(a.prototype, {
        getStackedTransforms: function() {
            return this._stackedTransforms
        },
        computeChannels: function() {
            this._dirty = !0;
            var t = this._matrix;
            r.identity(t);
            for (var e = this._stackedTransforms, i = 0, n = e.length; i < n; i++) {
                e[i].applyToMatrix(t)
            }
        },
        update: function(t) {
            return r.copy(t.getMatrix(), this._matrix),
            this._dirty && (t.dirtyBound(),
            this._dirty = !1),
            !0
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(416)
      , r = 0
      , a = function(t, e) {
        for (var i = 1 / 0, n = -1 / 0, a = 0; a < t.length; a++)
            i = Math.min(i, t[a].start),
            n = Math.max(n, t[a].end);
        var s = n - i
          , o = e || "animation" + r.toString();
        return r++,
        {
            channels: t,
            duration: s,
            name: o,
            start: i
        }
    }
      , s = function(t) {
        for (var e = [], i = 0; i < t.channels.length; i++) {
            var r = n.createInstanceChannel(t.channels[i]);
            e.push(r)
        }
        return {
            channels: e,
            duration: t.duration,
            start: 0,
            name: t.name,
            firstKeyTime: t.start
        }
    }
      , o = function() {};
    o.createAnimation = a,
    o.createInstanceAnimation = s,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(408)
      , r = i(5).mat4
      , a = function(t) {
        this._boundStrategy = t,
        void 0 === this._boundStrategy && (this._boundStrategy = a.COMPUTE_HOME_USING_SPHERE),
        this._controllerList = {},
        this._inverseMatrix = r.create(),
        this._camera = void 0,
        this._node = void 0,
        this._frustum = {},
        this._computeBoundNodeMaskOverride = -1
    };
    a.prototype = {
        setCamera: function(t) {
            this._camera = t
        },
        getCamera: function() {
            return this._camera
        },
        setNode: function(t) {
            this._node = t
        },
        setComputeBoundNodeMaskOverride: function(t) {
            this._computeBoundNodeMaskOverride = t
        },
        getComputeBoundNodeMaskOverride: function() {
            return this._computeBoundNodeMaskOverride
        },
        getHomeBound: function(t) {
            var e = this._node;
            if (e) {
                var r = void 0 !== t ? t : this._boundStrategy;
                if (r & a.COMPUTE_HOME_USING_BBOX) {
                    var s = new n
                      , o = null;
                    if (-1 === this._computeBoundNodeMaskOverride)
                        o = e.getBoundingBox();
                    else {
                        var l = i(456)
                          , u = new l;
                        u.setNodeMaskOverride(this._computeBoundNodeMaskOverride),
                        u.reset(),
                        u.apply(e),
                        o = u.getBoundingBox()
                    }
                    if (o.valid() && s.expandByBoundingBox(o),
                    r & a.COMPUTE_HOME_USING_SPHERE) {
                        var h = e.getBound();
                        if (h.radius() < s.radius())
                            return h
                    }
                    return s
                }
                return e.getBound()
            }
        },
        getHomeDistance: function(t) {
            var e = this._frustum
              , i = t.radius();
            if (this._camera && r.getFrustum(e, this._camera.getProjectionMatrix())) {
                var n = Math.abs(e.right - e.left) / e.zNear / 2
                  , a = Math.abs(e.top - e.bottom) / e.zNear / 2;
                i /= Math.sin(Math.atan2(a < n ? a : n, 1))
            } else
                i *= 1.5;
            return i
        },
        update: function() {},
        getInverseMatrix: function() {
            return this._inverseMatrix
        },
        getControllerList: function() {
            return this._controllerList
        }
    },
    a.COMPUTE_HOME_USING_SPHERE = 1,
    a.COMPUTE_HOME_USING_BBOX = 2,
    t.exports = a
}
, function(t, e) {
    var i = function(t, e) {
        this._current = new Float32Array(t),
        this._target = new Float32Array(t),
        this._delta = new Float32Array(t),
        this._delay = void 0 !== e ? e : .15,
        this._reset = !1,
        this._start = 0,
        this.reset()
    };
    i.prototype = {
        setDelay: function(t) {
            this._delay = t
        },
        reset: function() {
            for (var t = 0, e = this._current.length; t < e; t++)
                this._current[t] = this._target[t] = 0;
            this._reset = !0
        },
        update: function(t) {
            for (var e = Math.min(1, this._delay * t * 60), i = 0, n = this._current.length; i < n; i++) {
                var r = (this._target[i] - this._current[i]) * e;
                this._delta[i] = r,
                this._current[i] += r
            }
            return this._delta
        },
        set: function() {
            for (var t = 0, e = this._current.length; t < e; t++)
                this._current[t] = this._target[t] = arguments[t];
            this._reset = !1
        },
        isReset: function() {
            return this._reset
        },
        getCurrent: function() {
            return this._current
        },
        setTarget: function() {
            for (var t = 0, e = this._target.length; t < e; t++)
                this._reset ? this._target[t] = this._current[t] = arguments[t] : this._target[t] = arguments[t];
            this._reset = !1
        },
        addTarget: function() {
            for (var t = 0; t < arguments.length; t++)
                this._target[t] += arguments[t]
        },
        getTarget: function() {
            return this._target
        },
        getDelta: function() {
            return this._delta
        },
        getStart: function() {
            return this._start
        },
        setStart: function(t) {
            this._start = t
        }
    },
    t.exports = i
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(65)
      , a = i(5).mat4
      , s = i(410)
      , o = i(144)
      , l = function() {
        r.call(this),
        this._intersector = void 0,
        this._projectionStack = [a.IDENTITY],
        this._modelStack = [a.IDENTITY],
        this._viewStack = [a.IDENTITY],
        this._windowStack = [a.IDENTITY],
        this.reset()
    };
    l.prototype = n.objectInherit(r.prototype, {
        reset: function() {
            l._reservedMatrixStack.reset()
        },
        setIntersector: function(t) {
            this._intersector = t
        },
        getIntersector: function() {
            return this._intersector
        },
        pushModelMatrix: function(t) {
            this._modelStack.push(t)
        },
        getModelMatrix: function() {
            return this._modelStack.length ? this._modelStack[this._modelStack.length - 1] : void 0
        },
        popModelMatrix: function() {
            return this._modelStack.pop()
        },
        pushViewMatrix: function(t) {
            this._viewStack.push(t)
        },
        getViewMatrix: function() {
            return this._viewStack.length ? this._viewStack[this._viewStack.length - 1] : void 0
        },
        popViewMatrix: function() {
            return this._viewStack.pop()
        },
        pushProjectionMatrix: function(t) {
            this._projectionStack.push(t)
        },
        getProjectionMatrix: function() {
            return this._projectionStack.length ? this._projectionStack[this._projectionStack.length - 1] : void 0
        },
        popProjectionMatrix: function() {
            return this._projectionStack.pop()
        },
        pushWindowMatrix: function(t) {
            this._windowStack.push(t)
        },
        pushWindowMatrixUsingViewport: function(t) {
            this._windowStack.push(t.computeWindowMatrix(l._reservedMatrixStack.get()))
        },
        getWindowMatrix: function() {
            return this._windowStack.length ? this._windowStack[this._windowStack.length - 1] : void 0
        },
        popWindowMatrix: function() {
            return this._windowStack.pop()
        },
        getTransformation: function() {
            var t = a.create64();
            return function() {
                return a.copy(t, this.getWindowMatrix() || a.IDENTITY),
                a.mul(t, t, this.getProjectionMatrix() || a.IDENTITY),
                a.mul(t, t, this.getViewMatrix() || a.IDENTITY),
                a.mul(t, t, this.getModelMatrix() || a.IDENTITY),
                t
            }
        }(),
        enter: function(t) {
            return this._intersector.enter(t)
        },
        apply: function(t) {
            t.getViewMatrix ? this.applyCamera(t) : t.getMatrix ? this.applyTransform(t) : this.applyNode(t)
        },
        applyCamera: function(t) {
            var e = t.getViewport();
            void 0 !== e && this.pushWindowMatrixUsingViewport(e);
            var i, n, r;
            t.getReferenceFrame() === o.RELATIVE_RF && this.getViewMatrix() && this.getProjectionMatrix() ? (i = a.mul(l._reservedMatrixStack.get(), this.getProjectionMatrix(), t.getProjectionMatrix()),
            n = this.getViewMatrix(),
            r = a.mul(l._reservedMatrixStack.get(), this.getModelMatrix(), t.getViewMatrix())) : (i = t.getProjectionMatrix(),
            n = t.getViewMatrix(),
            r = a.identity(l._reservedMatrixStack.get())),
            this.pushProjectionMatrix(i),
            this.pushViewMatrix(n),
            this.pushModelMatrix(r),
            this._intersector.setCurrentTransformation(this.getTransformation()),
            this.traverse(t),
            this.popModelMatrix(),
            this.popViewMatrix(),
            this.popProjectionMatrix(),
            void 0 !== e && this.popWindowMatrix(),
            this._intersector.setCurrentTransformation(this.getTransformation())
        },
        applyNode: function(t) {
            if (this.enter(t))
                return t.getPrimitiveSetList ? void this._intersector.intersect(this, t) : void (t.traverse && this.traverse(t))
        },
        applyTransform: function(t) {
            if (this.enter(t)) {
                if (t.getReferenceFrame() === o.ABSOLUTE_RF) {
                    var e = l._reservedMatrixStack.get();
                    this.pushViewMatrix(a.identity(e)),
                    this.pushModelMatrix(t.getMatrix())
                } else if (this._modelStack.length > 0) {
                    var i = a.copy(l._reservedMatrixStack.get(), this.getModelMatrix());
                    a.mul(i, i, t.getMatrix()),
                    this.pushModelMatrix(i)
                } else
                    this.pushModelMatrix(t.getMatrix());
                this._intersector.setCurrentTransformation(this.getTransformation()),
                this.traverse(t),
                this.popModelMatrix(),
                t.getReferenceFrame() === o.ABSOLUTE_RF && this.popViewMatrix(),
                this._intersector.setCurrentTransformation(this.getTransformation())
            }
        }
    }),
    l._reservedMatrixStack = new s,
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(5).vec3
      , r = i(5).mat4
      , a = i(466)
      , s = function() {
        this._start = n.create(),
        this._end = n.create(),
        this._iStart = n.create(),
        this._iEnd = n.create(),
        this._intersections = []
    };
    s.prototype = {
        set: function(t, e) {
            n.copy(this._start, t),
            n.copy(this._iStart, t),
            n.copy(this._end, e),
            n.copy(this._iEnd, e)
        },
        setStart: function(t) {
            n.copy(this._start, t),
            n.copy(this._iStart, t)
        },
        setEnd: function(t) {
            n.copy(this._end, t),
            n.copy(this._iEnd, t)
        },
        reset: function() {
            this._intersections.length = 0
        },
        enter: function(t) {
            return !t.isCullingActive() || this.intersects(t.getBound())
        },
        intersects: function() {
            var t = n.create()
              , e = n.create();
            return function(i) {
                if (!i.valid())
                    return !1;
                n.sub(t, this._iStart, i.center());
                var r = n.sqrLen(t) - i.radius2();
                if (r <= 0)
                    return !0;
                n.sub(e, this._iEnd, this._iStart);
                var a = n.sqrLen(e)
                  , s = 2 * n.dot(t, e)
                  , o = s * s - 4 * a * r;
                if (o < 0)
                    return !1;
                o = Math.sqrt(o);
                var l = .5 / a
                  , u = (-s - o) * l
                  , h = (-s + o) * l;
                return !(u <= 0 && h <= 0) && !(u > 1 && h > 1)
            }
        }(),
        intersect: function() {
            var t = new a;
            return function(e, i) {
                var n = i.getShape();
                if (n)
                    return n.intersectRay(this._iStart, this._iEnd, this._intersections, e.nodePath);
                if (t.reset(),
                t.setNodePath(e.nodePath),
                t.set(this._iStart, this._iEnd),
                i.computeTransformedVertices) {
                    var r = i.getVertexAttributeList()
                      , a = r.Vertex.getElements();
                    r.Vertex._elements = i.computeTransformedVertices(),
                    t.apply(i),
                    r.Vertex._elements = a
                } else
                    t.apply(i);
                for (var s = t._intersections, o = this._intersections, l = s.length, u = 0; u < l; u++)
                    o.push(s[u]);
                return l > 0
            }
        }(),
        getIntersections: function() {
            return this._intersections
        },
        setCurrentTransformation: function(t) {
            r.invert(t, t),
            n.transformMat4(this._iStart, this._start, t),
            n.transformMat4(this._iEnd, this._end, t)
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(5).vec3
      , r = i(5).mat4
      , a = i(524)
      , s = i(413)
      , o = function(t, e, i, n, r, a, s) {
        this.normal = t,
        this.i1 = e,
        this.i2 = i,
        this.i3 = n,
        this.r1 = r,
        this.r2 = a,
        this.r3 = s
    }
      , l = function() {
        this._intersections = [],
        this._nodePath = [],
        this._dir = n.create()
    };
    l.prototype = {
        reset: function() {
            this._intersections.length = 0
        },
        setNodePath: function(t) {
            this._nodePath = t
        },
        set: function(t, e) {
            this._start = t,
            this._end = e,
            this._dir = n.sub(this._dir, e, t),
            this._length = n.length(this._dir),
            this._invLength = 1 / this._length,
            n.scale(this._dir, this._dir, this._invLength)
        },
        apply: function() {
            var t = n.create()
              , e = n.create()
              , i = n.create()
              , r = new a;
            return function(n) {
                if (n.getAttributes().Vertex) {
                    var a = n.getAttributes().Vertex.getElements()
                      , s = this
                      , o = function(n, r, o) {
                        if (n !== r && n !== o && r !== o) {
                            var l = 3 * n;
                            t[0] = a[l],
                            t[1] = a[l + 1],
                            t[2] = a[l + 2],
                            l = 3 * r,
                            e[0] = a[l],
                            e[1] = a[l + 1],
                            e[2] = a[l + 2],
                            l = 3 * o,
                            i[0] = a[l],
                            i[1] = a[l + 1],
                            i[2] = a[l + 2],
                            s.intersect(t, e, i, n, r, o)
                        }
                    };
                    r.init(n, o),
                    r.apply()
                }
            }
        }(),
        isBackFace: function() {
            var t = r.create();
            return function(e, i) {
                return r.identity(t),
                s.computeLocalToWorld(i, !0, t),
                r.determinant(t) * e < 0
            }
        }(),
        intersect: function() {
            var t = n.create()
              , e = n.create()
              , i = n.create()
              , r = n.create()
              , a = n.create()
              , s = n.create();
            return function(l, u, h, c, d, p) {
                var f = this._dir;
                n.sub(e, h, l),
                n.sub(i, u, l),
                n.cross(a, f, e);
                var g = n.dot(a, i);
                if (!(g > -1e-20 && g < 1e-20)) {
                    var m = 1 / g;
                    n.sub(r, this._start, l);
                    var v = n.dot(a, r) * m;
                    if (!(v < 0 || v > 1)) {
                        n.cross(s, r, i);
                        var _ = n.dot(s, f) * m;
                        if (!(_ < 0 || v + _ > 1)) {
                            var b = n.dot(s, e) * m;
                            if (!(b < 1e-20 || b > this._length)) {
                                var x = 1 - v - _
                                  , y = v
                                  , S = _
                                  , w = b * this._invLength
                                  , C = l[0] * x + u[0] * y + h[0] * S
                                  , M = l[1] * x + u[1] * y + h[1] * S
                                  , T = l[2] * x + u[2] * y + h[2] * S;
                                n.cross(t, i, e),
                                n.normalize(t, t),
                                this._intersections.push({
                                    ratio: w,
                                    backface: this.isBackFace(g, this._nodePath),
                                    nodepath: this._nodePath.slice(0),
                                    TriangleIntersection: new o(n.clone(t),c,d,p,x,y,S),
                                    point: n.fromValues(C, M, T)
                                }),
                                this.hit = !0
                            }
                        }
                    }
                }
            }
        }()
    },
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = {};
    n.memoryPools = {},
    n.OsgObjectMemoryPool = function(t) {
        return {
            _memPool: [],
            reset: function() {
                return this._memPool = [],
                this
            },
            put: function(t) {
                this._memPool.push(t)
            },
            get: function() {
                return this._memPool.length > 0 ? this._memPool.pop() : (this.grow(),
                this.get())
            },
            grow: function(e) {
                var i;
                i = void 0 === e ? this._memPool.length > 0 ? 2 * this._memPool.length : 20 : e;
                for (var n = this._memPool.length; n++ < i; )
                    this._memPool.push(new t);
                return this
            }
        }
    }
    ,
    n.OsgArrayMemoryPool = function() {
        return {
            _mempoolofPools: [],
            reset: function() {
                return this._memPoolofPools = {},
                this
            },
            put: function(t) {
                this._memPoolofPools[t.length] || (this._memPoolofPools[t.length] = []),
                this._memPoolofPools[t.length].push(t)
            },
            get: function(t) {
                if (this._memPoolofPools[t]) {
                    if (this._memPoolofPools.length > 0)
                        return this._memPool.pop()
                } else
                    this._memPoolofPools[t] = [];
                return this.grow(t),
                this.get()
            },
            grow: function(t, e) {
                void 0 === e && (e = this._memPool.length > 0 ? 2 * this._memPool.length : 5);
                for (var i = this._memPool.length; i++ < e; )
                    this._memPool.push(new Array(t));
                return this
            }
        }
    }
    ,
    n.OsgObjectMemoryStack = function(t) {
        return {
            _current: 0,
            _memPool: [new t],
            reset: function() {
                return this._current = 0,
                this
            },
            get: function() {
                var e = this._memPool[this._current++];
                return this._current >= this._memPool.length && this._memPool.push(new t),
                e
            }
        }
    }
    ,
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i(144)
      , a = {};
    a.Object = function(t, e) {
        var i = t.getJSON();
        if (i.Name && e.setName(i.Name),
        i.UserDataContainer) {
            var n = t.setJSON(i.UserDataContainer).readUserDataContainer();
            void 0 !== n && e.setUserData(n)
        }
        return e
    }
    ,
    a.Node = function(t, e) {
        var i = t.getJSON();
        a.Object(t, e);
        var r = [];
        if (i.UpdateCallbacks)
            for (var s = e.addUpdateCallback.bind(e), o = 0, l = i.UpdateCallbacks.length; o < l; o++) {
                var u = t.setJSON(i.UpdateCallbacks[o]).readObject();
                r.push(u),
                u.then(s)
            }
        if (i.StateSet) {
            var h = t.setJSON(i.StateSet).readObject();
            r.push(h),
            h.then(e.setStateSet.bind(e))
        }
        var c = [];
        if (i.Children)
            for (var d = 0, p = i.Children.length; d < p; d++)
                c.push(t.setJSON(i.Children[d]).readObject());
        return n.all(r).then(function() {
            return n.all(c).then(function(t) {
                for (var i = t.length, n = 0; n < i; n++)
                    e.addChild(t[n]);
                return e
            })
        })
    }
    ,
    a.StateSet = function(t, e) {
        var i = t.getJSON();
        a.Object(t, e),
        void 0 !== i.RenderingHint && e.setRenderingHint(i.RenderingHint);
        var r = [];
        if (void 0 !== i.AttributeList)
            for (var s = 0, o = i.AttributeList.length; s < o; s++)
                !function(i) {
                    var n = t.setJSON(i).readObject();
                    n.isRejected() || (r.push(n),
                    n.then(e.setAttributeAndModes.bind(e)))
                }(i.AttributeList[s]);
        if (i.TextureAttributeList)
            for (var l = i.TextureAttributeList, u = 0, h = l.length; u < h; u++)
                for (var c = l[u], d = 0, p = c.length; d < p; d++)
                    !function(i, n) {
                        var a = t.setJSON(n).readObject();
                        a.isRejected() || (r.push(a),
                        a.then(e.setTextureAttributeAndModes.bind(e, i)))
                    }(u, c[d]);
        return n.all(r).then(function() {
            return e
        })
    }
    ,
    a.Material = function(t, e) {
        var i = t.getJSON();
        return i.Diffuse && i.Emission && i.Specular && void 0 !== i.Shininess ? (a.Object(t, e),
        e.setAmbient(i.Ambient),
        e.setDiffuse(i.Diffuse),
        e.setEmission(i.Emission),
        e.setSpecular(i.Specular),
        e.setShininess(i.Shininess),
        n.resolve(e)) : n.reject()
    }
    ,
    a.BlendFunc = function(t, e) {
        var i = t.getJSON();
        return i.SourceRGB && i.SourceAlpha && i.DestinationRGB && i.DestinationAlpha ? (a.Object(t, e),
        e.setSourceRGB(i.SourceRGB),
        e.setSourceAlpha(i.SourceAlpha),
        e.setDestinationRGB(i.DestinationRGB),
        e.setDestinationAlpha(i.DestinationAlpha),
        n.resolve(e)) : n.reject()
    }
    ,
    a.CullFace = function(t, e) {
        var i = t.getJSON();
        return void 0 === i.Mode ? n.reject() : (a.Object(t, e),
        e.setMode(i.Mode),
        n.resolve(e))
    }
    ,
    a.BlendColor = function(t, e) {
        var i = t.getJSON();
        return i.ConstantColor ? (a.Object(t, e),
        e.setConstantColor(i.ConstantColor),
        n.resolve(e)) : n.reject()
    }
    ,
    a.Light = function(t, e) {
        var i = t.getJSON();
        return i.Ambient && i.Diffuse && i.Direction && i.Position && i.Specular && void 0 !== i.LightNum && void 0 !== i.SpotCutoff && void 0 !== i.LinearAttenuation && void 0 !== i.ConstantAttenuation && void 0 !== i.QuadraticAttenuation ? (a.Object(t, e),
        e.setAmbient(i.Ambient),
        e.setConstantAttenuation(i.ConstantAttenuation),
        e.setDiffuse(i.Diffuse),
        e.setDirection(i.Direction),
        e.setLightNumber(i.LightNum),
        e.setLinearAttenuation(i.LinearAttenuation),
        e.setPosition(i.Position),
        e.setQuadraticAttenuation(i.QuadraticAttenuation),
        e.setSpecular(i.Specular),
        e.setSpotCutoff(i.SpotCutoff),
        e.setSpotBlend(.01),
        void 0 !== i.SpotExponent && e.setSpotBlend(i.SpotExponent / 128),
        n.resolve(e)) : n.reject()
    }
    ,
    a.Texture = function(t, e) {
        var i = t.getJSON();
        a.Object(t, e),
        i.MinFilter && e.setMinFilter(i.MinFilter),
        i.MagFilter && e.setMagFilter(i.MagFilter),
        i.WrapT && e.setWrapT(i.WrapT),
        i.WrapS && e.setWrapS(i.WrapS);
        var n = i.File;
        return void 0 === n && (n = "no-image-provided"),
        t.readImageURL(n).then(function(t) {
            return e.setImage(t),
            e
        })
    }
    ,
    a.Projection = function(t, e) {
        var i = t.getJSON();
        if (!i.Matrix)
            return n.reject();
        var r = a.Node(t, e);
        return e.setMatrix(i.Matrix),
        r
    }
    ,
    a.MatrixTransform = function(t, e) {
        var i = t.getJSON();
        if (!i.Matrix)
            return n.reject();
        var r = a.Node(t, e);
        return e.setMatrix(i.Matrix),
        r
    }
    ,
    a.LightSource = function(t, e) {
        var i = t.getJSON();
        if (!i.Light)
            return n.reject();
        var s = a.Node(t, e);
        return n.all([t.setJSON(i.Light).readObject(), s]).then(function(t) {
            var n = t[0];
            return e.setLight(n),
            "ABSOLUTE_RF" === i.ReferenceFrame && e.setReferenceFrame(r.ABSOLUTE_RF),
            e
        })
    }
    ,
    a.functionSortAttributes = function(t, e) {
        return -1 !== t.indexOf("TexCoord") && -1 !== e.indexOf("TexCoord") ? parseInt(t.substr(8), 10) - parseInt(e.substr(8), 10) : t < e ? -1 : t > e ? 1 : 0
    }
    ,
    a.Geometry = function(t, e) {
        var i = t.getJSON();
        if (!i.VertexAttributeList)
            return n.reject();
        i.PrimitiveSetList = i.PrimitiveSetList || [];
        var r = [];
        r.push(a.Node(t, e));
        var s = e.getPrimitives()
          , o = s.push.bind(s)
          , l = 0
          , u = i.PrimitiveSetList.length;
        for (l = 0; l < u; l++) {
            var h = t.setJSON(i.PrimitiveSetList[l]).readPrimitiveSet();
            r.push(h),
            h.then(o)
        }
        var c = function(t, e) {
            this.getVertexAttributeList()[t] = e
        }
          , d = i.VertexAttributeList
          , p = window.Object.keys(d);
        for (p.sort(a.functionSortAttributes),
        u = p.length,
        l = 0; l < u; l++) {
            var f = p[l]
              , g = t.setJSON(d[f]).readBufferArray();
            r.push(g),
            g.then(c.bind(e, f))
        }
        return n.all(r).then(function() {
            return e
        })
    }
    ,
    a.PagedLOD = function(t, e) {
        var i = t.getJSON();
        a.Object(t, e),
        "USE_BOUNDING_SPHERE_CENTER" === i.CenterMode ? e.setCenterMode(0) : "UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED" === i.CenterMode && e.setCenterMode(2),
        e.setCenter([i.UserCenter[0], i.UserCenter[1], i.UserCenter[2]]),
        e.setRadius(i.UserCenter[3]),
        "PIXEL_SIZE_ON_SCREEN" === i.RangeMode && e.setRangeMode(1);
        for (var r, s = i.RangeList, o = 0; o < window.Object.keys(s).length; o++) {
            r = "Range " + o;
            var l = s[r];
            e.setRange(o, l[0], l[1])
        }
        for (s = i.RangeDataList,
        o = 0; o < window.Object.keys(s).length; o++)
            r = "File " + o,
            e.setFileName(o, s[r]);
        e.setDatabasePath(t.getDatabasePath());
        var u = [];
        if (i.Children)
            for (var h = 0, c = i.Children.length; h < c; h++)
                u.push(t.setJSON(i.Children[h]).readObject());
        return n.all(u).then(function(t) {
            var i = t.length;
            for (o = 0; o < i; o++)
                e.addChildNode(t[o]);
            return e
        })
    }
    ,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = function(t) {
        var e, i = window.WebKitBlobBuilder || window.MozBlobBuilder || window.BlobBuilder;
        e = t.split(",")[0].indexOf("base64") >= 0 ? window.atob(t.split(",")[1]) : window.decodeURI(t.split(",")[1]);
        for (var n = t.split(",")[0].split(":")[1].split(";")[0], r = new ArrayBuffer(e.length), a = new Uint8Array(r), s = 0; s < e.length; s++)
            a[s] = e.charCodeAt(s);
        var o;
        if (void 0 !== window.Blob)
            o = new Blob([a],{
                type: n
            });
        else if (void 0 !== i) {
            var l = new i;
            l.append(r),
            o = l.getBlob(n)
        }
        return o
    };
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = i(51)
      , r = function(t) {
        this._duration = void 0 === t ? 1 : t,
        this.reset()
    };
    r.prototype = {
        getDuration: function() {
            return this._duration
        },
        setDuration: function(t) {
            this._duration = t
        },
        reset: function() {
            this._startTime = -1,
            this._finished = !1,
            this._ratio = 0,
            n.a.draw()
        },
        finished: function() {},
        interpolate: function(t, e, i) {
            if (this._finished)
                return 1;
            this._startTime < 0 && (this._startTime = t);
            var n = Math.min(this._duration, t - this._startTime)
              , r = 0 === this._duration ? 1 : n / this._duration;
            return this._ratio = r,
            (r >= 1 || 0 === this._duration) && (this._finished = !0,
            this.finished(e, i)),
            r
        },
        update: function(t, e) {
            return this.interpolate(e.getFrameStamp().getSimulationTime(), t, e),
            !0
        }
    },
    e.a = r
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = n.a.osgAnimation
      , s = function(t) {
        for (var e = 0, i = t.length; e < i; ++e) {
            var n, s = t[e];
            if (s instanceof a.Bone)
                n = a.UpdateBone;
            else {
                if (!(s instanceof r.MatrixTransform))
                    continue;
                n = a.UpdateMatrixTransform
            }
            for (var o = s.getUpdateCallbackList(), l = 0, u = o.length; l < u; ++l)
                if (o[l]instanceof n)
                    return !0
        }
        return !1
    };
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = function(t, e, i) {
        this._url = t,
        this._defer = r.a.defer(),
        this._responseType = e,
        this._promise = this._defer.promise,
        this._options = i
    };
    a.prototype = {
        getPromise: function() {
            return this._promise
        },
        getURL: function() {
            return this._url
        },
        start: function() {
            this._xhr = new XMLHttpRequest,
            this._xhr.addEventListener("error", this.error.bind(this), !1),
            this._xhr.addEventListener("abort", this.abort.bind(this), !1),
            this._xhr.addEventListener("progress", this.progress.bind(this), !1),
            this._xhr.addEventListener("load", function(t) {
                if (200 !== this._xhr.status)
                    return console.log("Error not loaded " + this._url),
                    void this.error(t);
                this._xhr.response || (this._xhr.response = this._xhr.responseText),
                this.load.call(this)
            }
            .bind(this), !1),
            this._xhr.open("GET", this._url, !0),
            this._xhr.responseType = this._responseType,
            this._xhr.send(null)
        },
        error: function() {
            console.log("Error not loaded " + this._url),
            this._defer.reject(this)
        },
        abort: function() {
            console.log("Error not loaded " + this._url),
            this._defer.reject(this)
        },
        progress: function(t) {
            var e = this._options;
            e && e.progress && e.size && e.progress(t.loaded / e.size, e.secondary, e.idChannel)
        },
        load: function() {
            this._defer.resolve(this)
        },
        getXHR: function() {
            return this._xhr
        }
    },
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(383)
      , a = n.a.osg
      , s = r.a.prototype
      , o = function() {
        r.a.apply(this, arguments),
        this.assignMatcapTexture(),
        this._outputs = [],
        this._index = o.DEFAULT
    }
      , l = o;
    l.DIFFUSE = 1,
    l.SPECULAR = 2,
    l.ROUGHNESS = 4,
    l.GEOMETRY = 8,
    l.EMIT = 16,
    l.ENVIRONMENT = 32,
    l.MATCAP = 64,
    l.WIREFRAME = 128,
    l.DEFAULT = l.DIFFUSE | l.SPECULAR | l.ROUGHNESS | l.GEOMETRY | l.EMIT | l.ENVIRONMENT,
    o.prototype = a.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "Blending"
        },
        setOutputs: function(t, e) {
            this._outputs[0] = t,
            this._outputs[1] = e
        },
        computeShader: function(t) {
            return this._index = t,
            t & o.MATCAP ? this.getMatcapFragment() : this.getDefaultFragment()
        },
        createFragmentShaderGraph: function() {
            var t = this.computeShader(this._outputs[0])
              , e = this._outputs[1] !== this._outputs[0] ? this.computeShader(this._outputs[1]) : t
              , i = this.createVariable("vec3");
            return this.getNode("Blend").mode("MIX").inputs(t, e, this.getOrCreateUniform("float", "uBlend")).outputs(i),
            [this.getFinalFrag(i)]
        },
        getDefaultFragment: function() {
            var t, e = this.createLighting(), i = this._index & l.ENVIRONMENT ? this.getEnvironment() : void 0;
            return e && i ? (t = this.createVariable("vec3"),
            this.getNode("Add").inputs(e, i).outputs(t)) : t = e || i || this.getOrCreateConstantZero("vec3"),
            this._index & l.EMIT && (t = this.applyEmissive(t)),
            t
        },
        getOrCreateMaterialDiffuseColor: function() {
            return this._index & l.DIFFUSE ? s.getOrCreateMaterialDiffuseColor.call(this) : this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialSpecularColor: function() {
            return this._index & l.SPECULAR ? s.getOrCreateMaterialSpecularColor.call(this) : this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialSpecularHardness: function() {
            return this._index & l.SPECULAR ? s.getOrCreateMaterialSpecularHardness.call(this) : this.getOrCreateConstantOne("float")
        },
        getOrCreateMaterialNormal: function() {
            return this._index & l.GEOMETRY ? s.getOrCreateMaterialNormal.call(this) : this.getOrCreateNormalizedFrontViewNormal()
        },
        getMatcapFragment: function() {
            return this.getMatcapColor(this.getOrCreateMaterialNormal())
        }
    }),
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(439)
      , a = i(29)
      , s = n.a.osg
      , o = function() {
        r.a.apply(this, arguments),
        this._isVertexAlpha = !!this._material && this._material.getVertexAlphaEnable(),
        this._isVertexColored = this._isVertexAlpha
    };
    o.prototype = s.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "EarlyZ"
        },
        getOrCreateChannel: function(t) {
            switch (t) {
            case "Opacity":
            case "Displacement":
                return r.a.prototype.getOrCreateChannel.call(this, t)
            }
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {},
        createDepthColor: function() {
            var t = this.createVariable("vec4")
              , e = ["float depth = (-%fragEye.z * %fragEye.w - %nearFar.x) / (%nearFar.y - %nearFar.x);", "%color.rgb = vec3(1.0, 255.0, 65025.0) * depth;", "%color.gb = fract(%color.gb);", "%color.rg -= %color.gb * (1.0/256.0);"]
              , n = i.i(a.a)().ssaoNormal
              , r = {
                fragEye: this.getOrCreateVarying("vec4", "vViewVertex"),
                nearFar: this.getOrCreateUniform("vec2", "uNearFar"),
                normal: n ? this.getOrCreateMaterialNormal() : void 0,
                drawOpaque: this.getOrCreateUniform("int", "uDrawOpaque")
            }
              , s = this.isAlphaBlendedMaterial() ? this.getOrCreateChannel("Opacity") : void 0;
            if (s) {
                r.alpha = s;
                var o = (1 - i.i(a.a)().epsilonAlpha).toExponential();
                e.unshift("if(%drawOpaque == 1 && %alpha < " + o + ") discard;"),
                e.push("%color.a = %drawOpaque == 1 ? 1.0 : %alpha;")
            } else
                e.push("%color.a = 1.0;");
            return n && e.push("%color.ba = normalize(%normal).rg * 0.5 + 0.5;"),
            this.getNode("InlineCode").code(e.join("\n")).inputs(r).outputs({
                color: t
            }),
            t
        },
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.applyPointSizeCircle(t),
            this.applyAlphaMask(t),
            this.getNode("SetFromNode").inputs(this.createDepthColor()).outputs(t),
            [t]
        }
    }),
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(291)
      , r = i(439)
      , a = function() {
        n.a.apply(this, arguments),
        this.setShaderCompiler(r.a)
    };
    a.prototype = n.a.prototype,
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(70)
      , a = i(87)
      , s = i(138)
      , o = i(817)
      , l = i.n(o)
      , u = i(816)
      , h = i.n(u)
      , c = i(1)
      , d = (i.n(c),
    n.a.osg)
      , p = d.BufferArray
      , f = d.Geometry
      , g = d.PrimitiveSet
      , m = d.DrawElements
      , v = d.vec4.fromValues(1, 1, 1, 1)
      , _ = function(t, e, i, n, r, a) {
        d.MatrixTransform.call(this),
        this._subX = void 0 !== r ? r : 1,
        this._subY = void 0 !== a ? a : 1,
        this._curveAxis = i,
        this._curveFactor = n,
        this._distanceFromCam = 2.5,
        this._width = 1,
        e && (this._distanceFromCam = e),
        t && (this._width = t),
        this._clickActions = {},
        this._opacity = 1,
        this._round = .02,
        this._opaqueRollover = !1,
        this._visible = !0,
        this._currentPage = 0,
        this._enabled = !0
    };
    _.AXIS_X = 0,
    _.AXIS_Y = 1,
    _.AXIS_BOTH = 2,
    _.prototype = d.objectInherit(d.MatrixTransform.prototype, {
        initialize: function(t, e) {
            this._texPanel = t,
            this._metaData = this._computeMetaData(e),
            this._panelGeom = this._createGridGeometry(this._metaData.cells),
            this.addChild(this._panelGeom);
            var i = this._panelGeom.getOrCreateStateSet()
              , n = d.Uniform.createFloat1(this._opacity, "uAlpha");
            this._uAlpha = n.getInternalArray(),
            i.addUniform(n);
            var r = d.Uniform.createFloat1(e.aspectRatio, "uRatio");
            this._uRatio = r.getInternalArray(),
            i.addUniform(r);
            var o = d.Uniform.createFloat1(this._enabled ? 1 : .5, "uVeilFactor");
            this._uVeilFactor = o.getInternalArray(),
            i.addUniform(o),
            i.addUniform(d.Uniform.createFloat1(this._opaqueRollover ? 1 : 0, "uHoveredOpaque"));
            var u = d.Uniform.createFloat1(this._round, "uRound");
            i.addUniform(u),
            i.addUniform(d.Uniform.createInt(0, "uTexturePanel")),
            i.setTextureAttributeAndModes(0, this._texPanel),
            i.setAttributeAndModes(new d.CullFace(d.CullFace.DISABLE));
            var c = s.a.getOrCreateShader(l.a, h.a, "textured-panel", "TexturedPanel");
            i.setAttributeAndModes(c);
            var p = d.Uniform.createFloat4(v, "uHoveredArea");
            this._uHoveredArea = p.getInternalArray(),
            i.addUniform(p),
            i.setRenderBinDetails(a.a.VR_MENU, "RenderBin"),
            i.setAttributeAndModes(new d.BlendFunc(d.BlendFunc.ONE,d.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            this.initPage(),
            this._initialized = !0
        },
        changeTexture: function(t) {
            var e = this._panelGeom.getOrCreateStateSet();
            this._texPanel = t,
            e.setTextureAttributeAndModes(0, this._texPanel)
        },
        updateMetaData: function(t) {
            this._metaData = this._computeMetaData(t),
            this._uRatio[0] = this._metaData.aspectRatio
        },
        setEnabled: function(t) {
            this._enabled = t,
            this._uVeilFactor && (this._uVeilFactor[0] = t ? 1 : .5)
        },
        setMetaData: function(t) {
            this._metaData = t,
            this._uRatio[0] = this._metaData.aspectRatio
        },
        getTexture: function() {
            return this._texPanel
        },
        isInitialized: function() {
            return this._initialized
        },
        setVisible: function(t) {
            if (this._visible !== t) {
                if (this._animation) {
                    if (!this._animation.isFinished())
                        return;
                    t && this._doSetVisible(!0),
                    this._animation.start(0)
                } else
                    this._doSetVisible(t);
                this._visible = t
            }
        },
        _doSetVisible: function(t) {
            this.setNodeMask(t ? r.a.PICK_GEOMETRY_FAST : 0),
            this._uAlpha && (this._uAlpha[0] = 1),
            t || this.initPage()
        },
        isVisible: function() {
            return this._visible
        },
        setOpacity: function(t) {
            this._opacity = t,
            this._uAlpha && (this._uAlpha[0] = t)
        },
        updateHit: function(t) {
            if (this._initialized && this._enabled) {
                var e = t && t.point;
                if (!t || -1 === t.nodepath.indexOf(this))
                    return void (void 0 !== this._currentHovered && (this._currentHovered = void 0,
                    d.vec4.copy(this._uHoveredArea, v)));
                var i = {
                    x: (e[0] + .5 * this._width) / this._width,
                    y: (e[1] + .5 * this._height) / this._height
                }
                  , n = this._metaData.pages ? this._findPage(i) : void 0
                  , r = i.x
                  , a = i.y;
                if (n) {
                    var s = n.areas;
                    if (s)
                        for (var o = 0; o < s.length; o++)
                            if (this._checkArea(s[o], r, a, n.items[o], n))
                                return this
                }
                return "WHOLE_PANEL" !== this._currentHovered && (this._currentHovered = "WHOLE_PANEL",
                d.vec4.copy(this._uHoveredArea, v)),
                this
            }
        },
        _findPage: function(t) {
            for (var e = t.x, i = t.y, n = 0; n < this._metaData.cells.length; n++) {
                var r = this._metaData.cells[n]
                  , a = r.x / this._width
                  , s = 1 - r.y / this._height
                  , o = (r.x + r.width) / this._width
                  , l = 1 - (r.y + r.height) / this._height;
                if (e >= a && e <= o && i <= s && i >= l)
                    return t.x = (e - a) / (o - a),
                    t.y = (i - l) / (s - l),
                    r.page
            }
        },
        _checkArea: function(t, e, i, n, r) {
            return e > t[0] && e < t[1] && i < t[2] && i > t[3] && (this._currentHovered !== n && (this._currentHovered = n,
            r ? (this._uHoveredArea[0] = r.x + t[0] * r.width,
            this._uHoveredArea[1] = r.x + t[1] * r.width,
            this._uHoveredArea[2] = 1 - r.y - r.height + t[2] * r.height,
            this._uHoveredArea[3] = 1 - r.y - r.height + t[3] * r.height) : d.vec4.copy(this._uHoveredArea, t)),
            !0)
        },
        click: function() {
            if (this._currentHovered)
                if ("WHOLE_PANEL" !== this._currentHovered) {
                    var t = this._clickActions[this._currentHovered];
                    t && t()
                } else
                    this._panelClickAction && this._panelClickAction()
        },
        initPage: function() {
            this._metaData && this._metaData.pages && this.setPageForCell(this._metaData.pages[0].id, this._metaData.cells[0].id)
        },
        setPageForCell: function(t, e) {
            var i = this._getPage(t);
            if (!i)
                return void d.log("can't find page named " + t + " for panel " + (this._metaData ? this._metaData.id : "unknown"));
            var n = this._getCell(e);
            if (!n)
                return void d.log("can't find cell named " + e + " for panel " + (this._metaData ? this._metaData.id : "unknown"));
            n.page = i;
            for (var r = this._panelGeom.getAttributes().TexCoord0, a = r.getElements(), s = this._subY, o = this._subX, l = n.startIndex ? n.startIndex : 0, u = 0; u <= s; u++)
                for (var h = 0; h <= o; h++) {
                    var c = 2 * l;
                    a[c] = i.x + h / o * i.width,
                    a[c + 1] = 1 - i.y - u / s * i.height,
                    l++
                }
            r.dirty(),
            this._panelGeom.dirty()
        },
        _getPage: function(t) {
            if (this._metaData && this._metaData.pages)
                for (var e = 0; e < this._metaData.pages.length; e++)
                    if (this._metaData.pages[e].id === t)
                        return this._metaData.pages[e]
        },
        _getCell: function(t) {
            if (this._metaData && this._metaData.cells)
                return this._metaData.cells.find(function(e) {
                    return e.id === t
                })
        },
        setClickAction: function(t, e) {
            this._clickActions[t] = e
        },
        removeClickAction: function(t) {
            delete this._clickActions[t]
        },
        setPanelClickAction: function(t) {
            this._panelClickAction = t
        },
        removePanelClickAction: function() {
            this._panelClickAction = void 0
        },
        displayInView: function() {
            var t = d.vec3.create()
              , e = d.vec3.create()
              , i = d.vec3.fromValues(0, 0, .1)
              , n = d.vec3.create();
            return function(r, a, s) {
                d.vec3.copy(t, a),
                t[2] = r[2];
                var o = d.mat4.lookAt(this.getMatrix(), r, t, i);
                d.mat4.invert(o, o);
                var l = s;
                d.mat4.scale(o, o, d.vec3.set(e, l, l, l)),
                d.vec3.sub(n, t, r),
                d.vec3.normalize(n, n),
                d.vec3.scale(n, n, this._distanceFromCam * s),
                d.vec3.add(n, r, n),
                n[2] += -.2 * s,
                d.mat4.setTranslation(o, n),
                this.dirtyBound(),
                this.setVisible(!0)
            }
        }(),
        setAnimation: function(t) {
            t.setOnFinishCallback(this._onAnimationFinished.bind(this)),
            this._animation = t,
            this.addUpdateCallback(t)
        },
        getAnimation: function() {
            return this._animation
        },
        _onAnimationFinished: function() {
            this._visible || this._doSetVisible(!1)
        },
        _computeMetaData: function(t) {
            var e = i.i(c.extend)(t, {
                aspectRatio: t.cellsWidth ? t.cellsWidth / t.cellsHeight : t.width / t.height
            });
            this._height = this._width / e.aspectRatio;
            var n, r;
            if (e.pages)
                for (r = 0; r < e.pages.length; r++) {
                    var a = e.pages[r];
                    if (a.areas)
                        for (n = 0; n < a.areas.length; n++) {
                            var s = a.areas[n];
                            s[0] = s[0] / a.width,
                            s[1] = s[1] / a.width,
                            s[2] = 1 - s[2] / a.height,
                            s[3] = 1 - s[3] / a.height
                        }
                    a.x /= t.width,
                    a.y /= t.height,
                    a.width /= t.width,
                    a.height /= t.height
                }
            if (e.cells && e.cells.length > 0)
                for (n = 0; n < e.cells.length; n++) {
                    var o = e.cells[n];
                    o.x = o.x / e.cellsWidth * this._width,
                    o.y = o.y / e.cellsHeight * this._height,
                    o.z /= 100,
                    o.width = o.width / e.cellsWidth * this._width,
                    o.height = o.height / e.cellsHeight * this._height
                }
            else
                e.cells = [{
                    id: "default",
                    x: 0,
                    y: 0,
                    z: 0,
                    width: this._width,
                    height: this._height
                }];
            return e
        },
        _createTexturedGridGeometry: function(t, e, i, n, r, a, s, o, l, u, h, c) {
            e *= -1,
            o && (l = void 0 !== l ? l : .2);
            for (var d = n / a, p = r / s, f = this._verticesIndex, g = 0, m = 0, v = this._indicesIndex, b = 0, x = 0, y = 0; y <= s; y++)
                for (var S = 0; S <= a; S++)
                    g = 3 * f,
                    m = 2 * f,
                    h[m] = S / a,
                    h[m + 1] = 1 - y / s,
                    o && (o !== _.AXIS_X && o !== _.AXIS_BOTH || (b = S / a - .5,
                    b = b * b * l),
                    o !== _.AXIS_Y && o !== _.AXIS_BOTH || (x = y / s - .5,
                    x = x * x * l)),
                    u[g] = t + d * S,
                    u[g + 1] = e - p * y,
                    u[g + 2] = i + b + x,
                    f++;
            var w = this._verticesIndex;
            this._verticesIndex = f;
            for (var C = 0; C < a * s; C++)
                v = this._indicesIndex + 6 * C,
                f = w + C + Math.floor(C / a),
                c[v] = f,
                c[v + 1] = a + 1 + f,
                c[v + 2] = a + 1 + f + 1,
                c[v + 3] = a + 1 + f + 1,
                c[v + 4] = f + 1,
                c[v + 5] = f;
            this._indicesIndex = v + 6
        },
        _createGridGeometry: function(t) {
            var e = this._subY
              , i = this._subX
              , n = (i + 1) * (e + 1) * t.length
              , r = new f
              , a = new Float32Array(3 * n)
              , s = new Float32Array(2 * n)
              , o = new Float32Array(i * e * 6 * t.length);
            this._verticesIndex = 0,
            this._indicesIndex = 0;
            for (var l = .5 * this._width, u = .5 * this._height, h = 0; h < t.length; h++) {
                var c = t[h];
                c.startIndex = this._verticesIndex,
                this._createTexturedGridGeometry(c.x - l, c.y - u, c.z, c.width, c.height, i, e, this._curveAxis, this._curveFactor, a, s, o),
                this._verticesIndex
            }
            r.getAttributes().Vertex = new p(p.ARRAY_BUFFER,a,3),
            r.getAttributes().TexCoord0 = new p(p.ARRAY_BUFFER,s,2);
            var d = new m(g.TRIANGLES,new p(p.ELEMENT_ARRAY_BUFFER,o,1));
            return r.getPrimitives().push(d),
            r
        }
    }),
    e.a = _
}
, , , , , , , , , , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(2)
      , s = i.n(a)
      , o = i(15)
      , l = i(542)
      , u = "/i/textures";
    e.a = o.a.extend({
        url: function() {
            return this.isNew() ? u : u + "/" + this.get("uid")
        },
        isValid: function() {
            var t = this.get("name");
            return void 0 === t && console.warn("no name for Texture " + this.id),
            t = t || this.id,
            void 0 === this.get("images") && console.warn("no images for Texture " + t),
            void 0 === this.get("uid") && console.warn("no uid for Texture " + t),
            !0
        },
        getName: function() {
            return this.get("name")
        },
        save: function(t, e) {
            null != t && "object" != typeof t || (e = t);
            var i = new FormData;
            return i.append("imageFile", this.get("imageFile"), this.get("name")),
            i.append("colorSpace", this.get("colorSpace")),
            i.append("modelUid", e.modelUID),
            r.a.resolve(s.a.ajax({
                url: this.url(),
                data: i,
                processData: !1,
                contentType: !1,
                type: "POST"
            }))
        },
        saveColorspace: function() {
            return r.a.resolve(s.a.ajax({
                url: this.url(),
                data: {
                    colorSpace: this.get("colorSpace")
                },
                type: "PATCH"
            }))
        }
    }).extend(l.a)
}
, , , function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(15)
      , s = i(551)
      , o = i(89)
      , l = r.a.osg
      , u = i.i(n.invert)(l.Texture)
      , h = ["magFilter", "minFilter", "wrapS", "wrapT", "textureTarget", "internalFormat"]
      , c = a.a.extend({
        initialize: function() {
            if (a.a.prototype.initialize.apply(this, arguments),
            !this.attributes.image)
                return void l.error("no image found in attributes, TextureModel invalid");
            var t = s.a.createValidOptionsForMaterial(this.attributes);
            this.set(t),
            this.setTextureProxyFromValidOptions(t),
            void 0 === this.get("texCoordUnit") && this.set("texCoordUnit", 0),
            this.bind("change:image", this.updateTextureProxy, this)
        },
        getImage: function() {
            return this.get("image")
        },
        setImage: function(t) {
            this.set("image", t)
        },
        getResourceManager: function() {
            return this._resourceManager || o.default.instance
        },
        getTextureProxy: function() {
            return this.get("textureProxy")
        },
        getURL: function() {
            console.trace("dont call TextureModel.getURL")
        },
        setTextureProxyFromValidOptions: function(t) {
            var e = this.get("image").getUID()
              , i = this.getResourceManager().getOrCreateTextureProxy(e, t);
            i && this.set("textureProxy", i.resource)
        },
        updateTextureProxy: function() {
            this.setTextureProxyFromValidOptions(s.a.createValidOptionsForMaterial(this.attributes))
        },
        getUID: function() {
            return this.getImage().getUID()
        },
        getJSON: function() {
            for (var t = {}, e = 0, i = h.length; e < i; ++e) {
                var n = h[e];
                t[n] = u[this.get(n)]
            }
            return t.texCoordUnit = this.get("texCoordUnit"),
            t.uid = this.getUID(),
            t
        }
    });
    e.a = c
}
, , , , , , , , , , , , , , , , function(t, e) {}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(325)
      , a = i(5).vec3
      , s = i(5).vec4
      , o = i(5).quat
      , l = i(5).mat4
      , u = i(65)
      , h = i(144)
      , c = i(128)
      , d = function() {
        r.call(this),
        this._matrix = l.create(),
        this._position = a.create(),
        this._matrixDirty = !0,
        this._scale = a.fromValues(1, 1, 1),
        this._minimumScale = 0,
        this._maximumScale = Number.MAX_VALUE,
        this._rotation = o.create(),
        this._pivotPoint = a.create(),
        this._autoScaleToScreen = !1,
        this._autoRotateToScreen = !1,
        this._cachedMatrix = l.create(),
        this._firstTimeToInitEyePoint = !0,
        this._autoScaleTransitionWidthRatio = .25,
        this._billboardAttribute = void 0,
        this._previousWidth = 0,
        this._previousHeight = 0,
        this._previousProjection = l.create(),
        this._previousModelView = l.create(),
        this._previousPosition = a.create()
    };
    d.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getMatrix: function() {
            return this._matrix
        },
        setMatrix: function(t) {
            this._matrix = t,
            this.dirtyBound()
        },
        setPosition: function(t) {
            this._position = t,
            this._matrixDirty = !0,
            this.dirtyBound()
        },
        getPosition: function() {
            return this._position
        },
        setRotation: function(t) {
            this._rotation = t,
            this._matrixDirty = !0,
            this.dirtyBound()
        },
        getRotation: function() {
            return this._rotation
        },
        setScale: function(t) {
            this.setScaleFromvec3(a.fromValues(t, t, t))
        },
        setScaleFromvec3: function(t) {
            this._scale = t,
            this._matrixDirty = !0,
            this.dirtyBound()
        },
        getScale: function() {
            return this._scale
        },
        setMinimumScale: function(t) {
            this._minimumScale = t
        },
        getMinimumScale: function() {
            return this._minimumScale
        },
        setMaximumScale: function(t) {
            this._maximumScale = t
        },
        getMaximumScale: function() {
            return this._maximumScale
        },
        setAutoScaleToScreen: function(t) {
            this._autoScaleToScreen = t,
            this._matrixDirty = !0
        },
        getAutoScaleToScreen: function() {
            return this._autoScaleToScreen
        },
        setAutoRotateToScreen: function(t) {
            this._autoRotateToScreen = t
        },
        getAutoRotateToScreen: function() {
            return this._autoRotateToScreen
        },
        setAutoScaleTransitionWidthRatio: function(t) {
            this._autoScaleTransitionWidthRatio = t
        },
        getAutoScaleTransitionWidthRatio: function() {
            return this._autoScaleTransitionWidthRatio
        },
        computeLocalToWorldMatrix: function(t) {
            this._matrixDirty && this.computeMatrix(),
            this.referenceFrame === h.RELATIVE_RF ? l.mul(t, t, this._matrix) : l.copy(t, this._matrix)
        },
        computeMatrix: function() {
            var t = a.create()
              , e = l.create();
            return function() {
                this._matrixDirty && (l.fromQuat(this._matrix, this._rotation),
                l.fromTranslation(e, this._position),
                l.mul(this._matrix, e, this._matrix),
                l.scale(this._matrix, this._matrix, this._scale),
                l.translate(this._matrix, this._matrix, a.neg(t, this._pivotPoint)),
                this._matrixDirty = !1)
            }
        }(),
        computeWorldToLocalMatrix: function() {
            var t = a.create()
              , e = o.create()
              , i = a.create()
              , n = l.create();
            return function(r) {
                return (0 !== this.scale[0] || 0 !== this.scale[1] || 0 !== this.scale[2]) && (i[0] = 1 / this._scale[0],
                i[1] = 1 / this._scale[1],
                i[2] = 1 / this._scale[2],
                this.referenceFrame === h.RELATIVE_RF ? (l.fromTranslation(n, a.neg(t, this._position)),
                l.mul(r, n, r),
                o.zeroRotation(this._rotation) || (l.fromQuat(n, o.invert(e, this._rotation)),
                l.mul(r, n, r)),
                l.fromScaling(n, i),
                l.mul(r, n, r),
                l.fromTranslation(n, this._pivotPoint),
                l.mul(r, n, r)) : (l.fromQuat(this._matrix, o.invert(e, this._rotation)),
                l.translate(r, r, a.neg(t, this._position)),
                l.fromScaling(n, i),
                l.mul(r, n, r),
                l.fromTranslation(n, this._pivotPoint),
                l.mul(r, n, r)),
                !0)
            }
        }(),
        computeBound: function() {
            var t = l.create();
            return function(e) {
                return this._autoScaleToScreen && this._firstTimeToInitEyePoint ? e : (c.prototype.computeBound.call(this, e),
                e.valid() ? (l.identity(t),
                this.computeLocalToWorldMatrix(t),
                e.transformMat4(e, t),
                e) : e)
            }
        }(),
        accept: function() {
            return function(t) {
                if (t.getVisitorType() === u.CULL_VISITOR) {
                    var e = t.getViewport().width()
                      , i = t.getViewport().height()
                      , n = t.getCurrentProjectionMatrix()
                      , r = t.getCurrentModelViewMatrix()
                      , h = this._position
                      , d = this._firstTimeToInitEyePoint;
                    if (this._firstTimeToInitEyePoint || (e !== this._previousWidth || i !== this._previousHeight ? d = !0 : l.exactEquals(n, this._previousProjection) && l.exactEquals(r, this._previousModelView) ? a.exactEquals(h, this._previousPosition) || (d = !0) : d = !0),
                    this._firstTimeToInitEyePoint = !1,
                    d) {
                        if (this._autoScaleToScreen) {
                            var p = t.getViewport()
                              , f = this.computePixelSizeVector(p, n, r)
                              , g = s.fromValues(this._position[0], this._position[1], this._position[2], 1)
                              , m = s.dot(g, f);
                            m = .48 / m;
                            var v = 1 / m;
                            if (this._autoScaleTransitionWidthRatio > 0) {
                                var _, b, x;
                                if (this._minimumScale > 0) {
                                    var y = this._minimumScale
                                      , S = this._maximumScale < Number.MAX_VALUE ? this._minimumScale + (this._maximumScale - this._minimumScale) * this._autoScaleTransitionWidthRatio : this._minimumScale * (1 + this._autoScaleTransitionWidthRatio);
                                    _ = 1 / (4 * (S - y)),
                                    b = 1 - 2 * _ * S,
                                    x = y + b * b / (4 * _);
                                    v < -b / (2 * _) ? v = this._minimumScale : v < S && (v = x + b * v + _ * (v * v))
                                }
                                if (this._maximumScale < Number.MAX_VALUE) {
                                    var w = this._maximumScale
                                      , C = this._minimumScale > 0 ? this._maximumScale + (this._minimumScale - this._maximumScale) * this._autoScaleTransitionWidthRatio : this._maximumScale * (1 - this._autoScaleTransitionWidthRatio);
                                    _ = 1 / (4 * (C - w)),
                                    b = 1 - 2 * _ * C,
                                    x = w + b * b / (4 * _);
                                    v > -b / (2 * _) ? v = this._maximumScale : v > C && (v = x + b * v + _ * (v * v))
                                }
                            }
                            this.setScale(v)
                        }
                        if (this._autoRotateToScreen) {
                            var M = o.create();
                            l.getRotation(M, r),
                            this.setRotation(o.invert(M, M))
                        }
                        this._previousWidth = e,
                        this._previousHeight = i,
                        a.copy(this._previousPosition, h),
                        l.copy(this._previousProjection, n),
                        l.copy(this._previousModelView, r)
                    }
                }
                c.prototype.accept.call(this, t)
            }
        }(),
        computePixelSizeVector: function() {
            var t = a.create()
              , e = a.create();
            return function(i, n, r) {
                var o = n[0] * i.width() * .5
                  , l = n[8] * i.width() * .5 + n[11] * i.width() * .5;
                a.set(t, r[0] * o + r[2] * l, r[4] * o + r[6] * l, r[8] * o + r[10] * l);
                var u = n[5] * i.height() * .5
                  , h = n[9] * i.height() * .5 + n[11] * i.height() * .5;
                a.set(e, r[1] * u + r[2] * h, r[5] * u + r[6] * h, r[9] * u + r[10] * h);
                var c = n[11]
                  , d = n[15]
                  , p = s.fromValues(r[2] * c, r[6] * c, r[10] * c, r[14] * c + r[15] * d)
                  , f = .7071067811 / Math.sqrt(a.sqrLen(t) + a.sqrLen(e));
                return s.scale(p, p, f),
                p
            }
        }()
    }), "osg", "AutoTransform"),
    n.setTypeID(d),
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = function(t) {
        r.call(this),
        this.setMode(void 0 !== t ? t : a.BACK)
    };
    a.DISABLE = 0,
    a.FRONT = 1028,
    a.BACK = 1029,
    a.FRONT_AND_BACK = 1032,
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "CullFace",
        cloneType: function() {
            return new a
        },
        setMode: function(t) {
            var e = t;
            "string" == typeof e && (e = a[e]),
            this._mode = e
        },
        getMode: function() {
            return this._mode
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            this._mode === a.DISABLE ? e.disable(e.CULL_FACE) : (e.enable(e.CULL_FACE),
            e.cullFace(this._mode))
        }
    }), "osg", "CullFace"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(128)
      , a = i(144)
      , s = i(5).vec3
      , o = function() {
        r.call(this),
        this._light = void 0,
        this._referenceFrame = a.RELATIVE_RF
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getLight: function() {
            return this._light
        },
        setLight: function(t) {
            this._light = t
        },
        setReferenceFrame: function(t) {
            this._referenceFrame = t
        },
        getReferenceFrame: function() {
            return this._referenceFrame
        },
        computeBoundingSphere: function() {
            var t = s.create();
            return function(e) {
                if (r.prototype.computeBoundingSphere.call(this, e),
                void 0 !== this._light && this._referenceFrame === a.RELATIVE_RF) {
                    var i = this._light.getPosition();
                    0 !== i[3] && e.expandByvec3(s.scale(t, i, 1 / i[3]))
                }
                return e
            }
        }()
    }), "osg", "LightSource"),
    n.setTypeID(o),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(128)
      , a = i(65)
      , s = i(5).mat4
      , o = i(5).vec2
      , l = i(5).vec3
      , u = i(408)
      , h = function() {
        r.call(this),
        this._radius = -1,
        this._range = [],
        this._rangeMode = h.DISTANCE_FROM_EYE_POINT,
        this._userDefinedCenter = [],
        this._centerMode = h.USE_BOUNDING_SPHERE_CENTER
    };
    h.DISTANCE_FROM_EYE_POINT = 0,
    h.PIXEL_SIZE_ON_SCREEN = 1,
    h.USE_BOUNDING_SPHERE_CENTER = 0,
    h.USER_DEFINED_CENTER = 1,
    h.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED = 2,
    h.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getRadius: function() {
            return this._radius
        },
        setRadius: function(t) {
            this._radius = t
        },
        setCenter: function(t) {
            this._centerMode !== h.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED && (this._centerMode = h.USER_DEFINED_CENTER),
            this._userDefinedCenter = t
        },
        getCenter: function() {
            return this._centerMode === h.USER_DEFINED_CENTER || this._centerMode === h.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED ? this._userDefinedCenter : this.getBound().center()
        },
        setCenterMode: function(t) {
            this._centerMode = t
        },
        computeBoundingSphere: function(t) {
            if (this._centerMode === h.USER_DEFINED_CENTER && this._radius >= 0)
                return t.set(this._userDefinedCenter, this._radius),
                t;
            if (this._centerMode === h.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED && this._radius >= 0) {
                t.set(this._userDefinedCenter, this._radius);
                var e = new u;
                return t.expandByBoundingSphere(r.prototype.computeBoundingSphere.call(this, e)),
                t
            }
            return r.prototype.computeBoundingSphere.call(this, t),
            t
        },
        projectBoundingSphere: function() {
            var t = l.create();
            return function(e, i, n) {
                l.transformMat4(t, e.center(), i);
                var r = e.radius2()
                  , a = t[2] * t[2]
                  , s = l.sqrLen(t);
                return -Math.PI * n * n * r * Math.sqrt(Math.abs((s - r) / (r - a))) / (r - a)
            }
        }(),
        setRangeMode: function(t) {
            this._rangeMode = t
        },
        addChildNode: function(t) {
            if (r.prototype.addChild.call(this, t),
            this.children.length > this._range.length) {
                var e = []
                  , i = 0;
                this._range.lenght > 0 && (i = this._range[this._range.length - 1][1]),
                e.push(o.fromValues(i, i)),
                this._range.push(e)
            }
            return !0
        },
        addChild: function(t, e, i) {
            if (r.prototype.addChild.call(this, t),
            this.children.length > this._range.length) {
                var n = [];
                n.push(o.fromValues(e, e)),
                this._range.push(n)
            }
            return this._range[this.children.length - 1][0] = e,
            this._range[this.children.length - 1][1] = i,
            !0
        },
        traverse: function() {
            var t = l.create()
              , e = l.create()
              , i = s.create();
            return function(n) {
                switch (n.traversalMode) {
                case a.TRAVERSE_ALL_CHILDREN:
                    for (var r = 0; r < this.children.length; r++)
                        this.children[r].accept(n);
                    break;
                case a.TRAVERSE_ACTIVE_CHILDREN:
                    var o = 0
                      , u = n.getCurrentModelViewMatrix();
                    if (s.invert(i, u),
                    this._rangeMode === h.DISTANCE_FROM_EYE_POINT)
                        l.transformMat4(e, t, i),
                        o = l.distance(this.getBound().center(), e) * n.getLODScale();
                    else {
                        var c = n.getCurrentProjectionMatrix();
                        o = this.projectBoundingSphere(this.getBound(), u, c[0]),
                        o = o * n.getViewport().width() * n.getViewport().width() * .25 / n.getLODScale()
                    }
                    var d = this.children.length;
                    this._range.length < d && (d = this._range.length);
                    for (var p = 0; p < d; ++p)
                        this._range[p][0] <= o && o < this._range[p][1] && this.children[p].accept(n)
                }
            }
        }()
    }), "osg", "Lod"),
    n.setTypeID(h),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = i(5).vec4
      , s = i(81)
      , o = function() {
        r.call(this),
        this._ambient = a.fromValues(.2, .2, .2, 1),
        this._diffuse = a.fromValues(.8, .8, .8, 1),
        this._specular = a.fromValues(0, 0, 0, 1),
        this._emission = a.fromValues(0, 0, 0, 1),
        this._shininess = 12.5
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Material",
        cloneType: function() {
            return new o
        },
        getParameterName: function(t) {
            return "u" + this.getType() + "_" + t
        },
        getOrCreateUniforms: function() {
            var t = o;
            return t.uniforms ? t.uniforms : (t.uniforms = {
                ambient: s.createFloat4("uMaterialAmbient"),
                diffuse: s.createFloat4("uMaterialDiffuse"),
                specular: s.createFloat4("uMaterialSpecular"),
                emission: s.createFloat4("uMaterialEmission"),
                shininess: s.createFloat1("uMaterialShininess")
            },
            t.uniforms)
        },
        setEmission: function(t) {
            a.copy(this._emission, t)
        },
        getEmission: function() {
            return this._emission
        },
        setAmbient: function(t) {
            a.copy(this._ambient, t)
        },
        getAmbient: function() {
            return this._ambient
        },
        setSpecular: function(t) {
            a.copy(this._specular, t)
        },
        getSpecular: function() {
            return this._specular
        },
        setDiffuse: function(t) {
            a.copy(this._diffuse, t)
        },
        getDiffuse: function() {
            return this._diffuse
        },
        setShininess: function(t) {
            this._shininess = t
        },
        getShininess: function() {
            return this._shininess
        },
        setTransparency: function(t) {
            this._diffuse[3] = 1 - t
        },
        getTransparency: function() {
            return this._diffuse[3]
        },
        apply: function() {
            var t = this.getOrCreateUniforms();
            t.ambient.setFloat4(this._ambient),
            t.diffuse.setFloat4(this._diffuse),
            t.specular.setFloat4(this._specular),
            t.emission.setFloat4(this._emission),
            t.shininess.setFloat(this._shininess)
        }
    }), "osg", "Material"),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n, r = i(28), a = i(13), s = {
        antialias: !0,
        fullscreen: !0,
        enableFrustumCulling: !1,
        stats: !1,
        scrollwheel: !0,
        webgl2: !1
    }, o = function() {
        for (var t in s)
            this[t] = s[t]
    };
    o.getOptionsURL = function() {
        if (n)
            return n;
        if (n = {},
        !window.location.search)
            return n;
        for (var t, e = [], i = window.location.search.slice(1).split("&"), a = 0; a < i.length; a++) {
            t = i[a].split("=");
            var s = t[0];
            e.push(s);
            var o = t[1];
            "0" !== o && "false" !== o && (void 0 === o && (o = "1"),
            n[s] = o)
        }
        if (void 0 !== n.log) {
            switch (n.log.toLowerCase()) {
            case "debug":
                r.setNotifyLevel(r.DEBUG);
                break;
            case "info":
                r.setNotifyLevel(r.INFO);
                break;
            case "notice":
                r.setNotifyLevel(r.NOTICE);
                break;
            case "warn":
                r.setNotifyLevel(r.WARN);
                break;
            case "error":
                r.setNotifyLevel(r.ERROR);
                break;
            case "html":
                var l = []
                  , u = document.createElement("div")
                  , h = document.createElement("pre");
                document.addEventListener("DOMContentLoaded", function() {
                    document.body.appendChild(u),
                    u.appendChild(h)
                });
                var c = function(t) {
                    l.unshift(t),
                    h.innerHTML = l.join("\n")
                };
                u.style.overflow = "hidden",
                u.style.position = "absolute",
                u.style.zIndex = "10000",
                u.style.height = "100%",
                u.style.maxWidth = "600px",
                h.style.overflow = "scroll",
                h.style.width = "105%",
                h.style.height = "100%",
                h.style.fontSize = "10px",
                ["log", "error", "warn", "info", "debug"].forEach(function(t) {
                    window.console[t] = c
                })
            }
        }
        return n
    }
    ,
    o.prototype = {
        extend: function(t) {
            return a.objectMix(this, t),
            this
        },
        get: function(t) {
            return this[t]
        },
        getBoolean: function(t) {
            var e = this.getString(t);
            if (e)
                return "false" !== e && "0" !== e
        },
        getNumber: function(t) {
            var e = this[t];
            if (e)
                return Number(e)
        },
        getString: function(t) {
            if (void 0 !== this[t])
                return this[t].toString()
        },
        extendWithOptionsURL: function() {
            this.extend(o.getOptionsURL())
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(518)
      , a = i(65)
      , s = i(5).mat4
      , o = i(5).vec3
      , l = function() {
        r.call(this),
        this._perRangeDataList = [],
        this._loading = !1,
        this._expiryTime = 0,
        this._expiryFrame = 0,
        this._centerMode = r.USER_DEFINED_CENTER,
        this._frameNumberOfLastTraversal = 0,
        this._databasePath = "",
        this._numChildrenThatCannotBeExpired = 0
    }
      , u = function() {
        this.filename = "",
        this.function = void 0,
        this.loaded = !1,
        this.timeStamp = 0,
        this.frameNumber = 0,
        this.frameNumberOfLastTraversal = 0,
        this.dbrequest = void 0
    };
    l.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        setRange: function(t, e, i) {
            if (t >= this._range.length) {
                var n = [];
                n.push([e, e]),
                this._range.push(n)
            }
            this._range[t][0] = e,
            this._range[t][1] = i
        },
        setExpiryTime: function(t) {
            this._expiryTime = t
        },
        setDatabasePath: function(t) {
            this._databasePath = t
        },
        getDatabasePath: function() {
            return this._databasePath
        },
        setFileName: function(t, e) {
            if (t >= this._perRangeDataList.length) {
                var i = new u;
                i.filename = e,
                this._perRangeDataList.push(i)
            } else
                this._perRangeDataList[t].filename = e
        },
        setFunction: function(t, e) {
            if (t >= this._perRangeDataList.length) {
                var i = new u;
                i.function = e,
                this._perRangeDataList.push(i)
            } else
                this._perRangeDataList[t].function = e
        },
        addChild: function(t, e, i) {
            r.prototype.addChild.call(this, t, e, i),
            this._perRangeDataList.push(new u)
        },
        addChildNode: function(t) {
            r.prototype.addChildNode.call(this, t)
        },
        setFrameNumberOfLastTraversal: function(t) {
            this._frameNumberOfLastTraversal = t
        },
        getFrameNumberOfLastTraversal: function() {
            return this._frameNumberOfLastTraversal
        },
        setTimeStamp: function(t, e) {
            this._perRangeDataList[t].timeStamp = e
        },
        setFrameNumber: function(t, e) {
            this._perRangeDataList[t].frameNumber = e
        },
        setNumChildrenThatCannotBeExpired: function(t) {
            this._numChildrenThatCannotBeExpired = t
        },
        getNumChildrenThatCannotBeExpired: function() {
            return this._numChildrenThatCannotBeExpired
        },
        getDatabaseRequest: function(t) {
            return this._perRangeDataList[t].dbrequest
        },
        removeExpiredChildren: function(t, e, i) {
            if (!(this.children.length <= this._numChildrenThatCannotBeExpired)) {
                var n, r, a = this.children.length - 1;
                n = this._perRangeDataList[a].timeStamp + this._expiryTime,
                r = this._perRangeDataList[a].frameNumber + this._expiryFrame,
                n < t && r < e && (this._perRangeDataList[a].filename.length > 0 || void 0 !== this._perRangeDataList[a].function) && (i.push(this.children[a]),
                this.removeChild(this.children[a]),
                this._perRangeDataList[a].loaded = !1,
                void 0 !== this._perRangeDataList[a].dbrequest && (this._perRangeDataList[a].dbrequest._groupExpired = !0))
            }
        },
        traverse: function() {
            var t = o.create()
              , e = o.create()
              , i = s.create();
            return function(n) {
                var l = n.traversalMode
                  , u = !1;
                switch (n.getVisitorType() === a.CULL_VISITOR && (this._frameNumberOfLastTraversal = n.getFrameStamp().getFrameNumber(),
                u = !0),
                l) {
                case a.TRAVERSE_ALL_CHILDREN:
                    for (var h = 0; h < this.children.length; h++)
                        this.children[h].accept(n);
                    break;
                case a.TRAVERSE_ACTIVE_CHILDREN:
                    var c = 0
                      , d = n.getCurrentModelViewMatrix();
                    if (s.invert(i, d),
                    this._rangeMode === r.DISTANCE_FROM_EYE_POINT) {
                        o.transformMat4(e, t, i);
                        c = o.distance(this.getBound().center(), e) * n.getLODScale()
                    } else {
                        var p = n.getCurrentProjectionMatrix();
                        c = this.projectBoundingSphere(this.getBound(), d, p[0]),
                        c = c * n.getViewport().width() * n.getViewport().width() * .25 / n.getLODScale(),
                        c < 0 && (c = this._range[this._range.length - 1][0])
                    }
                    for (var f = !1, g = -1, m = 0; m < this._range.length; ++m)
                        this._range[m][0] <= c && c < this._range[m][1] && (m < this.children.length ? (u && (this._perRangeDataList[m].timeStamp = n.getFrameStamp().getSimulationTime(),
                        this._perRangeDataList[m].frameNumber = n.getFrameStamp().getFrameNumber()),
                        this.children[m].accept(n),
                        g = m) : f = !0);
                    if (f) {
                        var v = this.children.length;
                        if (v > 0 && v - 1 !== g && (u && (this._perRangeDataList[v - 1].timeStamp = n.getFrameStamp().getSimulationTime(),
                        this._perRangeDataList[v - 1].frameNumber = n.getFrameStamp().getFrameNumber()),
                        this.children[v - 1].accept(n)),
                        v < this._perRangeDataList.length) {
                            var _ = (this._range[v][0] - c) / (this._range[v][1] - this._range[v][0]);
                            this._rangeMode === r.PIXEL_SIZE_ON_SCREEN && (_ = -_);
                            var b = n.nodePath[n.nodePath.length - 1];
                            if (!1 === this._perRangeDataList[v].loaded) {
                                this._perRangeDataList[v].loaded = !0;
                                var x = n.getDatabaseRequestHandler();
                                this._perRangeDataList[v].dbrequest = x.requestNodeFile(this._perRangeDataList[v].function, this._databasePath + this._perRangeDataList[v].filename, b, n.getFrameStamp().getSimulationTime(), _)
                            } else
                                void 0 !== this._perRangeDataList[v].dbrequest ? (this._perRangeDataList[v].dbrequest._timeStamp = n.getFrameStamp().getSimulationTime(),
                                this._perRangeDataList[v].dbrequest._priority = _) : this._perRangeDataList[v].loaded = !1
                        }
                    }
                }
            }
        }()
    }), "osg", "PagedLOD"),
    n.setTypeID(l),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(128)
      , a = i(5).mat4
      , s = function() {
        r.call(this),
        this.projection = a.create()
    };
    s.prototype = n.objectInherit(r.prototype, {
        getProjectionMatrix: function() {
            return this.projection
        },
        setProjectionMatrix: function(t) {
            this.projection = t
        }
    }),
    n.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(272)
      , a = i(378)
      , s = i(28)
      , o = i(458)
      , l = i(5).vec4
      , u = function() {
        o.call(this),
        this.clearColor = l.create(),
        this.preRenderList = [],
        this.postRenderList = [],
        u.prototype.init.call(this)
    };
    u.prototype = n.objectLibraryClass(n.objectInherit(o.prototype, {
        constructor: u,
        init: function() {
            return o.prototype.init.call(this),
            this.positionedAttribute.length = 0,
            this.clearDepth = 1,
            l.set(this.clearColor, 0, 0, 0, 1),
            this.clearMask = r.COLOR_BUFFER_BIT | r.DEPTH_BUFFER_BIT,
            this.camera = void 0,
            this.viewport = void 0,
            this.preRenderList.length = 0,
            this.postRenderList.length = 0,
            this._renderStage = this,
            this
        },
        reset: function() {
            o.prototype.reset.call(this),
            this.preRenderList.length = 0,
            this.postRenderList.length = 0
        },
        setClearDepth: function(t) {
            this.clearDepth = t
        },
        getClearDepth: function() {
            return this.clearDepth
        },
        setClearColor: function(t) {
            l.copy(this.clearColor, t)
        },
        getClearColor: function() {
            return this.clearColor
        },
        setClearMask: function(t) {
            this.clearMask = t
        },
        getClearMask: function() {
            return this.clearMask
        },
        setViewport: function(t) {
            this.viewport = t
        },
        getViewport: function() {
            return this.viewport
        },
        setCamera: function(t) {
            this.camera = t
        },
        getCamera: function() {
            return this.camera
        },
        getPositionedAttribute: function() {
            return this.positionedAttribute
        },
        getPreRenderStageList: function() {
            return this.preRenderList
        },
        getPostRenderStageList: function() {
            return this.postRenderList
        },
        addPreRenderStage: function(t, e) {
            for (var i = 0, n = this.preRenderList.length; i < n; i++) {
                if (e < this.preRenderList[i].order)
                    break
            }
            i < this.preRenderList.length ? this.preRenderList = this.preRenderList.splice(i, 0, {
                order: e,
                renderStage: t
            }) : this.preRenderList.push({
                order: e,
                renderStage: t
            })
        },
        addPostRenderStage: function(t, e) {
            for (var i = 0, n = this.postRenderList.length; i < n; i++) {
                if (e < this.postRenderList[i].order)
                    break
            }
            i < this.postRenderList.length ? this.postRenderList = this.postRenderList.splice(i, 0, {
                order: e,
                renderStage: t
            }) : this.postRenderList.push({
                order: e,
                renderStage: t
            })
        },
        drawPreRenderStages: function(t, e) {
            for (var i = e, n = 0, r = this.preRenderList.length; n < r; ++n) {
                i = this.preRenderList[n].renderStage.draw(t, i)
            }
            return i
        },
        draw: function(t, e) {
            this.camera && this.camera.getInitialDrawCallback() && this.camera.getInitialDrawCallback()(t);
            var i = this.drawPreRenderStages(t, e);
            return i = this.drawImplementation(t, i),
            i = this.drawPostRenderStages(t, i),
            this.camera && this.camera.getFinalDrawCallback() && this.camera.getFinalDrawCallback()(t),
            i
        },
        sort: function() {
            for (var t = 0, e = this.preRenderList.length; t < e; ++t)
                this.preRenderList[t].renderStage.sort();
            o.prototype.sort.call(this);
            for (var i = 0, n = this.postRenderList.length; i < n; ++i)
                this.postRenderList[i].renderStage.sort()
        },
        drawPostRenderStages: function(t, e) {
            for (var i = e, n = 0, r = this.postRenderList.length; n < r; ++n) {
                i = this.postRenderList[n].renderStage.draw(t, i)
            }
            return i
        },
        applyCamera: function(t) {
            var e = t.getGraphicContext();
            if (void 0 === this.camera)
                return void e.bindFramebuffer(e.FRAMEBUFFER, null);
            var i = this.camera.getViewport()
              , n = this.camera.frameBufferObject;
            if (n || (n = new a,
            this.camera.frameBufferObject = n),
            n.isDirty()) {
                var r, s, o = this.camera.getAttachments(), l = o[a.COLOR_ATTACHMENT0];
                l && l.texture && (r = l.texture.getWidth(),
                s = l.texture.getHeight());
                for (var u in o) {
                    l = o[u];
                    var h = {};
                    h.attachment = l.attachment,
                    void 0 === l.texture ? (h.format = l.format,
                    h.width = void 0 !== r ? r : i.width(),
                    h.height = void 0 !== s ? s : i.height()) : (h.texture = l.texture,
                    h.textureTarget = l.textureTarget,
                    l.format && (h.format = l.format)),
                    n.setAttachment(h)
                }
            }
            n.apply(t)
        },
        drawImplementation: function(t, e) {
            var i = t.getGraphicContext();
            if (this.applyCamera(t),
            void 0 === this.viewport && s.log("RenderStage does not have a valid viewport"),
            t.applyAttribute(this.viewport),
            this.camera) {
                var n = this.camera.getStateSet() && this.camera.getStateSet().getAttribute("Scissor");
                n && t.applyAttribute(n)
            }
            return 0 !== this.clearMask && (this.clearMask & i.COLOR_BUFFER_BIT && i.clearColor(this.clearColor[0], this.clearColor[1], this.clearColor[2], this.clearColor[3]),
            this.clearMask & i.DEPTH_BUFFER_BIT && (i.depthMask(!0),
            i.clearDepth(this.clearDepth)),
            i.clear(this.clearMask)),
            0 !== this.positionedAttribute.length && this.applyPositionedAttribute(t, this.positionedAttribute),
            o.prototype.drawImplementation.call(this, t, e)
        }
    }), "osg", "RenderStage"),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(134)
      , r = i(321)
      , a = i(320)
      , s = function() {}
      , o = s.functorDrawElements = []
      , l = s.functorDrawArrays = [];
    o[n.TRIANGLES] = function(t, e, i, n) {
        for (var r = t + e, a = t; a < r; a += 3)
            n(i[a], i[a + 1], i[a + 2])
    }
    ,
    o[n.TRIANGLE_STRIP] = function(t, e, i, n) {
        for (var r = 2, a = t; r < e; ++r,
        ++a)
            r % 2 ? n(i[a], i[a + 2], i[a + 1]) : n(i[a], i[a + 1], i[a + 2])
    }
    ,
    o[n.TRIANGLE_FAN] = function(t, e, i, n) {
        for (var r = i[t], a = 2, s = t + 1; a < e; ++a,
        ++s)
            n(r, i[s], i[s + 1])
    }
    ,
    l[n.TRIANGLES] = function(t, e, i) {
        for (var n = 2, r = t; n < e; n += 3,
        r += 3)
            i(r, r + 1, r + 2)
    }
    ,
    l[n.TRIANGLE_STRIP] = function(t, e, i) {
        for (var n = 2, r = t; n < e; ++n,
        ++r)
            n % 2 ? i(r, r + 2, r + 1) : i(r, r + 1, r + 2)
    }
    ,
    l[n.TRIANGLE_FAN] = function(t, e, i) {
        for (var n = 2, r = t + 1; n < e; ++n,
        ++r)
            i(t, r, r + 1)
    }
    ,
    s.prototype = {
        init: function(t, e) {
            this._geom = t,
            this._cb = e
        },
        apply: function() {
            var t = this._geom
              , e = t.getPrimitiveSetList();
            if (e)
                for (var i, n = this._cb, s = e.length, u = 0; u < s; u++) {
                    var h = e[u];
                    if (h instanceof r) {
                        if (i = o[h.getMode()]) {
                            var c = h.indices.getElements();
                            i(h.getFirst() / c.BYTES_PER_ELEMENT, h.getCount(), c, n)
                        }
                    } else
                        h instanceof a && (i = l[h.getMode()]) && i(h.getFirst(), h.getCount(), n)
                }
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(85)
      , a = i(5).mat4
      , s = i(5).vec3
      , o = i(354)
      , l = function(t, e) {
        r.call(this),
        this._target = o.createVec3Target(e || s.ONE),
        t && this.setName(t)
    };
    l.prototype = n.objectInherit(r.prototype, {
        init: function(t) {
            this.setScale(t),
            s.copy(this._target.defaultValue, t)
        },
        setScale: function(t) {
            s.copy(this._target.value, t)
        },
        getTarget: function() {
            return this._target
        },
        resetToDefaultValue: function() {
            this.setScale(this._target.defaultValue)
        },
        applyToMatrix: function(t) {
            var e = this._target.value;
            a.scale(t, t, e)
        }
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(28)
      , a = i(460)
      , s = i(5).mat4
      , o = i(65)
      , l = function() {
        a.call(this)
    };
    l.prototype = n.objectInherit(a.prototype, {
        update: function(t, e) {
            if (e.getVisitorType() === o.UPDATE_VISITOR) {
                if (t.className && "Bone" !== t.className())
                    return r.warn("Warning: UpdateBone set on non-Bone object."),
                    !1;
                var i = t;
                a.prototype.update.call(this, t),
                i.setMatrix(i.getMatrix());
                var n = i.getMatrix()
                  , l = i.getBoneParent();
                l ? s.mul(i.getMatrixInSkeletonSpace(), l.getMatrixInSkeletonSpace(), n) : i.setMatrixInSkeletonSpace(n)
            }
            return !0
        }
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(162)
      , a = i(415)
      , s = i(434)
      , o = i(354)
      , l = i(381)
      , u = function() {
        s.call(this),
        this._targets = [],
        this._targetNames = [],
        this._morphs = [],
        this._weights = new Float32Array(l.MAX_MORPH_GPU),
        this._indexMap = new Uint32Array(l.MAX_MORPH_GPU),
        this._gpuMorphed = [],
        this._maxMorphGPU = -1
    }
      , h = l.EFFECTIVE_EPS
      , c = function(t, e) {
        return Math.abs(e.value) - Math.abs(t.value)
    };
    u.prototype = n.objectInherit(s.prototype, {
        init: function(t) {
            this._maxMorphGPU = l.MAX_MORPH_GPU,
            this._morphs.length = 0;
            for (var e = t.getChildren(), i = 0, n = e.length; i < n; i++) {
                var r, s = e[i];
                s instanceof l ? r = s : s instanceof a && s.getSourceGeometry()instanceof l && (r = s.getSourceGeometry()),
                r && (r.getName() === this.getName() && (r.isInitialized() || r.init(),
                this._morphs.push(r),
                this._maxMorphGPU = Math.min(this._maxMorphGPU, r.getMaximumPossibleMorphGPU())))
            }
        },
        isInitialized: function() {
            var t = this._morphs
              , e = t.length;
            if (!e)
                return !1;
            for (var i = 0; i < e; ++i)
                if (!t[i].isInitialized())
                    return !1;
            return !0
        },
        getNumTarget: function() {
            return this._targets.length
        },
        getTarget: function(t) {
            return this._targets[t]
        },
        getTargetName: function(t) {
            return this._targetNames[t]
        },
        addTarget: function(t, e) {
            this._targets[e] = o.createFloatTarget(0),
            this._targetNames[e] = t
        },
        _remapBufferArrays: function() {
            for (var t = this._indexMap, e = this._morphs, i = 0; i < this._maxMorphGPU; ++i)
                for (var n = t[i], r = "_" + i, a = "_" + n, s = 0, o = e.length; s < o; ++s)
                    for (var l = e[s], u = l.getVertexAttributeList(), h = l.getMorphTargetNames(), c = 0, d = h.length; c < d; ++c) {
                        var p = h[c];
                        u[p + r].setBufferArray(u[p + a].getInitialBufferArray())
                    }
        },
        _mergeExtraMorphTarget: function(t, e, i) {
            var n = 0
              , a = this._gpuMorphed
              , s = t[e]
              , o = s.getElements().length
              , l = o / s.getItemSize()
              , u = s.getItemSize();
            s._cpuMorph = s._cpuMorph || new r(r.ARRAY_BUFFER,new Float32Array(o),u);
            var c = s._cpuMorph.getElements();
            for (n = 0; n < o; ++n)
                c[n] = 0;
            for (var d = this._targets, p = 0, f = d.length; p < f; ++p)
                if (!0 !== a[p]) {
                    var g = d[p].value;
                    if (!(Math.abs(g) < h)) {
                        g /= i;
                        var m = t[e + "_" + p].getInitialBufferArray().getElements();
                        for (n = 0; n < l; ++n) {
                            var v = n * u;
                            c[v] += g * m[v],
                            c[v + 1] += g * m[v + 1],
                            c[v + 2] += g * m[v + 2]
                        }
                    }
                }
            t[e + "_" + (this._maxMorphGPU - 1)].setBufferArray(s._cpuMorph),
            s._cpuMorph.dirty()
        },
        _computeExtraWeightsSum: function() {
            for (var t = this._gpuMorphed, e = 0, i = this._targets, n = 0, r = i.length; n < r; ++n)
                if (!0 !== t[n]) {
                    var a = i[n].value;
                    Math.abs(a) < h || (e += a)
                }
            return Math.abs(e) > 1e-5 ? e : e < 0 ? -1e-5 : 1e-5
        },
        _morphBufferArrayCPU: function() {
            for (var t = this._weights[this._maxMorphGPU - 1] = this._computeExtraWeightsSum(), e = {}, i = this._morphs, n = 0, r = i.length; n < r; ++n)
                for (var a = i[n], s = a.getVertexAttributeList(), o = a.getMorphTargetNames(), l = 0, u = o.length; l < u; ++l) {
                    var h = o[l]
                      , c = s[h];
                    c && !e[c.getInstanceID()] && (e[c.getInstanceID()] = !0,
                    this._mergeExtraMorphTarget(s, h, t))
                }
        },
        updateWeights: function() {
            if (0 !== this._maxMorphGPU) {
                var t = 0
                  , e = this._targets
                  , i = e.length
                  , n = this._weights;
                if (n[0] = n[1] = n[2] = n[3] = 0,
                i <= this._maxMorphGPU)
                    for (t = 0; t < i; ++t)
                        n[t] = e[t].value;
                else {
                    var r = this._indexMap;
                    r[0] = r[1] = r[2] = r[3] = 0;
                    var a = this._gpuMorphed;
                    for (a.length = i,
                    t = 0; t < i; ++t)
                        a[t] = !1;
                    var s = e.slice(0).sort(c);
                    for (t = 0; t < this._maxMorphGPU; ++t) {
                        var o = e.indexOf(s[t]);
                        a[o] = !0,
                        r[t] = o,
                        n[t] = s[t].value
                    }
                    var l = Math.abs(s[this._maxMorphGPU].value) >= h;
                    a[r[this._maxMorphGPU - 1]] = !l,
                    this._remapBufferArrays(),
                    l && this._morphBufferArrayCPU()
                }
            }
        },
        update: function(t) {
            this.isInitialized() || this.init(t),
            this.updateWeights();
            for (var e = this._weights, i = Math.min(this._maxMorphGPU, this._targets.length), n = this._morphs, r = 0, a = n.length; r < a; ++r)
                for (var s = n[r].getTargetsWeight(), o = 0; o < i; o++)
                    s[o] = e[o];
            return !0
        }
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i(382)
      , a = i(435)
      , s = i(417)
      , o = i(28)
      , l = {
        readFileList: function(t) {
            var e, i, o = new window.Map, u = [];
            for (i = 0; i < t.length; ++i) {
                var h = t[i].name.substr(t[i].name.lastIndexOf(".") + 1);
                void 0 === a.instance().getReaderWriterForExtension(h) && "osgjs" !== h || (e = t[i].name);
                var c = l.getTypeForExtension(h);
                u.push(s(t[i], {
                    responseType: c
                }))
            }
            return n.all(u).then(function(n) {
                for (i = 0; i < n.length; ++i)
                    o.set(t[i].name, n[i]);
                return r.readNodeURL(e, {
                    filesMap: o
                })
            })
        },
        init: function() {
            l._typesMap = new window.Map,
            l._typesMap.set("bin", "arraybuffer"),
            l._typesMap.set("b3dm", "arraybuffer"),
            l._typesMap.set("glb", "arraybuffer"),
            l._typesMap.set("zip", "arraybuffer"),
            l._typesMap.set("png", "blob"),
            l._typesMap.set("jpg", "blob"),
            l._typesMap.set("jpeg", "blob"),
            l._typesMap.set("gif", "blob"),
            l._typesMap.set("json", "string"),
            l._typesMap.set("gltf", "string"),
            l._typesMap.set("osgjs", "string")
        },
        addTypeForExtension: function(t, e) {
            l._typesMap || l.init(),
            void 0 !== l._typesMap.get(e) && o.warn("the '" + e + "' already has a type"),
            l._typesMap.set(e, t)
        },
        getTypeForExtension: function(t) {
            return l._typesMap || l.init(),
            this._typesMap.get(t)
        }
    };
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i(13)
      , a = i(639)
      , s = i(417)
      , o = i(856)
      , l = i(514)
      , u = i(28)
      , h = i(431)
      , c = i(162)
      , d = i(320)
      , p = i(603)
      , f = i(321)
      , g = i(134)
      , m = function(t, e) {
        this._json = t;
        var i = e;
        void 0 === i && (i = {}),
        this._identifierMap = i,
        this._objectRegistry = {},
        this._cacheReadObject = {},
        this.setOptions(r.objectMix({}, o))
    };
    m.imageFallback || (m.imageFallback = function() {
        var t = new window.Image;
        return t.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",
        t
    }()),
    m.prototype = {
        clone: function() {
            var t = new m;
            return t._objectRegistry = this._objectRegistry,
            t._cacheReadObject = this._cacheReadObject,
            t
        },
        setOptions: function(t) {
            this._defaultOptions = t
        },
        getOptions: function() {
            return this._defaultOptions
        },
        setProgressXHRCallback: function(t) {
            this._defaultOptions.progressXHRCallback = t
        },
        setReadNodeURLCallback: function(t) {
            this._defaultOptions.readNodeURL = t
        },
        registerObject: function(t, e) {
            this._objectRegistry[t] = e
        },
        getJSON: function() {
            return this._json
        },
        setJSON: function(t) {
            return this._json = t,
            this
        },
        setPrefixURL: function(t) {
            this._defaultOptions.prefixURL = t
        },
        getPrefixURL: function() {
            return this._defaultOptions.prefixURL
        },
        setDatabasePath: function(t) {
            this._defaultOptions.databasePath = t
        },
        getDatabasePath: function() {
            return this._defaultOptions.databasePath
        },
        computeURL: function(t) {
            return "string" == typeof this._defaultOptions.prefixURL && this._defaultOptions.prefixURL.length > 0 ? this._defaultOptions.prefixURL + t : t
        },
        requestFile: function(t, e) {
            return s(t, e)
        },
        getObjectWrapper: function(t) {
            if (this._objectRegistry[t])
                return new this._objectRegistry[t];
            for (var e = a, i = t.split("."), n = 0, r = i.length; n < r; n++) {
                var s = e[i[n]];
                if (void 0 === s)
                    return;
                e = s
            }
            return this._objectRegistry[t] = e,
            new e
        },
        fetchImage: function(t, e, i, n) {
            var r = "data:image/" === e.substring(0, "data:image/".length)
              , a = new window.Image;
            return a.onerror = function() {
                u.warn("warning use white texture as fallback instead of " + e),
                t.setImage(m.imageFallback),
                n && n.resolve(t)
            }
            ,
            !r && i.imageCrossOrigin && (a.crossOrigin = i.imageCrossOrigin),
            a.onload = function() {
                n ? (i.imageOnload && i.imageOnload.call(t),
                n.resolve(t)) : i.imageOnload && i.imageOnload.call(t)
            }
            ,
            t.setURL(e),
            t.setImage(a),
            a.src = e,
            t
        },
        readImageURL: function(t, e) {
            if (void 0 === e && (e = this._defaultOptions),
            e.readImageURL)
                return e.readImageURL.call(this, t, e);
            "data:image" !== t.substr(0, 10) && (t = this.computeURL(t));
            var i = new h;
            if (!0 !== e.imageLoadingUsePromise)
                return this.fetchImage(i, t, e);
            var r = n.defer();
            return this.fetchImage(i, t, e, r),
            r.promise
        },
        readNodeURL: function(t, e) {
            var a = e;
            if (void 0 === a && (a = this._defaultOptions),
            a.readNodeURL)
                return a.readNodeURL.call(this, t, a);
            t = this.computeURL(t);
            var s = n.defer();
            if (a = r.objectMix({}, a),
            !a.prefixURL) {
                var o = this.getPrefixURL()
                  , h = t.lastIndexOf("/");
                -1 !== h && (o = t.substring(0, h + 1)),
                a.prefixURL = o
            }
            var c = this
              , d = i(382)
              , p = function(e) {
                d.parseSceneGraph(e, a).then(function(e) {
                    s.resolve(e),
                    u.log("loaded " + t)
                }).catch(s.reject.bind(s))
            }
              , f = function(t) {
                function e(t) {
                    return t.length < 2 ? "0" + t : t
                }
                var i = t;
                l.isGunzipBuffer(t) && (i = l.gunzip(t));
                var n = new Uint8Array(i);
                return function(t) {
                    for (var i = "", n = 0, r = t.length; n < r; ++n)
                        i += "%" + e(t[n].toString(16));
                    return i = decodeURIComponent(i)
                }(n)
            };
            return c.requestFile(t).then(function(e) {
                var i;
                try {
                    i = JSON.parse(e)
                } catch (e) {
                    u.error("cant parse url " + t + " try to gunzip")
                }
                return i ? p(i) : (c.requestFile(t, {
                    responseType: "arraybuffer"
                }).then(function(t) {
                    var e = f(t);
                    i = JSON.parse(e),
                    p(i)
                }).catch(function(e) {
                    u.error("cant read file " + t + " status " + e),
                    s.reject()
                }).done(),
                !0)
            }).catch(function(e) {
                u.error("cant get file " + t + " status " + e),
                s.reject()
            }).done(),
            s.promise
        },
        _unzipTypedArray: function(t) {
            var e = new Uint8Array(t);
            if (31 === e[0] && 139 === e[1]) {
                var n = i(514);
                n || u.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server");
                return new n.Gunzip(e).decompress().buffer
            }
            return t
        },
        readBinaryArrayURL: function(t, e) {
            if (void 0 === e && (e = this._defaultOptions),
            e.readBinaryArrayURL)
                return e.readBinaryArrayURL.call(this, t, e);
            if (t = this.computeURL(t),
            void 0 !== this._identifierMap[t])
                return this._identifierMap[t];
            var i = n.defer()
              , r = this.requestFile(t, {
                responseType: "arraybuffer",
                progress: this._defaultOptions.progressXHRCallback
            });
            return this._identifierMap[t] = i.promise,
            r.then(function(t) {
                i.resolve(this._unzipTypedArray(t))
            }
            .bind(this)),
            i.promise
        },
        initializeBufferArray: function(t, e, i, a) {
            if (void 0 === a && (a = this.getOptions()),
            a.initializeBufferArray)
                return a.initializeBufferArray.call(this, t, e, i);
            var s = t.File
              , o = n.defer();
            return this.readBinaryArrayURL(s).then(function(n) {
                var a, s;
                !function() {
                    var t = new Uint8Array([18, 52])
                      , e = new Uint16Array(t.buffer);
                    s = "1234" === e[0].toString(16)
                }();
                var l = 0;
                void 0 !== t.Offset && (l = t.Offset);
                var h = r[e].BYTES_PER_ELEMENT
                  , c = t.Size
                  , d = i.getItemSize()
                  , p = c * h * d;
                if (s) {
                    u.log("big endian detected");
                    var f = r[e]
                      , g = new f(c * d)
                      , m = new DataView(n,l,p)
                      , v = 0
                      , _ = g.length;
                    if ("Uint16Array" === e)
                        for (; v < _; v++)
                            g[v] = m.getUint16(v * h, !0);
                    else if ("Float32Array" === e)
                        for (; v < _; v++)
                            g[v] = m.getFloat32(v * h, !0);
                    a = g,
                    m = null
                } else
                    a = new r[e](n,l,d * c);
                i.setElements(a),
                o.resolve(i)
            }).catch(function() {
                u.warn("Can't read binary array URL")
            }),
            o.promise
        },
        readBufferArray: function(t) {
            var e, i = this.getJSON(), a = i.UniqueID;
            if (void 0 !== a && void 0 !== (e = this._identifierMap[a]))
                return e;
            if (void 0 === t && (t = this.getOptions()),
            t.readBufferArray)
                return t.readBufferArray.call(this);
            if (!i.Elements && !i.Array || !i.ItemSize || !i.Type)
                return n.reject();
            var s;
            if (i.Elements)
                s = n.resolve(new c(c[i.Type],i.Elements,i.ItemSize));
            else if (i.Array) {
                var o = new c(c[i.Type]);
                o.setItemSize(i.ItemSize);
                var l, h;
                if (i.Array.Float32Array ? (l = i.Array.Float32Array,
                h = "Float32Array") : i.Array.Uint16Array ? (l = i.Array.Uint16Array,
                h = "Uint16Array") : i.Array.Uint8Array && (l = i.Array.Uint8Array,
                h = "Uint8Array"),
                void 0 === l)
                    return u.warn("Typed Array " + window.Object.keys(i.Array)[0]),
                    n.reject();
                l.File ? s = this.initializeBufferArray(l, h, o) : l.Elements && (o.setElements(new r[h](l.Elements)),
                s = n.resolve(o))
            }
            return void 0 !== a && (this._identifierMap[a] = s),
            s
        },
        readUserDataContainer: function() {
            var t, e = this.getJSON(), i = e.UniqueID;
            return void 0 !== i && void 0 !== (t = this._identifierMap[i]) ? t.Values : (this._identifierMap[i] = e,
            e.Values)
        },
        readPrimitiveSet: function() {
            var t, e, i, r, a, s, o = this.getJSON(), l = n.defer(), h = o.DrawElementUShort || o.DrawElementUByte || o.DrawElementUInt || o.DrawElementsUShort || o.DrawElementsUByte || o.DrawElementsUInt || void 0;
            if (h) {
                if (void 0 !== (t = h.UniqueID) && void 0 !== (e = this._identifierMap[t]))
                    return e;
                var c = h.Indices
                  , m = o;
                r = h.Mode,
                r = r ? g[r] : g.TRIANGLES,
                i = new f(r),
                this.setJSON(c),
                this.readBufferArray().then(function(t) {
                    i.setIndices(t),
                    l.resolve(i)
                }).catch(function() {
                    u.warn("Error buffer array")
                }),
                this.setJSON(m)
            }
            var v = o.DrawArray || o.DrawArrays;
            if (v) {
                if (void 0 !== (t = v.UniqueID) && void 0 !== (e = this._identifierMap[t]))
                    return e;
                r = v.Mode || v.mode,
                a = void 0 !== v.First ? v.First : v.first,
                s = void 0 !== v.Count ? v.Count : v.count;
                var _ = new d(g[r],a,s);
                l.resolve(_)
            }
            var b = o.DrawArrayLengths || void 0;
            if (b) {
                if (void 0 !== (t = b.UniqueID) && void 0 !== (e = this._identifierMap[t]))
                    return e;
                r = b.Mode,
                a = b.First;
                var x = b.ArrayLengths
                  , y = new p(g[r],a,x);
                l.resolve(y)
            }
            return void 0 !== t && (this._identifierMap[t] = l.promise),
            l.promise
        },
        readObject: function() {
            var t = this.getJSON()
              , e = window.Object.keys(t)[0];
            if (!e)
                return u.warn("can't find property for object " + t),
                n.reject();
            var r, a = t[e].UniqueID;
            if (void 0 !== a && void 0 !== (r = this._identifierMap[a]))
                return r;
            var s = this.getObjectWrapper(e);
            if (!s)
                return u.warn("can't instanciate object " + e),
                n.reject();
            var o = i(382)
              , l = o.ObjectWrapper.serializers;
            if (this._cacheReadObject[e])
                l = this._cacheReadObject[e];
            else {
                for (var h = e.split("."), c = 0, d = h.length; c < d; c++) {
                    var p = l[h[c]];
                    if (void 0 === p)
                        return u.warn("can't find function to read object " + e + " - undefined"),
                        n.reject();
                    l = p
                }
                this._cacheReadObject[e] = l
            }
            var f = l(this.setJSON(t[e]), s);
            return void 0 !== a && (this._identifierMap[a] = f,
            s._uniqueID = a),
            f
        }
    },
    t.exports = m
}
, function(t, e, i) {
    "use strict";
    var n = i(5).quat
      , r = i(5).vec3
      , a = Math.PI / 180
      , s = function(t, e, i, n, r) {
        var a = Math.cos(e / 2)
          , s = Math.cos(i / 2)
          , o = Math.cos(n / 2)
          , l = Math.sin(e / 2)
          , u = Math.sin(i / 2)
          , h = Math.sin(n / 2);
        return "XYZ" === r ? (t[0] = l * s * o + a * u * h,
        t[1] = a * u * o - l * s * h,
        t[2] = a * s * h + l * u * o,
        t[3] = a * s * o - l * u * h) : "YXZ" === r ? (t[0] = l * s * o + a * u * h,
        t[1] = a * u * o - l * s * h,
        t[2] = a * s * h - l * u * o,
        t[3] = a * s * o + l * u * h) : "ZXY" === r ? (t[0] = l * s * o - a * u * h,
        t[1] = a * u * o + l * s * h,
        t[2] = a * s * h + l * u * o,
        t[3] = a * s * o - l * u * h) : "ZYX" === r ? (t[0] = l * s * o - a * u * h,
        t[1] = a * u * o + l * s * h,
        t[2] = a * s * h - l * u * o,
        t[3] = a * s * o + l * u * h) : "YZX" === r ? (t[0] = l * s * o + a * u * h,
        t[1] = a * u * o + l * s * h,
        t[2] = a * s * h - l * u * o,
        t[3] = a * s * o - l * u * h) : "XZY" === r && (t[0] = l * s * o - a * u * h,
        t[1] = a * u * o - l * s * h,
        t[2] = a * s * h + l * u * o,
        t[3] = a * s * o + l * u * h),
        t
    }
      , o = function(t) {
        this._manipulator = t,
        this.init()
    };
    o.computeQuaternion = function() {
        var t = n.create()
          , e = n.fromValues(-Math.sqrt(.5), 0, 0, Math.sqrt(.5));
        return function(i, r, o) {
            var l = r.alpha * a
              , u = r.beta * a
              , h = r.gamma * a
              , c = o * a;
            s(i, u, l, -h, "YXZ");
            var d = -c / 2;
            t[1] = Math.sin(d),
            t[3] = Math.cos(d),
            n.mul(i, i, t),
            n.mul(i, i, e);
            var p = i[1];
            return i[1] = -i[2],
            i[2] = p,
            i
        }
    }(),
    o.prototype = {
        init: function() {
            this._stepFactor = 1,
            this._quat = n.create(),
            this._pos = r.create()
        },
        update: function(t, e) {
            o.computeQuaternion(this._quat, t, e),
            this._manipulator.setPoseVR(this._quat, this._pos)
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).vec3
      , a = i(5).mat4
      , s = i(462)
      , o = i(633)
      , l = i(634)
      , u = i(532)
      , h = i(635)
      , c = i(636)
      , d = i(637)
      , p = i(463)
      , f = function(t) {
        s.call(this, t),
        this._homePosition = r.create(),
        this._frustum = {},
        this.init()
    };
    f.AvailableControllerList = ["StandardMouseKeyboard", "LeapMotion", "GamePad", "Hammer", "DeviceOrientation", "WebVR"],
    f.ControllerList = ["StandardMouseKeyboard", "LeapMotion", "GamePad", "Hammer", "DeviceOrientation", "WebVR"];
    var g = 2 * Math.PI
      , m = function(t, e) {
        return t < e + 1e-5
    };
    f.prototype = n.objectInherit(s.prototype, {
        init: function() {
            this._distance = 25,
            this._target = r.create(),
            this._upz = r.fromValues(0, 0, 1),
            r.init(this._target);
            var t = a.fromRotation(a.create(), -Math.PI, this._upz)
              , e = a.fromRotation(a.create(), Math.PI / 10, r.fromValues(1, 0, 0));
            this._rotation = a.create(),
            a.mul(this._rotation, t, e),
            this._time = 0,
            this._vrMatrix = a.create(),
            this._rotate = new p(2),
            this._pan = new p(2),
            this._zoom = new p(1),
            this._minSpeed = 1e-4,
            this._scaleMouseMotion = 1,
            this._inverseMatrix = a.create(),
            this._autoPushTarget = !0,
            this._limitPitchUp = .5 * Math.PI * .9,
            this._limitPitchDown = -this._limitPitchUp,
            this._limitYawLeft = -Math.PI,
            this._limitYawRight = -this._limitYawLeft,
            this._limitZoomIn = 1e-4,
            this._limitZoomOut = 1 / 0;
            var i = this;
            f.ControllerList.forEach(function(t) {
                void 0 !== f[t] && (i._controllerList[t] = new f[t](i))
            })
        },
        setLimitPitchUp: function(t) {
            this._limitPitchUp = t
        },
        setLimitPitchDown: function(t) {
            this._limitPitchDown = t
        },
        setLimitYawLeft: function(t) {
            this._limitYawLeft = t
        },
        setLimitYawRight: function(t) {
            this._limitYawRight = t
        },
        setLimitZoomOut: function(t) {
            this._limitZoomOut = t
        },
        setLimitZoomIn: function(t) {
            this._limitZoomIn = t
        },
        setDelay: function(t) {
            this._rotate.setDelay(t),
            this._pan.setDelay(t),
            this._zoom.setDelay(t)
        },
        reset: function() {
            this.init()
        },
        setTarget: function(t) {
            r.copy(this._target, t);
            var e = r.create();
            this.getEyePosition(e),
            this._distance = r.distance(t, e)
        },
        setEyePosition: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create();
            return function(n) {
                var a = this._rotation
                  , s = this._target;
                r.sub(t, n, s),
                r.normalize(t, t),
                r.cross(e, t, this._upz),
                r.normalize(e, e),
                r.cross(i, e, t),
                r.normalize(i, i),
                a[0] = e[0],
                a[1] = t[0],
                a[2] = i[0],
                a[3] = 0,
                a[4] = e[1],
                a[5] = t[1],
                a[6] = i[1],
                a[7] = 0,
                a[8] = e[2],
                a[9] = t[2],
                a[10] = i[2],
                a[11] = 0,
                a[12] = 0,
                a[13] = 0,
                a[14] = 0,
                a[15] = 1,
                this._distance = r.distance(s, n)
            }
        }(),
        computeHomePosition: function(t) {
            var e = this.getHomeBound(t);
            e && e.valid() && (this.setDistance(this.getHomeDistance(e)),
            this.setTarget(e.center()))
        },
        getHomePosition: function() {
            if (void 0 !== this._node) {
                var t = this._target
                  , e = this.getDistance();
                this.computeEyePosition(t, e, this._homePosition)
            }
            return this._homePosition
        },
        setMinSpeed: function(t) {
            this._minSpeed = t
        },
        getMinSpeed: function() {
            return this._minSpeed
        },
        setDistance: function(t) {
            this._distance = t
        },
        getDistance: function() {
            return this._distance
        },
        getSpeedFactor: function() {
            return Math.max(this._distance, this._minSpeed)
        },
        computePan: function() {
            var t = a.create()
              , e = r.create()
              , i = r.create();
            return function(n, s) {
                var o = this._camera.getProjectionMatrix()
                  , l = 1 === o[15] ? 1 : 2 / o[5]
                  , u = this.getSpeedFactor() * l;
                s *= u,
                n *= u,
                a.invert(t, this._rotation),
                e[0] = t[0],
                e[1] = t[1],
                e[2] = t[2],
                r.normalize(e, e),
                i[0] = t[8],
                i[1] = t[9],
                i[2] = t[10],
                r.normalize(i, i),
                r.scale(e, e, -n),
                r.scale(i, i, s),
                r.add(this._target, this._target, e),
                r.add(this._target, this._target, i)
            }
        }(),
        computeRotation: function() {
            var t = r.fromValues(1, 0, 0);
            return function(e, i) {
                var n = Math.atan(-this._rotation[6] / this._rotation[5]) + i / 10;
                n = Math.min(Math.max(n, this._limitPitchDown), this._limitPitchUp);
                var r = e / 10
                  , s = Math.atan2(this._rotation[4], this._rotation[0])
                  , o = this._computeYaw(s, r, this._limitYawLeft, this._limitYawRight);
                a.fromRotation(this._rotation, -n, t),
                a.rotate(this._rotation, this._rotation, -o, this._upz)
            }
        }(),
        _computeYaw: function(t, e, i, n) {
            var r = t + e;
            if (n !== Math.PI || i !== -Math.PI) {
                if (n < i && (r > Math.PI && (t -= g,
                r -= g),
                r < -Math.PI && (t += g,
                r += g)),
                0 === e) {
                    var a = !1;
                    a = i > n ? r < i && r > n : r < i || r > n,
                    a && (r = Math.abs(r - i) > Math.abs(r - n) ? n : i)
                }
                e > 0 && m(t, n) && r > n ? r = n : e < 0 && m(i, t) && r < i && (r = i)
            }
            return r
        },
        computeZoom: function(t) {
            this.zoom(t)
        },
        setAutoPushTarget: function(t) {
            this._autoPushTarget = t
        },
        zoom: function() {
            var t = r.create();
            return function(e) {
                var i = this._distance + this.getSpeedFactor() * (e - 1);
                this._autoPushTarget && i < this._limitZoomIn && (r.sub(t, this._target, this.getEyePosition(t)),
                r.normalize(t, t),
                r.scale(t, t, this._limitZoomIn - i),
                r.add(this._target, this._target, t)),
                this._distance = Math.max(this._limitZoomIn, Math.min(this._limitZoomOut, i))
            }
        }(),
        getRotateInterpolator: function() {
            return this._rotate
        },
        getPanInterpolator: function() {
            return this._pan
        },
        getZoomInterpolator: function() {
            return this._zoom
        },
        getTarget: function(t) {
            return r.copy(t, this._target)
        },
        getEyePosition: function(t) {
            return this.computeEyePosition(this._target, this._distance, t),
            t
        },
        computeEyePosition: function() {
            var t = r.create()
              , e = a.create();
            return function(i, n, s) {
                a.invert(e, this._rotation),
                t[1] = n,
                r.transformMat4(s, t, e),
                r.add(s, i, s)
            }
        }(),
        update: function() {
            var t = r.create();
            return function(e) {
                var i, n = e.getFrameStamp().getDeltaTime();
                i = this._rotate.update(n),
                this.computeRotation(.1 * -i[0] * this._scaleMouseMotion, .1 * -i[1] * this._scaleMouseMotion);
                i = this._pan.update(n),
                this.computePan(.002 * -i[0], .002 * -i[1]),
                i = this._zoom.update(n),
                this.computeZoom(1 + i[0] / 10);
                var s = this._target
                  , o = this._distance;
                a.invert(this._inverseMatrix, this._rotation),
                a.mul(this._inverseMatrix, this._vrMatrix, this._inverseMatrix),
                r.set(t, 0, o, 0),
                r.transformMat4(t, t, this._inverseMatrix),
                a.lookAt(this._inverseMatrix, r.add(t, s, t), s, this._upz)
            }
        }(),
        setPoseVR: function(t) {
            a.fromQuat(this._vrMatrix, t)
        }
    }),
    f.DeviceOrientation = o,
    f.GamePad = l,
    f.Hammer = u,
    f.LeapMotion = h,
    f.WebVR = d,
    f.StandardMouseKeyboard = c,
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(379)
      , a = function(t) {
        this._manipulator = t,
        this.init()
    };
    a.prototype = {
        init: function() {
            this._panFactorX = 1,
            this._panFactorY = -this._panFactorX,
            this._rotateFactorX = .6,
            this._rotateFactorY = -this._rotateFactorX,
            this._zoomFactor = 5,
            this._lastScale = 0,
            this._nbPointerLast = 0,
            this._delay = .15,
            this._transformStarted = !1,
            this._dragStarted = !1
        },
        setEventProxy: function(t) {
            if (void 0 !== t && (void 0 === t || t !== this._eventProxy)) {
                this._eventProxy = t;
                var e = this
                  , i = t
                  , a = function(t) {
                    return void 0 !== t.pointers ? t.pointers.length : 1
                }
                  , s = function(t) {
                    return "touches " + a(t) + " distance " + t.distance + " x " + t.deltaX + " y " + t.deltaY
                };
                i.get("pinch").set({
                    threshold: .1
                }),
                i.get("pan").set({
                    threshold: 0,
                    pointers: 0
                }),
                i.get("pinch").recognizeWith(i.get("pan")),
                this._cbPanStart = function(t) {
                    var i = e._manipulator;
                    i && !e._transformStarted && "mouse" !== t.pointerType && (e._dragStarted = !0,
                    e._nbPointerLast = a(t),
                    2 === e._nbPointerLast ? (i.getPanInterpolator().reset(),
                    i.getPanInterpolator().set(t.center.x * e._panFactorX, t.center.y * e._panFactorY)) : (i.getRotateInterpolator().reset(),
                    i.getRotateInterpolator().set(t.center.x * e._rotateFactorX, t.center.y * e._rotateFactorY)),
                    n.debug("drag start, " + s(t)))
                }
                ,
                this._cbPanMove = function(t) {
                    var i = e._manipulator;
                    if (i && e._dragStarted && "mouse" !== t.pointerType) {
                        var r = a(t);
                        e._nbPointerLast !== r && (2 === r ? i.getPanInterpolator().reset() : i.getRotateInterpolator().reset(),
                        e._nbPointerLast = r),
                        2 === r ? (i.getPanInterpolator().setTarget(t.center.x * e._panFactorX, t.center.y * e._panFactorY),
                        n.debug("pan, " + s(t))) : (i.getRotateInterpolator().setDelay(e._delay),
                        i.getRotateInterpolator().setTarget(t.center.x * e._rotateFactorX, t.center.y * e._rotateFactorY),
                        n.debug("rotate, " + s(t)))
                    }
                }
                ,
                this._cbPanEnd = function(t) {
                    e._manipulator && e._dragStarted && "mouse" !== t.pointerType && (e._dragStarted = !1,
                    n.debug("drag end, " + s(t)))
                }
                ,
                this._cbPinchStart = function(t) {
                    var i = e._manipulator;
                    i && "mouse" !== t.pointerType && (e._transformStarted = !0,
                    e._lastScale = t.scale,
                    i.getZoomInterpolator().reset(),
                    i.getZoomInterpolator().set(e._lastScale),
                    t.preventDefault(),
                    n.debug("zoom start, " + s(t)))
                }
                ,
                this._cbPinchEnd = function(t) {
                    "mouse" !== t.pointerType && (e._transformStarted = !1,
                    n.debug("zoom end, " + s(t)))
                }
                ,
                this._cbPinchInOut = function(t) {
                    var i = e._manipulator;
                    if (i && e._transformStarted && "mouse" !== t.pointerType) {
                        var a = t.scale > e._lastScale ? e._zoomFactor : 3 * e._zoomFactor;
                        a *= r.smoothStep(0, .5, .5 - Math.abs(t.velocity));
                        var o = (t.scale - e._lastScale) * a;
                        e._lastScale = t.scale,
                        i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0] - o),
                        n.debug("zoom, " + s(t))
                    }
                }
                ,
                i.on("panstart ", this._cbPanStart),
                i.on("panmove", this._cbPanMove),
                i.on("panend", this._cbPanEnd),
                i.on("pinchstart", this._cbPinchStart),
                i.on("pinchend", this._cbPinchEnd),
                i.on("pinchin pinchout", this._cbPinchInOut)
            }
        },
        removeEventProxy: function(t) {
            t && this._eventProxy && (t.off("panstart ", this._cbPanStart),
            t.off("panmove", this._cbPanMove),
            t.off("panend", this._cbPanEnd),
            t.off("pinchstart", this._cbPinchStart),
            t.off("pinchend", this._cbPinchEnd),
            t.off("pinchin pinchout", this._cbPinchInOut))
        },
        setManipulator: function(t) {
            this._manipulator = t
        }
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(871)
      , a = i(876)
      , s = i(326)
      , o = function(t) {
        if (!t) {
            if (o.instance)
                return o.instance;
            o.instance = this
        }
        return this.addShaders(r),
        this.addShaders(a),
        this
    };
    o.prototype = {
        _shadersText: {},
        _shadersList: {},
        _globalDefaultprecision: "#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif",
        _debugLines: !1,
        _includeR: /#pragma include "([^"]+)"/g,
        _includeCondR: /#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,
        _defineR: /\#define\s+([a-zA-Z_0-9]+)/,
        _precisionR: /precision\s+(high|low|medium)p\s+float/,
        addShaders: function(t) {
            for (var e in t)
                this._shadersList[e] = e,
                this._shadersText[e] = t[e]
        },
        instrumentShaderlines: function(t, e) {
            return "\n#line 0 " + e + "\n" + t
        },
        getShaderTextPure: function(t) {
            var e = this._shadersText[t];
            return e || (n.error("shader file/text: " + t + " not registered"),
            e = ""),
            e
        },
        getShader: function(t, e, i, n) {
            var r = this.getShaderTextPure(t);
            return this.processShader(r, e, i, n)
        },
        preprocess: function(t, e, i, n) {
            var r = this;
            return t.replace(this._includeCondR, function(t, a) {
                var s = a.split(" ")
                  , o = s[0].replace(/"/g, "");
                if (s.length > 1 && n) {
                    for (var l = !1, u = n.map(function(t) {
                        return r._defineR.test(t) && t.replace(/\s+/g, " ").split(" ")[1]
                    }), h = 1; h < s.length && !l; h++)
                        for (var c = s[h].replace(/"/g, ""), d = 0; d < u.length && !l; d++)
                            if (!1 !== u[d] && u[d] === c) {
                                l = !0;
                                break
                            }
                    if (!l)
                        return ""
                }
                if (-1 !== i.indexOf(o))
                    return "";
                var p = this.getShaderTextPure(o);
                return i.push(o),
                this._debugLines && (p = this.instrumentShaderlines(p, e)),
                e++,
                p = this.preprocess(p, e, i, n)
            }
            .bind(this))
        },
        _getSortedUnique: function() {
            var t = function(t, e, i) {
                return !e || t !== i[e - 1]
            };
            return function(e) {
                return e && e.sort().filter(t)
            }
        }(),
        _convertExtensionsToWebGL2: function() {
            var t = function(t, e) {
                return "core_" + e
            }
              , e = function(t, e) {
                return "#define " + e
            }
              , i = "(GL_EXT_shader_texture_lod|GL_OES_standard_derivatives|GL_EXT_draw_buffers|GL_EXT_frag_depth)"
              , n = new RegExp("#\\s*extension\\s+" + i + ".*","g")
              , r = new RegExp(i,"g");
            return function(i) {
                return i = i.replace(n, e),
                i = i.replace(r, t)
            }
        }(),
        _convertToWebGL2: function() {
            var t = []
              , e = function(e, i) {
                var n = "glFragData_" + i;
                return t[i] = "layout(location = " + i + ") out vec4 " + n + ";",
                n
            };
            return function(i, n) {
                return i ? (i = i.replace(/attribute\s+/g, "in "),
                i = i.replace(/varying\s+/g, n ? "in " : "out "),
                i = i.replace(/(texture2D|textureCube)\s*\(/g, "texture("),
                i = i.replace(/(textureCubeLodEXT)\s*\(/g, "textureLod("),
                i = this._convertExtensionsToWebGL2(i),
                n && (t.length = 0,
                i = i.replace(/gl_FragData\s*\[\s*(\d+)\s*\]/g, e),
                t.length || t.push("out vec4 glFragColor_0;"),
                i = i.replace(/gl_FragColor/g, "glFragColor_0"),
                i = i.replace(/void\s+main\s*\(/g, t.join("\n") + "\nvoid main(")),
                i) : i
            }
        }(),
        _hasVersion: function(t) {
            var e = t.match(/^#(.*)$/m);
            return e && -1 !== e[0].indexOf("version")
        },
        processShader: function(t, e, i, n) {
            if (this._hasVersion(t))
                return t;
            var r = []
              , a = t
              , o = 0;
            this._debugLines && (a = this.instrumentShaderlines(a, o),
            o++),
            e = this._getSortedUnique(e),
            i = this._getSortedUnique(i);
            var l = this.preprocess(a, o, r, e, n)
              , u = -1 === l.indexOf("gl_Position")
              , h = s.instance().isWebGL2()
              , c = h ? "#version 300 es" : "#version 100";
            c += "\n";
            var d = i ? i.join("\n") + "\n" : ""
              , p = e ? e.join("\n") + "\n" : "";
            h && (d = this._convertExtensionsToWebGL2(d),
            p = this._convertToWebGL2(p, u),
            l = this._convertToWebGL2(l, u));
            var f = "";
            return this._globalDefaultprecision && !this._precisionR.test(l) && (f = this._globalDefaultprecision + "\n"),
            c + d + f + p + l
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(436)
      , r = i(437)
      , a = i(867)
      , s = i(533)
      , o = i(647)
      , l = i(868)
      , u = i(288)
      , h = {};
    h.Compiler = n,
    h.ShaderGenerator = r,
    h.ShaderGeneratorProxy = a,
    h.ShaderProcessor = s,
    h.nodeFactory = o,
    h.node = l,
    h.utils = u,
    h.debugShaderNode = !1,
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(85)
      , a = i(13)
      , s = function() {
        r.call(this),
        this._shadowedScene = void 0,
        this._dirty = !1,
        this._enabled = !0,
        this._filledOnce = !1
    };
    s.prototype = a.objectLibraryClass(a.objectInherit(r.prototype, {
        dirty: function() {
            this._dirty = !0
        },
        getShadowedScene: function() {
            return this._shadowedScene
        },
        setEnabled: function(t) {
            this._enabled = t
        },
        isEnabled: function() {
            return this._enabled
        },
        isFilledOnce: function() {
            return this._filledOnce
        },
        requestRedraw: function() {
            this._filledOnce = !1
        },
        setShadowedScene: function(t) {
            this._shadowedScene = t
        },
        init: function() {
            n.log("No ShadowTechnique activated: normal rendering activated")
        },
        valid: function() {
            return !1
        },
        updateShadowTechnique: function() {},
        cullShadowCasting: function() {},
        cleanSceneGraph: function() {
            n.log("No ShadowTechnique activated: normal rendering activated")
        }
    }), "osgShadow", "ShadowTechnique"),
    a.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(13)
      , a = i(128)
      , s = i(516)
      , o = i(377)
      , l = i(93)
      , u = i(272)
      , h = i(378)
      , c = i(412)
      , d = i(5).mat4
      , p = i(81)
      , f = i(287)
      , g = i(322)
      , m = i(323)
      , v = i(380)
      , _ = i(144)
      , b = i(5).vec2
      , x = i(5).vec3
      , y = function() {
        a.call(this),
        this._stack = [],
        this._renderToScreen = !1,
        this._dirty = !1,
        this._textureRTT = [],
        this._cameraRTT = [];
        var t = function() {};
        t.prototype = {
            update: function(t) {
                return t.isDirty() && t.build(),
                !0
            }
        },
        this.addUpdateCallback(new t),
        this.getOrCreateStateSet().setAttributeAndModes(new o("DISABLE")),
        this.getOrCreateStateSet().setAttributeAndModes(new s("BACK"))
    };
    y.prototype = r.objectInherit(a.prototype, {
        dirty: function() {
            for (var t = 0, e = this._stack.length; t < e; t++)
                this._stack[t].filter.dirty()
        },
        addPass: function(t, e, i) {
            var n = {};
            return n.filter = t,
            e instanceof l ? (n.texture = e,
            n.textureTarget = i || l.TEXTURE_2D) : void 0 !== e && void 0 !== i && (n.width = Math.floor(e),
            n.height = Math.floor(i)),
            this._stack.push(n),
            n.filter
        },
        renderToScreen: function(t, e) {
            this._renderToScreen = !0,
            this._renderToScreenWidth = t,
            this._renderToScreenHeight = e
        },
        getResultTexture: function() {
            return this._resultTexture
        },
        isDirty: function() {
            for (var t = 0, e = this._stack.length; t < e; t++)
                if (this._stack[t].filter.isDirty())
                    return !0;
            return !1
        },
        build: function() {
            var t = this;
            t._textureRTT = [],
            t._cameraRTT = [],
            this.removeChildren();
            var e;
            this._stack.forEach(function(i, r, a) {
                if (i.filter.isDirty() && i.filter.build(),
                i.filter.interConnectFilters)
                    return void (e = i.filter.interConnectFilters(t, r, a));
                var s, o, f = i.filter.getStateSet();
                if (void 0 !== i.texture)
                    s = i.texture.getWidth(),
                    o = i.texture.getHeight();
                else if (void 0 !== i.width && void 0 !== i.height)
                    s = i.width,
                    o = i.height;
                else {
                    var g = f.getTextureAttribute(0, "Texture");
                    void 0 === g ? n.warn("Composer can't find any information to setup texture output size") : (s = g.getWidth(),
                    o = g.getHeight())
                }
                var m = r === a.length - 1 && !0 === t._renderToScreen;
                if (!m && void 0 === f.getAttribute("Program"))
                    return void a[r + 1].filter.getStateSet().setTextureAttributeAndModes(0, f.getTextureAttribute(0, "Texture"));
                var x = new u;
                t._cameraRTT.push(x),
                x.setStateSet(f);
                var y;
                if (!0 === m)
                    s = t._renderToScreenWidth,
                    o = t._renderToScreenHeight;
                else {
                    x.setRenderOrder(u.PRE_RENDER, 0),
                    y = i.texture;
                    var S = i.textureTarget;
                    void 0 === y && (y = new l,
                    y.setName("composer Rtt " + i.filter.getFragmentName()),
                    y.setTextureSize(s, o),
                    S = l.TEXTURE_2D,
                    t._textureRTT.push(y)),
                    x.attachTexture(h.COLOR_ATTACHMENT0, y, S)
                }
                var w = new c(0,0,s,o);
                x.setReferenceFrame(_.ABSOLUTE_RF),
                x.setViewport(w),
                d.ortho(x.getProjectionMatrix(), 0, 1, 0, 1, -5, 5);
                var C = v.createTexturedFullScreenFakeQuadGeometry();
                i.filter.buildGeometry && (C = i.filter.buildGeometry(C)),
                C.setName("composer layer"),
                y && r + 1 < a.length && a[r + 1].filter.getStateSet().setTextureAttributeAndModes(0, y),
                e = y,
                x.addChild(C),
                i.filter.getStateSet().addUniform(p.createFloat2(b.fromValues(s, o), "RenderSize")),
                x.setClearMask(0),
                x.setName(i.filter.getFragmentName() || "Composer Pass" + r),
                t.addChild(x)
            }),
            this._resultTexture = e
        }
    }),
    y.Filter = function() {
        this._stateSet = new f,
        this._dirty = !0,
        this._fragmentName = "",
        this._vertexName = ""
    }
    ,
    y.Filter.prototype = {
        setFragmentName: function(t) {
            this._fragmentName = t
        },
        getFragmentName: function() {
            return this._fragmentName
        },
        setVertexName: function(t) {
            this._vertexName = t
        },
        getVertexName: function() {
            return this._vertexName
        },
        getDefineFragmentName: function() {
            return this._fragmentName ? "\n#define SHADER_NAME " + this._fragmentName + "\n" : ""
        },
        getDefineVertexName: function() {
            return this._vertexName || this._fragmentName ? "\n#define SHADER_NAME " + (this._vertexName || this._fragmentName) + "\n" : ""
        },
        getStateSet: function() {
            return this._stateSet
        },
        getOrCreateStateSet: function() {
            return this._stateSet
        },
        dirty: function() {
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        }
    },
    y.Filter.defaultVertexShader = ["attribute vec3 Vertex;", "varying vec2 vTexCoord0;", "void main(void) {", "  gl_Position = vec4(Vertex*2.0 - 1.0,1.0);", "  vTexCoord0 = Vertex.xy;", "}", ""].join("\n"),
    y.Filter.defaultFragmentShaderHeader = ["#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif", "varying vec2 vTexCoord0;", "uniform vec2 RenderSize;", "uniform sampler2D Texture0;", ""].join("\n"),
    y.Filter.shaderUtils = ["vec4 packFloatTo4x8(in float v) {", "vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;", "enc = fract(enc);", "enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);", "return enc;", "}", " ", "vec4 pack2FloatTo4x8(in vec2 val) {", " const vec2 bitSh = vec2(256.0, 1.0);", " const vec2 bitMsk = vec2(0.0, 1.0/256.0);", " vec2 res1 = fract(val.x * bitSh);", " res1 -= res1.xx * bitMsk;", " vec2 res2 = fract(val.y * bitSh);", " res2 -= res2.xx * bitMsk;", " return vec4(res1.x,res1.y,res2.x,res2.y);", "}", " ", "float unpack4x8ToFloat( vec4 rgba ) {", " return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );", "}", " ", "vec2 unpack4x8To2Float(in vec4 val) {", " const vec2 unshift = vec2(1.0/256.0, 1.0);", " return vec2(dot(val.xy, unshift), dot(val.zw, unshift));", "}", "vec2 encodeNormal (vec3 n)", "{", "    float f = sqrt(8.0*n.z+8.0);", "    return n.xy / f + 0.5;", "}", "vec3 decodeNormal (vec2 enc)", "{", "    vec2 fenc = enc*4.0-2.0;", "    float f = dot(fenc,fenc);", "    float g = sqrt(1.0-f/4.0);", "    vec3 n;", "    n.xy = fenc*g;", "    n.z = 1.0-f/2.0;", "    return n;", "}", ""].join("\n"),
    y.Filter.Helper = {
        pascalCache: [[1]],
        getOrCreatePascalCoefficients: function(t) {
            t = void 0 === t ? 5 : Math.min(t, 128);
            var e = y.Filter.Helper.pascalCache;
            if (e[t])
                return e[t];
            for (var i = e.length - 1; i < t; i++) {
                var n = e[i]
                  , r = n.length
                  , a = new Array(r);
                a[0] = 1,
                a[r] = 1;
                for (var s = i === e.length - 1 ? Math.pow(2, i) : 1, o = 0; o < r - 1; o++)
                    a[o + 1] = (n[o] + n[o + 1]) * s;
                s = Math.pow(2, i + 1);
                for (var l = 0; l < r + 1; l++)
                    a[l] /= s;
                e.push(a)
            }
            return e[t]
        }
    },
    y.Filter.Custom = function(t, e) {
        y.Filter.call(this),
        this._fragmentShader = t,
        this._uniforms = e,
        this._vertexShader = y.Filter.defaultVertexShader
    }
    ,
    y.Filter.Custom.prototype = r.objectInherit(y.Filter.prototype, {
        getFragmentShader: function() {
            return this._fragmentShader
        },
        getVertexShader: function() {
            return this._vertexShader
        },
        setFragmentShader: function(t) {
            this._fragmentShader = t
        },
        setVertexShader: function(t) {
            this._vertexShader = t
        },
        autoBindFragmentUniformStateSet: function(t, e, i) {
            var n = 0
              , r = e.match(/uniform\s+\w+\s+\w+/g);
            if (r)
                for (var a = 0, s = r.length; a < s; a++) {
                    var o, l = r[a].match(/uniform\s+(\w+)\s+(\w+)/), u = l[1], h = l[2];
                    if (i[h]) {
                        var c = i[h];
                        -1 !== u.search("sampler") ? (t.setTextureAttributeAndModes(n, c),
                        o = p.createInt1(n, h),
                        n++,
                        t.addUniform(o)) : (o = p.isUniform(c) ? c : p[u](i[h], h),
                        t.addUniform(o))
                    }
                }
        },
        build: function() {
            this._program = new g(new m(m.VERTEX_SHADER,this._vertexShader + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,this._fragmentShader + this.getDefineFragmentName())),
            this._uniforms && this.autoBindFragmentUniformStateSet(this._stateSet, this._fragmentShader, this._uniforms),
            this._stateSet.setAttributeAndModes(this._program),
            this._dirty = !1
        }
    }),
    y.Filter.PingPong = function(t, e, i, n, r, a) {
        y.Filter.Custom.apply(this, [r, a]),
        this._cameraRtt0 = t,
        this._rtt0 = e,
        this._cameraRtt1 = i,
        this._rtt1 = n,
        this._fragmentName = "PingPong"
    }
    ,
    y.Filter.PingPong.prototype = r.objectInherit(y.Filter.Custom.prototype, {
        interConnectFilters: function(t, e, i) {
            var n = this.getStateSet()
              , r = this._cameraRtt0.getOrCreateStateSet()
              , a = this._cameraRtt1.getOrCreateStateSet();
            r.setAttributeAndModes(this._program),
            a.setAttributeAndModes(this._program);
            var s, o, l = this.getStateSet().getUniformList();
            if (l)
                for (s in l)
                    o = l[s].getUniform(),
                    r.addUniform(o),
                    a.addUniform(o);
            if (l = this._uniforms)
                for (s in l)
                    o = l[s],
                    r.addUniform(o),
                    a.addUniform(o);
            var u = p.createInt1(0, "Texture0")
              , h = p.createInt1(1, "Texture1");
            r.addUniform(u),
            r.addUniform(h),
            a.addUniform(u),
            a.addUniform(h);
            var c = n.getTextureAttribute(0, "Texture");
            if (r.setTextureAttributeAndModes(0, c),
            a.setTextureAttributeAndModes(0, c),
            r.setTextureAttributeAndModes(1, this._rtt1),
            a.setTextureAttributeAndModes(1, this._rtt0),
            e !== i.length - 1) {
                var d = i[e + 1].filter.getStateSet();
                d.setTextureAttributeAndModes(0, this._rtt0),
                d.setTextureAttributeAndModes(1, this._rtt1),
                d.addUniform(u),
                d.addUniform(h)
            }
            var f = v.createTexturedFullScreenFakeQuadGeometry();
            return this.buildGeometry && (f = this.buildGeometry(f)),
            f.setName("composer layer"),
            this._cameraRtt0.addChild(f),
            this._cameraRtt1.addChild(f),
            t.addChild(this._cameraRtt0),
            t.addChild(this._cameraRtt1),
            t._textureRTT.push(this._rtt0),
            t._textureRTT.push(this._rtt1),
            t._cameraRTT.push(this._cameraRtt0),
            t._cameraRTT.push(this._cameraRtt1),
            this._cameraRtt1.setNodeMask(0),
            this._rtt0
        },
        switch: function() {
            var t = this._cameraRtt0.getNodeMask()
              , e = this._cameraRtt1.getNodeMask();
            this._cameraRtt0.setNodeMask(e),
            this._cameraRtt1.setNodeMask(t)
        }
    }),
    y.Filter.AverageHBlur = function(t, e, i, n) {
        y.Filter.call(this),
        this._linear = !1 !== e,
        this.setBlurSize(void 0 !== t ? t : 5),
        this._unpack = i,
        this._pack = n,
        this._pixelSize = 1,
        this._fragmentName = "AverageHBlur" + this._nbSamples
    }
    ,
    y.Filter.AverageHBlur.prototype = r.objectInherit(y.Filter.prototype, {
        setBlurSize: function(t) {
            t % 2 != 1 && (t += 1),
            this._nbSamples = t,
            this.dirty()
        },
        setPixelSize: function(t) {
            this._pixelSize = t,
            this.dirty()
        },
        getUVOffset: function(t) {
            return "vec2(float(" + t + ")/RenderSize[0], 0.0);"
        },
        getShaderBlurKernel: function() {
            var t = this._nbSamples
              , e = [];
            e.push(" pixel = unpack(Texture0, vTexCoord0 );"),
            e.push(" if (pixel.w == 0.0) { gl_FragColor = pixel; return; }"),
            e.push(" vec2 offset;");
            var i, n = Math.floor(t / 2);
            n % 2 != 0 && (t += 1,
            n = Math.floor(t / 2));
            var r = 2 * n + 1
              , a = 1 / r;
            if (this._linear) {
                var s, o, l = 1, u = (1 - a) / (2 * n);
                for (e.push(" pixel *= float(" + a + ");"),
                e.push(" vec4 pixelLin = vec4(0.0);"),
                i = 0; i < n; i += 2)
                    o = l + .5,
                    l += 2,
                    s = this.getUVOffset(o * this._pixelSize),
                    e.push(" offset = " + s),
                    e.push(" pixelLin += unpack(Texture0, vTexCoord0 + offset);"),
                    e.push(" pixelLin += unpack(Texture0, vTexCoord0 - offset);");
                e.push(" pixel += pixelLin * float(" + 2 * u + ");")
            } else {
                for (i = 0; i < n; i++)
                    e.push(" offset = " + this.getUVOffset((i + 1) * this._pixelSize)),
                    e.push(" pixel += unpack(Texture0, vTexCoord0 + offset);"),
                    e.push(" pixel += unpack(Texture0, vTexCoord0 - offset);");
                e.push(" pixel *= float(" + a + ");")
            }
            return e
        },
        build: function() {
            var t = this._stateSet.getTextureAttribute(0, "Texture");
            t && this._linear ? (t.setMinFilter("LINEAR"),
            t.setMagFilter("LINEAR")) : this._linear = !1;
            var e = y.Filter.defaultVertexShader
              , i = [y.Filter.defaultFragmentShaderHeader, "uniform float width;", this._unpack || "vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }", this._pack || "vec4 pack(vec4 pix) { return pix; }", "void main (void)", "{", "  vec4 pixel;", this.getShaderBlurKernel().join("\n"), "  gl_FragColor = pack(pixel);", "}", ""].join("\n")
              , n = new g(new m(m.VERTEX_SHADER,e + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i + this.getDefineFragmentName()));
            void 0 === this._stateSet.getUniform("Texture0") && this._stateSet.addUniform(p.createInt1(0, "Texture0")),
            this._stateSet.setAttributeAndModes(n),
            this._dirty = !1
        }
    }),
    y.Filter.AverageVBlur = function(t, e, i, n) {
        y.Filter.AverageHBlur.call(this, t, e, i, n),
        this._fragmentName = "AverageVBlur" + this._nbSamples
    }
    ,
    y.Filter.AverageVBlur.prototype = r.objectInherit(y.Filter.AverageHBlur.prototype, {
        getUVOffset: function(t) {
            return "vec2(0.0, float(" + t + ")/RenderSize[1]);"
        }
    }),
    y.Filter.BilateralHBlur = function(t, e, i) {
        y.Filter.call(this),
        void 0 === t && (t = {});
        var n = t.nbSamples
          , r = t.depthTexture
          , a = t.radius;
        this.setBlurSize(void 0 !== n ? n : 5),
        this._depthTexture = r,
        this._radius = p.createFloat(1, "radius"),
        this._pixelSize = p.createFloat(1, "pixelSize"),
        this.setRadius(a),
        this._unpack = e,
        this._pack = i,
        this._fragmentName = "BilateralHBlur" + this._nbSamples
    }
    ,
    y.Filter.BilateralHBlur.prototype = r.objectInherit(y.Filter.prototype, {
        setBlurSize: function(t) {
            t % 2 != 1 && (t += 1),
            this._nbSamples = t,
            this.dirty()
        },
        setPixelSize: function(t) {
            this._pixelSize.setFloat(t)
        },
        setRadius: function(t) {
            this._radius.setFloat(t)
        },
        getUVOffset: function(t) {
            return "vec2(0.0, float(" + t + ") * pixelSize )/RenderSize[1];"
        },
        getShaderBlurKernel: function() {
            var t = this._nbSamples
              , e = [];
            e.push(" pixel = unpack(Texture0, vTexCoord0 );"),
            e.push(" if (pixel.w <= 0.0001) { gl_FragColor = vec4(1.0); return; }"),
            e.push(" vec2 offset, tmpUV;"),
            e.push(" depth = getDepthValue(unpack(Texture1, vTexCoord0 ));");
            for (var i = 1; i < Math.ceil(t / 2); i++)
                e.push(" offset = " + this.getUVOffset(i)),
                e.push(" tmpUV =  vTexCoord0 + offset;"),
                e.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),
                e.push(" if ( abs(depth-tmpDepth) < radius) {"),
                e.push("   pixel += unpack(Texture0, tmpUV);"),
                e.push("   nbHits += 1.0;"),
                e.push(" }"),
                e.push(" tmpUV =  vTexCoord0 - offset;"),
                e.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),
                e.push(" if ( abs(depth-tmpDepth) < radius) {"),
                e.push("   pixel += unpack(Texture0, tmpUV);"),
                e.push("   nbHits += 1.0;"),
                e.push(" }");
            return e.push(" pixel /= nbHits;"),
            e
        },
        build: function() {
            var t = y.Filter.defaultVertexShader
              , e = [y.Filter.defaultFragmentShaderHeader, "uniform sampler2D Texture1;", "uniform float width;", "uniform mat4 projection;", "uniform float radius;", "uniform float pixelSize;", this._unpack || "vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }", this._pack || "vec4 pack(vec4 pix) { return pix; }", "float znear,zfar,zrange;", "", y.Filter.shaderUtils, "", "float getDepthValue(vec4 v) {", "  float depth = unpack4x8ToFloat(v);", "  depth = depth*zrange+znear;", "  return -depth;", "}", "void main (void)", "{", "  vec4 pixel;", "  float depth, tmpDepth;", "  znear = projection[3][2] / (projection[2][2]-1.0);", "  zfar = projection[3][2] / (projection[2][2]+1.0);", "  zrange = zfar-znear;", "  float nbHits = 1.0;", this.getShaderBlurKernel().join("\n"), "  gl_FragColor = pack(pixel);", "}", ""].join("\n")
              , i = new g(new m(m.VERTEX_SHADER,t + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,e + this.getDefineFragmentName()));
            void 0 === this._stateSet.getUniform("Texture0") && this._stateSet.addUniform(p.createInt1(0, "Texture0")),
            void 0 === this._stateSet.getUniform("Texture1") && this._stateSet.addUniform(p.createInt1(1, "Texture1")),
            this._stateSet.addUniform(this._radius),
            this._stateSet.addUniform(this._pixelSize),
            this._stateSet.setTextureAttributeAndModes(1, this._depthTexture),
            this._stateSet.setAttributeAndModes(i),
            this._dirty = !1
        }
    }),
    y.Filter.BilateralVBlur = function(t, e, i) {
        y.Filter.BilateralHBlur.call(this, t, e, i),
        this._fragmentName = "BilateralVBlur" + this._nbSamples
    }
    ,
    y.Filter.BilateralVBlur.prototype = r.objectInherit(y.Filter.BilateralHBlur.prototype, {
        getUVOffset: function(t) {
            return "vec2(float(" + t + ")*pixelSize/RenderSize[0],0.0);"
        }
    }),
    y.Filter.InputTexture = function(t) {
        y.Filter.call(this),
        this._stateSet.setTextureAttributeAndModes(0, t),
        this._fragmentName = "InputTexture"
    }
    ,
    y.Filter.InputTexture.prototype = r.objectInherit(y.Filter.prototype, {
        build: function() {
            this._dirty = !1
        }
    }),
    y.Filter.HBlur = function(t, e, i, n) {
        y.Filter.call(this),
        this._linear = !1 !== e,
        this.setBlurSize(void 0 !== t ? t : 5),
        this._unpack = i,
        this._pack = n,
        this._fragmentName = "HBlur" + this._nbSamples
    }
    ,
    y.Filter.HBlur.prototype = r.objectInherit(y.Filter.prototype, {
        setBlurSize: function(t) {
            t % 2 != 0 && (t += 1),
            this._nbSamples = t,
            this.dirty()
        },
        getUVOffset: function(t) {
            return "vec2(float(" + t + ")/ RenderSize[0], 0.0) ;"
        },
        build: function() {
            var t = this._nbSamples
              , e = this._stateSet.getTextureAttribute(0, "Texture");
            e && this._linear ? (e.setMinFilter("LINEAR"),
            e.setMagFilter("LINEAR")) : this._linear = !1;
            var i = y.Filter.defaultVertexShader
              , n = .005 / t
              , r = t
              , a = y.Filter.Helper.getOrCreatePascalCoefficients(r)
              , s = Math.floor(r / 2)
              , o = [];
            o.push(" pixel = float(" + a[s] + ")*unpack(Texture0, vTexCoord0 ).rgb;"),
            o.push(" vec2 offset;");
            var l, u, h, c, d;
            if (this._linear)
                for (l = 1,
                u = s + 1; u < t; u += 2) {
                    var f = a[u]
                      , v = a[u + 1];
                    if ((h = f + v) < n)
                        break;
                    var _ = l
                      , b = l + 1;
                    l += 2,
                    d = (_ * f + b * v) / h,
                    c = this.getUVOffset(d),
                    o.push(" offset = " + c),
                    o.push(" pixel += " + h + "* unpack(Texture0, (vTexCoord0.xy + offset.xy)).rgb;"),
                    o.push(" pixel += " + h + "* unpack(Texture0, (vTexCoord0.xy - offset.xy)).rgb;")
                }
            else
                for (l = 1,
                u = s + 1; u < t && !((h = a[u]) < n); u++)
                    d = l++,
                    c = this.getUVOffset(d),
                    o.push(" offset = " + c),
                    o.push(" pixel += " + h + "* unpack(Texture0, (vTexCoord0.xy + offset.xy)).rgb;"),
                    o.push(" pixel += " + h + "* unpack(Texture0, (vTexCoord0.xy - offset.xy)).rgb;");
            var x = [y.Filter.defaultFragmentShaderHeader, "uniform float width;", this._unpack || "vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }", this._pack || "vec4 pack(vec4 pix) { return pix; }", "void main (void)", "{", "  vec3 pixel;", o.join("\n"), "  gl_FragColor = pack(vec4(pixel, 1.0));", "}", ""].join("\n")
              , S = new g(new m(m.VERTEX_SHADER,i + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,x + this.getDefineFragmentName()));
            void 0 === this._stateSet.getUniform("Texture0") && this._stateSet.addUniform(p.createInt1(0, "Texture0")),
            this._stateSet.setAttributeAndModes(S),
            this._dirty = !1
        }
    }),
    y.Filter.VBlur = function(t, e, i, n) {
        y.Filter.HBlur.call(this, t, e, i, n),
        this._fragmentName = "VBlur" + this._nbSamples
    }
    ,
    y.Filter.VBlur.prototype = r.objectInherit(y.Filter.HBlur.prototype, {
        getUVOffset: function(t) {
            return "vec2(0.0, float(" + t + ")/RenderSize[1]) ;"
        }
    }),
    y.Filter.SobelFilter = function() {
        y.Filter.call(this),
        this._color = p.createFloat3(x.fromValues(1, 1, 1), "color"),
        this._factor = p.createFloat(1, "factor"),
        this._fragmentName = "SobelFilter"
    }
    ,
    y.Filter.SobelFilter.prototype = r.objectInherit(y.Filter.prototype, {
        setColor: function(t) {
            this._color.setVec3(t)
        },
        setFactor: function(t) {
            this._factor.setFloat(t)
        },
        build: function() {
            var t = this._stateSet
              , e = y.Filter.defaultVertexShader
              , i = ["", y.Filter.defaultFragmentShaderHeader, "uniform vec3 color;", "uniform float factor;", "void main (void)", "{", "  float fac0 = 2.0;", "  float fac1 = 1.0;", "  float offsetx = 1.0/RenderSize[0];", "  float offsety = 1.0/RenderSize[1];", "  vec4 texel0 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, offsety));", "  vec4 texel1 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, 0.0));", "  vec4 texel2 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, -offsety));", "  vec4 texel3 = texture2D(Texture0, vTexCoord0 + vec2(0.0, -offsety));", "  vec4 texel4 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, -offsety));", "  vec4 texel5 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, 0.0));", "  vec4 texel6 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, offsety));", "  vec4 texel7 = texture2D(Texture0, vTexCoord0 + vec2(0.0, offsety));", "  vec4 rowx = -fac0*texel5 + fac0*texel1 +  -fac1*texel6 + fac1*texel0 + -fac1*texel4 + fac1*texel2;", "  vec4 rowy = -fac0*texel3 + fac0*texel7 +  -fac1*texel4 + fac1*texel6 + -fac1*texel2 + fac1*texel0;", "  float mag = sqrt(dot(rowy,rowy)+dot(rowx,rowx));", "  if (mag < 1.0/255.0) discard;", "  mag *= factor;", "  mag = min(1.0, mag);", "  gl_FragColor = vec4(color*mag,mag);", "}", ""].join("\n")
              , n = new g(new m(m.VERTEX_SHADER,e + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i + this.getDefineFragmentName()));
            t.setAttributeAndModes(n),
            t.addUniform(this._color),
            t.addUniform(this._factor),
            t.addUniform(p.createInt1(0, "Texture0")),
            this._dirty = !1
        }
    }),
    y.Filter.BlendMix = function() {
        y.Filter.call(this);
        var t, e, i, n = 0, r = 1, a = this._stateSet;
        3 === arguments.length ? (t = arguments[0],
        e = arguments[1],
        i = arguments[2],
        n = 1,
        r = 2,
        a.setTextureAttributeAndModes(n, t)) : 2 === arguments.length ? (e = arguments[0],
        i = arguments[1]) : 1 === arguments.length && (e = arguments[0],
        i = .5),
        a.setTextureAttributeAndModes(r, e),
        a.addUniform(p.createInt1(n, "Texture0")),
        a.addUniform(p.createInt1(r, "Texture1")),
        this._mixValueUniform = p.createFloat1(i, "MixValue"),
        a.addUniform(this._mixValueUniform),
        this._fragmentName = "BlendMix"
    }
    ,
    y.Filter.BlendMix.prototype = r.objectInherit(y.Filter.prototype, {
        getBlendFactorUniform: function() {
            return this._mixValueUniform
        },
        build: function() {
            var t = this._stateSet
              , e = y.Filter.defaultVertexShader
              , i = ["", y.Filter.defaultFragmentShaderHeader, "uniform sampler2D Texture1;", "uniform float MixValue;", "void main (void)", "{", "  gl_FragColor = mix(texture2D(Texture0,vTexCoord0), texture2D(Texture1,vTexCoord0),MixValue);", "}", ""].join("\n")
              , n = new g(new m(m.VERTEX_SHADER,e + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i + this.getDefineFragmentName()));
            t.setAttributeAndModes(n),
            this._dirty = !1
        }
    }),
    y.Filter.BlendMultiply = function() {
        y.Filter.call(this);
        var t, e, i = this._stateSet, n = 0;
        2 === arguments.length ? (t = arguments[0],
        e = arguments[1],
        n = 1,
        n = 2,
        i.setTextureAttributeAndModes(n, t)) : 1 === arguments.length && (e = arguments[0]),
        i.setTextureAttributeAndModes(1, e),
        i.addUniform(p.createInt1(n, "Texture0")),
        i.addUniform(p.createInt1(1, "Texture1")),
        this._fragmentName = "BlendMultiply"
    }
    ,
    y.Filter.BlendMultiply.prototype = r.objectInherit(y.Filter.prototype, {
        build: function() {
            var t = y.Filter.defaultVertexShader
              , e = ["", y.Filter.defaultFragmentShaderHeader, "uniform sampler2D Texture1;", "uniform float MixValue;", "void main (void)", "{", "  gl_FragColor = texture2D(Texture0,vTexCoord0)*texture2D(Texture1,vTexCoord0);", "}", ""].join("\n")
              , i = new g(new m(m.VERTEX_SHADER,t + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,e + this.getDefineFragmentName()));
            this._stateSet.setAttributeAndModes(i),
            this._dirty = !1
        }
    }),
    y.Filter.SSAO = function(t) {
        y.Filter.call(this);
        var e = this._stateSet
          , i = 16
          , n = .05;
        if (void 0 !== t) {
            void 0 !== t.nbSamples && (i = t.nbSamples),
            void 0 !== t.radius && (n = t.radius);
            var r = t.normal
              , a = t.position
              , s = r.getWidth()
              , o = r.getHeight();
            this._size = b.fromValues(s, o),
            e.setTextureAttributeAndModes(0, r),
            e.setTextureAttributeAndModes(1, a)
        }
        this._radius = n,
        this._nbSamples = i,
        this._noiseTextureSize = 16,
        this._sceneRadius = 2,
        e.addUniform(p.createFloat1(1, "Power")),
        e.addUniform(p.createFloat1(n, "Radius")),
        e.addUniform(p.createInt1(0, "Texture0")),
        e.addUniform(p.createInt1(1, "Texture1")),
        e.addUniform(p.createInt1(2, "Texture2")),
        e.addUniform(p.createFloat1(.1, "AngleLimit")),
        this.initNoise(),
        this._fragmentName = "SSAO"
    }
    ,
    y.Filter.SSAO.prototype = r.objectInherit(y.Filter.prototype, {
        initNoise: function() {
            var t = this._noiseTextureSize
              , e = new Array(t * t * 3);
            !function(e) {
                for (var i = b.fromValues(0, 0), n = 0; n < t * t; n++)
                    i[0] = 2 * (Math.random() - .5),
                    i[1] = 2 * (Math.random() - .5),
                    b.normalize(i, i),
                    e[3 * n + 0] = 255 * (.5 * i[0] + .5),
                    e[3 * n + 1] = 255 * (.5 * i[1] + .5),
                    e[3 * n + 2] = 127.5
            }(e);
            var i = new l;
            i.setWrapS("REPEAT"),
            i.setWrapT("REPEAT"),
            i.setMinFilter("NEAREST"),
            i.setMagFilter("NEAREST"),
            i.setTextureSize(t, t),
            i.setImage(new Uint8Array(e), "RGB"),
            this._noiseTexture = i
        },
        setSceneRadius: function(t) {
            this._sceneRadius = t,
            this.dirty()
        },
        setAngleLimit: function(t) {
            this._stateSet.getUniform("AngleLimit").setFloat(t)
        },
        setNbSamples: function(t) {
            t !== this._nbSamples && (this._nbSamples = Math.floor(t),
            this.dirty())
        },
        setRadius: function(t) {
            this._stateSet.getUniform("Radius").setFloat(t)
        },
        setPower: function(t) {
            this._stateSet.getUniform("Power").setFloat(t)
        },
        build: function() {
            var t = this._stateSet
              , e = this._nbSamples
              , i = new Array(4 * e);
            !function(t) {
                for (var i = x.create(), n = 0; n < e; n++) {
                    i[0] = 2 * (Math.random() - .5),
                    i[1] = 2 * (Math.random() - .5),
                    i[2] = Math.random(),
                    x.normalize(i, i);
                    var r = Math.max(n / e, .1);
                    r = .1 + r * r * .9,
                    t[3 * n + 0] = i[0],
                    t[3 * n + 1] = i[1],
                    t[3 * n + 2] = i[2],
                    t[3 * n + 3] = r
                }
            }(i),
            t.setTextureAttributeAndModes(2, this._noiseTexture);
            var n = t.getUniform("noiseSampling");
            void 0 === n ? (n = p.createFloat2(b.fromValues(this._size[0] / this._noiseTextureSize, this._size[1] / this._noiseTextureSize), "noiseSampling"),
            t.addUniform(n)) : n.setVec2(b.fromValues(this._size[0] / this._noiseTextureSize, this._size[1] / this._noiseTextureSize));
            for (var r = ["", "attribute vec3 Vertex;", "attribute vec2 TexCoord0;", "varying vec2 vTexCoord0;", "uniform mat4 uModelViewMatrix;", "uniform mat4 uProjectionMatrix;", "void main(void) {", "  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex,1.0);", "  vTexCoord0 = TexCoord0;", "}", ""].join("\n"), a = [], s = 0; s < e; s++)
                a.push("kernel[" + s + "] = vec4(" + i[3 * s] + "," + i[3 * s + 1] + ", " + i[3 * s + 2] + ", " + i[3 * s + 3] + ");");
            a = a.join("\n");
            var o = ["", y.Filter.defaultFragmentShaderHeader, "uniform sampler2D Texture1;", "uniform sampler2D Texture2;", "uniform mat4 projection;", "uniform vec2 noiseSampling;", "uniform float Power;", "uniform float Radius;", "uniform float AngleLimit;", "#define NB_SAMPLES " + this._nbSamples, "float depth;", "vec3 normal;", "vec4 position;", "vec4 kernel[" + e + "];", "mat3 computeBasis()", "{", "  vec2 uvrand = vTexCoord0*noiseSampling;", "  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);", "  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));", "  vec3 bitangent = cross(normal, tangent);", "  mat3 tbn = mat3(tangent, bitangent, normal);", "  return tbn;", "}", "void main (void)", "{", a, "  position = texture2D(Texture1, vTexCoord0);", "  vec4 p = texture2D(Texture0, vTexCoord0);", "  depth = p.w;", "  normal = vec3(p);", "  if ( position.w == 0.0) {", "     gl_FragColor = vec4(1.0,1.0,1.0,0.0);", "     return;", "  }", "", " mat3 tbn = computeBasis();", " float occlusion = 0.0;", " for (int i = 0; i < NB_SAMPLES; i++) {", "    vec3 vecKernel = vec3(kernel[i]);", "    vecKernel[2] = max(AngleLimit,vecKernel[2]);", "    vec3 sample = tbn * vecKernel;", "    vec3 dir = sample;", "    float w = dot(dir, normal);", "    float dist = 1.0-kernel[i].w;", "    w *= dist*dist*Power;", "    sample = dir * float(Radius) + position.xyz;", "    vec4 offset = projection * vec4(sample,1.0);", "    offset.xy /= offset.w;", "    offset.xy = offset.xy * 0.5 + 0.5;", "    float sample_depth = texture2D(Texture1, offset.xy).z;", "    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;", "    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;", " }", " occlusion = 1.0 - (occlusion / float(NB_SAMPLES));", " gl_FragColor = vec4(vec3(occlusion),1.0);", "}", ""].join("\n")
              , l = new g(new m(m.VERTEX_SHADER,r + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,o + this.getDefineFragmentName()));
            t.setAttributeAndModes(l),
            this._dirty = !1
        }
    }),
    y.Filter.SSAO8 = function(t) {
        y.Filter.SSAO.call(this, t),
        this._fragmentName = "SSAO8"
    }
    ,
    y.Filter.SSAO8.prototype = r.objectInherit(y.Filter.SSAO.prototype, {
        buildGeometry: function(t) {
            return t.getAttributes().TexCoord1 = this._texCoord1,
            t
        },
        build: function() {
            var t = this._stateSet
              , e = this._nbSamples
              , i = new Array(4 * e);
            !function(t) {
                for (var i = x.create(), n = 0; n < e; n++) {
                    i[0] = 2 * (Math.random() - .5),
                    i[1] = 2 * (Math.random() - .5),
                    i[2] = Math.random(),
                    x.normalize(i, i);
                    var r = Math.max(n / e, .1);
                    r = .1 + r * r * .9,
                    t[3 * n + 0] = i[0],
                    t[3 * n + 1] = i[1],
                    t[3 * n + 2] = i[2],
                    t[3 * n + 3] = r
                }
            }(i),
            t.setTextureAttributeAndModes(2, this._noiseTexture);
            var n = t.getUniform("noiseSampling");
            void 0 === n ? (n = p.createFloat2(b.fromValues(this._size[0] / this._noiseTextureSize, this._size[1] / this._noiseTextureSize), "noiseSampling"),
            t.addUniform(n)) : n.setVec2(b.fromValues(this._size[0] / this._noiseTextureSize, this._size[1] / this._noiseTextureSize));
            for (var r = ["", "attribute vec3 Vertex;", "attribute vec2 TexCoord0;", "attribute vec3 TexCoord1;", "varying vec2 vTexCoord0;", "varying vec3 vTexCoord1;", "uniform mat4 uModelViewMatrix;", "uniform mat4 uProjectionMatrix;", "void main(void) {", "  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex,1.0);", "  vTexCoord0 = TexCoord0;", "  vTexCoord1 = TexCoord1;", "}", ""].join("\n"), a = [], s = 0; s < e; s++)
                a.push("kernel[" + s + "] = vec4(" + i[3 * s] + "," + i[3 * s + 1] + ", " + i[3 * s + 2] + ", " + i[3 * s + 3] + ");");
            a = a.join("\n");
            var o = ["", y.Filter.defaultFragmentShaderHeader, "varying vec3 vTexCoord1;", "uniform sampler2D Texture1;", "uniform sampler2D Texture2;", "uniform mat4 projection;", "uniform vec2 noiseSampling;", "uniform float Power;", "uniform float Radius;", "uniform float AngleLimit;", "#define NB_SAMPLES " + this._nbSamples, "float depth;", "float znear, zfar, zrange;", "vec3 normal;", "vec3 position;", "vec4 kernel[" + e + "];", y.Filter.shaderUtils, "mat3 computeBasis()", "{", "  vec2 uvrand = vTexCoord0*noiseSampling;", "  //uvrand = rand(gl_FragCoord.xy);", "  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);", "  //vec3 rvec = normalize(vec3(uvrand,0.0));", "  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));", "  vec3 bitangent = cross(normal, tangent);", "  mat3 tbn = mat3(tangent, bitangent, normal);", "  return tbn;", "}", "float getDepthValue(vec4 v) {", "  float depth = unpack4x8ToFloat(v);", "  depth = depth*zrange+znear;", "  //depth = depth*zrange;", "  return -depth;", "}", "void main (void)", "{", a, "  vec4 p = texture2D(Texture0, vTexCoord0);", "  if (dot(p,p) < 0.001) { ", "     gl_FragColor = vec4(1.0,1.0,1.0,0.0);", "     return;", "  }", "  znear = projection[3][2] / (projection[2][2]-1.0);", "  zfar = projection[3][2] / (projection[2][2]+1.0);", "  zrange = zfar-znear;", "  depth = getDepthValue(texture2D(Texture1, vTexCoord0));", "  if ( -depth < znear) {", "     gl_FragColor = vec4(1.0,1.0,1.0,0.0);", "     return;", "  }", "  normal = decodeNormal(unpack4x8To2Float(p));", "  position = -vTexCoord1*depth;", "  position.z = -position.z;", "", " mat3 tbn = computeBasis();", " float occlusion = 0.0;", " for (int i = 0; i < NB_SAMPLES; i++) {", "    vec3 vecKernel = vec3(kernel[i]);", "    vecKernel[2] = max(AngleLimit,vecKernel[2]);", "    vec3 sample = tbn * vec3(vecKernel);", "    vec3 dir = sample;", "    float w = dot(dir, normal);", "    float dist = 1.0-kernel[i].w;", "    w *= dist*dist*Power;", "    sample = dir * float(Radius) + position.xyz;", "    vec4 offset = projection * vec4(sample,1.0);", "    offset.xy /= offset.w;", "    offset.xy = offset.xy * 0.5 + 0.5;", "    float sample_depth = getDepthValue(texture2D(Texture1, offset.xy));", "    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;", "    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;", " }", " occlusion = 1.0 - (occlusion / float(NB_SAMPLES));", " gl_FragColor = vec4(vec3(occlusion),1.0);", "}", ""].join("\n")
              , l = new g(new m(m.VERTEX_SHADER,r + this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,o + this.getDefineFragmentName()));
            t.setAttributeAndModes(l),
            this._dirty = !1
        }
    }),
    t.exports = y
}
, function(t, e, i) {
    "use strict";
    var n, r = i(878), a = i(659), s = i(28), o = function() {
        try {
            n = i(2)
        } catch (t) {
            s.warn("You will not be able to use osgUtil.DisplayGraph until you add jQuery in your page")
        }
    }, l = function(t) {
        this.options = t;
        var e = document.createElement("style");
        e.type = "text/css",
        e.innerHTML = [".osgDebugSimpleTooltip {", "display: none;", "position: absolute;", "margin-left: 10px;", "border-radius: 4px;", "padding: 10px;", "background: rgba(0,0,0,.9);", "color: #ffffff;", "}", ".osgDebugSimpleTooltip:before {", "content: ", ";", "position: absolute;", "left: -10px;", "top: 8px;", "border: 10px solid transparent;", "border-width: 10px 10px 10px 0;", "border-right-color: rgba(0,0,0,.9);", "}"].join("\n"),
        document.getElementsByTagName("head")[0].appendChild(e),
        this.el = document.createElement("div"),
        this.el.className = "osgDebugSimpleTooltip",
        document.body.appendChild(this.el);
        for (var i = document.querySelectorAll(this.options.selector), n = 0; n < i.length; n++)
            i[n].addEventListener("mouseover", this.showTooltip.bind(this), !1),
            i[n].addEventListener("mouseout", this.hideTooltip.bind(this), !1)
    };
    l.prototype = {
        showTooltip: function(t) {
            if (n) {
                var e = t.currentTarget;
                this.el.innerHTML = e.getAttribute("title"),
                this.el.style.display = "block",
                this.el.style.left = n(e).position().left + n(e).get(0).getBoundingClientRect().width + "px",
                this.el.style.top = n(e).position().top + "px"
            }
        },
        hideTooltip: function() {
            this.el.style.display = "none"
        }
    };
    var u = function() {
        o(),
        n && (this._selectables = new window.Map,
        this._graphNode = new a(this._selectables),
        this._graphRender = new r(this._selectables),
        this._displayNode = !0,
        this._displayRenderer = !1,
        this._cbSelect = void 0,
        this._focusedElement = "graph",
        this._idToDomElement = new window.Map,
        this._$svg = n("<svg width=100% height=100%></svg>"),
        n("body").append(this._$svg),
        this._css = ".node {text-align: center;cursor: pointer;}.node rect {stroke: #FFF;}.edgePath path {stroke: #FFF;fill: none;}table {text-align: right;}svg {position: absolute;left: 0px;top: 0px;}.osgDebugButton {position: absolute;left: 15px;top: 15px;z-index: 5;border: 0;background: #65a9d7;background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));background: -webkit-linear-gradient(top, #3e779d, #65a9d7);background: -moz-linear-gradient(top, #3e779d, #65a9d7);background: -ms-linear-gradient(top, #3e779d, #65a9d7);background: -o-linear-gradient(top, #3e779d, #65a9d7);padding: 5px 10px;-webkit-border-radius: 7px;-moz-border-radius: 7px;border-radius: 7px;-webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;-moz-box-shadow: rgba(0,0,0,1) 0 1px 0;box-shadow: rgba(0,0,0,1) 0 1px 0;text-shadow: rgba(0,0,0,.4) 0 1px 0;color: white;font-size: 15px;font-family: Helvetica, Arial, Sans-Serif;text-decoration: none;vertical-align: middle;}.osgDebugButton:hover {border-top-color: #28597a;background: #28597a;color: #ccc;}.osgDebugButton:active {border-top-color: #1b435e;background: #1b435e;}.osgDebugSimpleTooltip .osgDebugName {font-weight: bold;color: #60b1fc;margin: 0;}.osgDebugSimpleTooltip .osgDebugDescription {margin: 0;}")
    };
    u.instance = function() {
        return u._instance || (u._instance = new u),
        u._instance
    }
    ,
    u.prototype = {
        getColorFromClassName: a.prototype.getColorFromClassName,
        setCallbackSelect: function(t) {
            this._cbSelect = t
        },
        reset: function() {
            n && (this._selectables.clear(),
            this._$svg.empty(),
            this._focusedElement = "scene",
            n(".osgDebugButton").hide())
        },
        setDisplayGraphRenderer: function(t) {
            this._displayRenderer = t
        },
        createRenderGraph: function(t) {
            this._graphRender.createGraph(t),
            this.displayGraph()
        },
        createGraph: function(t) {
            n && (this.reset(),
            this._displayNode = !!t,
            t && this._graphNode.createGraph(t),
            this._displayRenderer ? i(538).debugGraph = !0 : this.displayGraph())
        },
        displayGraph: function() {
            if (n) {
                if (window.d3 && window.dagreD3)
                    return void this._createGraphApply();
                var t = this._createGraphApply.bind(this);
                n.getScript("//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js").done(function() {
                    n.getScript("//cdn.jsdelivr.net/dagre-d3/0.2.9/dagre-d3.min.js").done(t)
                })
            }
        },
        _createGraphApply: function() {
            var t = new window.dagreD3.Digraph;
            this._displayNode && this._graphNode.generateNodeAndLink(t),
            this._displayRenderer && this._graphRender.generateNodeAndLink(t),
            this.injectStyleElement(),
            n(".osgDebugButton").show();
            var e = this.renderer = new window.dagreD3.Renderer
              , i = window.d3.select(this._$svg.get(0))
              , r = i.append("g")
              , a = e.zoom();
            e.zoom(function(t, e) {
                var i = a(t, e);
                return i.scale(.75).event(e),
                i
            });
            var s = function(t, e) {
                return '<p class="osgDebugName">' + t + '</p><pre class="osgDebugDescription">' + e + "</pre>"
            }
              , o = this._idToDomElement
              , u = e.drawNodes();
            e.drawNodes(function(t, e) {
                var i = u(t, e);
                return i.attr("title", function(e) {
                    return o.set(e, this),
                    s(e, t.node(e).description || "")
                }),
                i
            }),
            e.run(t, r),
            this.tooltip = new l({
                selector: ".node"
            }),
            n(".node").click(this.onNodeSelect.bind(this)),
            this.focusOnGraph()
        },
        selectNode: function(t) {
            var e = t.getInstanceID()
              , i = this._idToDomElement.get(e);
            i && n(i).click()
        },
        onNodeSelect: function(t) {
            var e = t.currentTarget
              , i = n(e.getAttribute("title"))[0].innerHTML
              , r = this._selectables;
            this.lastNode && (this.lastNode.style.fill = this.lastColor);
            var a = r.get(i);
            a && (this.lastNode = e.childNodes[0],
            this.lastColor = this.lastNode.style.fill,
            e.childNodes[0].style.fill = "#f00",
            window.activeNode = a,
            s.info("window.activeNode is set with the node below !"),
            s.log(window.activeNode),
            s.log("\n"),
            this._cbSelect && this._cbSelect(a))
        },
        focusOnScene: function() {
            n(".osgDebugButton").text("Access to the graph"),
            this._$svg.css("zIndex", "-2"),
            this._focusedElement = "scene"
        },
        focusOnGraph: function() {
            n(".osgDebugButton").text("Access to the scene"),
            this._$svg.css("zIndex", "2"),
            n(".osgDebugSimpleTooltip").css("zIndex", "3"),
            this._focusedElement = "graph"
        },
        injectStyleElement: function() {
            if (!this._cssInjected) {
                this._cssInjected = !0,
                n("body").append('<button class="osgDebugButton">Access to the scene</button>'),
                n(".osgDebugButton").click(function() {
                    "scene" === this._focusedElement ? this.focusOnGraph() : this.focusOnScene()
                }
                .bind(this));
                var t = document.createElement("style");
                t.type = "text/css",
                t.innerHTML = this._css,
                document.getElementsByTagName("head")[0].appendChild(t)
            }
        }
    },
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(430)
      , a = i(457)
      , s = i(85)
      , o = i(523)
      , l = i(612)
      , u = i(433)
      , h = i(5).vec4
      , c = i(534)
      , d = i(537)
      , p = function(t) {
        s.call(this),
        this._state = void 0,
        this._camera = t,
        this._renderStage = void 0,
        this._stateGraph = void 0,
        this._frameStamp = void 0,
        this._previousCullsettings = new r,
        this.setDefaults()
    };
    p.debugGraph = !1,
    p.prototype = n.objectLibraryClass(n.objectInherit(s.prototype, {
        setDefaults: function() {
            this._state = new l(new c.ShaderGeneratorProxy),
            this._cullVisitor = new a,
            this._cullVisitor.setRenderer(this),
            this._stateGraph = new u,
            this.getCamera().setClearColor(h.create()),
            this.setRenderStage(new o);
            var t = i(616)
              , e = this.getCamera().getOrCreateStateSet();
            e.setAttributeAndModes(new t.Material),
            e.setAttributeAndModes(new t.Depth),
            e.setAttributeAndModes(new t.BlendFunc),
            e.setAttributeAndModes(new t.CullFace)
        },
        getCullVisitor: function() {
            return this._cullVisitor
        },
        setCullVisitor: function(t) {
            t && !t.getRenderer() && t.setRenderer(this),
            this._cullVisitor = t
        },
        setRenderStage: function(t) {
            this._renderStage = t
        },
        getCamera: function() {
            return this._camera
        },
        setFrameStamp: function(t) {
            this._frameStamp = t
        },
        getFrameStamp: function() {
            return this._frameStamp
        },
        getState: function() {
            return this._state
        },
        setState: function(t) {
            this._state = t
        },
        setGraphicContext: function(t) {
            this._state.setGraphicContext(t)
        },
        getGraphicContext: function() {
            return this._state.getGraphicContext()
        },
        cullAndDraw: function() {
            this.cull(),
            this.draw()
        },
        cull: function() {
            var t = this.getCamera()
              , e = t.getView();
            this._cullVisitor.setFrameStamp(this._frameStamp),
            this._cullVisitor.resetStats(),
            this._stateGraph.clean(),
            this._renderStage.reset(),
            this._cullVisitor.reset(),
            this._cullVisitor.setStateGraph(this._stateGraph),
            this._cullVisitor.setRenderStage(this._renderStage),
            this._cullVisitor.pushStateSet(t.getStateSet()),
            this._previousCullsettings.reset(),
            this._previousCullsettings.setCullSettings(this._cullVisitor),
            this._cullVisitor.setCullSettings(t),
            this._previousCullsettings.getSettingSourceOverrider() === this._cullVisitor && this._previousCullsettings.getEnableFrustumCulling() && this._cullVisitor.setEnableFrustumCulling(!0),
            this._cullVisitor.pushCameraModelViewProjectionMatrix(t, t.getViewMatrix(), t.getProjectionMatrix()),
            t.getBound();
            var n = e.getLight()
              , r = i(539);
            if (n)
                switch (e.getLightingMode()) {
                case r.LightingMode.HEADLIGHT:
                    this._cullVisitor.addPositionedAttribute(null, n);
                    break;
                case r.LightingMode.SKY_LIGHT:
                    this._cullVisitor.addPositionedAttribute(t.getViewMatrix(), n)
                }
            this._cullVisitor.pushViewport(t.getViewport()),
            this._renderStage.setClearDepth(t.getClearDepth()),
            this._renderStage.setClearColor(t.getClearColor()),
            this._renderStage.setClearMask(t.getClearMask()),
            this._renderStage.setViewport(t.getViewport()),
            this._cullVisitor.setDatabaseRequestHandler(this._camera.getView().getDatabasePager()),
            this._cullVisitor.handleCullCallbacksAndTraverse(t),
            this._cullVisitor.popCameraModelViewProjectionMatrix(t),
            this._cullVisitor.setCullSettings(this._previousCullsettings),
            this._cullVisitor.popViewport(),
            this._cullVisitor.popStateSet(),
            this._renderStage.sort()
        },
        draw: function() {
            var t = this.getState();
            t.resetCacheFrame(),
            t.resetStats(),
            this._renderStage.setCamera(this._camera),
            this._renderStage.draw(t),
            p.debugGraph && (d.instance().createRenderGraph(this._renderStage),
            p.debugGraph = !1),
            this._renderStage.setCamera(void 0),
            t.applyDefault()
        }
    }), "osgViewer", "Renderer"),
    t.exports = p
}
, function(t, e, i) {
    "use strict";
    var n = i(162)
      , r = i(272)
      , a = i(604)
      , s = i(378)
      , o = i(432)
      , l = i(5).mat4
      , u = i(93)
      , h = i(322)
      , c = i(323)
      , d = i(5).vec3
      , p = i(412)
      , f = i(326)
      , g = i(464)
      , m = i(465)
      , v = i(538)
      , _ = i(666)
      , b = i(537)
      , x = i(28)
      , y = function() {
        this._camera = new r,
        this._camera.setName("OSGJS camera"),
        this._scene = new _,
        this._camera.setName("OSGJS Scene"),
        this._frameStamp = new a,
        this._lightingMode = void 0,
        this._manipulator = void 0,
        this._canvasWidth = 0,
        this._canvasHeight = 0,
        this._requestContinousUpdate = !0,
        this._requestRedraw = !0,
        this.setLightingMode(y.LightingMode.HEADLIGHT);
        var t = this.createRenderer(this.getCamera());
        t.setFrameStamp(this._frameStamp),
        this.getCamera().setRenderer(t),
        this.getCamera().setView(this)
    };
    y.LightingMode = {
        NO_LIGHT: 0,
        HEADLIGHT: 1,
        SKY_LIGHT: 2
    },
    y.prototype = {
        requestRedraw: function() {
            this._requestRedraw = !0
        },
        requestContinuousUpdate: function(t) {
            this._requestContinousUpdate = t
        },
        createRenderer: function(t) {
            return new v(t)
        },
        setGraphicContext: function(t) {
            this.getCamera().getRenderer().getState().setGraphicContext(t)
        },
        getGraphicContext: function() {
            return this.getCamera().getRenderer().getState().getGraphicContext()
        },
        initWebGLCaps: function(t) {
            f.instance(t)
        },
        computeCanvasSize: function() {
            return function(t) {
                var e, i;
                e = t.clientWidth,
                i = t.clientHeight,
                e < 1 && (e = 1),
                i < 1 && (i = 1);
                var n = this._devicePixelRatio
                  , r = Math.floor(e * n)
                  , a = Math.floor(i * n)
                  , s = !1;
                return this._canvasWidth !== r && (t.width = r,
                this._canvasWidth = r,
                s = !0),
                this._canvasHeight !== a && (t.height = a,
                this._canvasHeight = a,
                s = !0),
                s
            }
        }(),
        getCanvasWidth: function() {
            return this._canvasWidth
        },
        getCanvasHeight: function() {
            return this._canvasHeight
        },
        getCanvasClientWidth: function() {
            return Math.ceil(this._canvasWidth / this._devicePixelRatio)
        },
        getCanvasClientHeight: function() {
            return Math.ceil(this._canvasHeight / this._devicePixelRatio)
        },
        getCanvasPixelRatio: function() {
            return this._devicePixelRatio
        },
        setUpView: function(t, e) {
            var i = window.devicePixelRatio || 1
              , n = e.getNumber("overrideDevicePixelRatio")
              , r = e.getNumber("maxDevicePixelRatio") || -1;
            "number" == typeof n ? i = n : -1 !== r && (i = Math.min(i, r)),
            this._devicePixelRatio = i,
            this.computeCanvasSize(t);
            var a = t.width
              , s = t.height
              , o = a / s;
            if (this._camera.setViewport(new p(0,0,a,s)),
            this._camera.setGraphicContext(this.getGraphicContext()),
            l.lookAt(this._camera.getViewMatrix(), d.fromValues(0, 0, -10), d.create(), d.fromValues(0, 1, 0)),
            l.perspective(this._camera.getProjectionMatrix(), Math.PI / 180 * 55, o, 1, 1e3),
            e && e.enableFrustumCulling && this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),
            e && e.debugGraph) {
                var u = this.getCamera();
                b.instance().refreshGraph = function() {
                    var t = b.instance();
                    t.setDisplayGraphRenderer(!0),
                    t.createGraph(u)
                }
                ,
                x.log("to refresh the graphs type in the console:\nOSG.osgUtil.DisplayGraph.instance().refreshGraph()")
            }
        },
        computeIntersections: function(t, e, i) {
            return void 0 === i && (i = -1),
            this._lsi ? this._lsi.reset() : this._lsi = new m,
            this._origIntersect || (this._origIntersect = d.create(),
            this._dstIntersect = d.create()),
            this._lsi.set(d.set(this._origIntersect, t, e, 0), d.set(this._dstIntersect, t, e, 1)),
            this._iv ? this._iv.reset() : (this._iv = new g,
            this._iv.setIntersector(this._lsi)),
            this._iv.setTraversalMask(i),
            this._camera.accept(this._iv),
            this._lsi.getIntersections()
        },
        setFrameStamp: function(t) {
            this._frameStamp = t
        },
        getFrameStamp: function() {
            return this._frameStamp
        },
        setCamera: function(t) {
            this._camera = t
        },
        getCamera: function() {
            return this._camera
        },
        setSceneData: function(t) {
            t !== this._scene.getSceneData() && (this._scene.setSceneData(t),
            this._camera.removeChildren(),
            this._camera.addChild(t))
        },
        getSceneData: function() {
            return this._scene.getSceneData()
        },
        setDatabasePager: function(t) {
            this._scene.setDatabasePager(t)
        },
        getDatabasePager: function() {
            return this._scene.getDatabasePager()
        },
        getScene: function() {
            return this._scene
        },
        getManipulator: function() {
            return this._manipulator
        },
        setManipulator: function(t) {
            this._manipulator = t
        },
        getLight: function() {
            return this._light
        },
        setLight: function(t) {
            this._light = t,
            this._lightingMode !== y.LightingMode.NO_LIGHT && this._scene.getOrCreateStateSet().setAttributeAndModes(this._light)
        },
        getLightingMode: function() {
            return this._lightingMode
        },
        setLightingMode: function(t) {
            this._lightingMode !== t && (this._lightingMode = t,
            this._lightingMode !== y.LightingMode.NO_LIGHT ? this._light || (this._light = new o) : this._light = void 0)
        },
        flushDeletedGLObjects: function(t) {
            var e = this.getGraphicContext();
            t = n.flushDeletedGLBufferArrays(e, t),
            t = u.getTextureManager(e).flushDeletedTextureObjects(e, t),
            t = h.flushDeletedGLPrograms(e, t),
            t = c.flushDeletedGLShaders(e, t),
            t = s.flushDeletedGLFrameBuffers(e, t),
            t = s.flushDeletedGLRenderBuffers(e, t)
        },
        flushAllDeletedGLObjects: function() {
            var t = this.getGraphicContext();
            n.flushAllDeletedGLBufferArrays(t),
            u.getTextureManager(t).flushAllDeletedTextureObjects(t),
            h.flushAllDeletedGLPrograms(t),
            c.flushAllDeletedGLShaders(t),
            s.flushAllDeletedGLFrameBuffers(t),
            s.flushAllDeletedGLRenderBuffers(t)
        }
    },
    t.exports = y
}
, , , function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(90)
      , s = i(29)
      , o = r.a.osg
      , l = function(t, e, i, n) {
        var r = i - t
          , a = n - e;
        return r * r + a * a
    }
      , u = function(t) {
        return 0 == (t & t - 1)
    }
      , h = function(t) {
        return u(t.width) && u(t.height)
    }
      , c = {
        isVideoURL: function(t) {
            var e = t.split(".")
              , i = e[e.length - 1].toLowerCase();
            return "ogv" === i || "ogg" === i || "mp4" === i || "avi" === i || "webm" === i
        },
        isVideo: function() {
            return this.isVideoURL(this.get("images")[0].url)
        },
        getUID: function() {
            return this.get("uid")
        },
        getImages: function() {
            return this.get("images")
        },
        getURL: function() {
            console.error("dont call ImageProxy.getURL")
        },
        findFormat: function(t) {
            if ("N" === t) {
                var e = i.i(n.filter)(this.get("images"), function(e) {
                    var n = e.options && e.options.format === t && e.options.quality;
                    return "percep" === i.i(s.a)().normalCompression ? n && "percep" === n.flag : n && "percep" !== n.flag
                });
                if (e.length)
                    return e
            }
            return i.i(n.filter)(this.get("images"), function(e) {
                return !e.options || e.options.format === t
            })
        },
        getFilteredImages: function(t) {
            if (!t || i.i(a.a)() || !i.i(s.a)().imageCompression)
                return this.findFormat();
            var e;
            switch (t) {
            case o.Texture.ALPHA:
                if (e = this.findFormat("A"),
                e.length > 0)
                    return e;
                break;
            case o.Texture.RGB:
                if (e = this.findFormat("RGB"),
                e.length > 0)
                    return e;
                if (e = this.findFormat("N"),
                e.length > 0)
                    return e;
                break;
            case o.Texture.LUMINANCE:
                if (e = this.findFormat("R"),
                e.length > 0)
                    return e;
                if (e = this.findFormat("RGB"),
                e.length > 0)
                    return e;
                if (e = this.findFormat("N"),
                e.length > 0)
                    return e
            }
            return this.findFormat()
        },
        findImageNearestPowerOfTwoUpToResolution: function(t, e, i) {
            return this.findImageNearestUpToResolution(t, e, !0, i)
        },
        findImageNearestUpToResolution: function(t, e, i, n) {
            for (var r, a, s = 1 / 0, o = !1, u = 1 / 0, c = this.getFilteredImages(n), d = 0, p = c.length; d < p; ++d) {
                var f = c[d]
                  , g = l(t, e, f.width, f.height);
                if (g < s && (s = g,
                r = f),
                !(f.width > t || f.height > e))
                    if (i) {
                        var m = h(f);
                        o && !m || (!a || !o && m || g < u || u === 1 / 0 && f.width > a.width && f.height > a.height) && (a = f,
                        o = m,
                        u = g)
                    } else
                        (!a || g < u || u === 1 / 0 && f.width > a.width && f.height > a.height) && (a = f,
                        u = g)
            }
            return a || r
        },
        findImageSmallest: function(t) {
            return this.findImageNearestToResolution(0, 0, t)
        },
        findImageWidget: function() {
            return this.findImageNearestToResolution(0, 0, o.Texture.RGB)
        },
        findImageNearestToResolution: function(t, e, i) {
            for (var n, r = 1 / 0, a = this.getFilteredImages(i), s = 0, o = a.length; s < o; ++s) {
                var u = a[s]
                  , h = l(t, e, u.width, u.height);
                h < r && (r = h,
                n = u)
            }
            return n
        }
    };
    e.a = c
}
, , function(t, e, i) {
    "use strict";
    var n = i(15);
    e.a = n.a.extend({
        defaults: {
            soundcloudID: "",
            label: "",
            enable: !0,
            ambient: !0,
            volume: .5,
            loop: !1,
            snap: !1,
            sync: !1,
            distance: -1,
            startTime: 0,
            position: [0, 0, 0],
            geometryUid: -1,
            indices: [-1, -1, -1],
            barycentricWeights: [0, 0, 0],
            localPosition: [0, 0, 0],
            lastComputedScenePosition: [0, 0, 0]
        },
        getJSON: function() {
            return {
                soundcloudID: this.get("soundcloudID"),
                label: this.get("label"),
                enable: this.get("enable"),
                ambient: this.get("ambient"),
                volume: this.get("volume"),
                loop: this.get("loop"),
                snap: this.get("snap"),
                sync: this.get("sync"),
                distance: this.get("distance"),
                startTime: this.get("startTime"),
                position: this.get("position"),
                geometryUid: this.get("geometryUid"),
                indices: this.get("indices"),
                barycentricWeights: this.get("barycentricWeights"),
                localPosition: this.get("localPosition")
            }
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(18)
      , r = i.n(n)
      , a = i(7)
      , s = i.n(a)
      , o = i(37);
    e.a = {
        connect: function() {
            return new s.a(function(t) {
                var e, i = o.a.soundcloudAppId, n = encodeURIComponent("https://" + window.location.hostname + o.a.oauthRedirectUris.soundcloud), r = "https://soundcloud.com/connect?client_id=" + i + "&redirect_uri=" + n + "&response_type=token", a = window.open(r, "log in soundcloud", "height=680,width=900"), s = window.setInterval(function() {
                    a.closed && window.clearInterval(s);
                    try {
                        e = a.window.location.hash
                    } catch (t) {
                        return
                    }
                    window.clearInterval(s),
                    a.close(),
                    -1 !== e.indexOf("access_token") && t(e.split("#access_token=")[1].split("&")[0])
                }, 1e3)
            }
            )
        },
        checkToken: function(t) {
            return s.a.resolve(r.a.ajax({
                url: "https://api.soundcloud.com/me",
                type: "GET",
                data: {
                    oauth_token: t
                },
                allowPrefetching: !1
            }))
        },
        resolveUrl: function(t) {
            return s.a.resolve(r.a.ajax({
                url: "https://api.soundcloud.com/resolve",
                type: "GET",
                data: {
                    url: t,
                    client_id: o.a.soundcloudAppId
                },
                allowPrefetching: !1
            }))
        },
        getTrackUrl: function(t) {
            return "https://api.soundcloud.com/tracks/" + t + "/stream?client_id=" + o.a.soundcloudAppId
        },
        fetch: function(t) {
            return s.a.resolve(r.a.ajax({
                url: "https://api.soundcloud.com/tracks/" + t,
                type: "GET",
                data: {
                    client_id: o.a.soundcloudAppId
                },
                allowPrefetching: !1
            }))
        },
        fetchTracks: function(t) {
            return s.a.resolve(r.a.ajax({
                url: "https://api.soundcloud.com/me/tracks",
                type: "GET",
                data: {
                    oauth_token: t
                },
                allowPrefetching: !1
            }))
        },
        upload: function(t, e, i) {
            var n = new FormData;
            return n.append("track[asset_data]", t),
            n.append("track[title]", t.name),
            s.a.resolve(r.a.ajax({
                url: "https://api.soundcloud.com/tracks?oauth_token=" + e,
                type: "POST",
                data: n,
                processData: !1,
                contentType: !1,
                xhr: function() {
                    var t = new XMLHttpRequest;
                    return t.upload && (t.upload.addEventListener("progress", i.progress),
                    t.upload.addEventListener("loadend", i.load)),
                    t
                }
            }))
        }
    }
}
, , function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(70)
      , a = n.a.osg
      , s = function() {
        a.CullVisitor.call(this),
        this._uNearFar = a.Uniform.createFloat2(a.vec2.fromValues(1, -1), "uNearFar"),
        this._separateVR = !1,
        this._isEnv = !1
    }
      , o = s.vrConfig = {
        doVR: !1,
        leftRenderWidth: 0,
        rightRenderWidth: 0,
        leftRenderHeight: 0,
        rightRenderHeight: 0,
        rightProjection: a.mat4.create(),
        leftProjection: a.mat4.create(),
        leftOffsetView: a.mat4.create(),
        rightOffsetView: a.mat4.create()
    };
    s.prototype = a.objectInherit(a.CullVisitor.prototype, {
        popCameraModelViewProjectionMatrix: function(t) {
            this.popModelViewMatrix(),
            this.popProjectionMatrix(t)
        },
        reset: function() {
            a.CullVisitor.prototype.reset.call(this),
            this._minNear = this._computedNear,
            this._maxFar = this._computedFar
        },
        updateNearFar: function() {
            this._minNear = Math.min(this._minNear, this._computedNear),
            this._maxFar = Math.max(this._maxFar, this._computedFar)
        },
        getNearFarUniform: function() {
            return this._uNearFar
        },
        popProjectionMatrix: function(t) {
            if (!0 === this._computeNearFar && this._computedFar >= this._computedNear) {
                var e = this.getCurrentProjectionMatrix()
                  , i = void 0 !== t && !t.isRenderToTextureCamera() && t.getReferenceFrame() === a.Transform.RELATIVE_RF
                  , n = "PostProcess - MainCamera" === t.getName();
                if ((i || n) && this.updateNearFar(),
                n) {
                    var r = this._projectionMatrixStack[0];
                    a.mat4.copy(r, e),
                    this.clampProjectionMatrix(r, this._minNear, this._maxFar, 1e-5),
                    o.doVR && (this.clampProjectionMatrix(o.leftProjection, this._computedNear, this._computedFar, this._nearFarRatio),
                    this.clampProjectionMatrix(o.rightProjection, this._computedNear, this._computedFar, this._nearFarRatio)),
                    this.clampProjectionMatrix(e, this._computedNear, this._computedFar, this._nearFarRatio, this._uNearFar.getInternalArray())
                } else
                    this.clampProjectionMatrix(e, this._computedNear, this._computedFar, this._nearFarRatio)
            }
            a.CullStack.prototype.popProjectionMatrix.call(this)
        },
        handleCullCallbacksAndTraverse: function(t) {
            var e = o.doVR && (this._nodeOut === t || "PostProcess - node Out" === t.getName());
            e && (this._nodeOut = t,
            this._separateVR = !0);
            var i = this._nodeEnv === t || "Environment - Camera" === t.getName();
            i && (this._nodeEnv = t,
            this._isEnv = !0);
            var n = t.getCullCallback();
            n && !n.cull(t, this) || this.traverse(t),
            i && (this._isEnv = !1),
            e && (this._separateVR = !1)
        },
        pushLeaf: function(t, e) {
            var i = this._currentStateGraph.leafs;
            0 === i.length && this._currentRenderBin.addStateGraph(this._currentStateGraph);
            var n = this._separateVR && this.traversalMask !== r.a.SHADOW
              , s = this.createOrReuseRenderLeaf();
            if (s.isVR = n,
            n) {
                var l = this._isEnv
                  , u = this.getCurrentModelViewMatrix()
                  , h = this.getCurrentViewMatrix();
                s.leftProjection = o.leftProjection,
                s.rightProjection = o.rightProjection;
                var c = s.leftModelView || a.mat4.create()
                  , d = s.rightModelView || a.mat4.create();
                s.leftModelView = l ? a.mat4.copy(c, u) : a.mat4.multiply(c, o.leftOffsetView, u),
                s.rightModelView = l ? a.mat4.copy(d, u) : a.mat4.multiply(d, o.rightOffsetView, u);
                var p = s.leftView || a.mat4.create()
                  , f = s.rightView || a.mat4.create();
                s.leftView = l ? a.mat4.copy(p, h) : a.mat4.multiply(p, o.leftOffsetView, h),
                s.rightView = l ? a.mat4.copy(f, h) : a.mat4.multiply(f, o.rightOffsetView, h)
            }
            s.init(this._currentStateGraph, t, this.getCurrentProjectionMatrix(), this.getCurrentViewMatrix(), this.getCurrentModelViewMatrix(), this.getCurrentModelMatrix(), e),
            i.push(s)
        }
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(966)
      , a = i(969)
      , s = i(51)
      , o = i(29)
      , l = n.a.osg
      , u = n.a.osgGA
      , h = n.a.osgUtil
      , c = h.DelayInterpolator.prototype
      , d = c.reset;
    c.reset = function() {
        d.call(this),
        this._epsilon = .01
    }
    ;
    var p = c.set;
    c.set = function() {
        p.apply(this, arguments),
        this._epsilon >= 0 && !this.isDone() && s.a.draw()
    }
    ;
    var f = c.setTarget;
    c.setTarget = function() {
        this._isOrbitPan && i.i(o.a)().orbitConstraintPan || (f.apply(this, arguments),
        this._epsilon >= 0 && !this.isDone() && s.a.draw())
    }
    ;
    var g = c.addTarget;
    c.addTarget = function() {
        g.apply(this, arguments),
        this._epsilon >= 0 && !this.isDone() && s.a.draw()
    }
    ,
    c.isDone = function() {
        for (var t = Math.abs(this._epsilon), e = 0, i = this._current.length; e < i; ++e)
            if (Math.abs(this._target[e] - this._current[e]) > t)
                return !1;
        return !0
    }
    ;
    var m = c.update;
    c.update = function(t) {
        var e = m.call(this, t);
        if (this._epsilon >= 0)
            if (this.isDone())
                for (var i = 0, n = this._current.length; i < n; ++i)
                    this._current[i] = this._target[i];
            else
                s.a.draw();
        return e
    }
    ;
    var v = function() {
        for (var t = Math.abs(this._epsilon), e = 0, i = this._current.length; e < i; ++e)
            if (1 === Math.abs(this._target[e]) || Math.abs(this._target[e] - this._current[e]) > t)
                return !1;
        return !0
    }
      , _ = function(t) {
        t.isDone = v.bind(t)
    }
      , b = function() {
        u.SwitchManipulator.call(this),
        this._boundStrategy = u.Manipulator.COMPUTE_HOME_USING_SPHERE | u.Manipulator.COMPUTE_HOME_USING_BBOX,
        this.init()
    };
    b.prototype = l.objectInherit(u.SwitchManipulator.prototype, {
        init: function() {
            u.SwitchManipulator.prototype.setManipulatorIndex.call(this, 0);
            var t = new a.a(this._boundStrategy);
            t.getRotateInterpolator()._epsilon = .1,
            t.getPanInterpolator()._epsilon = .1,
            t.getZoomInterpolator()._epsilon = .001,
            t.getPanInterpolator()._isOrbitPan = !0;
            var e = new r.a(this._boundStrategy);
            e.getLookPositionInterpolator()._epsilon = .1,
            e.getSideInterpolator()._epsilon = .001,
            _(e.getSideInterpolator()),
            e.getForwardInterpolator()._epsilon = .001,
            _(e.getForwardInterpolator()),
            e.getPanInterpolator()._epsilon = .001,
            _(e.getPanInterpolator()),
            e.getZoomInterpolator()._epsilon = .001,
            _(e.getZoomInterpolator()),
            this.addManipulator(t, "ORBIT"),
            this.addManipulator(e, "FPS"),
            void 0 !== i.i(o.a)().cameraEasing && this.setDelay(1 - i.i(o.a)().cameraEasing)
        },
        getOrbitManipulator: function() {
            return this._manipulatorList[b.ORBIT]
        },
        getFirstPersonManipulator: function() {
            return this._manipulatorList[b.FPS]
        },
        _setManipulatorDelay: function(t, e) {
            t.setDelay(e);
            var i = t._controllerList;
            for (var n in i) {
                var r = i[n];
                void 0 !== r._delay && (r._delay = e)
            }
        },
        setDelay: function(t) {
            this._setManipulatorDelay(this._manipulatorList[b.ORBIT], t),
            this._setManipulatorDelay(this._manipulatorList[b.FPS], t)
        },
        addManipulator: function(t, e) {
            u.SwitchManipulator.prototype.addManipulator.call(this, t),
            e && (b[e] = this.getManipulatorList().length - 1)
        },
        setManipulatorIndex: function() {
            var t = l.vec3.create()
              , e = l.vec3.create();
            return function(i) {
                if (i !== this.getCurrentManipulatorIndex()) {
                    var n = this.getCurrentManipulator();
                    u.SwitchManipulator.prototype.setManipulatorIndex.call(this, i),
                    this.setTargetAndEye(n.getTarget(t), n.getEyePosition(e))
                }
            }
        }(),
        setTargetAndEye: function(t, e) {
            var i = this.getCurrentManipulator();
            this.getCurrentManipulatorIndex() === b.ORBIT ? (t && i.setTarget(t),
            e && i.setEyePosition(e)) : (e && i.setEyePosition(e),
            t && i.setTarget(t)),
            s.a.draw()
        },
        setEyePosition: function(t, e) {
            this.getCurrentManipulator().setEyePosition(t, e),
            s.a.draw()
        },
        getEyePosition: function(t) {
            return this.getCurrentManipulator().getEyePosition(t)
        },
        setTarget: function(t) {
            this.getCurrentManipulator().setTarget(t),
            s.a.draw()
        },
        getTarget: function(t) {
            return this.getCurrentManipulator().getTarget(t)
        },
        setDistance: function(t) {
            this.getCurrentManipulatorIndex() === b.ORBIT && (this.getCurrentManipulator().setDistance(t),
            s.a.draw())
        },
        getDistance: function() {
            return this.getCurrentManipulator().getDistance()
        },
        computeHomePosition: function(t) {
            u.SwitchManipulator.prototype.computeHomePosition.call(this, t),
            s.a.draw()
        }
    }),
    e.a = b
}
, function(t, e, i) {
    "use strict";
    var n = i(18)
      , r = i.n(n)
      , a = i(7)
      , s = i.n(a)
      , o = i(1)
      , l = (i.n(o),
    i(4))
      , u = i(90)
      , h = i(328)
      , c = i(973)
      , d = i(974)
      , p = i(976)
      , f = i(498)
      , g = i(151)
      , m = l.a.osg
      , v = 1
      , _ = function() {
        m.NodeVisitor.call(this, m.NodeVisitor.TRAVERSE_PARENTS),
        this._material = void 0,
        this._manager = void 0
    };
    _.prototype = m.objectInherit(m.NodeVisitor.prototype, {
        setManager: function(t) {
            this._manager = t
        },
        reset: function() {
            this.nodePath.length = 0,
            this._material = void 0
        },
        apply: function(t) {
            if (!this._material) {
                var e = t.getStateSet();
                e && (this._material = this._manager.getMaterialByStateSet(e)),
                this._material || this.traverse(t)
            }
        }
    });
    var b = function(t, e) {
        m.NodeVisitor.call(this),
        this._manager = t,
        this._useVertexAlpha = e,
        this._stackMaterial = []
    };
    b.prototype = m.objectInherit(m.NodeVisitor.prototype, {
        apply: function(t) {
            var e = t.getStateSet()
              , i = e && this._manager.getMaterialByStateSet(e);
            if (i && this._stackMaterial.push(i),
            t instanceof m.Geometry && this._stackMaterial.length > 0) {
                var n = this._stackMaterial[this._stackMaterial.length - 1];
                t.getVertexAttributeList().Color && (n.set("hasVertexColor", !0),
                !n.get("hasVertexAlpha") && t.userDataMap.hasVertexAlpha && (n.set("hasVertexAlpha", !0),
                n.getChannels().Opacity.set("vertexAlphaEnable", this._useVertexAlpha))),
                t.userDataMap && (n.set("hasPoints", t.userDataMap.hasPoints),
                n.set("hasTriangles", t.userDataMap.hasTriangles),
                n.set("hasLines", t.userDataMap.hasLines)),
                n.get("geometryList").push(t)
            }
            this.traverse(t),
            i && this._stackMaterial.pop()
        }
    });
    var x = r.a.Model.extend({
        initialize: function() {
            this._materialByStateSetID = {},
            this._materialNames = {
                material_: 0
            }
        },
        getImageCollection: function() {
            return this.imageCollection || l.a.osg.error("ImageCollection not initialized in MaterialManager, somewhing wrong"),
            this.imageCollection
        },
        setImageCollection: function(t) {
            this.imageCollection = t
        },
        setNewMaterial: function(t, e) {
            this.attributes[t] = e;
            var i = e.get("stateSetID");
            void 0 !== i && (this._materialByStateSetID[i] = e)
        },
        addMaterial: function(t) {
            var e = new c.a
              , i = this.getImageCollection();
            return e.setMaterialJSON(t, i),
            new d.a({
                model: e
            }),
            this.setNewMaterial(t.id, e),
            e
        },
        getMaterialStateID: function(t) {
            if (void 0 !== t._materialID)
                return t._materialID;
            var e = t.getUserData();
            if (e)
                for (var i = e.length - 1; i >= 0; --i)
                    if ("UniqueID" === e[i].Name) {
                        t._materialID = parseInt(e[i].Value, 10);
                        break
                    }
            return void 0 === t._materialID && (void 0 !== t._uniqueID ? t._materialID = t._uniqueID : (l.a.osg.warn("v0 StateSet detected"),
            t._materialID = v++)),
            t._materialID
        },
        getMaterialByStateSetID: function(t) {
            return void 0 !== t ? this._materialByStateSetID[t] : void 0
        },
        getMaterialByStateSet: function(t) {
            return this.getMaterialByStateSetID(this.getMaterialStateID(t))
        },
        removeMaterialByStateSetID: function(t) {
            var e = this;
            i.i(o.filter)(this.attributes, function(e) {
                return e.get("stateSetID") === t
            }).forEach(function(t) {
                delete e.attributes[t.get("id")]
            })
        },
        removeMaterialByStateSet: function(t) {
            var e = this.attributes;
            for (var i in e) {
                if (e[i].get("stateSet") === t)
                    return void delete e[i]
            }
        },
        removeUnboundMaterial: function() {
            var t = this.attributes;
            i.i(o.each)(t, function(e) {
                e.get("stateSet") || delete t[e.get("id")]
            })
        },
        createMaterial: function(t, e) {
            void 0 === e && (e = t.getOrCreateStateSet());
            var n = new c.a;
            new d.a({
                model: n
            });
            var r = i.i(p.a)();
            return n.set("id", r),
            n.set("stateSetID", this.getMaterialStateID(e)),
            n.set("name", this.getUniqueMaterialName(e.getAttributeMap().Material, e, t)),
            this.setNewMaterial(r, n),
            n
        },
        getUniqueMaterialName: function(t, e, i) {
            var n = this._materialNames
              , r = t && t.getAttribute() ? t.getAttribute().getName() : void 0;
            return void 0 === r && (r = void 0 !== e.getName() ? e.getName() : i.getName()),
            void 0 === r ? "material_" + n.material_++ : (void 0 === n[r] ? n[r] = 0 : r += "_" + n[r]++,
            r)
        },
        setWorkFlowMetalSpec: function(t, e) {
            var i = this.attributes;
            for (var n in i)
                i[n].setWorkFlowMetalSpec(t, e)
        },
        setWorkFlowRoughGloss: function(t, e) {
            var i = this.attributes;
            for (var n in i)
                i[n].setWorkFlowRoughGloss(t, e)
        },
        overrideMaterialChannels: function(t) {
            if (!i.i(u.a)() && t.materialShowcase) {
                var e = t.materialDisplacement
                  , n = t.materialDisplacementFactor
                  , r = t.materialNormal
                  , a = t.materialDiffuse
                  , s = t.materialMetalness
                  , l = t.materialRoughness
                  , h = t.materialGlossiness
                  , c = t.materialSpecular
                  , d = t.materialEmissive
                  , p = t.materialTransparency
                  , f = t.materialCavity
                  , g = t.materialAO
                  , m = t.materialF0
                  , v = t.materialNames || "main_material"
                  , _ = v.split(";")
                  , b = this;
                if (t.substanceDisplacement && void 0 !== e) {
                    var x = this.attributes["ae605e73-2987-4b0f-b25b-bdf1dc02e6ed"];
                    x || (x = i.i(o.find)(this.attributes, function(t) {
                        return "Sides" === t.get("name")
                    })),
                    x && this._replaceChannelURL(x.getChannels(), "Displacement", e, !0, n)
                }
                i.i(o.each)(this.attributes, function(t) {
                    if (-1 !== _.indexOf(t.get("name"))) {
                        var i = t.getChannels();
                        a && (b._replaceChannelURL(i, "DiffuseColor", a),
                        b._replaceChannelURL(i, "AlbedoPBR", a),
                        b._replaceChannelURL(i, "DiffusePBR", a)),
                        void 0 !== m && (m.length ? b._replaceChannelURL(i, "SpecularF0", m) : (i.SpecularF0.reset(),
                        i.SpecularF0.setFactor(.5))),
                        void 0 !== r && b._replaceChannelURL(i, "NormalMap", r, !0),
                        void 0 !== e && b._replaceChannelURL(i, "Displacement", e, !0, n),
                        void 0 !== f && b._replaceChannelURL(i, "CavityPBR", f, !0),
                        void 0 !== d && b._replaceChannelURL(i, "EmitColor", d, !0),
                        void 0 !== p && b._replaceChannelURL(i, "Opacity", p, !0),
                        void 0 !== g && (b._replaceChannelURL(i, "AOPBR", g, !0),
                        b._replaceChannelURL(i, "DiffuseIntensity", g, !0)),
                        (c || s) && (b._replaceChannelURL(i, "SpecularPBR", c),
                        b._replaceChannelURL(i, "MetalnessPBR", s),
                        t.setWorkFlowMetalSpec(Boolean(s))),
                        (l || h) && (b._replaceChannelURL(i, "RoughnessPBR", l),
                        b._replaceChannelURL(i, "GlossinessPBR", h),
                        t.setWorkFlowRoughGloss(Boolean(l)))
                    }
                })
            }
        },
        _replaceChannelURL: function(t, e, i, n, r) {
            var a = t[e];
            if (!i || !i.length)
                return void a.setEnable(!1);
            var s = this.getImageCollection()
              , o = s.addNewImage({
                url: i,
                name: i,
                width: 1,
                height: 1
            })
              , l = new f.a({
                image: o
            });
            a.setTexture(l),
            n && a.setEnable(!0),
            a.setFactor(void 0 === r ? 1 : r)
        },
        tagMaterialWithGeometryInfo: function(t, e) {
            var i = new b(this,e);
            t.accept(i)
        },
        updateTexCoordUnitList: function() {
            var t = this.attributes;
            for (var e in t)
                t[e].updateTexCoordUnitList()
        },
        findFirstMaterial: function() {
            var t = new _;
            return function(e) {
                var i = e.length
                  , n = e[i - 1];
                if (n._mostInfluencedRig)
                    return t.reset(),
                    t.setManager(this),
                    n._mostInfluencedRig.accept(t),
                    t._material;
                for (var r = i - 1; r >= 0; --r) {
                    var a = e[r].getStateSet();
                    if (a) {
                        var s = this.getMaterialByStateSet(a);
                        if (s)
                            return s
                    }
                }
            }
        }(),
        getJSON: function() {
            var t = {}
              , e = this.attributes;
            return i.i(o.each)(e, function(e) {
                t[e.get("id")] = e.getJSON()
            }),
            t
        },
        editorGetJSON: function() {
            var t = {}
              , e = this.getImageCollection();
            for (var i in this.attributes) {
                var n = this.attributes[i].getJSON()
                  , r = n.channels;
                for (var a in r) {
                    var s = r[a];
                    if (void 0 !== s.texture) {
                        var o = e.get(s.texture.uid)
                          , l = o.get("name");
                        s.texture.name = l,
                        delete s.texture.uid,
                        delete s.texture.texCoordUnit,
                        delete s.texture.textureTarget
                    }
                }
                t[i] = {
                    shadeless: n.shadeless,
                    name: n.name,
                    cullFace: n.cullFace,
                    reflection: n.reflection,
                    channels: r
                }
            }
            return t
        },
        editorSetJSON: function(t) {
            var e = this.getImageCollection()
              , i = [];
            for (var n in this.attributes) {
                var r = t[n];
                r && i.push(function(t, i) {
                    for (var n = [], r = 0, a = g.a.length; r < a; r++) {
                        var o = g.a[r]
                          , l = t.channels[o];
                        if (void 0 !== l && l.texture && l.texture.name) {
                            var u = e.where({
                                name: l.texture.name
                            })[0];
                            u ? l.texture.uid = u.getUID() : (t.channels[o] = void 0,
                            n.push("texture " + l.texture.name + " not found in the current scene, skipping channel " + o + " for material " + i.get("name")))
                        }
                    }
                    var h = c.a.validateJSON(t, e);
                    return h ? s.a.reject(h) : (i.setMaterialJSON(t, e),
                    s.a.resolve(n))
                }(r, this.attributes[n]))
            }
            return s.a.all(i)
        }
    });
    x.createMaterialModel = function(t) {
        var e = new c.a;
        return new d.a({
            model: e
        }),
        (new h.a).setMaterialModel(e),
        e.setStateSet(t),
        e
    }
    ,
    e.a = x
}
, function(t, e, i) {
    "use strict";
    Object.defineProperty(e, "__esModule", {
        value: !0
    });
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(6)
      , s = i(15)
      , o = i(151)
      , l = i(356)
      , u = i(498)
      , h = i(51)
      , c = i(146)
      , d = i(292)
      , p = r.a.osg
      , f = function(t) {
        return 0 === t[0] && 0 === t[1] && 0 === t[2]
    }
      , g = function(t) {
        return 1 === t[0] && 1 === t[1] && 1 === t[2]
    }
      , m = {
        CavityPBR: !0,
        AOPBR: !0,
        NormalMap: !0,
        Displacement: !0,
        BumpMap: !0
    }
      , v = {
        DiffusePBR: !0,
        AlbedoPBR: !0,
        SpecularPBR: !0,
        GlossinessPBR: !0,
        RoughnessPBR: !0,
        MetalnessPBR: !0,
        SpecularF0: !0
    }
      , _ = {}
      , b = _.view = a.a.extend({
        initialize: function() {
            a.a.prototype.initialize.apply(this, arguments),
            this.model.on("change:enable", this.updateChannel, this),
            this.model.on("change:texCoordUnit", this.changeTexCoord, this),
            this.model.on("setFactor", this.updateChannel, this),
            this.model.on("setColor", this.updateChannel, this),
            this.model.on("setTexture", this.updateChannel, this),
            this.model.on("updateChannels", this.updateChannel, this),
            this.model.on("all", h.a.draw)
        },
        getStateSetContext: function() {
            return this.options.stateSetContext
        },
        updateChannel: function() {
            if (this.model.getTexture()) {
                var t = this.model.get("material").get("texCoordUnitList")
                  , e = this.model.getTexCoordUnit();
                t.length && -1 === t.indexOf(e) && this.model.setTexCoordUnit(t[0])
            }
            this.getStateSetContext().updateChannel(this.model)
        },
        apply: function() {
            this.updateChannel()
        },
        changeTexCoord: function() {
            this.getStateSetContext().dirtyMaterial()
        }
    })
      , x = _.model = s.a.extend({
        defaults: function() {
            return {
                texture: void 0,
                color: p.vec3.fromValues(1, 1, 1),
                factor: 1,
                enable: !0
            }
        },
        initialize: function() {
            s.a.prototype.initialize.apply(this, arguments),
            this.get("color") && this.get("texture") && this.set("color", void 0)
        },
        createTextureModel: function(t, e) {
            var r = e.get(t.uid);
            if (r)
                return new u.a(i.i(n.extend)(t, {
                    image: r
                }));
            p.error("can't find ImageProxy " + t.uid)
        },
        setChannelJSON: function(t, e) {
            if (void 0 !== t.enable && this.setEnable(t.enable),
            void 0 !== t.factor && this.setFactor(t.factor),
            t.texture) {
                var i = this.createTextureModel(t.texture, e);
                i ? this.setTexture(i) : this.setColor(t.color || p.vec3.fromValues(1, 1, 1))
            } else
                t.color && this.setColor(t.color)
        },
        getName: function() {
            return this.get("name")
        },
        getEnable: function() {
            return this.get("enable")
        },
        getFactor: function() {
            return this.get("factor")
        },
        getTexture: function() {
            return this.get("texture")
        },
        getTexCoordUnit: function() {
            var t = this.get("texture");
            return t && t.get("texCoordUnit")
        },
        getColor: function() {
            return this.get("color")
        },
        setEnable: function(t) {
            return this.set("enable", t)
        },
        setFactor: function(t) {
            return this.set("factor", t),
            this.trigger("setFactor")
        },
        setTexture: function(t) {
            return this.set("color", void 0),
            this.set("texture", t),
            this.trigger("setTexture")
        },
        setColor: function(t) {
            return this.set("texture", void 0),
            this.set("color", p.vec3.copy(this.get("color") || p.vec3.create(), t)),
            this.trigger("setColor")
        },
        setTexCoordUnit: function(t) {
            var e = this.get("texture");
            void 0 !== e && (e.set("texCoordUnit", t),
            this.trigger("change:texCoordUnit"))
        },
        removeTexture: function() {
            this.setColor(p.vec3.ONE)
        },
        reset: function() {
            return this.removeTexture(),
            this.set("factor", 1),
            this.trigger("updateChannels")
        },
        getJSON: function() {
            var t = {}
              , e = this.get("texture");
            void 0 !== e && (t.texture = e.getJSON());
            var i = this.get("color");
            return void 0 !== i && (t.color = i),
            t.factor = this.get("factor"),
            t.enable = this.get("enable"),
            t
        },
        resetTextureFormat: function() {
            var t = this.get("texture");
            t && (t.set("internalFormat", o.a.getDefaultFormat(this.get("name"))),
            t.updateTextureProxy())
        },
        isEffective: function() {
            if (!this.isActivated() || !this.get("enable"))
                return !1;
            var t = this.get("name")
              , e = this.get("factor");
            if (0 === e)
                return !1;
            if (m[t] && !this.get("texture"))
                return !1;
            if ("Displacement" === t && 0 === p.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_TEXTURE_IMAGE_UNITS"))
                return !1;
            var i = this.get("color");
            return ("DiffuseIntensity" !== t || !i || !g(i) || 1 !== e) && !("DiffuseIntensity" !== t && !v[t] && i && f(i))
        },
        isEnableEffective: function() {
            return !(!this.isActivated() || !this.get("enable")) && (!!v[this.get("name")] || this.isEffective())
        },
        isActivated: function() {
            return !!(o.a.getShadingMask(this.get("name")) & this.getCurrentShading())
        },
        getCurrentShading: function() {
            var t = this.get("material").get("stateSet").getShaderGeneratorName();
            return t ? l.a.nameMatch[t] : l.a.get("mask")
        },
        shouldDisplayGUIWarningOnDeletion: function() {
            if (!this.getEnable())
                return !1;
            var t = l.a.get("mask") & l.a.CLASSIC ? l.a.CLASSIC : l.a.PBR;
            return !!(o.a.getShadingMask(this.getName()) & t)
        },
        addUniforms: function(t, e) {
            var i = "u" + (e || this.get("name")) + "Factor";
            t[i] = p.Uniform.createFloat(i)
        },
        cacheUniforms: function(t) {
            this._uniformFactor = t["u" + this.get("name") + "Factor"].getInternalArray(),
            this._valueFactor = this.isEnableEffective() ? this.get("factor") : 0
        },
        updateUniforms: function() {
            this._uniformFactor[0] = this._valueFactor
        },
        getSRGB: function() {
            var t = this.get("texture");
            if (!t)
                return !1;
            if (!t.getImage())
                return o.a.isSRGB(this.get("name"));
            var e = t.getImage().get("colorSpace");
            return "srgb" === e || "linear" !== e && o.a.isSRGB(this.get("name"))
        },
        getShaderHash: function() {
            var t = ""
              , e = this.isEffective()
              , i = e && this.get("texture");
            return t += (this.isEnableEffective() ? "1" : "0") + (this.getSRGB() ? "1" : "0") + (i ? i.get("texCoordUnit") : "x")
        }
    });
    x.validateJSON = function(t, e, i) {
        var n = [];
        if (d.a.isBoolean(e.enable) || n.push(t + " enable must be a boolean"),
        d.a.isNumber(e.factor) || n.push(t + " factor must be a number"),
        void 0 === e.texture && void 0 === e.color && n.push(t + " texture or color is missing"),
        void 0 !== e.color)
            d.a.isArrayNumber(e.color, 3, 0, 1) || n.push(t + " color must be a vec3 with values in range [ 0.0, 1.0 ]");
        else {
            void 0 === e.texture.internalFormat || d.a.isEnumString(e.texture.internalFormat, ["RGB", "RGBA", "LUMINANCE", "ALPHA"]) || n.push(t + " internalFormat must be an enum string in values [ RGB, RGBA, LUMINANCE, ALPHA ]"),
            void 0 === e.texture.magFilter || d.a.isEnumString(e.texture.magFilter, ["LINEAR", "NEAREST"]) || n.push(t + " magFilter must be a enum string in values [LINEAR, NEAREST ]"),
            void 0 === e.texture.minFilter || d.a.isEnumString(e.texture.minFilter, ["LINEAR_MIPMAP_LINEAR", "NEAREST_MIPMAP_NEAREST", "LINEAR", "NEAREST"]) || n.push(t + " minFilter must be a enum string in values [LINEAR_MIPMAP_LINEAR, NEAREST_MIPMAP_NEAREST, LINEAR, NEAREST]"),
            void 0 === e.texture.wrapS || d.a.isEnumString(e.texture.wrapS, ["CLAMP_TO_EDGE", "REPEAT"]) || n.push(t + " wrapS must be an enum string in values [CLAMP_TO_EDGE, REPEAT] "),
            void 0 === e.texture.wrapT || d.a.isEnumString(e.texture.wrapT, ["CLAMP_TO_EDGE", "REPEAT"]) || n.push(t + " wrapT must be an enum string in values [CLAMP_TO_EDGE, REPEAT] "),
            void 0 === e.texture.uid && n.push(t + " texture must contain an uid"),
            d.a.isString(e.texture.uid) || n.push(t + " uid must be a string");
            i.get(e.texture.uid) || n.push(t + " texture uid does not exist")
        }
        return n.join("\n")
    }
    ;
    var y = x.prototype.addUniforms
      , S = x.prototype.cacheUniforms
      , w = {};
    w.view = b.extend({
        initialize: function() {
            b.prototype.initialize.apply(this, arguments),
            this.model.on("change:type", this.changeType, this),
            this.model.on("change:invert", this.updateChannel, this),
            this.model.on("change:vertexAlphaEnable", this.updateChannel, this),
            this._isMasking = "alphaMask" === this.model.getTransparency()
        },
        updateChannel: function() {
            var t = this.model.getTexture()
              , e = t ? t.getTextureProxy() : void 0;
            if (e) {
                var i = t.getImage()
                  , n = (t.getImage().getName() || e.getImage().getURL()).toLowerCase();
                (!1 === i.get("alpha") || -1 !== n.indexOf("jpg") || -1 !== n.indexOf("jpeg")) && (t.set("internalFormat", p.Texture.LUMINANCE),
                t.updateTextureProxy())
            }
            b.prototype.updateChannel.call(this)
        },
        changeType: function() {
            var t = "alphaMask" === this.model.getTransparency();
            if (t !== this._isMasking) {
                this._isMasking = t;
                var e = this.model.getTexture();
                if (e && e.get("magFilter") !== p.Texture.NEAREST) {
                    var i = e.get("minFilter")
                      , n = i;
                    t && i === p.Texture.LINEAR_MIPMAP_LINEAR ? n = p.Texture.LINEAR : t || i !== p.Texture.LINEAR || (n = this._blendFilter),
                    n && (e.set("minFilter", i),
                    e.set("magFilter", i === p.Texture.LINEAR_MIPMAP_LINEAR ? p.Texture.LINEAR : i),
                    e.updateTextureProxy())
                }
            }
            this.updateChannel()
        }
    });
    var C = {
        alphaMask: 1,
        alphaBlend: 1,
        additive: 1,
        dithering: 1
    };
    w.model = x.extend({
        defaults: function() {
            var t = x.prototype.defaults.apply(this, arguments);
            return t.type = "alphaBlend",
            t.invert = !1,
            t.vertexAlphaEnable = !1,
            t
        },
        getTransparency: function() {
            return this.get("type")
        },
        setTransparency: function(t) {
            if (!C[t])
                return void p.error("Invalid transparency type given : " + t);
            this.set("type", t)
        },
        setChannelJSON: function(t, e) {
            x.prototype.setChannelJSON.call(this, t, e),
            t.type && this.setTransparency(t.type),
            void 0 !== t.invert && this.set("invert", t.invert)
        },
        getJSON: function() {
            var t = x.prototype.getJSON.apply(this);
            return t.type = this.get("type"),
            t.invert = this.get("invert"),
            t
        },
        isEffective: function() {
            if (!this.isActivated() || !this.get("enable"))
                return !1;
            var t = this.get("type")
              , e = this.get("factor")
              , i = this.get("texture")
              , n = !i && !this.get("vertexAlphaEnable");
            return ("alphaMask" !== t || 0 !== e && !n) && ("alphaBlend" !== t && "dithering" !== t || 1 !== e || !n)
        },
        addUniforms: function(t, e) {
            y.call(this, t, e),
            t.uOpacityInvert = p.Uniform.createInt("uOpacityInvert"),
            t.uOpacityDithering = p.Uniform.createInt("uOpacityDithering"),
            t.uOpacityAdditive = p.Uniform.createInt("uOpacityAdditive")
        },
        cacheUniforms: function(t) {
            S.call(this, t),
            this._uniformInvert = t.uOpacityInvert.getInternalArray(),
            this._uniformDithering = t.uOpacityDithering.getInternalArray(),
            this._uniformAdditive = t.uOpacityAdditive.getInternalArray();
            var e = this.isEnableEffective();
            this._valueInvert = e && this.get("texture") && this.get("invert") ? 1 : 0,
            this._valueDithering = e && "dithering" === this.get("type") ? 1 : 0,
            this._valueAdditive = e && "additive" === this.get("type") ? 1 : 0
        },
        updateUniforms: function() {
            this._uniformFactor[0] = this._valueFactor,
            this._uniformInvert[0] = this._valueInvert,
            this._uniformDithering[0] = this._valueDithering,
            this._uniformAdditive[0] = this._valueAdditive
        },
        getSRGB: function() {
            var t = this.get("texture");
            if (t) {
                var e = t.getTextureProxy();
                if (e && e.getOriginalFormat && e.getOriginalFormat() === p.Texture.ALPHA)
                    return !1
            }
            return x.prototype.getSRGB.call(this)
        },
        getShaderHash: function() {
            var t = x.prototype.getShaderHash.call(this)
              , e = this.get("type")
              , i = this.get("texture")
              , n = this.isEnableEffective() && ("alphaBlend" === e || "additive" === e)
              , r = this.isEnableEffective() && i && i.get("internalFormat") === p.Texture.LUMINANCE;
            return t + (n ? "1" : "0") + (r ? "1" : "0")
        }
    }),
    w.model.validateJSON = function(t, e, i) {
        var n = []
          , r = x.validateJSON(t, e, i);
        return r && n.push(r),
        d.a.isEnumString(e.type, ["alphaBlend", "alphaMask", "additive", "dithering"]) || n.push(t + " type must be an enum string with values in [alphaBlend, alphaMask, additive, dithering]"),
        d.a.isBoolean(e.invert) || n.push(t + " invert must be a boolean"),
        n.join("\n")
    }
    ;
    var M = {};
    M.view = b.extend({
        initialize: function() {
            b.prototype.initialize.apply(this, arguments),
            this.model.on("change:occludeSpecular", this.updateChannel, this)
        }
    }),
    M.model = x.extend({
        defaults: function() {
            var t = x.prototype.defaults.call(this);
            return t.occludeSpecular = !1,
            t
        },
        setChannelJSON: function(t, e) {
            x.prototype.setChannelJSON.call(this, t, e),
            void 0 !== t.occludeSpecular && this.set("occludeSpecular", t.occludeSpecular)
        },
        getJSON: function() {
            var t = x.prototype.getJSON.apply(this);
            return t.occludeSpecular = this.get("occludeSpecular"),
            t
        },
        addUniforms: function(t, e) {
            y.call(this, t, e),
            t.uAOPBROccludeSpecular = p.Uniform.createInt("uAOPBROccludeSpecular")
        },
        cacheUniforms: function(t) {
            S.call(this, t),
            this._uniformOcclude = t.uAOPBROccludeSpecular.getInternalArray(),
            this._valueOcclude = this.isEnableEffective() && this.get("occludeSpecular") ? 1 : 0
        },
        updateUniforms: function() {
            this._uniformFactor[0] = this._valueFactor,
            this._uniformOcclude[0] = this._valueOcclude
        }
    }),
    M.model.validateJSON = function(t, e, i) {
        var n = []
          , r = x.validateJSON(t, e, i);
        return r ? n.push(r) : (d.a.isBoolean(e.occludeSpecular) || n.push(t + " occludeSpecular must be a boolean"),
        n.join("\n"))
    }
    ;
    var T = {};
    T.view = b.extend({}),
    T.model = x.extend({
        addUniforms: function(t, e) {
            y.call(this, t, e);
            var i = "u" + e + "Size";
            t[i] = p.Uniform.createFloat2(p.vec2.create(), i)
        },
        cacheUniforms: function(t) {
            S.call(this, t),
            this._uniformSize = t["u" + this.get("name") + "Size"].getInternalArray(),
            this._textureProxy = this.get("texture") && this.get("texture").getTextureProxy()
        },
        updateUniforms: function() {
            this._uniformFactor[0] = this._valueFactor,
            this._uniformSize[0] = this._textureProxy ? this._textureProxy.getWidth() : 0,
            this._uniformSize[1] = this._textureProxy ? this._textureProxy.getHeight() : 0
        }
    }),
    T.model.validateJSON = function(t, e, i) {
        return x.validateJSON(t, e, i)
    }
    ;
    var A = {};
    A.view = b.extend({
        updateChannel: function() {
            b.prototype.updateChannel.call(this),
            this.model.updateGeometryOffsets()
        }
    }),
    A.model = x.extend({
        defaults: function() {
            return x.prototype.defaults.apply(this, arguments)
        },
        updateGeometryOffsets: function() {
            var t = p.vec3.create();
            return function() {
                var e = this.isEffective() ? this.getFactor() : 0;
                if (c.a.updateMaxWorldDisplacement(e),
                0 !== e)
                    for (var i = this.get("material").get("geometryList"), n = 0, r = i.length; n < r; ++n) {
                        var a = i[n];
                        if (!a._maxScale) {
                            for (var s = a.getWorldMatrices(), o = 0, l = 0, u = s.length; l < u; ++l)
                                p.mat4.getScale(t, s[l]),
                                o = Math.max(o, t[0], t[1], t[2]);
                            a._maxScale = o
                        }
                        a._displacementFactor = Math.max(a._displacementFactor || 0, e / (a._maxScale || 1)),
                        a.dirtyBound()
                    }
            }
        }(),
        setTexture: function(t) {
            return t.get("minFilter") === p.Texture.LINEAR_MIPMAP_LINEAR && (t.set("minFilter", p.Texture.LINEAR),
            t.updateTextureProxy()),
            x.prototype.setTexture.call(this, t)
        },
        addUniforms: function(t, e) {
            T.model.prototype.addUniforms.call(this, t, e),
            t.uDisplacementNormal = p.Uniform.createFloat(1, "uDisplacementNormal")
        },
        cacheUniforms: function(t) {
            if (T.model.prototype.cacheUniforms.call(this, t),
            this._uniformNormal = t.uDisplacementNormal.getInternalArray(),
            this.isEnableEffective()) {
                var e = c.a.getModelBoxWithoutDisplacement();
                e ? this._valueNormal = 250 * this.get("factor") / e.radius() : c.a.getBoxReady().then(this.cacheUniforms.bind(this, t))
            } else
                this._valueNormal = 0
        },
        updateUniforms: function() {
            T.model.prototype.updateUniforms.call(this),
            this._uniformNormal[0] = this._valueNormal
        }
    }),
    A.model.validateJSON = function(t, e, i) {
        return x.validateJSON(t, e, i)
    }
    ;
    var E = {};
    E.view = b.extend({
        initialize: function() {
            b.prototype.initialize.apply(this, arguments),
            this.model.on("change:flipY", this.updateChannel, this)
        }
    }),
    E.model = x.extend({
        defaults: function() {
            var t = x.prototype.defaults.call(this);
            return t.flipY = !1,
            t
        },
        getJSON: function() {
            var t = x.prototype.getJSON.apply(this);
            return t.flipY = this.get("flipY"),
            t
        },
        setChannelJSON: function(t, e) {
            x.prototype.setChannelJSON.call(this, t, e),
            void 0 !== t.flipY && this.set("flipY", t.flipY)
        },
        addUniforms: function(t, e) {
            y.call(this, t, e),
            t.uNormalMapFlipY = p.Uniform.createInt("uNormalMapFlipY")
        },
        cacheUniforms: function(t) {
            S.call(this, t),
            this._uniformFlip = t.uNormalMapFlipY.getInternalArray(),
            this._valueFlip = this.isEnableEffective() && this.get("flipY") ? 1 : 0
        },
        updateUniforms: function() {
            this._uniformFactor[0] = this._valueFactor,
            this._uniformFlip[0] = this._valueFlip
        }
    }),
    E.model.validateJSON = function(t, e, i) {
        var n = []
          , r = x.validateJSON(t, e, i);
        return r && n.push(r),
        d.a.isBoolean(e.flipY) || n.push(t + " flipY must be a boolean"),
        n.join("\n")
    }
    ;
    var P = {};
    P.view = b.extend({
        initialize: function() {
            b.prototype.initialize.apply(this, arguments),
            this.model.on("change:type", this.updateChannel, this)
        }
    }),
    P.model = x.extend({
        defaults: function() {
            var t = x.prototype.defaults.apply(this, arguments);
            return t.type = "additive",
            t
        },
        getJSON: function() {
            var t = x.prototype.getJSON.apply(this);
            return t.type = this.get("type"),
            t
        },
        setChannelJSON: function(t, e) {
            x.prototype.setChannelJSON.call(this, t, e),
            void 0 !== t.type && this.set("type", t.type)
        },
        addUniforms: function(t, e) {
            y.call(this, t, e),
            t.uEmitMultiplicative = p.Uniform.createInt("uEmitMultiplicative")
        },
        cacheUniforms: function(t) {
            S.call(this, t),
            this._uniformMultiply = t.uEmitMultiplicative.getInternalArray(),
            this._valueMultiply = this.isEnableEffective() && "multiplicative" === this.get("type") ? 1 : 0
        },
        updateUniforms: function() {
            this._uniformFactor[0] = this._valueFactor,
            this._uniformMultiply[0] = this._valueMultiply
        },
        isEffective: function() {
            return !(!this.isActivated() || !this.get("enable")) && (0 !== this.get("factor") || "additive" !== this.get("type"))
        }
    }),
    P.model.validateJSON = function(t, e, i) {
        var n = []
          , r = x.validateJSON(t, e, i);
        return r && n.push(r),
        d.a.isEnumString(e.type, ["additive", "multiplicative"]) || n.push(t + " type must be an enum string with values in [additive, multiplicative]"),
        n.join("\n")
    }
    ;
    var N = {
        DiffusePBR: _,
        AlbedoPBR: _,
        SpecularPBR: _,
        GlossinessPBR: _,
        RoughnessPBR: _,
        MetalnessPBR: _,
        SpecularF0: _,
        CavityPBR: _,
        DiffuseColor: _,
        SpecularColor: _,
        DiffuseIntensity: _,
        SpecularHardness: _,
        Displacement: A,
        NormalMap: E,
        AOPBR: M,
        BumpMap: T,
        EmitColor: P,
        Opacity: w
    };
    e.default = N
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(29)
      , a = n.a.osg
      , s = ["magFilter", "minFilter", "wrapS", "wrapT", "textureWidth", "textureHeight", "textureTarget", "internalFormat"]
      , o = {
        getValidOptions: function() {
            return s
        },
        getOptions: function(t) {
            var e = {};
            return e.minFilter = t.getMinFilter(),
            e.magFilter = t.getMagFilter(),
            e.wrapT = t.getWrapT(),
            e.wrapS = t.getWrapS(),
            e.textureWidth = t.getWidth(),
            e.textureHeight = t.getHeight(),
            e.textureTarget = t.getTextureTarget(),
            e.internalFormat = t._internalFormat,
            e.imageFormat = t._imageFormat,
            e
        },
        setOptions: function(t, e) {
            e.setMinFilter(t.minFilter),
            e.setMagFilter(t.magFilter),
            e.setWrapT(t.wrapT),
            e.setWrapS(t.wrapS),
            t.minFilter === a.Texture.LINEAR_MIPMAP_LINEAR && i.i(r.a)().anisotropy && e.setMaxAnisotropy(16),
            e.setInternalFormat(t.internalFormat)
        },
        createValidOptionsForMaterial: function(t) {
            var e = o.createValidOptions(t);
            return e.minFilter === a.Texture.NEAREST_MIPMAP_LINEAR ? (e.magFilter = a.Texture.NEAREST,
            e) : e.minFilter === a.Texture.LINEAR_MIPMAP_LINEAR || e.minFilter === a.Texture.LINEAR ? (e.magFilter = a.Texture.LINEAR,
            e) : e.minFilter === a.Texture.NEAREST ? (e.magFilter = a.Texture.NEAREST,
            e) : e.magFilter === a.Texture.LINEAR ? (e.minFilter = a.Texture.LINEAR_MIPMAP_LINEAR,
            e) : (e.magFilter = a.Texture.NEAREST,
            e.minFilter = a.Texture.NEAREST,
            e)
        },
        createValidOptions: function(t) {
            t || (t = {});
            for (var e = s.length, i = 0; i < e; ++i) {
                var n = s[i];
                "string" == typeof t[n] && (t[n] = a.Texture[t[n]])
            }
            return t.magFilter || (t.magFilter = a.Texture.LINEAR),
            t.minFilter || (t.minFilter = a.Texture.LINEAR_MIPMAP_LINEAR),
            t.wrapS || (t.wrapS = a.Texture.REPEAT),
            t.wrapT || (t.wrapT = a.Texture.REPEAT),
            t.textureWidth || (t.textureWidth = 0),
            t.textureHeight || (t.textureHeight = 0),
            t.textureTarget || (t.textureTarget = a.Texture.TEXTURE_2D),
            t.internalFormat || (t.internalFormat = a.Texture.RGBA),
            t
        }
    };
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(440)
      , a = i(87)
      , s = i(547)
      , o = n.a.osg
      , l = s.a.vrConfig
      , u = !1
      , h = function(t, e) {
        return t._binNum - e._binNum
    }
      , c = function(t, e) {
        for (var i = e ? e._parent : void 0, n = 0; i; )
            i.stateset && n++,
            i = i.parent;
        return n > 1 && n--,
        t.getStateSetStackSize() - n
    }
      , d = {
        DEFAULT: 0,
        EARLYZ_OPAQUE: 1,
        EARLYZ_TRANSPARENT: 2,
        OPAQUE: 3,
        TRANSPARENT: 4,
        EXTRA: 5,
        SHADOWMAP: 6
    }
      , p = {
        currentPass: d.DEFAULT,
        depth: void 0,
        blend: void 0,
        colorMask: void 0,
        uDrawOpaque: o.Uniform.createInt(-1, "uDrawOpaque")
    }
      , f = new o.Depth(o.Depth.LESS,0,1,!0)
      , g = new o.Depth(o.Depth.LESS,0,1,!1)
      , m = new o.ColorMask(!1,!1,!1,!1)
      , v = new o.ColorMask(!1,!1,!1,!0)
      , _ = new o.ColorMask(!0,!0,!0,!0)
      , b = new o.Depth(o.Depth.EQUAL,0,1,!1)
      , x = new o.BlendFunc
      , y = new o.Depth(o.Depth.LEQUAL,0,1,!1)
      , S = new o.BlendFunc(o.BlendFunc.ONE,o.BlendFunc.ONE_MINUS_SRC_ALPHA)
      , w = new o.BlendFunc(o.BlendFunc.ONE,o.BlendFunc.ONE)
      , C = o.StateAttribute.OVERRIDE | o.StateAttribute.ON
      , M = function() {
        var t = new o.StateSet;
        t.setShaderGeneratorName("earlyZ", C);
        for (var e = i.i(r.a)(), n = 0; n < e; n++)
            t.setTextureAttributeAndModes(n, o.Texture.textureNull, C);
        return t
    }()
      , T = new o.CullFace(o.CullFace.BACK)
      , A = new o.CullFace(o.CullFace.FRONT)
      , E = new o.CullFace(o.CullFace.DISABLE)
      , P = o.RenderLeaf.prototype.drawGeometry
      , N = function(t, e, i) {
        if (!i)
            return e.applyAttribute(E),
            void P.call(t, e);
        var n = e.attributeMap.SketchfabMaterial
          , r = n ? n.lastApplied : void 0
          , a = p.currentPass
          , s = a === d.TRANSPARENT
          , l = s && r && !r.getAdditive() && r.getCullFace() === o.CullFace.DISABLE;
        l && e.applyAttribute(A),
        P.call(t, e),
        l && (e.applyAttribute(T),
        t._geometry.drawImplementation(e))
    };
    o.RenderLeaf.prototype.drawGeometry = function(t) {
        var e = t.attributeMap.SketchfabMaterial
          , i = e ? e.lastApplied : void 0
          , n = p.currentPass;
        if (i) {
            if (!i.getOpaqueEarlyZ() && (n === d.EARLYZ_OPAQUE || n === d.OPAQUE || n === d.SHADOWMAP))
                return;
            n === d.EARLYZ_TRANSPARENT && t.applyAttribute(i.getAdditive() ? w : S)
        }
        p.depth && t.applyAttribute(p.depth),
        p.blend && t.applyAttribute(p.blend),
        p.colorMask && t.applyAttribute(p.colorMask);
        var r = t.getLastProgramApplied().getUniformsCache().uDrawOpaque;
        if (void 0 !== r) {
            p.uDrawOpaque.getInternalArray()[0] = n !== d.TRANSPARENT && n !== d.EARLYZ_TRANSPARENT ? 1 : 0,
            p.uDrawOpaque.apply(t.getGraphicContext(), r)
        }
        for (var a = this._geometry.getPrimitiveSetList(), s = !1, h = 0, c = a.length; h < c; ++h)
            if (a[h].getMode() >= o.PrimitiveSet.TRIANGLES) {
                s = !0;
                break
            }
        if (u.isVR) {
            var f = t.getGraphicContext();
            f.viewport(0, 0, l.leftRenderWidth, l.leftRenderHeight),
            this._projection = u.leftProjection,
            this._modelView = u.leftModelView,
            this._view = u.leftView,
            N(this, t, s),
            f.viewport(l.leftRenderWidth, 0, l.rightRenderWidth, l.rightRenderHeight),
            this._projection = u.rightProjection,
            this._modelView = u.rightModelView,
            this._view = u.rightView,
            N(this, t, s)
        } else
            N(this, t, s)
    }
    ;
    var k = function() {
        o.RenderStage.apply(this, arguments),
        this._binArraySorted = [],
        k.prototype.init.call(this)
    }
      , F = !0;
    k.setHasTriangles = function(t) {
        F = t
    }
    ;
    var D;
    k.setTimerGPU = function(t) {
        D = t
    }
    ,
    k.getTimerGPU = function() {
        return D
    }
    ;
    var R = o.vec4.create();
    k.getClearColor = function() {
        return R
    }
    ,
    k.getDrawOpaqueUniform = function() {
        return p.uDrawOpaque
    }
    ,
    k.prototype = o.objectLibraryClass(o.objectInherit(o.RenderStage.prototype, {
        constructor: k,
        init: function() {
            return o.RenderStage.prototype.init.call(this),
            this._binArraySorted.length = 0,
            this._renderBufferDepth = void 0,
            this
        },
        isMainCamera: function() {
            var t = this.getCamera();
            return !(!t || "PostProcess - MainCamera" !== t.getName())
        },
        isShadowCasterCamera: function() {
            var t = this.getCamera();
            return !!(t && t.getName() && t.getName().startsWith("light_shadow_camera"))
        },
        sortBinArray: function() {
            var t = this._binArraySorted;
            t.length = 0;
            for (var e in this._bins)
                t.push(this._bins[e]);
            t.sort(h)
        },
        drawTransparentBin: function(t, e) {
            for (var i, n = e, r = this._binArraySorted, s = 0, o = r.length; s < o; s++) {
                i = r[s];
                var l = i.getBinNumber();
                if (l === a.a.TRANSPARENT_BIN)
                    n = i.draw(t, n);
                else if (p.currentPass !== d.EARLYZ_TRANSPARENT && (l === a.a.TRANSPARENT_BIN_NO_EARLYZ_POST || l === a.a.TRANSPARENT_BIN_NO_EARLYZ_PRE)) {
                    var u = p.depth;
                    p.depth = void 0,
                    n = i.draw(t, n),
                    p.depth = u
                }
            }
            return n
        },
        drawOpaqueBin: function(t, e) {
            for (var i, n = this.getDoEarlyZ(), r = e, s = this._binArraySorted, o = 0, l = s.length; o < l && (i = s[o],
            !(i.getBinNumber() > 0)); o++)
                r = i.draw(t, r);
            for (r = this.drawLeafs(t, r); o < l; o++) {
                i = s[o];
                var u = i.getBinNumber();
                if (u === a.a.OPAQUE_BIN || u === a.a.TRANSPARENT_BIN && n)
                    r = i.draw(t, r);
                else if (p.currentPass === d.OPAQUE && u === a.a.BACKGROUND) {
                    var h = p.depth;
                    p.depth = void 0,
                    r = i.draw(t, r),
                    p.depth = h
                }
            }
            return r
        },
        drawExtraBin: function(t, e) {
            for (var i, n = e, r = this._binArraySorted, s = 0, o = r.length; s < o; s++) {
                i = r[s];
                i.getBinNumber() >= a.a.EXTRA && (n = i.draw(t, n))
            }
            return n
        },
        bindDepthRTT: function(t) {
            this.getCamera().frameBufferObjectDepth.apply(t)
        },
        bindTransparencyRTT: function(t) {
            this.getCamera().frameBufferObjectTransparent.apply(t)
        },
        bindOpaqueRTT: function(t) {
            this.getCamera().frameBufferObjectOpaque.apply(t)
        },
        bindExtraRTT: function(t) {
            this.getCamera().frameBufferObjectExtra.apply(t)
        },
        createFBO: function(t, e) {
            if (e) {
                var i = this.getViewport()
                  , n = new o.FrameBufferObject;
                n.createFrameBufferObject(t),
                n.bindFrameBufferObject();
                var r = this._renderBufferDepth;
                return r || (r = n.createRenderBuffer(o.FrameBufferObject.DEPTH_COMPONENT16, i.width(), i.height()),
                this._renderBufferDepth = r),
                n.framebufferRenderBuffer(o.FrameBufferObject.DEPTH_ATTACHMENT, r),
                n.framebufferTexture2D(t, o.FrameBufferObject.COLOR_ATTACHMENT0, o.Texture.TEXTURE_2D, e),
                n.checkStatus(),
                n
            }
        },
        drawOpaqueShading: function(t, e) {
            p.currentPass = d.OPAQUE,
            p.depth = this.getDoEarlyZ() ? b : f,
            p.blend = x;
            var i = this.drawOpaqueBin(t, e);
            return p.blend = void 0,
            p.depth = void 0,
            p.currentPass = d.DEFAULT,
            i
        },
        drawEarlyOpaque: function(t, e) {
            p.currentPass = d.EARLYZ_OPAQUE,
            p.depth = f,
            p.blend = x,
            p.colorMask = this.isWritingDepth() ? _ : m;
            var i = this.drawOpaqueBin(t, e);
            return p.colorMask = void 0,
            p.blend = void 0,
            p.depth = void 0,
            p.currentPass = d.DEFAULT,
            i
        },
        drawEarlyAlpha: function(t, e) {
            p.currentPass = d.EARLYZ_TRANSPARENT,
            p.depth = g,
            p.colorMask = v;
            var i = this.drawTransparentBin(t, e);
            return p.colorMask = void 0,
            p.depth = void 0,
            p.currentPass = d.DEFAULT,
            i
        },
        drawTransparentShading: function(t, e) {
            p.currentPass = d.TRANSPARENT,
            p.depth = y,
            p.blend = S;
            var i = this.drawTransparentBin(t, e);
            return p.blend = void 0,
            p.depth = void 0,
            p.currentPass = d.DEFAULT,
            i
        },
        drawExtra: function(t, e) {
            p.currentPass = d.EXTRA;
            var i = this.drawExtraBin(t, e);
            return p.currentPass = d.DEFAULT,
            i
        },
        isWritingDepth: function() {
            return !!this.getCamera()._textureDepth
        },
        getDoEarlyZ: function() {
            return F || this.isWritingDepth()
        },
        drawImplementationSketchfab: function(t, e) {
            var i = t.getGraphicContext()
              , n = e
              , r = this.getCamera()
              , a = !!r._textureDepth;
            if (a ? (this.bindDepthRTT(t),
            i.clearColor(1, 1, 1, 0)) : (this.bindOpaqueRTT(t),
            i.clearColor(R[0], R[1], R[2], R[3])),
            i.depthMask(!0),
            i.clearDepth(this.clearDepth),
            i.clear(i.COLOR_BUFFER_BIT | i.DEPTH_BUFFER_BIT),
            this.getDoEarlyZ()) {
                var s = c(t, n);
                t.insertStateSet(s, M),
                D.start("EarlyOpaque"),
                n = this.drawEarlyOpaque(t, n),
                D.end("EarlyOpaque"),
                a && r._textureTransparent && (D.start("EarlyTransparency"),
                n = this.drawEarlyAlpha(t, n),
                D.end("EarlyTransparency")),
                t.removeStateSet(s),
                t.applyAttribute(_)
            }
            return a && (this.bindOpaqueRTT(t),
            i.clearColor(R[0], R[1], R[2], R[3]),
            i.clear(i.COLOR_BUFFER_BIT)),
            D.start("ShadingOpaque"),
            n = this.drawOpaqueShading(t, n),
            D.end("ShadingOpaque"),
            i.clearColor(0, 0, 0, 0),
            r._textureTransparent && (this.bindTransparencyRTT(t),
            i.clear(i.COLOR_BUFFER_BIT),
            D.start("ShadingTransparency"),
            n = this.drawTransparentShading(t, n),
            D.end("ShadingTransparency")),
            r._textureExtra && (this.bindExtraRTT(t),
            i.clear(i.COLOR_BUFFER_BIT),
            D.start("Extra"),
            n = this.drawExtra(t, n),
            D.end("Extra")),
            n
        },
        drawImplementation: function(t, e) {
            if (!this.isMainCamera()) {
                this.isShadowCasterCamera() && (p.currentPass = d.SHADOWMAP);
                var i = o.RenderStage.prototype.drawImplementation.call(this, t, e);
                return p.currentPass = d.DEFAULT,
                i
            }
            var n = this.getCamera();
            if (!n._textureOpaque)
                return e;
            n.frameBufferObjectOpaque || (n.frameBufferObjectOpaque = this.createFBO(t, n._textureOpaque)),
            n.frameBufferObjectTransparent || (n.frameBufferObjectTransparent = this.createFBO(t, n._textureTransparent)),
            n.frameBufferObjectDepth || (n.frameBufferObjectDepth = this.createFBO(t, n._textureDepth)),
            n.frameBufferObjectExtra || (n.frameBufferObjectExtra = this.createFBO(t, n._textureExtra)),
            void 0 === this.viewport && o.log("RenderStage does not have a valid viewport"),
            t.applyAttribute(this.viewport),
            0 !== this.positionedAttribute.length && this.applyPositionedAttribute(t, this.positionedAttribute),
            this.sortBinArray();
            var r = e;
            return D.start("Shading"),
            r = this.drawImplementationSketchfab(t, r),
            D.end("Shading"),
            r
        }
    }), "sketchfab", "RenderStageSketchfab"),
    o.RenderBin.prototype.drawLeafs = function(t, e) {
        for (var i, n = this.stateGraphList, r = this._leafs, a = e, s = this.getStage().viewport, o = t.getGraphicContext(), l = 0, h = r.length; l < h; l++)
            i = u = r[l],
            !i.isVR && a && a.isVR && o.viewport(s._x, s._y, s._width, s._height),
            i.render(t, a),
            a = i;
        for (var c = 0, d = n.length; c < d; c++)
            for (var p = n[c], f = 0, g = p.leafs.length; f < g; f++)
                i = u = p.leafs[f],
                !i.isVR && a && a.isVR && o.viewport(s._x, s._y, s._width, s._height),
                i.render(t, a),
                a = i;
        return a
    }
    ,
    e.a = k
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(29)
      , a = n.a.osg
      , s = function(t) {
        var e = a.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_SIZE")
          , n = i.i(r.a)().maxTextureSize
          , s = void 0 === t ? 1 / 0 : t;
        return Math.min(e, n, s)
    };
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = !1
      , s = r.Timer.prototype.tick
      , o = function() {
        this.children = [],
        this.timerMessage = "",
        this.message = "",
        this.start = s(),
        this.parent = this
    }
      , l = {}
      , u = {}
      , h = new o
      , c = h;
    r.time = function(t) {
        var e = l[t] = new o;
        c.children.push(e),
        e.parent = c,
        c = e,
        e.timerMessage = t
    }
    ,
    r.timeEnd = function(t) {
        var e = l[t];
        c = e.parent || h,
        e.message = t + " : " + (s() - e.start).toFixed(2) + "ms",
        a && u.showMessage()
    }
    ;
    var d = function(t, e) {
        var i = t.children
          , n = "";
        t !== h && i.length > 0 && (n = e + t.timerMessage + "\n");
        for (var r = t === h ? "" : "  |  ", a = 0; a < i.length; ++a)
            n += d(i[a], e + r) + "\n";
        var s = t.parent === h && t.timerMessage ? "\n" : "";
        return n + (e + t.message) + s
    };
    u.showMessage = function() {
        console.log("%c" + d(h, ""), "color:purple"),
        a = !0,
        h.children.length = 0
    }
    ,
    u.logBound = function(t) {
        var e = t.center(r.vec3.create())
          , i = "Bound center : [ " + e[0] + ", " + e[1] + ", " + e[2] + " ]\n";
        i += "Bound radius : " + t.radius() + "\n";
        var n = t.getMin()
          , a = t.getMax();
        i += "Bbox min : [ " + n[0] + ", " + n[1] + ", " + n[2] + " ]\n",
        i += "Bbox max : [ " + a[0] + ", " + a[1] + ", " + a[2] + " ]\n",
        u.logMessage(i)
    }
    ,
    u.logMessage = function(t) {
        var e = new o(!0);
        e.message = t,
        c.children.push(e),
        e.parent = c
    }
    ,
    e.a = u
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = {};
    a.base64 = function(t, e) {
        return "data:" + t + ";base64," + e
    }
    ,
    a.isMobile = function() {
        var t = !1;
        return function(e) {
            (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0, 4))) && (t = !0)
        }(navigator.userAgent || navigator.vendor || window.opera),
        t
    }
    ,
    a.isFirefox = function() {
        return /firefox/i.test(navigator.userAgent)
    }
    ,
    a.isIOS = function() {
        return /(iPad|iPhone|iPod)/g.test(navigator.userAgent)
    }
    ,
    a.isIFrame = function() {
        try {
            return window.self !== window.top
        } catch (t) {
            return !0
        }
    }
    ,
    a.appendQueryParameter = function(t, e, i) {
        return t += (t.indexOf("?") < 0 ? "?" : "&") + e + "=" + i
    }
    ,
    a.getQueryParameter = function(t) {
        t = t.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var e = new RegExp("[\\?&]" + t + "=([^&#]*)")
          , i = e.exec(location.search);
        return null === i ? "" : decodeURIComponent(i[1].replace(/\+/g, " "))
    }
    ,
    a.isLandscapeMode = function() {
        return 90 === window.orientation || -90 === window.orientation
    }
    ,
    a.getScreenWidth = function() {
        return Math.max(window.screen.width, window.screen.height) * window.devicePixelRatio
    }
    ,
    a.getScreenHeight = function() {
        return Math.min(window.screen.width, window.screen.height) * window.devicePixelRatio
    }
    ,
    a.projectionMatrixToVector_ = function(t, e) {
        var i = e || {}
          , n = i.xScale || 1
          , a = i.yScale || 1
          , s = i.xTrans || 0
          , o = i.yTrans || 0
          , l = r.vec4.create();
        return l[0] = t[0] * n * .5,
        l[1] = t[5] * a * .5,
        l[2] = .5 * (t[8] - 1 - s),
        l[3] = .5 * (t[9] - 1 - o),
        l
    }
    ,
    a.leftProjectionVectorToRight_ = function(t) {
        return r.vec4.fromValues(t[0], t[1], -t[2] - 1, t[3])
    }
    ,
    e.a = a
}
, , , , , , , , , function(t, e, i) {
    t.exports = i.p + "sketchfab-logo-8bc6696c7ed7369e1acaee4ec5168169.png"
}
, function(t, e, i) {
    t.exports = i.p + "sketchfab-logo-white-23404398f711fe3ef715025c76e98bd2.svg"
}
, function(t, e, i) {
    "use strict";
    Object.defineProperty(e, "__esModule", {
        value: !0
    });
    var n = i(714)
      , r = i(42)
      , a = i(21);
    e.default = r.a.extend({
        model: n.a,
        url: function() {
            return (this.options.filters.get("userUID") ? "/i/users/" + this.options.filters.get("userUID") + "/backgrounds" : "/i/backgrounds") + a.a.craft("?", {
                offset: this.options.offset
            })
        }
    })
}
, function(t, e, i) {
    "use strict";
    Object.defineProperty(e, "__esModule", {
        value: !0
    });
    var n = i(715)
      , r = i(42);
    e.default = r.a.extend({
        model: n.a,
        url: function() {
            return void 0 === this.options.filters ? "/i/environments" : "/i/users/" + this.options.filters.get("userUID") + "/environments"
        }
    })
}
, function(t, e, i) {
    "use strict";
    Object.defineProperty(e, "__esModule", {
        value: !0
    });
    var n = i(1)
      , r = (i.n(n),
    i(495))
      , a = i(42)
      , s = i(21)
      , o = i(279);
    e.default = a.a.extend({
        model: r.a,
        url: function() {
            return (this.options.filters.get("modelUID") ? "/i/models/" + this.options.filters.get("modelUID") + "/textures" : "/i/textures") + s.a.craft("?", {
                offset: this.options.offset
            })
        },
        comparator: function(t, e) {
            return t.get("value") ? i.i(o.a)(t.get("name"), e.get("name")) : -1
        },
        isValid: function() {
            this.each(function(t) {
                t.isValid()
            })
        },
        addNewImage: function(t) {
            var e = t.id || i.i(n.uniqueId)()
              , a = new r.a({
                images: [{
                    uid: e,
                    url: t.url,
                    width: t.width,
                    height: t.height
                }],
                uid: "tmp_" + e,
                id: e,
                name: t.name || "newImage"
            });
            return this.add(a),
            a
        },
        getImageFromURL: function(t) {
            var e = t.split("/").pop();
            return this.find(function(t) {
                var i = !1;
                return t.get("images").forEach(function(t) {
                    i || -1 !== t.url.indexOf(e) && (i = !0)
                }),
                i
            })
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(925)
      , r = i(967)
      , a = i(971)
      , s = i(1027)
      , o = i(952)
      , l = i(1017)
      , u = i(929)
      , h = i(991)
      , c = i(938)
      , d = i(944)
      , p = i(996)
      , f = i(933)
      , g = i(956)
      , m = i(961)
      , v = i(1011)
      , _ = i(1069)
      , b = i(1048);
    e.a = [n.a, r.a, a.a, s.a, o.a, l.a, u.a, h.a, c.a, d.a, p.a, f.a, g.a, m.a, v.a, _.a, b.a]
}
, , function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(2))
      , a = i.n(r)
      , s = i(68)
      , o = i.n(s)
      , l = i(312)
      , u = (i.n(l),
    i(405))
      , h = i.n(u)
      , c = i(6)
      , d = i(16)
      , p = i(139)
      , f = i(90)
      , g = i(38)
      , m = i(83)
      , v = i(9)
      , _ = i(452)
      , b = i(63)
      , x = i(1080)
      , y = i(1086)
      , S = i(1084)
      , w = i(1081)
      , C = i(1082)
      , M = i(1089)
      , T = i(1083)
      , A = i(1085)
      , E = i(454)
      , P = i(1087)
      , N = i(1092)
      , k = i(1090)
      , F = i(1091)
      , D = i(43)
      , R = i(1023)
      , I = i(677)
      , O = i(29)
      , L = i(473)
      , B = i(446)
      , V = i(37)
      , U = i(424)
      , G = (i.n(U),
    V.a.shortcuts)
      , z = new h.a({
        device: "WEB",
        listen: !0
    });
    e.a = c.a.extend({
        subviews: {},
        events: {
            'click [data-action="start"]': "onStart",
            'click [data-action="stop"]': "onStop",
            click: "globalCloseEvent",
            touchend: "globalCloseEvent"
        },
        templates: {
            viewerMode: v.default.getFromMacro("skfb_front/macros/viewer", "help_viewer_mode"),
            viewerVr: v.default.getFromMacro("skfb_front/macros/viewer", "help_vr_mode")
        },
        initialize: function() {
            c.a.prototype.initialize.apply(this, arguments),
            this.proxySettings = new b.a({
                shadingStyle: null,
                viewerMode: null,
                wireframeColor: null,
                wireframeEnable: null,
                hasWireframe: null,
                annotationsVisible: null,
                textureQuality: null,
                speed: null,
                cycleMode: null,
                fps: null
            }),
            this.initializeMandatorySubviews(),
            this.initializeHashMessages(),
            this.initializeSoundManager(),
            this.delegateGlobalMoveEvent(),
            this.delegateSubviews(),
            this.isVR() && o.a.apple.device && this.hackIosCanvasRender()
        },
        _createSubview: function(t, e, r) {
            return this.subviews[t] = new e(i.i(n.extend)({}, {
                viewer: this,
                widgets: this.subviews
            }, r)),
            this.subviews[t]
        },
        globalCloseEvent: function(t) {
            a()(t.target).hasClass("has-menu") || a()(t.target).parents(".has-menu").length || (this.subviews.hotspots && this.subviews.hotspots.toggleAnnotationList(null, !1),
            this.subviews.gui.closeMenus())
        },
        delegateGlobalMoveEvent: function() {
            var t = function(t) {
                "canvas" === t.target.tagName.toLowerCase() && (clearTimeout(this._showGuiTimeout),
                clearTimeout(this._hideGuiTimeout),
                this._hideGuiTimeout = setTimeout(function() {
                    this.$el.addClass("moving")
                }
                .bind(this), 150))
            }
              , e = function(t) {
                "canvas" === t.target.tagName.toLowerCase() && (clearTimeout(this._hideGuiTimeout),
                clearTimeout(this._showGuiTimeout),
                t.preventDefault(),
                this._showGuiTimeout = setTimeout(function() {
                    this.$el.hasClass("moving") && this.$el.removeClass("moving")
                }
                .bind(this), 500))
            }
              , r = function(t) {
                var e = t.relatedTarget || t.toElement;
                o.a.any || (clearTimeout(this.globalIdleTimeout),
                this.$el.find(e).length || (this.globalIdleTimeout = setTimeout(this.onGlobalIdleTimeout.bind(this), 3500)))
            }
              , s = function() {
                clearTimeout(this.globalIdleTimeout),
                (this.$el.hasClass("idle") || this.$el.hasClass("moving")) && (this.$el.removeClass("idle moving"),
                i.i(n.each)(this.subviews, function(t) {
                    t.trigger("idle", !1)
                }))
            };
            if (!i.i(f.a)()) {
                var l;
                this.$el.on("touchmove", this.preventScroll.bind(this)),
                this.$el.on("mousedown touchstart", t.bind(this)),
                this.$el.on("mouseup touchend", e.bind(this)),
                this.$el.on("mousewheel", function(t) {
                    "canvas" === t.target.tagName.toLowerCase() && (this.$el.addClass("moving"),
                    clearTimeout(l),
                    l = setTimeout(function() {
                        this.$el.removeClass("moving")
                    }
                    .bind(this), 300))
                }
                .bind(this)),
                a()(this.el).on("mouseout", r.bind(this)),
                a()(this.el).on("mouseenter mousein", s.bind(this))
            }
        },
        preventScroll: function(t) {
            this.subviews && this.subviews.helpOverlay && !this.subviews.helpOverlay.isVisible() && t.preventDefault()
        },
        onGlobalIdleTimeout: function() {
            i.i(f.a)() || (this.$el.addClass("idle"),
            i.i(n.each)(this.subviews, function(t) {
                t.trigger("idle", !0)
            }))
        },
        initializeMandatorySubviews: function() {
            this._createSubview("gui", x.a, {
                el: this.$el
            }),
            this._createSubview("loading", y.a, {
                el: this.$(".loading-container")
            }),
            this._createSubview("hint", S.a, {
                el: this.$el,
                fallback: !i.i(p.a)()
            }),
            this._createSubview("generalControls", w.a, {
                el: i.i(p.a)() ? this.$(".general-controls") : this.$(".fallback .controls"),
                fallback: !i.i(p.a)()
            }),
            this._createSubview("header", C.a, {
                el: this.$(".titlebar")
            }),
            this._createSubview("snapshot", M.a, {
                el: this.$el
            }),
            this._createSubview("helpOverlay", T.a, {
                el: this.$(".help.overlay")
            }),
            this._createSubview("hotspotsOverlay", A.a, {
                el: this.$(".hotspots-overlay")
            }),
            this._createSubview("helperVrOverlay", E.a.extend({
                setUrl: function(t) {
                    this.$(".url").attr("href", t).text(t)
                }
            }), {
                el: this.$(".helper-vr-overlay")
            }),
            this._createSubview("osd", P.a, {
                el: this.$el
            }),
            this._createSubview("soundCreditsOverlay", F.a, {
                el: this.$(".sound-credits-overlay")
            })
        },
        initShortcuts: function() {
            this.viewerRenderingShortcuts = new _.a(G.viewerRendering),
            this.viewerRenderingShortcuts.on("toggleWireframe", function() {
                this.proxySettings.get("hasWireframe") && this.proxySettings.set("wireframeEnable", !this.proxySettings.get("wireframeEnable"))
            }
            .bind(this)),
            this.viewerRenderingShortcuts.listen([this.viewerRenderingShortcuts.getShortcut("toggleWireframe")]),
            this.viewerRenderingShortcuts.on("defaultRenderingMode", function() {
                this.proxySettings.set("shadingStyle", "lit")
            }
            .bind(this)),
            this.viewerRenderingShortcuts.on("shadelessRenderingMode", function() {
                this.proxySettings.set("shadingStyle", "shadeless")
            }
            .bind(this)),
            this.viewerRenderingShortcuts.on("matcapRenderingMode", function() {
                this.proxySettings.set("shadingStyle", "matcap")
            }
            .bind(this)),
            this.updateShorcuts()
        },
        updateShorcuts: function() {
            "lit" === this._currentModel.get("options").shading.type || i.i(f.a)() ? this.viewerRenderingShortcuts.listen([this.viewerRenderingShortcuts.getShortcut("defaultRenderingMode"), this.viewerRenderingShortcuts.getShortcut("shadelessRenderingMode"), this.viewerRenderingShortcuts.getShortcut("matcapRenderingMode")]) : this.viewerRenderingShortcuts.stopListening(["defaultRenderingMode", "shadelessRenderingMode", "matcapRenderingMode"])
        },
        initializeHashMessages: function() {
            i.i(O.a)().isApp && z.on("message:vrMode", function(t) {
                var e = parseInt(t.data.vrMode, 10);
                this.subviews.hotspots && (this.subviews.hotspots.hideTooltips(),
                this.subviews.hotspots.currentHotspot = -1,
                this.subviews.hotspots.renderControl()),
                this.scene.getFeatures().webVR.getModel().set("enable", !!e),
                t.removeFromHash()
            }
            .bind(this))
        },
        initializeHotspotsSubviews: function(t) {
            i.e(9).then(function() {
                var e = i(1451).default;
                this._createSubview("hotspots", e, {
                    el: this.$el,
                    container: this.$(".hotspots"),
                    fallback: !i.i(p.a)()
                }),
                "function" == typeof t && t()
            }
            .bind(this).bind(null, i)).catch(i.oe)
        },
        initializeAnimationSubviews: function(t) {
            i.e(10).then(function() {
                var e = i(1450).default
                  , n = this.scene.getFeatures().animation.getModel();
                this._createSubview("animationControls", e, {
                    el: this.$(".animation-controls"),
                    model: n,
                    currentModel: this._currentModel
                }),
                "function" == typeof t && t()
            }
            .bind(this).bind(null, i)).catch(i.oe)
        },
        delegateSubviews: function() {
            this.isCardboard() ? (this.subviews.gui.disable(),
            this.subviews.header.disable()) : (this.subviews.loading.on("loaded", setTimeout.bind(window, this.subviews.gui.enable.bind(this.subviews.gui), 500)),
            this.subviews.header.enable()),
            this.subviews.loading.on("loaded", function() {
                i.i(O.a)().transparent || this.$el.addClass("transparent-pattern")
            }
            .bind(this))
        },
        onStart: function() {
            this.start(),
            this._startTracked || (this._startTracked = !0)
        },
        start: function(t) {
            return this.$el.addClass("started"),
            !0 === t ? d.a.modelEmbedAutostart(this._currentUid) : d.a.modelEmbedPlayButtonClicked(this._currentUid),
            this.$el.hasClass("transparent") || this.$el.addClass("transparent-pattern"),
            this._options && this.load(),
            this.scene && this.scene.getViewerOSGJS && this.scene.getViewerOSGJS().done() && (this.scene.getViewerOSGJS().setDone(!1),
            this.scene.getViewerOSGJS().run()),
            B.a.enter(),
            this.trigger("started"),
            this
        },
        onStop: function() {
            this.stop()
        },
        stop: function() {
            var t = this._currentModel ? this._currentModel.get("uid") : this._currentUid;
            return d.a.modelEmbedStopButtonClicked(t),
            this.$el.removeClass("started"),
            this.scene.getViewerOSGJS && this.scene.getViewerOSGJS().setDone(!0),
            this.subviews.hotspots && this.subviews.hotspots.triggerHotspotCycle(!1),
            B.a.exit(),
            this.trigger("started"),
            this
        },
        load: function() {
            if (this._options) {
                var t = this._options;
                this._options = null,
                this.scene && (this.scene.drop(),
                this.scene = null),
                this.subviews.loading.reset(),
                this.$el.removeClass("model-loaded"),
                this.$el.addClass("model-loading"),
                b.a.get(t.uid).then(this.onModelLoad.bind(this, t))
            }
        },
        lookat: function(t, e, i) {
            void 0 === i && (i = 1);
            var n = this.scene.getFeatures()
              , r = n.cameraAnimation.getModel();
            r.set("duration", i),
            r.setTargetAndEye(e, t)
        },
        isVR: function() {
            return this.scene ? this.scene.getFeatures().webVR.getModel().get("enable") : i.i(O.a)().cardboard > 0
        },
        isCardboard: function() {
            return i.i(O.a)().cardboard > 0
        },
        onModelLoad: function(t, e) {
            this._currentModel = e,
            e.hit();
            var n = this.scene = this.createScene(e, t);
            if (this.subviews.loading.handleLoading({
                model: e,
                scene: n
            }),
            n.run(),
            !i.i(p.a)())
                return void this.$el.addClass("fallback-mode");
            this.initShortcuts(),
            this.initViewerFeatures();
            var r = this.scene.getFeatures();
            this._createSubview("unsupportedAnimation", N.a, {
                el: this.$(".animation-not-supported"),
                model: r.animation.getModel()
            }),
            this.subviews.hint.show(),
            this.trigger("model-loaded")
        },
        setScene: function(t) {
            if (this.scene)
                throw new Error("It is currently impossible to reset a scene");
            return this._options = t,
            this._currentUid = t.uid,
            this
        },
        createScene: function(t, e) {
            if (i.i(p.a)()) {
                var n = {};
                return n.el = this.$(".webgl"),
                n.features = e.features,
                n.widgetAPI = e.widgetAPI,
                n.model = t,
                n.viewerAPI = e.viewerAPI,
                D.a.getPolygon().then(function(t) {
                    d.a.modelViewerPolygonLoaded(t.time)
                }),
                D.a.getWireframe().then(function(t) {
                    d.a.modelViewerWireframeLoaded(t.time)
                }),
                D.a.getLowResLoaded().then(function(t) {
                    d.a.modelViewerLowResTexturesLoaded(t.time, t.count)
                }),
                D.a.getHighResLoaded().then(function(t) {
                    d.a.modelViewerHighResTexturesLoaded(t.time, t.count)
                }),
                D.a.getModelDisplayed().then(function(t) {
                    d.a.modelViewerModelDisplayed(t.time)
                }),
                new I.a(n)
            }
            return d.a.modelViewerFallbackDisplayed(t.get("uid")),
            new R.a({
                model: t,
                el: this.$(".fallback"),
                features: e.features
            })
        },
        initViewerFeatures: function() {
            this.initializeSound(),
            D.a.getModelDisplayed().then(function() {
                D.a.getHasAnimation().then(function(t) {
                    t && this.initializeAnimation()
                }
                .bind(this)),
                this.initializeHotspots(),
                this.initializeShadingStyle(),
                this.initializeViewerMode(),
                this.initializeTextureQuality(),
                this.initializeVr()
            }
            .bind(this))
        },
        getHotspotModel: function() {
            var t = this.scene.getFeatures().hotspot;
            return t && t.getModel()
        },
        initializeHotspots: function() {
            var t = this.getHotspotModel();
            t && this.initializeHotspotsSubviews(function() {
                var e = this.subviews.hotspots;
                t.setUpdateCallback(e.refreshHotspots.bind(e));
                var r = t.get("hotspots");
                r.on("add remove sort change:title change:description change:position", e.refreshHotspots, e),
                r.on("add remove sort change:name", e.updateHotspotsControls, e),
                r.on("add remove", i.i(n.debounce)(this.subviews.generalControls.renderSettings, 100), this.subviews.generalControls),
                r.on("select", e.onHotspotSelected, e),
                r.on("add", e.showAnnotations, e),
                r.on("remove", function() {
                    0 === r.length && e.hideAnnotations()
                }),
                this.proxySettings.on("change:annotationsVisible", function() {
                    r.length && this.proxySettings.get("annotationsVisible") ? e.showAnnotations() : e.hideAnnotations()
                }
                .bind(this)),
                this.proxySettings.set("annotationsVisible", t.get("visible")),
                e.updateHotspotsControls(),
                D.a.getFirstCameraAnimation().then(function() {
                    e.refreshHotspots(),
                    t.on("hotspot-error", this.subviews.osd.show.bind(this.subviews.osd)),
                    i.i(O.a)().annotation > 0 && r.trigger("select", r.at(i.i(O.a)().annotation - 1)),
                    !0 === i.i(O.a)().annotationCycleAutostart && (this.subviews.hotspots.trackHotspotCycle(!0),
                    this.subviews.hotspots.triggerHotspotCycle(!0))
                }
                .bind(this))
            }
            .bind(this))
        },
        initializeAnimation: function() {
            var t = this.scene.getFeatures().animation
              , e = t.getModel();
            this.initializeAnimationSubviews(function() {
                this.$el.addClass("has-animation"),
                this.subviews.generalControls.setHasAnimations(!0),
                this.proxySettings.set("speed", e.get("speed")),
                this.proxySettings.set("cycleMode", e.get("cycleMode")),
                this.proxySettings.set("fps", e.get("fps")),
                this.proxySettings.on("change:speed", function(t, i) {
                    e.set("speed", i)
                }),
                this.proxySettings.on("change:cycleMode", function(t, i) {
                    e.set("cycleMode", i)
                }),
                this.proxySettings.on("change:fps", function(t, i) {
                    e.set("fps", i)
                }),
                e.on("change:fps", function(t, e) {
                    this.proxySettings.set("fps", e)
                }
                .bind(this)),
                this.$(".osd").addClass("padded"),
                this.$(".timeline").removeClass("disabled")
            }
            .bind(this))
        },
        initializeTextureQuality: function() {
            var t = this
              , e = this.scene.getFeatures().quality;
            if (e) {
                var i = e.getModel();
                i.get("promiseReady").then(function(t) {
                    this.subviews.generalControls.generateTextureQualitySettings(t),
                    this.subviews.generalControls.settings.onTextureQualityReady.call(this.subviews.generalControls.settings, t)
                }
                .bind(this)),
                this.proxySettings.on("change:textureQuality", function() {
                    var e = parseInt(this.get("textureQuality"), 10);
                    window.requestAnimationFrame(function() {
                        i.set("level", e)
                    });
                    var n = t.subviews.generalControls.getSettingLabelForValue("textureQuality", e + "");
                    t.$(".control-badge").text(n).addClass("active")
                })
            }
        },
        initializeViewerMode: function() {
            var t = this.scene.getFeatures().manipulator;
            if (t) {
                var e = t.getModel()
                  , i = e.get("indexManipulator");
                this.proxySettings.set("viewerMode", i),
                this.subviews.gui.renderSetting("viewerMode", i),
                this.proxySettings.on("change:viewerMode", function() {
                    e.set("indexManipulator", parseInt(this.proxySettings.get("viewerMode"), 10)),
                    this.scene.getFeaturesManager().focusOnSavedCamera(1),
                    this.$("canvas").focus()
                }
                .bind(this))
            }
        },
        initializeShadingStyle: function() {
            var t = this.scene.getFeatures().shadingStyle;
            if (t) {
                var e = t.getModel()
                  , i = this
                  , n = function() {
                    i.proxySettings.set("shadingStyle", e.get("style")),
                    i.proxySettings.set("wireframeColor", e.get("wireframeColor")),
                    i.proxySettings.set("wireframeEnable", e.get("wireframeEnable")),
                    i.proxySettings.set("hasWireframe", e.get("hasWireframe")),
                    i.subviews.gui.renderSetting("wireframeColor", i.proxySettings.get("wireframeColor")),
                    i.subviews.gui.renderSetting("wireframeEnable", i.proxySettings.get("wireframeEnable") ? 1 : 0),
                    i.subviews.gui.renderSetting("shadingStyle", i.proxySettings.get("shadingStyle")),
                    i.subviews.gui.renderSetting("hasWireframe", i.proxySettings.get("hasWireframe") ? 1 : 0)
                };
                n(),
                this.proxySettings.listenTo(e, "change", n),
                this.proxySettings.on("change:shadingStyle", function() {
                    e.set("style", this.get("shadingStyle"))
                }),
                this.proxySettings.on("change:wireframeColor", function() {
                    this.get("wireframeEnable") ? e.setWireframeColorSmooth(this.get("wireframeColor")) : e.set("wireframeColor", this.get("wireframeColor"))
                }),
                this.proxySettings.on("change:wireframeEnable", function() {
                    e.set("wireframeEnable", !!this.get("wireframeEnable"))
                }),
                this.listenTo(e, "nextBlendingShader", function(t) {
                    var e = {};
                    e[L.a.MATCAP | L.a.WIREFRAME] = "Matcap + Wireframe",
                    e[L.a.MATCAP | L.a.GEOMETRY | L.a.WIREFRAME] = "Matcap + Normal + Wireframe",
                    e[L.a.DEFAULT & ~L.a.DIFFUSE] = "No diffuse",
                    e[L.a.DEFAULT] = "Default",
                    this.subviews.osd.show(e[t], {
                        duration: 5e3,
                        position: "top",
                        style: "compact"
                    })
                }
                .bind(this))
            }
        },
        initializeVr: function() {
            if (this.isVR()) {
                this.$el.addClass("vr-mode");
                if (1 === m.a.get("show_vr_hint", 1)) {
                    var t = this.templates.viewerVr([this.subviews.generalControls.hasFullscreen()]);
                    this.subviews.osd.show(t, {
                        duration: 8e3
                    })
                }
                m.a.set("show_vr_hint", 0, {
                    expires: 504e5,
                    path: "/"
                })
            }
        },
        initializeSoundManager: function() {
            this.proxySettings.on("sound-error", this.subviews.osd.show.bind(this.subviews.osd)),
            this.proxySettings.on("requestTapForSound", this.subviews.osd.show.bind(this.subviews.osd)),
            this.proxySettings.on("stopRequestTapForSound", this.subviews.osd.hide.bind(this.subviews.osd)),
            B.a.setModel(this.proxySettings)
        },
        initializeSound: function() {
            var t = this.scene.getFeatures().sound;
            if (t) {
                var e = t.getModel()
                  , n = e.get("soundtracks")
                  , r = this._createSubview("sound", k.a, {
                    el: this.$(".general-controls .volume"),
                    model: e
                });
                n.on("add", r.show, r),
                n.on("remove", function() {
                    0 === n.length && r.hide()
                }),
                n.length && e.get("visible") && r.show();
                var a = function() {
                    this.subviews.soundCreditsOverlay.render(n)
                }
                .bind(this);
                this.listenTo(n, "update", i.i(g.a)(a)),
                e.on("sound-error", this.subviews.osd.show.bind(this.subviews.osd))
            }
        },
        hackIosCanvasRender: function() {
            i.i(n.defer)(function() {
                a()("canvas")[0].style.width = a()("canvas")[0].clientWidth + 1 + "px",
                i.i(n.defer)(function() {
                    a()("canvas")[0].style.width = a()("canvas")[0].clientWidth - 1 + "px",
                    a()("canvas")[0].style.width = ""
                })
            })
        }
    })
}
, , , , , , , function(t, e) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/hotspot.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = null
                  , s = null;
                try {
                    var o = null
                      , l = n.makeMacro([], ["options"], function(r) {
                        var o = i;
                        i = new n.Frame,
                        r = r || {},
                        r.hasOwnProperty("caller") && i.set("caller", r.caller),
                        i.set("options", r.hasOwnProperty("options") ? r.options : {});
                        var l = "";
                        l += "\n";
                        var u;
                        u = 30,
                        i.set("width_before", u, !0),
                        i.topLevel && e.setVariable("width_before", u),
                        i.topLevel && e.addExport("width_before", u),
                        l += "\n";
                        var h;
                        h = 960,
                        i.set("width_next", h, !0),
                        i.topLevel && e.setVariable("width_next", h),
                        i.topLevel && e.addExport("width_next", h),
                        l += '\n        <div class="vr-hotspot-content" style="width:',
                        l += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "widthContent"), t.opts.autoescape),
                        l += 'px;" id="hotspot',
                        l += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "hotspotIndex"), t.opts.autoescape),
                        l += '">\n            <div class="cell" id="default" style="width:1024px;height:576px;position:absolute;top:0;left:0"></div>',
                        i = i.push();
                        var c = (a = 5,
                        s = 32,
                        n.callWrap(n.contextOrFrameLookup(e, i, "range"), "range", e, [0, n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "column")]));
                        if (c)
                            for (var d = c.length, p = 0; p < c.length; p++) {
                                var f = c[p];
                                i.set("column", f),
                                i.set("loop.index", p + 1),
                                i.set("loop.index0", p),
                                i.set("loop.revindex", d - p),
                                i.set("loop.revindex0", d - p - 1),
                                i.set("loop.first", 0 === p),
                                i.set("loop.last", p === d - 1),
                                i.set("loop.length", d),
                                l += '<div class="page" id="column',
                                l += n.suppressValue(f, t.opts.autoescape),
                                l += '" style="width:1024px;height:576px;position:absolute;top:0;left:',
                                l += n.suppressValue(1024 * f, t.opts.autoescape),
                                l += 'px; overflow: visible">',
                                f > 0 && (l += '<div style="width:40px;height:40px;position:absolute;top:250px;left:30px" class="vr-icon vr-icon-arrow-left-white"></div>\n                        <button id="prevPage" style="opacity:0; height: 100%; width:10%; top:0; position: absolute; left: 0;"></button>');
                                var g;
                                if (g = n.contextOrFrameLookup(e, i, "width_before") + 1024,
                                i.set("width_before", g, !0),
                                i.topLevel && e.setVariable("width_before", g),
                                i.topLevel && e.addExport("width_before", g),
                                l += '\n                    <div class="vr-hotspot-title">',
                                l += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "title"), t.opts.autoescape),
                                l += "</div>",
                                f < 1 && (l += '<div class="vr-hotspot-description" style="column-count:',
                                l += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "column"), t.opts.autoescape),
                                l += ";width:",
                                l += n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "widthContent"), t.opts.autoescape),
                                l += 'px">',
                                l += n.suppressValue(t.getFilter("safe").call(e, n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "description")), t.opts.autoescape),
                                l += "</div>"),
                                f + 1 < n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "column")) {
                                    l += '<button id="nextPage" style="opacity:0; height: 100%; width:10%; top:0; position: absolute; right: 0;"></button>\n                        <div style="width:40px;height:40px;position:absolute;top:250px;left:960px" class="vr-icon vr-icon-arrow-right-white"></div>\n                        ';
                                    var m;
                                    m = n.contextOrFrameLookup(e, i, "width_next") + 1024,
                                    i.set("width_next", m, !0),
                                    i.topLevel && e.setVariable("width_next", m),
                                    i.topLevel && e.addExport("width_next", m)
                                }
                                l += '<div class="vr-hotspot-footer">\n                        <div class="vr-hotspot-container-button" >',
                                n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "displayNavigation") ? l += '<button id="prevButton" class="vr-hotspot-button">Prev</button>\n                                <button id="closeButton" class="vr-hotspot-button">Close annotation</button>\n                                <button id="nextButton" class="vr-hotspot-button">Next</button>' : l += '<button id="closeButton" class="vr-hotspot-button">Close annotation</button>',
                                l += "</div>\n                    </div>\n                </div>"
                            }
                        return i = i.pop(),
                        l += "</div>\n",
                        i = o,
                        new n.SafeString(l)
                    });
                    e.addExport("panel"),
                    e.setVariable("panel", l),
                    o ? o.rootRenderFunc(t, e, i, n, r) : r(null, "")
                } catch (t) {
                    r(n.handleError(t, a, s))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, , function(t, e) {
    !function() {
        (window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["skfb_front/macros/vr/vr-menu.jinja"] = function() {
            function t(t, e, i, n, r) {
                var a = "";
                try {
                    var s = null
                      , o = n.makeMacro([], ["options"], function(t) {
                        var r = i;
                        i = new n.Frame,
                        t = t || {},
                        t.hasOwnProperty("caller") && i.set("caller", t.caller),
                        i.set("options", t.hasOwnProperty("options") ? t.options : {});
                        var a = "";
                        return a += '\n\n<div style="width:700px;">',
                        n.memberLookup(n.contextOrFrameLookup(e, i, "options"), "hasHotspotsNavigation") && (a += '<div class="vr-menu-row">\n            <button  id="vrPrevButton" class="vr-button vr-button-small">\n                <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-arrow-left-white"></div>                \n            </button>\n            <span class="vr-localize-icon">\n                <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-map-marker-white"></div>                                \n            </span>\n            <button id="vrNextButton" class="vr-button vr-button-small">\n                <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-arrow-right-white"></div>                                \n            </button>\n        </div>'),
                        a += '<button id="vrHomeButton" class="vr-button">Home</button>\n    <button id="vrHelpButton" class="vr-button">Help</button>\n    <button id="vrExitButton" class="vr-button vr-round-button">\n        <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-times-white"></div>            \n    </button>\n</div>\n',
                        i = r,
                        new n.SafeString(a)
                    });
                    e.addExport("panel"),
                    e.setVariable("panel", o),
                    a += "\n",
                    s ? s.rootRenderFunc(t, e, i, n, r) : r(null, a)
                } catch (t) {
                    r(n.handleError(t, null, null))
                }
            }
            return {
                root: t
            }
        }()
    }()
}
, , , , , , , , , , , function(t, e, i) {
    t.exports = i.p + "soundcloud-1fe89c501f0d9d67c2c6b15da3bdc234.png"
}
, function(t, e, i) {
    t.exports = i.p + "cardboard-instructions-3559e10f564c87ffc582505a3919b0ad.svg"
}
, function(t, e) {
    t.exports = "#ifdef HEMI\nuniform vec4 uGround;\nvarying vec3 vLocalVertex;\nuniform float uRadius;\n#endif\n\n#ifdef ICON\nuniform sampler2D uTextureIcon;\nvarying vec2 vTexCoord0;\nuniform int uEnable;\n#endif\n\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\n\nuniform vec4 uColor;\n\nvoid main(void) {\n  float fragDepth = clamp((-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x), 0.0, 1.0);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize).rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n  float alpha = fragDepth < depth ? 1.0 : 0.1;\n\n#ifdef HEMI\n  gl_FragColor = vec4(mix(uGround.rgb, uColor.rgb, vLocalVertex.z / uRadius), alpha);\n#endif\n\n#ifdef LINE\n  gl_FragColor = vec4(uColor.rgb, alpha);\n#endif\n\n#ifdef ICON\n  gl_FragColor = vec4(float(uEnable) * uColor.rgb, alpha) * texture2D(uTextureIcon, vTexCoord0);\n#endif\n\n  gl_FragColor.rgb *= gl_FragColor.a;\n}\n"
}
, function(t, e) {
    t.exports = "#ifdef ICON\nattribute vec2 TexCoord0;\nvarying vec2 vTexCoord0;\n#endif\n\n#ifdef HEMI\nvarying vec3 vLocalVertex;\n#endif\n\nattribute vec3 Vertex;\n\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n#ifdef ICON\n  vTexCoord0 = TexCoord0;\n#endif\n\n#ifdef HEMI\n  vLocalVertex = Vertex;\n#endif\n\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = uProjectionMatrix * vViewPos;\n}\n"
}
, function(t, e) {
    t.exports = 'uniform vec3 uColor;\nuniform float uAlpha;\nuniform int uOutputLinear;\n\nvarying float vHeight;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uColor, 1.0) * uAlpha * smoothstep(1.0, 0.0, pow(vHeight, 0.3));\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying float vHeight;\n\nvoid main(void) {\n  vHeight = Vertex.z;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"
}
, function(t, e, i) {
    var n = i(319)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(9);
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 1,
        t[5] = 0,
        t[6] = 0,
        t[7] = 0,
        t[8] = 1,
        t
    }
    ,
    r.fromMat4 = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[4],
        t[4] = e[5],
        t[5] = e[6],
        t[6] = e[8],
        t[7] = e[9],
        t[8] = e[10],
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(9);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        e[4] = t[4],
        e[5] = t[5],
        e[6] = t[6],
        e[7] = t[7],
        e[8] = t[8],
        e
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[4] = e[4],
        t[5] = e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[8] = e[8],
        t
    }
    ,
    r.fromValues = function(t, e, i, r, a, s, o, l, u) {
        var h = new n.ARRAY_TYPE(9);
        return h[0] = t,
        h[1] = e,
        h[2] = i,
        h[3] = r,
        h[4] = a,
        h[5] = s,
        h[6] = o,
        h[7] = l,
        h[8] = u,
        h
    }
    ,
    r.set = function(t, e, i, n, r, a, s, o, l, u) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t[3] = r,
        t[4] = a,
        t[5] = s,
        t[6] = o,
        t[7] = l,
        t[8] = u,
        t
    }
    ,
    r.identity = function(t) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 1,
        t[5] = 0,
        t[6] = 0,
        t[7] = 0,
        t[8] = 1,
        t
    }
    ,
    r.transpose = function(t, e) {
        if (t === e) {
            var i = e[1]
              , n = e[2]
              , r = e[5];
            t[1] = e[3],
            t[2] = e[6],
            t[3] = i,
            t[5] = e[7],
            t[6] = n,
            t[7] = r
        } else
            t[0] = e[0],
            t[1] = e[3],
            t[2] = e[6],
            t[3] = e[1],
            t[4] = e[4],
            t[5] = e[7],
            t[6] = e[2],
            t[7] = e[5],
            t[8] = e[8];
        return t
    }
    ,
    r.invert = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , l = e[6]
          , u = e[7]
          , h = e[8]
          , c = h * s - o * u
          , d = -h * a + o * l
          , p = u * a - s * l
          , f = i * c + n * d + r * p;
        return f ? (f = 1 / f,
        t[0] = c * f,
        t[1] = (-h * n + r * u) * f,
        t[2] = (o * n - r * s) * f,
        t[3] = d * f,
        t[4] = (h * i - r * l) * f,
        t[5] = (-o * i + r * a) * f,
        t[6] = p * f,
        t[7] = (-u * i + n * l) * f,
        t[8] = (s * i - n * a) * f,
        t) : null
    }
    ,
    r.adjoint = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , l = e[6]
          , u = e[7]
          , h = e[8];
        return t[0] = s * h - o * u,
        t[1] = r * u - n * h,
        t[2] = n * o - r * s,
        t[3] = o * l - a * h,
        t[4] = i * h - r * l,
        t[5] = r * a - i * o,
        t[6] = a * u - s * l,
        t[7] = n * l - i * u,
        t[8] = i * s - n * a,
        t
    }
    ,
    r.determinant = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2]
          , r = t[3]
          , a = t[4]
          , s = t[5]
          , o = t[6]
          , l = t[7]
          , u = t[8];
        return e * (u * a - s * l) + i * (-u * r + s * o) + n * (l * r - a * o)
    }
    ,
    r.multiply = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , l = e[5]
          , u = e[6]
          , h = e[7]
          , c = e[8]
          , d = i[0]
          , p = i[1]
          , f = i[2]
          , g = i[3]
          , m = i[4]
          , v = i[5]
          , _ = i[6]
          , b = i[7]
          , x = i[8];
        return t[0] = d * n + p * s + f * u,
        t[1] = d * r + p * o + f * h,
        t[2] = d * a + p * l + f * c,
        t[3] = g * n + m * s + v * u,
        t[4] = g * r + m * o + v * h,
        t[5] = g * a + m * l + v * c,
        t[6] = _ * n + b * s + x * u,
        t[7] = _ * r + b * o + x * h,
        t[8] = _ * a + b * l + x * c,
        t
    }
    ,
    r.mul = r.multiply,
    r.translate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , l = e[5]
          , u = e[6]
          , h = e[7]
          , c = e[8]
          , d = i[0]
          , p = i[1];
        return t[0] = n,
        t[1] = r,
        t[2] = a,
        t[3] = s,
        t[4] = o,
        t[5] = l,
        t[6] = d * n + p * s + u,
        t[7] = d * r + p * o + h,
        t[8] = d * a + p * l + c,
        t
    }
    ,
    r.rotate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , l = e[5]
          , u = e[6]
          , h = e[7]
          , c = e[8]
          , d = Math.sin(i)
          , p = Math.cos(i);
        return t[0] = p * n + d * s,
        t[1] = p * r + d * o,
        t[2] = p * a + d * l,
        t[3] = p * s - d * n,
        t[4] = p * o - d * r,
        t[5] = p * l - d * a,
        t[6] = u,
        t[7] = h,
        t[8] = c,
        t
    }
    ,
    r.scale = function(t, e, i) {
        var n = i[0]
          , r = i[1];
        return t[0] = n * e[0],
        t[1] = n * e[1],
        t[2] = n * e[2],
        t[3] = r * e[3],
        t[4] = r * e[4],
        t[5] = r * e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[8] = e[8],
        t
    }
    ,
    r.fromTranslation = function(t, e) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 1,
        t[5] = 0,
        t[6] = e[0],
        t[7] = e[1],
        t[8] = 1,
        t
    }
    ,
    r.fromRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = n,
        t[1] = i,
        t[2] = 0,
        t[3] = -i,
        t[4] = n,
        t[5] = 0,
        t[6] = 0,
        t[7] = 0,
        t[8] = 1,
        t
    }
    ,
    r.fromScaling = function(t, e) {
        return t[0] = e[0],
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = e[1],
        t[5] = 0,
        t[6] = 0,
        t[7] = 0,
        t[8] = 1,
        t
    }
    ,
    r.fromMat2d = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = 0,
        t[3] = e[2],
        t[4] = e[3],
        t[5] = 0,
        t[6] = e[4],
        t[7] = e[5],
        t[8] = 1,
        t
    }
    ,
    r.fromQuat = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = i + i
          , o = n + n
          , l = r + r
          , u = i * s
          , h = n * s
          , c = n * o
          , d = r * s
          , p = r * o
          , f = r * l
          , g = a * s
          , m = a * o
          , v = a * l;
        return t[0] = 1 - c - f,
        t[3] = h - v,
        t[6] = d + m,
        t[1] = h + v,
        t[4] = 1 - u - f,
        t[7] = p - g,
        t[2] = d - m,
        t[5] = p + g,
        t[8] = 1 - u - c,
        t
    }
    ,
    r.normalFromMat4 = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , l = e[6]
          , u = e[7]
          , h = e[8]
          , c = e[9]
          , d = e[10]
          , p = e[11]
          , f = e[12]
          , g = e[13]
          , m = e[14]
          , v = e[15]
          , _ = i * o - n * s
          , b = i * l - r * s
          , x = i * u - a * s
          , y = n * l - r * o
          , S = n * u - a * o
          , w = r * u - a * l
          , C = h * g - c * f
          , M = h * m - d * f
          , T = h * v - p * f
          , A = c * m - d * g
          , E = c * v - p * g
          , P = d * v - p * m
          , N = _ * P - b * E + x * A + y * T - S * M + w * C;
        return N ? (N = 1 / N,
        t[0] = (o * P - l * E + u * A) * N,
        t[1] = (l * T - s * P - u * M) * N,
        t[2] = (s * E - o * T + u * C) * N,
        t[3] = (r * E - n * P - a * A) * N,
        t[4] = (i * P - r * T + a * M) * N,
        t[5] = (n * T - i * E - a * C) * N,
        t[6] = (g * w - m * S + v * y) * N,
        t[7] = (m * x - f * w - v * b) * N,
        t[8] = (f * S - g * x + v * _) * N,
        t) : null
    }
    ,
    r.str = function(t) {
        return "mat3(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ", " + t[4] + ", " + t[5] + ", " + t[6] + ", " + t[7] + ", " + t[8] + ")"
    }
    ,
    r.frob = function(t) {
        return Math.sqrt(Math.pow(t[0], 2) + Math.pow(t[1], 2) + Math.pow(t[2], 2) + Math.pow(t[3], 2) + Math.pow(t[4], 2) + Math.pow(t[5], 2) + Math.pow(t[6], 2) + Math.pow(t[7], 2) + Math.pow(t[8], 2))
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t[3] = e[3] + i[3],
        t[4] = e[4] + i[4],
        t[5] = e[5] + i[5],
        t[6] = e[6] + i[6],
        t[7] = e[7] + i[7],
        t[8] = e[8] + i[8],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t[3] = e[3] - i[3],
        t[4] = e[4] - i[4],
        t[5] = e[5] - i[5],
        t[6] = e[6] - i[6],
        t[7] = e[7] - i[7],
        t[8] = e[8] - i[8],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiplyScalar = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t[3] = e[3] * i,
        t[4] = e[4] * i,
        t[5] = e[5] * i,
        t[6] = e[6] * i,
        t[7] = e[7] * i,
        t[8] = e[8] * i,
        t
    }
    ,
    r.multiplyScalarAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t[3] = e[3] + i[3] * n,
        t[4] = e[4] + i[4] * n,
        t[5] = e[5] + i[5] * n,
        t[6] = e[6] + i[6] * n,
        t[7] = e[7] + i[7] * n,
        t[8] = e[8] + i[8] * n,
        t
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3] && t[4] === e[4] && t[5] === e[5] && t[6] === e[6] && t[7] === e[7] && t[8] === e[8]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = t[3]
          , o = t[4]
          , l = t[5]
          , u = t[6]
          , h = t[7]
          , c = t[8]
          , d = e[0]
          , p = e[1]
          , f = e[2]
          , g = e[3]
          , m = e[4]
          , v = e[5]
          , _ = t[6]
          , b = e[7]
          , x = e[8];
        return Math.abs(i - d) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(d)) && Math.abs(r - p) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(p)) && Math.abs(a - f) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(f)) && Math.abs(s - g) <= n.EPSILON * Math.max(1, Math.abs(s), Math.abs(g)) && Math.abs(o - m) <= n.EPSILON * Math.max(1, Math.abs(o), Math.abs(m)) && Math.abs(l - v) <= n.EPSILON * Math.max(1, Math.abs(l), Math.abs(v)) && Math.abs(u - _) <= n.EPSILON * Math.max(1, Math.abs(u), Math.abs(_)) && Math.abs(h - b) <= n.EPSILON * Math.max(1, Math.abs(h), Math.abs(b)) && Math.abs(c - x) <= n.EPSILON * Math.max(1, Math.abs(c), Math.abs(x))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(319)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(3);
        return t[0] = 0,
        t[1] = 0,
        t[2] = 0,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(3);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e
    }
    ,
    r.fromValues = function(t, e, i) {
        var r = new n.ARRAY_TYPE(3);
        return r[0] = t,
        r[1] = e,
        r[2] = i,
        r
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t
    }
    ,
    r.set = function(t, e, i, n) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiply = function(t, e, i) {
        return t[0] = e[0] * i[0],
        t[1] = e[1] * i[1],
        t[2] = e[2] * i[2],
        t
    }
    ,
    r.mul = r.multiply,
    r.divide = function(t, e, i) {
        return t[0] = e[0] / i[0],
        t[1] = e[1] / i[1],
        t[2] = e[2] / i[2],
        t
    }
    ,
    r.div = r.divide,
    r.ceil = function(t, e) {
        return t[0] = Math.ceil(e[0]),
        t[1] = Math.ceil(e[1]),
        t[2] = Math.ceil(e[2]),
        t
    }
    ,
    r.floor = function(t, e) {
        return t[0] = Math.floor(e[0]),
        t[1] = Math.floor(e[1]),
        t[2] = Math.floor(e[2]),
        t
    }
    ,
    r.min = function(t, e, i) {
        return t[0] = Math.min(e[0], i[0]),
        t[1] = Math.min(e[1], i[1]),
        t[2] = Math.min(e[2], i[2]),
        t
    }
    ,
    r.max = function(t, e, i) {
        return t[0] = Math.max(e[0], i[0]),
        t[1] = Math.max(e[1], i[1]),
        t[2] = Math.max(e[2], i[2]),
        t
    }
    ,
    r.round = function(t, e) {
        return t[0] = Math.round(e[0]),
        t[1] = Math.round(e[1]),
        t[2] = Math.round(e[2]),
        t
    }
    ,
    r.scale = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t
    }
    ,
    r.scaleAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t
    }
    ,
    r.distance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1]
          , r = e[2] - t[2];
        return Math.sqrt(i * i + n * n + r * r)
    }
    ,
    r.dist = r.distance,
    r.squaredDistance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1]
          , r = e[2] - t[2];
        return i * i + n * n + r * r
    }
    ,
    r.sqrDist = r.squaredDistance,
    r.length = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2];
        return Math.sqrt(e * e + i * i + n * n)
    }
    ,
    r.len = r.length,
    r.squaredLength = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2];
        return e * e + i * i + n * n
    }
    ,
    r.sqrLen = r.squaredLength,
    r.negate = function(t, e) {
        return t[0] = -e[0],
        t[1] = -e[1],
        t[2] = -e[2],
        t
    }
    ,
    r.inverse = function(t, e) {
        return t[0] = 1 / e[0],
        t[1] = 1 / e[1],
        t[2] = 1 / e[2],
        t
    }
    ,
    r.normalize = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = i * i + n * n + r * r;
        return a > 0 && (a = 1 / Math.sqrt(a),
        t[0] = e[0] * a,
        t[1] = e[1] * a,
        t[2] = e[2] * a),
        t
    }
    ,
    r.dot = function(t, e) {
        return t[0] * e[0] + t[1] * e[1] + t[2] * e[2]
    }
    ,
    r.cross = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = i[0]
          , o = i[1]
          , l = i[2];
        return t[0] = r * l - a * o,
        t[1] = a * s - n * l,
        t[2] = n * o - r * s,
        t
    }
    ,
    r.lerp = function(t, e, i, n) {
        var r = e[0]
          , a = e[1]
          , s = e[2];
        return t[0] = r + n * (i[0] - r),
        t[1] = a + n * (i[1] - a),
        t[2] = s + n * (i[2] - s),
        t
    }
    ,
    r.hermite = function(t, e, i, n, r, a) {
        var s = a * a
          , o = s * (2 * a - 3) + 1
          , l = s * (a - 2) + a
          , u = s * (a - 1)
          , h = s * (3 - 2 * a);
        return t[0] = e[0] * o + i[0] * l + n[0] * u + r[0] * h,
        t[1] = e[1] * o + i[1] * l + n[1] * u + r[1] * h,
        t[2] = e[2] * o + i[2] * l + n[2] * u + r[2] * h,
        t
    }
    ,
    r.bezier = function(t, e, i, n, r, a) {
        var s = 1 - a
          , o = s * s
          , l = a * a
          , u = o * s
          , h = 3 * a * o
          , c = 3 * l * s
          , d = l * a;
        return t[0] = e[0] * u + i[0] * h + n[0] * c + r[0] * d,
        t[1] = e[1] * u + i[1] * h + n[1] * c + r[1] * d,
        t[2] = e[2] * u + i[2] * h + n[2] * c + r[2] * d,
        t
    }
    ,
    r.random = function(t, e) {
        e = e || 1;
        var i = 2 * n.RANDOM() * Math.PI
          , r = 2 * n.RANDOM() - 1
          , a = Math.sqrt(1 - r * r) * e;
        return t[0] = Math.cos(i) * a,
        t[1] = Math.sin(i) * a,
        t[2] = r * e,
        t
    }
    ,
    r.transformMat4 = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = i[3] * n + i[7] * r + i[11] * a + i[15];
        return s = s || 1,
        t[0] = (i[0] * n + i[4] * r + i[8] * a + i[12]) / s,
        t[1] = (i[1] * n + i[5] * r + i[9] * a + i[13]) / s,
        t[2] = (i[2] * n + i[6] * r + i[10] * a + i[14]) / s,
        t
    }
    ,
    r.transformMat3 = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2];
        return t[0] = n * i[0] + r * i[3] + a * i[6],
        t[1] = n * i[1] + r * i[4] + a * i[7],
        t[2] = n * i[2] + r * i[5] + a * i[8],
        t
    }
    ,
    r.transformQuat = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = i[0]
          , o = i[1]
          , l = i[2]
          , u = i[3]
          , h = u * n + o * a - l * r
          , c = u * r + l * n - s * a
          , d = u * a + s * r - o * n
          , p = -s * n - o * r - l * a;
        return t[0] = h * u + p * -s + c * -l - d * -o,
        t[1] = c * u + p * -o + d * -s - h * -l,
        t[2] = d * u + p * -l + h * -o - c * -s,
        t
    }
    ,
    r.rotateX = function(t, e, i, n) {
        var r = []
          , a = [];
        return r[0] = e[0] - i[0],
        r[1] = e[1] - i[1],
        r[2] = e[2] - i[2],
        a[0] = r[0],
        a[1] = r[1] * Math.cos(n) - r[2] * Math.sin(n),
        a[2] = r[1] * Math.sin(n) + r[2] * Math.cos(n),
        t[0] = a[0] + i[0],
        t[1] = a[1] + i[1],
        t[2] = a[2] + i[2],
        t
    }
    ,
    r.rotateY = function(t, e, i, n) {
        var r = []
          , a = [];
        return r[0] = e[0] - i[0],
        r[1] = e[1] - i[1],
        r[2] = e[2] - i[2],
        a[0] = r[2] * Math.sin(n) + r[0] * Math.cos(n),
        a[1] = r[1],
        a[2] = r[2] * Math.cos(n) - r[0] * Math.sin(n),
        t[0] = a[0] + i[0],
        t[1] = a[1] + i[1],
        t[2] = a[2] + i[2],
        t
    }
    ,
    r.rotateZ = function(t, e, i, n) {
        var r = []
          , a = [];
        return r[0] = e[0] - i[0],
        r[1] = e[1] - i[1],
        r[2] = e[2] - i[2],
        a[0] = r[0] * Math.cos(n) - r[1] * Math.sin(n),
        a[1] = r[0] * Math.sin(n) + r[1] * Math.cos(n),
        a[2] = r[2],
        t[0] = a[0] + i[0],
        t[1] = a[1] + i[1],
        t[2] = a[2] + i[2],
        t
    }
    ,
    r.forEach = function() {
        var t = r.create();
        return function(e, i, n, r, a, s) {
            var o, l;
            for (i || (i = 3),
            n || (n = 0),
            l = r ? Math.min(r * i + n, e.length) : e.length,
            o = n; o < l; o += i)
                t[0] = e[o],
                t[1] = e[o + 1],
                t[2] = e[o + 2],
                a(t, t, s),
                e[o] = t[0],
                e[o + 1] = t[1],
                e[o + 2] = t[2];
            return e
        }
    }(),
    r.angle = function(t, e) {
        var i = r.fromValues(t[0], t[1], t[2])
          , n = r.fromValues(e[0], e[1], e[2]);
        r.normalize(i, i),
        r.normalize(n, n);
        var a = r.dot(i, n);
        return a > 1 ? 0 : Math.acos(a)
    }
    ,
    r.str = function(t) {
        return "vec3(" + t[0] + ", " + t[1] + ", " + t[2] + ")"
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = e[0]
          , o = e[1]
          , l = e[2];
        return Math.abs(i - s) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(s)) && Math.abs(r - o) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(o)) && Math.abs(a - l) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(l))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(319)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(4);
        return t[0] = 0,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(4);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        e
    }
    ,
    r.fromValues = function(t, e, i, r) {
        var a = new n.ARRAY_TYPE(4);
        return a[0] = t,
        a[1] = e,
        a[2] = i,
        a[3] = r,
        a
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t
    }
    ,
    r.set = function(t, e, i, n, r) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t[3] = r,
        t
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t[3] = e[3] + i[3],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t[3] = e[3] - i[3],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiply = function(t, e, i) {
        return t[0] = e[0] * i[0],
        t[1] = e[1] * i[1],
        t[2] = e[2] * i[2],
        t[3] = e[3] * i[3],
        t
    }
    ,
    r.mul = r.multiply,
    r.divide = function(t, e, i) {
        return t[0] = e[0] / i[0],
        t[1] = e[1] / i[1],
        t[2] = e[2] / i[2],
        t[3] = e[3] / i[3],
        t
    }
    ,
    r.div = r.divide,
    r.ceil = function(t, e) {
        return t[0] = Math.ceil(e[0]),
        t[1] = Math.ceil(e[1]),
        t[2] = Math.ceil(e[2]),
        t[3] = Math.ceil(e[3]),
        t
    }
    ,
    r.floor = function(t, e) {
        return t[0] = Math.floor(e[0]),
        t[1] = Math.floor(e[1]),
        t[2] = Math.floor(e[2]),
        t[3] = Math.floor(e[3]),
        t
    }
    ,
    r.min = function(t, e, i) {
        return t[0] = Math.min(e[0], i[0]),
        t[1] = Math.min(e[1], i[1]),
        t[2] = Math.min(e[2], i[2]),
        t[3] = Math.min(e[3], i[3]),
        t
    }
    ,
    r.max = function(t, e, i) {
        return t[0] = Math.max(e[0], i[0]),
        t[1] = Math.max(e[1], i[1]),
        t[2] = Math.max(e[2], i[2]),
        t[3] = Math.max(e[3], i[3]),
        t
    }
    ,
    r.round = function(t, e) {
        return t[0] = Math.round(e[0]),
        t[1] = Math.round(e[1]),
        t[2] = Math.round(e[2]),
        t[3] = Math.round(e[3]),
        t
    }
    ,
    r.scale = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t[3] = e[3] * i,
        t
    }
    ,
    r.scaleAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t[3] = e[3] + i[3] * n,
        t
    }
    ,
    r.distance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1]
          , r = e[2] - t[2]
          , a = e[3] - t[3];
        return Math.sqrt(i * i + n * n + r * r + a * a)
    }
    ,
    r.dist = r.distance,
    r.squaredDistance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1]
          , r = e[2] - t[2]
          , a = e[3] - t[3];
        return i * i + n * n + r * r + a * a
    }
    ,
    r.sqrDist = r.squaredDistance,
    r.length = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2]
          , r = t[3];
        return Math.sqrt(e * e + i * i + n * n + r * r)
    }
    ,
    r.len = r.length,
    r.squaredLength = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2]
          , r = t[3];
        return e * e + i * i + n * n + r * r
    }
    ,
    r.sqrLen = r.squaredLength,
    r.negate = function(t, e) {
        return t[0] = -e[0],
        t[1] = -e[1],
        t[2] = -e[2],
        t[3] = -e[3],
        t
    }
    ,
    r.inverse = function(t, e) {
        return t[0] = 1 / e[0],
        t[1] = 1 / e[1],
        t[2] = 1 / e[2],
        t[3] = 1 / e[3],
        t
    }
    ,
    r.normalize = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = i * i + n * n + r * r + a * a;
        return s > 0 && (s = 1 / Math.sqrt(s),
        t[0] = i * s,
        t[1] = n * s,
        t[2] = r * s,
        t[3] = a * s),
        t
    }
    ,
    r.dot = function(t, e) {
        return t[0] * e[0] + t[1] * e[1] + t[2] * e[2] + t[3] * e[3]
    }
    ,
    r.lerp = function(t, e, i, n) {
        var r = e[0]
          , a = e[1]
          , s = e[2]
          , o = e[3];
        return t[0] = r + n * (i[0] - r),
        t[1] = a + n * (i[1] - a),
        t[2] = s + n * (i[2] - s),
        t[3] = o + n * (i[3] - o),
        t
    }
    ,
    r.random = function(t, e) {
        return e = e || 1,
        t[0] = n.RANDOM(),
        t[1] = n.RANDOM(),
        t[2] = n.RANDOM(),
        t[3] = n.RANDOM(),
        r.normalize(t, t),
        r.scale(t, t, e),
        t
    }
    ,
    r.transformMat4 = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3];
        return t[0] = i[0] * n + i[4] * r + i[8] * a + i[12] * s,
        t[1] = i[1] * n + i[5] * r + i[9] * a + i[13] * s,
        t[2] = i[2] * n + i[6] * r + i[10] * a + i[14] * s,
        t[3] = i[3] * n + i[7] * r + i[11] * a + i[15] * s,
        t
    }
    ,
    r.transformQuat = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = i[0]
          , o = i[1]
          , l = i[2]
          , u = i[3]
          , h = u * n + o * a - l * r
          , c = u * r + l * n - s * a
          , d = u * a + s * r - o * n
          , p = -s * n - o * r - l * a;
        return t[0] = h * u + p * -s + c * -l - d * -o,
        t[1] = c * u + p * -o + d * -s - h * -l,
        t[2] = d * u + p * -l + h * -o - c * -s,
        t[3] = e[3],
        t
    }
    ,
    r.forEach = function() {
        var t = r.create();
        return function(e, i, n, r, a, s) {
            var o, l;
            for (i || (i = 4),
            n || (n = 0),
            l = r ? Math.min(r * i + n, e.length) : e.length,
            o = n; o < l; o += i)
                t[0] = e[o],
                t[1] = e[o + 1],
                t[2] = e[o + 2],
                t[3] = e[o + 3],
                a(t, t, s),
                e[o] = t[0],
                e[o + 1] = t[1],
                e[o + 2] = t[2],
                e[o + 3] = t[3];
            return e
        }
    }(),
    r.str = function(t) {
        return "vec4(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ")"
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = t[3]
          , o = e[0]
          , l = e[1]
          , u = e[2]
          , h = e[3];
        return Math.abs(i - o) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(o)) && Math.abs(r - l) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(l)) && Math.abs(a - u) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(u)) && Math.abs(s - h) <= n.EPSILON * Math.max(1, Math.abs(s), Math.abs(h))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(162)
      , r = function(t) {
        this._initialBufferArray = void 0,
        this._bufferArray = void 0,
        t && (this.setBufferArray(t),
        this.setInitialBufferArray(t))
    }
      , a = {
        setInitialBufferArray: function(t) {
            this._initialBufferArray = t
        },
        getInitialBufferArray: function() {
            return this._initialBufferArray
        },
        setBufferArray: function(t) {
            this._bufferArray = t.getBufferArray ? t.getBufferArray() : t
        },
        getBufferArray: function() {
            return this._bufferArray
        }
    };
    for (var s in n.prototype)
        a[s] = function(t) {
            return function() {
                return t.apply(this._bufferArray, arguments)
            }
        }(n.prototype[s]);
    r.prototype = a,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(408)
      , a = i(272)
      , s = i(413)
      , o = i(430)
      , l = i(602)
      , u = i(5).mat4
      , h = i(411)
      , c = i(410)
      , d = i(325)
      , p = i(144)
      , f = i(5).vec3
      , g = function() {
        this._modelViewMatrixStack = [],
        this._projectionMatrixStack = [],
        this._viewportStack = [],
        this._cullingSetStack = [],
        this._frustumVolume = -1,
        this._bbCornerFar = 0,
        this._bbCornerNear = 0,
        this._reservedMatrixStack = new c,
        this._reserveCullingSetStack = [new l],
        this._reserveCullingSetStack.current = 0,
        this._cameraIndexStack = [],
        this._cameraModelViewIndexStack = [],
        this._cameraMatrixInverse = [],
        this._cameraMatrixInverseRoot = void 0
    };
    g.prototype = n.objectInherit(o.prototype, {
        _getReservedCullingSet: function() {
            var t = this._reserveCullingSetStack[this._reserveCullingSetStack.current++];
            return this._reserveCullingSetStack.current === this._reserveCullingSetStack.length && this._reserveCullingSetStack.push(new l),
            t
        },
        reset: function() {
            this._modelViewMatrixStack.length = 0,
            this._projectionMatrixStack.length = 0,
            this._cullingSetStack.length = 0,
            this._reservedMatrixStack.reset(),
            this._reserveCullingSetStack.current = 0,
            this._cameraModelViewIndexStack.length = 0,
            this._cameraIndexStack.length = 0,
            this._cameraMatrixInverse.length = 0,
            this._cameraMatrixInverseRoot = void 0
        },
        getProjectionMatrixStack: function() {
            return this._projectionMatrixStack
        },
        getCurrentProjectionMatrix: function() {
            return this._projectionMatrixStack[this._projectionMatrixStack.length - 1]
        },
        getCurrentModelViewMatrix: function() {
            return this._modelViewMatrixStack[this._modelViewMatrixStack.length - 1]
        },
        getCameraInverseMatrix: function() {
            if (!this._cameraIndexStack.length)
                return this._cameraMatrixInverseRoot;
            var t = this._cameraIndexStack[this._cameraIndexStack.length - 1]
              , e = this.getNodePath()[t]
              , i = e.getInstanceID();
            if (void 0 === this._cameraMatrixInverse[i]) {
                var n = this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length - 1]
                  , r = this._modelViewMatrixStack[n]
                  , a = this._reservedMatrixStack.get();
                u.invert(a, r),
                this._cameraMatrixInverse[i] = a
            }
            return this._cameraMatrixInverse[i]
        },
        getCurrentModelMatrix: function() {
            var t = this.getCameraInverseMatrix()
              , e = this._reservedMatrixStack.get();
            return u.mul(e, t, this.getCurrentModelViewMatrix())
        },
        getCurrentViewMatrix: function() {
            if (!this._cameraIndexStack.length)
                return this._modelViewMatrixStack[0];
            var t = this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length - 1];
            return this._modelViewMatrixStack[t]
        },
        getViewport: function() {
            if (0 !== this._viewportStack.length)
                return this._viewportStack[this._viewportStack.length - 1]
        },
        getLookVectorLocal: function(t) {
            var e = this.getCurrentModelViewMatrix();
            return f.set(t, -e[2], -e[6], -e[10])
        },
        pushViewport: function(t) {
            this._viewportStack.push(t)
        },
        popViewport: function() {
            this._viewportStack.pop()
        },
        getFrustumPlanes: function() {
            var t = u.create();
            return function(e, i, n, r) {
                u.mul(t, i, n);
                var a = !!r
                  , s = e[0];
                s[0] = t[3] - t[0],
                s[1] = t[7] - t[4],
                s[2] = t[11] - t[8],
                s[3] = t[15] - t[12];
                var o = e[1];
                o[0] = t[3] + t[0],
                o[1] = t[7] + t[4],
                o[2] = t[11] + t[8],
                o[3] = t[15] + t[12];
                var l = e[2];
                l[0] = t[3] + t[1],
                l[1] = t[7] + t[5],
                l[2] = t[11] + t[9],
                l[3] = t[15] + t[13];
                var c = e[3];
                if (c[0] = t[3] - t[1],
                c[1] = t[7] - t[5],
                c[2] = t[11] - t[9],
                c[3] = t[15] - t[13],
                a) {
                    var d = e[4];
                    d[0] = t[3] - t[2],
                    d[1] = t[7] - t[6],
                    d[2] = t[11] - t[10],
                    d[3] = t[15] - t[14];
                    var p = e[5];
                    p[0] = t[3] + t[2],
                    p[1] = t[7] + t[6],
                    p[2] = t[11] + t[10],
                    p[3] = t[15] + t[14]
                }
                for (var f = r ? 6 : 4, g = 0; g < f; g++)
                    h.normalizeEquation(e[g])
            }
        }(),
        pushCullingSet: function() {
            var t = this._getReservedCullingSet();
            this._enableFrustumCulling && (u.getFrustumPlanes(t.getFrustum().getPlanes(), this.getCurrentProjectionMatrix(), this.getCurrentModelViewMatrix(), !1),
            t.getFrustum().setupMask(4)),
            this._cullingSetStack.push(t)
        },
        popCullingSet: function() {
            return this._cullingSetStack.pop()
        },
        getCurrentCullingSet: function() {
            return this._cullingSetStack[this._cullingSetStack.length - 1]
        },
        pushCurrentMask: function() {
            var t = this.getCurrentCullingSet();
            t && t.pushCurrentMask()
        },
        popCurrentMask: function() {
            var t = this.getCurrentCullingSet();
            t && t.popCurrentMask()
        },
        isVerticesCulled: function(t) {
            return !!this._enableFrustumCulling && this.getCurrentCullingSet().isVerticesCulled(t)
        },
        isBoundingBoxCulled: function(t) {
            return !!this._enableFrustumCulling && (t.valid() && this.getCurrentCullingSet().isBoundingBoxCulled(t))
        },
        isBoundingSphereCulled: function(t) {
            return !!this._enableFrustumCulling && (t.valid() && this.getCurrentCullingSet().isBoundingSphereCulled(t))
        },
        isCulled: function() {
            var t = new r;
            return function(e, i) {
                if (!this._enableFrustumCulling)
                    return !1;
                if (e.isCullingActive()) {
                    if (0 === this.getCurrentCullingSet().getCurrentResultMask())
                        return !1;
                    var n = this._reservedMatrixStack.get();
                    return u.identity(n),
                    n = e instanceof d ? s.computeLocalToWorld(i.slice(0, i.length - 1), !0, n) : s.computeLocalToWorld(i, !0, n),
                    e.getBound().transformMat4(t, n),
                    this.getCurrentCullingSet().isBoundingSphereCulled(t)
                }
                return this.getCurrentCullingSet().resetCullingMask(),
                !1
            }
        }(),
        pushModelViewMatrix: function() {
            var t = f.create();
            return function(e) {
                var i = this.getNodePath()
                  , n = i.length;
                if (n) {
                    var r = n - 1;
                    i[r].getTypeID() === a.getTypeID() && i[r].getReferenceFrame() === p.ABSOLUTE_RF && (this._cameraIndexStack.push(r),
                    this._cameraModelViewIndexStack.push(this._modelViewMatrixStack.length))
                } else {
                    var s = this._reservedMatrixStack.get();
                    u.invert(s, e),
                    this._cameraMatrixInverseRoot = s
                }
                this._modelViewMatrixStack.push(e),
                this.getLookVectorLocal(t),
                this._bbCornerFar = (t[0] >= 0 ? 1 : 0) | (t[1] >= 0 ? 2 : 0) | (t[2] >= 0 ? 4 : 0),
                this._bbCornerNear = 7 & ~this._bbCornerFar
            }
        }(),
        popModelViewMatrix: function() {
            var t = f.create();
            return function() {
                var e = this.getNodePath()
                  , i = e.length - 1;
                this._cameraIndexStack.length && i === this._cameraIndexStack[this._cameraIndexStack.length - 1] && (this._cameraIndexStack.pop(),
                this._cameraModelViewIndexStack.pop()),
                this._modelViewMatrixStack.pop(),
                0 !== this._modelViewMatrixStack.length ? this.getLookVectorLocal(t) : f.set(t, 0, 0, -1),
                this._bbCornerFar = (t[0] >= 0 ? 1 : 0) | (t[1] >= 0 ? 2 : 0) | (t[2] >= 0 ? 4 : 0),
                this._bbCornerNear = 7 & ~this._bbCornerFar
            }
        }(),
        pushProjectionMatrix: function(t) {
            this._projectionMatrixStack.push(t),
            this._frustumVolume = -1,
            this.pushCullingSet()
        },
        popProjectionMatrix: function() {
            this._projectionMatrixStack.pop(),
            this._frustumVolume = -1,
            this.popCullingSet()
        }
    }),
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(607)
      , r = function() {
        this._mask = r.DEFAULT_CULLING,
        this._frustum = new n
    };
    r.prototype = {
        reset: function() {
            this._mask = r.DEFAULT_CULLING,
            this._frustum.clear()
        },
        setCullingMask: function(t) {
            this._mask = t
        },
        getCullingMask: function() {
            return this._mask
        },
        setFrustum: function(t) {
            this._frustum = t
        },
        getFrustum: function() {
            return this._frustum
        },
        getCurrentResultMask: function() {
            return this._frustum.getCurrentMask()
        },
        pushCurrentMask: function() {
            this._frustum.pushCurrentMask()
        },
        popCurrentMask: function() {
            this._frustum.popCurrentMask()
        },
        resetCullingMask: function() {
            this._frustum.setResultMask(this._frustum.getCurrentMask())
        },
        isBoundingBoxCulled: function(t) {
            return !(!(this._mask & r.VIEW_FRUSTUM_CULLING) || this._frustum.containsBoundingBox(t))
        },
        isBoundingSphereCulled: function(t) {
            return !(!(this._mask & r.VIEW_FRUSTUM_CULLING) || this._frustum.containsBoundingSphere(t))
        },
        isVerticesCulled: function(t) {
            return !(!(this._mask & r.VIEW_FRUSTUM_CULLING) || this._frustum.containsVertices(t))
        }
    },
    r.NO_CULLING = 0,
    r.VIEW_FRUSTUM_LEFT_CULLING = 1,
    r.VIEW_FRUSTUM_RIGHT_CULLING = 2,
    r.VIEW_FRUSTUM_TOP_CULLING = 3,
    r.VIEW_FRUSTUM_BOTTOM_CULLING = 4,
    r.NEAR_PLANE_CULLING = 5,
    r.FAR_PLANE_CULLING = 6,
    r.VIEW_FRUSTUM_SIDES_CULLING = r.VIEW_FRUSTUM_LEFT_CULLING | r.VIEW_FRUSTUM_RIGHT_CULLING | r.VIEW_FRUSTUM_BOTTOM_CULLING | r.VIEW_FRUSTUM_TOP_CULLING,
    r.VIEW_FRUSTUM_CULLING = r.VIEW_FRUSTUM_SIDES_CULLING | r.NEAR_PLANE_CULLING | r.FAR_PLANE_CULLING,
    r.DEFAULT_CULLING = r.VIEW_FRUSTUM_SIDES_CULLING,
    r.ENABLE_ALL_CULLING = r.VIEW_FRUSTUM_CULLING,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e, i) {
        this._mode = t,
        this._first = e,
        this._arrayLengths = i.slice(0)
    };
    n.prototype = {
        draw: function(t) {
            for (var e = t.getGraphicContext(), i = this._mode, n = this._first, r = this._arrayLengths, a = 0, s = r.length; a < s; a++) {
                var o = r[a];
                e.drawArrays(i, n, o),
                n += o
            }
        },
        getMode: function() {
            return this._mode
        },
        getNumIndices: function() {
            for (var t = 0, e = this._arrayLengths, i = 0, n = e.length; i < n; i++)
                t += e[i];
            return t
        },
        getCount: function() {
            return this.getNumIndices()
        },
        getArrayLengths: function() {
            return this._arrayLengths
        },
        getFirst: function() {
            return this._first
        },
        setFirst: function(t) {
            this._first = t
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = function() {
        this._frame = 0,
        this._startSimulation = 0,
        this._currentSimulation = 0,
        this._deltaTime = 0
    };
    n.prototype = {
        setReferenceTime: function(t) {
            this._startSimulation = t
        },
        getReferenceTime: function() {
            return this._startSimulation
        },
        setSimulationTime: function(t) {
            this._currentSimulation = t
        },
        getSimulationTime: function() {
            return this._currentSimulation
        },
        setDeltaTime: function(t) {
            this._deltaTime = t
        },
        getDeltaTime: function() {
            return this._deltaTime
        },
        setFrameNumber: function(t) {
            this._frame = t
        },
        getFrameNumber: function() {
            return this._frame
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).vec3
      , a = i(353)
      , s = i(524)
      , o = i(134)
      , l = i(606)
      , u = i(844)
      , h = function(t, e) {
        this._bb = new a,
        this._first = t,
        this._second = e,
        this._nodeRayStart = r.create(),
        this._nodeRayEnd = r.create()
    }
      , c = function(t) {
        this._kdTree = t,
        this._bb = new a,
        this._primitiveIndices = null,
        this._centers = null,
        this._axisOrder = r.create(),
        this._stackLength = 0
    };
    c.prototype = {
        build: function(t, e) {
            var i = t._targetNumTrianglesPerLeaf
              , r = e.getVertexAttributeList().Vertex;
            if (!r)
                return !1;
            var s = r.getElements();
            if (!s)
                return !1;
            var o = s.length / 3;
            if (o < i)
                return !1;
            this._bb.copy(e.getBoundingBox()),
            this._kdTree.setVertices(s),
            this.computeDivisions(t),
            t._numVerticesProcessed += o,
            this.computeTriangles(e);
            var l = new h(-1,this._primitiveIndices.length);
            l._bb.copy(this._bb);
            var u = this._kdTree.addNode(l)
              , c = new a;
            c.copy(this._bb),
            u = this.divide(t, c, u, 0);
            for (var d = this._kdTree.getTriangles(), p = this._primitiveIndices, f = p.length, g = new n.Uint32Array(d.length), m = 0, v = 0; m < f; ++m,
            v += 3) {
                var _ = 3 * p[m];
                g[v] = d[_],
                g[v + 1] = d[_ + 1],
                g[v + 2] = d[_ + 2]
            }
            return this._kdTree.setTriangles(g),
            this._kdTree.getNodes().length > 0
        },
        computeTriangles: function(t) {
            var e = this._kdTree
              , i = 0
              , r = t.getPrimitiveSetList()
              , a = r.length
              , l = 0;
            for (l = 0; l < a; l++) {
                var u = r[l]
                  , h = u.getMode();
                h === o.TRIANGLES ? i += u.getCount() : h !== o.TRIANGLE_STRIP && h !== o.TRIANGLE_FAN || (i += 3 * Math.abs(u.getCount() - 2))
            }
            var c = new n.Uint32Array(i)
              , d = 0
              , p = function(t, e, i) {
                t !== e && t !== i && e !== i && (c[d] = t,
                c[d + 1] = e,
                c[d + 2] = i,
                d += 3)
            }
              , f = new s;
            f.init(t, p),
            f.apply(),
            c = c.subarray(0, d);
            var g = c.length;
            e.setTriangles(c);
            var m = e.getVertices();
            this._centers = new n.Float32Array(g);
            var v = this._centers;
            this._primitiveIndices = new n.Uint32Array(g / 3);
            var _ = this._primitiveIndices
              , b = 0;
            for (l = 0,
            b = 0; l < g; l += 3,
            ++b) {
                var x = c[l]
                  , y = c[l + 1]
                  , S = c[l + 2];
                if (x === y || y === S || x === S)
                    return;
                x *= 3,
                y *= 3,
                S *= 3;
                var w = m[x]
                  , C = m[x + 1]
                  , M = m[x + 2]
                  , T = m[y]
                  , A = m[y + 1]
                  , E = m[y + 2]
                  , P = m[S]
                  , N = m[S + 1]
                  , k = m[S + 2]
                  , F = Math.min(w, Math.min(T, P))
                  , D = Math.min(C, Math.min(A, N))
                  , R = Math.min(M, Math.min(E, k))
                  , I = Math.max(w, Math.max(T, P))
                  , O = Math.max(C, Math.max(A, N))
                  , L = Math.max(M, Math.max(E, k));
                v[l] = .5 * (F + I),
                v[l + 1] = .5 * (D + O),
                v[l + 2] = .5 * (R + L),
                _[b] = b
            }
        },
        computeDivisions: function(t) {
            this._stackLength = t._maxNumLevels;
            var e = this._bb._max
              , i = this._bb._min
              , n = e[0] - i[0]
              , r = e[1] - i[1]
              , a = e[2] - i[2]
              , s = this._axisOrder;
            s[0] = n >= r && n >= a ? 0 : r >= a ? 1 : 2,
            s[2] = n < r && n < a ? 0 : r < a ? 1 : 2;
            var o = s[0] + s[2];
            s[1] = 3 === o ? 0 : 2 === o ? 1 : 2
        },
        divide: function(t, e, i, n) {
            var r = this._kdTree
              , a = this._primitiveIndices
              , s = r.getNodes()
              , o = s[i]
              , l = o._first
              , u = o._second
              , c = n < this._stackLength && l < 0 && u > t._targetNumTrianglesPerLeaf
              , d = -l - 1
              , p = d + u - 1;
            if (!c)
                return l < 0 && this.computeNodeBox(o, d, p),
                i;
            if (l >= 0)
                return i;
            for (var f = this._axisOrder[n % 3], g = e._min[f], m = e._max[f], v = .5 * (g + m), _ = 0, b = 0, x = !1, y = d, S = p, w = this._centers; y < S; ) {
                for (; y < S && w[3 * a[y] + f] <= v; )
                    ++y;
                for (; y < S && w[3 * a[S] + f] > v; )
                    --S;
                if (y < S) {
                    var C = a[y];
                    a[y] = a[S],
                    a[S] = C,
                    ++y,
                    --S
                }
            }
            y === S && (w[3 * a[y] + f] <= v ? ++y : --S),
            S - d <= -1 ? (_ = 0,
            b = i,
            x = !0) : p - y <= -1 ? (_ = i,
            b = 0,
            x = !0) : (_ = r.addNode(new h(-d - 1,S - d + 1)),
            b = r.addNode(new h(-y - 1,p - y + 1)));
            var M = e._max[f];
            e._max[f] = v;
            var T = 0 !== _ ? this.divide(t, e, _, n + 1) : 0;
            e._max[f] = M,
            M = e._min[f],
            e._min[f] = v;
            var A = 0 !== b ? this.divide(t, e, b, n + 1) : 0;
            if (e._min[f] = M,
            !x) {
                o._first = T,
                o._second = A,
                x = !0;
                var E = o._bb;
                E.init(),
                0 !== T && E.expandByBoundingBox(s[T]._bb),
                0 !== A && E.expandByBoundingBox(s[A]._bb)
            }
            return i
        },
        computeNodeBox: function(t, e, i) {
            for (var n = 1 / 0, r = 1 / 0, a = 1 / 0, s = -1 / 0, o = -1 / 0, l = -1 / 0, u = this._kdTree.getTriangles(), h = this._kdTree.getVertices(), c = this._primitiveIndices, d = e; d <= i; ++d) {
                var p = 3 * c[d]
                  , f = 3 * u[p]
                  , g = 3 * u[p + 1]
                  , m = 3 * u[p + 2]
                  , v = h[f]
                  , _ = h[f + 1]
                  , b = h[f + 2]
                  , x = h[g]
                  , y = h[g + 1]
                  , S = h[g + 2]
                  , w = h[m]
                  , C = h[m + 1]
                  , M = h[m + 2];
                n = Math.min(n, Math.min(v, Math.min(x, w))),
                r = Math.min(r, Math.min(_, Math.min(y, C))),
                a = Math.min(a, Math.min(b, Math.min(S, M))),
                s = Math.max(s, Math.max(v, Math.max(x, w))),
                o = Math.max(o, Math.max(_, Math.max(y, C))),
                l = Math.max(l, Math.max(b, Math.max(S, M)))
            }
            var T = t._bb
              , A = T._min
              , E = T._max;
            A[0] = n - 1e-6,
            A[1] = r - 1e-6,
            A[2] = a - 1e-6,
            E[0] = s + 1e-6,
            E[1] = o + 1e-6,
            E[2] = l + 1e-6
        }
    };
    var d = function() {
        this._vertices = null,
        this._kdNodes = [],
        this._triangles = null
    };
    d.prototype = n.objectLibraryClass({
        getVertices: function() {
            return this._vertices
        },
        setVertices: function(t) {
            this._vertices = t
        },
        getNodes: function() {
            return this._kdNodes
        },
        getTriangles: function() {
            return this._triangles
        },
        setTriangles: function(t) {
            this._triangles = t
        },
        addNode: function(t) {
            return this._kdNodes.push(t),
            this._kdNodes.length - 1
        },
        build: function(t, e) {
            return new c(this).build(t, e)
        },
        intersectRay: function(t, e, i, n) {
            if (0 === this._kdNodes.length)
                return !1;
            var r = i.length;
            return this._rayIntersector || (this._rayIntersector = new l,
            this._rayIntersector.setKdtree(this._vertices, this._kdNodes, this._triangles)),
            this._rayIntersector.init(i, t, e, n),
            this._rayIntersector.intersect(this.getNodes()[0], t, e),
            r !== i.length
        },
        intersectSphere: function(t, e, i, n) {
            if (0 === this._kdNodes.length)
                return !1;
            var r = i.length;
            return this._sphereIntersector || (this._sphereIntersector = new u,
            this._sphereIntersector.setKdtree(this._vertices, this._kdNodes, this._triangles)),
            this._sphereIntersector.init(i, t, e, n),
            this._sphereIntersector.intersect(this.getNodes()[0]),
            r !== i.length
        }
    }, "osg", "KdTree"),
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(5).vec3
      , r = i(466)
      , a = function() {
        this._intersector = new r,
        this._dInvX = n.create(),
        this._dInvY = n.create(),
        this._dInvZ = n.create()
    };
    a.prototype = {
        setKdtree: function(t, e, i) {
            this._vertices = t,
            this._kdNodes = e,
            this._triangles = i
        },
        init: function() {
            var t = n.create();
            return function(e, i, r, a) {
                var s = n.sub(t, r, i)
                  , o = n.length(s)
                  , l = 0;
                0 !== o && (l = 1 / o),
                n.scale(s, s, l),
                0 !== s[0] && n.scale(this._dInvX, s, 1 / s[0]),
                0 !== s[1] && n.scale(this._dInvY, s, 1 / s[1]),
                0 !== s[2] && n.scale(this._dInvZ, s, 1 / s[2]),
                this._intersector._intersections = e,
                this._intersector.setNodePath(a),
                this._intersector.set(i, r)
            }
        }(),
        intersect: function() {
            var t = n.create()
              , e = n.create()
              , i = n.create();
            return function(r, a, s) {
                var o = r._first
                  , l = r._second
                  , u = this._triangles
                  , h = this._vertices;
                if (o < 0) {
                    var c = -o - 1
                      , d = c + l
                      , p = this._intersector;
                    p.index = c;
                    for (var f = c; f < d; ++f) {
                        var g = 3 * f
                          , m = u[g]
                          , v = u[g + 1]
                          , _ = u[g + 2]
                          , b = 3 * m;
                        t[0] = h[b],
                        t[1] = h[b + 1],
                        t[2] = h[b + 2],
                        b = 3 * v,
                        e[0] = h[b],
                        e[1] = h[b + 1],
                        e[2] = h[b + 2],
                        b = 3 * _,
                        i[0] = h[b],
                        i[1] = h[b + 1],
                        i[2] = h[b + 2],
                        p.intersect(t, e, i, m, v, _)
                    }
                } else {
                    var x, y = r._nodeRayStart, S = r._nodeRayEnd, w = this._kdNodes;
                    n.copy(y, a),
                    n.copy(S, s),
                    o > 0 && (x = w[o],
                    this.intersectAndClip(y, S, x._bb) && this.intersect(x, y, S)),
                    l > 0 && (n.copy(y, a),
                    n.copy(S, s),
                    x = w[l],
                    this.intersectAndClip(y, S, x._bb) && this.intersect(x, y, S))
                }
            }
        }(),
        intersectAndClip: function() {
            return function(t, e, i) {
                var r = i._min
                  , a = r[0]
                  , s = r[1]
                  , o = r[2]
                  , l = i._max
                  , u = l[0]
                  , h = l[1]
                  , c = l[2]
                  , d = this._dInvX
                  , p = this._dInvY
                  , f = this._dInvZ;
                if (t[0] <= e[0]) {
                    if (e[0] < a)
                        return !1;
                    if (t[0] > u)
                        return !1;
                    t[0] < a && n.scaleAndAdd(t, t, d, a - t[0]),
                    e[0] > u && n.scaleAndAdd(e, t, d, u - t[0])
                } else {
                    if (t[0] < a)
                        return !1;
                    if (e[0] > u)
                        return !1;
                    e[0] < a && n.scaleAndAdd(e, t, d, a - t[0]),
                    t[0] > u && n.scaleAndAdd(t, t, d, u - t[0])
                }
                if (t[1] <= e[1]) {
                    if (e[1] < s)
                        return !1;
                    if (t[1] > h)
                        return !1;
                    t[1] < s && n.scaleAndAdd(t, t, p, s - t[1]),
                    e[1] > h && n.scaleAndAdd(e, t, p, h - t[1])
                } else {
                    if (t[1] < s)
                        return !1;
                    if (e[1] > h)
                        return !1;
                    e[1] < s && n.scaleAndAdd(e, t, p, s - t[1]),
                    t[1] > h && n.scaleAndAdd(t, t, p, h - t[1])
                }
                if (t[2] <= e[2]) {
                    if (e[2] < o)
                        return !1;
                    if (t[2] > c)
                        return !1;
                    t[2] < o && n.scaleAndAdd(t, t, f, o - t[2]),
                    e[2] > c && n.scaleAndAdd(e, t, f, c - t[2])
                } else {
                    if (t[2] < o)
                        return !1;
                    if (e[2] > c)
                        return !1;
                    e[2] < o && n.scaleAndAdd(e, t, f, o - t[2]),
                    t[2] > c && n.scaleAndAdd(t, t, f, c - t[2])
                }
                return !0
            }
        }()
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(85)
      , r = i(411)
      , a = i(13)
      , s = i(5).vec4
      , o = function() {
        this._clippingMask = 0,
        this._planeList = [r.create(), r.create(), r.create(), r.create(), r.create(), r.create()],
        this._vertexList = [],
        this._maskStack = [],
        this._resultMask = 0,
        this._maskStack.push(this._resultMask)
    };
    o.prototype = a.objectInherit(n.prototype, {
        getPlanes: function() {
            return this._planeList
        },
        setPlanes: function(t) {
            this._planeList = t,
            this.setupMask()
        },
        clear: function() {
            if (this._clippingMask = 0,
            this._planeList)
                for (var t = 0, e = this._planeList.length; t < e; ++t)
                    r.init(this._planeList[t]);
            this._vertexList = [],
            this.setupMask()
        },
        setToUnitFrustum: function(t, e) {
            void 0 === t && (t = !0),
            void 0 === e && (e = !0),
            this._planeList.length = 0,
            this._planeList.push(s.set(r.create(), 1, 0, 0, 1)),
            this._planeList.push(s.set(r.create(), -1, 0, 0, 1)),
            this._planeList.push(s.set(r.create(), 0, 1, 0, 1)),
            this._planeList.push(s.set(r.create(), 0, -1, 0, 1)),
            t && this._planeList.push(s.set(r.create(), 0, 0, 1, 1)),
            e && this._planeList.push(s.set(r.create(), 0, 0, -1, 1)),
            this.setupMask()
        },
        setToBoundingBox: function(t) {
            this._planeList.length = 0,
            this._planeList.push(s.set(r.create(), 1, 0, 0, -t.getMin()[0])),
            this._planeList.push(s.set(r.create(), -1, 0, 0, t.getMax()[0])),
            this._planeList.push(s.set(r.create(), 0, 1, 0, -t.getMin()[1])),
            this._planeList.push(s.set(r.create(), 0, -1, 0, t.getMax()[1])),
            this._planeList.push(s.set(r.create(), 0, 0, 1, -t.getMin()[2])),
            this._planeList.push(s.set(r.create(), 0, 0, -1, t.getMax()[2])),
            this.setupMask()
        },
        setAndTransformProvidingInverse: function(t, e) {
            this._referenceVertexList = t._referenceVertexList;
            var i = t._maskStack[this._maskStack.length - 1];
            if (0 === i)
                return this._maskStack[this._maskStack.length - 1] = 0,
                this._resultMask = 0,
                void (this._planeList.length = 0);
            var n, a = 1, s = 0;
            for (n = 0; n !== t._planeList.length; ++n)
                i & a && ++s,
                a <<= 1;
            this._planeList.length = s,
            this._resultMask = 0,
            a = 1;
            var o = 0;
            for (n = 0; n !== t._planeList.length; ++n)
                i & a && (this._planeList[o] = t._planeList[n],
                r.transformProvidingInverse(this._planeList[o++], e),
                this._resultMask = this._resultMask << 1 | 1),
                a <<= 1;
            this._maskStack[this._maskStack.length - 1] = this._resultMask
        },
        voidset: function(t) {
            this._planeList = t,
            this.setupMask()
        },
        add: function(t) {
            this._planeList.push(t),
            this.setupMask()
        },
        empty: function() {
            return 0 === this._planeList.length
        },
        getPlaneList: function() {
            return this._planeList
        },
        setReferenceVertexList: function(t) {
            this._referenceVertexList = t
        },
        getReferenceVertexList: function() {
            return this._referenceVertexList
        },
        setupMask: function(t) {
            this._resultMask = 0;
            for (var e = void 0 !== t ? t : this._planeList.length, i = 0; i < e; ++i)
                this._resultMask = this._resultMask << 1 | 1;
            this._maskStack = [],
            this._maskStack.push(this._resultMask)
        },
        getCurrentMask: function() {
            return this._maskStack[this._maskStack.length - 1]
        },
        setResultMask: function(t) {
            this._resultMask = t
        },
        getResultMask: function() {
            return this._resultMask
        },
        getMaskStack: function() {
            return this._maskStack
        },
        pushCurrentMask: function() {
            this._maskStack.push(this._resultMask)
        },
        popCurrentMask: function() {
            return this._maskStack.pop()
        },
        containsVertex: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !0;
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._maskStack[this._maskStack.length - 1] & e && r.distanceToPlane(this._planeList[i], t) < 0)
                    return !1;
                e <<= 1
            }
            return !0
        },
        containsVertices: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !0;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 0; e < t.length; ++e) {
                for (var i = t[e], n = !1, a = 1, s = 0; !n && s < this._planeList.length; ++s)
                    this._maskStack[this._maskStack.length - 1] & a && r.distanceToPlane(this._planeList[s], i) < 0 && (n = !0),
                    a <<= 1;
                if (!n)
                    return !0
            }
            return !1
        },
        containsBoundingSphere: function(t) {
            if (!this._maskStack[this._maskStack.length - 1] || !t.valid())
                return !0;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._resultMask & e) {
                    var n = r.intersectsOrContainsBoundingSphere(this._planeList[i], t);
                    if (r.OUTSIDE === n)
                        return !1;
                    r.INSIDE === n && (this._resultMask ^= e)
                }
                e <<= 1
            }
            return !0
        },
        containsBoundingBox: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !0;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._resultMask & e) {
                    var n = r.intersectsOrContainsBoundingBox(this._planeList[i], t);
                    if (r.OUTSIDE === n)
                        return !1;
                    r.INSIDE === n && (this._resultMask ^= e)
                }
                e <<= 1
            }
            return !0
        },
        containsAllOfVertices: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !1;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._resultMask & e) {
                    if (r.intersectsOrContainsVertices(this._planeList[i], t) < 1)
                        return !1;
                    this._resultMask ^= e
                }
                e <<= 1
            }
            return !0
        },
        containsAllOfBoundingSphere: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !1;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._resultMask & e) {
                    if (r.intersectsOrContainsBoundingSphere(this._planeList[i], t) < 1)
                        return !1;
                    this._resultMask ^= e
                }
                e <<= 1
            }
            return !0
        },
        containsAllOfBoundingBox: function(t) {
            if (!this._maskStack[this._maskStack.length - 1])
                return !1;
            this._resultMask = this._maskStack[this._maskStack.length - 1];
            for (var e = 1, i = 0; i < this._planeList.length; ++i) {
                if (this._resultMask & e) {
                    if (r.intersectsOrContainsBoundingBox(this._planeList[i], t) < 1)
                        return !1;
                    this._resultMask ^= e
                }
                e <<= 1
            }
            return !0
        },
        transformProvidingInverse: function(t) {
            if (this._maskStack[this._maskStack.length - 1]) {
                this._resultMask = this._maskStack[this._maskStack.length - 1];
                for (var e = 1, i = 0; i < this._planeList.length; ++i)
                    this._resultMask & e && (r.transformProvidingInverse(this._planeList[i], t),
                    e <<= 1)
            }
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(5).vec3
      , r = i(134)
      , a = i(321)
      , s = i(320)
      , o = function(t, e, i) {
        this._geom = t,
        this._cb = e,
        this._vertices = i
    }
      , l = o.functorDrawElements = []
      , u = o.functorDrawArrays = [];
    l[r.POINTS] = function() {
        var t = n.create();
        return function(e, i, n, r, a) {
            for (var s = e + i, o = e; o < s; ++o) {
                var l = 3 * n[o];
                t[0] = a[l],
                t[1] = a[l + 1],
                t[2] = a[l + 2],
                r.operatorPoint(t)
            }
        }
    }(),
    l[r.LINES] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a, s) {
            for (var o = i + n, l = i; l < o - 1; l += 2) {
                var u = 3 * r[l];
                t[0] = s[u],
                t[1] = s[u + 1],
                t[2] = s[u + 2],
                u = 3 * r[l + 1],
                e[0] = s[u],
                e[1] = s[u + 1],
                e[2] = s[u + 2],
                a.operatorLine(t, e)
            }
        }
    }(),
    l[r.LINE_STRIP] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a, s) {
            for (var o = i + n, l = i; l < o - 1; ++l) {
                var u = 3 * r[l];
                t[0] = s[u],
                t[1] = s[u + 1],
                t[2] = s[u + 2],
                u = 3 * r[l + 1],
                e[0] = s[u],
                e[1] = s[u + 1],
                e[2] = s[u + 2],
                a.operatorLine(t, e)
            }
        }
    }(),
    l[r.LINE_LOOP] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a, s) {
            for (var o = i + n - 1, l = i; l < o; ++l) {
                var u = 3 * r[l];
                t[0] = s[u],
                t[1] = s[u + 1],
                t[2] = s[u + 2],
                u = 3 * r[l + 1],
                e[0] = s[u],
                e[1] = s[u + 1],
                e[2] = s[u + 2],
                a.operatorLine(t, e)
            }
            o = 3 * r[o],
            t[0] = s[o],
            t[1] = s[o + 1],
            t[2] = s[o + 2];
            var h = 3 * r[0];
            e[0] = s[h],
            e[1] = s[h + 1],
            e[2] = s[h + 2],
            a.operatorLine(t, e)
        }
    }(),
    l[r.TRIANGLES] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s, o) {
            for (var l = n + r, u = n; u < l; u += 3) {
                var h = 3 * a[u];
                t[0] = o[h],
                t[1] = o[h + 1],
                t[2] = o[h + 2],
                h = 3 * a[u + 1],
                e[0] = o[h],
                e[1] = o[h + 1],
                e[2] = o[h + 2],
                h = 3 * a[u + 2],
                i[0] = o[h],
                i[1] = o[h + 1],
                i[2] = o[h + 2],
                s.operatorTriangle(t, e, i)
            }
        }
    }(),
    l[r.TRIANGLE_STRIP] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s, o) {
            for (var l = 2, u = n; l < r; ++l,
            ++u) {
                var h = 3 * a[u];
                t[0] = o[h],
                t[1] = o[h + 1],
                t[2] = o[h + 2],
                h = 3 * a[u + 1],
                e[0] = o[h],
                e[1] = o[h + 1],
                e[2] = o[h + 2],
                h = 3 * a[u + 2],
                i[0] = o[h],
                i[1] = o[h + 1],
                i[2] = o[h + 2],
                l % 2 ? s.operatorTriangle(t, i, e) : s.operatorTriangle(t, e, i)
            }
        }
    }(),
    l[r.TRIANGLE_FAN] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s, o) {
            for (var l = a[n], u = 2, h = n + 1; u < r; ++u,
            ++h) {
                t[0] = o[l],
                t[1] = o[l + 1],
                t[2] = o[l + 2];
                var c = 3 * a[h];
                e[0] = o[c],
                e[1] = o[c + 1],
                e[2] = o[c + 2],
                c = 3 * a[h + 1],
                i[0] = o[c],
                i[1] = o[c + 1],
                i[2] = o[c + 2],
                s.operatorTriangle(t, e, i)
            }
        }
    }(),
    u[r.POINTS] = function() {
        var t = n.create();
        return function(e, i, n, r) {
            for (var a = e; a < e + i; ++a) {
                var s = 3 * a;
                t[0] = r[s],
                t[1] = r[s + 1],
                t[2] = r[s + 2],
                n.operatorPoint(t)
            }
        }
    }(),
    u[r.LINES] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a) {
            for (var s = i; s < i + n - 1; s += 2) {
                var o = 3 * s;
                t[0] = a[o],
                t[1] = a[o + 1],
                t[2] = a[o + 2],
                o = 3 * (s + 1),
                e[0] = a[o],
                e[1] = a[o + 1],
                e[2] = a[o + 2],
                r.operatorLine(t, e)
            }
        }
    }(),
    u[r.LINE_STRIP] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a) {
            for (var s = i; s < i + n - 1; ++s) {
                var o = 3 * s;
                t[0] = a[o],
                t[1] = a[o + 1],
                t[2] = a[o + 2],
                o = 3 * (s + 1),
                e[0] = a[o],
                e[1] = a[o + 1],
                e[2] = a[o + 2],
                r.operatorLine(t, e)
            }
        }
    }(),
    u[r.LINE_LOOP] = function() {
        var t = n.create()
          , e = n.create();
        return function(i, n, r, a) {
            for (var s = i + n - 1, o = i; o < s; ++o) {
                var l = 3 * o;
                t[0] = a[l],
                t[1] = a[l + 1],
                t[2] = a[l + 2],
                l = 3 * (o + 1),
                e[0] = a[l],
                e[1] = a[l + 1],
                e[2] = a[l + 2],
                r.operatorLine(t, e)
            }
            s *= 3,
            t[0] = a[s],
            t[1] = a[s + 1],
            t[2] = a[s + 2],
            i *= 3,
            e[0] = a[i],
            e[1] = a[i + 1],
            e[2] = a[i + 2],
            r.operatorLine(t, e)
        }
    }(),
    u[r.TRIANGLES] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s) {
            for (var o = n; o < n + r; o += 3) {
                var l = 3 * o;
                t[0] = s[l],
                t[1] = s[l + 1],
                t[2] = s[l + 2],
                l = 3 * (o + 1),
                e[0] = s[l],
                e[1] = s[l + 1],
                e[2] = s[l + 2],
                l = 3 * (o + 2),
                i[0] = s[l],
                i[1] = s[l + 1],
                i[2] = s[l + 2],
                a.operatorTriangle(t, e, i)
            }
        }
    }(),
    u[r.TRIANGLE_STRIP] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s) {
            for (var o = 2, l = n; o < r; ++o,
            ++l) {
                var u = 3 * l;
                t[0] = s[u],
                t[1] = s[u + 1],
                t[2] = s[u + 2],
                u = 3 * (l + 1),
                e[0] = s[u],
                e[1] = s[u + 1],
                e[2] = s[u + 2],
                u = 3 * (l + 2),
                i[0] = s[u],
                i[1] = s[u + 1],
                i[2] = s[u + 2],
                o % 2 ? a.operatorTriangle(t, i, e) : a.operatorTriangle(t, e, i)
            }
        }
    }(),
    u[r.TRIANGLE_FAN] = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create();
        return function(n, r, a, s) {
            for (var o = 2, l = n + 1; o < r; ++o,
            ++l) {
                t[0] = s[n],
                t[1] = s[n + 1],
                t[2] = s[n + 2];
                var u = 3 * l;
                e[0] = s[u],
                e[1] = s[u + 1],
                e[2] = s[u + 2],
                u = 3 * (l + 1),
                i[0] = s[u],
                i[1] = s[u + 1],
                i[2] = s[u + 2],
                a.operatorTriangle(t, e, i)
            }
        }
    }(),
    o.prototype = {
        apply: function() {
            var t = this._geom
              , e = t.getPrimitiveSetList();
            if (e)
                for (var i, n = this._cb(), r = this._vertices, o = e.length, h = 0; h < o; h++) {
                    var c = e[h];
                    if (c instanceof a) {
                        if (i = l[c.getMode()]) {
                            var d = c.indices.getElements();
                            i(c.getFirst() / d.BYTES_PER_ELEMENT, c.getCount(), d, n, r)
                        }
                    } else
                        c instanceof s && (i = u[c.getMode()]) && i(c.getFirst(), c.getCount(), n, r)
                }
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(433)
      , r = function(t, e) {
        this.modelUniform = e._uniformsCache[t.modelMatrix.getName()],
        this.viewUniform = e._uniformsCache[t.viewMatrix.getName()],
        this.apply = void 0,
        this.generateUniformsApplyMethods()
    };
    r.prototype = {
        generateUniformsApplyMethods: function() {
            var t = ["//generated by RenderLeaf\n"];
            t.push("var gl = state.getGraphicContext();"),
            t.push("var matrixModelViewChanged = state.applyModelViewMatrix( modelview, model );"),
            t.push("state.applyProjectionMatrix( projection );"),
            void 0 !== this.modelUniform && (t.push("if ( matrixModelViewChanged ) {"),
            t.push("    var modelMatrix = state.modelMatrix;"),
            t.push("    modelMatrix.setMatrix4( model );"),
            t.push("    modelMatrix.apply( gl, this.modelUniform);"),
            t.push("};")),
            void 0 !== this.viewUniform && (t.push("if ( matrixModelViewChanged ) {"),
            t.push("    var viewMatrix = state.viewMatrix;"),
            t.push("    viewMatrix.setMatrix4( view );"),
            t.push("    viewMatrix.apply( gl, this.viewUniform);"),
            t.push("};"));
            var e = new Function("state","modelview","model","view","projection","return function RenderLeafApplyMatrixUniformCache( state, modelview, model, view, projection ) { " + t.join("\n") + "}")();
            this.apply = e
        }
    };
    var a = function() {
        this._parent = void 0,
        this._geometry = void 0,
        this._depth = 0,
        this._projection = void 0,
        this._view = void 0,
        this._model = void 0,
        this._modelView = void 0
    };
    a.prototype = {
        reset: function() {
            this._parent = void 0,
            this._geometry = void 0,
            this._depth = 0,
            this._projection = void 0,
            this._view = void 0,
            this._model = void 0,
            this._modelView = void 0
        },
        init: function(t, e, i, n, r, a, s) {
            this._parent = t,
            this._geometry = e,
            this._depth = s,
            this._projection = i,
            this._view = n,
            this._model = a,
            this._modelView = r
        },
        drawGeometry: function() {
            return function(t) {
                var e = t.getLastProgramApplied()
                  , i = e.getInstanceID()
                  , n = t.getCacheUniformsApplyRenderLeaf()
                  , a = n[i];
                a || (a = new r(t,e),
                n[i] = a),
                a.apply(t, this._modelView, this._model, this._view, this._projection),
                this._geometry.drawImplementation(t)
            }
        }(),
        render: function() {
            var t = 0
              , e = -1;
            return function(i, r) {
                var a, s, o = this._parent, l = o.parent, u = o.stateset;
                void 0 !== r ? (a = r._parent,
                s = a.parent,
                s !== l ? (n.moveStateGraph(i, s, l),
                i.applyStateSet(u)) : o !== a ? i.applyStateSet(u) : i._stateSetStackChanged(t, e) && i.applyStateSet(u)) : (n.moveStateGraph(i, void 0, l),
                i.applyStateSet(u)),
                i._setStateSetsDrawID(++t),
                e = i.getStateSetStackSize(),
                this.drawGeometry(i)
            }
        }()
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = function(t, e, i, n) {
        r.call(this),
        this._x = void 0 !== t ? t : -1,
        this._y = void 0 !== e ? e : -1,
        this._width = void 0 !== i ? i : -1,
        this._height = void 0 !== n ? n : -1
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Scissor",
        cloneType: function() {
            return new a
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            -1 !== this._x ? (e.enable(e.SCISSOR_TEST),
            e.scissor(this._x, this._y, this._width, this._height)) : e.disable(e.SCISSOR_TEST)
        },
        setScissor: function(t, e, i, n) {
            this._x = t,
            this._y = e,
            this._width = i,
            this._height = n
        },
        x: function() {
            return this._x
        },
        y: function() {
            return this._y
        },
        width: function() {
            return this._width
        },
        height: function() {
            return this._height
        }
    }), "osg", "Scissor"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = function() {
        this.globalDefault = void 0,
        this.lastApplied = void 0,
        this.asChanged = !1,
        this._values = [],
        this._back = void 0
    };
    n.prototype = {
        empty: function() {
            return 0 === this._values.length
        },
        values: function() {
            return this._values
        },
        back: function() {
            return this._back
        },
        push: function(t) {
            this._values.push(t),
            this._back = t
        },
        pop: function() {
            var t = this._values.pop();
            return this._back = this._values[this._values.length - 1],
            t
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(5).mat4
      , r = i(5).mat3
      , a = i(28)
      , s = i(85)
      , o = i(322)
      , l = i(66)
      , u = i(611)
      , h = i(81)
      , c = i(13)
      , d = i(326)
      , p = [void 0, function(t, e) {
        return t[0] === e[0] || (e[0] = t[0],
        !1)
    }
    , function(t, e) {
        return t[0] === e[0] && t[1] === e[1] || (e[0] = t[0],
        e[1] = t[1],
        !1)
    }
    , function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] || (e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        !1)
    }
    , function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3] || (e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        !1)
    }
    ]
      , f = function(t) {
        s.call(this),
        this._graphicContext = void 0,
        this._shaderGeneratorProxy = t,
        void 0 === t && console.break(),
        this._currentVAO = null,
        this._currentIndexVBO = null,
        this.vertexAttribList = [],
        this.stateSets = new u,
        this._shaderGeneratorNames = new u,
        this.uniforms = {},
        this.textureAttributeMapList = [],
        this.attributeMap = {},
        this.projectionMatrix = h.createMatrix4(n.create(), "uProjectionMatrix"),
        this.modelMatrix = h.createMatrix4(n.create(), "uModelMatrix"),
        this.viewMatrix = h.createMatrix4(n.create(), "uViewMatrix"),
        this.modelViewMatrix = h.createMatrix4(n.create(), "uModelViewMatrix"),
        this.modelNormalMatrix = h.createMatrix3(r.create(), "uModelNormalMatrix"),
        this.modelViewNormalMatrix = h.createMatrix3(r.create(), "uModelViewNormalMatrix");
        var e = new u;
        e.globalDefault = h.createFloat1(0, "uArrayColorEnabled"),
        this.uniforms.ArrayColorEnabled = e,
        this._previousColorAttribPair = {},
        this.vertexAttribMap = {},
        this.vertexAttribMap._disable = [],
        this.vertexAttribMap._keys = [],
        this._frameStamp = void 0,
        this._programCommonUniformsCache = {},
        this._modelViewMatrix = void 0,
        this._projectionMatrix = void 0,
        this._program = void 0,
        this.applyAttribute(new o),
        this._numPushStateSet = 0,
        this._numApply = 0,
        this._programUniformCache = [],
        this._cacheUniformId = 0
    };
    f.prototype = c.objectLibraryClass(c.objectInherit(s.prototype, {
        getCacheUniformsApplyRenderLeaf: function() {
            return this._programCommonUniformsCache
        },
        setGraphicContext: function(t) {
            this._graphicContext = t,
            this._extVAO = d.instance(t).getWebGLExtension("OES_vertex_array_object")
        },
        getGraphicContext: function() {
            return this._graphicContext
        },
        getShaderGeneratorProxy: function() {
            return this._shaderGeneratorProxy
        },
        pushCheckOverride: function(t, e, i) {
            0 === t.values().length ? t.push(this.getObjectPair(e, i)) : t.back().value & l.OVERRIDE && !(i & l.PROTECTED) ? t.push(t.back()) : t.push(this.getObjectPair(e, i))
        },
        pushStateSet: function(t) {
            if (this._numPushStateSet++,
            this.stateSets.push(t),
            t.attributeMap && this.pushAttributeMap(this.attributeMap, t.attributeMap),
            t.textureAttributeMapList)
                for (var e = t.textureAttributeMapList, i = 0, n = e.length; i < n; i++)
                    if (e[i]) {
                        var r = this.getOrCreateTextureAttributeMap(i);
                        this.pushAttributeMap(r, e[i])
                    }
            t.uniforms && this.pushUniformsList(this.uniforms, t.uniforms);
            var a = t.getShaderGeneratorPair();
            a && this.pushCheckOverride(this._shaderGeneratorNames, a.getShaderGeneratorName(), a.getValue())
        },
        getStateSetStackSize: function() {
            return this.stateSets.values().length
        },
        insertStateSet: function() {
            var t = [];
            return function(e, i) {
                t.length = 0;
                for (var n = this.getStateSetStackSize(); n > e; )
                    t.push(this.stateSets.back()),
                    this.popStateSet(),
                    n--;
                this.pushStateSet(i);
                for (var r = t.length - 1; r >= 0; r--)
                    this.pushStateSet(t[r])
            }
        }(),
        removeStateSet: function() {
            var t = [];
            return function(e) {
                var i = this.getStateSetStackSize();
                if (e >= i)
                    return void a.warn("Warning State:removeStateSet " + e + " out of range");
                for (t.length = 0; i - 1 > e; )
                    t.push(this.stateSets.back()),
                    this.popStateSet(),
                    i--;
                this.popStateSet();
                for (var n = t.length - 1; n >= 0; n--)
                    this.pushStateSet(t[n])
            }
        }(),
        resetCacheFrame: function() {
            this._modelViewMatrix = this._projectionMatrix = void 0
        },
        resetStats: function() {
            this._numApply = 0,
            this._numPushStateSet = 0
        },
        applyProgram: function(t) {
            this._program !== t && (this._program = t,
            this.getGraphicContext().useProgram(t))
        },
        applyModelViewMatrix: function() {
            var t = r.create();
            return function(e, i) {
                if (this._modelViewMatrix === e)
                    return !1;
                var n = this.getLastProgramApplied()
                  , a = n.getUniformsCache()
                  , s = this.modelViewMatrix
                  , o = a.uModelViewMatrix
                  , l = this.getGraphicContext();
                o && (s.setMatrix4(e),
                s.apply(l, o));
                var u;
                if (this._modelViewMatrix) {
                    for (var h = this._modelViewMatrix, c = 0; c < 11; c++)
                        if (e[c] !== h[c]) {
                            u = !0;
                            break
                        }
                } else
                    u = !0;
                return u && (s = this.modelViewNormalMatrix,
                o = a.uModelViewNormalMatrix,
                o && (r.normalFromMat4(t, e),
                s.setMatrix3(t),
                s.apply(l, o)),
                (o = a.uModelNormalMatrix) && (r.normalFromMat4(t, i),
                s.setMatrix3(t),
                s.apply(l, o))),
                this._modelViewMatrix = e,
                !0
            }
        }(),
        applyProjectionMatrix: function(t) {
            if (this._projectionMatrix !== t) {
                this._projectionMatrix = t;
                var e = this.getLastProgramApplied()
                  , i = this.projectionMatrix
                  , n = e.getUniformsCache()[i.getName()];
                n && (i.setMatrix4(t),
                i.apply(this.getGraphicContext(), n))
            }
        },
        applyStateSet: function(t) {
            this.pushStateSet(t),
            this.apply(),
            this.popStateSet()
        },
        popAllStateSets: function() {
            for (; this.stateSets.values().length; )
                this.popStateSet()
        },
        popStateSet: function() {
            if (!this.stateSets.empty()) {
                var t = this.stateSets.pop();
                if (t.attributeMap && this.popAttributeMap(this.attributeMap, t.attributeMap),
                t.textureAttributeMapList)
                    for (var e = t.textureAttributeMapList, i = 0, n = e.length; i < n; i++)
                        e[i] && this.popAttributeMap(this.textureAttributeMapList[i], e[i]);
                t.uniforms && this.popUniformsList(this.uniforms, t.uniforms),
                t.getShaderGeneratorPair() && this._shaderGeneratorNames.pop()
            }
        },
        _createAttributeStack: function(t, e, i) {
            var n = new u;
            return t[e] = n,
            t[e].globalDefault = i,
            n
        },
        haveAppliedAttribute: function(t) {
            var e = t.getTypeMember()
              , i = this.attributeMap[e];
            i || (i = this._createAttributeStack(this.attributeMap, e, t.cloneType())),
            i.lastApplied = t,
            i.asChanged = !0
        },
        applyAttribute: function(t) {
            var e = t.getTypeMember()
              , i = this.attributeMap
              , n = i[e];
            n || (n = this._createAttributeStack(this.attributeMap, e, t.cloneType())),
            n.lastApplied !== t && (t.apply && t.apply(this),
            n.lastApplied = t,
            n.asChanged = !0)
        },
        applyTextureAttribute: function(t, e) {
            var i = this.getGraphicContext();
            i.activeTexture(i.TEXTURE0 + t);
            var n = e.getTypeMember();
            this.textureAttributeMapList[t] || (this.textureAttributeMapList[t] = {});
            var r = this.getOrCreateTextureAttributeMap(t)
              , a = r[n];
            a || (a = this._createAttributeStack(r, n, e.cloneType())),
            a.lastApplied !== e && (e.apply && e.apply(this, t),
            a.lastApplied = e,
            a.asChanged = !0)
        },
        getLastProgramApplied: function() {
            return this.attributeMap.Program.lastApplied
        },
        applyDefault: function() {
            this.popAllStateSets(),
            this.applyAttributeMap(this.attributeMap),
            this.applyTextureAttributeMapList(this.textureAttributeMapList)
        },
        apply: function() {
            var t = this.getLastProgramApplied();
            this.applyAttributeMap(this.attributeMap),
            this.applyTextureAttributeMapList(this.textureAttributeMapList),
            this._generateAndApplyProgram() ? this._applyGeneratedProgramUniforms(this.attributeMap.Program.lastApplied) : this._applyCustomProgramUniforms(this.attributeMap.Program.lastApplied),
            t !== this.getLastProgramApplied() && (this._modelViewMatrix = void 0,
            this._projectionMatrix = void 0)
        },
        applyAttributeMap: function(t) {
            var e;
            for (var i in t)
                if ((e = t[i]) && e.asChanged) {
                    var n;
                    n = 0 === e.values().length ? e.globalDefault : e.back().object,
                    e.lastApplied !== n && (n.apply && n.apply(this),
                    e.lastApplied = n),
                    e.asChanged = !1
                }
        },
        getObjectPair: function(t, e) {
            return {
                object: t,
                value: e
            }
        },
        pushUniformsList: function(t, e) {
            var i, n;
            for (var r in e) {
                var a = e[r];
                n = a.getUniform(),
                i = n.getName(),
                t[i] || this._createAttributeStack(t, i, n),
                this.pushCheckOverride(t[i], n, a.getValue())
            }
        },
        popUniformsList: function(t, e) {
            for (var i in e)
                t[i].pop()
        },
        _applyTextureAttributeStack: function(t, e, i) {
            var n;
            n = 0 === i.values().length ? i.globalDefault : i.back().object,
            i.lastApplied !== n && (t.activeTexture(t.TEXTURE0 + e),
            n.apply(this, e),
            i.lastApplied = n),
            i.asChanged = !1
        },
        applyTextureAttributeMapList: function(t) {
            for (var e, i = this._graphicContext, n = 0, r = t.length; n < r; n++)
                if (e = t[n])
                    for (var a in e) {
                        var s = e[a];
                        s && s.asChanged && this._applyTextureAttributeStack(i, n, s)
                    }
        },
        setGlobalDefaultAttribute: function(t) {
            var e = t.getTypeMember()
              , i = this.attributeMap;
            void 0 === i[e] ? this._createAttributeStack(i, e, t) : i[e].globalDefault = t
        },
        getGlobalDefaultAttribute: function(t) {
            var e = this.attributeMap;
            if (void 0 !== e[t])
                return e[t].globalDefault
        },
        setGlobalDefaultTextureAttribute: function(t, e) {
            var i = this.getOrCreateTextureAttributeMap(t)
              , n = e.getTypeMember();
            void 0 === i[n] ? this._createAttributeStack(i, n, e) : i[n].globalDefault = e
        },
        getGlobalDefaultTextureAttribute: function(t, e) {
            return this.getOrCreateTextureAttributeMap(t)[e].globalDefault
        },
        getOrCreateTextureAttributeMap: function(t) {
            return this.textureAttributeMapList[t] || (this.textureAttributeMapList[t] = {}),
            this.textureAttributeMapList[t]
        },
        pushAttributeMap: function(t, e) {
            for (var i in e) {
                var n = e[i]
                  , r = n.getAttribute();
                void 0 === t[i] && this._createAttributeStack(t, i, r.cloneType());
                var a = t[i];
                this.pushCheckOverride(a, r, n.getValue()),
                a.asChanged = !0
            }
        },
        popAttributeMap: function(t, e) {
            for (var i in e) {
                var n = t[i];
                n.pop(),
                n.asChanged = !0
            }
        },
        setIndexArray: function(t) {
            var e = this._graphicContext;
            this._currentIndexVBO !== t && (t.bind(e),
            this._currentIndexVBO = t),
            t.isDirty() && t.compile(e)
        },
        lazyDisablingOfVertexAttributes: function() {
            for (var t = this.vertexAttribMap._keys, e = 0, i = t.length; e < i; e++) {
                var n = t[e];
                this.vertexAttribMap[n] && (this.vertexAttribMap._disable[n] = !0)
            }
        },
        enableVertexColor: function() {
            var t = this.attributeMap.Program.lastApplied;
            if (t.getUniformsCache().uArrayColorEnabled && t.getAttributesCache().Color) {
                var e = this.uniforms.ArrayColorEnabled.globalDefault;
                this._previousColorAttribPair[t.getInstanceID()] || (e.setFloat(1),
                e.apply(this.getGraphicContext(), t.getUniformsCache().uArrayColorEnabled),
                this._previousColorAttribPair[t.getInstanceID()] = !0)
            }
        },
        disableVertexColor: function() {
            var t = this.attributeMap.Program.lastApplied;
            if (t.getUniformsCache().uArrayColorEnabled && t.getAttributesCache().Color) {
                var e = this.uniforms.ArrayColorEnabled.globalDefault;
                this._previousColorAttribPair[t.getInstanceID()] && (e.setFloat(0),
                e.apply(this.getGraphicContext(), t.getUniformsCache().uArrayColorEnabled),
                this._previousColorAttribPair[t.getInstanceID()] = !1)
            }
        },
        applyDisablingOfVertexAttributes: function() {
            for (var t = this.vertexAttribMap._keys, e = 0, i = t.length; e < i; e++)
                if (!0 === this.vertexAttribMap._disable[t[e]]) {
                    var n = t[e];
                    this._graphicContext.disableVertexAttribArray(n),
                    this.vertexAttribMap._disable[n] = !1,
                    this.vertexAttribMap[n] = !1
                }
        },
        clearVertexAttribCache: function() {
            for (var t = this.vertexAttribMap, e = t._keys, i = 0, n = e.length; i < n; i++) {
                var r = e[i];
                t[r] = void 0,
                t._disable[r] = !1
            }
            this.vertexAttribMap._disable.length = 0,
            this.vertexAttribMap._keys.length = 0
        },
        setVertexArrayObject: function(t) {
            return this._currentVAO !== t && (this._graphicContext.bindVertexArray(t),
            this._currentVAO = t,
            t || this.clearVertexAttribCache(),
            this._currentIndexVBO = void 0,
            !0)
        },
        setVertexAttribArray: function(t, e, i) {
            var n = this.vertexAttribMap;
            n._disable[t] = !1;
            var r = this._graphicContext
              , a = !1;
            e.isDirty() && (e.bind(r),
            e.compile(r),
            a = !0);
            var s = n[t];
            s !== e && (a || e.bind(r),
            s || (r.enableVertexAttribArray(t),
            void 0 === s && n._keys.push(t)),
            n[t] = e,
            r.vertexAttribPointer(t, e.getItemSize(), e.getType(), i, 0, 0))
        },
        _getActiveUniformsFromProgramAttributes: function(t, e) {
            var i = this.attributeMap
              , n = t.getTrackAttributes().attributeKeys;
            if (n.length > 0)
                for (var r = 0, a = n.length; r < a; r++) {
                    var s = n[r]
                      , o = i[s];
                    if (void 0 !== o) {
                        var l = o.globalDefault;
                        if (void 0 !== l.getOrCreateUniforms) {
                            var u = l.getOrCreateUniforms();
                            for (var h in u)
                                e.push(u[h])
                        }
                    }
                }
        },
        _getActiveUniformsFromProgramTextureAttributes: function(t, e) {
            var i = t.getTrackAttributes().textureAttributeKeys;
            if (void 0 !== i)
                for (var n = 0, r = i.length; n < r; n++) {
                    var a = i[n];
                    if (void 0 !== a) {
                        var s = this.textureAttributeMapList[n];
                        if (void 0 !== s)
                            for (var o = 0, l = a.length; o < l; o++) {
                                var u = a[o]
                                  , h = s[u];
                                if (void 0 !== h) {
                                    var c = h.globalDefault;
                                    if (void 0 !== c.getOrCreateUniforms) {
                                        var d = c.getOrCreateUniforms();
                                        for (var p in d)
                                            e.push(d[p])
                                    }
                                }
                            }
                    }
                }
        },
        _cacheUniformsForCustomProgram: function(t, e) {
            this._getActiveUniformsFromProgramAttributes(t, e),
            this._getActiveUniformsFromProgramTextureAttributes(t, e);
            for (var i = this._graphicContext, n = {}, r = 0, a = e.length; r < a; r++) {
                var s = e[r]
                  , o = s.getName()
                  , l = i.getUniformLocation(t._program, o);
                void 0 !== l && null !== l && (n[o] = s)
            }
            t.trackUniforms = n
        },
        _applyCustomProgramUniforms: function() {
            var t = [];
            return function(e) {
                t.length = 0,
                void 0 !== e.getTrackAttributes() && void 0 === e.trackUniforms && this._cacheUniformsForCustomProgram(e, t);
                var i, n = e.getUniformsCache(), r = this.uniforms;
                e.trackUniforms && (i = e.trackUniforms);
                var a;
                for (var s in n) {
                    var o = n[s]
                      , l = r[s];
                    void 0 === l ? void 0 !== i && void 0 !== (a = i[s]) && a.apply(this._graphicContext, o) : (a = 0 === l.values().length ? l.globalDefault : l.back().object,
                    a.apply(this._graphicContext, o))
                }
            }
        }(),
        _generateAndApplyProgram: function() {
            var t = this.attributeMap;
            if (void 0 === t.Program || 0 === t.Program.values().length || t.Program.back().value === l.OFF) {
                var e = this._shaderGeneratorNames.back()
                  , i = this._shaderGeneratorProxy.getShaderGenerator(e ? e.object : void 0)
                  , n = i.getOrCreateProgram(this);
                return this.applyAttribute(n),
                n
            }
        },
        _computeForeignUniforms: function(t, e) {
            var i = t
              , n = [];
            for (var r in t) {
                void 0 !== i[r] && void 0 === e[r] && r !== this.modelViewMatrix.getName() && r !== this.modelMatrix.getName() && r !== this.viewMatrix.getName() && r !== this.projectionMatrix.getName() && r !== this.modelViewNormalMatrix.getName() && r !== this.modelNormalMatrix.getName() && "uArrayColorEnabled" !== r && n.push(r)
            }
            return n
        },
        _removeUniformsNotRequiredByProgram: function(t, e) {
            for (var i in t) {
                var n = e[i];
                void 0 !== n && null !== n || delete t[i]
            }
        },
        _cacheUniformsForGeneratedProgram: function(t) {
            var e = this._computeForeignUniforms(t.getUniformsCache(), t.getActiveUniforms());
            t.setForeignUniforms(e),
            this._removeUniformsNotRequiredByProgram(t.getActiveUniforms(), t.getUniformsCache())
        },
        _copyUniformEntry: function(t) {
            var e, i = t.getInternalArray();
            return i.length < 16 && (e = new i.constructor(i.length)),
            e
        },
        _initUniformCache: function(t) {
            var e, i, n, r, a, s, o = t.getActiveUniforms(), l = t.getForeignUniforms(), u = this.uniforms, h = [], c = [];
            if (t._cacheUniformId = this._cacheUniformId++,
            this._programUniformCache[t._cacheUniformId] = {},
            l.length)
                for (n = h,
                e = 0,
                i = l.length; e < i; e++) {
                    r = l[e];
                    var d = u[r];
                    d && (s = d.globalDefault,
                    a = this._copyUniformEntry(s),
                    n.push(a))
                }
            for (var p in o)
                s = o[p],
                a = this._copyUniformEntry(s),
                c.push(a);
            this._programUniformCache[t._cacheUniformId].foreign = h,
            this._programUniformCache[t._cacheUniformId].active = c
        },
        _checkCacheAndApplyUniform: function(t, e, i, n, r) {
            var a, s = t.getInternalArray(), o = s.length;
            if (o <= 4) {
                var l = e[i];
                a = p[o](s, l)
            } else
                a = !1;
            if (!a) {
                var u = n[r];
                t.apply(this._graphicContext, u)
            }
        },
        _applyGeneratedProgramUniforms: function(t) {
            var e = t.getForeignUniforms();
            e || (this._cacheUniformsForGeneratedProgram(t),
            e = t.getForeignUniforms(),
            this._initUniformCache(t));
            var i, n, r, s = t.getUniformsCache(), o = t.getActiveUniforms(), l = this._programUniformCache[t._cacheUniformId].active, u = this._programUniformCache[t._cacheUniformId].foreign, h = 0;
            for (r in o)
                n = o[r],
                this._checkCacheAndApplyUniform(n, l, h, s, r),
                h++;
            var c = this.uniforms;
            for (h = 0,
            i = e.length; h < i; h++) {
                r = e[h];
                var d = c[r];
                void 0 !== d && (0 === d.values().length ? (n = d.globalDefault,
                a.warn("Uniform Default Not attached to a StateSet in Scene Hierarchy: " + d.globalDefault.getName())) : n = d.back().object),
                this._checkCacheAndApplyUniform(n, u, h, s, r)
            }
        },
        _setStateSetsDrawID: function(t) {
            for (var e = this.stateSets.values(), i = 0, n = e.length; i < n; i++)
                e[i].setDrawID(t)
        },
        _stateSetStackChanged: function(t, e) {
            var i = this.stateSets.values()
              , n = i.length;
            if (e !== n)
                return !0;
            for (var r = 0; r < n; r++)
                if (t !== i[r].getDrawID())
                    return !0;
            return !1
        }
    }), "osg", "State"),
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(128)
      , a = i(65)
      , s = function() {
        r.call(this),
        this._values = []
    };
    s.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        addChild: function(t, e) {
            return r.prototype.addChild.call(this, t),
            void 0 === e && (e = !0),
            this.children.length > this._values.length ? this._values.push(e) : this._values[this.children.length - 1] = e,
            !0
        },
        setValue: function(t, e) {
            t < this._values.length && (this._values[t] = e)
        },
        getValue: function(t) {
            if (t < this._values.length)
                return this._values[t]
        },
        setAllChildrenOff: function() {
            for (var t = 0; t < this._values.length; ++t)
                this._values[t] = !1
        },
        setAllChildrenOn: function() {
            for (var t = 0; t < this._values.length; ++t)
                this._values[t] = !0
        },
        traverse: function() {
            return function(t) {
                switch (t.traversalMode) {
                case a.TRAVERSE_ALL_CHILDREN:
                    for (var e = 0; e < this.children.length; ++e)
                        this.children[e].accept(t);
                    break;
                case a.TRAVERSE_ACTIVE_CHILDREN:
                    var i = this.children.length;
                    for (this._values.length < i && (i = this._values.length),
                    e = 0; e < i; ++e)
                        !0 === this._values[e] && this.children[e].accept(t)
                }
            }
        }()
    }), "osg", "Switch"),
    n.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(326)
      , a = function(t) {
        if (this._enabled = !1,
        t) {
            var e = r.instance(t).getDisjointTimerQuery();
            if (!e)
                return this;
            if (t.getQueryParameter || (t.getQueryParameter = e.getQueryObjectEXT.bind(e)),
            this._hasTimeElapsed = t.getQuery(e.TIME_ELAPSED_EXT, e.QUERY_COUNTER_BITS_EXT) >= 30,
            this._hasTimeStamp = t.getQuery(e.TIMESTAMP_EXT, e.QUERY_COUNTER_BITS_EXT) >= 30,
            !this._hasTimeElapsed && !this._hasTimeStamp)
                return this;
            this._hasTimeStamp || n.debug("Warning: do not use interleaved GPU query"),
            this._ext = e,
            this._gl = t,
            this._enabled = !0
        }
        this._frameAverageCount = 10,
        this._glQueries = [],
        this._queriesByID = {},
        this._userQueries = [],
        this._queryCount = 0,
        this._nbOpened = 0
    };
    a.FRAME_COUNT = 0,
    a.instance = function(t) {
        return a._instance ? t && a._instance.getContext() !== t && a._instance.setContext(t) : a._instance = new a(t),
        a._instance
    }
    ,
    a.prototype = {
        getContext: function() {
            return this._gl
        },
        setContext: function(t) {
            this._gl = t
        },
        setFrameAverageCount: function(t) {
            this._frameAverageCount = t
        },
        clearQueries: function() {
            for (var t = this._glQueries, e = 0, i = t.length; e < i; ++e) {
                var n = t[e];
                this._gl.deleteQuery(n._pollingStartQuery),
                n._pollingEndQuery && this._gl.deleteQuery(n)
            }
            this._userQueries.length = 0,
            this._glQueries.length = 0,
            this._queriesByID = {}
        },
        supportTimeStamp: function() {
            return this._hasTimeStamp
        },
        enable: function() {
            this._enabled = !!this._ext
        },
        disable: function() {
            this._enabled = !1
        },
        isEnabled: function() {
            return this._enabled
        },
        setCallback: function(t) {
            this._callback = t
        },
        createUserQuery: function(t) {
            var e;
            return e = this._hasTimeStamp ? this.createGLQuery() : {
                _startIndex: 0,
                _endIndex: 0
            },
            e._id = t,
            e._frame = a.FRAME_COUNT,
            e._isOpened = !0,
            e._siblings = [],
            e
        },
        createGLQuery: function() {
            var t = {};
            return t._isWaiting = !1,
            t._pollingStartQuery = void 0,
            t._pollingEndQuery = void 0,
            t._averageTimer = 0,
            t._resultCount = 0,
            this._hasTimeStamp && (t._pollingEndQuery = this._gl.createQuery()),
            t._pollingStartQuery = this._gl.createQuery(),
            this._glQueries.push(t),
            t
        },
        getOrCreateLastGLQuery: function() {
            var t = this._glQueries[this._queryCount - 1];
            return t || (t = this._glQueries[this._queryCount - 1] = this.createGLQuery())
        },
        beginCurrentQuery: function() {
            if (0 !== this._nbOpened) {
                this._queryCount++;
                var t = this.getOrCreateLastGLQuery();
                t._isWaiting || this._gl.beginQuery(this._ext.TIME_ELAPSED_EXT, t._pollingStartQuery)
            }
        },
        endCurrentQuery: function() {
            0 !== this._nbOpened && (this.getOrCreateLastGLQuery()._isWaiting || this._gl.endQuery(this._ext.TIME_ELAPSED_EXT))
        },
        getAvailableQueryByID: function(t) {
            var e = this._queriesByID[t];
            if (!e)
                return e = this._queriesByID[t] = this.createUserQuery(t),
                this._userQueries.push(e),
                e;
            if (e._frame === a.FRAME_COUNT) {
                if (e._isOpened)
                    return e;
                for (var i = e._siblings, n = 0, r = i.length; n < r; ++n) {
                    var s = i[n];
                    if (s._frame !== a.FRAME_COUNT || s._isOpened)
                        return s._frame = a.FRAME_COUNT,
                        s
                }
                var o = this.createUserQuery();
                return i.push(o),
                o
            }
            return e._frame = a.FRAME_COUNT,
            e
        },
        start: function(t) {
            if (this._enabled) {
                var e = this.getAvailableQueryByID(t);
                e._isOpened = !0,
                this._hasTimeStamp ? e._isWaiting || this._ext.queryCounterEXT(e._pollingStartQuery, this._ext.TIMESTAMP_EXT) : (this.endCurrentQuery(),
                this._nbOpened++,
                e._startIndex = this._queryCount,
                this.beginCurrentQuery())
            }
        },
        end: function(t) {
            if (this._enabled) {
                var e = this.getAvailableQueryByID(t);
                e._isOpened = !1,
                this._hasTimeStamp ? e._isWaiting || this._ext.queryCounterEXT(e._pollingEndQuery, this._ext.TIMESTAMP_EXT) : (this.endCurrentQuery(),
                e._endIndex = this._queryCount,
                this._nbOpened--,
                this.beginCurrentQuery())
            }
        },
        computeQueryAverageTime: function(t) {
            for (var e = 0, i = this._glQueries, n = t._startIndex; n < t._endIndex; ++n) {
                var r = i[n]._averageTimer;
                if (r < 0)
                    return -1;
                e += r
            }
            return e
        },
        computeFullAverageTime: function(t) {
            var e = this.computeQueryAverageTime(t);
            if (e < 0)
                return -1;
            for (var i = t._siblings, n = 0, r = i.length; n < r; ++n) {
                var s = i[n];
                if (s._frame === a.FRAME_COUNT - 1) {
                    var o = this.computeQueryAverageTime(s);
                    if (o < 0)
                        return -1;
                    e += o
                }
            }
            return e
        },
        pollQueries: function() {
            if (a.FRAME_COUNT++,
            this._queryCount = 0,
            this._nbOpened = 0,
            this._enabled && this._callback) {
                var t, e = this._glQueries, i = e.length;
                if (this._gl.getParameter(this._ext.GPU_DISJOINT_EXT))
                    for (t = 0; t < i; ++t)
                        e[t]._isWaiting = !1;
                else {
                    for (t = 0; t < i; ++t)
                        this.pollQuery(e[t]);
                    var n = this._userQueries
                      , r = n.length;
                    for (t = 0; t < r; ++t) {
                        var s = n[t]
                          , o = this.computeFullAverageTime(s);
                        o > 0 && this._callback(o, s._id)
                    }
                }
            }
        },
        pollQuery: function(t) {
            t._isWaiting = !1;
            var e = this._hasTimeStamp ? t._pollingEndQuery : t._pollingStartQuery;
            if (!this._gl.getQueryParameter(e, this._gl.QUERY_RESULT_AVAILABLE))
                return t._isWaiting = !0,
                0;
            var i;
            if (this._hasTimeStamp) {
                var n = this._gl.getQueryParameter(t._pollingStartQuery, this._gl.QUERY_RESULT);
                i = this._gl.getQueryParameter(e, this._gl.QUERY_RESULT) - n
            } else
                i = this._gl.getQueryParameter(e, this._gl.QUERY_RESULT);
            return t._resultCount++,
            t._resultCount > this._frameAverageCount && (t._averageTimer = 0,
            t._resultCount = 1),
            t._averageTimer = t._averageTimer + (i - t._averageTimer) / t._resultCount,
            t._averageTimer
        }
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(65)
      , a = function() {
        r.call(this),
        this.visitorType = r.UPDATE_VISITOR,
        this._numUpdateCallback = 0
    };
    a.prototype = n.objectInherit(r.prototype, {
        resetStats: function() {
            this._numUpdateCallback = 0
        },
        apply: function(t) {
            var e = t.getStateSet();
            if (e && e.requiresUpdateTraversal()) {
                var i = e.getUpdateCallbackList()
                  , n = i.length;
                if (n) {
                    this._numUpdateCallback += n;
                    for (var r = 0, a = n; r < a; r++)
                        i[r].update(e, this)
                }
            }
            for (var s = t.getUpdateCallbackList(), o = s.length, l = 0; l < o; l++)
                if (this._numUpdateCallback++,
                !s[l].update(t, this))
                    return;
            t.getNumChildrenRequiringUpdateTraversal() > 0 && this.traverse(t)
        }
    }),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(515)
      , r = i(838)
      , a = i(839)
      , s = i(376)
      , o = i(353)
      , l = i(408)
      , u = i(162)
      , h = i(272)
      , c = i(840)
      , d = i(456)
      , p = i(413)
      , f = i(516)
      , g = i(602)
      , m = i(430)
      , v = i(601)
      , _ = i(457)
      , b = i(377)
      , x = i(603)
      , y = i(320)
      , S = i(321)
      , w = i(841)
      , C = i(378)
      , M = i(604)
      , T = i(143)
      , A = i(409)
      , E = i(431)
      , P = i(842)
      , N = i(605)
      , k = i(843)
      , F = i(432)
      , D = i(517)
      , R = i(845)
      , I = i(518)
      , O = i(519)
      , L = i(379)
      , B = i(410)
      , V = i(163)
      , U = i(128)
      , G = i(65)
      , z = i(28)
      , H = i(85)
      , j = i(520)
      , W = i(521)
      , q = i(607)
      , Y = i(846)
      , X = i(411)
      , K = i(608)
      , J = i(134)
      , Q = i(322)
      , Z = i(522)
      , $ = i(458)
      , tt = i(609)
      , et = i(523)
      , it = i(323)
      , nt = i(380)
      , rt = i(611)
      , at = i(612)
      , st = i(66)
      , ot = i(433)
      , lt = i(287)
      , ut = i(613)
      , ht = i(93)
      , ct = i(847)
      , dt = i(325)
      , pt = i(524)
      , ft = i(81)
      , gt = i(615)
      , mt = i(13)
      , vt = i(412)
      , _t = i(467)
      , bt = i(610)
      , xt = i(144)
      , yt = i(324)
      , St = i(614)
      , wt = i(326)
      , Ct = {};
    Ct.AutoTransform = n,
    Ct.BillboardAttribute = r,
    Ct.BlendColor = a,
    Ct.BlendFunc = s,
    Ct.BoundingBox = o,
    Ct.BoundingSphere = l,
    Ct.BufferArray = u,
    Ct.ColorMask = c,
    Ct.Camera = h,
    Ct.ColorMask = c,
    Ct.ComputeBoundsVisitor = d,
    mt.objectMix(Ct, p),
    Ct.CullFace = f,
    Ct.CullingSet = g,
    Ct.CullSettings = m,
    Ct.CullStack = v,
    Ct.CullVisitor = _,
    Ct.Depth = b,
    Ct.DrawArrayLengths = x,
    Ct.DrawArrays = y,
    Ct.DrawElements = S,
    Ct.EllipsoidModel = w,
    Ct.WGS_84_RADIUS_EQUATOR = w.WGS_84_RADIUS_EQUATOR,
    Ct.WGS_84_RADIUS_POLAR = w.WGS_84_RADIUS_POLAR,
    Ct.FrameBufferObject = C,
    Ct.FrameStamp = M,
    Ct.Geometry = T,
    Ct.GLObject = A,
    Ct.Image = E,
    Ct.ImageStream = P,
    Ct.KdTree = N,
    Ct.KdTreeBuilder = k,
    Ct.Light = F,
    Ct.LightSource = D,
    Ct.LineWidth = R,
    Ct.Lod = I,
    Ct.Material = O,
    mt.objectMix(Ct, L),
    Ct.MatrixTransform = V,
    Ct.MatrixMemoryPool = B,
    Ct.Node = U,
    Ct.NodeVisitor = G,
    mt.objectMix(Ct, z),
    Ct.Object = H,
    Ct.Options = j,
    Ct.PagedLOD = W,
    Ct.Plane = X,
    Ct.PointSizeAttribute = Y,
    Ct.Polytope = q,
    Ct.PrimitiveSet = J,
    Ct.PrimitiveFunctor = K,
    Ct.Program = Q,
    Ct.Projection = Z,
    Ct.RenderBin = $,
    Ct.RenderLeaf = tt,
    Ct.RenderStage = et,
    Ct.Shader = it,
    mt.objectMix(Ct, nt),
    Ct.Stack = rt,
    Ct.State = at,
    Ct.StateAttribute = st,
    Ct.StateGraph = ot,
    Ct.StateSet = lt,
    Ct.Scissor = bt,
    Ct.Switch = ut,
    Ct.Texture = ht,
    Ct.TextureCubeMap = ct,
    Ct.Transform = dt,
    Ct.TriangleIndexFunctor = pt,
    Ct.Uniform = ft,
    Ct.UpdateVisitor = gt,
    mt.objectMix(Ct, mt),
    Ct.Viewport = vt;
    var Mt = i(5);
    Ct.vec2 = Mt.vec2,
    Ct.vec3 = Mt.vec3,
    Ct.vec4 = Mt.vec4,
    Ct.quat = Mt.quat,
    Ct.mat3 = Mt.mat3,
    Ct.mat4 = Mt.mat4,
    Ct.memoryPools = _t.memoryPools,
    Ct.Transform.RELATIVE_RF = xt.RELATIVE_RF,
    Ct.Transform.ABSOLUTE_RF = xt.ABSOLUTE_RF,
    Ct.Timer = yt,
    Ct.TimerGPU = St,
    Ct.WebGLCaps = wt,
    t.exports = Ct
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(13)
      , a = i(85)
      , s = i(5).quat
      , o = i(5).vec3
      , l = i(5).mat4
      , u = i(416)
      , h = i(461)
      , c = i(626)
      , d = i(618)
      , p = i(354)
      , f = i(527)
      , g = {
        lerp: function(t, e, i) {
            return t + (e - t) * i
        },
        init: function() {
            return 0
        },
        copy: function(t) {
            return t
        },
        create: function() {
            return 0
        }
    }
      , m = [];
    m[u.ChannelType.Float] = 1,
    m[u.ChannelType.FloatCubicBezier] = 1,
    m[u.ChannelType.Vec3] = 3,
    m[u.ChannelType.Vec3CubicBezier] = 3,
    m[u.ChannelType.Quat] = 4,
    m[u.ChannelType.QuatSlerp] = 4,
    m[u.ChannelType.Matrix] = 16;
    var v = [];
    v.length = u.ChannelType.Count,
    v[u.ChannelType.Vec3] = o,
    v[u.ChannelType.Quat] = s,
    v[u.ChannelType.QuatSlerp] = s,
    v[u.ChannelType.Float] = g,
    v[u.ChannelType.FloatCubicBezier] = g,
    v[u.ChannelType.Vec3CubicBezier] = o,
    v[u.ChannelType.Matrix] = l;
    var _ = function() {
        a.call(this),
        this._simulationTime = 0,
        this._pauseTime = 0,
        this._timeFactor = 1,
        this._startTime = 0,
        this._instanceAnimations = {},
        this._startAnimations = {},
        this._targets = [],
        this._targetsMap = {},
        this._targetsByTypes = [],
        this._targetsByTypes.length = u.ChannelType.Count;
        for (var t = 0, e = this._targetsByTypes.length; t < e; t++)
            this._targetsByTypes[t] = [];
        this._activeAnimations = {},
        this._activeAnimationList = [],
        this._activeChannelsByTypes = [],
        this._activeChannelsByTypes.length = u.ChannelType.Count;
        for (var i = 0, n = this._activeChannelsByTypes.length; i < n; i++)
            this._activeChannelsByTypes[i] = [];
        this._animationsUpdateCallback = {},
        this._animationsUpdateCallbackArray = [],
        this._animationsToRegister = [],
        this._pause = !1,
        this._dirty = !1,
        this._seekTime = -1
    };
    _.prototype = r.objectInherit(a.prototype, {
        init: function(t) {
            this._simulationTime = 0,
            this._pauseTime = 0,
            this._timeFactor = 1,
            this._startTime = 0,
            this._instanceAnimations = {},
            this._startAnimations = {},
            this._resetTargets(),
            this._activeAnimations = {},
            this._activeAnimationList.length = 0;
            for (var e = 0, i = this._activeChannelsByTypes.length; e < i; e++)
                this._activeChannelsByTypes[e].length = 0;
            this._animationsUpdateCallback = {},
            this._animationsUpdateCallbackArray.length = 0,
            this._pause = !1,
            this._seekTime = -1,
            this.addAnimations(t)
        },
        addAnimations: function(t) {
            var e = this._addAnimation(t);
            Array.prototype.push.apply(this._animationsToRegister, e),
            this._dirty = !0,
            this._registerAnimations()
        },
        update: function(t, e) {
            this._dirty && (this._findAnimationUpdateCallback(t),
            this._registerTargetFoundInAnimationCallback(),
            this._registerAnimations());
            var i = e.getFrameStamp().getSimulationTime();
            return -1 !== this._seekTime && (this._pauseTime = -this._seekTime + this._startTime + i),
            this._seekTime = -1,
            this._pause ? this._pauseTime = i - this._simulationTime + this._startTime : this._simulationTime = this._startTime + (i - this._pauseTime),
            this.updateManager(this._simulationTime * this._timeFactor),
            !0
        },
        updateManager: function(t) {
            this._processStartAnimation(t);
            for (var e = u.ChannelType.Count, i = 0; i < e; i++) {
                var n = this._activeChannelsByTypes[i];
                this._updateChannelsType(t, n, c[i])
            }
            for (var r = 0; r < e; r++) {
                var a = this._targetsByTypes[r];
                this._updateTargetType(a, v[r])
            }
            for (var s = 0, o = this._animationsUpdateCallbackArray.length; s < o; s++) {
                this._animationsUpdateCallbackArray[s].computeChannels()
            }
            this._removeFinishedAnimation(t)
        },
        togglePause: function() {
            this._pause = !this._pause,
            this._pause || (this._seekTime = this._simulationTime)
        },
        getSimulationTime: function() {
            return this._simulationTime
        },
        setSimulationTime: function(t) {
            this._simulationTime = t
        },
        setSeekTime: function(t) {
            this._simulationTime = t,
            this._seekTime = t
        },
        stopAnimation: function(t) {
            for (var e = this._activeAnimationList, i = 0, n = e.length; i < n; ++i)
                if (e[i].name === t)
                    return this._removeActiveChannels(this._instanceAnimations[t]),
                    this._activeAnimations[t] = void 0,
                    void e.splice(i, 1)
        },
        stopAllAnimation: function() {
            for (var t = this._activeAnimationList, e = 0, i = t.length; e < i; ++e) {
                var n = t[e].name;
                this._removeActiveChannels(this._instanceAnimations[n]),
                this._activeAnimations[n] = void 0
            }
            t.length = 0
        },
        setTimeFactor: function(t) {
            var e = t / this._timeFactor;
            this._startTime += (this._simulationTime - this._simulationTime * e) / e,
            this._timeFactor = t,
            this._pause && (this._simulationTime += (this._simulationTime - this._simulationTime * e) / e)
        },
        getTimeFactor: function() {
            return this._timeFactor
        },
        isPlaying: function(t) {
            return !!this._activeAnimations[t]
        },
        playAnimationObject: function(t) {
            var e = this._instanceAnimations[t.name];
            if (!e)
                return void n.info("no animation " + t.name + " found");
            this.isPlaying(t.name) || (e.priority = void 0 === t.priority ? 0 : t.priority,
            e.weight = void 0 === t.weight ? 1 : t.weight,
            e.loop = void 0 === t.loop || t.loop,
            this._startAnimations[e.name] = e)
        },
        playAnimation: function(t, e, i, n) {
            var r;
            return r = "object" == typeof t ? t : {
                name: t,
                priority: i,
                weight: n,
                loop: e
            },
            this.playAnimationObject(r)
        },
        getAnimations: function() {
            return this._instanceAnimations
        },
        _registerAnimations: function() {
            if (this._targets.length) {
                for (var t = 0, e = this._animationsToRegister.length; t < e; t++) {
                    var i = this._animationsToRegister[t];
                    this._registerInstanceAnimation(i)
                }
                this._animationsToRegister.length = 0,
                this._dirty = !1
            }
        },
        _registerInstanceAnimation: function(t) {
            for (var e = t.channels, i = 0, r = e.length; i < r; i++) {
                var a = e[i]
                  , s = a.channel.target
                  , o = a.channel.name
                  , l = s + "." + o;
                this._targetMap[l] ? a.targetID = this._targetMap[l].id : n.warn("registerInstanceAnimation did not find targetName (" + l + ") in the scene graph")
            }
            return !0
        },
        _findAnimationUpdateCallback: function(t) {
            var e = new d;
            t.accept(e),
            this._animationsUpdateCallback = e.getAnimationUpdateCallbackMap()
        },
        _registerTargetFoundInAnimationCallback: function() {
            this._resetTargets();
            var t, e, i, r = 0, a = this._targetMap, s = this._targets, o = function(t, e, i) {
                if (a[t])
                    e !== a[t] && n.warn("detected differents target instance with the same name (" + i + ")");
                else {
                    a[t] = e,
                    e.id = r++,
                    s.push(e);
                    var o = e.type;
                    this._targetsByTypes[o].push(e)
                }
            }
            .bind(this);
            for (var l in this._animationsUpdateCallback) {
                var u = this._animationsUpdateCallback[l];
                if (u.getStackedTransforms && u.getStackedTransforms().length) {
                    this._animationsUpdateCallbackArray.push(u);
                    for (var h = u.getStackedTransforms(), c = 0, d = h.length; c < d; c++) {
                        var p = h[c];
                        t = p.getTarget(),
                        e = p.getName(),
                        i = u.getName() + "." + e,
                        o(i, t, e)
                    }
                } else if (u instanceof f)
                    for (var g = 0, m = u.getNumTarget(); g < m; g++)
                        e = u.getTargetName(g),
                        i = e + "." + g,
                        t = u.getTarget(g),
                        o(i, t, e)
            }
        },
        _addAnimation: function(t) {
            for (var e = [], i = 0, n = t.length; i < n; i++) {
                var r = t[i]
                  , a = r.name;
                if (!this._instanceAnimations[a]) {
                    var s = h.createInstanceAnimation(r);
                    this._instanceAnimations[a] = s,
                    e.push(s)
                }
            }
            return e
        },
        _addActiveChannels: function(t, e) {
            for (var i = e.channels, n = 0, r = i.length; n < r; n++) {
                var a = i[n]
                  , s = a.channel.type;
                a.t = t,
                a.instanceAnimation = e;
                var o = a.targetID;
                o !== p.InvalidTargetID && (this._activeChannelsByTypes[s].push(a),
                this._targets[o].channels.push(a))
            }
        },
        _removeActiveChannels: function(t) {
            for (var e = t.channels, i = 0, n = e.length; i < n; i++) {
                var r = e[i]
                  , a = r.channel.type
                  , s = r.targetID;
                if (s !== p.InvalidTargetID) {
                    var o = this._targets[s].channels
                      , l = o.indexOf(r);
                    o.splice(l, 1);
                    var u = this._activeChannelsByTypes[a]
                      , h = u.indexOf(r);
                    u.splice(h, 1)
                }
            }
        },
        _updateTargetType: function(t, e) {
            for (var i = 0, n = t.length; i < n; i++) {
                var r = t[i]
                  , a = r.channels
                  , s = a.length;
                if (0 === s)
                    r.value = e.copy(r.defaultValue, r.value);
                else if (1 === s)
                    r.value = e.copy(a[0].value, r.value);
                else {
                    r.value = e.init(r.value);
                    for (var o = 0, l = 0, u = a.length; l < u; l++) {
                        var h = a[l]
                          , c = h.weight;
                        if (0 !== (o += c) && 0 !== c) {
                            var d = c / o;
                            r.value = e.lerp(r.value, r.value, h.value, d)
                        }
                    }
                }
            }
        },
        _updateChannelsType: function(t, e, i) {
            for (var n = 0, r = e.length; n < r; n++) {
                var a = e[n]
                  , s = a.instanceAnimation
                  , o = s.loop
                  , l = t - a.t;
                o && s.duration > 0 && (l %= s.duration),
                i(l + s.firstKeyTime, a)
            }
        },
        _removeFinishedAnimation: function(t) {
            for (var e = this._activeAnimationList, i = 0; i < e.length; ) {
                var n = e[i]
                  , r = n.name;
                t > n.end && !1 === n.loop ? (this._removeActiveChannels(n),
                this._activeAnimations[r] = void 0,
                e.splice(i, 1)) : i++
            }
        },
        _addActiveAnimation: function(t, e) {
            this._activeAnimations[e.name] = e;
            var i = this._instanceAnimations[e.name];
            i.start = t,
            i.end = t + i.duration,
            this._addActiveChannels(t, i),
            this._activeAnimationList.push(i)
        },
        _processStartAnimation: function(t) {
            if (this._targets.length) {
                var e;
                for (e in this._startAnimations) {
                    var i = this._startAnimations[e]
                      , n = i.name;
                    this.isPlaying(n) || this._addActiveAnimation(t, i)
                }
                void 0 !== e && (this._startAnimations = {})
            }
        },
        _resetTargets: function() {
            this._targetMap = {},
            this._targets.length = 0;
            for (var t = 0, e = this._targetsByTypes.length; t < e; t++)
                this._targetsByTypes[t].length = 0
        },
        resetAllStackedTransforms: function() {
            for (var t = this._animationsUpdateCallbackArray, e = 0, i = t.length; e < i; e++) {
                for (var n = t[e].getStackedTransforms(), r = 0, a = n.length; r < a; r++)
                    n[r].resetToDefaultValue();
                t[e].computeChannels()
            }
        },
        setAnimationLerpEndStart: function(t, e) {
            var i = t.channels;
            void 0 === t.originalDuration && (t.originalDuration = t.duration),
            t.duration = t.originalDuration + e;
            for (var n = t.firstKeyTime, r = t.originalDuration, a = 0, s = i.length; a < s; ++a) {
                var o = i[a].channel;
                if (!(Math.abs(o.start - n) > .01 || Math.abs(o.duration - r) > .01)) {
                    void 0 === o.originalEnd && (o.originalEnd = o.end),
                    o.end = o.originalEnd + e;
                    var l = m[o.type]
                      , u = o.times.buffer.byteLength / 4;
                    if (0 === e)
                        o.keys = new Float32Array(o.keys.buffer,0,(u - 1) * l),
                        o.times = new Float32Array(o.times.buffer,0,u - 1);
                    else {
                        o.keys = new Float32Array(o.keys.buffer,0,u * l);
                        for (var h = (u - 1) * l, c = 0; c < l; ++c)
                            o.keys[h + c] = o.keys[c];
                        o.times = new Float32Array(o.times.buffer,0,u),
                        o.times[u - 1] = o.times[u - 2] + e
                    }
                }
            }
        }
    }),
    _.TypeToSize = m,
    t.exports = _
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(65)
      , a = i(434)
      , s = function() {
        r.call(this),
        this._animationUpdateCallback = {}
    };
    s.prototype = n.objectInherit(r.prototype, {
        getAnimationUpdateCallbackMap: function() {
            return this._animationUpdateCallback
        },
        apply: function(t) {
            for (var e = t.getUpdateCallbackList(), i = 0, n = e.length; i < n; i++) {
                var r = e[i];
                r instanceof a && (this._animationUpdateCallback[r.getInstanceID()] = r)
            }
            this.traverse(t)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = i(81)
      , s = function(t, e) {
        r.call(this),
        this._nbTarget = t,
        this._enable = !e,
        this._targetNames = {},
        this._hashNames = "",
        this._hash = ""
    };
    s.uniforms = {},
    s.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Morph",
        cloneType: function() {
            return new s(void 0,!0)
        },
        hasTarget: function(t) {
            return !!this._targetNames[t]
        },
        copyTargetNames: function(t) {
            for (var e = this._targetNames, i = "", n = e.length = t.length, r = 0; r < n; ++r) {
                var a = t[r];
                e[a] = !0,
                i += a
            }
            this._hashNames = i,
            this._hash = ""
        },
        getOrCreateUniforms: function() {
            var t = s
              , e = this.getNumTargets();
            return t.uniforms[e] ? t.uniforms[e] : (t.uniforms[e] = {
                uTargetWeights: a.createFloat4("uTargetWeights")
            },
            t.uniforms[e])
        },
        setNumTargets: function(t) {
            this._nbTarget = t,
            this._hash = ""
        },
        getNumTargets: function() {
            return this._nbTarget
        },
        setTargetWeights: function(t) {
            this._targetWeights = t
        },
        getTargetWeights: function() {
            return this._targetWeights
        },
        isEnabled: function() {
            return this._enable
        },
        getHash: function() {
            return this._hash || (this._hash = this.getTypeMember() + this._hashNames + this.getNumTargets() + this.isEnabled()),
            this._hash
        },
        apply: function() {
            if (this._enable) {
                this.getOrCreateUniforms().uTargetWeights.setFloat4(this._targetWeights)
            }
        }
    }), "osgAnimation", "MorphAttribute"),
    n.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = i(81)
      , s = function(t, e) {
        r.call(this),
        this._enable = !t,
        this._boneUniformSize = e
    };
    s.uniforms = {},
    s.maxBoneUniformSize = 1,
    s.maxBoneUniformAllowed = 1 / 0,
    s.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Skinning",
        cloneType: function() {
            return new s(!0)
        },
        getBoneUniformSize: function() {
            return void 0 !== this._boneUniformSize ? this._boneUniformSize : s.maxBoneUniformSize
        },
        getOrCreateUniforms: function() {
            var t = s
              , e = this.getBoneUniformSize();
            return t.uniforms[e] ? t.uniforms[e] : (t.uniforms[e] = {
                uBones: a.createFloat4Array("uBones", e)
            },
            t.uniforms[e])
        },
        setMatrixPalette: function(t) {
            this._matrixPalette = t,
            void 0 === this._boneUniformSize && (s.maxBoneUniformSize = Math.max(s.maxBoneUniformSize, t.length / 4),
            s.maxBoneUniformSize = Math.min(s.maxBoneUniformAllowed, s.maxBoneUniformSize))
        },
        getMatrixPalette: function() {
            return this._matrixPalette
        },
        isEnabled: function() {
            return this._enable
        },
        getHash: function() {
            return this.getTypeMember() + this.getBoneUniformSize() + this.isEnabled()
        },
        apply: function() {
            this._enable && this.getOrCreateUniforms().uBones.getInternalArray().set(this._matrixPalette)
        }
    }), "osgAnimation", "SkinningAttribute"),
    n.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(85)
      , a = i(5).mat4
      , s = i(354)
      , o = function(t, e) {
        r.call(this),
        this._target = s.createMatrixTarget(e || a.IDENTITY),
        t && this.setName(t)
    };
    o.prototype = n.objectInherit(r.prototype, {
        init: function(t) {
            this.setMatrix(t),
            a.copy(this._target.defaultValue, t)
        },
        getTarget: function() {
            return this._target
        },
        getMatrix: function() {
            return this._target.value
        },
        setMatrix: function(t) {
            a.copy(this._target.value, t)
        },
        resetToDefaultValue: function() {
            this.setMatrix(this._target.defaultValue)
        },
        applyToMatrix: function(t) {
            a.mul(t, t, this._target.value)
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(85)
      , a = i(5).mat4
      , s = i(5).quat
      , o = i(354)
      , l = s.create()
      , u = function(t, e) {
        r.call(this),
        this._target = o.createQuatTarget(e || l),
        t && this.setName(t)
    };
    u.prototype = n.objectInherit(r.prototype, {
        init: function(t) {
            this.setQuaternion(t),
            s.copy(this._target.defaultValue, t)
        },
        setQuaternion: function(t) {
            s.copy(this._target.value, t)
        },
        getTarget: function() {
            return this._target
        },
        resetToDefaultValue: function() {
            this.setQuaternion(this._target.defaultValue)
        },
        applyToMatrix: function() {
            var t = a.create();
            return function(e) {
                var i = t;
                a.fromQuat(i, this._target.value),
                a.mul(e, e, i)
            }
        }()
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(85)
      , a = i(5).vec3
      , s = i(5).mat4
      , o = i(354)
      , l = function(t, e) {
        r.call(this),
        this._target = o.createVec3Target(e || a.ZERO),
        t && this.setName(t)
    };
    l.prototype = n.objectInherit(r.prototype, {
        init: function(t) {
            this.setTranslate(t),
            a.copy(this._target.defaultValue, t)
        },
        setTranslate: function(t) {
            a.copy(this._target.value, t)
        },
        getTarget: function() {
            return this._target
        },
        resetToDefaultValue: function() {
            this.setTranslate(this._target.defaultValue)
        },
        applyToMatrix: function(t) {
            s.translate(t, t, this._target.value)
        }
    }),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(414)
      , a = i(65)
      , s = i(28)
      , o = i(85)
      , l = function() {
        a.call(this)
    };
    l.prototype = n.objectInherit(a.prototype, {
        apply: function(t) {
            if (t.getTypeID() === r.getTypeID()) {
                for (var e = !1, i = t.getChildren(), n = 0, a = t.getChildren().length; n < a; n++) {
                    if (i[n].getTypeID() === r.getTypeID()) {
                        if (e)
                            return void s.warn("Warning: a Bone was found after a non-Bone child within a Skeleton. Children of a Bone must be ordered with all child Bones first for correct update order.")
                    } else
                        e = !0
                }
                this.traverse(t)
            }
        }
    });
    var u = function(t, e) {
        return (t instanceof r ? 0 : 1) - (e instanceof r ? 0 : 1)
    }
      , h = function() {
        this._needValidate = !0
    };
    h.prototype = n.objectInherit(o.prototype, {
        needToValidate: function() {
            return this._needValidate
        },
        update: function(t, e) {
            if (this._needValidate && e.getVisitorType() === a.UPDATE_VISITOR && t.className && "Skeleton" === t.className()) {
                for (var i = new l, n = t.getChildren(), r = 0, s = n.length; r < s; r++) {
                    n[r].accept(i)
                }
                n.sort(u),
                this._needValidate = !1
            }
            return !0
        }
    }),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    t.exports = {
        Vec3: 0,
        Quat: 1,
        Float: 2,
        FloatCubicBezier: 3,
        Vec3CubicBezier: 4,
        QuatSlerp: 5,
        Matrix: 6,
        Count: 7
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(5).vec3
      , r = i(5).quat
      , a = i(416)
      , s = function(t, e, i) {
        i[0] = e[t++],
        i[1] = e[t++],
        i[2] = e[t++]
    }
      , o = function(t, e, i) {
        i[0] = e[t++],
        i[1] = e[t++],
        i[2] = e[t++],
        i[3] = e[t++]
    }
      , l = function(t, e) {
        var i = e.channel
          , n = e.value
          , r = i.start
          , a = i.end
          , o = i.keys
          , l = i.times;
        if (t >= a)
            return e.key = 0,
            void s(o.length - 3, o, n);
        if (t <= r)
            return e.key = 0,
            void s(0, o, n);
        var u = e.key;
        if (t > l[u])
            for (; l[u + 1] < t; )
                u++;
        else if (t < l[u])
            for (; l[u] > t; )
                u--;
        var h = l[u]
          , c = l[u + 1]
          , d = 3 * u
          , p = o[d++]
          , f = o[d++]
          , g = o[d++]
          , m = o[d++]
          , v = o[d++]
          , _ = o[d++]
          , b = (t - h) / (c - h);
        n[0] = p + (m - p) * b,
        n[1] = f + (v - f) * b,
        n[2] = g + (_ - g) * b,
        e.key = u
    }
      , u = function() {
        var t = r.create32()
          , e = r.create32();
        return function(i, n) {
            var a = n.channel
              , s = n.value
              , l = a.start
              , u = a.end
              , h = a.keys
              , c = a.times;
            if (i >= u)
                return n.key = 0,
                void o(h.length - 4, h, s);
            if (i <= l)
                return n.key = 0,
                void o(0, h, s);
            var d = n.key;
            if (i > c[d])
                for (; c[d + 1] < i; )
                    d++;
            else if (i < c[d])
                for (; c[d] > i; )
                    d--;
            var p = c[d]
              , f = c[d + 1]
              , g = 4 * d;
            t[0] = h[g++],
            t[1] = h[g++],
            t[2] = h[g++],
            t[3] = h[g++],
            e[0] = h[g++],
            e[1] = h[g++],
            e[2] = h[g++],
            e[3] = h[g++];
            var m = (i - p) / (f - p);
            r.nlerp(s, t, e, m),
            n.key = d
        }
    }()
      , h = function() {
        var t = r.create32()
          , e = r.create32();
        return function(i, n) {
            var a = n.channel
              , s = n.value
              , l = a.start
              , u = a.end
              , h = a.keys
              , c = a.times;
            if (i >= u)
                return n.key = 0,
                void o(h.length - 4, h, s);
            if (i <= l)
                return n.key = 0,
                void o(0, h, s);
            var d = n.key;
            if (i > c[d])
                for (; c[d + 1] < i; )
                    d++;
            else if (i < c[d])
                for (; c[d] > i; )
                    d--;
            var p = c[d]
              , f = c[d + 1]
              , g = 4 * d;
            t[0] = h[g++],
            t[1] = h[g++],
            t[2] = h[g++],
            t[3] = h[g++],
            e[0] = h[g++],
            e[1] = h[g++],
            e[2] = h[g++],
            e[3] = h[g++];
            var m = (i - p) / (f - p);
            r.slerp(s, t, e, m),
            n.key = d
        }
    }()
      , c = function(t, e) {
        var i = e.channel
          , n = e.value
          , r = i.start
          , a = i.end
          , s = i.keys
          , o = i.times;
        if (t >= a)
            return e.key = 0,
            void (e.value = s[s.length - 1]);
        if (t <= r)
            return e.key = 0,
            void (e.value = s[0]);
        var l = e.key;
        if (t > o[l])
            for (; o[l + 1] < t; )
                l++;
        else if (t < o[l])
            for (; o[l] > t; )
                l--;
        var u = o[l]
          , h = o[l + 1]
          , c = l
          , d = s[c++];
        n = d + (s[c++] - d) * ((t - u) / (h - u)),
        e.key = l,
        e.value = n
    }
      , d = function(t, e) {
        var i = e.channel
          , n = e.value
          , r = i.start
          , a = i.end
          , s = i.keys
          , o = i.times;
        if (t >= a)
            return e.key = 0,
            void (e.value = s[s.length - 3]);
        if (t <= r)
            return e.key = 0,
            void (e.value = s[0]);
        var l = e.key;
        if (t > o[l])
            for (; o[l + 1] < t; )
                l++;
        else if (t < o[l])
            for (; o[l] > t; )
                l--;
        var u = (t - o[l]) / (o[l + 1] - o[l])
          , h = 1 - u
          , c = h * h
          , d = c * h
          , p = u * u
          , f = 3 * l;
        n = s[f] * d + s[f + 1] * (3 * u * c) + s[f + 2] * (3 * p * h) + s[f + 3] * (p * u),
        e.key = l,
        e.value = n
    }
      , p = function() {
        var t = n.create()
          , e = n.create()
          , i = n.create()
          , r = n.create();
        return function(a, o) {
            var l = o.channel
              , u = o.value
              , h = l.start
              , c = l.end
              , d = l.keys
              , p = l.times;
            if (a >= c)
                return o.key = 0,
                void s(d.length - 9, d, u);
            if (a <= h)
                return o.key = 0,
                void s(0, d, u);
            var f = o.key;
            if (a > p[f])
                for (; p[f + 1] < a; )
                    f++;
            else if (a < p[f])
                for (; p[f] > a; )
                    f--;
            var g = (a - p[f]) / (p[f + 1] - p[f])
              , m = 1 - g
              , v = m * m
              , _ = v * m
              , b = g * g
              , x = 9 * f;
            n.scale(t, n.set(t, d[x++], d[x++], d[x++]), _),
            n.scale(e, n.set(e, d[x++], d[x++], d[x++]), 3 * g * v),
            n.scale(i, n.set(i, d[x++], d[x++], d[x++]), 3 * b * m),
            n.scale(r, n.set(r, d[x++], d[x++], d[x++]), b * g),
            u[0] = t[0] + e[0] + i[0] + r[0],
            u[1] = t[1] + e[1] + i[1] + r[1],
            u[2] = t[2] + e[2] + i[2] + r[2],
            o.key = f
        }
    }()
      , f = a.ChannelType
      , g = {};
    g[f.Vec3] = l,
    g[f.Quat] = u,
    g[f.QuatSlerp] = h,
    g[f.Float] = c,
    g[f.FloatCubicBezier] = d,
    g[f.Vec3CubicBezier] = p,
    g.Vec3LerpInterpolator = l,
    g.QuatLerpInterpolator = u,
    g.QuatSlerpInterpolator = h,
    g.FloatLerpInterpolator = c,
    g.FloatCubicBezierInterpolator = d,
    g.Vec3CubicBezierInterpolator = p,
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i(13)
      , a = i(65)
      , s = i(521)
      , o = i(324)
      , l = function() {
        this._pendingRequests = [],
        this._pendingNodes = [],
        this._loading = !1,
        this._progressCallback = void 0,
        this._lastCB = !0,
        this._activePagedLODList = new Set,
        this._childrenToRemoveList = new Set,
        this._downloadingRequestsNumber = 0,
        this._maxRequestsPerFrame = 10,
        this._acceptNewRequests = !0,
        this._targetMaximumNumberOfPagedLOD = 75
    }
      , u = function() {
        this._loadedModel = void 0,
        this._group = void 0,
        this._url = void 0,
        this._function = void 0,
        this._timeStamp = 0,
        this._groupExpired = !1,
        this._priority = 0
    }
      , h = function(t, e) {
        a.call(this, a.TRAVERSE_ALL_CHILDREN),
        this._activePagedLODList = t,
        this._frameNumber = e
    };
    h.prototype = r.objectInherit(a.prototype, {
        apply: function(t) {
            t.getTypeID() === s.getTypeID() && (t.setFrameNumberOfLastTraversal(this._frameNumber),
            this._activePagedLODList.add(t)),
            this.traverse(t)
        }
    });
    var c = function() {
        a.call(this, a.TRAVERSE_ALL_CHILDREN)
    };
    c.prototype = r.objectInherit(a.prototype, {
        apply: function(t) {
            t.releaseGLObjects(),
            this.traverse(t)
        }
    });
    var d = function() {
        a.call(this, a.TRAVERSE_ALL_CHILDREN),
        this._childrenList = []
    };
    d.prototype = r.objectInherit(a.prototype, {
        apply: function(t) {
            t.getTypeID() === s.getTypeID() && (this._childrenList.push(t),
            this._markRequestsExpired(t)),
            this.traverse(t)
        },
        removeExpiredChildrenAndFindPagedLODs: function(t, e, i, n) {
            if (!t.children.length)
                return !1;
            var r = n.length;
            t.removeExpiredChildren(e, i, n);
            for (var a = r; a < n.length; a++)
                n[a].accept(this);
            return r !== n.length
        },
        _markRequestsExpired: function(t) {
            for (var e, i = t._perRangeDataList.length, n = 0; n < i; n++)
                void 0 !== (e = t.getDatabaseRequest(n)) && (e._groupExpired = !0,
                e._loadedModel = null)
        }
    }),
    l.prototype = r.objectLibraryClass({
        setTargetMaximumNumberOfPageLOD: function(t) {
            this._targetMaximumNumberOfPagedLOD = t
        },
        getTargetMaximumNumberOfPageLOD: function() {
            return this._targetMaximumNumberOfPagedLOD
        },
        setAcceptNewDatabaseRequests: function(t) {
            this._acceptNewRequests = t
        },
        getAcceptNewDatabaseRequests: function() {
            return this._acceptNewRequests
        },
        reset: function() {
            this._pendingRequests = [],
            this._pendingNodes = [],
            this._loading = !1,
            this._lastCB = !0,
            this._activePagedLODList.clear(),
            this._childrenToRemoveList.clear(),
            this._downloadingRequestsNumber = 0,
            this._maxRequestsPerFrame = 10,
            this._acceptNewRequests = !0,
            this._targetMaximumNumberOfPagedLOD = 75
        },
        updateSceneGraph: function(t) {
            void 0 !== this._progressCallback && this.executeProgressCallback(),
            this.removeExpiredSubgraphs(t, .0025),
            this.takeRequests(),
            this.addLoadedDataToSceneGraph(t, .005)
        },
        executeProgressCallback: function() {
            this._pendingRequests.length > 0 || this._pendingNodes.length > 0 ? (this._progressCallback(this._pendingRequests.length + this._downloadingRequestsNumber, this._pendingNodes.length),
            this._lastCB = !1) : this._lastCB || (this._progressCallback(this._pendingRequests.length + this._downloadingRequestsNumber, this._pendingNodes.length),
            this._lastCB = !0)
        },
        setMaxRequestsPerFrame: function(t) {
            this._maxRequestsPerFrame = t
        },
        getMaxRequestsPerFrame: function() {
            return this._maxRequestsPerFrame
        },
        getRequestListSize: function() {
            return this._pendingRequests.length + this._downloadingRequestsNumber
        },
        setProgressCallback: function(t) {
            this._progressCallback = t
        },
        addLoadedDataToSceneGraph: function(t, e) {
            if (e <= 0)
                return 0;
            var i = 0
              , n = o.instance().tick();
            this._pendingNodes.sort(function(t, e) {
                return e._timeStamp - t._timeStamp
            });
            for (var r = 0; r < this._pendingNodes.length; r++) {
                if (i > e)
                    return 0;
                var a = this._pendingNodes.shift()
                  , s = t.getFrameNumber()
                  , l = t.getSimulationTime();
                if (!1 === a._groupExpired) {
                    var u = a._group;
                    u.setTimeStamp(u.children.length, l),
                    u.setFrameNumber(u.children.length, s),
                    u.addChildNode(a._loadedModel),
                    this._activePagedLODList.has(u) ? this.registerPagedLODs(a._loadedModel, s) : this.registerPagedLODs(u, s)
                } else
                    a._loadedModel = void 0,
                    a = void 0;
                i = o.instance().deltaS(n, o.instance().tick())
            }
            return e -= i
        },
        isLoading: function() {
            return this._loading
        },
        registerPagedLODs: function(t, e) {
            t && t.accept(new h(this._activePagedLODList,e))
        },
        requestNodeFile: function(t, e, i, n, r) {
            if (this._acceptNewRequests) {
                var a = new u;
                return a._group = i,
                a._function = t,
                a._url = e,
                a._timeStamp = n,
                a._priority = r,
                this._pendingRequests.push(a),
                a
            }
        },
        takeRequests: function() {
            if (this._pendingRequests.length) {
                var t = Math.min(this._maxRequestsPerFrame, this._pendingRequests.length);
                this._pendingRequests.sort(function(t, e) {
                    var i = t._timeStamp - e._timeStamp;
                    return 0 === i && (i = t._priority - e._priority),
                    i
                });
                for (var e = 0; e < t; e++)
                    this._downloadingRequestsNumber++,
                    this.processRequest(this._pendingRequests.shift())
            }
        },
        processRequest: function(t) {
            this._loading = !0;
            var e = this;
            if (t._groupExpired)
                return e._downloadingRequestsNumber--,
                void (this._loading = !1);
            void 0 !== t._function ? this.loadNodeFromFunction(t._function, t._group).then(function(i) {
                e._downloadingRequestsNumber--,
                t._loadedModel = i,
                e._pendingNodes.push(t),
                e._loading = !1
            }) : "" !== t._url && this.loadNodeFromURL(t._url).then(function(i) {
                e._downloadingRequestsNumber--,
                t._loadedModel = i,
                e._pendingNodes.push(t),
                e._loading = !1
            })
        },
        loadNodeFromFunction: function(t, e) {
            var i = t(e);
            return i ? i && i.then ? i : n.resolve(i) : n.reject()
        },
        loadNodeFromURL: function(t) {
            return i(382).readNodeURL(t)
        },
        releaseGLExpiredSubgraphs: function(t) {
            if (t <= 0)
                return 0;
            var e = 0
              , i = o.instance().tick()
              , n = this;
            return this._childrenToRemoveList.forEach(function(r) {
                e > t || (n._childrenToRemoveList.delete(r),
                r.accept(new c),
                r.removeChildren(),
                r = null,
                e = o.instance().deltaS(i, o.instance().tick()))
            }),
            t -= e
        },
        removeExpiredSubgraphs: function(t, e) {
            if (0 === t.getFrameNumber())
                return 0;
            var i = this._activePagedLODList.size - this._targetMaximumNumberOfPagedLOD
              , n = t.getSimulationTime() - .1
              , r = t.getFrameNumber() - 1;
            return i > 0 && (e = this.removeExpiredChildren(i, n, r, e)),
            e
        },
        removeExpiredChildren: function(t, e, i, n) {
            var r = 0
              , a = o.instance().tick()
              , s = this
              , l = []
              , u = new d;
            return this._activePagedLODList.forEach(function(h) {
                if (r > n)
                    return 0;
                if (t < 0)
                    return n;
                if (i < h.getFrameNumberOfLastTraversal())
                    return n;
                u.removeExpiredChildrenAndFindPagedLODs(h, e, i, l);
                for (var c = 0; c < u._childrenList.length; c++)
                    s._activePagedLODList.delete(u._childrenList[c]),
                    t--;
                for (c = 0; c < l.length; c++)
                    s._childrenToRemoveList.add(l[c]);
                u._childrenList.length = 0,
                l.length = 0,
                r = o.instance().deltaS(a, o.instance().tick())
            }),
            n -= r
        }
    }, "osgDB", "DatabasePager"),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = function(t) {
        this._manipulator = t,
        this._timer = !1,
        this.init()
    };
    r.prototype = {
        init: function() {
            this._panFactorX = 1,
            this._panFactorY = -this._panFactorX,
            this._rotateFactorX = .6,
            this._rotateFactorY = -this._rotateFactorX,
            this._zoomFactor = 5,
            this._lastScale = 0,
            this._nbPointerLast = 0,
            this._lastPos = void 0
        },
        setEventProxy: function(t) {
            if (void 0 !== t && (void 0 === t || t !== this._eventProxy)) {
                this._eventProxy = t;
                var e = this
                  , i = t
                  , r = function(t) {
                    return void 0 !== t.pointers ? t.pointers.length : 1
                }
                  , a = function(t) {
                    return "touches " + r(t) + " distance " + t.distance + " x " + t.deltaX + " y " + t.deltaY
                };
                i.get("pinch").set({
                    threshold: .1
                }),
                i.get("pan").set({
                    threshold: 0,
                    pointers: 0
                }),
                i.get("pinch").recognizeWith(i.get("pan")),
                i.get("tap").set({
                    taps: 2,
                    posThreshold: 300
                }),
                this._cbPanStart = function(t) {
                    var i = e._manipulator;
                    if (i && !e._transformStarted && "mouse" !== t.pointerType) {
                        var s = t;
                        e._dragStarted = !0,
                        e._nbPointerLast = r(s);
                        var o;
                        2 === e._nbPointerLast ? (o = i.getPositionRelativeToCanvas(t.center.x, t.center.y),
                        e._lastPos = o) : o = void 0 === e._lastPos ? i.getCanvasCenter() : e._lastPos,
                        i.computeIntersections(o),
                        2 === e._nbPointerLast ? (i.getPanInterpolator().reset(),
                        i.getPanInterpolator().set(t.center.x * e._panFactorX, t.center.y * e._panFactorY)) : i.getRotateInterpolator().reset(),
                        n.debug("drag start, " + a(s))
                    }
                }
                ,
                this._cbPanMove = function(t) {
                    var i = e._manipulator;
                    if (i && e._dragStarted && "mouse" !== t.pointerType) {
                        var s = t
                          , o = r(s);
                        e._nbPointerLast !== o && (2 === o ? i.getPanInterpolator().reset() : i.getRotateInterpolator().reset(),
                        e._nbPointerLast = o),
                        2 === o ? (i.getPanInterpolator().setTarget(t.center.x * e._panFactorX, t.center.y * e._panFactorY),
                        n.debug("pan, " + a(s))) : (i.getRotateInterpolator().setTarget(t.center.x * e._rotateFactorX, t.center.y * e._rotateFactorY),
                        n.debug("rotate, " + a(s)))
                    }
                }
                ,
                this._cbPanEnd = function(t) {
                    if (e._manipulator && e._dragStarted && "mouse" !== t.pointerType) {
                        e._dragStarted = !1;
                        var i = t;
                        n.debug("drag end, " + a(i))
                    }
                }
                ,
                this._cbPinchStart = function(t) {
                    var i = e._manipulator;
                    if (i && "mouse" !== t.pointerType) {
                        e._transformStarted = !0;
                        var r = t;
                        e._lastScale = r.scale,
                        i.getZoomInterpolator().reset(),
                        i.getZoomInterpolator().set(e._lastScale),
                        t.preventDefault(),
                        n.debug("zoom start, " + a(r))
                    }
                }
                ,
                this._cbPinchEnd = function(t) {
                    "mouse" !== t.pointerType && (e._transformStarted = !1,
                    n.debug("zoom end, " + a(t)))
                }
                ,
                this._cbPinchInOut = function(t) {
                    var i = e._manipulator;
                    if (i && e._transformStarted && "mouse" !== t.pointerType) {
                        var r = t
                          , s = r.scale > e._lastScale ? e._zoomFactor : 4 * e._zoomFactor
                          , o = (r.scale - e._lastScale) * s;
                        e._lastScale = r.scale,
                        i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0] - o),
                        n.debug("zoom, " + a(r))
                    }
                }
                ,
                this._cbDoubleTap = function(t) {
                    var i = e._manipulator;
                    if (i && "mouse" !== t.pointerType) {
                        var r = t
                          , s = i.getPositionRelativeToCanvas(t.center.x, t.center.y);
                        e._lastPos = s,
                        i.getZoomInterpolator().set(0);
                        var o = i.getZoomInterpolator().getTarget()[0] - 10;
                        i.getZoomInterpolator().setTarget(o),
                        n.debug("tap, " + a(r))
                    }
                }
                ,
                i.on("panstart ", this._cbPanStart),
                i.on("panmove", this._cbPanMove),
                i.on("panend", this._cbPanEnd),
                i.on("pinchstart", this._cbPinchStart),
                i.on("pinchend", this._cbPinchEnd),
                i.on("pinchin pinchout", this._cbPinchInOut),
                i.on("tap", this._cbDoubleTap)
            }
        },
        removeEventProxy: function(t) {
            t && this._eventProxy && (t.off("panstart ", this._cbPanStart),
            t.off("panmove", this._cbPanMove),
            t.off("panend", this._cbPanEnd),
            t.off("pinchstart", this._cbPinchStart),
            t.off("pinchend", this._cbPinchEnd),
            t.off("pinchin pinchout", this._cbPinchInOut),
            t.off("tap", this._cbDoubleTap))
        },
        setManipulator: function(t) {
            this._manipulator = t
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(531)
      , r = function(t) {
        this._manipulator = t,
        this._timer = !1,
        this.init()
    };
    r.prototype = {
        init: function() {
            this.releaseButton(),
            this._rotateKey = 65,
            this._zoomKey = 83,
            this._panKey = 68,
            this._mode = void 0
        },
        getMode: function() {
            return this._mode
        },
        setMode: function(t) {
            this._mode = t
        },
        setEventProxy: function(t) {
            this._eventProxy = t
        },
        setManipulator: function(t) {
            this._manipulator = t
        },
        setDimensionMask: function(t) {
            this._dimensionMask = t
        },
        mousemove: function(t) {
            if (!0 !== this._buttonup) {
                var e = this._manipulator
                  , i = e.getPositionRelativeToCanvas(t.clientX, t.clientY);
                if (!1 === isNaN(i[0]) && !1 === isNaN(i[1])) {
                    var r = this.getMode();
                    if (r === n.Rotate)
                        e.getRotateInterpolator().setTarget(i[0], i[1]);
                    else if (r === n.Pan)
                        e.getPanInterpolator().setTarget(i[0], i[1]);
                    else if (r === n.Zoom) {
                        var a = e.getZoomInterpolator();
                        e.computeIntersections(i),
                        a.isReset() && (a.setStart(i[1]),
                        a.set(0));
                        var s = i[1] - a.getStart();
                        a.setStart(i[1]);
                        var o = a.getTarget()[0];
                        a.setTarget(o - s / 20)
                    }
                }
                t.preventDefault()
            }
        },
        mousedown: function(t) {
            var e = this._manipulator
              , i = this.getMode();
            void 0 === i && (0 === t.button ? t.shiftKey ? this.setMode(n.Pan) : t.ctrlKey ? this.setMode(n.Zoom) : this.setMode(n.Rotate) : this.setMode(n.Pan)),
            this.pushButton();
            var r = e.getPositionRelativeToCanvas(t.clientX, t.clientY);
            e.computeIntersections(r),
            i = this.getMode(),
            i === n.Rotate ? (e.getRotateInterpolator().reset(),
            e.getRotateInterpolator().set(r[0], r[1])) : i === n.Pan ? (e.getPanInterpolator().reset(),
            e.getPanInterpolator().set(r[0], r[1])) : i === n.Zoom && (e.getZoomInterpolator().setStart(r[1]),
            e.getZoomInterpolator().set(0))
        },
        mouseup: function() {
            this.releaseButton(),
            this.setMode(void 0)
        },
        mousewheel: function(t, e) {
            var i = this._manipulator
              , n = i.getZoomInterpolator().getTarget()[0] - e;
            i.getZoomInterpolator().setTarget(n);
            var r;
            if (!1 === this._timer) {
                this._timer = !0;
                var a = this;
                clearTimeout(r),
                r = setTimeout(function() {
                    a._timer = !1
                }, 200);
                var s = i.getPositionRelativeToCanvas(t.clientX, t.clientY);
                i.computeIntersections(s)
            }
        },
        dblclick: function(t) {
            var e = this._manipulator;
            t.preventDefault(),
            e.getZoomInterpolator().set(0);
            var i = e.getZoomInterpolator().getTarget()[0] - 10;
            e.getZoomInterpolator().setTarget(i);
            var n = e.getPositionRelativeToCanvas(t.clientX, t.clientY);
            e.computeIntersections(n)
        },
        pushButton: function() {
            this._buttonup = !1
        },
        releaseButton: function() {
            this._buttonup = !0
        },
        keydown: function(t) {
            32 === t.keyCode ? (this._manipulator.computeHomePosition(),
            t.preventDefault()) : t.keyCode === this._panKey && this.getMode() !== n.Pan ? (this.setMode(n.Pan),
            this._manipulator.getPanInterpolator().reset(),
            this.pushButton(),
            t.preventDefault()) : t.keyCode === this._zoomKey && this.getMode() !== n.Zoom ? (this.setMode(n.Zoom),
            this._manipulator.getZoomInterpolator().reset(),
            this.pushButton(),
            t.preventDefault()) : t.keyCode === this._rotateKey && this.getMode() !== n.Rotate && (this.setMode(n.Rotate),
            this._manipulator.getRotateInterpolator().reset(),
            this.pushButton(),
            t.preventDefault())
        },
        keyup: function(t) {
            t.keyCode === this._panKey ? this.mouseup(t) : t.keyCode === this._rotateKey ? this.mouseup(t) : t.keyCode === this._rotateKey && this.mouseup(t),
            this.setMode(void 0)
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(532);
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = function(t) {
        this._manipulator = t,
        this.init()
    };
    n.prototype = {
        init: function() {
            this.releaseButton(),
            this._delay = .15,
            this._stepFactor = 1
        },
        setEventProxy: function(t) {
            this._eventProxy = t
        },
        setManipulator: function(t) {
            this._manipulator = t,
            this._manipulator.setStepFactor(this._stepFactor)
        },
        pushButton: function() {
            this._buttonup = !1
        },
        releaseButton: function() {
            this._buttonup = !0
        },
        mousedown: function(t) {
            var e = this._eventProxy.getPositionRelativeToCanvas(t);
            this._manipulator.getLookPositionInterpolator().set(e[0], e[1]),
            this.pushButton()
        },
        mouseup: function() {
            this.releaseButton()
        },
        mouseout: function() {
            this.releaseButton()
        },
        mousemove: function(t) {
            if (!0 !== this._buttonup) {
                var e = this._eventProxy.getPositionRelativeToCanvas(t);
                this._manipulator.getLookPositionInterpolator().setDelay(this._delay),
                this._manipulator.getLookPositionInterpolator().setTarget(e[0], e[1]),
                t.preventDefault()
            }
        },
        mousewheel: function(t, e) {
            this._stepFactor = Math.min(Math.max(.001, this._stepFactor + .01 * e), 4),
            this._manipulator.setStepFactor(this._stepFactor)
        },
        keydown: function(t) {
            var e = this._manipulator;
            if (32 === t.keyCode)
                e.computeHomePosition(),
                t.preventDefault();
            else {
                if (87 === t.keyCode || 90 === t.keyCode || 38 === t.keyCode)
                    return e.getForwardInterpolator().setDelay(this._delay),
                    e.getForwardInterpolator().setTarget(1),
                    t.preventDefault(),
                    !1;
                if (83 === t.keyCode || 40 === t.keyCode)
                    return e.getForwardInterpolator().setDelay(this._delay),
                    e.getForwardInterpolator().setTarget(-1),
                    t.preventDefault(),
                    !1;
                if (68 === t.keyCode || 39 === t.keyCode)
                    return e.getSideInterpolator().setDelay(this._delay),
                    e.getSideInterpolator().setTarget(1),
                    t.preventDefault(),
                    !1;
                if (65 === t.keyCode || 81 === t.keyCode || 37 === t.keyCode)
                    return e.getSideInterpolator().setDelay(this._delay),
                    e.getSideInterpolator().setTarget(-1),
                    t.preventDefault(),
                    !1
            }
        },
        keyup: function(t) {
            var e = this._manipulator;
            return 87 === t.keyCode || 90 === t.keyCode || 38 === t.keyCode || 83 === t.keyCode || 40 === t.keyCode ? (e.getForwardInterpolator().setDelay(this._delay),
            e.getForwardInterpolator().setTarget(0),
            !1) : 68 === t.keyCode || 39 === t.keyCode || 65 === t.keyCode || 81 === t.keyCode || 37 === t.keyCode ? (e.getSideInterpolator().setDelay(this._delay),
            e.getSideInterpolator().setTarget(0),
            !1) : void 0
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = function(t) {
        this._manipulator = t,
        this.init()
    };
    n.prototype = {
        init: function() {},
        update: function(t, e) {
            this._manipulator.setPoseVR(t, e)
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(5).quat
      , r = i(5).vec3
      , a = i(530)
      , s = function(t) {
        this._manipulator = t,
        this.init()
    };
    s.prototype = {
        init: function() {
            this._stepFactor = 1,
            this._quat = n.create(),
            this._pos = r.create()
        },
        update: function(t, e) {
            a.computeQuaternion(this._quat, t, e),
            this._manipulator.setPoseVR(this._quat, this._pos)
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(5).vec2
      , r = function(t) {
        this._manipulator = t,
        this.init()
    };
    r.prototype = {
        init: function() {
            this._delay = .15,
            this._threshold = .08,
            this._mode = 0,
            this._padFactor = 10,
            this._zoomFactor = .5,
            this._rotateFactor = 5
        },
        addPan: function(t, e, i) {
            t.setDelay(this._delay),
            t.addTarget(e * this._padFactor, i * this._padFactor)
        },
        addZoom: function(t, e) {
            t.setDelay(this._delay),
            t.addTarget(e * this._zoomFactor)
        },
        addRotate: function(t, e, i) {
            t.setDelay(this._delay),
            t.addTarget(e * this._rotateFactor, i * this._rotateFactor)
        },
        gamepadaxes: function(t) {
            var e = this._manipulator.getRotateInterpolator()
              , i = this._manipulator.getZoomInterpolator()
              , n = this._manipulator.getPanInterpolator();
            4 === t.length ? ((Math.abs(t[0]) > .005 || Math.abs(t[1]) > .005) && this.addRotate(e, -t[0], t[1]),
            Math.abs(t[3]) > .005 && this.addZoom(i, -t[3])) : t.length >= 5 && ((Math.abs(t[0]) > .005 || Math.abs(t[1]) > .005) && this.addPan(n, -t[0], t[1]),
            Math.abs(t[2]) > .005 && this.addZoom(i, -t[2]),
            (Math.abs(t[3]) > .005 || Math.abs(t[4]) > .005) && this.addRotate(e, t[4], t[3]))
        },
        gamepadbuttondown: function(t) {
            if (t.button >= 12 && t.button <= 15) {
                var e = this._manipulator.getPanInterpolator()
                  , i = e.getTarget()
                  , r = {
                    12: n.fromValues(0, -1),
                    13: n.fromValues(0, 1),
                    14: n.fromValues(-1, 0),
                    15: n.fromValues(1, 0)
                }[t.button];
                e.setDelay(this._delay),
                e.setTarget(i[0] - 10 * r[0], i[1] + 10 * r[1])
            }
        },
        update: function(t) {
            if (t) {
                var e = t.axes
                  , i = t.buttons;
                this.gamepadaxes(e);
                for (var n = function() {}, r = 0; r < i.length; r++)
                    i[r] && this.gamepadbuttondown({
                        preventDefault: n,
                        gamepad: t,
                        button: r
                    }, !!i[r])
            }
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(5).vec3
      , a = i(5).vec2
      , s = function(t) {
        this._manipulator = t,
        this.init()
    }
      , o = {
        rotate: {
            dtx: -1.44,
            dty: -1.08,
            dtz: -.1,
            delay: .05,
            method: "getRotateInterpolator"
        },
        pan: {
            dtx: -1.44,
            dty: -1.08,
            delay: .05,
            method: "getPanInterpolator"
        },
        zoom: {
            dtx: 0,
            dty: -.5,
            delay: .05,
            method: "getZoomInterpolator"
        },
        "zoom-twohands": {
            dtx: -.05,
            dty: 0,
            delay: .05,
            method: "getZoomInterpolator"
        }
    };
    s.prototype = {
        init: function() {
            this._virtualCursor = a.fromValues(0, 0),
            this._targetPosition = a.fromValues(0, 0),
            this._previousFrame = void 0,
            this._displacement = a.fromValues(0, 0),
            this._top = a.fromValues(0, 1),
            this._motion = a.fromValues(0, 0),
            this._delay = .05,
            this._threshold = .08,
            this._directionDotThreshold = .5,
            this._mode = "rotate"
        },
        update: function(t) {
            if (this._previousFrame || (this._previousFrame = t),
            0 !== t.fingers.length) {
                var e = this._previousFrame.translation(t);
                if (this._previousFrame = t,
                0 !== t.hands.length && !(Math.abs(e[0]) < this._threshold && Math.abs(e[1]) < this._threshold)) {
                    var i = this._mode
                      , a = 0;
                    if (t.gestures.length > 0)
                        for (var s = 0; s < t.gestures.length; s++) {
                            var l = t.gestures[s];
                            if ("circle" === l.type)
                                return void this._manipulator.computeHomePosition()
                        }
                    if (1 === t.hands.length)
                        t.hands[0].fingers.length >= 3 ? (i = "zoom",
                        a = t.hands[0].palmPosition[1] / 10,
                        a = Math.max(a - 4, .01)) : i = t.hands[0].fingers.length > 1 ? "pan" : "rotate";
                    else if (2 === t.hands.length) {
                        var u = Math.abs(r.dot(t.hands[0].palmNormal, this._top))
                          , h = Math.abs(r.dot(t.hands[1].palmNormal, this._top));
                        u < this._directionDotThreshold && h < this._directionDotThreshold ? i = "zoom-twohands" : (i = void 0,
                        this._handsDistanceOld = void 0)
                    }
                    var c = this._manipulator.getZoomInterpolator();
                    if (void 0 !== i) {
                        if (i !== this._mode)
                            return n.info("Switch to mode " + i),
                            this._motion[0] = 0,
                            this._motion[1] = 0,
                            this._mode = i,
                            void ("zoom" !== i && "zoom-twohands" !== i || c.isReset() && (c.setStart(1),
                            c.set(0)));
                        var d, p, f;
                        d = o[i].dtx,
                        p = o[i].dty,
                        f = o[i].dtz,
                        this._motion[0] += e[0] * d,
                        this._motion[1] += e[1] * p;
                        var g = o[i].delay
                          , m = o[i].method;
                        if (this._manipulator[m]().setDelay(g),
                        "zoom" === i)
                            n.log(a),
                            c.setTarget(a);
                        else if ("zoom-twohands" === i) {
                            var v = r.distance(t.hands[1].palmPosition, t.hands[0].palmPosition);
                            if (void 0 !== this._handsDistanceOld) {
                                var _ = d * (v - this._handsDistanceOld);
                                a = c._target,
                                a[0] += _
                            }
                            this._handsDistanceOld = v
                        } else
                            "rotate" === i && (a = c._target[0],
                            a += e[2] * f,
                            a = Math.max(a, .01),
                            c.setTarget(a)),
                            this._manipulator[m]().addTarget(this._motion[0], this._motion[1]);
                        this._motion[1] = this._motion[0] = 0
                    }
                }
            }
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(379)
      , r = i(638)
      , a = function(t) {
        this._manipulator = t,
        this.init()
    };
    a.prototype = {
        init: function() {
            this.releaseButton(),
            this._rotateKey = 65,
            this._zoomKey = 83,
            this._panKey = 68,
            this._mode = void 0,
            this._delay = .15
        },
        getMode: function() {
            return this._mode
        },
        setMode: function(t) {
            this._mode = t
        },
        setEventProxy: function(t) {
            this._eventProxy = t
        },
        setManipulator: function(t) {
            this._manipulator = t
        },
        mousemove: function(t) {
            if (!0 !== this._buttonup) {
                var e = this._eventProxy.getPositionRelativeToCanvas(t)
                  , i = this._manipulator;
                if (!1 === n.isNaN(e[0]) && !1 === n.isNaN(e[1])) {
                    var a = this.getMode();
                    if (a === r.ROTATE)
                        i.getRotateInterpolator().setDelay(this._delay),
                        i.getRotateInterpolator().setTarget(e[0], e[1]);
                    else if (a === r.PAN)
                        i.getPanInterpolator().setTarget(e[0], e[1]);
                    else if (a === r.ZOOM) {
                        var s = i.getZoomInterpolator();
                        s.isReset() && (s.setStart(e[1]),
                        s.set(0));
                        var o = e[1] - s.getStart();
                        s.setStart(e[1]);
                        var l = s.getTarget()[0];
                        s.setTarget(l - o / 20)
                    }
                }
                t.preventDefault()
            }
        },
        mousedown: function(t) {
            var e = this._manipulator
              , i = this.getMode();
            void 0 === i && (0 === t.button ? t.shiftKey ? this.setMode(r.PAN) : t.ctrlKey ? this.setMode(r.ZOOM) : this.setMode(r.ROTATE) : 2 === t.button && t.ctrlKey ? this.setMode(r.ZOOM) : this.setMode(r.PAN)),
            this.pushButton();
            var n = this._eventProxy.getPositionRelativeToCanvas(t);
            i = this.getMode(),
            i === r.ROTATE ? (e.getRotateInterpolator().reset(),
            e.getRotateInterpolator().set(n[0], n[1])) : i === r.PAN ? (e.getPanInterpolator().reset(),
            e.getPanInterpolator().set(n[0], n[1])) : i === r.ZOOM && (e.getZoomInterpolator().setStart(n[1]),
            e.getZoomInterpolator().set(0))
        },
        mouseup: function() {
            this.releaseButton(),
            this.setMode(void 0)
        },
        mouseout: function() {
            this.releaseButton(),
            this.setMode(void 0)
        },
        mousewheel: function(t, e) {
            var i = this._manipulator
              , n = i.getZoomInterpolator().getTarget()[0] - e;
            i.getZoomInterpolator().setTarget(n)
        },
        pushButton: function() {
            this._buttonup = !1
        },
        releaseButton: function() {
            this._buttonup = !0
        },
        keydown: function(t) {
            32 === t.keyCode ? (this._manipulator.computeHomePosition(),
            t.preventDefault()) : t.keyCode === this._panKey && this.getMode() !== r.PAN ? (this.setMode(r.PAN),
            this._manipulator.getPanInterpolator().reset(),
            this.pushButton(),
            t.preventDefault()) : t.keyCode === this._zoomKey && this.getMode() !== r.ZOOM ? (this.setMode(r.ZOOM),
            this._manipulator.getZoomInterpolator().reset(),
            this.pushButton(),
            t.preventDefault()) : t.keyCode === this._rotateKey && this.getMode() !== r.ROTATE && (this.setMode(r.ROTATE),
            this._manipulator.getRotateInterpolator().reset(),
            this.pushButton(),
            t.preventDefault())
        },
        keyup: function(t) {
            t.keyCode === this._panKey ? this.mouseup(t) : t.keyCode === this._rotateKey ? this.mouseup(t) : t.keyCode === this._rotateKey && this.mouseup(t),
            this.setMode(void 0)
        }
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = function(t) {
        this._manipulator = t,
        this.init()
    };
    n.prototype = {
        init: function() {},
        update: function(t, e) {
            this._manipulator.setPoseVR(t, e)
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    t.exports = {
        ROTATE: 0,
        PAN: 1,
        ZOOM: 2
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(773);
    t.exports = {
        name: n.name,
        version: n.version,
        author: n.author
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(288)
      , a = i(327)
      , s = r.sprintf
      , o = function(t, e) {
        a.call(this),
        this._name = "Variable",
        this._prefix = e,
        this._type = t,
        this._value = void 0
    };
    o.prototype = n.objectInherit(a.prototype, {
        getType: function() {
            return this._type
        },
        getVariable: function() {
            return this._prefix
        },
        setValue: function(t) {
            return this._value = t,
            this
        },
        toString: function() {
            var t = "prefix : " + this._prefix;
            return t += ", name : " + this._prefix,
            this.type && (t += " (" + this.type + ")"),
            t
        },
        declare: function() {
            return void 0 !== this._value ? s("%s %s = %s;", [this._type, this.getVariable(), this._value]) : s("%s %s;", [this._type, this.getVariable()])
        },
        isEmpty: function() {
            return void 0 === this._value && 0 === this._inputs.length
        },
        reset: function() {
            this._inputs = [],
            this._outputs = null,
            this._value = void 0,
            this._text = void 0
        }
    });
    var l = function(t, e) {
        o.call(this, t, e)
    };
    l.prototype = n.objectInherit(o.prototype, {
        declare: function() {
            return s("const %s %s = %s;", [this._type, this.getVariable(), this._value])
        }
    });
    var u = function(t, e, i) {
        o.call(this, t, e),
        this._size = i
    };
    u.prototype = n.objectInherit(o.prototype, {
        declare: function() {},
        globalDeclaration: function() {
            return this._size ? s("uniform %s %s[%s];", [this._type, this.getVariable(), this._size]) : s("uniform %s %s;", [this._type, this.getVariable()])
        }
    });
    var h = function(t, e) {
        o.call(this, t, e)
    };
    h.prototype = n.objectInherit(o.prototype, {
        declare: function() {},
        globalDeclaration: function() {
            return s("attribute %s %s;", [this._type, this.getVariable()])
        }
    });
    var c = function(t, e) {
        o.call(this, t, e)
    };
    c.prototype = n.objectInherit(o.prototype, {
        declare: function() {},
        globalDeclaration: function() {
            return s("varying %s %s;", [this._type, this.getVariable()])
        }
    });
    var d = function(t, e) {
        o.call(this, t, e)
    };
    d.prototype = n.objectInherit(o.prototype, {
        declare: function() {},
        globalDeclaration: function() {
            return s("uniform %s %s;", [this._type, this.getVariable()])
        }
    });
    var p = function(t, e) {
        o.call(this, t, e)
    };
    p.prototype = n.objectInherit(o.prototype, {
        _unique: !0,
        isUnique: function() {
            return this._unique
        },
        outputs: function() {
            return this
        },
        getVariable: function() {
            return this._prefix
        }
    });
    var f = function() {
        p.call(this, "vec4", "gl_FragColor"),
        this._name = "glFragColor"
    };
    f.prototype = n.objectInherit(p.prototype, {});
    var g = function() {
        p.call(this, "vec4", "gl_Position"),
        this._name = "glPosition"
    };
    g.prototype = n.objectInherit(p.prototype, {});
    var m = function() {
        p.call(this, "float", "gl_PointSize"),
        this._name = "glPointSize"
    };
    m.prototype = n.objectInherit(p.prototype, {}),
    t.exports = {
        Output: p,
        glPointSize: m,
        glPosition: g,
        glFragColor: f,
        Sampler: d,
        Variable: o,
        Constant: l,
        Attribute: h,
        Varying: c,
        Uniform: u
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(288)
      , a = i(327)
      , s = r.sprintf
      , o = function() {
        a.call(this)
    };
    o.prototype = n.objectInherit(a.prototype, {
        globalFunctionDeclaration: function() {
            return '#pragma include "functions.glsl"'
        }
    });
    var l = function() {
        o.call(this)
    };
    l.prototype = n.objectInherit(o.prototype, {
        type: "Normalize",
        validInputs: ["vec"],
        validOuputs: ["vec"],
        computeShader: function() {
            return r.callFunction("normalize", this._outputs.vec, [this._inputs.vec])
        }
    });
    var u = function() {
        o.call(this)
    };
    u.prototype = n.objectInherit(o.prototype, {
        type: "sRGBToLinear",
        validInputs: ["color"],
        validOuputs: ["color"],
        computeShader: function() {
            return this.computeConversion("sRGBToLinear")
        },
        computeConversion: function(t) {
            var e = this._outputs.color
              , i = this._inputs.color
              , n = e.getType() !== i.getType() ? ".rgb" : "";
            return r.callFunction(t, e.getVariable() + n, [i.getVariable() + n])
        }
    });
    var h = function() {
        u.call(this)
    };
    h.prototype = n.objectInherit(u.prototype, {
        type: "LinearTosRGB",
        computeShader: function() {
            return this.computeConversion("linearTosRGB")
        }
    });
    var c = function() {
        o.call(this)
    };
    c.prototype = n.objectInherit(o.prototype, {
        type: "FrontNormal",
        validInputs: ["normal"],
        validOuputs: ["normal"],
        computeShader: function() {
            return s("%s = gl_FrontFacing ? %s : -%s ;", [this._outputs.normal.getVariable(), this._inputs.normal.getVariable(), this._inputs.normal.getVariable()])
        }
    });
    var d = function(t) {
        return t.getType && "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    }
      , p = function() {
        o.call(this)
    };
    p.prototype = n.objectInherit(o.prototype, {
        type: "EncodeRGBM",
        validInputs: ["color", "range"],
        validOutputs: ["color"],
        computeShader: function() {
            return r.callFunction("encodeRGBM", this._outputs.color, [d(this._inputs.color), this._inputs.range])
        }
    });
    var f = function() {
        o.call(this)
    };
    f.prototype = n.objectInherit(o.prototype, {
        type: "DecodeRGBM",
        validInputs: ["color", "range"],
        validOutputs: ["color"],
        computeShader: function() {
            return r.callFunction("decodeRGBM", this._outputs.color, [this._inputs.color, this._inputs.range])
        }
    });
    var g = function(t) {
        a.call(this),
        this._defineName = t,
        this._defineValue = ""
    };
    g.prototype = n.objectInherit(a.prototype, {
        type: "Define",
        setValue: function(t) {
            return this._defineValue = t,
            this
        },
        getDefines: function() {
            return ["#define " + this._defineName + " " + this._defineValue]
        }
    }),
    t.exports = {
        NodeFunctions: o,
        Normalize: l,
        sRGBToLinear: u,
        LinearTosRGB: h,
        FrontNormal: c,
        DecodeRGBM: f,
        EncodeRGBM: p,
        Define: g
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(288)
      , a = i(327)
      , s = function() {
        a.call(this)
    };
    s.prototype = n.objectInherit(a.prototype, {
        validOutputs: ["color"],
        globalFunctionDeclaration: function() {
            return '#pragma include "lights.glsl"'
        }
    });
    var o = function(t) {
        return "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    }
      , l = function() {
        s.call(this)
    };
    l.prototype = n.objectInherit(s.prototype, {
        type: "PointLight",
        validInputs: ["normal", "eyeVector", "materialambient", "materialdiffuse", "materialspecular", "materialshininess", "lightambient", "lightdiffuse", "lightspecular", "lightposition", "lightattenuation", "lightmatrix", "lighted", "lightEyePos", "lightEyeDir"],
        computeShader: function() {
            return r.callFunction("computePointLightShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, o(this._inputs.materialambient), o(this._inputs.materialdiffuse), o(this._inputs.materialspecular), this._inputs.materialshininess, o(this._inputs.lightambient), o(this._inputs.lightdiffuse), o(this._inputs.lightspecular), this._inputs.lightposition, this._inputs.lightattenuation, this._inputs.lightmatrix, this._inputs.lightEyePos, this._inputs.lightEyeDir, this._inputs.lighted])
        }
    });
    var u = function() {
        s.call(this)
    };
    u.prototype = n.objectInherit(s.prototype, {
        type: "SpotLight",
        validInputs: ["normal", "eyeVector", "materialambient", "materialdiffuse", "materialspecular", "materialshininess", "lightambient", "lightdiffuse", "lightspecular", "lightdirection", "lightattenuation", "lightposition", "lightspotCutOff", "lightspotBlend", "lightmatrix", "lightinvMatrix", "lighted", "lightEyePos", "lightEyeDir"],
        computeShader: function() {
            return r.callFunction("computeSpotLightShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, o(this._inputs.materialambient), o(this._inputs.materialdiffuse), o(this._inputs.materialspecular), this._inputs.materialshininess, o(this._inputs.lightambient), o(this._inputs.lightdiffuse), o(this._inputs.lightspecular), this._inputs.lightdirection, this._inputs.lightattenuation, this._inputs.lightposition, this._inputs.lightspotCutOff, this._inputs.lightspotBlend, this._inputs.lightmatrix, this._inputs.lightinvMatrix, this._inputs.lightEyePos, this._inputs.lightEyeDir, this._inputs.lighted])
        }
    });
    var h = function() {
        s.call(this)
    };
    h.prototype = n.objectInherit(s.prototype, {
        type: "SunLight",
        validInputs: ["normal", "eyeVector", "materialambient", "materialdiffuse", "materialspecular", "materialshininess", "lightambient", "lightdiffuse", "lightspecular", "lightposition", "lightmatrix", "lighted", "lightEyeDir"],
        computeShader: function() {
            return r.callFunction("computeSunLightShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, o(this._inputs.materialambient), o(this._inputs.materialdiffuse), o(this._inputs.materialspecular), this._inputs.materialshininess, o(this._inputs.lightambient), o(this._inputs.lightdiffuse), o(this._inputs.lightspecular), this._inputs.lightposition, this._inputs.lightmatrix, this._inputs.lightEyeDir, this._inputs.lighted])
        }
    });
    var c = function() {
        s.call(this)
    };
    c.prototype = n.objectInherit(s.prototype, {
        type: "HemiLight",
        validInputs: ["normal", "eyeVector", "materialdiffuse", "materialspecular", "materialshininess", "lightdiffuse", "lightground", "lightposition", "lightmatrix", "lighted", "lightEyeDir"],
        computeShader: function() {
            return r.callFunction("computeHemiLightShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, o(this._inputs.materialdiffuse), o(this._inputs.materialspecular), this._inputs.materialshininess, o(this._inputs.lightdiffuse), o(this._inputs.lightground), this._inputs.lightposition, this._inputs.lightmatrix, this._inputs.lightEyeDir, this._inputs.lighted])
        }
    }),
    t.exports = {
        PointLight: l,
        SpotLight: u,
        SunLight: h,
        HemiLight: c
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(288)
      , a = i(327)
      , s = function() {
        a.call(this)
    }
      , o = function(t) {
        return "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    };
    s.prototype = n.objectInherit(a.prototype, {
        type: "Morph",
        validInputs: ["weights", "vertex", "target0"],
        validOutputs: ["out"],
        globalFunctionDeclaration: function() {
            var t = window.Object.keys(this._inputs).length - 2
              , e = 0
              , i = "vec3 morphTransform( const in vec4 weights,  const in vec3 vertex, const in vec3 target0";
            for (e = 1; e < t; ++e)
                i += ", const in vec3 target" + e;
            if (i += " ) { \n",
            1 === t)
                i += "return mix(vertex, target0, weights[0])";
            else {
                for (i += "\tvec3 vecOut = vertex * (1.0 - ( weights[0]",
                e = 1; e < t; ++e)
                    i += " + weights[" + e + "]";
                for (i += "));\n",
                e = 0; e < t; ++e)
                    i += "\tvecOut += target" + e + " * weights[" + e + "];\n";
                i += "\treturn vecOut"
            }
            return i += ";\n}\n"
        },
        computeShader: function() {
            for (var t = this._inputs, e = [t.weights, o(t.vertex)], i = 0; i < 4 && t["target" + i]; i++)
                e.push(o(t["target" + i]));
            return r.callFunction("morphTransform", this._outputs.out, e)
        }
    }),
    t.exports = {
        Morph: s
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(13)
      , a = i(327)
      , s = i(288)
      , o = s.sprintf
      , l = function() {
        a.call(this)
    };
    l.prototype = a.prototype;
    var u = function() {
        l.call(this)
    };
    u.prototype = r.objectInherit(l.prototype, {
        type: "Add",
        operator: "+",
        computeShader: function() {
            var t = this._outputs.getType()
              , e = "";
            "vec4" === t ? e = ".rgba" : "vec3" === t ? e = ".rgb" : "vec2" === t && (e = ".rg");
            for (var i = this._outputs.getVariable() + " = " + this._inputs[0].getVariable() + e, n = 1, r = this._inputs.length; n < r; n++) {
                var a = this._inputs[n];
                i += this.operator + a.getVariable(),
                "float" !== a.getType() && (i += e)
            }
            return i += ";"
        }
    });
    var h = function() {
        u.call(this)
    };
    h.prototype = r.objectInherit(u.prototype, {
        type: "Mult",
        operator: "*"
    });
    var c = function() {
        u.call(this)
    };
    c.prototype = r.objectInherit(u.prototype, {
        type: "SetFromNode"
    });
    var d = function() {
        u.call(this),
        this._overwriteW = !0,
        this._forceComplement = !0,
        this._inverseOp = !1
    };
    d.prototype = r.objectInherit(u.prototype, {
        type: "MatrixMultDirection",
        operator: "*",
        validInputs: ["vec", "matrix"],
        validOutputs: ["vec"],
        complement: "0.",
        setInverse: function(t) {
            return this._inverseOp = t,
            this
        },
        setForceComplement: function(t) {
            return this._forceComplement = t,
            this
        },
        setOverwriteW: function(t) {
            return this._overwriteW = t,
            this
        },
        computeShader: function() {
            var t = this._inputs.vec.getVariable()
              , e = this._inputs.matrix.getVariable()
              , i = this._outputs.vec.getVariable()
              , n = this._inputs.vec.getType()
              , r = this._outputs.vec.getType()
              , a = this._inputs.matrix.getType()
              , s = i;
            if ("mat4" === a) {
                s += " = ",
                "vec4" !== r && (s += r + "(");
                var o = t;
                (this._forceComplement || "vec4" !== n) && (o = "vec4(" + t + ".xyz, " + this.complement + ")"),
                s += this._inverseOp ? o + this.operator + e : e + this.operator + o,
                "vec4" !== r && (s += ")"),
                s += ";",
                this._overwriteW || "vec4" !== n || (s += "\n" + i + ".a = " + t + ".a;")
            } else {
                "vec4" === r && (s += ".xyz"),
                s += " = ";
                var l = t + ".xyz";
                s += (this._inverseOp ? l + this.operator + e : e + this.operator + l) + ";",
                this._overwriteW || "vec4" !== r || "vec4" !== n || (s += "\n" + i + ".a = " + t + ".a;")
            }
            return s
        }
    });
    var p = function() {
        d.call(this),
        this._forceComplement = !1
    };
    p.prototype = r.objectInherit(d.prototype, {
        type: "MatrixMultPosition",
        complement: "1."
    });
    var f = function() {
        a.call(this)
    };
    f.prototype = r.objectInherit(a.prototype, {
        type: "InlineCode",
        code: function(t) {
            return this._text = t,
            this
        },
        computeShader: function() {
            var t = r.objectMix({}, this._inputs);
            t = r.objectMix(t, this._outputs);
            for (var e = new RegExp("%[A-Za-z0-9_]+","gm"), i = this._text, a = this._text.match(e), s = new Set, o = 0; o < a.length; o++) {
                var l = a[o].substr(1);
                if (!s.has(l)) {
                    t[l] || (n.error("error with inline code\n" + this._text),
                    n.error("input " + l + " not provided for " + a[o]));
                    var u = new RegExp(a[o].toString(),"gm");
                    i = i.replace(u, t[l].getVariable()),
                    s.add(l)
                }
            }
            return i
        }
    });
    var g = function() {
        l.call(this)
    };
    g.prototype = r.objectInherit(l.prototype, {
        type: "SetAlpha",
        validInputs: ["color", "alpha"],
        validOuputs: ["color"],
        computeShader: function() {
            var t = this._inputs.alpha;
            return o("%s = vec4( %s.rgb, %s );", [this._outputs.color.getVariable(), this._inputs.color.getVariable(), "float" !== t.getType() ? t.getVariable() + ".a" : t.getVariable()])
        }
    });
    var m = function() {
        l.call(this)
    };
    m.prototype = r.objectInherit(l.prototype, {
        type: "PreMultAlpha",
        validInputs: ["color"],
        validOuputs: ["color"],
        computeShader: function() {
            var t, e = void 0 !== this._inputs.alpha ? this._inputs.alpha : this._inputs.color;
            return t = "float" !== e.getType() ? e.getVariable() + ".a" : e.getVariable(),
            o("%s.rgb = %s.rgb * %s;", [this._outputs.color.getVariable(), this._inputs.color.getVariable(), t])
        }
    }),
    t.exports = {
        BaseOperator: l,
        Mult: h,
        MatrixMultPosition: p,
        MatrixMultDirection: d,
        Add: u,
        InlineCode: f,
        SetAlpha: g,
        SetFromNode: c,
        PreMultAlpha: m
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(288)
      , a = i(327)
      , s = function() {
        a.call(this)
    };
    s.prototype = n.objectInherit(a.prototype, {
        type: "Skinning",
        validInputs: ["weights", "bonesIndex", "matrixPalette"],
        validOutputs: ["mat4"],
        globalFunctionDeclaration: function() {
            return '#pragma include "skinning.glsl"'
        },
        computeShader: function() {
            return r.callFunction("skeletalTransform", this._outputs.mat4, [this._inputs.weights, this._inputs.bonesIndex])
        }
    }),
    t.exports = {
        Skinning: s
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(288)
      , a = i(327)
      , s = function() {
        a.call(this)
    };
    s.prototype = n.objectInherit(a.prototype, {
        type: "TextureAbstractNode",
        functionName: "noTextureFunction",
        validInputs: ["sampler", "uv"],
        validOutputs: ["color"],
        computeShader: function() {
            return r.callFunction(this.functionName, this._outputs.color, [this._inputs.sampler, this._inputs.uv.getVariable() + ".xy"])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "textures.glsl"'
        }
    });
    var o = function() {
        s.call(this)
    };
    o.prototype = n.objectInherit(s.prototype, {
        type: "TextureRGB",
        functionName: "textureRGB"
    });
    var l = function() {
        o.call(this)
    };
    l.prototype = n.objectInherit(o.prototype, {
        type: "TextureRGBA",
        functionName: "textureRGBA"
    });
    var u = function() {
        o.call(this)
    };
    u.prototype = n.objectInherit(o.prototype, {
        type: "TextureAlpha",
        functionName: "textureAlpha"
    });
    var h = function() {
        o.call(this)
    };
    h.prototype = n.objectInherit(o.prototype, {
        type: "TextureIntensity",
        functionName: "textureIntensity"
    }),
    t.exports = {
        NodeTextures: s,
        TextureRGB: o,
        TextureRGBA: l,
        TextureAlpha: u,
        TextureIntensity: h
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(645)
      , a = i(640)
      , s = i(641)
      , o = i(642)
      , l = i(870)
      , u = i(644)
      , h = i(646)
      , c = i(643)
      , d = i(869)
      , p = function() {
        this._nodes = new window.Map,
        this.registerNodes(r),
        this.registerNodes(a),
        this.registerNodes(h),
        this.registerNodes(s),
        this.registerNodes(o),
        this.registerNodes(c),
        this.registerNodes(l),
        this.registerNodes(u),
        this.registerNodes(d)
    };
    p.prototype = {
        registerNodes: function(t) {
            for (var e in t)
                this.registerNode(e, t[e])
        },
        registerNode: function(t, e) {
            this._nodes.has(t) && n.warn("Node " + t + " already registered"),
            this._nodes.set(t, e)
        },
        getNode: function(t) {
            var e = this._nodes.get(t);
            if (!e)
                return void n.warn("Node " + t + " does not exist");
            var i = window.Object.create(e.prototype);
            return e.apply(i, Array.prototype.slice.call(arguments, 1)),
            i
        }
    };
    var f = new p;
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = function(t, e) {
        r.call(this),
        this._enable = !t,
        this._shadowReceiveAttribute = e
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "ShadowCast",
        cloneType: function() {
            return new a(!0)
        },
        setReceiveAttribute: function(t) {
            this._shadowReceiveAttribute = t
        },
        getReceiveAttribute: function() {
            return this._shadowReceiveAttribute
        },
        getDefines: function() {
            if (this._shadowReceiveAttribute)
                return this._shadowReceiveAttribute.getDefines()
        },
        getHash: function() {
            return "ShadowCast" + this._enable + this._shadowReceiveAttribute.getPrecision()
        },
        isEnabled: function() {
            return this._enable
        }
    }), "osgShadow", "ShadowCastAttribute"),
    n.setTypeID(a),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(436)
      , a = function() {
        r.apply(this, arguments)
    };
    a.prototype = n.objectInherit(r.prototype, {
        getCompilerName: function() {
            return "ShadowCast"
        },
        initAttributes: function() {
            for (var t = this._attributes, e = 0, i = t.length; e < i; e++) {
                var n = t[e].className();
                "ShadowCastAttribute" === n ? this._shadowCastAttribute = t[e] : "Billboard" === n ? this._isBillboard = !!t[e] : "SkinningAttribute" === n ? this._skinningAttribute = t[e] : "MorphAttribute" === n ? this._morphAttribute = t[e] : "PointSizeAttribute" === n && (this._pointSizeAttribute = t[e])
            }
        },
        registerTextureAttributes: function() {},
        createShadowCastDepth: function(t) {
            return this.getNode("ShadowCast").setShadowCastAttribute(this._shadowCastAttribute).inputs({
                shadowDepthRange: this.getOrCreateUniform("vec4", "uShadowDepthRange"),
                fragEye: this.getOrCreateVarying("vec4", "vViewVertex")
            }).outputs({
                color: t
            }),
            t
        },
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return [this.createShadowCastDepth(t)]
        }
    }),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(437)
      , r = i(649)
      , a = function() {
        n.apply(this, arguments),
        this.setShaderCompiler(r),
        this._acceptAttributeTypes = new window.Set(["ShadowCast", "Skinning", "Morph", "PointSize"])
    };
    a.prototype = n.prototype,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(376)
      , r = i(272)
      , a = i(377)
      , s = i(432)
      , o = i(517)
      , l = i(65)
      , u = i(13)
      , h = function(t) {
        l.call(this),
        this._noCastMask = t,
        this._nodeList = []
    };
    h.prototype = u.objectLibraryClass(u.objectInherit(l.prototype, {
        reset: function() {
            this._nodeList = []
        },
        removeNodeFromCasting: function(t) {
            var e = t.getNodeMask();
            -1 === e ? (e = this._noCastMask,
            t.setNodeMask(e),
            this._nodeList.push(t)) : 0 != (e & ~this._noCastMask) && (t.setNodeMask(e | this._noCastMask),
            this._nodeList.push(t))
        },
        apply: function(t) {
            var e = t.getStateSet();
            if (e) {
                var i = e.getAttribute("BlendFunc");
                if (void 0 !== i && i.getSource() !== n.DISABLE) {
                    var l = e.getAttribute("Depth");
                    if (l && (l.getFunc() === a.DISABLE || !1 === l.getWriteMask()))
                        return void this.removeNodeFromCasting(t)
                }
            }
            return t.getTypeID() === s.typeID || t.getTypeID() === o.typeID ? void this.removeNodeFromCasting(t) : t.getTypeID() === r.typeID && t.isRenderToTextureCamera() ? void this.removeNodeFromCasting(t) : void this.traverse(t)
        },
        setNoCastMask: function(t) {
            this._noCastMask = t
        },
        restore: function() {
            for (var t = 0, e = this._nodeList.length; t < e; t++) {
                var i = this._nodeList[t]
                  , n = i.getNodeMask();
                n === this._noCastMask ? i.setNodeMask(-1) : i.setNodeMask(n & ~this._noCastMask)
            }
        }
    }), "osgShadow", "ShadowCasterVisitor"),
    u.setTypeID(h),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(353)
      , r = i(408)
      , a = i(272)
      , s = i(143)
      , o = i(432)
      , l = i(5).mat4
      , u = i(410)
      , h = i(163)
      , c = i(65)
      , d = i(411)
      , p = i(13)
      , f = function() {
        c.call(this, c.TRAVERSE_ALL_CHILDREN),
        this._matrixStack = [l.create()],
        this._reservedMatrixStack = new u,
        this._bb = new n,
        this._bs = new r
    };
    f.prototype = p.objectInherit(c.prototype, {
        reset: function(t, e, i, n, r) {
            this.setTraversalMask(t),
            this._cameraFrustum = i,
            this._lightFrustum = r,
            this.getCameraPlaneMaskForLightNear(e, i, n ? 6 : 4),
            this._reservedMatrixStack.reset(),
            this._matrixStack.length = 1,
            this._bb.init()
        },
        getBoundingBox: function() {
            return this._bb
        },
        getCameraPlaneMaskForLightNear: function(t, e, i) {
            var n, r = 1, a = 15;
            for (n = 0; n < i; ++n)
                a = a << 1 | 1;
            var s = e.getPlanes();
            for (n = 0; n < i; ++n)
                d.distanceToPlane(s[n], t) < 0 && (a ^= r),
                r <<= 1;
            return this._cameraPlaneMaskedByLightNear = a,
            e.setResultMask(a),
            e.pushCurrentMask(a),
            a
        },
        applyTransform: function(t) {
            var e = this._reservedMatrixStack.get()
              , i = this._matrixStack.length;
            l.copy(e, this._matrixStack[i - 1]),
            t.computeLocalToWorldMatrix(e, this);
            var n = this._bs;
            t.getBound().transformMat4(this._bs, e),
            (0 === this._cameraFrustum.getCurrentMask() || this._cameraFrustum.containsBoundingSphere(n)) && (0 === this._lightFrustum.getCurrentMask() || this._lightFrustum.containsBoundingSphere(n)) && (this._cameraFrustum.pushCurrentMask(),
            this._lightFrustum.pushCurrentMask(),
            this.pushMatrix(e),
            this.traverse(t),
            this._cameraFrustum.popCurrentMask(),
            this._lightFrustum.popCurrentMask(),
            this.popMatrix())
        },
        applyBoundingBox: function() {
            var t = new n;
            return function(e) {
                var i = this._matrixStack.length
                  , n = this._matrixStack[i - 1];
                l.exactEquals(n, l.IDENTITY) ? this._bb.expandByBoundingBox(e) : e.valid() && (e.transformMat4(t, n),
                this._bb.expandByBoundingBox(t))
            }
        }(),
        apply: function(t) {
            var e = t.getTypeID();
            if (t instanceof h)
                return void this.applyTransform(t);
            if (e === s.getTypeID()) {
                var i = this._bs
                  , n = this._matrixStack[this._matrixStack.length - 1];
                if (t.getBound().transformMat4(i, n),
                0 !== this._cameraFrustum.getCurrentMask() && !this._cameraFrustum.containsBoundingSphere(i))
                    return;
                if (0 !== this._lightFrustum.getCurrentMask() && !this._lightFrustum.containsBoundingSphere(i))
                    return;
                return void this.applyBoundingBox(t.getBoundingBox())
            }
            e === a.getTypeID() || o.getTypeID(),
            this.traverse(t)
        },
        pushMatrix: function(t) {
            this._matrixStack.push(t)
        },
        popMatrix: function() {
            this._matrixStack.pop()
        }
    }),
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = i(272)
      , r = i(457)
      , a = i(376)
      , s = i(456)
      , o = i(377)
      , l = i(378)
      , u = i(5).mat4
      , h = i(163)
      , c = i(28)
      , d = i(380)
      , p = i(66)
      , f = i(287)
      , g = i(664)
      , m = i(93)
      , v = i(325)
      , _ = i(81)
      , b = i(13)
      , x = i(134)
      , y = i(5).vec3
      , S = i(5).vec4
      , w = i(412)
      , C = i(326)
      , M = i(654)
      , T = i(651)
      , A = i(652)
      , E = i(648)
      , P = i(535)
      , N = i(655)
      , k = function(t) {
        this._shadowTechnique = t
    };
    k.prototype = {
        cull: function(t, e) {
            this._shadowTechnique.getShadowedScene().nodeTraverse(e);
            var i = e.getCurrentCullingSet()
              , n = e.getCurrentProjectionMatrix()
              , r = e.getComputedNear()
              , a = e.getComputedFar();
            return u.getFrustumPlanes(i.getFrustum().getPlanes(), n, e.getCurrentModelViewMatrix(), !1),
            i.getFrustum().setupMask(6),
            this._shadowTechnique.setLightFrustum(i.getFrustum(), r, a),
            !1
        }
    };
    var F = function(t, e) {
        P.call(this),
        this._projectionMatrix = u.create(),
        this._viewMatrix = u.create(),
        this._lightNumberArrayIndex = -1,
        this._lightUp = y.fromValues(0, 0, 1),
        this._light = t.light,
        this._cameraShadow = new n,
        this._cameraShadow.setCullCallback(new k(this)),
        this._cameraShadow.setRenderOrder(n.PRE_RENDER, 0),
        this._cameraShadow.setReferenceFrame(v.ABSOLUTE_RF),
        this._cameraShadow.setClearColor(S.fromValues(1, 1, 1, 1)),
        e ? this._texture = e : (this._texture = new N,
        this._textureUnitBase = 4,
        this._textureUnit = this._textureUnitBase,
        this._textureMagFilter = void 0,
        this._textureMinFilter = void 0),
        this._textureSize = 256;
        var i = _.createFloat2("RenderSize");
        this._texelSizeUniform = _.createFloat1(1 / this._textureSize, "texelSize"),
        this._renderSize = i.getInternalArray(),
        this._renderSize[0] = this._renderSize[1] = this._textureSize,
        this._receivingStateset = void 0,
        this._casterStateSet = new f,
        this._casterStateSet.addUniform(_.createFloat1(0, "exponent0")),
        this._casterStateSet.addUniform(_.createFloat1(0, "exponent1")),
        this._casterStateSet.addUniform(_.createFloat1(.005, "bias")),
        this._casterStateSet.addUniform(this._texelSizeUniform),
        this._casterStateSet.addUniform(i),
        this._casterStateSet.setAttributeAndModes(new o(o.LESS), p.ON | p.OVERRIDE),
        this._casterStateSet.setAttributeAndModes(new a, p.ON | p.OVERRIDE),
        this._shadowReceiveAttribute = new M(this._light.getLightNumber()),
        this._casterStateSet.setAttributeAndModes(this._shadowReceiveAttribute, p.ON | p.OVERRIDE),
        this._shadowCastShaderGeneratorName = "ShadowCast";
        var r = _.createFloat4("uShadowDepthRange");
        this._casterStateSet.addUniform(r),
        this._depthRange = r.getInternalArray(),
        this._depthRange[0] = .001,
        this._depthRange[1] = 1e3,
        this._depthRange[2] = 999.999,
        this._depthRange[3] = 1 / 999.999,
        this._worldLightPos = S.create(),
        this._worldLightPos[3] = 0,
        this._worldLightDir = S.create(),
        this._worldLightDir[3] = 1,
        this._castsShadowDrawTraversalMask = 4294967295,
        this._castsShadowBoundsTraversalMask = 4294967295,
        this._shaderProcessor = void 0,
        this._tmpVec = y.create(),
        this._tmpVecBis = y.create(),
        this._tmpVecTercio = y.create(),
        this._tmpMatrix = u.create(),
        t && this.setShadowSettings(t),
        this._computeFrustumBounds = new A,
        this._computeBoundsVisitor = new s,
        !1 !== t.userShadowCasterVisitor && (this._removeNodesNeverCastingVisitor = t.userShadowCasterVisitor || new T(this._castsShadowTraversalMask)),
        this._infiniteFrustum = !0;
        var l = new E(!1,this._shadowReceiveAttribute);
        this._casterStateSet.setAttributeAndModes(l, p.ON | p.OVERRIDE),
        this._casterStateSet.setShaderGeneratorName(this._shadowCastShaderGeneratorName, p.OVERRIDE | p.ON),
        this._debug = !1
    };
    F.prototype = b.objectLibraryClass(b.objectInherit(P.prototype, {
        getDepthRange: function() {
            return this._depthRange
        },
        setLightFrustum: function(t, e, i) {
            this._lightFrustum = t,
            this._depthRange[0] = e,
            this._depthRange[1] = i,
            this.nearFarBounding(),
            this._debug && (this._debugGeomFrustum.updateGeometry(this._projectionMatrix, this._depthRange),
            u.invert(this._debugNodeFrustum.getMatrix(), this._viewMatrix))
        },
        getCamera: function() {
            return this._cameraShadow
        },
        getTexture: function() {
            return this._texture
        },
        isDirty: function() {
            return this._dirty
        },
        setTextureUnitBase: function(t) {
            this._textureUnitBase = t,
            this._textureUnit = t
        },
        setShadowSettings: function(t) {
            t && (this._light = t.light,
            this._shadowCastShaderGeneratorName = t.getShadowCastShaderGeneratorName(),
            this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),
            this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),
            this.setLight(this._light),
            this.setTextureSize(t.textureSize),
            this.setTexturePrecision(t.textureType),
            this.setKernelSizePCF(t.kernelSizePCF),
            this.setBias(t.bias),
            this.setNormalBias(t.normalBias))
        },
        setCastsShadowDrawTraversalMask: function(t) {
            this._castsShadowDrawTraversalMask = t
        },
        getCastsShadowDrawTraversalMask: function() {
            return this._castsDrawShadowTraversalMask
        },
        setCastsShadowBoundsTraversalMask: function(t) {
            this._castsShadowBoundsTraversalMask = t
        },
        getCastsShadowBoundsTraversalMask: function() {
            return this._castsShadowBoundsTraversalMask
        },
        getNormalBias: function() {
            return this._shadowReceiveAttribute.getNormalBias()
        },
        setNormalBias: function(t) {
            this._shadowReceiveAttribute.setNormalBias(t)
        },
        getBias: function() {
            return this._shadowReceiveAttribute.getBias()
        },
        setBias: function(t) {
            this._shadowReceiveAttribute.setBias(t),
            this._casterStateSet.getUniformList().bias.getUniform().setFloat(t)
        },
        getKernelSizePCF: function() {
            return this._shadowReceiveAttribute.getKernelSizePCF()
        },
        setKernelSizePCF: function(t) {
            this._shadowReceiveAttribute.setKernelSizePCF(t)
        },
        setShadowedScene: function(t) {
            P.prototype.setShadowedScene.call(this, t),
            this._receivingStateset = this._shadowedScene.getReceivingStateSet(),
            this.dirty()
        },
        checkLightNumber: function() {
            var t = this._light.getLightNumber();
            this._shadowReceiveAttribute.getLightNumber() !== t && this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember()) === this._shadowReceiveAttribute && this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),
            this._texture && !this._texture.hasLightNumber(t) && this._receivingStateset.getTextureAttribute(this._textureUnit, this._texture.getTypeMember()) === this._texture && this._receivingStateset.removeTextureAttribute(this._textureUnit, this._texture.getTypeMember())
        },
        init: function(t, e, i) {
            if (this._shadowedScene) {
                this._filledOnce = !1,
                this.checkLightNumber(),
                this._cameraShadow || (this._cameraShadow = new n,
                this._cameraShadow.setCullCallback(new k(this)),
                this._cameraShadow.setRenderOrder(n.PRE_RENDER, 0),
                this._cameraShadow.setReferenceFrame(v.ABSOLUTE_RF),
                this._cameraShadow.setClearColor(S.fromValues(1, 1, 1, 1)));
                var r = this._light.getLightNumber();
                t ? (this._texture = t,
                this._lightNumberArrayIndex = e,
                this._textureUnit = i,
                this._shadowReceiveAttribute.setAtlas(!0)) : (this.initTexture(),
                this._textureUnit = this._textureUnitBase + r,
                this._texture.setLightNumber(r),
                this._texture.setName("ShadowTexture" + this._textureUnit),
                this._shadowReceiveAttribute.setAtlas(!1)),
                this._cameraShadow.setName("light_shadow_camera" + this._light.getName()),
                this._shadowReceiveAttribute.setLightNumber(r);
                var a = p.OVERRIDE | p.ON;
                this._receivingStateset.setAttributeAndModes(this._shadowReceiveAttribute, a),
                this._preventTextureBindingDuringShadowCasting(),
                this._casterStateSet.setTextureAttributeAndModes(this._textureUnit, m.textureNull, p.PROTECTED),
                this._receivingStateset.setTextureAttributeAndModes(this._textureUnit, this._texture, a),
                this._dirty = !1
            }
        },
        _preventTextureBindingDuringShadowCasting: function() {
            for (var t = C.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS"), e = 0; e < t; e++)
                this._casterStateSet.setTextureAttributeAndModes(e, m.textureNull, p.OVERRIDE | p.ON)
        },
        valid: function() {
            return !0
        },
        updateShadowTechnique: function(t, e) {
            var i = this._cameraShadow
              , n = this._texture;
            if (i && n) {
                var r = i.getViewport();
                r || (r = new w,
                i.setViewport(r)),
                e ? r.x() === e[0] && r.y() === e[1] && r.width() === e[2] && r.height() === e[3] || (i.detachAll(),
                i.attachTexture(l.COLOR_ATTACHMENT0, n),
                i.attachRenderBuffer(l.DEPTH_ATTACHMENT, l.DEPTH_COMPONENT16),
                i.getViewport().setViewport(e[0], e[1], e[2], e[3])) : r.width() === n.getWidth() && r.height() === n.getHeight() || (i.detachAll(),
                i.attachTexture(l.COLOR_ATTACHMENT0, n),
                i.attachRenderBuffer(l.DEPTH_ATTACHMENT, l.DEPTH_COMPONENT16),
                i.getViewport().setViewport(0, 0, n.getWidth(), n.getHeight()))
            }
        },
        updateShadowTechnic: function() {
            c.log("ShadowMap.updateShadowTechnic() is deprecated, use updateShadowTechnique instead"),
            this.updateShadowTechnique()
        },
        setTextureFiltering: function() {
            var t;
            switch (this.getTexturePrecision()) {
            case "HALF_FLOAT":
                t = m.HALF_FLOAT;
                break;
            case "FLOAT":
                t = m.FLOAT;
                break;
            default:
            case "UNSIGNED_BYTE":
                t = m.UNSIGNED_BYTE
            }
            this._texture.setInternalFormatType(t),
            this._texture.setMinFilter(m.NEAREST),
            this._texture.setMagFilter(m.NEAREST),
            this._textureMagFilter = m.NEAREST,
            this._textureMinFilter = m.NEAREST
        },
        initTexture: function() {
            if (this._dirty) {
                this._texture || (this._texture = new N,
                this._textureUnit = this._textureUnitBase),
                this._texture.setTextureSize(this._textureSize, this._textureSize),
                this._texelSizeUniform.setFloat(1 / this._textureSize),
                this._renderSize[0] = this._textureSize,
                this._renderSize[1] = this._textureSize;
                var t;
                t = m.RGBA,
                this.setTextureFiltering(),
                this._texture.setInternalFormat(t),
                this._texture.setWrapS(m.CLAMP_TO_EDGE),
                this._texture.setWrapT(m.CLAMP_TO_EDGE),
                this._texture.dirty()
            }
        },
        setTexturePrecision: function(t) {
            t !== this._shadowReceiveAttribute.getPrecision() && (this._shadowReceiveAttribute.setPrecision(t),
            this.dirty())
        },
        getTexturePrecision: function() {
            return this._shadowReceiveAttribute.getPrecision()
        },
        setTextureSize: function(t) {
            t !== this._textureSize && (this._textureSize = t,
            this.dirty())
        },
        getCasterStateSet: function() {
            return this._casterStateSet
        },
        setLight: function(t) {
            t && t !== this._light && (this._light = t,
            this.dirty())
        },
        getUp: function(t) {
            return Math.abs(y.dot(this._lightUp, t)) >= 1 && (1 === this._lightUp[0] ? (this._lightUp[0] = 0,
            this._lightUp[1] = 1,
            this._lightUp[2] = 0) : (this._lightUp[0] = 1,
            this._lightUp[1] = 0,
            this._lightUp[2] = 0)),
            this._lightUp
        },
        nearFarBounding: function() {
            var t = this._depthRange[0]
              , e = this._depthRange[1]
              , i = F.EPSILON;
            e < t - i ? (this._emptyCasterScene = !0,
            e = 1,
            t = i) : t < i && (t = i),
            this._depthRange[0] = t,
            this._depthRange[1] = e
        },
        makePerspectiveFromBoundingBox: function(t, e, i, n, r, a) {
            var s = t.center(this._tmpVec)
              , o = t.radius()
              , l = F.EPSILON
              , h = l
              , c = 1;
            this._radius = o;
            var d = y.distance(s, i);
            d < -o ? this._emptyCasterScene = !0 : d <= 0 ? (h = l,
            c = d + o) : d < o ? (h = l,
            c = d + o) : (h = d - o,
            c = d + o),
            this._depthRange[0] = h,
            this._depthRange[1] = c,
            this.nearFarBounding();
            var p = this._depthRange[0] * Math.tan(e * Math.PI / 180);
            p = p > o ? o : p;
            var f = p
              , g = -f
              , m = p
              , v = -m
              , _ = this.getUp(n);
            this._infiniteFrustum ? u.infiniteFrustum(a, v, m, g, f, this._depthRange[0]) : u.frustum(a, v, m, g, f, this._depthRange[0], this._depthRange[1]),
            u.lookAtDirection(r, i, n, _)
        },
        makeOrthoFromBoundingBox: function(t, e, i, n) {
            var r = t.center(this._tmpVecTercio)
              , a = t.radius()
              , s = a + a
              , o = 1e-4
              , l = s + 1e-4
              , h = this._tmpVec;
            y.scaleAndAdd(h, r, e, -s),
            o = a,
            l += a;
            o < .001 * l && (o = .001 * l);
            var c = this.getUp(e);
            u.lookAtDirection(i, h, e, c);
            var d, p;
            p = a,
            d = p,
            u.ortho(n, -d, d, -p, p, o, l),
            this._depthRange[0] = o,
            this._depthRange[1] = l
        },
        aimShadowCastingCamera: function(t, e) {
            var i = this._light;
            if (!i)
                return void (this._emptyCasterScene = !0);
            var n = this._cameraShadow
              , r = this._worldLightPos
              , a = this._worldLightDir;
            u.copy(this._projectionMatrix, n.getProjectionMatrix()),
            u.copy(this._viewMatrix, n.getViewMatrix());
            var s, o = this._projectionMatrix, l = this._viewMatrix, h = t.getCurrentRenderBin().getPositionedAttribute();
            if (h = h.find(function(t) {
                return t.length > 0 && t[1] === i && (s = t[0],
                !0)
            }),
            void 0 === s)
                return c.warn("light isnt inside children of shadowedScene Node"),
                void (this._emptyCasterScene = !0);
            var d = this._tmpMatrix;
            if (u.invert(d, t.getCurrentModelViewMatrix()),
            this._light.isDirectionLight())
                S.transformMat4(r, i.getPosition(), s),
                S.transformMat4(r, r, d),
                y.scale(r, r, -1),
                y.normalize(r, r),
                this.makeOrthoFromBoundingBox(e, r, l, o),
                this._debug && u.invert(this._debugNodeFrustum.getMatrix(), l);
            else {
                u.mul(this._tmpMatrix, d, s);
                var p = this._tmpMatrix;
                y.transformMat4(r, i.getPosition(), p),
                p[12] = 0,
                p[13] = 0,
                p[14] = 0,
                u.invert(p, p),
                u.transpose(p, p),
                y.copy(a, i.getDirection()),
                S.transformMat4(a, a, p),
                y.normalize(a, a),
                this.makePerspectiveFromBoundingBox(e, i.getSpotCutoff(), r, a, l, o)
            }
            u.copy(n.getProjectionMatrix(), this._projectionMatrix),
            u.copy(n.getViewMatrix(), this._viewMatrix),
            this.setShadowUniformsDepthValue()
        },
        frameShadowCastingFrustum: function(t) {
            this._infiniteFrustum || r.prototype.clampProjectionMatrix(this._projectionMatrix, this._depthRange[0], this._depthRange[1], t.getNearFarRatio(), this._depthRange),
            this.setShadowUniformsDepthValue();
            var e = this._cameraShadow;
            u.copy(e.getProjectionMatrix(), this._projectionMatrix),
            u.copy(e.getViewMatrix(), this._viewMatrix)
        },
        setShadowUniformsDepthValue: function() {
            this._depthRange[2] = this._depthRange[1] - this._depthRange[0],
            this._depthRange[3] = 1 / this._depthRange[2],
            -1 !== this._lightNumberArrayIndex ? (this._texture.setViewMatrix(this._lightNumberArrayIndex, this._viewMatrix),
            this._texture.setProjectionMatrix(this._lightNumberArrayIndex, this._projectionMatrix),
            this._texture.setDepthRange(this._lightNumberArrayIndex, this._depthRange)) : (this._texture.setViewMatrix(this._viewMatrix),
            this._texture.setProjectionMatrix(this._projectionMatrix),
            this._texture.setDepthRange(this._depthRange))
        },
        noDraw: function() {
            this._depthRange[0] = 0,
            this._depthRange[1] = 0,
            this._depthRange[2] = 0,
            this._depthRange[3] = 0,
            this._casterStateSet.getUniformList().uShadowDepthRange.getUniform().setVec4(this._depthRange),
            this._texture.setDepthRange(this._depthRange);
            var t = this._cameraShadow;
            u.copy(this._projectionMatrix, t.getProjectionMatrix()),
            u.copy(this._viewMatrix, t.getViewMatrix()),
            -1 !== this._lightNumberArrayIndex ? (this._texture.setViewMatrix(this._lightNumberArrayIndex, this._viewMatrix),
            this._texture.setProjectionMatrix(this._lightNumberArrayIndex, this._projectionMatrix)) : (this._texture.setViewMatrix(this._viewMatrix),
            this._texture.setProjectionMatrix(this._projectionMatrix)),
            this._filledOnce = !0
        },
        cullShadowCasting: function(t) {
            var e;
            if (this._removeNodesNeverCastingVisitor && (this._removeNodesNeverCastingVisitor.setNoCastMask(~(this._castsShadowBoundsTraversalMask | this._castsShadowDrawTraversalMask)),
            this._removeNodesNeverCastingVisitor.reset(),
            this.getShadowedScene().accept(this._removeNodesNeverCastingVisitor)),
            this._computeBoundsVisitor.setTraversalMask(this._castsShadowBoundsTraversalMask),
            this._computeBoundsVisitor.reset(),
            this.getShadowedScene().accept(this._computeBoundsVisitor),
            e = this._computeBoundsVisitor.getBoundingBox(),
            !e.valid())
                return this.noDraw(),
                void (this._removeNodesNeverCastingVisitor && this._removeNodesNeverCastingVisitor.restore());
            if (this._debug) {
                var i = e.getMin()
                  , n = e.getMax();
                e.center(this._tmpVec);
                var r = this._debugNodeSceneCast.getMatrix();
                u.fromScaling(r, [n[0] - i[0], n[1] - i[1], n[2] - i[2], 1]),
                u.setTranslation(r, this._tmpVec)
            }
            var a = t.getCurrentModelMatrix();
            if (e.transformMat4(e, a),
            this._emptyCasterScene = !1,
            this.aimShadowCastingCamera(t, e),
            this._emptyCasterScene)
                return this.noDraw(),
                void (this._removeNodesNeverCastingVisitor && this._removeNodesNeverCastingVisitor.restore());
            var s = t.getTraversalMask();
            t.setTraversalMask(this._castsShadowDrawTraversalMask),
            t.pushStateSet(this._casterStateSet),
            this._cameraShadow.setEnableFrustumCulling(!0),
            this._cameraShadow.setComputeNearFar(!0),
            this._debug && this._debugNode.accept(t),
            this._cameraShadow.accept(t),
            this.nearFarBounding(),
            this.frameShadowCastingFrustum(t),
            this._cameraShadow.setComputeNearFar(!1),
            this._removeNodesNeverCastingVisitor && this._removeNodesNeverCastingVisitor.restore(),
            t.popStateSet(),
            t.setTraversalMask(s),
            this._filledOnce = !0
        },
        cleanReceivingStateSet: function() {
            this._receivingStateset && (this._texture && this._receivingStateset.getTextureAttribute(this._textureUnit, this._texture.getTypeMember()) === this._texture && this._receivingStateset.removeTextureAttribute(this._textureUnit, this._texture.getTypeMember()),
            this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember()) === this._shadowReceiveAttribute && this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()))
        },
        cleanSceneGraph: function() {
            this._cameraShadow = void 0,
            this._filledOnce = !1,
            this.cleanReceivingStateSet(),
            this._texture = void 0,
            this._shadowedScene = void 0
        },
        setDebug: function(t) {
            t && !this._debug && (this._debugNode || (this._debugGeomFrustum = g.createDebugFrustumGeometry(),
            this._debugGeomSceneCast = d.createBoundingBoxGeometry(),
            this._debugGeomSceneCast.getPrimitives()[0].mode = x.LINES,
            this._debugNode = new h,
            this._debugNodeFrustum = new h,
            this._debugNodeSceneCast = new h,
            this._debugNodeFrustum.addChild(this._debugGeomFrustum),
            this._debugNodeSceneCast.addChild(this._debugGeomSceneCast),
            this._debugNode.addChild(this._debugNodeFrustum),
            this._debugNode.addChild(this._debugNodeSceneCast))),
            this._debug = t
        },
        getDebug: function() {
            return this._debug
        }
    }), "osgShadow", "ShadowMap"),
    F.EPSILON = .005,
    b.setTypeID(F),
    t.exports = F
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = i(81)
      , s = i(28)
      , o = function(t, e) {
        r.call(this),
        this._lightNumber = t,
        this._bias = .001,
        this._normalBias = void 0,
        this._precision = "UNSIGNED_BYTE",
        this._kernelSizePCF = void 0,
        this._fakePCF = !0,
        this._rotateOffset = !1,
        this._enable = !e,
        this._isAtlasTexture = !1
    };
    o.uniforms = {},
    o.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "ShadowReceive",
        cloneType: function() {
            return new o(this._lightNumber,!0)
        },
        getTypeMember: function() {
            return this.attributeType + this.getLightNumber()
        },
        getLightNumber: function() {
            return this._lightNumber
        },
        getUniformName: function(t) {
            return "u" + (this.getType() + this.getLightNumber().toString()) + "_" + t
        },
        getAtlas: function() {
            return this._isAtlasTexture
        },
        setAtlas: function(t) {
            this._isAtlasTexture = t
        },
        setBias: function(t) {
            this._bias = t
        },
        getBias: function() {
            return this._bias
        },
        setNormalBias: function(t) {
            this._normalBias = t
        },
        getNormalBias: function() {
            return this._normalBias
        },
        getKernelSizePCF: function() {
            return this._kernelSizePCF
        },
        setKernelSizePCF: function(t) {
            this._kernelSizePCF = t
        },
        setPrecision: function(t) {
            this._precision = t
        },
        getPrecision: function() {
            return this._precision
        },
        setLightNumber: function(t) {
            this._lightNumber = t
        },
        getOrCreateUniforms: function() {
            var t = o
              , e = this.getTypeMember();
            return t.uniforms[e] ? t.uniforms[e] : (t.uniforms[e] = {
                bias: a.createFloat(this.getUniformName("bias")),
                normalBias: a.createFloat(this.getUniformName("normalBias"))
            },
            t.uniforms[e])
        },
        getExtensions: function() {
            return ["#extension GL_OES_standard_derivatives : enable"]
        },
        getDefines: function() {
            var t = this.getPrecision()
              , e = []
              , i = !1;
            switch ("UNSIGNED_BYTE" !== t && (i = !0),
            this.getKernelSizePCF()) {
            case "4Tap(16texFetch)":
                e.push("#define _PCFx4");
                break;
            case "9Tap(36texFetch)":
                e.push("#define _PCFx9");
                break;
            case "16Tap(64texFetch)":
                e.push("#define _PCFx25");
                break;
            default:
            case "1Tap(4texFetch)":
                e.push("#define _PCFx1")
            }
            return i && e.push("#define _FLOATTEX"),
            this.getAtlas() && e.push("#define _ATLAS_SHADOW"),
            this.getNormalBias() && e.push("#define _NORMAL_OFFSET"),
            e
        },
        apply: function() {
            if (this._enable) {
                var t = this.getOrCreateUniforms();
                t.normalBias.setFloat(this._normalBias),
                t.bias.setFloat(this._bias)
            }
        },
        isEnabled: function() {
            return this._enable
        },
        isEnable: function() {
            return s.log("ShadowAttribute.isEnable() is deprecated, use isEnabled() instead"),
            this.isEnabled()
        },
        getHash: function() {
            return this.getTypeMember() + "_" + this.getKernelSizePCF()
        }
    }), "osgShadow", "ShadowReceiveAttribute"),
    n.setTypeID(o),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(93)
      , a = i(81)
      , s = i(13)
      , o = i(5).vec4
      , l = function() {
        r.call(this),
        this._uniforms = {},
        this._mapSize = o.create(),
        this._renderSize = o.create(),
        this._lightNumber = -1
    };
    l.uniforms = {},
    l.prototype = s.objectLibraryClass(s.objectInherit(r.prototype, {
        cloneType: function() {
            return new l
        },
        hasLightNumber: function(t) {
            return this._lightNumber === t
        },
        setLightNumber: function(t) {
            this._lightNumber = t
        },
        getLightNumber: function() {
            return this._lightNumber
        },
        getUniformName: function(t) {
            return "uShadow_" + this.getType() + this._lightNumber.toString() + "_" + t
        },
        getVaryingName: function(t) {
            return "v" + (this.getType() + this._lightNumber.toString()) + "_" + t
        },
        getOrCreateUniforms: function(t) {
            var e = l;
            if (n.assert(void 0 !== t),
            n.assert(-1 !== this._lightNumber),
            void 0 !== e.uniforms[t])
                return e.uniforms[t];
            var i = e.uniforms[t] = {
                ViewMatrix: a.createMat4(this.getUniformName("viewMatrix")),
                ProjectionMatrix: a.createMat4(this.getUniformName("projectionMatrix")),
                DepthRange: a.createFloat4(this.getUniformName("depthRange")),
                MapSize: a.createFloat4(this.getUniformName("mapSize")),
                RenderSize: a.createFloat4(this.getUniformName("renderSize"))
            }
              , r = "Texture" + t
              , s = a.createInt1(t, r);
            return i[r] = s,
            e.uniforms[t]
        },
        setViewMatrix: function(t) {
            this._viewMatrix = t
        },
        setProjectionMatrix: function(t) {
            this._projectionMatrix = t
        },
        setDepthRange: function(t) {
            this._depthRange = t
        },
        setTextureSize: function(t, e) {
            r.prototype.setTextureSize.call(this, t, e),
            this.dirty(),
            this._mapSize[0] = t,
            this._mapSize[1] = e,
            this._mapSize[2] = 1 / t,
            this._mapSize[3] = 1 / e,
            this._renderSize[0] = t,
            this._renderSize[1] = e,
            this._renderSize[2] = 1 / t,
            this._renderSize[3] = 1 / e
        },
        apply: function(t, e) {
            if (r.prototype.apply.call(this, t, e),
            -1 !== this._lightNumber) {
                var i = this.getOrCreateUniforms(e);
                i.ViewMatrix.setMatrix4(this._viewMatrix),
                i.ProjectionMatrix.setMatrix4(this._projectionMatrix),
                i.DepthRange.setFloat4(this._depthRange),
                i.MapSize.setFloat4(this._mapSize),
                i.RenderSize.setFloat4(this._renderSize)
            }
        },
        getHash: function() {
            return this.getTypeMember() + "_" + this._lightNumber + "_" + this._type
        }
    }), "osgShadow", "ShadowTexture"),
    s.setTypeID(l),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(93)
      , a = i(81)
      , s = i(13)
      , o = i(5).vec4
      , l = function() {
        r.call(this),
        this._uniforms = {},
        this._lightNumberArray = [],
        this._viewMatrices = [],
        this._projectionMatrices = [],
        this._depthRanges = [],
        this._mapSizes = [],
        this._renderSize = o.create()
    };
    l.uniforms = {},
    l.prototype = s.objectLibraryClass(s.objectInherit(r.prototype, {
        cloneType: function() {
            return new l
        },
        gettLightNumberArray: function() {
            return this._lightNumberArray
        },
        hasLightNumber: function(t) {
            return -1 !== this._lightNumberArray.indexOf(t)
        },
        setLightNumberArray: function(t) {
            this._lightNumberArray = t;
            var e = t.length;
            this._viewMatrices.length = e,
            this._projectionMatrices.length = e,
            this._depthRanges.length = e,
            this._mapSizes.length = e
        },
        getUniformName: function(t, e) {
            return "uShadow_" + this.getType() + t.toString() + "_" + e
        },
        getVaryingName: function(t, e) {
            return "v" + (this.getType() + t.toString()) + "_" + e
        },
        getOrCreateUniforms: function(t) {
            var e = l;
            if (n.assert(void 0 !== t || 0 !== this._lightNumberArray.length),
            void 0 !== e.uniforms[t])
                return e.uniforms[t];
            var i = e.uniforms[t] = {}
              , r = a.createFloat4(this.getUniformName(0, "renderSize"));
            i.RenderSize = r;
            for (var s = 0, o = this._lightNumberArray.length; s < o; s++) {
                var u = this._lightNumberArray[s];
                i["ViewMatrix_" + u] = a.createMat4(this.getUniformName(u, "viewMatrix")),
                i["ProjectionMatrix_" + u] = a.createMat4(this.getUniformName(u, "projectionMatrix")),
                i["DepthRange_" + u] = a.createFloat4(this.getUniformName(u, "depthRange")),
                i["MapSize_" + u] = a.createFloat4(this.getUniformName(u, "mapSize")),
                i["RenderSize_" + u] = r
            }
            var h = "Texture" + t
              , c = a.createInt1(t, h);
            return i[h] = c,
            e.uniforms[t]
        },
        setViewMatrix: function(t, e) {
            this._viewMatrices[t] = e
        },
        setProjectionMatrix: function(t, e) {
            this._projectionMatrices[t] = e
        },
        setDepthRange: function(t, e) {
            this._depthRanges[t] = e
        },
        setTextureSize: function(t, e) {
            this._renderSize[0] = t,
            this._renderSize[1] = e,
            this._renderSize[2] = 1 / t,
            this._renderSize[3] = 1 / e,
            r.prototype.setTextureSize.call(this, t, e),
            this.dirty()
        },
        setLightShadowMapSize: function(t, e) {
            this._mapSizes[t] = e
        },
        apply: function(t, e) {
            if (r.prototype.apply.call(this, t, e),
            0 !== this._lightNumberArray.length) {
                for (var i = this.getOrCreateUniforms(e), n = 0, a = this._lightNumberArray.length; n < a; n++) {
                    var s = this._lightNumberArray[n];
                    i["ViewMatrix_" + s].setMatrix4(this._viewMatrices[n]),
                    i["ProjectionMatrix_" + s].setMatrix4(this._projectionMatrices[n]),
                    i["DepthRange_" + s].setFloat4(this._depthRanges[n]),
                    i["MapSize_" + s].setFloat4(this._mapSizes[n]),
                    i["RenderSize_" + s].setFloat4(this._renderSize)
                }
                i.RenderSize.setFloat4(this._renderSize)
            }
        },
        getHash: function() {
            for (var t = this.getTypeMember(), e = 0, i = this._lightNumberArray.length; e < i; e++)
                t += "_" + this._lightNumberArray[e];
            return t += "_" + this._type
        }
    }), "osgShadow", "ShadowTextureAtlas"),
    s.setTypeID(l),
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).vec3
      , a = i(5).vec4
      , s = i(5).mat4
      , o = i(515)
      , l = i(163)
      , u = i(380)
      , h = i(93)
      , c = i(376)
      , d = i(5).quat
      , p = i(65)
      , f = i(128)
      , g = function(t) {
        o.call(this),
        this._canvas = document.createElement("canvas"),
        this._context = this._canvas.getContext("2d"),
        this._matrixTransform = new l,
        this.addChild(this._matrixTransform),
        this._text = "",
        void 0 !== t && (this._text = t),
        this._font = "monospace",
        this._color = a.fromValues(0, 0, 0, 1),
        this._fillStyle = "rgba( 0, 0, 0, 1 )",
        this._context.textAlign = "center",
        this._textX = void 0,
        this._context.baseLine = "middle",
        this._textY = void 0,
        this._characterSize = 1,
        this._characterSizeMode = g.OBJECT_COORDS,
        this._fontSize = 32,
        this._geometry = void 0,
        this._autoRotateToScreen = !1,
        this._position = r.create(),
        this._layout = g.LEFT_TO_RIGHT,
        this._alignment = g.CENTER_CENTER,
        this._forcePowerOfTwo = !1,
        this._texture = new h,
        this.drawText(),
        this._dirty = !1,
        this._previousModelView = s.create()
    };
    g.OBJECT_COORDS = 0,
    g.SCREEN_COORDS = 1,
    g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT = 2,
    g.LEFT_TO_RIGHT = "ltr",
    g.RIGHT_TO_LEFT = "rtl",
    g.LEFT_TOP = 0,
    g.LEFT_CENTER = 1,
    g.LEFT_BOTTOM = 2,
    g.CENTER_TOP = 3,
    g.CENTER_CENTER = 4,
    g.CENTER_BOTTOM = 5,
    g.RIGHT_TOP = 6,
    g.RIGHT_CENTER = 7,
    g.RIGHT_BOTTOM = 8,
    g.prototype = n.objectLibraryClass(n.objectInherit(o.prototype, {
        drawText: function() {
            if (void 0 !== this._geometry && (this._matrixTransform.removeChild(this._geometry),
            this._geometry.releaseGLObjects()),
            this._text) {
                this.setTextProperties(),
                this._canvas.width = this._context.measureText(this._text).width,
                this._canvas.height = 2 * this._fontSize,
                this._forcePowerOfTwo && (this._canvas.width = this._nextPowerOfTwo(this._canvas.width),
                this._canvas.height = this._nextPowerOfTwo(this._canvas.height)),
                this.setTextProperties(),
                this._context.clearRect(0, 0, this._canvas.width, this._canvas.height),
                this._context.fillText(this._text, this._textX, this._textY);
                var t = this._canvas.width / this._canvas.height
                  , e = this._characterSize * t;
                this._geometry = u.createTexturedQuadGeometry(-e / 2, -this._characterSize / 2, 0, e, 0, 0, 0, this._characterSize, 0),
                this._texture.setTextureSize(this._canvas.width, this._canvas.height),
                this._texture.setMinFilter("LINEAR"),
                this._texture.setMagFilter("LINEAR"),
                this._texture.setImage(this._canvas);
                var i = this._geometry.getOrCreateStateSet();
                i.setTextureAttributeAndModes(0, this._texture),
                i.setRenderingHint("TRANSPARENT_BIN"),
                i.setAttributeAndModes(new c(c.ONE,c.ONE_MINUS_SRC_ALPHA)),
                this._matrixTransform.addChild(this._geometry),
                this.dirtyBound()
            }
        },
        setText: function(t) {
            this._text = t,
            this._dirty = !0
        },
        getText: function() {
            return this._text
        },
        setFont: function(t) {
            this._font = t,
            this._dirty = !0
        },
        setColor: function(t) {
            this._color = t,
            this._fillStyle = "rgba(" + Math.round(255 * t[0]) + "," + Math.round(255 * t[1]) + "," + Math.round(255 * t[2]) + "," + t[3] + ")",
            this._context.fillStyle = this._fillStyle,
            this._context.fillText(this._text, this._textX, this._textY)
        },
        getColor: function() {
            return this._color
        },
        setCharacterSize: function(t) {
            this._characterSize = t,
            this._characterSizeMode !== g.OBJECT_COORDS && (s.fromScaling(this._matrixTransform.getMatrix(), [this._characterSize, this._characterSize, this._characterSize]),
            this._characterSizeMode === g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT && this.setMaximumScale(this._characterSize)),
            this._dirty = !0
        },
        getCharacterSize: function() {
            return this._characterSize
        },
        setCharacterSizeMode: function(t) {
            this._characterSizeMode = t,
            this._characterSizeMode !== g.OBJECT_COORDS ? (s.fromScaling(this._matrixTransform.getMatrix(), [this._characterSize, this._characterSize, this._characterSize]),
            this.setAutoScaleToScreen(!0),
            this.setMaximumScale(Number.MAX_VALUE),
            this._characterSizeMode === g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT && this.setMaximumScale(this._characterSize)) : (this._matrixTransform.setMatrix(s.create()),
            this.setAutoScaleToScreen(!1)),
            this._dirty = !0
        },
        getCharacterSizeMode: function() {
            return this._characterSizeMode
        },
        setFontResolution: function(t) {
            this._fontSize = t,
            this._dirty = !0
        },
        getFontResolution: function() {
            return this._fontSize
        },
        setPosition: function(t) {
            this._position = t,
            s.fromTranslation(this.getMatrix(), t)
        },
        getPosition: function() {
            return this._position
        },
        setTextProperties: function() {
            this._context.fillStyle = this._fillStyle,
            this._setAlignmentValues(this._alignment),
            this._context.font = this._fontSize + "px " + this._font,
            this._context.direction = this._layout
        },
        setAutoRotateToScreen: function(t) {
            o.prototype.setAutoRotateToScreen.call(this, t),
            this._dirty = !0
        },
        getAutoRotateToScreen: function() {
            return this._autoRotateToScreen
        },
        setLayout: function(t) {
            this._layout = "string" == typeof t ? g[t] : t,
            this._dirty = !0
        },
        getLayout: function() {
            return this._layout
        },
        setAlignment: function(t) {
            this._alignment = "string" == typeof t ? g[t] : t,
            this._dirty = !0
        },
        getAlignment: function() {
            return this._alignment
        },
        accept: function() {
            return function(t) {
                if (this._dirty && (this.drawText(),
                this._dirty = !1),
                t.getVisitorType() === p.CULL_VISITOR) {
                    var e = t.getViewport().width()
                      , i = t.getViewport().height()
                      , n = t.getCurrentProjectionMatrix()
                      , o = t.getCurrentModelViewMatrix()
                      , l = this._position
                      , u = this._firstTimeToInitEyePoint;
                    if (this._firstTimeToInitEyePoint || (s.exactEquals(o, this._previousModelView) ? e !== this._previousWidth || i !== this._previousHeight ? u = !0 : s.exactEquals(n, this._previousProjection) ? r.exactEquals(l, this._previousPosition) || (u = !0) : u = !0 : u = !0),
                    this._firstTimeToInitEyePoint = !1,
                    u) {
                        if (this._autoScaleToScreen) {
                            var h = t.getViewport()
                              , c = this.computePixelSizeVector(h, n, o)
                              , g = a.fromValues(this._position[0], this._position[1], this._position[2], 1)
                              , m = a.dot(g, c);
                            m = .48 / m;
                            var v = 1 / m;
                            if (this._autoScaleTransitionWidthRatio > 0) {
                                var _, b, x;
                                if (this._minimumScale > 0) {
                                    var y = this._minimumScale
                                      , S = this._maximumScale < Number.MAX_VALUE ? this._minimumScale + (this._maximumScale - this._minimumScale) * this._autoScaleTransitionWidthRatio : this._minimumScale * (1 + this._autoScaleTransitionWidthRatio);
                                    _ = 1 / (4 * (S - y)),
                                    b = 1 - 2 * _ * S,
                                    x = y + b * b / (4 * _);
                                    v < -b / (2 * _) ? v = this._minimumScale : v < S && (v = x + b * v + _ * (v * v))
                                }
                                if (this._maximumScale < Number.MAX_VALUE) {
                                    var w = this._maximumScale
                                      , C = this._minimumScale > 0 ? this._maximumScale + (this._minimumScale - this._maximumScale) * this._autoScaleTransitionWidthRatio : this._maximumScale * (1 - this._autoScaleTransitionWidthRatio);
                                    _ = 1 / (4 * (C - w)),
                                    b = 1 - 2 * _ * C,
                                    x = w + b * b / (4 * _);
                                    v > -b / (2 * _) ? v = this._maximumScale : v > C && (v = x + b * v + _ * (v * v))
                                }
                            }
                            this.setScale(v)
                        }
                        if (this._autoRotateToScreen) {
                            var M = d.create()
                              , T = t.getCurrentModelViewMatrix();
                            s.getRotation(M, T),
                            this.setRotation(d.invert(M, M))
                        }
                        this._previousWidth = e,
                        this._previousHeight = i,
                        r.copy(this._previousPosition, l),
                        s.copy(this._previousProjection, n),
                        s.copy(this._previousModelView, o)
                    }
                }
                f.prototype.accept.call(this, t)
            }
        }(),
        _setAlignmentValues: function(t) {
            switch (t) {
            case g.LEFT_TOP:
                this._context.textAlign = "left",
                this._textX = 0,
                this._context.textBaseline = "top",
                this._textY = 0;
                break;
            case g.LEFT_CENTER:
                this._context.textAlign = "left",
                this._textX = 0,
                this._context.textBaseline = "middle",
                this._textY = this._canvas.height / 2;
                break;
            case g.LEFT_BOTTOM:
                this._context.textAlign = "left",
                this._textX = 0,
                this._context.textBaseline = "bottom",
                this._textY = this._canvas.height;
                break;
            case g.CENTER_TOP:
                this._context.textAlign = "center",
                this._textX = this._canvas.width / 2,
                this._context.textBaseline = "top",
                this._textY = 0;
                break;
            case g.CENTER_CENTER:
                this._context.textAlign = "center",
                this._textX = this._canvas.width / 2,
                this._context.textBaseline = "middle",
                this._textY = this._canvas.height / 2;
                break;
            case g.CENTER_BOTTOM:
                this._context.textAlign = "center",
                this._textX = this._canvas.width / 2,
                this._context.textBaseline = "bottom",
                this._textY = this._canvas.height;
                break;
            case g.RIGHT_TOP:
                this._context.textAlign = "right",
                this._textX = this._canvas.width,
                this._context.textBaseline = "top",
                this._textY = 0;
                break;
            case g.RIGHT_CENTER:
                this._context.textAlign = "right",
                this._textX = this._canvas.width,
                this._context.textBaseline = "middle",
                this._textY = this._canvas.height / 2;
                break;
            case g.RIGHT_BOTTOM:
                this._context.textAlign = "right",
                this._textX = this._canvas.width,
                this._context.textBaseline = "bottom",
                this._textY = this._canvas.height
            }
        },
        setForcePowerOfTwo: function(t) {
            this._forcePowerOfTwo = t
        },
        getForcePowerOfTwo: function() {
            return this._forcePowerOfTwo
        },
        _nextPowerOfTwo: function(t) {
            var e = t;
            return e--,
            e |= e >> 1,
            e |= e >> 2,
            e |= e >> 4,
            e |= e >> 8,
            e |= e >> 16,
            ++e
        }
    }), "osgText", "Text"),
    t.exports = g
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(65)
      , a = i(143)
      , s = i(415)
      , o = i(81)
      , l = i(287)
      , u = i(5).vec3
      , h = i(437)
      , c = i(436)
      , d = i(162)
      , p = i(320)
      , f = i(134)
      , g = i(163)
      , m = i(377)
      , v = function() {
        c.apply(this, arguments)
    };
    v.prototype = n.objectInherit(c.prototype, {
        getCompilerName: function() {
            return "CompilerDebugGeometry"
        },
        initTextureAttributes: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.getNode("SetAlpha").inputs({
                color: this.getOrCreateUniform("vec3", "uColorDebug"),
                alpha: this.createVariable("float").setValue("1.0")
            }).outputs({
                color: t
            }),
            [t]
        }
    });
    var _ = function() {
        h.apply(this, arguments),
        this.setShaderCompiler(v)
    };
    _.prototype = h.prototype;
    var b = function() {
        c.apply(this, arguments)
    };
    b.prototype = n.objectInherit(c.prototype, {
        getCompilerName: function() {
            return "CompilerDebugSkinning"
        },
        initTextureAttributes: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.getNode("SetAlpha").inputs({
                color: this.getOrCreateVarying("vec3", "vBonesColor"),
                alpha: this.createVariable("float").setValue("1.0")
            }).outputs({
                color: t
            }),
            [t]
        },
        declareVertexVaryings: function(t) {
            var e = this.getOrCreateVarying("vec3", "vBonesColor");
            return this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec3", "BonesColor")).outputs(e),
            c.prototype.declareVertexVaryings.call(this, t)
        }
    });
    var x = function() {
        h.apply(this, arguments),
        this.setShaderCompiler(b)
    };
    x.prototype = h.prototype;
    var y = function() {
        r.call(this),
        this._debugColor = !0,
        this._debugSkinning = !1,
        this._stCenter = new l,
        this._stCenter.setShaderGeneratorName("debugGeometry")
    };
    y.CompilerColorGeometry = v,
    y.ShaderGeneratorCompilerColorGeometry = _,
    y.CompilerSkinningGeometry = b,
    y.ShaderGeneratorCompilerColorSkinning = x,
    y.prototype = n.objectInherit(r.prototype, {
        setGeometryDebug: function(t) {
            this._stCenter.setAttributeAndModes(new m(m.ALWAYS)),
            this._debugColor = !0,
            this._debugSkinning = !1,
            this.apply(t)
        },
        setSkinningDebug: function(t) {
            this._stCenter.setAttributeAndModes(new m(m.NEVER)),
            this._debugColor = !1,
            this._debugSkinning = !0,
            this.apply(t)
        },
        disableDebug: function(t) {
            this._stCenter.setAttributeAndModes(new m(m.NEVER)),
            this._debugColor = !1,
            this._debugSkinning = !1,
            this.apply(t)
        },
        apply: function(t) {
            if (!t._isNormalDebug && !t._isCenterDebug) {
                if (t instanceof a)
                    if (this._debugColor || this._debugSkinning && t instanceof s) {
                        void 0 === t._originalStateSet && (t._originalStateSet = t.getStateSet() || null);
                        var e = new l;
                        if (t.setStateSet(e),
                        this._debugSkinning) {
                            e.setShaderGeneratorName("debugSkinning");
                            var i = t.getVertexAttributeList();
                            if (!i.BonesColor) {
                                for (var n = i.Bones.getElements(), r = i.Weights.getElements(), h = t._rigTransformImplementation._bones, c = n.length / 4, m = new Float32Array(3 * c), v = 0; v < c; ++v) {
                                    var _ = 4 * v
                                      , b = h[n[_]].getOrCreateDebugColor()
                                      , x = h[n[_ + 1]].getOrCreateDebugColor()
                                      , y = h[n[_ + 2]].getOrCreateDebugColor()
                                      , S = h[n[_ + 3]].getOrCreateDebugColor()
                                      , w = r[_]
                                      , C = r[_ + 1]
                                      , M = r[_ + 2]
                                      , T = r[_ + 3]
                                      , A = 3 * v;
                                    m[A] = w * b[0] + C * x[0] + M * y[0] + T * S[0],
                                    m[A + 1] = w * b[1] + C * x[1] + M * y[1] + T * S[1],
                                    m[A + 2] = w * b[2] + C * x[2] + M * y[2] + T * S[2]
                                }
                                i.BonesColor = new d(d.ARRAY_BUFFER,m,3)
                            }
                        } else {
                            var E = u.fromValues(Math.random(), Math.random(), Math.random());
                            e.addUniform(o.createFloat3(E, "uColorDebug")),
                            e.setShaderGeneratorName("debugGeometry");
                            var P = t.getBound()
                              , N = new Float32Array(18)
                              , k = .1 * P.radius();
                            N[0] = k,
                            N[3] = -k,
                            N[7] = k,
                            N[10] = -k,
                            N[14] = k,
                            N[17] = -k;
                            var F = new a;
                            F.getAttributes().Vertex = new d(d.ARRAY_BUFFER,N,3);
                            var D = new p(f.LINES,0,6);
                            F.getPrimitives().push(D);
                            var R = new g
                              , I = P.center();
                            R.getMatrix()[12] = I[0],
                            R.getMatrix()[13] = I[1],
                            R.getMatrix()[14] = I[2],
                            R.addChild(F),
                            this.nodePath[this.nodePath.length - 2].addChild(R),
                            E = u.fromValues(.8 * E[0], .8 * E[1], .8 * E[2]),
                            F.getOrCreateStateSet().addUniform(o.createFloat3(E, "uColorDebug")),
                            R.setStateSet(this._stCenter),
                            R._isCenterDebug = !0
                        }
                    } else
                        void 0 !== t._originalStateSet && t.setStateSet(t._originalStateSet || void 0);
                this.traverse(t)
            }
        }
    }),
    t.exports = y
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(65)
      , a = i(381)
      , s = function(t) {
        r.call(this, r.TRAVERSE_ALL_CHILDREN),
        this._selectables = t,
        this._nodeList = [],
        this._linkList = [],
        this._uniqueNodes = new window.Set,
        this._uniqueEdges = new window.Set
    };
    s.prototype = n.objectInherit(r.prototype, {
        getColorFromClassName: function(t) {
            switch (t) {
            case "ShadowedScene":
                return "#3D3D3D";
            case "Camera":
                return "#AB7BCF";
            case "RenderBin":
                return "#59778B";
            case "LightSource":
                return "#53967D";
            case "RenderStage":
                return "#DDCC55";
            case "RenderLeaf":
            case "Geometry":
                return "#FFCC55";
            case "RigGeometry":
                return "#DD8800";
            case "MorphGeometry":
                return "#AA5500";
            case "MatrixTransform":
                return "#CE697E";
            case "StateSet":
                return "#0099FF";
            case "StateGraph":
            case "Skeleton":
                return "#96999E";
            case "Bone":
                return "#A9DEAA";
            case "Node":
                return "#FFFFFF";
            default:
                return "#FF00AA"
            }
        },
        createGraph: function(t) {
            this.reset(),
            t.accept(this)
        },
        reset: function() {
            this._nodeList.length = 0,
            this._linkList.length = 0,
            this._uniqueNodes.clear(),
            this._uniqueEdges.clear()
        },
        apply: function(t) {
            if (!t._isNormalDebug) {
                if (this._uniqueNodes.has(t.getInstanceID()) || (this._uniqueNodes.add(t.getInstanceID()),
                this._nodeList.push(t)),
                this.nodePath.length >= 2) {
                    var e = this.nodePath[this.nodePath.length - 2].getInstanceID()
                      , i = t.getInstanceID()
                      , n = e + "+" + i;
                    this._uniqueEdges.has(n) || (this._linkList.push({
                        parentNode: e,
                        childrenNode: i
                    }),
                    this._uniqueEdges.add(n))
                }
                this.traverse(t)
            }
        },
        createMatrixGrid: function(t, e) {
            var i = "";
            return i += "<table><tr><td>" + e[0] + "</td>",
            i += "<td>" + e[4] + "</td>",
            i += "<td>" + e[8] + "</td>",
            i += "<td>" + e[12] + "</td></tr>",
            i += "<tr><td>" + e[1] + "</td>",
            i += "<td>" + e[5] + "</td>",
            i += "<td>" + e[9] + "</td>",
            i += "<td>" + e[13] + "</td></tr>",
            i += "<tr><td>" + e[2] + "</td>",
            i += "<td>" + e[6] + "</td>",
            i += "<td>" + e[10] + "</td>",
            i += "<td>" + e[14] + "</td></tr>",
            i += "<tr><td>" + e[3] + "</td>",
            i += "<td>" + e[7] + "</td>",
            i += "<td>" + e[11] + "</td>",
            i += "<td>" + e[15] + "</td></tr></table>"
        },
        getLabel: function(t) {
            var e = t.className() + " (" + t.getInstanceID() + ")";
            return t.getName && t.getName() && (e += "\n" + t.getName()),
            e
        },
        generateNode: function(t, e) {
            var i = "";
            e.getMatrix && e.getMatrix() && (i += "<br /><br />" + this.createMatrixGrid(e, e.getMatrix())),
            this._selectables.set(e.getInstanceID().toString(), e),
            t.addNode(e.getInstanceID(), {
                label: this.getLabel(e),
                description: i,
                style: "fill: " + this.getColorFromClassName(e.className()) + ";stroke-width: 0px;"
            })
        },
        generateStateSet: function(t, e) {
            var i = e.getStateSet()
              , n = i.getInstanceID()
              , r = this.getLabel(i);
            r += "\nNbTexture : " + i.getNumTextureAttributeLists(),
            t.hasNode(n) || (this._selectables.set(n.toString(), i),
            t.addNode(n, {
                label: r,
                style: "fill: " + this.getColorFromClassName(i.className()) + ";stroke-width: 0px;"
            })),
            t.addEdge(null, e.getInstanceID(), n, {
                style: "stroke: " + this.getColorFromClassName(i.className()) + ";"
            })
        },
        generateSourceGeometry: function(t, e) {
            var i = e.getSourceGeometry()
              , n = i.getInstanceID();
            this._selectables.set(n.toString(), i),
            t.addNode(n, {
                label: this.getLabel(i),
                style: "fill: " + this.getColorFromClassName(i.className()) + ";stroke-width: 0px;"
            }),
            t.addEdge(null, e.getInstanceID(), n, {
                style: "stroke: " + this.getColorFromClassName(i.className()) + ";"
            })
        },
        generateNodeAndLink: function(t) {
            for (var e = 0, i = this._nodeList.length; e < i; e++) {
                var n = this._nodeList[e];
                this.generateNode(t, n),
                n.getStateSet() && this.generateStateSet(t, n),
                n.getSourceGeometry && n.getSourceGeometry()instanceof a && this.generateSourceGeometry(t, n)
            }
            for (var r = 0, s = this._linkList.length; r < s; r++)
                t.addEdge(null, this._linkList[r].parentNode, this._linkList[r].childrenNode)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(65)
      , a = i(143)
      , s = i(162)
      , o = i(320)
      , l = i(134)
      , u = i(287)
      , h = i(81)
      , c = i(377)
      , d = i(5).vec3
      , p = i(437)
      , f = i(436)
      , g = i(415)
      , m = i(381)
      , v = i(527)
      , _ = function() {
        f.apply(this, arguments)
    };
    _.prototype = n.objectInherit(f.prototype, {
        getCompilerName: function() {
            return "CompilerOffsetNormal"
        },
        initTextureAttributes: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.getNode("SetAlpha").inputs({
                color: this.getOrCreateUniform("vec3", "uColorDebug"),
                alpha: this.createVariable("float").setValue("1.0")
            }).outputs({
                color: t
            }),
            [t]
        },
        getOffsetDirection: function() {
            return this.getOrCreateModelNormal()
        },
        getOrCreateModelVertex: function() {
            var t = this.getVariable("vertexOffset");
            if (t)
                return t;
            t = this.createVariable("vec3", "vertexOffset");
            return this.getNode("InlineCode").code("%out = %offset == 1.0 ? %vertex + normalize(%direction.xyz) * %scale: %vertex;").inputs({
                offset: this.getOrCreateAttribute("float", "Offset"),
                direction: this.getOffsetDirection(),
                vertex: f.prototype.getOrCreateModelVertex.call(this),
                scale: this.getOrCreateUniform("float", "uScale")
            }).outputs({
                out: t
            }),
            t
        },
        getOrCreateViewVertex: function() {
            var t = this._variables.FragEyeVector;
            return t && !t.isEmpty() ? t : (t = this._varyings.FragEyeVector || this.createVariable("vec4", "FragEyeVector"),
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uViewMatrix"),
                vec: this.getOrCreateModelVertex()
            }).outputs({
                vec: t
            }),
            t)
        }
    });
    var b = function() {
        p.apply(this, arguments),
        this.setShaderCompiler(_)
    };
    b.prototype = p.prototype;
    var x = function() {
        _.apply(this, arguments)
    };
    x.prototype = n.objectInherit(_.prototype, {
        getCompilerName: function() {
            return "CompilerOffsetTangent"
        },
        getOffsetDirection: function() {
            return this.getOrCreateModelTangent()
        }
    });
    var y = function() {
        p.apply(this, arguments),
        this.setShaderCompiler(x)
    };
    y.prototype = p.prototype;
    var S = function() {
        r.call(this),
        this._unifScale = h.createFloat(1, "uScale");
        var t = this._normalStateSet = new u;
        t.addUniform(h.createFloat3(d.fromValues(1, 0, 0), "uColorDebug")),
        t.addUniform(this._unifScale),
        t.setAttributeAndModes(new c(c.NEVER)),
        t.setShaderGeneratorName("debugNormal");
        var e = this._tangentStateSet = new u;
        e.addUniform(h.createFloat3(d.fromValues(0, 1, 0), "uColorDebug")),
        e.addUniform(this._unifScale),
        e.setAttributeAndModes(new c(c.NEVER)),
        e.setShaderGeneratorName("debugTangent")
    };
    S.CompilerOffsetNormal = _,
    S.CompilerOffsetTangent = x,
    S.ShaderGeneratorCompilerOffsetNormal = b,
    S.ShaderGeneratorCompilerOffsetTangent = y,
    S.prototype = n.objectInherit(r.prototype, {
        setScale: function(t) {
            this._unifScale.setFloat(t)
        },
        setTangentVisibility: function(t) {
            this._tangentStateSet.setAttributeAndModes(new c(t ? c.LESS : c.NEVER))
        },
        setNormalVisibility: function(t) {
            this._normalStateSet.setAttributeAndModes(new c(t ? c.LESS : c.NEVER))
        },
        apply: function(t) {
            for (var e = t.getUpdateCallbackList(), i = 0, n = e.length; i < n; ++i)
                e[i]instanceof v && (e[i]._isInitialized = !1);
            if (!t._isVisitedNormalDebug) {
                if (t._isVisitedNormalDebug = !0,
                t instanceof a == !1)
                    return this.traverse(t);
                this._createDebugGeom(t, "Normal", this._normalStateSet),
                this._createDebugGeom(t, "Tangent", this._tangentStateSet)
            }
        },
        _createDoubleOffsetArray: function(t) {
            for (var e = new Float32Array(2 * t), i = 0; i < t; ++i)
                e[2 * i] = 1;
            return new s(s.ARRAY_BUFFER,e,1)
        },
        _createDoubledBufferArray: function(t) {
            t.getInitialBufferArray && (t = t.getInitialBufferArray());
            for (var e = t.getItemSize(), i = t.getElements(), n = i.length / e, r = i.constructor, a = new r(2 * i.length), o = 0; o < n; ++o)
                for (var l = o * e, u = 2 * l, h = 0; h < e; ++h)
                    a[u + h] = a[u + h + e] = i[l + h];
            return new s(s.ARRAY_BUFFER,a,e)
        },
        _addMorphTargets: function(t, e, i) {
            var n = e.getMorphTargets();
            e.setName(t.getName());
            for (var r = t.getMorphTargets(), s = 0, o = r.length; s < o; ++s) {
                var l = r[s]
                  , u = l.getVertexAttributeList()
                  , h = new a;
                h.setName(l.getName());
                var c = h.getVertexAttributeList();
                c.Vertex = this._createDoubledBufferArray(u.Vertex),
                u[i] && (c[i] = this._createDoubledBufferArray(u[i])),
                n.push(h)
            }
            return e.mergeChildrenVertexAttributeList(),
            e
        },
        _createDebugGeom: function(t, e, i) {
            var n = t.getAttributes()
              , r = n[e];
            if (r) {
                var s = n.Vertex;
                if (s) {
                    var u;
                    t instanceof m ? u = t : t.getSourceGeometry && t.getSourceGeometry()instanceof m && (u = t.getSourceGeometry());
                    var h = s.getElements().length / s.getItemSize()
                      , c = u ? new m : new a;
                    c.getAttributes().Vertex = this._createDoubledBufferArray(s),
                    c.getAttributes().Offset = this._createDoubleOffsetArray(h),
                    c.getAttributes()[e] = this._createDoubledBufferArray(r),
                    c.getPrimitives().push(new o(l.LINES,0,2 * h)),
                    u && this._addMorphTargets(u, c, e);
                    var d;
                    if (t instanceof g) {
                        var p = new g;
                        p.setSourceGeometry(c),
                        p.getVertexAttributeList().Bones = this._createDoubledBufferArray(n.Bones),
                        p.getVertexAttributeList().Weights = this._createDoubledBufferArray(n.Weights),
                        p._rigTransformImplementation = t._rigTransformImplementation,
                        p._stateSetAnimation = t._stateSetAnimation,
                        p.mergeChildrenData(),
                        d = p
                    } else
                        d = c;
                    var f = t.getParents()
                      , v = f.length;
                    d._isVisitedNormalDebug = !0,
                    d._isNormalDebug = !0,
                    d.setStateSet(i);
                    for (var _ = 0; _ < v; ++_)
                        f[_].addChild(d);
                    return d
                }
            }
        }
    }),
    t.exports = S
}
, function(t, e, i) {
    "use strict";
    var n = i(662)
      , r = i(5).vec4
      , a = i(5).vec3
      , s = i(411)
      , o = function() {
        this._intersections = [],
        this._index = 0,
        this._polytope = [],
        this._iPolytope = [],
        this._referencePlane = r.create(),
        this._iReferencePlane = r.create(),
        this._intersectionLimit = o.NO_LIMIT,
        this._dimensionMask = o.AllDims
    };
    o.NO_LIMIT = 0,
    o.LIMIT_ONE_PER_DRAWABLE = 1,
    o.LIMIT_ONE = 2,
    o.DimZero = 1,
    o.DimOne = 2,
    o.DimTwo = 4,
    o.AllDims = o.DimZero | o.DimOne | o.DimTwo;
    var l = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3];
        t[0] = i[0] * n + i[1] * r + i[2] * a + i[3] * s,
        t[1] = i[4] * n + i[5] * r + i[6] * a + i[7] * s,
        t[2] = i[8] * n + i[9] * r + i[10] * a + i[11] * s,
        t[3] = i[12] * n + i[13] * r + i[14] * a + i[15] * s
    };
    o.prototype = {
        setPolytope: function(t) {
            var e = t.length;
            this._polytope.length = t.length = e;
            for (var i = 0; i < e; ++i) {
                var n = t[i];
                this._polytope[i] = r.copy(this._polytope[i] || s.create(), n),
                this._iPolytope[i] = r.copy(this._iPolytope[i] || s.create(), n)
            }
            r.copy(this._referencePlane, t[e - 1]),
            r.copy(this._iReferencePlane, this._referencePlane)
        },
        setPolytopeFromWindowCoordinates: function(t, e, i, n) {
            this.setPolytope([r.fromValues(1, 0, 0, -t), r.fromValues(-1, 0, 0, i), r.fromValues(0, 1, 0, -e), r.fromValues(0, -1, 0, n), r.fromValues(0, 0, 1, 0)])
        },
        setDimensionMask: function(t) {
            this._dimensionMask = t
        },
        reset: function() {
            this._intersections.length = 0
        },
        enter: function(t) {
            return !this.reachedLimit() && (!t.isCullingActive() || this.intersects(t.getBound()))
        },
        reachedLimit: function() {
            return this._intersectionLimit === o.LIMIT_ONE && this._intersections.length > 0
        },
        intersects: function(t) {
            if (!t.valid())
                return !1;
            for (var e = t.center(), i = -t.radius(), n = 0, r = this._iPolytope.length; n < r; n++)
                if (s.distanceToPlane(this._iPolytope, e) <= i)
                    return !1;
            return !0
        },
        intersect: function(t, e) {
            if (this.reachedLimit())
                return !1;
            var i = new n;
            i.setNodePath(t.nodePath),
            i.set(this._iPolytope, this._iReferencePlane),
            i.setLimitOneIntersection(this._intersectionLimit === o.LIMIT_ONE_PER_DRAWABLE || this._intersectionLimit === o.LIMIT_ONE),
            i.setDimensionMask(this._dimensionMask),
            i.apply(e);
            var r = i._intersections.length;
            if (r > 0) {
                for (var a = 0; a < r; a++)
                    this._intersections.push(i._intersections[a]);
                return !0
            }
            return !1
        },
        getIntersections: function() {
            return this._intersections
        },
        setIntersectionLimit: function(t) {
            this._intersectionLimit = t
        },
        setCurrentTransformation: function(t) {
            for (var e = 0, i = this._polytope.length; e < i; e++) {
                var n = this._iPolytope[e] = this._iPolytope[e] || r.create();
                l(n, this._polytope[e], t),
                r.scale(n, n, 1 / a.len(n))
            }
            l(this._iReferencePlane, this._referencePlane, t),
            r.scale(this._iReferencePlane, this._iReferencePlane, 1 / a.len(this._iReferencePlane))
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(379)
      , r = i(5).vec3
      , a = i(608)
      , s = i(411)
      , o = function(t, e, i, n, a) {
        this._index = t - 1,
        this._distance = 0,
        this._maxDistance = -1,
        this._numPoints = 0,
        this._points = [],
        this._maxNumIntersections = 6,
        this._center = r.create();
        for (var o = 0, l = e.length; o < l; o++)
            if (0 !== i[o]) {
                this._points[this._numPoints++] = r.clone(e[o]),
                r.add(this._center, this._center, e[o]);
                var u = s.distanceToPlane(n, e[o]);
                if (u > this._maxDistance && (this._maxDistance = u),
                this._numPoints === this._maxNumIntesections)
                    break
            }
        r.scale(this._center, this._center, 1 / this._numPoints),
        this._distance = s.distanceToPlane(n, this._center),
        this.nodePath = a
    }
      , l = function(t, e, i) {
        this._planeMask = t,
        this._pos = e,
        this._dir = i
    }
      , u = function() {
        this._intersections = [],
        this._nodePath = [],
        this._index = 0,
        this._referencePlane = [],
        this._planes = [],
        this._lines = [],
        this._candidates = [],
        this._candidatesMasks = [],
        this._lines = [],
        this._planesMask = 0,
        this._limitOneIntersection = !1,
        this._dimensionMask = void 0
    };
    u.prototype = {
        setNodePath: function(t) {
            this._nodePath = t
        },
        set: function(t, e) {
            this._planes = t,
            this._referencePlane = e,
            this._planesMask = 0,
            this._lines.length = 0;
            for (var i = 0; i < this._planes.length; i++)
                this._planesMask = this._planesMask << 1 | 1
        },
        setDimensionMask: function(t) {
            this._dimensionMask = t
        },
        apply: function(t) {
            if (t.getAttributes().Vertex) {
                var e = t.getAttributes().Vertex.getElements()
                  , i = this;
                new a(t,function() {
                    return {
                        operatorPoint: function(t) {
                            i.intersectPoint(t)
                        },
                        operatorLine: function(t, e) {
                            i.intersectLine(t, e)
                        },
                        operatorTriangle: function(t, e, n) {
                            i.intersectTriangle(t, e, n)
                        }
                    }
                }
                ,e).apply()
            }
        },
        checkCandidatePoints: function(t) {
            for (var e = 1, i = this._candidates.length, n = 0, r = this._planes.length; n < r && i > 0; ++n,
            e <<= 1)
                if (!(t & e))
                    for (var a = 0; a < this._candidates.length; ++a)
                        if (0 !== this._candidatesMasks[a] && !(e & this._candidatesMasks[a]) && this.distance(this._planes[n], this._candidates[a]) < 0 && (this._candidatesMasks[a] = 0,
                        0 === --i))
                            return 0;
            return i
        },
        intersectPoint: function() {
            var t = r.create();
            return function(e) {
                if (this._index++,
                0 != (1 & this._dimensionMask) && !(this._limitOneIntersection && this._intersections.length > 0)) {
                    for (var i = 0, n = this._planes.length; i < n; ++i)
                        if (this.distance(this._planes[i], e) < 0)
                            return;
                    this._candidates = [],
                    this._candidatesMasks = [],
                    r.copy(t, e),
                    this._candidates.push(t),
                    this._candidatesMasks.push(this._planesMask),
                    this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)))
                }
            }
        }(),
        intersectLine: function() {
            var t = r.create();
            return function(e, i) {
                if (this._index++,
                0 != (2 & this._dimensionMask) && !(this._limitOneIntersection && this._intersections.length > 0)) {
                    var n = !0
                      , a = !0
                      , s = 1
                      , l = 0;
                    this._candidates = [],
                    this._candidatesMasks = [];
                    for (var u, h, c, d, p = 0, f = this._planes.length; p < f; ++p,
                    s <<= 1) {
                        if (u = this.distance(this._planes[p], e),
                        h = this.distance(this._planes[p], i),
                        c = u < 0,
                        d = h < 0,
                        c && d)
                            return;
                        c || d ? (c && (n = !1),
                        d && (a = !1),
                        0 === u ? (r.copy(t, e),
                        this._candidates.push(t),
                        this._candidatesMasks.push(s)) : 0 === h ? (r.copy(t, i),
                        this._candidates.push(t),
                        this._candidatesMasks.push(s)) : c && !d ? (r.sub(t, i, e),
                        r.scale(t, t, u / (-u + h)),
                        r.sub(t, e, t),
                        this._candidates.push(t),
                        this._candidatesMasks.push(s)) : !c && d && (r.sub(t, i, e),
                        r.scaleAndAdd(t, e, t, u / (u - h)),
                        this._candidates.push(t),
                        this._candidatesMasks.push(s))) : l |= s
                    }
                    if (l === this._planesMask)
                        return this._candidates.push(r.clone(e)),
                        this._candidatesMasks.push(this._planesMask),
                        this._candidates.push(r.clone(i)),
                        this._candidatesMasks.push(this._planesMask),
                        void this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));
                    this.checkCandidatePoints(l) > 0 && (n && (this._candidatesMasks.push(this._planesMask),
                    this._candidates.push(r.clone(e))),
                    a && (this._candidatesMasks.push(this._planesMask),
                    this._candidates.push(r.clone(i))),
                    this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0))))
                }
            }
        }(),
        intersectTriangle: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create()
              , n = r.create()
              , a = r.create()
              , s = r.create()
              , l = r.create();
            return function(u, h, c) {
                if (this._index++,
                0 != (4 & this._dimensionMask) && !(this._limitOneIntersection && this._intersections.length > 0)) {
                    var d = 1
                      , p = 0;
                    this._candidates = [],
                    this._candidatesMasks = [];
                    for (var f, g, m, v, _, b, x = 0, y = this._planes.length; x < y; ++x,
                    d <<= 1) {
                        if (f = this.distance(this._planes[x], u),
                        g = this.distance(this._planes[x], h),
                        m = this.distance(this._planes[x], c),
                        v = f < 0,
                        _ = g < 0,
                        b = m < 0,
                        v && _ && b)
                            return;
                        v || _ || b ? (0 === f ? (r.copy(t, u),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : 0 === g ? (r.copy(t, h),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : v && !_ ? (r.sub(t, h, u),
                        r.scale(t, t, f / (-f + g)),
                        r.sub(t, u, t),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : !v && _ && (r.sub(t, h, u),
                        r.scaleAndAdd(t, u, t, f / (f - g)),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)),
                        0 === m ? (r.copy(t, c),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : v && !b ? (r.sub(t, c, u),
                        r.scale(t, t, f / (-f + m)),
                        r.sub(t, u, t),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : !v && b && (r.sub(t, c, u),
                        r.scaleAndAdd(t, u, t, f / (f - m)),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)),
                        _ && !b ? (r.sub(t, c, h),
                        r.scale(t, t, g / (-g + m)),
                        r.sub(t, h, t),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d)) : !_ && b && (r.sub(t, c, h),
                        r.scaleAndAdd(t, h, t, g / (g - m)),
                        this._candidates.push(r.clone(t)),
                        this._candidatesMasks.push(d))) : p |= d
                    }
                    if (p === this._planesMask)
                        return this._candidates.push(r.clone(u)),
                        this._candidatesMasks.push(this._planesMask),
                        this._candidates.push(r.clone(h)),
                        this._candidatesMasks.push(this._planesMask),
                        this._candidates.push(r.clone(c)),
                        this._candidatesMasks.push(this._planesMask),
                        void this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));
                    var S = this.checkCandidatePoints(p);
                    if (S > 0)
                        return void this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));
                    var w = this.getPolytopeLines();
                    for (this._candidates = [],
                    this._candidatesMasks = [],
                    r.sub(e, h, u),
                    r.sub(i, c, u),
                    x = 0; x < w.length; ++x) {
                        r.cross(a, w[x]._dir, i);
                        var C = r.dot(e, a);
                        if (!(Math.abs(C) < 1e-6)) {
                            var M = 1 / C;
                            r.sub(s, w[x]._pos, u);
                            var T = M * r.dot(s, a);
                            if (!(T < 0 || T > 1)) {
                                r.cross(l, s, e);
                                var A = M * r.dot(w[x]._dir, l);
                                if (!(A < 0 || T + A > 1)) {
                                    var E = M * r.dot(i, l);
                                    r.scaleAndAdd(n, w[x]._pos, w[x]._dir, E),
                                    this._candidates.push(r.copy(r.create(), n)),
                                    this._candidatesMasks.push(w[x]._planeMask)
                                }
                            }
                        }
                    }
                    return S = this.checkCandidatePoints(p),
                    S > 0 ? void this._intersections.push(new o(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0))) : void 0
                }
            }
        }(),
        getPolytopeLines: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create()
              , a = r.create()
              , s = r.create()
              , o = r.create();
            return function() {
                if (this._lines.length > 0)
                    return this._lines;
                for (var u = 1, h = 0, c = this._planes.length; h < c; h++,
                u <<= 1) {
                    r.copy(i, this._planes[h]),
                    r.scale(a, i, -this._planes[h][3]);
                    for (var d = u << 1, p = h + 1, f = this._planes.length; p < f; ++p,
                    d <<= 1)
                        if (r.copy(s, this._planes[p]),
                        !(Math.abs(r.dot(i, s)) > 1 - 1e-6)) {
                            r.cross(t, i, s),
                            r.cross(e, t, i);
                            var g = -this.distance(this._planes[p], a) / r.dot(e, s);
                            n.isNaN(g) || (r.scaleAndAdd(o, a, e, g),
                            this._lines.push(new l(u | d,r.clone(o),r.clone(t))))
                        }
                }
                return this._lines
            }
        }(),
        setLimitOneIntersection: function(t) {
            this._limitOneIntersection = t
        },
        distance: function(t, e) {
            return r.dot(t, e) + t[3]
        }
    },
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).vec3
      , a = i(466)
      , s = function(t, e, i, n, r, a, s) {
        this.normal = t,
        this.i1 = e,
        this.i2 = i,
        this.i3 = n,
        this.r1 = r,
        this.r2 = a,
        this.r3 = s
    }
      , o = function() {
        a.apply(this)
    };
    o.prototype = n.objectInherit(a.prototype, {
        set: function(t, e) {
            this._center = t,
            this._radius = e
        },
        intersect: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create();
            return function(n, a, o, l, u, h) {
                r.sub(t, a, n),
                r.sub(e, o, n);
                var c = r.sqrLen(t)
                  , d = r.dot(t, e)
                  , p = r.sqrLen(e);
                r.sub(i, n, this._center);
                var f = r.dot(i, t)
                  , g = r.dot(i, e)
                  , m = r.sqrLen(i)
                  , v = Math.abs(c * p - d * d);
                if (!(v < 1e-10)) {
                    var _, b = d * g - p * f, x = d * f - c * g, y = 4;
                    if (b + x <= v)
                        if (b < 0)
                            x < 0 ? (y = 4,
                            f < 0 ? (x = 0,
                            -f >= c ? (b = 1,
                            _ = c + 2 * f + m) : (b = -f / c,
                            _ = f * b + m)) : (b = 0,
                            g >= 0 ? (x = 0,
                            _ = m) : -g >= p ? (x = 1,
                            _ = p + 2 * g + m) : (x = -g / p,
                            _ = g * x + m))) : (y = 3,
                            b = 0,
                            g >= 0 ? (x = 0,
                            _ = m) : -g >= p ? (x = 1,
                            _ = p + 2 * g + m) : (x = -g / p,
                            _ = g * x + m));
                        else if (x < 0)
                            y = 5,
                            x = 0,
                            f >= 0 ? (b = 0,
                            _ = m) : -f >= c ? (b = 1,
                            _ = c + 2 * f + m) : (b = -f / c,
                            _ = f * b + m);
                        else {
                            y = 0;
                            var S = 1 / v;
                            b *= S,
                            x *= S,
                            _ = b * (c * b + d * x + 2 * f) + x * (d * b + p * x + 2 * g) + m
                        }
                    else {
                        var w, C, M, T;
                        b < 0 ? (y = 2,
                        w = d + f,
                        C = p + g,
                        C > w ? (M = C - w,
                        T = c - 2 * d + p,
                        M >= T ? (b = 1,
                        x = 0,
                        _ = c + 2 * f + m) : (b = M / T,
                        x = 1 - b,
                        _ = b * (c * b + d * x + 2 * f) + x * (d * b + p * x + 2 * g) + m)) : (b = 0,
                        C <= 0 ? (x = 1,
                        _ = p + 2 * g + m) : g >= 0 ? (x = 0,
                        _ = m) : (x = -g / p,
                        _ = g * x + m))) : x < 0 ? (y = 6,
                        w = d + g,
                        C = c + f,
                        C > w ? (M = C - w,
                        T = c - 2 * d + p,
                        M >= T ? (x = 1,
                        b = 0,
                        _ = p + 2 * g + m) : (x = M / T,
                        b = 1 - x,
                        _ = b * (c * b + d * x + 2 * f) + x * (d * b + p * x + 2 * g) + m)) : (x = 0,
                        C <= 0 ? (b = 1,
                        _ = c + 2 * f + m) : f >= 0 ? (b = 0,
                        _ = m) : (b = -f / c,
                        _ = f * b + m))) : (y = 1,
                        M = p + g - d - f,
                        M <= 0 ? (b = 0,
                        x = 1,
                        _ = p + 2 * g + m) : (T = c - 2 * d + p,
                        M >= T ? (b = 1,
                        x = 0,
                        _ = c + 2 * f + m) : (b = M / T,
                        x = 1 - b,
                        _ = b * (c * b + d * x + 2 * f) + x * (d * b + p * x + 2 * g) + m)))
                    }
                    if (_ < 0 && (_ = 0),
                    !(_ > this._radius * this._radius)) {
                        var A = r.create();
                        A && (A[0] = n[0] + b * t[0] + x * e[0],
                        A[1] = n[1] + b * t[1] + x * e[1],
                        A[2] = n[2] + b * t[2] + x * e[2]);
                        var E = r.create();
                        r.cross(E, t, e),
                        r.normalize(E, E),
                        this._intersections.push({
                            ratio: Math.sqrt(_),
                            nodepath: this._nodePath.slice(0),
                            TriangleIntersection: new s(E,l,u,h,1 - b - x,b,x),
                            point: A,
                            zone: y
                        }),
                        this.hit = !0
                    }
                }
            }
        }()
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(380)
      , r = function(t, e) {
        var i, n;
        e ? (i = e[0],
        n = e[1]) : (i = t[14] / (t[10] - 1),
        n = t[14] / (1 + t[10]));
        var r = i * (t[8] - 1) / t[0]
          , a = i * (1 + t[8]) / t[0]
          , s = i * (1 + t[9]) / t[5]
          , o = i * (t[9] - 1) / t[5]
          , l = n * (t[8] - 1) / t[0]
          , u = n * (1 + t[8]) / t[0]
          , h = n * (1 + t[9]) / t[5]
          , c = n * (t[9] - 1) / t[5]
          , d = this.getAttributes().Vertex
          , p = d.getElements();
        p[0] = r,
        p[1] = o,
        p[2] = -i,
        p[3] = a,
        p[4] = o,
        p[5] = -i,
        p[6] = a,
        p[7] = s,
        p[8] = -i,
        p[9] = r,
        p[10] = s,
        p[11] = -i,
        p[12] = l,
        p[13] = c,
        p[14] = -n,
        p[15] = u,
        p[16] = c,
        p[17] = -n,
        p[18] = u,
        p[19] = h,
        p[20] = -n,
        p[21] = l,
        p[22] = h,
        p[23] = -n,
        d.dirty()
    }
      , a = function() {
        var t = n.createBoundingBoxGeometry();
        return t.updateGeometry = r,
        t
    };
    t.exports = {
        createDebugFrustumGeometry: a
    }
}
, function(t, e, i) {
    "use strict";
    var n, r, a, s = i(162), o = i(143), l = i(134), u = i(320), h = i(321), c = i(322), d = i(323), p = ["#ifdef GL_ES", "precision highp float;", "#endif"].join("\n"), f = function() {
        if (n)
            return n;
        var t = "#define SHADER_NAME GizmoLine3D"
          , e = [p, "attribute vec3 Vertex;", "uniform mat4 uModelViewMatrix;", "uniform mat4 uProjectionMatrix;", t, "", "void main(void) {", "  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);", "}"].join("\n")
          , i = [p, "uniform vec4 uColor;", t, "", "void main(void) {", "  gl_FragColor = uColor;", "}"].join("\n");
        return n = new c(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))
    }, g = function() {
        if (r)
            return r;
        var t = "#define SHADER_NAME GizmoLine2D"
          , e = [p, "attribute vec2 Vertex;", t, "", "void main(void) {", "  gl_Position = vec4(Vertex, 0.0, 1.0);", "}"].join("\n")
          , i = [p, t, "", "void main(void) {", "  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);", "}"].join("\n");
        return r = new c(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))
    }, m = function() {
        if (a)
            return a;
        var t = "#define SHADER_NAME GizmoQuadCircle"
          , e = [p, "attribute vec3 Vertex;", "uniform mat4 uModelViewMatrix;", "uniform mat4 uProjectionMatrix;", "varying vec3 vViewVertex;", t, "", "void main(void) {", "  vViewVertex = Vertex;", "  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);", "}"].join("\n")
          , i = [p, "uniform float uAngle;", "uniform vec3 uBase;", "varying vec3 vViewVertex;", "const float PI = 3.14159265358979323846264;", "const float PI2 = PI * 2.0;", t, "", "void main(void) {", "  if(length(vViewVertex) > 0.5)", "    discard;", "  vec3 vn = normalize(vViewVertex);", "  float angle = atan(uBase.y * vn.x - uBase.x * vn.y, dot(uBase, vn));", "  if(angle > 0.0) {", "    if(uAngle >= 0.0 && angle > uAngle) discard;", "    if(uAngle < -PI && angle < uAngle + PI2) discard;", "    if(uAngle < 0.0 && uAngle > -PI) discard;", "  }", "  if(angle < 0.0) {", "    if(uAngle <= 0.0 && angle < uAngle) discard;", "    if(uAngle > PI && angle > uAngle - PI2) discard;", "    if(uAngle > 0.0 && uAngle < PI) discard;", "  }", "  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.5);", "}"].join("\n");
        return a = new c(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))
    }, v = function() {
        var t = new o;
        t.getAttributes().Vertex = new s(s.ARRAY_BUFFER,new Float32Array(4),2);
        var e = new u(l.LINES,0,2);
        return t.getPrimitives().push(e),
        t.getOrCreateStateSet().setAttributeAndModes(g()),
        t
    }, _ = function(t, e, i, n, r) {
        var a = void 0 !== t ? t : 1
          , u = void 0 !== e ? e : .2
          , c = void 0 !== i ? i : 6
          , d = void 0 !== n ? n : 64
          , p = void 0 !== r ? r : 2 * Math.PI
          , g = (c + 1) * (d + 1)
          , m = c * d * 2
          , v = new o
          , _ = new Float32Array(3 * g)
          , b = new Uint16Array(3 * m);
        p = p || 2 * Math.PI;
        var x = 0
          , y = 0
          , S = 0
          , w = 0;
        for (w = 0; w <= c; ++w)
            for (S = 0; S <= d; ++S) {
                var C = S / d * p
                  , M = w / c * Math.PI * 2;
                y = 3 * x,
                _[y] = (a + u * Math.cos(M)) * Math.cos(C),
                _[y + 1] = (a + u * Math.cos(M)) * Math.sin(C),
                _[y + 2] = u * Math.sin(M),
                x++
            }
        for (x = 0,
        w = 1; w <= c; ++w)
            for (S = 1; S <= d; ++S)
                y = 6 * x,
                b[y] = (d + 1) * w + S - 1,
                b[y + 1] = b[y + 3] = (d + 1) * (w - 1) + S - 1,
                b[y + 2] = b[y + 5] = (d + 1) * w + S,
                b[y + 4] = (d + 1) * (w - 1) + S,
                x++;
        return v.getAttributes().Vertex = new s(s.ARRAY_BUFFER,_,3),
        v.getOrCreateStateSet().setAttributeAndModes(f()),
        v.getPrimitives().push(new h(l.TRIANGLES,new s(s.ELEMENT_ARRAY_BUFFER,b,1))),
        v
    }, b = function(t, e, i, n, r, a, u) {
        var c = void 0 !== t ? t : 1
          , d = void 0 !== e ? e : 1
          , p = void 0 !== i ? i : 5
          , g = void 0 !== n ? n : 32
          , m = void 0 !== r ? r : 1
          , v = void 0 === a || a
          , _ = void 0 === u || u;
        v = v && c > 0,
        _ = _ && d > 0;
        var b = .5 * p
          , x = (m + 1) * (g + 1)
          , y = m * g * 2;
        v && (x += 1,
        y += g),
        _ && (x += 1,
        y += g);
        var S = new o
          , w = new Float32Array(3 * x)
          , C = new Uint16Array(3 * y)
          , M = 0
          , T = 0
          , A = 0
          , E = 0;
        for (A = 0; A <= m; A++) {
            var P = A / m
              , N = P * (d - c) + c;
            for (E = 0; E <= g; E++) {
                var k = E / g;
                T = 3 * M,
                w[T] = N * Math.sin(k * Math.PI * 2),
                w[T + 1] = N * Math.cos(k * Math.PI * 2),
                w[T + 2] = -P * p + b,
                M++
            }
        }
        for (M = 0,
        E = 0; E < g; E++)
            for (A = 0; A < m; A++)
                T = 6 * M,
                C[T] = (g + 1) * A + E,
                C[T + 1] = C[T + 3] = (g + 1) * (A + 1) + E,
                C[T + 2] = C[T + 5] = (g + 1) * A + E + 1,
                C[T + 4] = (g + 1) * (A + 1) + E + 1,
                M++;
        M *= 2;
        var F;
        if (v)
            for (F = (_ ? w.length - 6 : w.length - 3) / 3,
            w[3 * F + 2] = b,
            E = 0; E < g; E++)
                T = 3 * M,
                C[T] = E,
                C[T + 1] = E + 1,
                C[T + 2] = F,
                M++;
        if (_) {
            F = (w.length - 3) / 3,
            w[3 * F + 2] = -b;
            var D = (g + 1) * A;
            for (E = 0; E < g; E++)
                T = 3 * M,
                C[T] = D + E + 1,
                C[T + 1] = D + E,
                C[T + 2] = F,
                M++
        }
        return S.getAttributes().Vertex = new s(s.ARRAY_BUFFER,w,3),
        S.getOrCreateStateSet().setAttributeAndModes(f()),
        S.getPrimitives().push(new h(l.TRIANGLES,new s(s.ELEMENT_ARRAY_BUFFER,C,1))),
        S
    }, x = function(t, e, i) {
        for (var n = new o, r = new Float32Array(3 * t), a = i || 2 * Math.PI, h = 0; h < t; ++h) {
            var c = 3 * h
              , d = a * h / t;
            r[c] = Math.cos(d) * e,
            r[c + 1] = Math.sin(d) * e
        }
        n.getAttributes().Vertex = new s(s.ARRAY_BUFFER,r,3);
        var p = new u(l.LINE_STRIP,0,t);
        return n.getOrCreateStateSet().setAttributeAndModes(f()),
        n.getPrimitives().push(p),
        n
    }, y = function(t, e) {
        var i = t ? .5 * t : .5
          , n = e ? .5 * e : .5
          , r = new o
          , a = new Float32Array(12);
        a[0] = -i,
        a[1] = -n,
        a[3] = i,
        a[4] = -n,
        a[6] = -i,
        a[7] = n,
        a[9] = i,
        a[10] = n,
        r.getAttributes().Vertex = new s(s.ARRAY_BUFFER,a,3);
        var h = new u(l.TRIANGLE_STRIP,0,4);
        return r.getOrCreateStateSet().setAttributeAndModes(f()),
        r.getPrimitives().push(h),
        r
    }, S = function() {
        var t = y();
        return t.getOrCreateStateSet().setAttributeAndModes(m()),
        t
    }, w = {};
    w.createCircleGeometry = x,
    w.createCylinderGeometry = b,
    w.createTorusGeometry = _,
    w.createDebugLineGeometry = v,
    w.createPlaneGeometry = y,
    w.createQuadCircleGeometry = S,
    t.exports = w
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(85)
      , a = i(627)
      , s = function() {
        r.call(this),
        this._databasePager = new a,
        this._sceneData = void 0
    };
    s.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        getSceneData: function() {
            return this._sceneData
        },
        setSceneData: function(t) {
            this._sceneData = t
        },
        setDatabasePager: function(t) {
            this._databasePager = t
        },
        getDatabasePager: function() {
            return this._databasePager
        },
        updateSceneGraph: function(t) {
            this._databasePager && this._databasePager.updateSceneGraph(t.getFrameStamp()),
            this._sceneData && this._sceneData.accept(t)
        }
    }), "osgViewer", "Scene"),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(889)
      , r = i(890)
      , a = i(891)
      , s = i(892)
      , o = i(893)
      , l = i(888);
    t.exports = {
        GamePad: n,
        Hammer: r,
        LeapMotion: a,
        StandardMouseKeyboard: s,
        WebVR: o,
        DeviceOrientation: l
    }
}
, function(t, e, i) {
    "use strict";
    var n = function() {
        var t = function(t) {
            return '<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">' + t + "</div>"
        }
          , e = 'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>'
          , i = 'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>'
          , n = !0
          , r = function(r, a, o) {
            function l(r) {
                if (n) {
                    var a = document.getElementsByTagName("body")[0];
                    if (a) {
                        var s = window.WebGLRenderingContext ? i : e;
                        r && (s += "<br/><br/>Status: " + r),
                        a.innerHTML = t(s)
                    }
                }
            }
            o = o || l,
            r.addEventListener && r.addEventListener("webglcontextcreationerror", function(t) {
                o(t.statusMessage)
            }, !1);
            var u = s(r, a);
            return u || o(""),
            u
        }
          , a = function(t, e, i) {
            for (var n = null, r = 0; r < i.length; ++r) {
                try {
                    n = t.getContext(i[r], e)
                } catch (t) {}
                if (n)
                    break
            }
            return n
        }
          , s = function(t, e) {
            var i;
            if (e && e.webgl2) {
                if (n = !1,
                i = a(t, e, ["webgl2", "experimental-webgl2"]))
                    return i;
                n = !0
            }
            return a(t, e, ["webgl", "experimental-webgl", "webkit-3d", "moz-webgl"])
        };
        return {
            create3DContext: s,
            setupWebGL: r
        }
    }();
    window.requestAnimationFrame || (window.requestAnimationFrame = function() {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(t, e) {
            window.setTimeout(t, 1e3 / 60)
        }
    }()),
    window.cancelRequestAnimFrame || (window.cancelRequestAnimFrame = function() {
        return window.cancelAnimationFrame || window.webkitCancelRequestAnimationFrame || window.mozCancelRequestAnimationFrame || window.oCancelRequestAnimationFrame || window.msCancelRequestAnimationFrame || clearTimeout
    }()),
    Date.now || (Date.now = function() {
        return (new Date).getTime()
    }
    ),
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i(28)
      , a = i(468)
      , s = i(416)
      , o = i(461)
      , l = i(382)
      , u = i(621)
      , h = i(525)
      , c = i(381)
      , d = i(143)
      , p = {}
      , f = function() {}
      , g = l.registry();
    g.registerObject("osgAnimation.Vec3LerpChannel", f),
    g.registerObject("osgAnimation.FloatLerpChannel", f),
    g.registerObject("osgAnimation.QuatSlerpChannel", f),
    g.registerObject("osgAnimation.QuatLerpChannel", f),
    g.registerObject("osgAnimation.FloatCubicBezierChannel", f),
    g.registerObject("osgAnimation.Vec3CubicBezierChannel", f),
    g.registerObject("osgAnimation.StackedMatrixElement", u),
    g.registerObject("osgAnimation.StackedScaleElement", h),
    p.Animation = function(t) {
        var e = t.getJSON();
        if (void 0 === e.Name || !e.Channels || 0 === e.Channels.length)
            return n.reject();
        for (var i = [], r = 0, a = e.Channels.length; r < a; r++) {
            var s = t.setJSON(e.Channels[r]).readObject();
            i.push(s)
        }
        return n.all(i).then(function(t) {
            return o.createAnimation(t, e.Name)
        })
    }
    ,
    p.StandardVec3Channel = function(t, e, i) {
        var r = t.getJSON();
        if (!(void 0 !== r.TargetName && r.KeyFrames && r.Name && r.KeyFrames.Time && r.KeyFrames.Key && 3 === r.KeyFrames.Key.length))
            return n.reject();
        var a = t.setJSON(r.KeyFrames.Time).readBufferArray()
          , s = t.setJSON(r.KeyFrames.Key[0]).readBufferArray()
          , o = t.setJSON(r.KeyFrames.Key[1]).readBufferArray()
          , l = t.setJSON(r.KeyFrames.Key[2]).readBufferArray();
        return n.all([a, s, o, l]).then(function(t) {
            for (var n = t[0].getElements(), a = t[1].getElements(), s = t[2].getElements(), o = t[3].getElements(), l = n.length, u = new Float32Array(new ArrayBuffer(4 * (l + 1) * 3),0,3 * l), h = new Float32Array(new ArrayBuffer(4 * (l + 1)),0,l), c = 0; c < l; c++) {
                var d = 3 * c;
                h[c] = n[c],
                u[d++] = a[c],
                u[d++] = s[c],
                u[d] = o[c]
            }
            return i(u, h, r.TargetName, r.Name, e),
            e
        })
    }
    ,
    p.StandardQuatChannel = function(t, e, i) {
        var r = t.getJSON();
        if (!(void 0 !== r.TargetName && r.KeyFrames && r.Name && r.KeyFrames.Time && r.KeyFrames.Key && 4 === r.KeyFrames.Key.length))
            return n.reject();
        var a = t.setJSON(r.KeyFrames.Time).readBufferArray()
          , s = t.setJSON(r.KeyFrames.Key[0]).readBufferArray()
          , o = t.setJSON(r.KeyFrames.Key[1]).readBufferArray()
          , l = t.setJSON(r.KeyFrames.Key[2]).readBufferArray()
          , u = t.setJSON(r.KeyFrames.Key[3]).readBufferArray();
        return n.all([a, s, o, l, u]).then(function(t) {
            for (var n = t[0].getElements(), a = t[1].getElements(), s = t[2].getElements(), o = t[3].getElements(), l = t[4].getElements(), u = n.length, h = new Float32Array(new ArrayBuffer(4 * (u + 1) * 4),0,4 * u), c = new Float32Array(new ArrayBuffer(4 * (u + 1)),0,u), d = 0; d < u; d++) {
                var p = 4 * d;
                c[d] = n[d],
                h[p++] = a[d],
                h[p++] = s[d],
                h[p++] = o[d],
                h[p] = l[d]
            }
            return i(h, c, r.TargetName, r.Name, e),
            e
        })
    }
    ,
    p.StandardFloatChannel = function(t, e, i) {
        var r = t.getJSON();
        if (!(void 0 !== r.TargetName && r.KeyFrames && r.Name && r.KeyFrames.Time && r.KeyFrames.Key))
            return n.reject();
        var a = t.setJSON(r.KeyFrames.Time).readBufferArray()
          , s = t.setJSON(r.KeyFrames.Key).readBufferArray();
        return n.all([a, s]).then(function(t) {
            for (var n = t[0].getElements(), a = t[1].getElements(), s = n.length, o = new Float32Array(new ArrayBuffer(4 * (s + 1)),0,s), l = new Float32Array(new ArrayBuffer(4 * (s + 1)),0,s), u = 0; u < s; u++)
                l[u] = n[u],
                o[u] = a[u];
            return i(o, l, r.TargetName, r.Name, e),
            e
        })
    }
    ,
    p.Vec3LerpChannel = function(t, e) {
        return p.StandardVec3Channel(t, e, s.createVec3Channel)
    }
    ,
    p.QuatLerpChannel = function(t, e) {
        return p.StandardQuatChannel(t, e, s.createQuatChannel)
    }
    ,
    p.QuatSlerpChannel = function(t, e) {
        return p.StandardQuatChannel(t, e, s.createQuatChannel)
    }
    ,
    p.FloatLerpChannel = function(t, e) {
        return p.StandardFloatChannel(t, e, s.createFloatChannel)
    }
    ,
    p.FloatCubicBezierChannel = function(t, e) {
        var i = t.getJSON();
        if (!(void 0 !== i.TargetName && i.KeyFrames && i.Name && i.KeyFrames.Time && i.KeyFrames.Position && i.KeyFrames.ControlPointOut && i.KeyFrames.ControlPointIn))
            return n.reject();
        for (var r = [], a = window.Object.keys(i.KeyFrames), o = 0; o < a.length; o++)
            r.push(t.setJSON(i.KeyFrames[a[o]]).readBufferArray());
        return n.all(r).then(function(t) {
            for (var n = t[0].getElements(), r = t[1].getElements(), a = t[2].getElements(), o = t[3].getElements(), l = o.length, u = new Float32Array(new ArrayBuffer(4 * (l + 1) * 3),0,3 * l), h = new Float32Array(new ArrayBuffer(4 * (l + 1)),0,l), c = 0; c < l; c++) {
                var d = 3 * c;
                h[c] = o[c],
                u[d++] = a[c],
                u[d++] = n[c],
                u[d] = r[c]
            }
            return s.createFloatCubicBezierChannel(u, h, i.TargetName, i.Name, e),
            e
        })
    }
    ,
    p.Vec3CubicBezierChannel = function(t, e) {
        var i = t.getJSON();
        if (!(void 0 !== i.TargetName && i.KeyFrames && i.Name && i.KeyFrames.Time && i.KeyFrames.Position && i.KeyFrames.ControlPointOut && i.KeyFrames.ControlPointIn && 3 === i.KeyFrames.Position.length && 3 === i.KeyFrames.ControlPointIn.length && 3 === i.KeyFrames.ControlPointOut.length))
            return n.reject();
        for (var r = [], a = window.Object.keys(i.KeyFrames), o = 0; o < a.length; o++) {
            var l = a[o]
              , u = i.KeyFrames[l];
            "Time" !== l ? (r.push(t.setJSON(u[0]).readBufferArray()),
            r.push(t.setJSON(u[1]).readBufferArray()),
            r.push(t.setJSON(u[2]).readBufferArray())) : r.push(t.setJSON(u).readBufferArray())
        }
        return n.all(r).then(function(t) {
            for (var n = t[0].getElements(), r = t[1].getElements(), a = t[2].getElements(), o = t[3].getElements(), l = t[4].getElements(), u = t[5].getElements(), h = t[6].getElements(), c = t[7].getElements(), d = t[8].getElements(), p = t[9].getElements(), f = p.length, g = new Float32Array(new ArrayBuffer(4 * (f + 1) * 9),0,9 * f), m = new Float32Array(new ArrayBuffer(4 * (f + 1)),0,f), v = 0; v < f; v++) {
                var _ = 9 * v;
                m[v] = p[v],
                g[_++] = h[v],
                g[_++] = c[v],
                g[_++] = d[v],
                g[_++] = n[v],
                g[_++] = r[v],
                g[_++] = a[v],
                g[_++] = o[v],
                g[_++] = l[v],
                g[_] = u[v]
            }
            return s.createVec3CubicBezierChannel(g, m, i.TargetName, i.Name, e),
            e
        })
    }
    ,
    p.BasicAnimationManager = function(t, e) {
        var i = t.getJSON();
        if (!i.Animations)
            return n.reject();
        a.Object(t, e);
        for (var s = [], o = 0, l = i.Animations.length; o < l; o++) {
            var u = t.setJSON(i.Animations[o]).readObject();
            u.isRejected() ? r.warn("An Animation failed on the parsing!") : s.push(u)
        }
        return n.all(s).then(function(t) {
            return e.init(t),
            e
        })
    }
    ,
    p.UpdateMatrixTransform = function(t, e) {
        var i = t.getJSON();
        if (/*!jsonObj.Name ||*/
        !i.StackedTransforms)
            return n.reject();
        a.Object(t, e);
        for (var r = [], s = 0, o = i.StackedTransforms.length; s < o; s++)
            r.push(t.setJSON(i.StackedTransforms[s]).readObject());
        return n.all(r).then(function(t) {
            for (var i = e.getStackedTransforms(), n = 0, r = t.length; n < r; n++)
                i.push(t[n]);
            return e.computeChannels(),
            e
        })
    }
    ,
    p.StackedTranslate = function(t, e) {
        var i = t.getJSON();
        return i.Name && i.Translate ? (a.Object(t, e),
        e.init(i.Translate),
        n.resolve(e)) : n.reject()
    }
    ,
    p.StackedQuaternion = function(t, e) {
        var i = t.getJSON();
        return i.Name && i.Quaternion ? (a.Object(t, e),
        e.init(i.Quaternion),
        n.resolve(e)) : n.reject()
    }
    ,
    p.StackedRotateAxis = function(t, e) {
        var i = t.getJSON();
        return i.Axis && void 0 !== i.Angle ? (a.Object(t, e),
        e.init(i.Axis, i.Angle),
        n.resolve(e)) : n.reject()
    }
    ,
    p.StackedMatrix = function(t, e) {
        var i = t.getJSON();
        return i.Name && i.Matrix ? (a.Object(t, e),
        e.init(i.Matrix),
        n.resolve(e)) : n.reject()
    }
    ,
    p.StackedScale = function(t, e) {
        var i = t.getJSON();
        return i.Name && i.Scale ? (a.Object(t, e),
        e.init(i.Scale),
        n.resolve(e)) : n.reject()
    }
    ,
    p.Bone = function(t, e) {
        var i = t.getJSON();
        if (!i.InvBindMatrixInSkeletonSpace)
            return n.reject();
        var r = a.MatrixTransform(t, e);
        if (e.setInvBindMatrixInSkeletonSpace(i.InvBindMatrixInSkeletonSpace),
        i.BoundingBox) {
            var s = e.getBoneBoundingBox();
            s.setMax(i.BoundingBox.max),
            s.setMin(i.BoundingBox.min)
        }
        return r
    }
    ,
    p.UpdateBone = p.UpdateMatrixTransform,
    p.UpdateSkeleton = function(t, e) {
        return a.Object(t, e),
        n.resolve(e)
    }
    ,
    p.Skeleton = a.MatrixTransform,
    p.RigGeometry = function(t, e) {
        var i = t.getJSON();
        if (!i.SourceGeometry)
            return n.reject();
        i.BoneMap || r.warn("No boneMap found in a RigGeometry !");
        var s = a.Geometry(t, e);
        e._boneNameID = i.BoneMap;
        var o, l = i.SourceGeometry["osg.Geometry"];
        return l ? (t.setJSON(l),
        e.setSourceGeometry(new d),
        o = a.Geometry(t, e.getSourceGeometry())) : (l = i.SourceGeometry["osgAnimation.MorphGeometry"],
        l ? (t.setJSON(l),
        e.setSourceGeometry(new c),
        o = p.MorphGeometry(t, e.getSourceGeometry())) : r.warn("SourceGeometry type no recognized")),
        void 0 === e._uniqueID && (e._uniqueID = l.UniqueID),
        n.all([s, o]).then(function() {
            return e.mergeChildrenData(),
            e
        })
    }
    ,
    p.MorphGeometry = function(t, e) {
        var i = t.getJSON();
        if (!i.MorphTargets)
            return n.reject();
        var r = i.MorphTargets
          , s = [];
        s.push(a.Geometry(t, e));
        for (var o = 0, l = r.length; o < l; o++)
            s.push(t.setJSON(r[o]).readObject());
        return n.all(s).then(function(t) {
            for (var e = t[0], i = e.getMorphTargets(), n = 1, r = t.length; n < r; n++)
                i.push(t[n]);
            return e.mergeChildrenVertexAttributeList(),
            e
        })
    }
    ,
    p.UpdateMorph = function(t, e) {
        var i = t.getJSON();
        if (!i.TargetMap)
            return n.reject();
        a.Object(t, e);
        for (var r = window.Object.keys(i.TargetMap), s = 0, o = r.length; s < o; s++) {
            var l = r[s];
            e.addTarget(i.TargetMap[l], parseInt(l, 10))
        }
        return n.resolve(e)
    }
    ,
    p.StackedMatrixElement = p.StackedMatrix,
    p.StackedScaleElement = p.StackedScale,
    t.exports = p
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i(468)
      , a = i(28)
      , s = i(657)
      , o = {};
    o.Text = function(t, e) {
        var i = t.getJSON();
        if (!i.Text)
            return n.reject();
        var o = r.Node(t, e);
        if (e.setColor(i.Color),
        e.setText(i.Text),
        e.setAutoRotateToScreen(i.AutoRotateToScreen),
        e.setPosition(i.Position),
        e.setCharacterSize(i.CharacterSize),
        "VERTICAL" === i.Layout)
            return a.error("Vertical Alignment not supported"),
            n.reject();
        var l = i.Alignment;
        return i.Alignment.indexOf("BASE_LINE") > -1 && ("LEFT_BASE_LINE" === i.Alignment ? l = s.LEFT_CENTER : "CENTER_BASE_LINE" === i.Alignment ? l = s.CENTER_CENTER : "RIGHT_BASE_LINE" === i.Alignment ? l = s.RIGHT_CENTER : "LEFT_BOTTOM_BASE_LINE" === i.Alignment ? l = s.LEFT_BOTTOM : "CENTER_BOTTOM_BASE_LINE" === i.Alignment ? l = s.CENTER_BOTTOM : "RIGHT_BOTTOM_BASE_LINE" === i.Alignment && (l = s.RIGHT_BOTTOM)),
        e.setAlignment(l),
        e.setLayout(i.Layout),
        o
    }
    ,
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(18)
      , r = i.n(n)
      , a = i(2)
      , s = i.n(a)
      , o = i(1)
      , l = (i.n(o),
    i(148));
    e.a = l.a.extend({
        el: ['<div class="widget slider-widget">', '          <div class="widget-wrapper">', '              <div class="bar">', '                  <div class="slide">', '                      <div class="cursor"></div>', "                  </div>", "              </div>", "          </div>", "      </div>"].join(""),
        events: i.i(o.extend)({}, l.a.prototype.events, {
            "mousedown .bar": "trackDrag",
            "mousedown .cursor": "cursorDrag",
            "touchstart .bar": "trackDrag",
            "touchstart .cursor": "cursorDrag"
        }),
        constructor: function(t, e) {
            e = i.i(o.defaults)(e || {}, {
                model: new r.a.Model,
                name: "value",
                minimum: 0,
                maximum: 100,
                step: 1,
                orientation: "horizontal"
            }),
            l.a.prototype.constructor.call(this, t, e),
            void 0 === this.get() && this.set(0)
        },
        initialize: function() {
            this.$slide = this.$(".slide"),
            "vertical" === this.options.orientation && this.$el.addClass("--vertical"),
            this.render()
        },
        delegateEvents: function() {
            l.a.prototype.delegateEvents.apply(this, arguments),
            s()(window).on("mousemove.delegateEvents" + this.cid, this.moveEvent.bind(this)),
            s()(window).on("mouseup.delegateEvents" + this.cid, this.stopEvent.bind(this)),
            s()(window).on("touchmove.delegateEvents" + this.cid, this.moveEvent.bind(this)),
            s()(window).on("touchend.delegateEvents" + this.cid, this.stopEvent.bind(this))
        },
        undelegateEvents: function() {
            l.a.prototype.undelegateEvents.apply(this, arguments),
            s()(window).off(".delegateEvents" + this.cid)
        },
        render: function() {
            var t = this.options.maximum - this.options.minimum
              , e = (this.get() - this.options.minimum) / t * 100
              , i = {};
            "vertical" === this.options.orientation ? i.height = e + "%" : i.width = e + "%",
            this.$slide.css(i)
        },
        startEvent: function(t) {
            t.preventDefault(),
            this.$el.addClass("fast"),
            this.started = !0
        },
        stopEvent: function(t) {
            this.started && (t.preventDefault(),
            this.$el.removeClass("fast"),
            this.started = !1)
        },
        moveEvent: function(t) {
            this.started && (t.preventDefault(),
            this.selectEvent(t))
        },
        selectEvent: function(t) {
            t.preventDefault();
            var e, i;
            if ("horizontal" === this.options.orientation) {
                var n = this.$el.offset().left
                  , r = this.$el.width();
                i = t.pageX,
                void 0 === i && (i = t.originalEvent.touches[0].pageX),
                e = (i - n) / r
            } else if ("vertical" === this.options.orientation) {
                var a = this.$el.offset().top
                  , s = this.$el.height();
                i = t.pageY,
                i || (i = t.originalEvent.touches[0].pageY),
                e = (a + s - i) / s
            }
            e = Math.min(Math.max(0, e), 1),
            e = this.options.minimum + e * (this.options.maximum - this.options.minimum),
            this.change(e)
        },
        cursorDrag: function(t) {
            this.startEvent(t),
            t.stopPropagation()
        },
        trackDrag: function(t) {
            this.startEvent(t),
            this.moveEvent(t)
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = {};
    n.linearToSrgb1 = function(t) {
        var e = 0;
        return t < .0031308 ? t > 0 && (e = 12.92 * t) : e = 1.055 * Math.pow(t, 1 / 2.4) - .055,
        e
    }
    ,
    n.srgbToLinear1 = function(t) {
        var e = 0;
        return t < .04045 ? t >= 0 && (e = t * (1 / 12.92)) : e = Math.pow((t + .055) * (1 / 1.055), 2.4),
        e
    }
    ,
    n.linearToSrgb = function(t, e) {
        var i = e || new Array(t.length);
        return i[0] = n.linearToSrgb1(t[0]),
        i[1] = n.linearToSrgb1(t[1]),
        i[2] = n.linearToSrgb1(t[2]),
        i.length > 3 && t.length > 3 && (i[3] = t[3]),
        i
    }
    ,
    n.srgbToLinear = function(t, e) {
        var i = e || new Array(t.length);
        return i[0] = n.srgbToLinear1(t[0]),
        i[1] = n.srgbToLinear1(t[1]),
        i[2] = n.srgbToLinear1(t[2]),
        i.length > 3 && t.length > 3 && (i[3] = t[3]),
        i
    }
    ,
    n.encodeRGBM = function(t, e, i) {
        i[3] = Math.min(1, Math.max(t[0] / e, i[1] / e, i[2] / e, 1e-6)),
        i[3] = Math.ceil(255 * i[3]) / 255;
        var n = 1 / (e * i[3]);
        return i[0] = t[0] * n,
        i[1] = t[1] * n,
        i[2] = t[2] * n,
        i
    }
    ,
    n.decodeRGBM = function(t, e, i) {
        var n = e * t[3];
        return i[0] = n * i[0],
        i[1] = n * i[1],
        i[2] = n * i[2],
        i
    }
    ,
    n.rgbToHex = function(t) {
        var e = {
            r: 255 * t.r,
            g: 255 * t.g,
            b: 255 * t.b
        };
        return "#" + (16777216 | e.b | e.g << 8 | e.r << 16).toString(16).substr(1)
    }
    ,
    e.a = n
}
, , function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = r.a.osg
      , s = function(t) {
        this._model = void 0 !== t ? t.model : void 0,
        this._viewer = void 0 !== t ? t.viewer : void 0,
        this._scene = void 0 !== t ? t.scene : void 0,
        this._widgetAPI = void 0 !== t ? t.widgetAPI : void 0,
        this._features = {}
    };
    s.prototype = {
        getModel: function() {
            return this._model
        },
        getFeatures: function() {
            return this._features
        },
        getViewer: function() {
            return this._viewer
        },
        getScene: function() {
            return this._scene
        },
        getWidgetAPI: function() {
            return this._widgetAPI
        },
        addFeature: function(t) {
            if (t) {
                var e = t.getName();
                this._features[e] ? a.error("Feature already added" + e) : this._features[e] = t
            }
            return this._features
        },
        getModelByName: function(t) {
            if (t) {
                var e = i.i(n.find)(this._features, function(e) {
                    var i = e.getModel();
                    return !(!i || !i.getName) && i.getName() === t
                });
                return e ? e.getModel() : void 0
            }
        },
        getViewsByName: function(t) {
            if (t) {
                var e = [];
                return i.i(n.forEach)(this._features, function(i) {
                    if (i) {
                        var n = i._views.filter(function(e) {
                            return !!e.getName && e.getName() === t
                        });
                        Array.prototype.push.apply(e, n)
                    }
                }),
                e
            }
        }
    },
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(51)
      , a = n.a.osg
      , s = n.a.osgUtil
      , o = s.NodeGizmo
      , l = function() {
        o.apply(this, arguments),
        this._forcePicking = !1
    };
    l.prototype = a.objectInherit(o.prototype, {
        setForcePicking: function(t) {
            this._forcePicking = t
        },
        onMouseUp: function(t) {
            this.isEditing() && r.a.draw();
            var e = this._attachedNode;
            o.prototype.onMouseUp.call(this, t),
            e !== this._attachedNode && r.a.draw(),
            this._forcePicking && !this._attachedNode && (this._attachedNode = e)
        },
        onMouseMove: function(t) {
            var e = this._hoverNode;
            o.prototype.onMouseMove.call(this, t),
            (this.isEditing() || e !== this._hoverNode) && r.a.draw()
        }
    }),
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(7))
      , a = i.n(r)
      , s = i(4)
      , o = i(329)
      , l = i(796)
      , u = i.n(l)
      , h = i(797)
      , c = i.n(h)
      , d = i(138)
      , p = i(43)
      , f = i(51)
      , g = i(554)
      , m = i(151)
      , v = s.a.osg
      , _ = v.StateAttribute.OVERRIDE | v.StateAttribute.ON
      , b = v.createTexturedFullScreenFakeQuadGeometry()
      , x = function(t, e, r) {
        v.Camera.call(this),
        this.addChild(b),
        this.setNodeMask(0),
        this._outTexture = t,
        this._packTextures = i.i(n.clone)(e),
        this._channels = r.slice(),
        this._lastHash = "",
        this.initPacking()
    };
    x.AUTO_RELEASE_GL = !1;
    var y = function(t) {
        t.generateMipmap = function() {
            this._rttPass || v.Texture.prototype.generateMipmap.apply(this, arguments),
            this._rttPass = !1
        }
    };
    x.prototype = v.objectInherit(v.Camera.prototype, {
        getNbChannels: function() {
            return this._channels.length
        },
        disablePacking: function() {
            this.setNodeMask(0);
            for (var t = this.getStateSet(), e = this.getNbChannels(), i = 0; i < e; ++i) {
                var n = t.getTextureAttribute(i, "Texture");
                n && n !== o.a.dummyTexture && n.releaseGLObjects()
            }
            x.AUTO_RELEASE_GL && this.frameBufferObject.releaseGLObjects()
        },
        initPacking: function() {
            var t = this.getOrCreateStateSet()
              , e = this._packTextures
              , i = 0
              , n = this._channels
              , r = n.length
              , a = v.Uniform.createInt4("uReadPacking")
              , s = a.getInternalArray();
            for (i = 0; i < r; ++i) {
                var l = n[i]
                  , u = e[l].texture;
                3 === m.a.getDefaultStringFormat(l).length ? s[i] = 2 : s[i] = u.getInternalFormat() === v.Texture.ALPHA ? 1 : 0
            }
            for (i = 0; i < 4; ++i)
                t.setTextureAttributeAndModes(i, o.a.dummyTexture, _);
            this._outTexture.setTextureSize(1, 1),
            this.setRenderOrder(v.Camera.PRE_RENDER, 0),
            this.attachTexture(v.FrameBufferObject.COLOR_ATTACHMENT0, this._outTexture, v.Texture.TEXTURE_2D);
            var h = new v.Viewport(0,0,1,1);
            this.setReferenceFrame(v.Transform.ABSOLUTE_RF),
            this.setViewport(h),
            t.addUniform(v.Uniform.createInt(0, "uTexture0"), _),
            t.addUniform(v.Uniform.createInt(1, "uTexture1"), _),
            t.addUniform(v.Uniform.createInt(2, "uTexture2"), _),
            t.addUniform(v.Uniform.createInt(3, "uTexture3"), _),
            t.addUniform(a, _)
        },
        updatePacking: function() {
            var t = this._packTextures
              , e = this._channels
              , i = e.length
              , n = 0
              , r = "";
            for (n = 0; n < i; ++n) {
                var a = t[e[n]].texture;
                r += "" + a.getWidth() + a.getHeight()
            }
            if (r === this._lastHash)
                return 0;
            this._lastHash = r,
            this.setNodeMask(-1);
            var s = this.getStateSet()
              , o = 0
              , l = 0
              , u = 0;
            for (n = 0; n < i; ++n) {
                var h = t[e[n]].texture;
                o = Math.max(o, h.getWidth()),
                l = Math.max(l, h.getHeight()),
                s.setTextureAttributeAndModes(u++, h, _)
            }
            return this._outTexture.setTextureSize(o, l),
            this._outTexture.dirtyMipmap(),
            this._outTexture._rttPass = !0,
            this.setRenderOrder(v.Camera.PRE_RENDER, 0),
            this.resetAttachments(),
            this.attachTexture(v.FrameBufferObject.COLOR_ATTACHMENT0, this._outTexture, v.Texture.TEXTURE_2D),
            this.getViewport().setViewport(0, 0, o, l),
            o * l
        }
    });
    var S = function() {
        v.Node.call(this),
        this.addUpdateCallback(this),
        this._program = d.a.createShader(c.a, u.a, "material-packer", "MaterialPacker"),
        this._currentPackingCameras = [],
        this._cacheTextures = {},
        this._frameCount = -1,
        this._checkResolveLowRes = !0,
        this._checkResolveHighRes = !1,
        a.a.all([p.a.getHighResLoaded(), p.a.getLowResBound()]).then(function() {
            this._checkResolveHighRes = !0
        }
        .bind(this))
    };
    S.prototype = v.objectInherit(v.Node.prototype, {
        packTextures: function(t, e) {
            var i = Object.keys(t)
              , n = i.length;
            if (0 === n)
                return v.Texture.textureNull;
            if (1 === n)
                return t[i[0]].texture;
            var r, a = "";
            for (var s in t)
                r = t[s].texture,
                a += r.getInstanceID() + "-";
            if (this._cacheTextures[a])
                return this._cacheTextures[a];
            var l = this._cacheTextures[a] = new o.a;
            y(l),
            l.setImageFormat(v.Texture.RGBA),
            l.setWrapS(r.getWrapS()),
            l.setWrapT(r.getWrapT()),
            l.setMinFilter(r.getMinFilter()),
            l.setMagFilter(r.getMagFilter());
            var u = new x(l,t,e,i);
            return u.getOrCreateStateSet().setAttributeAndModes(this._program, _),
            this.addChild(u),
            l
        },
        update: function() {
            if (0 === ++this._frameCount)
                return !0;
            var t = 0
              , e = this._currentPackingCameras
              , i = e.length;
            if (i) {
                for (t = 0; t < i; ++t)
                    e[t].disablePacking();
                e.length = 0,
                f.a.draw()
            }
            var n = this.getChildren()
              , r = n.length
              , a = 0;
            for (t = 0; t < r; ++t) {
                var s = n[t].updatePacking();
                if (0 !== s && (this._currentPackingCameras.push(n[t]),
                (a += s) >= 1048576))
                    break
            }
            if (this._frameCount > 1 && 0 === i && 0 === this._currentPackingCameras.length) {
                if (this._checkResolveHighRes)
                    for (this._checkResolveHighRes = !1,
                    p.a.resolveHighResBound(),
                    g.a.logMessage("Texture packing FBO Count : " + r),
                    x.AUTO_RELEASE_GL = !0,
                    t = 0; t < r; ++t)
                        n[t].frameBufferObject.releaseGLObjects();
                this._checkResolveLowRes && (this._checkResolveLowRes = !1,
                p.a.resolveLowResBound())
            }
            return !0
        }
    }),
    S.viewerInstance = new S,
    e.a = S
}
, function(t, e, i) {
    "use strict";
    var n = i(554)
      , r = i(7)
      , a = i.n(r)
      , s = i(1)
      , o = (i.n(s),
    i(405))
      , l = i.n(o)
      , u = i(4)
      , h = i(37)
      , c = i(6)
      , d = i(90)
      , p = i(314)
      , f = i(695)
      , g = i(547)
      , m = i(1059)
      , v = i(89)
      , _ = i(674)
      , b = i(937)
      , x = i(922)
      , y = i(440)
      , S = i(29)
      , w = i(51)
      , C = i(1039)
      , M = i(1045)
      , T = i(1044)
      , A = i(293)
      , E = i(552)
      , P = i(43)
      , N = i(146)
      , k = u.a.osg
      , F = u.a.osgViewer
      , D = new l.a({
        device: "VWR"
    })
      , R = function(t) {
        var e = i.i(d.a)() || i.i(A.a)() ? 0 : 1;
        return i.i(s.find)(t, {
            flag: e
        }) || t[0] || t
    }
      , I = function(t) {
        if (t.byteLength)
            return Array.prototype.slice.call(t)
    }
      , O = function(t) {
        return i.i(s.cloneDeepWith)(t, I)
    }
      , L = function(t) {
        this._dataScene = t,
        this._modelFile = R(this._dataScene.files),
        this._root = new k.Node,
        this._root.setName("Scene - Root"),
        this._polygonNode = new k.Node,
        this._polygonNode.setName("Scene - PolygonNode"),
        this._wireframeNodes = [],
        this._resourcePromises = [];
        var e = function(t, e) {
            return t.concat(e)
        }
          , n = function(t) {
            var e = t.lastIndexOf("/");
            return t.substr(0, e + 1)
        }(this.getPolygonURL());
        this._dataScene.options && this._dataScene.options.materials && i.i(s.each)(this._dataScene.options.materials, function(t) {
            i.i(s.each)(t.channels, function(t) {
                t.texture && (t.texture.image && (t.texture.image = e(n, t.texture.image)),
                t.texture.url && (t.texture.url = e(n, t.texture.url)))
            })
        })
    };
    L.prototype = {
        addResourcePromise: function(t) {
            this._resourcePromises.push(t)
        },
        getJSON: function() {
            return this._dataScene
        },
        getPolygonURL: function() {
            return this._modelFile.osgjsUrl
        },
        getWireframeURL: function() {
            return this._modelFile.wireframeUrl
        },
        getPolygonSize: function() {
            return this._modelFile.modelSize
        },
        getWireframeSize: function() {
            return this._modelFile.wireframeSize
        },
        getResourceManager: function() {
            return this._resourceManager || v.default.instance
        },
        getRoot: function() {
            return this._root
        },
        getPolygonNode: function() {
            return this._polygonNode
        },
        getWireframeNodes: function() {
            return this._wireframeNodes
        },
        loadPolygon: function(t, e, i, n) {
            var r = {
                progress: t,
                size: this.getPolygonSize(),
                secondary: !1,
                idChannel: 1,
                node: this.getPolygonNode()
            };
            e && (r.wireframeOptions = {
                progress: !0 === n ? t : void 0,
                size: this.getWireframeSize(),
                secondary: !1,
                idChannel: 2,
                startPromise: i,
                deferDownload: a.a.defer(),
                nodes: this.getWireframeNodes()
            });
            var s = this.getResourceManager().getOrCreateModel(this.getPolygonURL(), r);
            if (e) {
                var o = k.Timer.instance().tick();
                r.wireframeOptions.deferDownload.promise.then(function() {
                    P.a.resolveWireframe({
                        time: k.Timer.instance().tick() - o
                    })
                }
                .bind(this))
            }
            return this.getRoot().addChild(this.getPolygonNode()),
            this.getResourceManager().run(),
            s.promise
        },
        loadWireframe: function(t) {
            var e = {
                progress: t,
                size: this.getWireframeSize(),
                secondary: !1,
                idChannel: 2,
                node: new k.Node
            }
              , i = this.getResourceManager().getOrCreateModel(this.getWireframeURL(), e);
            return this.getWireframeNodes().push(e.node),
            this.getRoot().addChild(e.node),
            i.promise
        }
    };
    var B = c.a.extend({
        initialize: function() {
            if (c.a.prototype.initialize.apply(this, arguments),
            this._root = null,
            this._features = this.options.features,
            this._widgetAPI = this.options.widgetAPI,
            this._viewerAPI = this.options.viewerAPI,
            this._widgetAPI && this._widgetAPI.getTabbedWidget().model.on("change", w.a.draw),
            !this.options.model)
                throw new Error("no model provided to ViewerWebGL");
            this._featuresInstancied = {};
            var t = this.$(".canvas")
              , e = t[0];
            e.oncontextmenu = function() {
                return !1
            }
            ,
            k.time("processModelJSON"),
            i.i(b.a)(this.options.model),
            i.i(S.a)().processOptions && this.options.model.set("options", {
                orientation: {},
                sound: {},
                wireframe: {},
                scene: {},
                materials: {},
                environment: {},
                hotspot: {},
                camera: {},
                lighting: {},
                background: {},
                shading: {}
            }),
            k.timeEnd("processModelJSON"),
            k.Geometry.enableVAO = i.i(S.a)().useVao;
            var n = this._viewer = new F.Viewer(e,{
                rstats: this.getOptionRStats(),
                powerPreference: i.i(S.a)().powerPreference,
                antialias: !1,
                depth: !1,
                stencil: !1,
                alpha: this._requireAlphaContext(),
                premultipliedAlpha: !0,
                fullscreen: !1,
                preserveDrawingBuffer: i.i(S.a)().preserveDrawingBuffer,
                enableFrustumCulling: !1,
                maxDevicePixelRatio: 1.5,
                scrollwheel: i.i(S.a)().scrollwheel,
                EventBackend: {
                    StandardMouseKeyboard: {
                        keyboardEventNode: t[0]
                    },
                    GamePad: {
                        enable: !1
                    }
                }
            })
              , r = k.TimerGPU.instance();
            r.enable(),
            E.a.setTimerGPU(r),
            n.setContextLostCallback(function() {
                this._contextLost = !0,
                k.warn("Context Lost"),
                new (0,
                i(27).default)({
                    title: "3D/WebGL context error",
                    text: "Your browser seems to have hit its 3D capability limit. The page needs to be reloaded to fix this. <br/>If the problems persists, you can try to close other tabs with 3D/WebGL or restart your browser entirely.",
                    safe: !0,
                    buttons: {
                        continue: !0,
                        continueLabel: "Reload Current Page",
                        cancel: !1
                    }
                }).open().then(function() {
                    window.location.reload()
                })
            }
            .bind(this));
            var a = n.getState().getShaderGeneratorProxy();
            a.addShaderGenerator("earlyZ", new C.a),
            a.addShaderGenerator("ShadowCastSkfb", new M.a),
            a.addShaderGenerator("shading-vr", new T.a);
            for (var s = i.i(y.a)(), o = n.getState(), l = 0; l < s; l++)
                o.setGlobalDefaultTextureAttribute(l, k.Texture.textureNull);
            n.requestContinuousUpdate(i.i(S.a)().continuousRender),
            t[0].setAttribute("tabindex", "0"),
            n.init(),
            this.getCamera().getRenderer().setCullVisitor(new g.a),
            n.setupManipulator(),
            this._root = new k.MatrixTransform,
            n.getCamera().setClearColor(k.vec4.create()),
            n.setSceneData(this._root),
            w.a.setViewer(n),
            this._superSample = new m.a(this),
            this._superSample.setCanBeEnabled(i.i(S.a)().supersample),
            w.a.setSuperSample(this._superSample),
            this._superSample.setRoot(this._root),
            n.getManipulator().computeHomePosition(),
            n._requestAnimationFrame = p.a.get(),
            n.run(),
            this._currentScene = void 0
        },
        _requireAlphaContext: function() {
            if (i.i(d.a)() || i.i(S.a)().transparent)
                return !0;
            var t = this.options.model.get("options");
            return "none" === (t && t.background && t.background.enable)
        },
        getOptionRStats: function() {
            var t = ["EarlyOpaque", "EarlyTransparency", "ShadingOpaque", "ShadingTransparency", "Extra"]
              , e = ["ShadowMap0", "ShadowMap1", "ShadowMap2"]
              , i = ["MergeOpacity", "DepthMipmap1", "DepthMipmap2", "DepthMipmap3", "DepthMipmap4", "DepthMipmap5", "SsaoExtract", "SsaoBlurH", "SsaoBlurV", "DofDownsampleCoC", "DofDownsampleColor", "DofNearDilateH", "DofNearDilateV", "DofBlurCircular", "DofCombine", "BloomExtractBright", "VBlur4", "HBlur4", "VBlur6", "HBlur6", "VBlur8", "HBlur8", "VBlur10", "HBlur10", "VBlur12", "HBlur12", "BloomMergeAdditive", "PostProcessMergeable", "Antialias", "DistortionVR", "AntiAliasVR", "PassTroughFinal"]
              , n = ["Total GL", "Shading", "PostProcess", "ShadowMap"]
              , r = {}
              , a = function(t) {
                for (var e = [], i = 0, n = t.length; i < n; ++i)
                    e[i] = t[i].toLowerCase(),
                    r[e[i]] = {
                        caption: t[i],
                        average: !0
                    };
                return e
            }
              , s = [{
                caption: "GL Total (ms)",
                values: a(n)
            }, {
                caption: "GL Shading (ms)",
                values: a(t)
            }, {
                caption: "GL PostProcess (ms)",
                values: a(i)
            }, {
                caption: "GL ShadowMap (ms)",
                values: a(e)
            }];
            return {
                values: r,
                groups: s
            }
        },
        getRootUserData: function() {
            return this._currentScene ? this.getRootModel().userDataMap || {} : {}
        },
        getRootModel: function() {
            return this._currentScene.getRoot()
        },
        getWidth: function() {
            return this.getCanvas().width
        },
        getHeight: function() {
            return this.getCanvas().height
        },
        getOptions: function() {
            return this.options
        },
        isViewerReady: function() {
            return P.a.getModelDisplayed()
        },
        getViewerAPI: function() {
            return this._viewerAPI
        },
        createContext: function(t) {
            return new _.a({
                model: t.model,
                viewer: this,
                scene: t.scene,
                widgetAPI: this._widgetAPI
            })
        },
        updateProgress: function(t, e, i) {
            var n = e ? this._channelsSecondary : this._channelsPrimary
              , r = e ? this._channelsSecondaryWeights : this._channelsPrimaryWeights;
            n[i] = t;
            for (var a = 0, s = 0; s < n.length; ++s)
                a += n[s] * r[s];
            this.trigger(e ? "secondary-progress" : "primary-progress", {
                progress: a
            })
        },
        initProgress: function(t) {
            var e = i.i(S.a)().preload;
            this._channelsPrimary = [0, 0],
            t && this._channelsPrimary.push(0),
            this._channelsPrimaryWeights = [],
            this._channelsPrimaryWeights[0] = e ? .5 : .1,
            this._channelsPrimaryWeights[1] = e ? .5 : .9,
            t && (this._channelsPrimaryWeights[2] = this._channelsPrimaryWeights[1] = .5 * this._channelsPrimaryWeights[1]),
            this._channelsSecondary = [0],
            this._channelsSecondaryWeights = [1]
        },
        setFakeSecondaryProgress: function(t, e) {
            this.setFakeProgress(t, !0, e)
        },
        setFakePrimaryProgress: function(t, e) {
            this.setFakeProgress(t, !1, e)
        },
        setFakeProgress: function(t, e, i) {
            void 0 === this._idLastProgress && (this._idLastProgress = 0),
            i = i || 0,
            t = void 0 !== t.length ? t : [t];
            var n = t.length;
            if (0 === n)
                return void this.updateProgress(1, e, i);
            for (var r = 0, a = ++this._idLastProgress, s = function() {
                a === this._idLastProgress && this.updateProgress(++r / n, e, i)
            }
            .bind(this), o = 0; o < n; ++o)
                t[o].finally(s);
            var l = 0
              , u = 0
              , h = function() {
                if (a === this._idLastProgress) {
                    if (l !== r) {
                        if (r === n)
                            return;
                        l = r,
                        u = r / n
                    }
                    var t = (r + 1) / n;
                    u < t && (u = Math.min(t - .01, u + .01 / n),
                    this.updateProgress(u, e, i)),
                    window.setTimeout(h, 100)
                }
            }
            .bind(this);
            window.setTimeout(h, 100)
        },
        preloadWire: function(t, e) {
            var i = t.loadWireframe(e)
              , n = k.Timer.instance().tick();
            return i.then(function() {
                P.a.resolveWireframe({
                    time: k.Timer.instance().tick() - n
                })
            }
            .bind(this)),
            i
        },
        run: function() {
            var t = this.options.model
              , e = this
              , n = this.getOrCreateScene(t.toJSON());
            n.getResourceManager().setModelUID(t.get("uid")),
            P.a.resolveHasAnimation(n.getJSON().animationCount > 0 || i.i(d.a)() && t.get("options").animation && t.get("options").animation.order && t.get("options").animation.order.length > 0);
            var r = this.createContext({
                model: t,
                scene: n
            })
              , s = n._resourcePromises
              , o = i.i(S.a)().preload
              , l = R(t.get("files"))
              , u = !0 === t.get("options").wireframe.enable && !0 === o && void 0 !== l.wireframeSize && l.wireframeSize > 0
              , h = !l.wireframeUrl || !l.wireframeSize
              , c = u ? a.a.resolve() : P.a.getHighResLoaded()
              , p = n.loadPolygon(this.updateProgress.bind(this), h, c, u);
            s.push(p);
            var f = k.Timer.instance().tick();
            return p.then(function() {
                P.a.resolvePolygon({
                    time: k.Timer.instance().tick() - f
                })
            }),
            !h && u && s.push(this.preloadWire(n, this.updateProgress.bind(this))),
            k.time("createAndInitFeatures"),
            e._features.forEach(function(t) {
                e.addFeature(t, r)
            }),
            k.timeEnd("createAndInitFeatures"),
            this.initProgress(u),
            a.a.all(s).then(this._launchViewer.bind(this, r, h, u, f)),
            this._featuresInstancied = r.getFeatures(),
            P.a.getModelDisplayed()
        },
        _launchViewer: function(t, e, r, a) {
            k.time("featureFinished"),
            this.featureFinished(t, this._root),
            k.timeEnd("featureFinished"),
            e || r || P.a.getHighResLoaded().then(this.preloadWire.bind(this, this._currentScene)),
            this.trigger("primary-progress", {
                progress: 1
            }),
            n.a.logBound(N.a.getModelBoxWithoutDisplacement()),
            n.a.showMessage(),
            (i.i(S.a)().preload ? P.a.getHighResBound() : P.a.getLowResBound()).then(this._onViewerLaunched.bind(this, a))
        },
        _onViewerLaunched: function(t) {
            if (this._featuresManager.setInitialAnimation(),
            this.drawFrame(),
            P.a.resolveModelDisplayed({
                time: k.Timer.instance().tick() - t
            }),
            this.trigger("success"),
            this.trigger("viewerready"),
            i.i(S.a)().messaging) {
                D.createMessage({
                    data: "ready"
                }).appendToHash()
            }
        },
        onFail: function(t, e) {
            k.error(e.stack),
            t.reject(e),
            this.trigger("failure")
        },
        addFeature: function(t, e) {
            if (!t)
                return console.warn("Feature undefined!"),
                !0;
            var n = new t;
            if (n.init(e),
            i.i(d.a)()) {
                var r = n.getModel()
                  , a = n.getName();
                r.editorSetJSON && !window.editorModels[a] && (window.editorModels[a] = {
                    setJSON: this._makeCallbackSetJSON(r),
                    getJSON: this._makeCallbackGetJSON(r)
                })
            }
        },
        _makeCallbackSetJSON: function(t) {
            return function(e) {
                var i = t.editorSetJSON(O(e));
                return i.then ? i : i ? a.a.reject(i) : a.a.resolve()
            }
        },
        _makeCallbackGetJSON: function(t) {
            return function() {
                var e = t.editorGetJSON();
                return a.a.resolve(O(e))
            }
        },
        drawFrame: function() {
            this._viewer.frame()
        },
        getCanvas: function() {
            return this._viewer.getGraphicContext().canvas
        },
        setTimeline: function(t) {
            this._timeline = t
        },
        getTimeline: function() {
            return this._timeline
        },
        getScreenShot: function(t, e) {
            return i.i(f.a)(t, e, this)
        },
        getCamera: function() {
            return this._viewer.getCamera()
        },
        getFeatures: function() {
            return this._featuresInstancied
        },
        getSuperSample: function() {
            return this._superSample
        },
        getFeaturesManager: function() {
            return this._featuresManager
        },
        getViewerOSGJS: function() {
            return this._viewer
        },
        getOrCreateScene: function(t) {
            if (this._currentScene)
                return this._currentScene;
            var e = new L(t);
            return e.getResourceManager().setStateContextOSG(this._viewer.getState()),
            this._currentScene = e,
            e
        },
        featureFinished: function(t, e) {
            return this._featuresManager = new x.a(this,t),
            this._featuresManager.finished(e)
        },
        getOptionsJSON: function() {
            var t = this.getFeatures()
              , e = {};
            e.version = h.a.optionsVersion,
            e.background = t.background.getModel().getJSON(),
            e.environment = t.environment.getModel().getJSON(),
            e.lighting = t.lighting.getModel().getJSON(),
            e.scene = t.fov.getModel().getJSON(),
            e.materials = t.material.getModel().getJSON(),
            e.orientation = t.orientation.getModel().getJSON(),
            e.camera = t.manipulator.getModel().getJSON(),
            e.animation = t.animation.getModel().getJSON(),
            e.hotspot = t.hotspot.getModel().getJSON(),
            e.vr = t.webVR.getModel().getJSON(),
            e.scene = e.scene || {},
            e.scene.postProcess = t.postProcess.getModel().getJSON(),
            e.sound = t.sound.getModel().getJSON();
            var i = t.shadingStyle.getModel().getJSON();
            return e.shading = i.shading,
            e.wireframe = i.wireframe,
            b.a.readOptions(e)
        }
    });
    e.a = B
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(43)
      , a = i(689)
      , s = i(70)
      , o = i(29)
      , l = i(421)
      , u = i(87)
      , h = n.a.osg
      , c = n.a.osgUtil
      , d = n.a.osgAnimation
      , p = c.IntersectionVisitor.prototype.enter;
    c.IntersectionVisitor.prototype.enter = function(t) {
        return !!t._forceEnterIntersection || p.call(this, t)
    }
    ;
    var f = function() {};
    f.prototype = {
        cull: function() {
            return !1
        }
    };
    var g = new f
      , m = function() {
        var t = h.vec3.create()
          , e = h.vec3.create();
        return function(n) {
            n.center(t),
            h.vec3.sub(e, n.getMax(), n.getMin());
            var r = h.createTexturedBoxGeometry(t[0], t[1], t[2], e[0], e[1], e[2]);
            return r.setName("BoneBox"),
            3 !== i.i(o.a)().showBones && r.setCullCallback(g),
            r._isBoneBox = !0,
            r.setNodeMask(s.a.PICK_GEOMETRY_RIG_BOX | s.a.SHADOW_BOUNDS),
            r
        }
    }()
      , v = function(t) {
        for (var e = c.GizmoGeometry.createCylinderGeometry(.1 * t, .02 * t, t), i = e.getAttributes().Vertex.getElements(), n = 0, r = i.length / 3; n < r; ++n)
            i[3 * n + 2] += .5 * t;
        return e._isSkeleton = !0,
        e
    }
      , _ = function(t) {
        h.NodeVisitor.call(this),
        this._visitedNodes = {},
        this._drawNames = t;
        var e = h.StateAttribute.OVERRIDE | h.StateAttribute.ON
          , i = this._geoStateSet = new h.StateSet;
        i.setShaderGeneratorName("skeleton", e),
        i.setAttributeAndModes(new h.Depth(h.Depth.ALWAYS), e),
        i.setRenderBinDetails(u.a.DEBUG_2, "RenderBin"),
        l.a.set("hasExtra", !0)
    };
    _.prototype = h.objectInherit(h.NodeVisitor.prototype, {
        drawBone: function() {
            var t = h.vec3.create()
              , e = h.vec3.fromValues(0, 0, 1)
              , i = h.quat.create();
            return function(n) {
                var r = n.getChildren();
                if (r.length)
                    for (var a = 0; a < r.length; ++a) {
                        var s = r[a];
                        if (s instanceof d.Bone != !1) {
                            h.vec3.transformMat4(t, h.vec3.set(t, 0, 0, 0), s.getMatrix());
                            var o = v(h.vec3.len(t));
                            o.setStateSet(this._geoStateSet),
                            o._boundingBoxComputed = !0,
                            o._boundingSphereComputed = !0;
                            var l = new h.MatrixTransform;
                            h.quat.rotationTo(i, e, h.vec3.normalize(t, t)),
                            h.mat4.fromRotationTranslation(l.getMatrix(), i, h.vec3.ZERO);
                            var u = h.Uniform.createFloat4("uColor")
                              , c = u.getInternalArray()
                              , p = n.getOrCreateDebugColor();
                            h.vec3.copy(c, p),
                            c[0] = .9 * p[0],
                            c[1] = .9 * p[1],
                            c[2] = .9 * p[2],
                            c[3] = 1,
                            l.getOrCreateStateSet().addUniform(u);
                            var f = "Debug " + n.getName();
                            l.setName(f),
                            o.setName(f),
                            l.addChild(o),
                            n.addChild(l)
                        }
                    }
            }
        }(),
        apply: function(t) {
            var e = t.getInstanceID();
            this._visitedNodes[e] || (this._visitedNodes[e] = !0,
            t instanceof d.Bone && this._drawNames[t.getName()] && this.drawBone(t),
            this.traverse(t))
        }
    });
    var b = function(t, e) {
        h.NodeVisitor.call(this),
        this._wirePromise = r.a.getWireframe(),
        this._wireNodes = e.getOrCreateScene().getWireframeNodes(),
        this.nodeMaskOverride = -1,
        this._visitedNodes = {},
        this._drawBoneNames = {},
        this._rigIndexed = [],
        this._boneGeomIndexed = [],
        this._skls = t;
        var i = h.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_UNIFORM_VECTORS");
        this._maxBones = Math.floor((i - 21) / 3),
        d.SkinningAttribute.maxBoneUniformAllowed = 3 * this._maxBones,
        this._maxVA = h.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_ATTRIBS")
    };
    b.prototype = h.objectInherit(h.NodeVisitor.prototype, {
        createSplitRigGeometry: function(t) {
            var e = new d.RigGeometry;
            e.setName("Split (" + t.getInstanceID() + ")"),
            e.setStateSet(t.getStateSet()),
            e.setUserData(t.getUserData()),
            e.userDataMap = t.userDataMap,
            e.setSourceGeometry(t.getSourceGeometry()),
            e._forceEnterIntersection = !0;
            var i = t.getVertexAttributeList()
              , n = e.getVertexAttributeList();
            for (var r in i)
                n[r] = i[r];
            var a = i.Bones.getElements()
              , o = new a.constructor(a.length);
            n.Bones = new h.BufferArray(h.BufferArray.ARRAY_BUFFER,o,i.Bones.getItemSize(),!0),
            e.userDataMap.wireframe ? this._wireNodes.push(e) : e.setNodeMask(s.a.NO_PICK_NO_SHADOW_BOUNDS);
            var l = e.userDataMap.rigIndex;
            return void 0 !== l && (this._rigIndexed[l] = e),
            e._boundingSphereComputed = !0,
            e._boundingBoxComputed = !0,
            e
        },
        checkVertex: function(t, e) {
            var i = e.baseBones
              , n = e.baseWeights
              , r = e.mappedUsedBones
              , a = 0;
            return n[t] && !r[i[t]] && a++,
            n[t + 1] && !r[i[t + 1]] && a++,
            n[t + 2] && !r[i[t + 2]] && a++,
            n[t + 3] && !r[i[t + 3]] && a++,
            a
        },
        tagBoneVertex: function(t, e) {
            var i = e.baseBones
              , n = e.baseWeights
              , r = e.mappedUsedBones
              , a = e.boneNameID
              , s = e.boneToName
              , o = i[t];
            n[t] && !r[o] && (a[s[o]] = e.nbUsedBones,
            r[o] = ++e.nbUsedBones),
            e.newBones[t] = r[o] - 1,
            o = i[t + 1],
            n[t + 1] && !r[o] && (a[s[o]] = e.nbUsedBones,
            r[o] = ++e.nbUsedBones),
            e.newBones[t + 1] = r[o] - 1,
            o = i[t + 2],
            n[t + 2] && !r[o] && (a[s[o]] = e.nbUsedBones,
            r[o] = ++e.nbUsedBones),
            e.newBones[t + 2] = r[o] - 1,
            o = i[t + 3],
            n[t + 3] && !r[o] && (a[s[o]] = e.nbUsedBones,
            r[o] = ++e.nbUsedBones),
            e.newBones[t + 3] = r[o] - 1
        },
        splitTriangle: function(t, e, i, n) {
            if (n.currentIdPrimitive++,
            t === e || t === i || e === i || n.processedPrimitive[n.currentIdPrimitive - 1])
                return !0;
            var r = n.nbUsedBones
              , a = this.checkVertex(4 * t, n);
            if (r + a < this._maxBones && (a += this.checkVertex(4 * e, n)),
            r + a < this._maxBones && (a += this.checkVertex(4 * i, n)),
            r + a >= this._maxBones)
                return void (n.finished = !1);
            this.tagBoneVertex(4 * t, n),
            this.tagBoneVertex(4 * e, n),
            this.tagBoneVertex(4 * i, n);
            var s = n.first + n.countIdPrimitive;
            n.countIdPrimitive += 3,
            n.newIndexesElements[s] = t,
            n.newIndexesElements[s + 1] = e,
            n.newIndexesElements[s + 2] = i,
            n.processedPrimitive[n.currentIdPrimitive - 1] = 1
        },
        splitLine: function(t, e, i) {
            if (i.currentIdPrimitive++,
            t === e || i.processedPrimitive[i.currentIdPrimitive - 1])
                return !0;
            var n = i.nbUsedBones
              , r = this.checkVertex(4 * t, i);
            if (n + r < this._maxBones && (r += this.checkVertex(4 * e, i)),
            n + r >= this._maxBones)
                return void (i.finished = !1);
            this.tagBoneVertex(4 * t, i),
            this.tagBoneVertex(4 * e, i);
            var a = i.first + i.countIdPrimitive;
            i.countIdPrimitive += 2,
            i.newIndexesElements[a] = t,
            i.newIndexesElements[a + 1] = e,
            i.processedPrimitive[i.currentIdPrimitive - 1] = 1
        },
        callbackDrawElementsTriangles: function(t, e, i) {
            for (var n = 0; n < t; n += 3)
                this.splitTriangle(e[n], e[n + 1], e[n + 2], i)
        },
        callbackDrawElementsTriangleStrip: function(t, e, i) {
            for (var n = 2, r = 0; n < t; ++n,
            ++r)
                n % 2 ? this.splitTriangle(e[r], e[r + 2], e[r + 1], i) : this.splitTriangle(e[r], e[r + 1], e[r + 2], i)
        },
        callbackDrawElementsLines: function(t, e, i) {
            for (var n = 0; n < t; n += 2)
                this.splitLine(e[n], e[n + 1], i)
        },
        splitPrimitive: function(t, e) {
            t.finished = !0;
            var i = t.baseRig
              , n = t.primitive
              , r = this.createSplitRigGeometry(i);
            t.boneNameID = r._boneNameID,
            t.newBones = r.getVertexAttributeList().Bones.getElements(),
            t.mappedUsedBones = new Uint32Array(e),
            t.nbUsedBones = 0,
            t.currentIdPrimitive = 0,
            t.countIdPrimitive = 0;
            var a = n.getIndices().getElements()
              , s = n.getCount()
              , o = n.getMode();
            if (o === h.PrimitiveSet.TRIANGLE_STRIP ? this.callbackDrawElementsTriangleStrip(s, a, t) : o === h.PrimitiveSet.TRIANGLES ? this.callbackDrawElementsTriangles(s, a, t) : this.callbackDrawElementsLines(s, a, t),
            0 === t.countIdPrimitive)
                return !1;
            var l = new h.DrawElements(o === h.PrimitiveSet.LINES ? h.PrimitiveSet.LINES : h.PrimitiveSet.TRIANGLES,t.newIndexesBuffer);
            l.setFirst(t.first * t.newIndexesElements.BYTES_PER_ELEMENT),
            l.setCount(t.countIdPrimitive),
            t.first += t.countIdPrimitive,
            r.getPrimitives().push(l);
            for (var u = i.getParents(), c = u.length, d = 0; d < c; ++d)
                u[d].addChild(r);
            return !t.finished
        },
        getBoneToNames: function(t, e) {
            for (var i = e.length, n = new Array(i), r = 0; r < i; ++r) {
                var a = e[r];
                n[t[a]] = a
            }
            return n
        },
        splitRigGeometry: function(t) {
            for (var e = t._boneNameID, i = Object.keys(e), n = i.length, r = t.getPrimitives(), a = r.length, s = {
                baseRig: t,
                baseWeights: t.getVertexAttributeList().Weights.getElements(),
                baseBones: t.getVertexAttributeList().Bones.getElements(),
                boneToName: this.getBoneToNames(t._boneNameID, i)
            }, o = 0; o < a; ++o) {
                var l = r[o]
                  , u = l.getMode();
                if (0 !== l.getCount())
                    if (l instanceof h.DrawElements != !1)
                        if (u === h.PrimitiveSet.TRIANGLE_STRIP || u === h.PrimitiveSet.TRIANGLES || u === h.PrimitiveSet.LINES) {
                            var c = l.getIndices()
                              , d = c.getElements()
                              , p = u === h.PrimitiveSet.TRIANGLE_STRIP ? 3 : 1;
                            for (s.newIndexesElements = new d.constructor(l.getCount() * p),
                            s.newIndexesBuffer = new h.BufferArray(h.BufferArray.ELEMENT_ARRAY_BUFFER,s.newIndexesElements,c.getItemSize(),!0),
                            s.first = l.getFirst(),
                            s.processedPrimitive = new Uint8Array(l.getCount()),
                            s.primitive = l; this.splitPrimitive(s, n); )
                                ;
                            s.newIndexesBuffer.setElements(s.newIndexesElements.subarray(0, s.first))
                        } else
                            h.error("Split rigged primitives mode not yet handled : ", u);
                    else
                        h.error("Split rigged primitives type not yet handled", l)
            }
        },
        handleRigGeometry: function(t) {
            var e = t._boneNameID
              , n = i.i(o.a)().showBones
              , r = t.userDataMap.wireframe
              , a = t.userDataMap.rigIndex;
            if (void 0 !== a && (this._rigIndexed[a] = t),
            1 === n || 2 === n)
                if (r)
                    t.setCullCallback(g);
                else {
                    2 !== n && t.setNodeMask(0);
                    var l = this._drawBoneNames;
                    for (var u in e)
                        l[u] = !0
                }
            else
                this._maxBones < Object.keys(e).length ? (r ? (t._boundingBoxComputed = !0,
                t._boundingSphereComputed = !0,
                t.setNodeMask(0),
                this._wirePromise.then(this.splitRigGeometry.bind(this, t))) : (this.splitRigGeometry(t),
                t.setNodeMask(s.a.NO_PICK_NO_SHADOW_BOUNDS | s.a.PICK_GEOMETRY_ANIMATED)),
                t.setCullCallback(g)) : r || t.setNodeMask(s.a.NO_PICK_NO_SHADOW_BOUNDS | s.a.PICK_GEOMETRY_ANIMATED);
            this.tagForceIntersection()
        },
        tagForceIntersection: function() {
            for (var t = this._skls[this._skls.length - 1], e = 1 + this.nodePath.indexOf(t); e < this.nodePath.length; ++e)
                this.nodePath[e]._forceEnterIntersection = !0
        },
        popTargetAttribute: function(t, e, i) {
            for (var n = e.getMorphTargets(), r = n.length, a = t.getVertexAttributeList(), s = e.getVertexAttributeList(), o = 0; o < r; ++o) {
                delete n[o].getVertexAttributeList()[i];
                var l = i + "_" + o;
                delete a[l],
                a !== s && delete s[l]
            }
        },
        computeUsedVA: function(t, e, i, n) {
            var r = Object.keys(t).length - Object.keys(e).length * (i.length - Math.min(n, i.length));
            return t.Color || r++,
            r
        },
        handleMorphGeometry: function(t, e) {
            var i = e.getMaximumPossibleMorphGPU()
              , n = e.getMorphTargets()
              , r = n[0].getVertexAttributeList()
              , a = t.getVertexAttributeList()
              , s = this.computeUsedVA(a, r, n, i)
              , o = this._maxVA;
            if (!(s <= o || a.Tangent_1 && (this.popTargetAttribute(t, e, "Tangent"),
            (s = this.computeUsedVA(a, r, n, i)) <= o) || a.Normal_1 && (this.popTargetAttribute(t, e, "Normal"),
            (s = this.computeUsedVA(a, r, n, i)) <= o))) {
                for (; i > 0; )
                    if (i--,
                    e.setMaximumPossibleMorphGPU(i),
                    (s = this.computeUsedVA(a, r, n, i)) <= o)
                        return;
                console.warn("Too much vertex attributes!")
            }
        },
        apply: function(t) {
            var e = t.getInstanceID();
            if (!this._visitedNodes[e]) {
                this._visitedNodes[e] = !0;
                var i = t instanceof d.RigGeometry
                  , n = i ? t.getSourceGeometry() : t;
                if (n instanceof d.MorphGeometry && this.handleMorphGeometry(t, n),
                i)
                    this.handleRigGeometry(t);
                else if (t instanceof d.Bone) {
                    var r = t.getBoneBoundingBox();
                    if (r.valid()) {
                        var a = m(r);
                        t.addChild(a);
                        var s = t.userDataMap.rigIndex;
                        void 0 !== s && this._boneGeomIndexed.push(a)
                    }
                } else
                    t instanceof d.Skeleton && this._skls.push(t);
                this.traverse(t)
            }
        }
    });
    var x = {};
    x.DrawBones = _,
    x.hideCullCallback = g,
    x.init = function(t, e, i) {
        var n = new b(t,e)
          , r = e.getOrCreateScene().getRoot();
        h.time("InitGraphAnimation"),
        r.accept(n),
        h.timeEnd("InitGraphAnimation");
        for (var s = n._boneGeomIndexed, o = n._rigIndexed, l = s.length, u = 0; u < l; ++u) {
            var c = s[u];
            c._mostInfluencedRig = o[c.getParents()[0].userDataMap.rigIndex]
        }
        Object.keys(n._drawBoneNames).length > 0 && (e.getViewerOSGJS().getState().getShaderGeneratorProxy().addShaderGenerator("skeleton", new a.a),
        r.accept(new _(n._drawBoneNames)),
        i.set("notSupported", !0))
    }
    ,
    e.a = x
}
, function(t, e, i) {
    "use strict";
    var n, r = i(4), a = r.a.osg, s = function() {
        return n || (n = {
            environmentTransform: a.Uniform.createMatrix4(a.mat4.create(), "uEnvironmentTransform"),
            exposure: a.Uniform.createFloat1(1, "uEnvironmentExposure"),
            diffuseSPH: a.Uniform.createFloat3Array(new Float32Array(27), "uDiffuseSPH"),
            textureSpecular: a.Uniform.createInt1("sEnvironmentSpecular"),
            textureSpecularPBR: a.Uniform.createInt1("sSpecularPBR"),
            textureIntegrateBRDF: a.Uniform.createInt1("sIntegrateBRDF"),
            factorShadowEnv0: a.Uniform.createFloat(0, "uFactorShadowEnv0")
        })
    };
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = function(t) {
        var e = t || {};
        return window.location && window.location.hash ? (window.location.hash.substr(1).split(",").forEach(function(t) {
            var i = t.split("=")
              , n = i[0]
              , r = i[1];
            if ("debug3d" === n && (e.debug3d = !0),
            "stats" === n && (e.stats = !0),
            n.match("material_"))
                switch (n = n.substr(9)) {
                case "showcase":
                    e.materialShowcase = void 0 === r ? e.materialShowcase : "0" !== r;
                    break;
                case "names":
                    e.materialNames = r;
                    break;
                case "normal":
                    e.materialNormal = r;
                    break;
                case "emissive":
                    e.materialEmissive = r;
                    break;
                case "transparency":
                    e.materialTransparency = r;
                    break;
                case "diffuse":
                    e.materialDiffuse = r;
                    break;
                case "metalness":
                    e.materialMetalness = r;
                    break;
                case "roughness":
                    e.materialRoughness = r;
                    break;
                case "glossiness":
                    e.materialGlossiness = r;
                    break;
                case "specular":
                    e.materialSpecular = r;
                    break;
                case "cavity":
                    e.materialCavity = r;
                    break;
                case "f0":
                    e.materialF0 = r;
                    break;
                case "ao":
                    e.materialAO = r;
                    break;
                case "displacement":
                    e.materialDisplacement = r;
                    break;
                case "displacement_factor":
                    e.materialDisplacementFactor = void 0 === r ? e.materialDisplacementFactor : Number(r)
                }
        }),
        e) : e
    };
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(70)
      , a = i(87)
      , s = i(1076)
      , o = i(2)
      , l = i.n(o)
      , u = i(578)
      , h = (i.n(u),
    n.a.osg)
      , c = n.a.osgUtil
      , d = h.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0)
      , p = c.GizmoGeometry.createCylinderGeometry(.0025, .0025, 1, 8, 1, !1, !1)
      , f = new h.MatrixTransform;
    f.getMatrix()[14] = .5,
    f.addChild(p),
    p._boundingBoxComputed = !0,
    p._boundingSphereComputed = !0;
    var g = function(t, e) {
        h.Node.call(this),
        this._idHotspot = t,
        this._viewer = e,
        this._hotspotMT = new h.MatrixTransform,
        this._cardPanel = new s.a,
        this._lineToCardMT = new h.MatrixTransform,
        this._hotspotMT.addChild(d),
        this.addChild(this._hotspotMT),
        this.addChild(this._lineToCardMT),
        this.addChild(this._cardPanel),
        this._cardPanel.setVisible(!1),
        this._lineToCardMT.setNodeMask(0),
        this._worldTeleportPos = void 0,
        this._cardInitialized = !1,
        this._texCard = new h.Texture,
        this._texCard.setTextureSize(1, 1),
        this._canTeleport = !1,
        this._uAlpha = void 0,
        this._color = void 0,
        this._lineToCardMT.addChild(f),
        this._hotspotMT._boundingBoxComputed = !0,
        this._hotspotMT._boundingSphereComputed = !0,
        this.init()
    };
    g.COLOR_NORMAL = h.vec3.fromValues(1, 1, 1),
    g.COLOR_HOVERED = h.vec3.fromValues(0, .8, 1),
    g.COLOR_DRAG_OK = h.vec3.fromValues(0, .4, 1),
    g.COLOR_DRAG_FAIL = h.vec3.fromValues(.8, .2, .2),
    g.initLineShader = function(t) {
        var e = p.getOrCreateStateSet();
        e.setAttributeAndModes(t),
        e.addUniform(h.Uniform.createFloat4(h.vec4.fromValues(.03, .59, .78, .4), "uLineColor")),
        e.setRenderBinDetails(a.a.TOOLTIP, "RenderBin")
    }
    ,
    g.prototype = h.objectInherit(h.Node.prototype, {
        init: function() {
            var t = this.getOrCreateStateSet();
            t.addUniform(h.Uniform.createFloat(this._idHotspot, "uHotspotIndex"));
            var e = h.Uniform.createFloat3(h.vec3.fromValues(1, 1, 1), "uColor");
            this._color = e.getInternalArray(),
            t.addUniform(e)
        },
        getIndex: function() {
            return this._idHotspot
        },
        getHotspotMatrix: function() {
            return this._hotspotMT.getMatrix()
        },
        getColor: function() {
            return this._color
        },
        isFullyVisibleCard: function() {
            return this._cardPanel.isVisible()
        },
        isVisibleCard: function() {
            return this._cardPanel.isHinted() || this._cardPanel.isVisible()
        },
        canTeleport: function() {
            return this._canTeleport && !this.isFullyVisibleCard()
        },
        setWorldTeleportPosition: function() {
            var t = h.vec3.create()
              , e = h.vec3.create()
              , i = h.vec3.create()
              , n = h.mat4.create();
            return function(r, a, s) {
                if (!this.isFullyVisibleCard()) {
                    var o = this._cardPanel.getMatrix();
                    this.getWorldMatrix(void 0, n),
                    this._worldTeleportPos = h.vec3.copy(this._worldTeleportPos || h.vec3.create(), a),
                    h.vec3.copy(i, a),
                    i[2] += 1.5 * s,
                    h.vec3.sub(e, r, i),
                    e[2] = 0,
                    h.vec3.normalize(e, e),
                    h.vec3.scale(e, e, 1 * s),
                    h.vec3.add(e, i, e),
                    this.lookToWorld(o, e, i, s, n),
                    h.vec3.sub(t, a, r);
                    var l = h.vec3.length(t);
                    h.vec3.sub(t, a, e);
                    var u = h.vec3.length(t)
                      , c = l < u ? -1 : 1;
                    e[2] += .5 * c * .5625 * s;
                    var d = this._lineToCardMT.getMatrix();
                    this.lookToWorld(d, r, e, 1, n),
                    h.mat4.scale(d, d, h.vec3.set(t, s, s, h.vec3.dist(e, r))),
                    this._cardPanel.dirtyBound()
                }
            }
        }(),
        setCardVisibilityListener: function(t) {
            this._cardVisibilityListener = t
        },
        setVisibleCard: function(t) {
            this._isCardInitialized || this.initCard(),
            this._cardPanel.setVisible(t),
            this._lineToCardMT.setNodeMask(t ? r.a.NO_PICK : 0),
            this._cardVisibilityListener && this._cardVisibilityListener(this, t)
        },
        setHovered: function(t) {
            this._isCardInitialized || this.initCard(),
            h.vec3.copy(this.getColor(), t ? g.COLOR_HOVERED : g.COLOR_NORMAL),
            this.isFullyVisibleCard() || (this._cardPanel.setHinted(t),
            this._lineToCardMT.setNodeMask(t ? r.a.NO_PICK : 0))
        },
        initCard: function() {
            var t = l()(".hotspots")
              , e = l()(t.get(0).childNodes[this._idHotspot])
              , i = this._viewer.getFeatures().hotspot._views[0]._hotspots;
            this._setDescriptionStyle(e, {
                width: "1024px",
                lineHeight: "2",
                fontSize: "38px"
            });
            var n = e.find(".description").outerHeight() + 4 * e.find(".title").outerHeight()
              , r = Math.max(1, Math.round(n / 576) + (n % 576 > 0 ? 1 : 0));
            this._setDescriptionStyle(e, null),
            this._cardPanel.initialize("skfb_front/macros/hotspot", {
                hotspotIndex: this._idHotspot,
                displayNavigation: i.length && i.length > 1,
                column: r,
                widthContent: 1024 * r,
                title: e.find(".title")[0].innerText,
                description: e.find(".description").html()
            }),
            this._isCardInitialized = !0
        },
        _setDescriptionStyle: function(t, e) {
            t.find(".description").css({
                width: null !== e ? e.width : "",
                lineHeight: null !== e ? e.lineHeight : "",
                fontSize: null !== e ? e.fontSize : ""
            })
        },
        updateCardHit: function(t) {
            this._hoveredCard = this._cardPanel.updateHit(t)
        },
        onCardHit: function(t) {
            this._isCallbackSetup || (this._setupCallback(t),
            this._isCallbackSetup = !0),
            this._hoveredCard ? this._cardPanel.click() : this._cardPanel.setVisible(!1)
        },
        _setupCallback: function(t) {
            this._cardPanel.setClickAction("closeButton", function() {
                this.setVisibleCard(!1)
            }
            .bind(this)),
            this._cardPanel.setClickAction("nextButton", function() {
                t.goToNextHotspot()
            }),
            this._cardPanel.setClickAction("prevButton", function() {
                t.goToPrevHotspot()
            })
        },
        lookToWorld: function() {
            var t = h.vec3.create()
              , e = h.vec3.fromValues(0, 0, -1)
              , i = h.mat4.fromXRotation(h.mat4.create(), Math.PI);
            return function(n, r, a, s, o) {
                h.mat4.lookAt(n, r, a, e),
                h.mat4.multiply(n, i, n),
                h.mat4.multiply(n, n, o),
                h.mat4.invert(n, n),
                h.mat4.scale(n, n, h.vec3.set(t, s, s, s))
            }
        }(),
        updatePositionVR: function() {
            var t = h.vec3.create();
            return function(e, i, n, r, a, s) {
                var o = this._hotspotMT.getMatrix()
                  , l = e.get("lastComputedScenePosition")
                  , u = h.vec3.dist(l, n)
                  , c = u / i;
                h.vec3.transformMat4(t, l, s),
                c = Math.max(1.5 * c, .1 * a),
                c = Math.min(4 * c, c),
                this.lookToWorld(o, t, r, c, s);
                var d = this._worldTeleportPos ? h.vec2.dist(this._worldTeleportPos, r) : 1 / 0
                  , p = d < .5 * a;
                this._canTeleport = !p,
                this._hotspotMT.dirtyBound()
            }
        }(),
        updatePosition: function() {
            var t = h.vec3.create();
            return function(e, i, n, r) {
                var a = this._hotspotMT.getMatrix()
                  , s = e.get("lastComputedScenePosition")
                  , o = h.vec3.dist(s, r) / n;
                h.mat4.copy(a, i),
                h.mat4.scale(a, a, h.vec3.set(t, o, o, o)),
                h.mat4.setTranslation(a, s),
                this.isVisibleCard() && this.setVisibleCard(!1),
                this._hotspotMT.dirtyBound()
            }
        }()
    }),
    e.a = g
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(384)
      , a = i(70)
      , s = i(29)
      , o = i(440)
      , l = i(552)
      , u = n.a.osg;
    n.a.osgShadow.ShadowMap.prototype._preventTextureBindingDuringShadowCasting = function() {
        for (var t = i.i(o.a)(), e = u.StateAttribute.OVERRIDE | u.StateAttribute.ON, n = 0; n < t; n++)
            this._casterStateSet.setTextureAttributeAndModes(n, u.Texture.textureNull, e)
    }
    ;
    var h = function(t, e, h) {
        var c = new u.MatrixTransform;
        c.setName(t + " - LightNode " + e),
        c.getOrCreateStateSet().setAttributeAndModes(new u.Depth(u.Depth.DISABLE));
        var d = new r.a(e);
        h && d.setLightType(h),
        d.setName(t + " - Light " + e),
        u.vec3.copy(d.getAmbient(), u.vec3.ZERO),
        u.vec3.copy(d.getSpecular(), u.vec3.ZERO),
        d.setLinearAttenuation(0);
        var p = new u.LightSource;
        p.setName("skfb" + t + " - LightSource " + e),
        p.setLight(d);
        var f = new n.a.osgShadow.ShadowSettings;
        f.setLight(d),
        f.setShadowCastShaderGeneratorName("ShadowCastSkfb"),
        f.setCastsShadowDrawTraversalMask(a.a.SHADOW_CAST | a.a.SHADOW_BOUNDS),
        f.setCastsShadowBoundsTraversalMask(a.a.SHADOW_BOUNDS),
        f.userShadowCasterVisitor = !1,
        f.kernelSizePCF = i.i(s.a)().shadowPcf,
        f.fakePCF = !1;
        var g = new n.a.osgShadow.ShadowMap(f);
        if (g.setTextureUnitBase(12),
        g.setEnabled(!1),
        i.i(s.a)().stats) {
            var m = g.getCamera()
              , v = l.a.getTimerGPU();
            m.setInitialDrawCallback(function() {
                v.start("ShadowMap"),
                v.start("ShadowMap" + e)
            }),
            m.setFinalDrawCallback(function() {
                v.end("ShadowMap" + e),
                v.end("ShadowMap")
            })
        }
        return {
            node: c,
            light: d,
            lightSource: p,
            shadowSettings: f,
            shadowMap: g,
            enableShadow: i.i(o.a)() > 12
        }
    };
    e.a = {
        createLight: h
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(89)
      , a = i(138)
      , s = i(965)
      , o = i(594)
      , l = i.n(o)
      , u = i(593)
      , h = i.n(u)
      , c = n.a.osg
      , d = {}
      , p = function(t, e) {
        if (d[t])
            return d[t];
        var i = t.toLowerCase();
        return d[t] = a.a.createShader(l.a, h.a, i, e, t),
        d[t]
    }
      , f = function() {
        return p("LINE", "LightingLineGizmo")
    }
      , g = function() {
        return p("HEMI", "LightingHemiGizmo")
    }
      , m = function() {
        return p("ICON", "LightingIcon")
    }
      , v = new c.BlendFunc(c.BlendFunc.ONE,c.BlendFunc.ONE_MINUS_SRC_ALPHA)
      , _ = {}
      , b = function(t) {
        if (_[t])
            return _[t];
        var e = s.a[t];
        e || (e = s.a.DIRECTION);
        var i = r.default.instance
          , n = i.getOrCreateTexture(e);
        return _[t] = n.texture,
        n.texture
    }
      , x = {};
    x.createIconGeometry = function() {
        var t = c.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0)
          , e = t.getOrCreateStateSet();
        return e.setTextureAttributeAndModes(1, b("DIRECTION")),
        e.addUniform(c.Uniform.createInt(1, "uTextureIcon")),
        e.setAttributeAndModes(v),
        e.setAttributeAndModes(m()),
        t.setLightType = function(t) {
            e.setTextureAttributeAndModes(1, b(t))
        }
        ,
        t
    }
    ,
    x.createDirectionalGeometry = function(t) {
        for (var e = void 0 === t ? -1 : -t, i = e / 15, n = 2 * Math.PI, r = new Float32Array(180), a = 0; a < 5; ++a) {
            var s = 6 * a
              , o = n * a / 5;
            r[s] = r[s + 3] = Math.cos(o) * i,
            r[s + 1] = r[s + 4] = Math.sin(o) * i,
            r[s + 5] = e
        }
        var l = new c.DrawArrays(c.PrimitiveSet.LINES,0,30)
          , u = new c.Geometry;
        return u.getAttributes().Vertex = new c.BufferArray(c.BufferArray.ARRAY_BUFFER,r,3),
        u.getPrimitives().push(l),
        u.getOrCreateStateSet().setAttributeAndModes(f()),
        u.getOrCreateStateSet().setAttributeAndModes(v),
        u
    }
    ,
    x.createSpotGeometry = function(t) {
        var e = void 0 === t ? -1 : -t
          , i = 2 * Math.PI
          , n = new c.Geometry
          , r = new Float32Array(300)
          , a = n.getAttributes().Vertex = new c.BufferArray(c.BufferArray.ARRAY_BUFFER,r,3)
          , s = 0
          , o = new Uint16Array(50);
        for (s = 0; s < 50; ++s)
            o[s] = 2 * s + 1;
        var l = new c.DrawElements(c.PrimitiveSet.LINE_LOOP,new c.BufferArray(c.BufferArray.ELEMENT_ARRAY_BUFFER,o,1))
          , u = new Uint16Array(10);
        for (s = 0; s < 5; ++s)
            u[2 * s] = 20 * s,
            u[2 * s + 1] = 20 * s + 1;
        var h = new c.DrawElements(c.PrimitiveSet.LINES,new c.BufferArray(c.BufferArray.ELEMENT_ARRAY_BUFFER,u,1));
        return n.getPrimitives().push(h, l),
        n.getOrCreateStateSet().setAttributeAndModes(f()),
        n.getOrCreateStateSet().setAttributeAndModes(v),
        n.updateCone = function(t, o) {
            var l = o ? 2 * -o : e
              , u = Math.cos(t) * l
              , h = Math.sin(t) * l;
            for (s = 0; s < 50; ++s) {
                var c = 6 * s
                  , d = i * s / 50;
                r[c + 3] = Math.cos(d) * h,
                r[c + 4] = Math.sin(d) * h,
                r[c + 5] = u
            }
            a.dirty(),
            n.dirtyBound()
        }
        ,
        n.updateCone(.1),
        n
    }
    ,
    x.createHemiGeometry = function(t) {
        for (var e = void 0 === t ? -1 : -t, i = new c.Geometry, n = new Float32Array(450), r = Math.PI, a = 0; a < 50; ++a) {
            var s = 3 * a
              , o = r * a / 49
              , l = Math.cos(o)
              , u = Math.sin(o);
            n[s] = l * e,
            n[s + 2] = -u * e,
            n[150 + s + 1] = l * e,
            n[150 + s + 2] = -u * e,
            o = 2 * r * a / 49,
            n[300 + s] = Math.cos(o) * e,
            n[300 + s + 1] = Math.sin(o) * e
        }
        i.getAttributes().Vertex = new c.BufferArray(c.BufferArray.ARRAY_BUFFER,n,3);
        var h = new c.DrawArrays(c.PrimitiveSet.LINE_STRIP,0,50)
          , d = new c.DrawArrays(c.PrimitiveSet.LINE_STRIP,50,50)
          , p = new c.DrawArrays(c.PrimitiveSet.LINE_STRIP,100,50);
        i.getPrimitives().push(h, d, p);
        var f = i.getOrCreateStateSet();
        return f.setAttributeAndModes(g()),
        f.setAttributeAndModes(v),
        f.addUniform(c.Uniform.createFloat(-e, "uRadius")),
        i
    }
    ,
    x.createPointGeometry = function() {
        var t = 2 * Math.PI
          , e = new c.Geometry
          , i = new Float32Array(1350)
          , n = e.getAttributes().Vertex = new c.BufferArray(c.BufferArray.ARRAY_BUFFER,i,3)
          , r = new c.DrawArrays(c.PrimitiveSet.LINE_STRIP,0,50)
          , a = new c.DrawArrays(c.PrimitiveSet.LINE_STRIP,50,50)
          , s = new c.DrawArrays(c.PrimitiveSet.LINE_STRIP,100,50);
        return e.getPrimitives().push(r, a, s),
        e.getOrCreateStateSet().setAttributeAndModes(f()),
        e.getOrCreateStateSet().setAttributeAndModes(v),
        e.updateRadius = function(r) {
            for (var a = 0; a < 50; ++a) {
                var s = 3 * a
                  , o = t * a / 49;
                i[s] = i[150 + s] = i[300 + s + 1] = Math.cos(o) * r,
                i[s + 1] = i[150 + s + 2] = i[300 + s + 2] = Math.sin(o) * r
            }
            n.dirty(),
            e.dirtyBound()
        }
        ,
        e.updateRadius(1),
        e
    }
    ,
    e.a = x
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(328)
      , a = i(1008)
      , s = i(440)
      , o = i(87)
      , l = i(421)
      , u = i(43)
      , h = i(151)
      , c = n.a.osg
      , d = c.Texture.textureNull
      , p = new c.CullFace(c.CullFace.BACK)
      , f = new c.CullFace(c.CullFace.DISABLE)
      , g = new c.PointSizeAttribute
      , m = new c.PointSizeAttribute;
    m.setCircleShape(!0);
    var v = function(t) {
        this._stateSet = void 0,
        this._materialModel = t,
        this._material = new r.a,
        this._material.setMaterialModel(this._materialModel);
        var e = new c.Texture;
        e.setImage(new Uint8Array(12), c.Texture.RGB),
        e.setTextureSize(4, 1),
        e.setMinFilter(c.Texture.NEAREST),
        e.setMagFilter(c.Texture.NEAREST),
        this._colorAtlas = new a.a(e),
        this._colorAtlas.setIsColorAtlas(!0),
        this._textureMaterialCache = {},
        this._maxTextureUnit = i.i(s.a)()
    };
    v.cachedSquarePoint = g,
    v.cachedCirclePoint = m,
    v.prototype = {
        dirtyMaterial: function() {
            this._material && this._material.dirtyMaterial()
        },
        getStateSet: function() {
            return this._stateSet
        },
        setStateSet: function(t) {
            this._stateSet = t,
            t.getAttribute("SketchfabMaterial") || (this._material.setName(t.getName()),
            t.setAttributeAndModes(this._material));
            for (var e = 0, i = t.getNumTextureAttributeLists(); e < i; e++)
                t.removeTextureAttribute(e, "Texture")
        },
        enableAlphaBlending: function() {
            this._stateSet && this.setStateSetAlphaBlending()
        },
        disableTransparency: function() {
            this._stateSet && this.setStateSetOpaque()
        },
        setStateSetAlphaBlending: function() {
            this._stateSet && (this._stateSet.setRenderBinDetails(o.a.TRANSPARENT_BIN, "DepthSortedBin"),
            l.a.registerStateSetTransparency(this._stateSet))
        },
        setStateSetOpaque: function() {
            this._stateSet && (this._stateSet.setRenderBinDetails(o.a.OPAQUE_BIN, "RenderBin"),
            l.a.registerStateSetOpaque(this._stateSet))
        },
        setCullface: function(t) {
            this._stateSet && (this._stateSet.setAttributeAndModes(t ? p : f),
            this._material.dirtyMaterial())
        },
        setPointCircle: function(t) {
            this._stateSet && (this._stateSet.setAttributeAndModes(t ? m : g),
            this._material.dirtyMaterial())
        },
        isFreeSlot: function(t, e) {
            return void 0 === t || t === d || (!(!t.getChannelCount || 0 !== t.getChannelCount()) || !(!e || t !== this._colorAtlas))
        },
        isProtectedUnit: function(t) {
            return 6 === t || 8 === t
        },
        getAvailableTextureUnit: function(t, e) {
            var i = e === this._colorAtlas
              , n = e === d
              , r = this._stateSet
              , a = r.getNumTextureAttributeLists()
              , s = Math.min(this.isProtectedUnit(a) ? a + 2 : a + 1, this._maxTextureUnit)
              , o = -1
              , l = 0;
            for (l = 0; l < s; ++l)
                if (!this.isProtectedUnit(l)) {
                    var u = r.getTextureAttribute(l, "Texture");
                    if (-1 === o && this.isFreeSlot(u, i) && (o = l,
                    i || n))
                        break;
                    if (!n && !i && u && u.packChannelIfPossible && u.packChannelIfPossible(t, e)) {
                        o = l;
                        break
                    }
                }
            return o
        },
        setTextureMaterialToStateSet: function(t, e) {
            var i = t.getName()
              , n = this._textureMaterialCache[i];
            n && n.removeChannel && n.removeChannel(i);
            var r = this.getAvailableTextureUnit(i, e);
            if (!(r < 0)) {
                var s = this._stateSet.getTextureAttribute(r, "Texture")
                  , o = s === this._colorAtlas
                  , l = e === this._colorAtlas;
                l ? s = this._colorAtlas : (!s || o && !l) && (s = new a.a),
                s.setName("Texture" + r),
                this._material.setChannelMapping(i, r),
                this._textureMaterialCache[i] = s,
                s && s.addChannel && e !== d && s.addChannel(i, e);
                var u = s.isProtectedTexture && s.isProtectedTexture() ? c.StateAttribute.PROTECTED : c.StateAttribute.ON;
                this._stateSet.setTextureAttributeAndModes(r, s, u)
            }
        },
        setTexture: function(t) {
            var e = t.getTexture()
              , i = e.getImage()
              , n = e.getTextureProxy();
            if (i && n) {
                this.setTextureMaterialToStateSet(t, n),
                n.isTextureNull() && n.setTextureSize(1, 1);
                var r = u.a.getLowResLoaded();
                if (r.isFulfilled())
                    return n.setImageMaxSupported();
                n.setImageSmallest().promise.then(function() {
                    r.then(n.setImageMaxSupported.bind(n))
                })
            }
        },
        setColor: function(t) {
            var e = t.getColor()
              , i = h.a.getColorPacking(t.getName());
            if (i < 0)
                return void this.setTextureMaterialToStateSet(t, d);
            i *= 3;
            var n = this._colorAtlas.getTexture()
              , r = n.getImage().getImage();
            r[i] = Math.round(255 * e[0]),
            r[i + 1] = Math.round(255 * e[1]),
            r[i + 2] = Math.round(255 * e[2]),
            n.dirty(),
            this.setTextureMaterialToStateSet(t, this._colorAtlas)
        },
        setChannelEnable: function(t, e) {
            return !1 === e ? this.setTextureMaterialToStateSet(t, d) : t.getTexture() ? this.setTexture(t) : this.setColor(t)
        },
        setChannelOpacity: function(t, e) {
            var i = t.getTransparency()
              , n = "additive" === i
              , r = "alphaBlend" === i
              , a = "alphaMask" === i
              , s = "dithering" === i;
            return this._material && this._material.updateOpacity(),
            !1 === e ? this.disableTransparency() : a || s ? this.disableTransparency() : r || n ? this.enableAlphaBlending() : void c.warn("Unknow alpha type : " + i)
        },
        updateChannel: function(t) {
            if (this._stateSet) {
                var e = t.isEffective();
                this.setChannelEnable(t, e),
                "Opacity" === t.getName() && this.setChannelOpacity(t, e),
                this._material.dirtyMaterial()
            }
        }
    },
    e.a = v
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(357)
      , s = r.a.osg
      , o = function() {
        a.a.apply(this, arguments)
    };
    o.prototype = s.objectInherit(a.a.prototype, {
        verifyOpacity: function(t) {
            var e = t.getChannels().Opacity.getFactor();
            e < .001 && (e = 1),
            t.setChannelFactor("Opacity", e)
        },
        setChannelsFromMetaData: function(t, e, r, a) {
            i.i(n.each)(a, function(i, n) {
                if (void 0 !== t[n]) {
                    var a = JSON.parse(t[n]);
                    e[r](i, a),
                    e.setChannelEnable(i, !0)
                }
            })
        },
        processMaterial: function(t, e, i) {
            var n = this.createMaterial(t, e)
              , r = {
                kd: "DiffuseColor",
                ka: "EmitColor",
                ks: "SpecularColor"
            }
              , a = {
                ns: "SpecularHardness",
                tr: "Opacity",
                d: "Opacity"
            };
            this.setChannelsFromMetaData(i, n, "setChannelColor", r),
            this.setChannelsFromMetaData(i, n, "setChannelFactor", a),
            this.verifyOpacity(n),
            e.removeAttribute("Material");
            var s, o, l = function(t) {
                for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                    var n = t.getTextureAttribute(i, "Texture");
                    void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                    e[i] = n)
                }
                return e
            }(e), u = function(t, e, i, r) {
                t.removeTextureAttribute(e, "Texture");
                var a = n.getChannels()[r];
                a.setTexture(this.createTextureModelFromTextureOSG(i)),
                a.resetTextureFormat(),
                a.setTexCoordUnit(0),
                a.setEnable(!0)
            }
            .bind(this);
            void 0 !== i.map_ka && (s = JSON.parse(i.map_ka),
            void 0 !== (o = l[s]) && u(e, s, o, "EmitColor")),
            void 0 !== i.map_kd && (s = JSON.parse(i.map_kd),
            void 0 !== (o = l[s]) && u(e, s, o, "DiffuseColor")),
            void 0 !== i.map_occlusion && (s = JSON.parse(i.map_occlusion),
            void 0 !== (o = l[s]) && u(e, s, o, "DiffuseIntensity")),
            void 0 !== i.map_d && (s = JSON.parse(i.map_d),
            void 0 !== (o = l[s]) && (u(e, s, o, "Opacity"),
            n.getChannels().Opacity.setTransparency("alphaBlend"))),
            void 0 !== i.map_ks && (s = JSON.parse(i.map_ks),
            void 0 !== (o = l[s]) && u(e, s, o, "SpecularColor")),
            void 0 !== i.map_ns && (s = JSON.parse(i.map_ns),
            void 0 !== (o = l[s]) && u(e, s, o, "SpecularHardness")),
            void 0 !== i.map_normal && (s = JSON.parse(i.map_normal),
            void 0 !== (o = l[s]) && u(e, s, o, "NormalMap")),
            void 0 !== i.bump && (s = JSON.parse(i.bump),
            void 0 !== (o = l[s]) && u(e, s, o, "BumpMap")),
            n.setStateSet(e)
        }
    }),
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(687)
      , a = i(87)
      , s = n.a.osg
      , o = function() {
        s.StateSet.call(this),
        this._colorUniform = s.Uniform.createFloat4(s.vec4.fromValues(1, 0, 0, 0), "uColor"),
        this._callbackColor = new r.a(this._colorUniform,1),
        this.init()
    };
    o.prototype = s.objectInherit(s.StateSet.prototype, {
        setRenderBinVR: function(t) {
            this.setRenderBinDetails(t ? a.a.TRANSPARENT_BIN_NO_EARLYZ_POST : a.a.WIREFRAME, "RenderBin")
        },
        init: function() {
            this.setRenderBinDetails(a.a.WIREFRAME, "RenderBin"),
            this.setAttributeAndModes(new s.Depth(s.Depth.LEQUAL)),
            this.setAttributeAndModes(new s.BlendFunc(s.BlendFunc.ONE,s.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            this.setShaderGeneratorName("wireframe"),
            this.addUniform(this._colorUniform),
            this.addUpdateCallback(this._callbackColor)
        },
        setWireframeColorSmooth: function(t) {
            this._callbackColor.setColorTarget(t)
        },
        setWireframeColor: function(t) {
            this._colorUniform.setFloat4(t)
        },
        setWireframeEnable: function(t, e) {
            t ? (!0 === this._callbackColor._finished && (this._colorUniform.setFloat3(e),
            this._colorUniform.getInternalArray()[3] = 0),
            this._callbackColor.show(e[3])) : this._callbackColor.hide()
        }
    }),
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(470)
      , a = i(51)
      , s = n.a.osg
      , o = function(t, e) {
        this._colorUniform = t,
        this._colorDelta = s.vec4.create(),
        this._lastRatio = 0,
        r.a.call(this, e),
        this._finished = !0,
        this._disableAfterFinished = !1,
        this._finishCallback = void 0,
        this._lastFrame = 0
    };
    o.prototype = s.objectInherit(r.a.prototype, {
        hide: function() {
            s.vec3.init(this._colorDelta, 0, 0, 0)[3] = -this._colorUniform.getInternalArray()[3],
            this._disableAfterFinished = !0,
            this._lastRatio = 0,
            this.reset()
        },
        show: function(t) {
            s.vec3.set(this._colorDelta, 0, 0, 0)[3] = void 0 !== t ? t : 1 - this._colorUniform.getInternalArray()[3],
            this._disableAfterFinished = !1,
            this._lastRatio = 0,
            this.reset()
        },
        setColorTarget: function(t) {
            s.vec4.sub(this._colorDelta, t, this._colorUniform.getInternalArray()),
            this._disableAfterFinished = !1,
            this._lastRatio = 0,
            this.reset()
        },
        setFinishCallback: function(t) {
            this._finishCallback = t
        },
        finished: function() {
            !0 === this._disableAfterFinished && this._finishCallback && this._finishCallback()
        },
        update: function(t, e) {
            if (!0 === this._finished)
                return !0;
            a.a.draw();
            var i = e.getFrameStamp()
              , n = i.getFrameNumber();
            if (this._lastFrame === n)
                return !0;
            this._lastFrame = n;
            var r = i.getSimulationTime()
              , o = this.interpolate(r, t, e);
            o = s.smoothStep(0, 1, o);
            var l = o - this._lastRatio;
            this._lastRatio = o;
            var u = this._colorUniform.getInternalArray()
              , h = this._colorDelta;
            return u[0] += h[0] * l,
            u[1] += h[1] * l,
            u[2] += h[2] * l,
            u[3] += h[3] * l,
            !0
        }
    }),
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(291)
      , a = i(473)
      , s = n.a.osg
      , o = function() {
        r.a.apply(this, arguments),
        this._CompilerBlending = a.a,
        this._stackShader = [],
        this._indexShader = 0,
        this._onSameShader = !0,
        this._gl = null
    };
    o.prototype = s.objectInherit(r.a.prototype, {
        setGraphicContext: function(t) {
            this._gl = t
        },
        getNextIndexShader: function() {
            return this._indexShader === this._stackShader.length - 1 ? 0 : this._indexShader + 1
        },
        onSameShader: function() {
            this._onSameShader = !0
        },
        toNextShader: function() {
            this._indexShader = this.getNextIndexShader(),
            this._onSameShader = !1
        },
        getNextShader: function() {
            return this._stackShader[this.getNextIndexShader()]
        },
        getCurrentShader: function() {
            return this._stackShader[this._indexShader]
        },
        addShader: function(t) {
            this._stackShader.push(t)
        },
        compileAllShaders: function(t, e, i, n) {
            for (var r = this._stackShader, a = r.length, o = this._gl, l = {
                getGraphicContext: function() {
                    return o
                },
                applyProgram: function() {}
            }, u = this.getShaderProcessor(), h = 0, c = 2 * a; h < c; ++h) {
                var d = r[h % a]
                  , p = h < a ? d : r[(h + 1) % a]
                  , f = t + d + p;
                if (!0 !== this._cache.has(f)) {
                    var g = new this._CompilerBlending(i,n,u);
                    g.setOutputs(d, p);
                    var m = g.createFragmentShader()
                      , v = g.createVertexShader()
                      , _ = new s.Program(new s.Shader(s.Shader.VERTEX_SHADER,v),new s.Shader(s.Shader.FRAGMENT_SHADER,m));
                    _.hash = f,
                    _.setActiveUniforms(this.getActiveUniforms(e, i, n)),
                    _.generated = !0,
                    _.apply(l),
                    this._cache.set(f, _)
                }
            }
        },
        getOrCreateProgram: function(t) {
            var e = this.getNextShader()
              , i = !0 === this._onSameShader ? e : this.getCurrentShader()
              , n = ""
              , r = []
              , a = [];
            n += this.getActiveAttributeList(t, r),
            n += this.getActiveTextureAttributeList(t, a);
            var s = n + i + e
              , o = this._cache.get(s);
            return void 0 !== o ? o : (this.compileAllShaders(n, t, r, a),
            this._cache.get(s))
        }
    }),
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(291)
      , r = i(1036)
      , a = function() {
        n.a.apply(this, arguments),
        this.setShaderCompiler(r.a)
    };
    a.prototype = n.a.prototype,
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = 3.14159265359
      , r = {}
      , a = function(t, e, i, a, s, o) {
        a = a || .25,
        s = s || 720;
        var l = Math.cos(.01745329251 * a)
          , u = 0
          , h = r.table;
        if (void 0 === h)
            for (h = r.table = new Float32Array(1801779),
            u = 0; u < 1801779; ++u)
                h[u] = 1 / 0;
        var c = n / (s - 1)
          , d = 1.57079632679 / (s - 1)
          , p = o ? 3 : 2
          , f = t.length / p;
        for (u = 0; u < f; ++u) {
            var g = u * i
              , m = u * p
              , v = t[m]
              , _ = t[m + 1];
            4 !== i || o || (e[g + 3] = 1024 & v ? -1 : 1,
            v &= -1025);
            var b, x, y, S = 3 * (v + s * _), w = S >= 1801779;
            if (w || h[S] === 1 / 0) {
                var C = v * c
                  , M = Math.cos(C)
                  , T = Math.sin(C);
                C += d;
                var A = (l - M * Math.cos(C)) / Math.max(1e-5, T * Math.sin(C));
                A > 1 ? A = 1 : A < -1 && (A = -1);
                var E = 6.28318530718 * _ / Math.ceil(n / Math.max(1e-5, Math.acos(A)));
                b = T * Math.cos(E),
                x = T * Math.sin(E),
                y = M,
                w || (h[S] = b,
                h[S + 1] = x,
                h[S + 2] = y)
            } else
                b = h[S],
                x = h[S + 1],
                y = h[S + 2];
            if (o) {
                var P = 47938362584151635e-21 * t[m + 2]
                  , N = Math.sin(P);
                e[g] = N * b,
                e[g + 1] = N * x,
                e[g + 2] = N * y,
                e[g + 3] = Math.cos(P)
            } else
                e[g] = b,
                e[g + 1] = x,
                e[g + 2] = y
        }
        return e
    };
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e, i, n, r) {
        for (var a = t.length / r, s = 0; s < a; ++s)
            for (var o = s * r, l = 0; l < r; ++l)
                e[o + l] = i[l] + t[o + l] * n[l];
        return e
    };
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = function(t, e, i) {
        for (var n = new r[i](e), a = 0, s = 0; a !== e; ) {
            var o = 0
              , l = 0;
            do {
                o |= (127 & t[s]) << l,
                l += 7
            } while (0 != (128 & t[s++]));n[a++] = o
        }
        if ("U" !== i[0])
            for (var u = 0; u < e; ++u) {
                var h = n[u];
                n[u] = h >> 1 ^ -(1 & h)
            }
        return n
    };
    e.a = a
}
, , function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = [0, 0]
      , s = function(t, e) {
        if (e = e || a,
        t.center || t.touches) {
            var i = t.center ? t.center.x : t.touches[0].clientX
              , n = t.center ? t.center.y : t.touches[0].clientY;
            e[0] = i - r()(t.target).offset().left + (window.scrollX || 0),
            e[1] = n - r()(t.target).offset().top + (window.scrollY || 0)
        } else
            e[0] = void 0 === t.offsetX ? t.layerX : t.offsetX,
            e[1] = void 0 === t.offsetY ? t.layerY : t.offsetY;
        return e
    };
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n, r, a = i(4), s = i(29), o = i(51), l = i(43), u = a.a.osg, h = document.createElement("canvas"), c = document.createElement("canvas"), d = !1;
    l.a.getHasAnimation().then(function(t) {
        t && (d = t)
    });
    var p = function(t, e, i) {
        var n = t.getGraphicContext()
          , a = h
          , s = a.getContext("2d")
          , o = e.width
          , l = e.height
          , u = 4 * o
          , c = u * l;
        a.width === o && a.height === l || (a.width = o,
        a.height = l,
        r = new Uint8Array(c));
        for (var d = r; n.checkFramebufferStatus(n.FRAMEBUFFER, i) !== n.FRAMEBUFFER_COMPLETE; )
            ;
        n.flush(),
        n.finish(),
        n.readPixels(0, 0, o, l, n.RGBA, n.UNSIGNED_BYTE, d);
        var p = s.getImageData(0, 0, o, l);
        return p.data.set(d),
        s.putImageData(p, 0, 0),
        a
    }
      , f = function(t, e, r, a) {
        var o = e.width
          , l = e.height
          , u = r;
        u || (u = o);
        var h = 1 / (o / l);
        a && (h = a);
        var d = [u, Math.floor(u * h)]
          , f = p(t, e)
          , g = c;
        g.width === d[0] && g.height === d[1] || (g.width = d[0],
        g.height = d[1]);
        var m = 1 / (o / l)
          , v = h
          , _ = g.getContext("2d")
          , b = 0
          , x = 0
          , y = o
          , S = l;
        if (m < v) {
            var w = S / v;
            b = (y - w) / 2,
            y = w
        } else if (m > v) {
            var C = y * v;
            x = (S - C) / 2,
            S = C
        }
        return _.clearRect(0, 0, d[0], d[1]),
        _.fillStyle = "transparent",
        _.fillRect(0, 0, d[0], d[1]),
        _.save(),
        _.scale(1, -1),
        _.drawImage(f, b, x, y, S, 0, -d[1], d[0], d[1]),
        _.restore(),
        i.i(s.a)().downloadPicture && (n || (n = document.createElement("a"),
        document.body.appendChild(n),
        n.style.display = "none"),
        n.href = g.toDataURL("image/jpeg"),
        n.download = "image.jpg",
        n.click()),
        g
    }
      , g = !1
      , m = function(t, e, i) {
        g && u.warn("Screenshot already processing"),
        g = !0;
        var n, r = i.getCanvas(), a = i.getSuperSample(), s = i.getViewerOSGJS(), l = i.getFeatures();
        for (var h in l)
            n |= l[h].prepareForScreenShot();
        var c, d = i.getFeaturesManager().getNodeGizmo();
        d && d.getNodeMask() && (c = d.getNodeMask(),
        d.setNodeMask(0),
        n = !0);
        var p, m = a && a.canBeEnabled() ? a.getSampleCount() : 1;
        if (s.getCamera().setFinalDrawCallback(function(i) {
            if (m--,
            (!a || !a.isEnabled()) && (p = f(i, r, t, e),
            s.getCamera().setFinalDrawCallback(void 0),
            o.a.setPoseForScreenshot(!1),
            g = !1,
            n)) {
                for (var u in l)
                    l[u].resetAfterScreenShot();
                c && d.setNodeMask(c),
                o.a.draw()
            }
        }),
        o.a.setPoseForScreenshot(!0),
        m > 1 && a.forceEnable(),
        s.getCamera()) {
            var v = s.getCamera().getRenderer()
              , _ = s.getScene()
              , b = s.getUpdateVisitor();
            if (_.updateSceneGraph(b),
            v.cull(),
            v.draw(),
            m > 0)
                for (; a.isEnabled(); )
                    a.updateFrame(),
                    _.updateSceneGraph(b),
                    v.cull(),
                    v.draw()
        }
        return p
    };
    e.a = m
}
, , , , , , , , , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(38))
      , a = i(671)
      , s = i(16);
    e.a = a.a.extend({
        el: ['<div class="widget slider-widget volume-slider-widget">', '          <div class="widget-wrapper">', '              <a class="fa fa-volume-up"></a>', '              <div class="bar">', '                  <div class="slide">', '                      <div class="cursor"></div>', "                  </div>", "              </div>", "          </div>", "      </div>"].join(""),
        events: i.i(n.extend)({}, a.a.prototype.events, {
            "click .fa": "onoff",
            "touchstart .fa": "onoff"
        }),
        constructor: function(t, e) {
            e = i.i(n.defaults)(e || {}, {
                name: "volume",
                minimum: 0,
                maximum: 1,
                step: .1
            }),
            a.a.prototype.constructor.call(this, t, e)
        },
        initialize: function() {
            a.a.prototype.initialize.apply(this, arguments),
            this.isMute = 0 === this.get(),
            this.value = this.get(),
            this.model.on("change:" + this.options.name, i.i(r.a)(function() {
                0 === this.get() ? (this.isMute = !0,
                this.mute(this.$(".fa"))) : this.isMute && (this.isMute = !1,
                this.unmute(this.$(".fa")))
            }
            .bind(this)))
        },
        mute: function(t) {
            t.removeClass("fa-volume-up").addClass("fa-volume-off")
        },
        unmute: function(t) {
            t.removeClass("fa-volume-off").addClass("fa-volume-up")
        },
        onoff: function() {
            this.isMute ? (0 !== this.value && null !== this.value || (this.value = 1),
            this.set(this.value),
            this.model.set("playing", !0),
            s.a.modelViewerMuteButtonClicked(0)) : (this.value = this.get(),
            this.set(0),
            s.a.modelViewerMuteButtonClicked(1))
        },
        cursorDrag: function() {
            a.a.prototype.cursorDrag.apply(this, arguments),
            this.value = null
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(15)
      , s = i(542);
    e.a = a.a.extend({
        save: function(t, e) {
            null != t && "object" != typeof t || (e = t);
            var i = new FormData;
            return i.append("imageFile", this.get("imageFile")),
            i.append("modelUid", e.modelUID),
            r.a.ajax({
                url: this.url(),
                data: i,
                processData: !1,
                contentType: !1,
                type: "POST"
            })
        },
        url: function() {
            return this.isNew() ? "/i/backgrounds" : "/i/backgrounds/" + this.get("uid")
        }
    }).extend(s.a)
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(15))
      , a = i(154);
    e.a = r.a.extend(i.i(n.extend)({}, a.a, {
        url: function() {
            return "/i/environments/" + this.get("uid")
        }
    }))
}
, function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(15);
    e.a = a.a.extend({
        save: function(t, e) {
            null != t && "object" != typeof t || (e = t);
            var i = new FormData;
            return i.append("imageFile", this.get("imageFile")),
            i.append("source", this.get("source")),
            i.append("modelUid", e.modelUID),
            r.a.ajax({
                url: this.url(),
                data: i,
                processData: !1,
                contentType: !1,
                type: "POST"
            })
        },
        url: function() {
            return "/i/thumbnails"
        }
    })
}
, function(t, e, i) {
    "use strict";
    e.a = ["4024128cf8904b69946e891caac5f305", "b83e3a8794ae47e0b4039e7fdb031602", "16cdcddf277d423d99094f8db0c731e9", "efd4ef0fc18a4ec0a1313d782fade965", "675ff0f13b474c62947097939fe9aa1e", "df5b82c5ccec42cbb9c5ba9528f0be52", "491ddabd93aa49ecb5ad36538f7d00e3", "02751cd893a14f3986fb17a90245f64f", "78a54c2fd53a4ba4891a4bbdac7f30f7", "956bb00775a044e7afdd1c17f6bdab63", "003c1543cd754a19a0e14bc89726ccf5", "268447ca0a954f44b06d1387863d114e", "80fba9759ab94307a782f38d359b8ea8", "e73867d210de4bc2b5eb261738cf3e79", "2e9c3708feb74137b0436f946b8b66b8", "591b2c2db5744df1803a09d477f5a2c7"]
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(1022)
      , a = {
        FeatureName: "saveUI",
        ModelName: "Material",
        ViewListType: [r.a]
    };
    e.a = n.a.create(a)
}
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(t, e, i) {
    "use strict";
    e.a = function(t) {
        return t = t.substring(t.lastIndexOf("/") + 1),
        t = t.split("."),
        t = t[t.length > 1 ? t.length - 2 : t.length - 1],
        t.split("_").pop().toLowerCase()
    }
}
, function(t, e, i) {
    "use strict";
    e.a = function(t, e) {
        var i, n, r = t.length, a = e.length, s = [];
        if (!r)
            return a;
        if (!a)
            return r;
        for (i = 0; i <= r; i++)
            s[i] = [i];
        for (n = 0; n <= a; n++)
            s[0][n] = n;
        for (n = 1; n <= a; n++)
            for (i = 1; i <= r; i++)
                t[i - 1] === e[n - 1] ? s[i][n] = s[i - 1][n - 1] : s[i][n] = Math.min(s[i - 1][n], s[i][n - 1], s[i - 1][n - 1]) + 1;
        return s[r][a]
    }
}
, , , , , , function(t, e, i) {
    "use strict";
    var n = i(29)
      , r = window.navigator.userAgent
      , a = !i.i(n.a)().isApp && (/constructor/i.test(window.HTMLElement) || function(t) {
        return "[object SafariRemoteNotification]" === t.toString()
    }(!window.safari) || r.match(/iPad/i) || r.match(/iPhone/i));
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(172);
    e.a = n.a.extend({})
}
, function(t, e, i) {
    t.exports = i.p + "Direction-da0354ccc70bc3322aa657cdcd356e39.png"
}
, function(t, e, i) {
    t.exports = i.p + "Hemi-069d53239a191b55450d472c13408320.png"
}
, function(t, e, i) {
    t.exports = i.p + "Point-7493691bc0625a4c8a09393c65c39e5c.png"
}
, function(t, e, i) {
    t.exports = i.p + "Sound-c9d6e5b9ed6c02f1dfaea84e549485c1.png"
}
, function(t, e, i) {
    t.exports = i.p + "Spot-7484bdcd407b8b2416471e8e6cd23770.png"
}
, , , function(t, e, i) {
    t.exports = i.p + "Hotspot-091f212d5a1a99daeaa8089a72d1cb80.png"
}
, function(t, e, i) {
    t.exports = i.p + "MatCap-c1f2051ad7313bec915506e67d237a44.jpeg"
}
, , , , , , function(t, e) {
    t.exports = {
        devDependencies: {
            chai: "^3.5.0",
            "grunt-contrib-connect": "~0.9",
            "grunt-documentation": "*",
            "grunt-jsbeautifier": "^0.2.10",
            "grunt-mocha": "^1.0.2",
            "grunt-release": "^0.10.0",
            mocha: "^2.5.3",
            "webpack-strip-block": "0.0.1",
            "grunt-plato": "~0.2.1",
            "grunt-update-submodules": "^0.4.1"
        },
        peerDependencies: {
            grunt: ">=0.4.0"
        },
        dependencies: {
            "gl-matrix": "^2.3.2",
            "grunt-lib-phantomjs": "^1.0.2",
            "webpack-dev-server": "^1.7.0",
            webpack: "^1.7.3",
            "raw-loader": "^0.5.1",
            path: "^0.11.14",
            leapjs: "^0.6.4",
            "json-loader": "^0.5.4",
            jquery: "^2.1.3",
            hammerjs: "^2.0.4",
            "grunt-webpack": "^1.0.8",
            "grunt-shell": "*",
            "grunt-git": "*",
            "grunt-eslint": "*",
            "grunt-copy-to": "0.0.12",
            "grunt-contrib-uglify": "*",
            "grunt-contrib-jshint": "*",
            "grunt-contrib-copy": "*",
            "grunt-contrib-clean": "*",
            grunt: "> 1.0.0",
            glob: "*",
            extend: "*",
            "eslint-plugin-private-variables": "*",
            eslint: "*"
        },
        contributors: ["Paul Cheyrou-Lagrze <tuan.kuranes@gmail.com>", "Jordi Torres <jtorresfabra@gmail.com>", "Matt Fontaine <tehqin@gmail.com>", "Stephane Ginier <stephane.ginier@gmail.com>"],
        version: "0.2.7",
        author: "Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)",
        license: "MIT",
        description: "OpenSceneGraph implementation in javascript",
        repository: {
            url: "git@github.com:cedricpinson/osgjs.git",
            type: "git"
        },
        name: "OpenSceneGraph"
    }
}
, function(t, e) {
    t.exports = "/*jshint worker: true */\n\nself.onmessage = function ( event ) {\n    var data = event.data;\n\n    var opt = {\n        imageOrientation: 'flipY',\n        premultiplyAlpha: 'none',\n        colorSpaceConversion: 'none'\n    };\n\n    self.fetch( data.url ).then( function ( response ) {\n        response.blob().then( function ( blob ) {\n            self.createImageBitmap( blob, opt ).then( function ( bitmap ) {\n                postMessage( {\n                    bitmap: bitmap,\n                    url: data.url,\n                    uid: data.uid\n                }, [ bitmap ] );\n            } );\n        } );\n    } );\n};\n\n/*jshint worker: false */\n"
}
, function(t, e) {
    t.exports = "(function webpackUniversalModuleDefinition(root, factory) {\n  if(typeof exports === 'object' && typeof module === 'object')\n    module.exports = factory();\n  else if(typeof define === 'function' && define.amd)\n    define([], factory);\n  else {\n    var a = factory();\n    for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n  }\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/  // The module cache\n/******/  var installedModules = {};\n\n/******/  // The require function\n/******/  function __webpack_require__(moduleId) {\n\n/******/    // Check if module is in cache\n/******/    if(installedModules[moduleId])\n/******/      return installedModules[moduleId].exports;\n\n/******/    // Create a new module (and put it into the cache)\n/******/    var module = installedModules[moduleId] = {\n/******/      exports: {},\n/******/      id: moduleId,\n/******/      loaded: false\n/******/    };\n\n/******/    // Execute the module function\n/******/    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/    // Flag the module as loaded\n/******/    module.loaded = true;\n\n/******/    // Return the exports of the module\n/******/    return module.exports;\n/******/  }\n\n\n/******/  // expose the modules object (__webpack_modules__)\n/******/  __webpack_require__.m = modules;\n\n/******/  // expose the module cache\n/******/  __webpack_require__.c = installedModules;\n\n/******/  // __webpack_public_path__\n/******/  __webpack_require__.p = \"\";\n\n/******/  // Load entry module and return exports\n/******/  return __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var decompressor = __webpack_require__( 1 );\n\n  /*jshint worker: true */\n\n  self.onmessage = function ( event ) {\n      var input = event.data;\n      var result = decompressor.decompress( input.buffer );\n\n      var img = new Uint8Array( result.img.buffer );\n      var width = result.width;\n      var height = result.height;\n\n      if ( input.swizzle ) {\n          var nbComponents = input.nbComponents || 3;\n          var nbPixel = width * height * 4;\n          for ( var i = 0, j = 0; i < nbPixel; i += 4, j += nbComponents ) {\n              var r = img[ i ];\n              var a = img[ i + 3 ];\n\n              var x = ( r / 255.0 ) * 2.0 - 1.0;\n              var y = ( a / 255.0 ) * 2.0 - 1.0;\n              var z = Math.sqrt( 1.0 - x * x - y * y );\n              z = Math.round( ( z * 0.5 + 0.5 ) * 255.0 );\n\n              img[ j ] = r;\n              img[ j + 1 ] = a;\n              img[ j + 2 ] = z;\n          }\n\n          img = img.subarray( 0, width * height * nbComponents );\n      }\n\n      postMessage( {\n          img: img,\n          width: width,\n          height: height,\n          uid: input.uid || 'uid'\n      }, [ img.buffer ] );\n  };\n\n  /*jshint worker: false */\n\n  module.exports = {\n      astcDecompressor: decompressor\n  };\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var precompute = __webpack_require__(2);\n  var cacheUnquantizeSimple = precompute.cacheUnquantizeSimple;\n  var cacheUnquantizeTrits = precompute.cacheUnquantizeTrits;\n  var cacheUnquantizeQuints = precompute.cacheUnquantizeQuints;\n  var cacheDecodeSimple = precompute.cacheDecodeSimple;\n  var cacheDecodeTrits = precompute.cacheDecodeTrits;\n  var cacheDecodeQuints = precompute.cacheDecodeQuints;\n\n  var bitUtils = __webpack_require__(3);\n  var popCount = bitUtils.popCount;\n  var readBits = bitUtils.readBits;\n  var writeBits = bitUtils.writeBits;\n  var extractBits = bitUtils.extractBits;\n  var replicateBits = bitUtils.replicateBits;\n  var bitTransferSigned = bitUtils.bitTransferSigned;\n  var reverseU8Array = bitUtils.reverseU8Array;\n\n\n  // Counting how many bits have been read for each block\n  // the value is reseted when computing a new block\n  var bitsReadCount = 0;\n  // Counting how many bits have been written\n  // useful when extracting color endpoint data\n  var bitsWrittenCount = 0;\n  // Counting how many bits have been read in the\n  // current block color data stream\n  var colorDataBitsRead = 0;\n  // Keeping track of the current index\n  // when calling the computeEndpoints routine\n  var decodedColorValuesIdx = 0;\n\n  // Contains the information\n  // of the current processed block\n  var CURRENT_BLOCK_INFO = {};\n  // Describes how trit/quint/bit is packed\n  // for a single encoded integer in the maxWeightQuintsTritsMapper\n  var TRIT_IDX = 0;\n  var QUINT_IDX = 1;\n  var BIT_IDX = 2;\n\n  // Maximum number of encoded values = 288\n  var resultDecodedStorage = new Uint16Array(288 * 6);\n  var subDecodedValue = new Array(8);\n  var classSelectorBitsArray = new Uint8Array(4);\n  var colorModeLSB = new Uint8Array(4);\n  var texelWeightData = new Uint8Array(16);\n  var colorEndpointData = new Uint8Array(16);\n  var endpoints = new Uint8Array(4 * 2 * 4);\n  var blockPixelsOutput = null;\n\n  /**\n   * Encodes a given value into its quints/trits/bits representation\n   * @param  {uint} val the value to encode\n   * @return {Object} contains the number of trits/quints/bits to encode the given value.\n   */\n  var getEncodedInteger = function(val) {\n    var encodedInt = {\n      trits: 0,\n      quints: 0,\n      bits: 0,\n      tritValue: 0,\n      quintValue: 0,\n      bitValue: 0\n    };\n    while (val > 0) {\n      var check = val + 1;\n\n      if (!(check & (check - 1))) {\n        encodedInt.bits = popCount(val);\n        return encodedInt;\n      }\n      if ((check % 3 === 0) && !(Math.floor(check / 3) & Math.floor((check / 3) - 1))) {\n        encodedInt.bits = popCount(Math.floor(check / 3 - 1));\n        encodedInt.trits = 1;\n        return encodedInt;\n      }\n      if ((check % 5 === 0) && !(Math.floor(check / 5) & Math.floor((check / 5) - 1))) {\n        encodedInt.bits = popCount(Math.floor(check / 5 - 1));\n        encodedInt.quints = 1;\n        return encodedInt;\n      }\n\n      val--;\n    }\n    return encodedInt;\n  };\n\n  var replicateBits0816Map = new Uint16Array(256);\n  for (var i = 0; i < 256; ++i)\n    replicateBits0816Map[i] = replicateBits(i, 8, 16);\n\n  var maxWeightQuintsTritsMapper = new Uint16Array(256 * 3);\n  var idx = 0;\n  for (var i = 0; i < 256; i++) {\n    var encodedInt = getEncodedInteger(i);\n    maxWeightQuintsTritsMapper[idx + TRIT_IDX] = encodedInt.trits;\n    maxWeightQuintsTritsMapper[idx + QUINT_IDX] = encodedInt.quints;\n    maxWeightQuintsTritsMapper[idx + BIT_IDX] = encodedInt.bits;\n\n    idx += 3;\n  }\n\n  /**\n   * Gives additional precision to RGB colors near gray\n   * pixel is changed in-place in the endpoints array\n   * Refers to ASTC specifications (Section 3.8)\n   * @param  {int} a the alpha channel component\n   * @param  {int} r the red channel component\n   * @param  {int} g the green channel component\n   * @param  {int} b the blue channel component\n   */\n  var blueContract = function(a, r, g, b) {\n    var idx = endpoints.currIdx;\n    endpoints[idx] = a;\n    endpoints[idx + 1] = (r + b) >> 1;\n    endpoints[idx + 2] = (g + b) >> 1;\n    endpoints[idx + 3] = b;\n  };\n\n  /**\n   * Expands a given seed\n   * Refers to ASTC specifications (Section 3.15)\n   * @param  {uint32} p the seed to expand\n   * @return {uint32} the processed expanded seed\n   */\n  var hash52 = function(p) {\n    p ^= (p >>> 15) >>> 0;\n    p -= (p << 17) >>> 0;\n    p += (p << 7) >>> 0;\n    p += (p << 4) >>> 0;\n    p ^= (p >>> 5) >>> 0;\n    p += (p << 16) >>> 0;\n    p ^= (p >>> 7) >>> 0;\n    p ^= (p >>> 3) >>> 0;\n    p ^= (p << 6) >>> 0;\n    p ^= (p >>> 17) >>> 0;\n\n    return p;\n  };\n\n  /**\n   * Computes the partition index for a given texel\n   * @param  {uint32} seed partition pattern index\n   * @param  {int} x texel x position withing the block\n   * @param  {int} y texel y position withing the block\n   * @param  {int} z texel z position withing the block\n   * @param  {uint} partitionCount maximum number of existing partitions\n   * @param  {bool} smallBlock set to true, number of texel in the block is less than 31\n   * @return {uint} the partition index of the given texel\n   */\n\n  var seedsPartitionTable = new Uint8Array(12);\n\n  var precomputeSelectPartition = function(seed, partitionCount) {\n\n    // Refers to ASTC specifications (Section 3.15)\n    seed += (partitionCount - 1) * 1024;\n    var seedUint32 = seed >>> 0;\n\n    var rnum = hash52(seedUint32);\n\n    // The seeds values should be saved in an uint8 variable\n    seedsPartitionTable[0] = rnum & 0xF;\n    seedsPartitionTable[1] = (rnum >> 4) & 0xF;\n    seedsPartitionTable[2] = (rnum >> 8) & 0xF;\n    seedsPartitionTable[3] = (rnum >> 12) & 0xF;\n    seedsPartitionTable[4] = (rnum >> 16) & 0xF;\n    seedsPartitionTable[5] = (rnum >> 20) & 0xF;\n    seedsPartitionTable[6] = (rnum >> 24) & 0xF;\n    seedsPartitionTable[7] = (rnum >> 28) & 0xF;\n    seedsPartitionTable[8] = (rnum >> 18) & 0xF;\n    seedsPartitionTable[9] = (rnum >> 22) & 0xF;\n    seedsPartitionTable[10] = (rnum >> 26) & 0xF;\n    seedsPartitionTable[11] = ((rnum >> 30) | (rnum << 2)) & 0xF;\n\n    seedsPartitionTable[0] *= seedsPartitionTable[0];\n    seedsPartitionTable[1] *= seedsPartitionTable[1];\n    seedsPartitionTable[2] *= seedsPartitionTable[2];\n    seedsPartitionTable[3] *= seedsPartitionTable[3];\n    seedsPartitionTable[4] *= seedsPartitionTable[4];\n    seedsPartitionTable[5] *= seedsPartitionTable[5];\n    seedsPartitionTable[6] *= seedsPartitionTable[6];\n    seedsPartitionTable[7] *= seedsPartitionTable[7];\n    seedsPartitionTable[8] *= seedsPartitionTable[8];\n    seedsPartitionTable[9] *= seedsPartitionTable[9];\n    seedsPartitionTable[10] *= seedsPartitionTable[10];\n    seedsPartitionTable[11] *= seedsPartitionTable[11];\n\n    var sh1 = 0;\n    var sh2 = 0;\n    var sh3 = 0;\n    if (seed & 1) {\n      sh1 = (seed & 2) ? 4 : 5;\n      sh2 = (partitionCount === 3) ? 6 : 5;\n    } else {\n      sh1 = (partitionCount === 3) ? 6 : 5;\n      sh2 = (seed & 2) ? 4 : 5;\n    }\n    sh3 = (seed & 0x10) ? sh1 : sh2;\n\n    seedsPartitionTable[0] >>= sh1;\n    seedsPartitionTable[1] >>= sh2;\n    seedsPartitionTable[2] >>= sh1;\n    seedsPartitionTable[3] >>= sh2;\n    seedsPartitionTable[4] >>= sh1;\n    seedsPartitionTable[5] >>= sh2;\n    seedsPartitionTable[6] >>= sh1;\n    seedsPartitionTable[7] >>= sh2;\n    seedsPartitionTable[8] >>= sh3;\n    seedsPartitionTable[9] >>= sh3;\n    seedsPartitionTable[10] >>= sh3;\n    seedsPartitionTable[11] >>= sh3;\n\n    return rnum;\n  };\n\n  var selectPartition = function(rnum, x, y, z, partitionCount, smallBlock) {\n    if (partitionCount === 1)\n      return 0;\n\n    if (smallBlock) {\n      x <<= 1;\n      y <<= 1;\n      z <<= 1;\n    }\n\n    var a = seedsPartitionTable[0] * x + seedsPartitionTable[1] * y + seedsPartitionTable[10] * z + (rnum >> 14);\n    var b = seedsPartitionTable[2] * x + seedsPartitionTable[3] * y + seedsPartitionTable[11] * z + (rnum >> 10);\n    var c = seedsPartitionTable[4] * x + seedsPartitionTable[5] * y + seedsPartitionTable[8] * z + (rnum >> 6);\n    var d = seedsPartitionTable[6] * x + seedsPartitionTable[7] * y + seedsPartitionTable[9] * z + (rnum >> 2);\n\n    a &= 0x3F;\n    b &= 0x3F;\n    c &= 0x3F;\n    d &= 0x3F;\n\n    if (partitionCount < 4)\n      d = 0;\n    if (partitionCount < 3)\n      c = 0;\n\n    if (a >= b && a >= c && a >= d)\n      return 0;\n    else if (b >= c && b >= d)\n      return 1;\n    else if (c >= d)\n      return 2;\n\n    return 3;\n  };\n\n  /**\n   * Simple swap util procedure swapping to cells in a given array\n   * @param  {array} array contains the cells to swap\n   * @param  {uint} i the first index\n   * @param  {uint} j the second index\n   */\n  var swapCell = function(array, i, j) {\n    var a = array[i];\n    array[i] = array[j];\n    array[j] = a;\n  };\n\n  /**\n   * Computes the total number of bits required to encoded\n   * the same encoded integer a given amount of times.\n   * @param  {uint} nbValues the number of encoded values\n   * @param  {[type]} encodedInteger the encoded value\n   * @return {uint} the number of bits to encoded nbValues of encodedInteger\n   */\n  var getBitsNbrFromEncodedInt = function(nbValues, trits, quints, bits) {\n    var totalBits = bits * nbValues;\n\n    if (trits)\n      totalBits += Math.floor((nbValues * 8 + 4) / 5);\n    else if (quints)\n      totalBits += Math.floor((nbValues * 7 + 2) / 3);\n\n    return totalBits;\n  };\n\n  /**\n   * Computes the number of weight values\n   * available in a given block\n   * @param  {Object} blockInfo the block info containing block size, max weight, etc...\n   * @return {uint} the number of weight values encoded inside the block\n   */\n  var getNumberWeightValues = function(blockInfo) {\n    var nbValues = blockInfo.width * blockInfo.height;\n    if (blockInfo.dualPlane)\n      nbValues *= 2;\n\n    // max nbValues = 12*12*2\n    return nbValues;\n  };\n\n\n  /**\n   * Computes the total number of bits needed to\n   * encode all the weights using Integer Sequence Encoding\n   * @param  {Object} blockInfo the block info containing block size, max weight, etc...\n   * @return {uint} the number of required bits to encoded the weights.\n   */\n  var getPackedBitSize = function(blockInfo) {\n    var nbValues = getNumberWeightValues(blockInfo);\n\n    var idx = blockInfo.maxWeight * 3;\n    var trits = maxWeightQuintsTritsMapper[idx + TRIT_IDX];\n    var quints = maxWeightQuintsTritsMapper[idx + QUINT_IDX];\n    var bits = maxWeightQuintsTritsMapper[idx + BIT_IDX];\n\n    return getBitsNbrFromEncodedInt(nbValues, trits, quints, bits);\n  };\n\n  /**\n   * Reads n values from a given array\n   * @param  {array} decodedColorValues the array to read\n   * @param  {uint} n the number of array cells to read\n   * @return {array} sub-array containing the read data\n   */\n  var readNDecodedColor = function(decodedColorValues, n) {\n    for (var i = 0; i < n; ++i)\n      subDecodedValue[i] = decodedColorValues[decodedColorValuesIdx++];\n    return subDecodedValue;\n  };\n\n  /**\n   * Clamps a pixel to the [0...255] range\n   * @param  {uint} beginIdx the index of the pixel alpha channel\n   * in the endpoints global array\n   */\n  var clampPixel = function(beginIdx) {\n    for (var i = 0; i < 4; ++i)\n      endpoints[beginIdx + i] = Math.max(0, Math.min(255, endpoints[beginIdx + i]));\n  };\n\n  /**\n   * Fills the endpoints global array with the given channel colors\n   * @param  {int} a the alpha channel component\n   * @param  {int} r the red channel component\n   * @param  {int} g the green channel component\n   * @param  {int} b the blue channel component\n   */\n  var fillEndpointsWithPixel = function(a, r, g, b) {\n    var idx = endpoints.currIdx;\n    endpoints[idx] = a;\n    endpoints[idx + 1] = r;\n    endpoints[idx + 2] = g;\n    endpoints[idx + 3] = b;\n  };\n\n  /**\n   * Parses the first 16 bytes a buffer\n   * considering it as an ASTC file buffer.\n   * @param  {ArrayBuffer} imgBuffer buffer containing the ASTC raw data\n   * @return {Object} contains data about the compressed image\n   */\n  var parseHeader = function(imgBuffer) {\n    var header = {};\n\n    var u8buffer = new Uint8Array(imgBuffer);\n    var u32Buffer = new Uint32Array(imgBuffer);\n\n    header.magic = u32Buffer[0];\n\n    var littleEndian = u8buffer[0] === (header.magic & 0xFF);\n\n    var isFormatCorrect = false;\n    if (littleEndian && header.magic === 0x5CA1AB13)\n      isFormatCorrect = true;\n    else if (!littleEndian && header.magic === 0x13ABA15C)\n      isFormatCorrect = true;\n\n    if (!isFormatCorrect)\n      console.error('The ASTC header does not meet the requirements.');\n\n    header.blockDimX = u8buffer[4];\n    header.blockDimY = u8buffer[5];\n    header.blockDimZ = u8buffer[6];\n\n    if (header.blockDimX > 12 || header.blockDimY > 12)\n      console.error('Incorrect ASTC file: block can not be larger than 12x12 pixels.');\n    if (header.blockDimZ > 1)\n      console.error('3D ASTC file are not supported.');\n\n    // Image width\n    header.xSize = u8buffer[7] + (u8buffer[8] << 8) + (u8buffer[9] << 16);\n    // Image height\n    header.ySize = u8buffer[10] + (u8buffer[11] << 8) + (u8buffer[12] << 16);\n    // Image depth\n    header.zSize = u8buffer[13] + (u8buffer[14] << 8) + (u8buffer[15] << 16);\n\n    if (header.zSize > 1)\n      console.error('3D ASTC file are not supported.');\n\n    return header;\n  };\n\n  /**\n   * Computes the layout of 2D block\n   * @param  {uint} blockModeBits extracted 11 first bit of the block\n   * @return {int} contains the layout of the block [0...9]\n   */\n  var findBlockLayout = function(blockModeBits) {\n    var layout = -1;\n\n    // Layout is in [0-4]\n    if ((blockModeBits & 0x1) || blockModeBits & 0x2) {\n      // layout is in [2-4]\n      if (blockModeBits & 0x8) {\n        // layout is in [3-4]\n        if (blockModeBits & 0x4)\n          layout = (blockModeBits & 0x100) ? 4 : 3;\n        else\n          layout = 2;\n      }\n      // layout is in [0-1]\n      else\n        layout = blockModeBits & 0x4 ? 1 : 0;\n\n      return layout;\n    }\n\n    // Layout is in [7-9]\n    if (blockModeBits & 0x100) {\n      // Layout [7-8]\n      if (blockModeBits & 0x80) {\n        if ((blockModeBits & 0x40))\n          console.error('Invalid block layout found.');\n        layout = (blockModeBits & 0x20) ? 8 : 7;\n      } else\n        layout = 9;\n\n      return layout;\n    }\n\n    layout = (blockModeBits & 0x80) ? 6 : 5;\n    return layout;\n  };\n\n  /**\n   * Extracts data regarding how block data are organized\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the first byte id of the current block\n   * @return {Object} contains block related data (void extent, maximum weight, etc;..)\n   */\n  var getBlockInfo = function(u8buffer, blockId) {\n    var blockInfo = CURRENT_BLOCK_INFO;\n    blockInfo.isVoidExtent = false;\n    blockInfo.error = false;\n\n    // Get the 'block mode' represented by the last 11 bits\n    var blockModeBits = readBits(u8buffer, blockId, bitsReadCount, 11);\n    bitsReadCount += 11;\n\n    // Checks the 9 least significant bits\n    // allowing to know if the block is a void-extent block (uniform color)\n    if ((blockModeBits & 0x01FF) === 0x1FC) {\n      blockInfo.isVoidExtent = true;\n      return blockInfo;\n    }\n\n    // Checks the first reserved pattern\n    // (xxxxx0000)\n    if ((blockModeBits & 0xF) === 0) {\n      blockInfo.error = true;\n      console.log('Warning: Block layout is reserved (xxxxx0000)');\n    }\n\n    // Checks the second reserved pattern\n    // (111xxxx00)\n    if ((blockModeBits & 0x3) === 0 &&\n      (blockModeBits & 0x1C0) === 0x1C0) {\n      blockInfo.error = true;\n      console.log('Warning: Block layout is reserved (111xxxx00)');\n    }\n\n    var layout = findBlockLayout(blockModeBits);\n    if (layout < 0)\n      console.error('Invalid block layout found.');\n\n    // Retrieves the R least significant bit according\n    // to the current block layout\n    var R = !!(blockModeBits & 0x10);\n    if (layout < 5)\n      R |= (blockModeBits & 0x3) << 1;\n    else\n      R |= (blockModeBits & 0xC) >> 1;\n\n    if (R < 2 || R > 7)\n      console.error('Invalid block mode. The file is not encoded in ASTC or corrupted.');\n\n    var a = 0;\n    var b = 0;\n    // Computes weights grid dimension\n    // Refers to ASTC specifications(Table 11)\n    switch (layout) {\n      case 0:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = b + 4;\n        blockInfo.height = a + 2;\n        break;\n      case 1:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = b + 8;\n        blockInfo.height = a + 2;\n        break;\n      case 2:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = a + 2;\n        blockInfo.height = b + 8;\n        break;\n      case 3:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x1;\n        blockInfo.width = a + 2;\n        blockInfo.height = b + 6;\n        break;\n      case 4:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x1;\n        blockInfo.width = b + 2;\n        blockInfo.height = a + 2;\n        break;\n      case 5:\n        a = (blockModeBits >> 5) & 0x3;\n        blockInfo.width = 12;\n        blockInfo.height = a + 2;\n        break;\n      case 6:\n        a = (blockModeBits >> 5) & 0x3;\n        blockInfo.width = a + 2;\n        blockInfo.height = 12;\n        break;\n      case 7:\n        blockInfo.width = 6;\n        blockInfo.height = 10;\n        break;\n      case 8:\n        blockInfo.width = 10;\n        blockInfo.height = 6;\n        break;\n      case 9:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 9) & 0x3;\n        blockInfo.width = a + 6;\n        blockInfo.height = b + 6;\n        break;\n      default:\n        console.error('The block layout is not recognized. Layout should be [0-9].');\n    }\n\n    // The dual plane mode bit is the most significant bit\n    blockInfo.dualPlane = (layout !== 9) && (blockModeBits & 0x400);\n    // The high precision mode bit is the second most significant bit\n    blockInfo.highPrecisionRange = (layout !== 9) && (blockModeBits & 0x200);\n\n    // Selects the appropriate weight range\n    if (blockInfo.highPrecisionRange) {\n      var highWeightRanges = [9, 11, 15, 19, 23, 31];\n      blockInfo.maxWeight = highWeightRanges[R - 2];\n    } else {\n      var weightRanges = [1, 2, 3, 4, 5, 7];\n      blockInfo.maxWeight = weightRanges[R - 2];\n    }\n\n    return blockInfo;\n  };\n\n  /**\n   * Decodes a trit in colorData raw data\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} nbBitsPerValue number of bits\n   * on which the integer is encoded\n   * @param  {array} resultStorage contains decoded integer,\n   * the decoded trit will be pushed back at the end of this procedure\n   */\n\n  var lsbDecodingValues = new Uint8Array(5);\n  var msbDecodingValues = new Uint8Array(5);\n\n  var decodeTrit = function(colorData, nbBitsPerValue) {\n    var m = lsbDecodingValues;\n    var t = msbDecodingValues;\n    var T = 0;\n\n    // Refers to ASTC specifications (Table 17)\n    m[0] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T = readBits(colorData, 0, colorDataBitsRead, 2);\n    colorDataBitsRead += 2;\n\n    m[1] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 2) << 2;\n    colorDataBitsRead += 2;\n\n    m[2] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 1) << 4;\n    colorDataBitsRead += 1;\n\n    m[3] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 2) << 5;\n    colorDataBitsRead += 2;\n\n    m[4] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 1) << 7;\n    colorDataBitsRead += 1;\n\n    var C = 0 >>> 0;\n    if (extractBits(T, 2, 4) === 7) {\n      C = (extractBits(T, 5, 7) << 2) | extractBits(T, 0, 1);\n      t[3] = 2;\n      t[4] = 2;\n    } else {\n      C = extractBits(T, 0, 4);\n      if (extractBits(T, 5, 6) === 3) {\n        t[4] = 2;\n        t[3] = extractBits(T, 7, 7);\n      } else {\n        t[4] = extractBits(T, 7, 7);\n        t[3] = extractBits(T, 5, 6);\n      }\n    }\n\n    if (extractBits(C, 0, 1) === 3) {\n      t[2] = 2;\n      t[1] = extractBits(C, 4, 4);\n      t[0] = (extractBits(C, 3, 3) << 1) | (extractBits(C, 2, 2) & ~extractBits(C, 3, 3));\n    } else if (extractBits(C, 2, 3) === 3) {\n      t[2] = 2;\n      t[1] = 2;\n      t[0] = extractBits(C, 0, 1);\n    } else {\n      t[2] = extractBits(C, 4, 4);\n      t[1] = extractBits(C, 2, 3);\n      t[0] = (extractBits(C, 1, 1) << 1) | (extractBits(C, 0, 0) & ~extractBits(C, 1, 1));\n    }\n\n    for (var i = 0; i < 5; ++i) {\n      var idx = resultDecodedStorage.currIndex;\n      resultDecodedStorage[idx] = 1;\n      resultDecodedStorage[idx + 1] = 0;\n      resultDecodedStorage[idx + 2] = nbBitsPerValue;\n      resultDecodedStorage[idx + 3] = t[i];\n      resultDecodedStorage[idx + 4] = 0;\n      resultDecodedStorage[idx + 5] = m[i];\n\n      resultDecodedStorage.currIndex += 6;\n    }\n  };\n\n  /**\n   * Decodes a quint in colorData raw data\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} nbBitsPerValue number of bits\n   * on which the integer is encoded\n   * @param  {array} resultStorage contains decoded integer,\n   * the decoded quint will be pushed back at the end of this procedure\n   */\n  var decodeQuint = function(colorData, nbBitsPerValue) {\n    var m = lsbDecodingValues;\n    var q = msbDecodingValues;\n    var Q = 0;\n\n    // Refers to ASTC specifications (Table 18)\n    m[0] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q = readBits(colorData, 0, colorDataBitsRead, 3);\n    colorDataBitsRead += 3;\n\n    m[1] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q |= readBits(colorData, 0, colorDataBitsRead, 2) << 3;\n    colorDataBitsRead += 2;\n\n    m[2] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q |= readBits(colorData, 0, colorDataBitsRead, 2) << 5;\n    colorDataBitsRead += 2;\n\n    if (extractBits(Q, 1, 2) === 3 && extractBits(Q, 5, 6) === 0) {\n      q[0] = 4;\n      q[1] = 4;\n      q[2] = (extractBits(Q, 0, 0) << 2) | ((extractBits(Q, 4, 4) & ~extractBits(Q, 0, 0)) << 1) | (extractBits(Q, 3, 3) & ~extractBits(Q, 0, 0));\n    } else {\n      var C = 0 >>> 0;\n      if (extractBits(Q, 1, 2) === 3) {\n        q[2] = 4;\n        C = (extractBits(Q, 3, 4) << 3) | ((~extractBits(Q, 5, 6) & 3) << 1) | (extractBits(Q, 0, 0));\n      } else {\n        q[2] = extractBits(Q, 5, 6);\n        C = extractBits(Q, 0, 4);\n      }\n\n      if (extractBits(C, 0, 2) === 5) {\n        q[1] = 4;\n        q[0] = extractBits(C, 3, 4);\n      } else {\n        q[1] = extractBits(C, 3, 4);\n        q[0] = extractBits(C, 0, 2);\n      }\n    }\n\n    for (var i = 0; i < 3; ++i) {\n      var idx = resultDecodedStorage.currIndex;\n      resultDecodedStorage[idx] = 0;\n      resultDecodedStorage[idx + 1] = 1;\n      resultDecodedStorage[idx + 2] = nbBitsPerValue;\n      resultDecodedStorage[idx + 3] = 0;\n      resultDecodedStorage[idx + 4] = q[i];\n      resultDecodedStorage[idx + 5] = m[i];\n\n      resultDecodedStorage.currIndex += 6;\n    }\n  };\n\n  /**\n   * Decodes nbValues of colorData raw data\n   * according to its max range value\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} range max value of the Integere Sequence\n   * @param  {uint} nbValues contains the number of values to decode\n   * @return {array} contains decoded integer\n   */\n  var decodeIntegerSequence = function(colorData, range, nbValues) {\n    var baseIdx = range * 3;\n    var trits = maxWeightQuintsTritsMapper[baseIdx + TRIT_IDX];\n    var quints = maxWeightQuintsTritsMapper[baseIdx + QUINT_IDX];\n    var bits = maxWeightQuintsTritsMapper[baseIdx + BIT_IDX];\n\n    resultDecodedStorage.currIndex = 0;\n\n    var nbDecodedValues = 0;\n    while (nbDecodedValues < nbValues) {\n\n      if (quints === 0 && trits === 0) {\n        var idx = resultDecodedStorage.currIndex;\n        resultDecodedStorage[idx] = trits;\n        resultDecodedStorage[idx + 1] = quints;\n        resultDecodedStorage[idx + 2] = bits;\n        resultDecodedStorage[idx + 3] = 0;\n        resultDecodedStorage[idx + 4] = 0;\n        resultDecodedStorage[idx + 5] = readBits(colorData, 0, colorDataBitsRead, bits);\n        colorDataBitsRead += bits;\n\n        resultDecodedStorage.currIndex += 6;\n\n        nbDecodedValues++;\n      } else if (quints === 1 && trits === 0) {\n        decodeQuint(colorData, bits);\n        nbDecodedValues += 3;\n      } else {\n        decodeTrit(colorData, bits);\n        nbDecodedValues += 5;\n      }\n    }\n  };\n\n  /**\n   * Decodes color from the colorData encoded Integer Sequence\n   * @param  {Uint8Array} colorData encoded color raw data\n   * @param  {array} colorModes contains the color for each partition\n   * @param  {uint} nbPartitions Number of available partitions\n   * @param  {uint} colorDataBits remaining bits number on which color data are encoded\n   * @return {array} decoded endpoints value in the [0...255] range\n   */\n\n  var endpointValuesOutput = new Uint8Array(32);\n\n  var decodeColorValues = function(colorData, colorModes, nbPartitions, colorDataBits) {\n    var trits = 0;\n    var quints = 0;\n    var bits = 0;\n    var i = 0;\n    // Computes the number of endpoint by using the associated class\n    // max endpoint values = 32\n    var nbEndpointValues = 0;\n    for (i = 0; i < nbPartitions; ++i)\n      nbEndpointValues += ((colorModes[i] >> 2) + 1) << 1;\n\n    // Finds the max range for each color endpoints\n    var range = 256;\n    while (--range > 0) {\n\n      var idx = range * 3;\n      trits = maxWeightQuintsTritsMapper[idx + TRIT_IDX];\n      quints = maxWeightQuintsTritsMapper[idx + QUINT_IDX];\n      bits = maxWeightQuintsTritsMapper[idx + BIT_IDX];\n\n      var bitsNbr = getBitsNbrFromEncodedInt(nbEndpointValues, trits, quints, bits);\n      if (bitsNbr <= colorDataBits) {\n        // Some integers share the same encoding\n        // this piece of code finds the smallest one\n        while (--range > 0) {\n          var newIdx = range * 3;\n          var newTrits = maxWeightQuintsTritsMapper[newIdx + TRIT_IDX];\n          var newQuints = maxWeightQuintsTritsMapper[newIdx + QUINT_IDX];\n          var newBits = maxWeightQuintsTritsMapper[newIdx + BIT_IDX];\n\n          if (newTrits !== trits || newQuints !== quints || newBits !== bits)\n            break;\n        }\n\n        range++;\n        break;\n      }\n    }\n\n    // Decodes the integer sequence based on the range and\n    // the number of values\n    var endpointIdx = 0;\n    decodeIntegerSequence(colorData, range, nbEndpointValues);\n\n    for (i = 0; i < nbEndpointValues * 6; i += 6) {\n      var bitLength = resultDecodedStorage[i + BIT_IDX];\n      var bitValue = resultDecodedStorage[i + BIT_IDX + 3];\n\n      // Refers to ASTC specifications(Section 3.11)\n      var result;\n      if (resultDecodedStorage[i + TRIT_IDX]) result = cacheDecodeTrits[bitLength + resultDecodedStorage[i + TRIT_IDX + 3] * 7 + bitValue * 21];\n      else if (resultDecodedStorage[i + QUINT_IDX]) result = cacheDecodeQuints[bitLength + resultDecodedStorage[i + QUINT_IDX + 3] * 6 + bitValue * 30];\n      else result = cacheDecodeSimple[bitLength + bitValue * 9];\n\n      endpointValuesOutput[endpointIdx++] = result;\n    }\n\n    // Makes sure each decoded value is not ambiguous\n    for (i = 0; i < nbEndpointValues; ++i)\n      if (endpointValuesOutput[i] > 255)\n        console.error('Decoded endpoint value can not be above 255.');\n  };\n\n  /**\n   * Computes the two color endpoint values\n   * from the decoded Integer Sequence data\n   * @param  {[type]} endpointColorValues [description]\n   * @param  {[type]} colorMode           [description]\n   */\n  var computeColorEndpointsLDR = function(endpointColorValues, colorMode) {\n    var v = 0;\n    var currIdx = 0;\n\n    switch (colorMode) {\n      case 0:\n        v = readNDecodedColor(endpointColorValues, 2);\n        fillEndpointsWithPixel(0xFF, v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, v[1], v[1], v[1]);\n        endpoints.currIdx += 4;\n        break;\n      case 1:\n        v = readNDecodedColor(endpointColorValues, 2);\n        var L0 = (v[0] >> 2) | (v[1] & 0xC0);\n        var L1 = Math.max(L0 + (v[1] & 0x3F), 0xFF);\n\n        fillEndpointsWithPixel(0xFF, L0, L0, L0);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, L1, L1, L1);\n        endpoints.currIdx += 4;\n        break;\n      case 4:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        fillEndpointsWithPixel(v[2], v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(v[3], v[1], v[1], v[1]);\n        endpoints.currIdx += 4;\n        break;\n      case 5:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n\n        currIdx = endpoints.currIdx;\n\n        fillEndpointsWithPixel(v[2], v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n\n        fillEndpointsWithPixel(v[2] + v[3], v[0] + v[1], v[0] + v[1], v[0] + v[1]);\n        endpoints.currIdx += 4;\n\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      case 6:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        fillEndpointsWithPixel(0xFF, v[0] * v[3] >> 8, v[1] * v[3] >> 8, v[2] * v[3] >> 8);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, v[0], v[1], v[2]);\n        endpoints.currIdx += 4;\n        break;\n      case 8:\n        v = readNDecodedColor(endpointColorValues, 6);\n        if (v[1] + v[3] + v[5] >= v[0] + v[2] + v[4]) {\n          fillEndpointsWithPixel(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n          fillEndpointsWithPixel(0xFF, v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(0xFF, v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n          blueContract(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        break;\n      case 9:\n        v = readNDecodedColor(endpointColorValues, 6);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n        bitTransferSigned(v, 5, 4);\n\n        currIdx = endpoints.currIdx;\n\n        if (v[1] + v[3] + v[5] >= 0) {\n          fillEndpointsWithPixel(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n\n          fillEndpointsWithPixel(0xFF, v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(0xFF, v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n\n          blueContract(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      case 10:\n        v = readNDecodedColor(endpointColorValues, 6);\n\n        fillEndpointsWithPixel(v[4], v[0] * v[3] >> 8, v[1] * v[3] >> 8, v[2] * v[3] >> 8);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(v[5], v[0], v[1], v[2]);\n        endpoints.currIdx += 4;\n        break;\n      case 12:\n        v = readNDecodedColor(endpointColorValues, 8);\n        if (v[1] + v[3] + v[5] >= v[0] + v[2] + v[4]) {\n          fillEndpointsWithPixel(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n          fillEndpointsWithPixel(v[7], v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(v[7], v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n          blueContract(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        break;\n      case 13:\n        v = readNDecodedColor(endpointColorValues, 8);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n        bitTransferSigned(v, 5, 4);\n        bitTransferSigned(v, 7, 6);\n\n        currIdx = endpoints.currIdx;\n\n        if (v[1] + v[3] + v[5] >= 0) {\n          fillEndpointsWithPixel(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n\n          fillEndpointsWithPixel(v[7] + v[6], v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(v[6] + v[7], v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n\n          blueContract(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      default:\n        console.error('Unsupported color endpoint mode. Only LDR modes are supported.');\n    }\n  };\n\n  /**\n   * Unquantizes a single texel returning it to a standard\n   * [0...64] range according to its trit/quint/bit encoding\n   * @param  {uint} val the decoded integer\n   * @return {uint} the unquantized weight in the range [0...64]\n   */\n  var unquantizeTexel = function(i) {\n    var bitLength = resultDecodedStorage[i + BIT_IDX];\n    var bitValue = resultDecodedStorage[i + BIT_IDX + 3];\n\n    // Refers to ASTC specifications (Section 3.11)\n    if (resultDecodedStorage[i + TRIT_IDX]) return cacheUnquantizeTrits[bitLength + resultDecodedStorage[i + TRIT_IDX + 3] * 4 + bitValue * 12];\n    if (resultDecodedStorage[i + QUINT_IDX]) return cacheUnquantizeQuints[bitLength + resultDecodedStorage[i + QUINT_IDX + 3] * 3 + bitValue * 15];\n    return cacheUnquantizeSimple[bitLength + bitValue * 8];\n  };\n\n  /**\n   * Returns weights in a standard range [0...64]\n   * @param  {array} weightValues contains the decoded\n   * Integer Sequence of the weight data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} multidimensional array containing the weights\n   * for both planes\n   */\n\n  var unquantizedOutput = new Uint8Array(2 * 144);\n  var infilledWeightsOutput = new Uint8Array(2 * 144);\n\n  var unquantizeWeights = function(blockInfo, blockWidth, blockHeight, nbWeightValues) {\n\n    var bw = blockInfo.width;\n    var bh = blockInfo.height;\n    var bwh = bw * bh;\n\n    var i = 0;\n    var end = 0;\n\n    if (blockInfo.dualPlane) {\n      end = Math.min(nbWeightValues * 2, bwh);\n      for (i = 0; i < end; ++i) {\n        unquantizedOutput[i] = unquantizeTexel(i * 12);\n        unquantizedOutput[i + 144] = unquantizeTexel(i * 12 + 6);\n      }\n\n    } else {\n      // Unquantizes the whole weight grid\n      end = Math.min(nbWeightValues, bwh);\n      for (i = 0; i < end; ++i) {\n        unquantizedOutput[i] = unquantizeTexel(i * 6);\n      }\n    }\n\n    // Applies the weight infill procedure\n    // Refers to ASTC specifications (Section 3.12)\n    // 3D blocks are not handled for the moment\n    var Ds = ((1024 + (blockWidth / 2)) / (blockWidth - 1)) >>> 0;\n    var Dt = ((1024 + (blockHeight / 2)) / (blockHeight - 1)) >>> 0;\n    var dPlane = (blockInfo.dualPlane) ? 2 : 1;\n\n    for (var planeId = 0; planeId < dPlane; ++planeId) {\n      var idp = planeId * 144;\n      for (var t = 0; t < blockHeight; ++t) {\n        for (var s = 0; s < blockWidth; ++s) {\n          var cs = Ds * s;\n          var ct = Dt * t;\n\n          var gs = (cs * (bw - 1) + 32) >> 6;\n          var gt = (ct * (bh - 1) + 32) >> 6;\n\n          var js = gs >> 4;\n          var fs = gs & 0xF;\n\n          var jt = gt >> 4;\n          var ft = gt & 0x0F;\n\n          var w11 = (fs * ft + 8) >> 4;\n          var w10 = (ft - w11) >>> 0;\n          var w01 = (fs - w11) >>> 0;\n          var w00 = (16 - fs - ft + w11) >>> 0;\n\n          var v0 = js + jt * bw;\n\n          var val = 8;\n          var vid = v0;\n          if (vid < bwh) val += w00 * unquantizedOutput[vid + idp];\n\n          vid = v0 + 1;\n          if (vid < bwh) val += w01 * unquantizedOutput[vid + idp];\n\n          vid = v0 + bw;\n          if (vid < bwh) val += w10 * unquantizedOutput[vid + idp];\n\n          vid = v0 + bw + 1;\n          if (vid < bwh) val += w11 * unquantizedOutput[vid + idp];\n\n          infilledWeightsOutput[t * blockWidth + s + idp] = val >> 4;\n        }\n      }\n    }\n  };\n\n  /**\n   * Decompresses a single void-extent block,\n   * in other words, a block containing only one color\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var decompressVoidExtent = function(u8buffer, blockId, blockInfo, blockWidth, blockHeight) {\n    // Do not read extra data\n    bitsReadCount += 53;\n\n    var r16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var g16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var b16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var a16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n\n    if (bitsReadCount !== 128)\n      console.error('Invalid void-extent bits reading.');\n\n    var nbPixel = blockWidth * blockHeight * 4;\n    for (var i = 0; i < nbPixel; i += 4) {\n      blockPixelsOutput[i] = extractBits(a16, 0, 7);\n      blockPixelsOutput[i + 1] = extractBits(r16, 0, 7);\n      blockPixelsOutput[i + 2] = extractBits(g16, 0, 7);\n      blockPixelsOutput[i + 3] = extractBits(b16, 0, 7);\n    }\n  };\n\n  /**\n   * Decompresses a single block by returning\n   * the error color (0xFF, 0xFF, 0x00, 0xFF)\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var getErrorPixelBlock = function(blockWidth, blockHeight) {\n    var nbPixel = blockWidth * blockHeight * 4;\n    for (var i = 0; i < nbPixel; i += 4) {\n      blockPixelsOutput[i] = 0xFF;\n      blockPixelsOutput[i + 1] = 0xFF;\n      blockPixelsOutput[i + 2] = 0x00;\n      blockPixelsOutput[i + 3] = 0xFF;\n    }\n  };\n\n  /**\n   * Decompresses a single block by retrieving\n   * the block layout as well as the number of partitions,\n   * the color endpoints and weights data.\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var decompressBlock = function(u8buffer, blockId, blockWidth, blockHeight) {\n    bitsReadCount = 0;\n    bitsWrittenCount = 0;\n    colorDataBitsRead = 0;\n    decodedColorValuesIdx = 0;\n\n    var i = 0;\n    var CEM = 0;\n    var blockInfo = getBlockInfo(u8buffer, blockId);\n\n    if (blockInfo.error)\n      return getErrorPixelBlock(blockWidth, blockHeight);\n\n    // Handles the case whenever the block is filled with only one color\n    if (blockInfo.isVoidExtent)\n      return decompressVoidExtent(u8buffer, blockId, blockInfo, blockWidth, blockHeight);\n\n    if (blockInfo.width > blockWidth)\n      console.error('Texel weight grid width can not be larger than the block width.');\n    if (blockInfo.height > blockHeight)\n      console.error('Texel weight grid height can not be larger than the block height.');\n\n    // Extracts the partitions number\n    var nbPartitions = readBits(u8buffer, blockId, bitsReadCount, 2) + 1;\n    bitsReadCount += 2;\n\n    if (nbPartitions > 4)\n      console.error('The block partitions number is too high.');\n    if (nbPartitions === 4 && blockInfo.dualPlane)\n      return getErrorPixelBlock(blockWidth, blockHeight);\n\n    // Reads the extra configuration field\n    // At most 4 modes describing how color data is encoded\n    var colorEndpointModes = [0, 0, 0, 0];\n    var partitionIndex = -1;\n    var planeIndex = -1;\n    var cemBits = 0;\n    if (nbPartitions === 1) {\n      colorEndpointModes[0] = readBits(u8buffer, blockId, bitsReadCount, 4);\n      bitsReadCount += 4;\n      partitionIndex = 0;\n    } else {\n      // Reads 10 bits containing the partition index\n      partitionIndex = readBits(u8buffer, blockId, bitsReadCount, 10);\n      bitsReadCount += 10;\n      // Reads 6 bits containing the cem extra\n      cemBits = readBits(u8buffer, blockId, bitsReadCount, 6);\n      bitsReadCount += 6;\n    }\n    var baseMode = (cemBits & 3);\n\n    // Computes remaining bits containing color endpoint data\n    //var numberWeightBits = getPackedBitSize(blockInfo);\n    var remainingBits = 128 - getPackedBitSize(blockInfo) - bitsReadCount;\n    var dualPlaneSelectorBits = (blockInfo.dualPlane) ? 2 : 0;\n    remainingBits -= dualPlaneSelectorBits;\n\n    // Gets extra bits number according to CEM\n    // mode 0 does not need any extra CEM bits\n    var extraCEMbitsNb = 0;\n    if (baseMode) {\n      if (nbPartitions === 2)\n        extraCEMbitsNb = 2;\n      else if (nbPartitions === 3)\n        extraCEMbitsNb = 5;\n      else if (nbPartitions === 4)\n        extraCEMbitsNb = 8;\n    }\n    remainingBits -= extraCEMbitsNb;\n\n    // Reads color data\n    // read data are written to a buffer for later use\n    var colorDataBits = remainingBits;\n    for (i = 0; i < 16; ++i)\n      colorEndpointData[i] = 0;\n\n    while (remainingBits > 0) {\n      var bitsNb = Math.min(remainingBits, 8);\n      var bits = readBits(u8buffer, blockId, bitsReadCount, bitsNb);\n      bitsReadCount += bitsNb;\n\n      writeBits(colorEndpointData, bits, bitsNb, bitsWrittenCount);\n      bitsWrittenCount += bitsNb;\n\n      remainingBits -= 8;\n    }\n\n    planeIndex = readBits(u8buffer, blockId, bitsReadCount, dualPlaneSelectorBits);\n    bitsReadCount += dualPlaneSelectorBits;\n\n    // Reads extra CEM data\n    if (baseMode) {\n      var extraCEMbits = readBits(u8buffer, blockId, bitsReadCount, extraCEMbitsNb);\n      bitsReadCount += extraCEMbitsNb;\n\n      CEM = (extraCEMbits << 6) | cemBits;\n      CEM >>= 2;\n\n      // Extracts the class selector bit by bit\n      var C = classSelectorBitsArray;\n      var M = colorModeLSB;\n      for (i = 0; i < nbPartitions; ++i) {\n        C[i] = CEM & 1;\n        CEM >>= 1;\n      }\n      // Extracts the color endoint mode low bits\n      /*for (i = 0; i < nbPartitions; ++i) {\n        M[i] = CEM & 3;\n        CEM >>= 2;\n        if (M[i] > 3)\n          console.error(  'Error while extracting the color endpoint mode LSB.'); \n      }*/\n      for (i = 0; i < nbPartitions; ++i) {\n        M[i] = CEM & 3;\n        CEM >>= 2;\n        if (M[i] > 3)\n          console.error('Error while extracting the color endpoint mode LSB.');\n\n        colorEndpointModes[i] = baseMode;\n        if (!(C[i]))\n          colorEndpointModes[i] -= 1;\n        colorEndpointModes[i] <<= 2;\n        colorEndpointModes[i] |= M[i];\n      }\n    } else if (nbPartitions > 1) {\n      CEM = cemBits >> 2;\n      for (i = 0; i < nbPartitions; ++i)\n        colorEndpointModes[i] = CEM;\n    }\n\n    // Makes sure the extracted data obtained until here is correct\n    var blockBitsRead = bitsReadCount + getPackedBitSize(blockInfo);\n\n    for (i = 0; i < nbPartitions; ++i)\n      if (colorEndpointModes[i] >= 16)\n        console.error('The color endpoint mode ' + colorEndpointModes[i] + ' is not correct.');\n\n    if (blockBitsRead < 128)\n      console.error('The current block as not been read entirely. (' + blockBitsRead + ' read)');\n    else if (blockBitsRead > 128)\n      console.error('Too many bits have been read for the current block. (' + blockBitsRead + ' read)');\n\n    // Decodes color data\n    decodeColorValues(colorEndpointData, colorEndpointModes, nbPartitions, colorDataBits);\n\n    // Computes endpoint for all partitions\n    endpoints.currIdx = 0;\n    for (i = 0; i < nbPartitions; i++)\n      computeColorEndpointsLDR(endpointValuesOutput, colorEndpointModes[i]);\n\n    // Reads remaining bits containing packed texel weight data\n    // This code can be factorized with the color data reading above\n    var texelWeightDataIndex = 0;\n    for (i = 0; i < 16; ++i)\n      texelWeightData[texelWeightDataIndex++] = u8buffer[blockId + i];\n\n    // Reverses the textWeightData array\n    // and each byte\n    reverseU8Array(texelWeightData);\n\n    var weightPackedSize = getPackedBitSize(blockInfo);\n    var clearByteStart = (weightPackedSize >> 3) + 1;\n    var nbBytesToClean = 16 - clearByteStart;\n    texelWeightData[clearByteStart - 1] &= (1 << (weightPackedSize % 8)) - 1;\n    for (i = 0; i < nbBytesToClean; ++i)\n      texelWeightData[clearByteStart + i] = 0;\n\n    // Decodes the weight\n    colorDataBitsRead = 0;\n    var nbWeightValues = getNumberWeightValues(blockInfo);\n    decodeIntegerSequence(texelWeightData, blockInfo.maxWeight, nbWeightValues);\n\n    unquantizeWeights(blockInfo, blockWidth, blockHeight, nbWeightValues);\n\n    // Interpolates colors\n    var smallBlock = (blockHeight * blockWidth) < 32;\n    var rnum = precomputeSelectPartition(partitionIndex, nbPartitions);\n    for (var j = 0; j < blockHeight; j++) {\n      for (i = 0; i < blockWidth; i++) {\n        var partition = selectPartition(rnum, i, j, 0, nbPartitions, smallBlock);\n        if (partition >= nbPartitions)\n          console.error('The block partition index can not be larger or equal to the number of partitions.');\n\n        var rowIndex = (j * blockWidth + i) * 4;\n        var endpointBaseIdx = partition * 8;\n        for (var c = 0; c < 4; ++c) {\n          var C0 = endpoints[endpointBaseIdx + c] >>> 0;\n          C0 = replicateBits0816Map[C0];\n\n          var C1 = endpoints[endpointBaseIdx + c + 4] >>> 0;\n          C1 = replicateBits0816Map[C1];\n\n          var plane = 0 >>> 0;\n          if (blockInfo.dualPlane && (((planeIndex + 1) & 3) === c))\n            plane = 1;\n\n          var weight = infilledWeightsOutput[j * blockWidth + i + plane * 144];\n          var color = Math.floor(((C0 * (64 - weight) + C1 * weight + 32) / 64));\n\n          if (color === 65535)\n            blockPixelsOutput[rowIndex + c] = 255;\n          else\n            blockPixelsOutput[rowIndex + c] = Math.round(255.0 * (color / 65536.0));\n        }\n      }\n    }\n  };\n\n  /**\n   * Decompresses a complete buffer containing ASTC file raw data\n   * @param  {ArrayBuffer} contains the compressed ASTC raw data\n   * @return {Object} contains the uncompressed image buffer\n   * as well as the image dimensions\n   */\n  // TODO export\n  var decompress = function(imgBuffer) {\n    var u8buffer = new Uint8Array(imgBuffer);\n\n    // Retrieves the header\n    var header = parseHeader(imgBuffer);\n\n    var imgWidth = header.xSize;\n    var imgHeight = header.ySize;\n    var halfImgHeight = (imgHeight >> 1);\n\n    var blockWidth = header.blockDimX;\n    var blockHeight = header.blockDimY;\n\n    var firstBlockIndex = 16;\n    var blockNb = 0;\n\n    // Initializes temp storages used\n    // in helper functions\n    blockPixelsOutput = new Uint8Array(blockWidth * blockHeight * 4);\n\n    var j = 0;\n    var i = 0;\n    var resultImg = new Uint8ClampedArray(imgWidth * imgHeight * 4);\n\n    for (j = 0; j < imgHeight; j += blockHeight) {\n      for (i = 0; i < imgWidth; i += blockWidth) {\n\n        var currentBlockIndex = firstBlockIndex + blockNb * 16;\n        // Decompresses the current block\n        decompressBlock(u8buffer, currentBlockIndex, blockWidth, blockHeight);\n\n        var widthBound = Math.min(blockWidth, imgWidth - i);\n        var heightBound = Math.min(blockHeight, imgHeight - j);\n        var rowIndex = (j * imgWidth + i) * 4;\n        for (var jj = 0; jj < heightBound; jj++) {\n          var destId = rowIndex + jj * imgWidth * 4;\n          var srcId = jj * blockWidth * 4;\n\n          for (var x = 0; x < widthBound * 4; x += 4) {\n            resultImg[destId + x] = blockPixelsOutput[srcId + x + 1];\n            resultImg[destId + x + 1] = blockPixelsOutput[srcId + x + 2];\n            resultImg[destId + x + 2] = blockPixelsOutput[srcId + x + 3];\n            resultImg[destId + x + 3] = blockPixelsOutput[srcId + x];\n          }\n        }\n\n        ++blockNb;\n      }\n    }\n\n    // Flips the image using the Y-axis\n    for (j = 0; j < halfImgHeight; j++) {\n      for (i = 0; i < imgWidth; i++) {\n        var beginByte = (j * imgWidth + i) * 4;\n        var endByte = ((imgHeight - j - 1) * imgWidth + i) * 4;\n\n        swapCell(resultImg, beginByte, endByte);\n        swapCell(resultImg, beginByte + 1, endByte + 1);\n        swapCell(resultImg, beginByte + 2, endByte + 2);\n        swapCell(resultImg, beginByte + 3, endByte + 3);\n      }\n    }\n\n    var result = {};\n    result.img = resultImg;\n    result.width = imgWidth;\n    result.height = imgHeight;\n\n    return result;\n  };\n\n  module.exports = {\n    decompress: decompress\n  };\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var replicateBits = __webpack_require__(3).replicateBits;\n\n  // Describes how to unpack trit/quint\n  // with no additional bits\n  var WEIGHT_TRIT_RANGE = [0, 32, 63];\n  var WEIGHT_QUINT_RANGE = [0, 16, 32, 47, 63];\n\n  ///////////////////\n  // CACHE UNQUANTIZE\n  ///////////////////\n\n  // -----------------\n  // UNQUANTIZE SIMPLE\n  // -----------------\n  var cacheUnquantizeSimple = new Uint8Array(256 * 8);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var bitLength = 1; bitLength < 8; ++bitLength) {\n\n      var result = replicateBits(bitValue, bitLength, 6);\n      if (result > 32) result++;\n\n      cacheUnquantizeSimple[bitLength + bitValue * 8] = result;\n    }\n  }\n\n  // ----------------\n  // UNQUANTIZE TRITS\n  // ----------------\n  var cacheUnquantizeTrits = new Uint8Array(256 * 3 * 4);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var tri = 0; tri < 3; ++tri) {\n      for (var bitLength = 0; bitLength < 4; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 0:\n            result = WEIGHT_TRIT_RANGE[tri];\n            break;\n          case 1:\n            C = 50;\n            break;\n          case 2:\n            C = 23;\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 6) | (bBit << 2) | bBit;\n            break;\n          case 3:\n            C = 11;\n            var cbBits = (bitValue >> 1) & 3;\n            B = (cbBits << 5) | cbBits;\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 127 : 0;\n          result = tri * C + B;\n          result ^= A;\n          result = (A & 0x20) | (result >> 2);\n        }\n\n        if (result > 32) result++;\n\n        cacheUnquantizeTrits[bitLength + tri * 4 + bitValue * 12] = result;\n      }\n    }\n  }\n\n  // -----------------\n  // UNQUANTIZE QUINTS\n  // -----------------\n  var cacheUnquantizeQuints = new Uint8Array(256 * 5 * 3);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var quint = 0; quint < 5; ++quint) {\n      for (var bitLength = 0; bitLength < 3; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 0:\n            result = WEIGHT_QUINT_RANGE[quint];\n            break;\n          case 1:\n            C = 28;\n            break;\n          case 2:\n            C = 13;\n            var bBits = (bitValue >> 1) & 1;\n            B = (bBits << 6) | (bBits << 1);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 127 : 0;\n          result = quint * C + B;\n          result ^= A;\n          result = (A & 0x20) | (result >> 2);\n        }\n\n        if (result > 32) result++;\n\n        cacheUnquantizeQuints[bitLength + quint * 3 + bitValue * 15] = result;\n      }\n    }\n  }\n\n  ///////////////\n  // CACHE DECODE\n  ///////////////\n\n  // -------------\n  // DECODE SIMPLE\n  // -------------\n  var cacheDecodeSimple = new Uint8Array(256 * 9);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var bitLength = 1; bitLength < 9; ++bitLength) {\n      cacheDecodeSimple[bitLength + bitValue * 9] = replicateBits(bitValue, bitLength, 8);\n    }\n  }\n\n  // ----------------\n  // UNQUANTIZE TRITS\n  // ----------------\n  var cacheDecodeTrits = new Uint8Array(256 * 3 * 7);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var tri = 0; tri < 3; ++tri) {\n      for (var bitLength = 0; bitLength < 7; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 1:\n            C = 204;\n            break;\n          case 2:\n            C = 93;\n            // b000b0bb0\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 8) | (bBit << 4) | (bBit << 2) | (bBit << 1);\n            break;\n          case 3:\n            C = 44;\n            // cb000cbcb\n            var cbBit = (bitValue >> 1) & 3;\n            B = (cbBit << 7) | (cbBit << 2) | cbBit;\n            break;\n          case 4:\n            C = 22;\n            // dcb000dcb\n            var dcbBit = (bitValue >> 1) & 7;\n            B = (dcbBit << 6) | dcbBit;\n            break;\n          case 5:\n            C = 11;\n            // edcb000ed\n            var edcbBit = (bitValue >> 1) & 0xF;\n            B = (edcbBit << 5) | (edcbBit >> 2);\n            break;\n          case 6:\n            C = 5;\n            // fedcb000f\n            var fedcbBit = (bitValue >> 1) & 0x1F;\n            B = (fedcbBit << 4) | (fedcbBit >> 4);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 511 : 0;\n          result = (tri * C + B) >>> 0;\n          result ^= A;\n          result = (A & 0x80) | (result >> 2);\n        }\n\n        cacheDecodeTrits[bitLength + tri * 7 + bitValue * 21] = result;\n      }\n    }\n  }\n\n  // -----------------\n  // UNQUANTIZE QUINTS\n  // -----------------\n  var cacheDecodeQuints = new Uint8Array(256 * 5 * 6);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var quint = 0; quint < 5; ++quint) {\n      for (var bitLength = 0; bitLength < 6; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 1:\n            C = 113;\n            break;\n          case 2:\n            C = 54;\n            // b0000bb00\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 8) | (bBit << 3) | (bBit << 2);\n            break;\n          case 3:\n            C = 26;\n            // cb0000cbc\n            var cbBit = (bitValue >> 1) & 3;\n            B = (cbBit << 7) | (cbBit << 1) | (cbBit >> 1);\n            break;\n          case 4:\n            C = 13;\n            // dcb0000dc\n            var dcbBit = (bitValue >> 1) & 7;\n            B = (dcbBit << 6) | (dcbBit >> 1);\n            break;\n          case 5:\n            C = 6;\n            // edcb0000e\n            var edcbBit = (bitValue >> 1) & 0xF;\n            B = (edcbBit << 5) | (edcbBit >> 3);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 511 : 0;\n          result = (quint * C + B) >>> 0;\n          result ^= A;\n          result = (A & 0x80) | (result >> 2);\n        }\n\n        cacheDecodeQuints[bitLength + quint * 6 + bitValue * 30] = result;\n      }\n    }\n  }\n\n\n  // TOTO module exports\n  module.exports = {\n    cacheUnquantizeSimple: cacheUnquantizeSimple,\n    cacheUnquantizeTrits: cacheUnquantizeTrits,\n    cacheUnquantizeQuints: cacheUnquantizeQuints,\n    cacheDecodeSimple: cacheDecodeSimple,\n    cacheDecodeTrits: cacheDecodeTrits,\n    cacheDecodeQuints: cacheDecodeQuints\n  };\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n  'use strict';\n\n  /**\n   * Creates a binary mask between two given bounds\n   * @param  {int} a starting bit\n   * @param  {int} b ending bit\n   * @return {int} mask integer containing binary 1 between a and b\n   */\n  var createMask = function(a, b) {\n    var r = 0;\n    for (var i = a; i <= b; ++i)\n      r |= 1 << i;\n\n    return r;\n  };\n\n  /**\n   * Applies the Hamming weight algorithm: looks for the number of bits set to 1\n   * @param  {int} value\n   * @return {int} the number of bits set to 1\n   */\n  var popCount = function(value) {\n    var i = 0;\n    for (; value; ++i)\n      value &= value - 1;\n    return i;\n  };\n\n  /**\n   * Extracts bits from a bounded range\n   * @param  {int} value representing the integer value where the bits are extracted\n   * @param  {int} start the index of the starting bit\n   * @param  {int} stop  the index of the ending bit\n   * @return {int} the integer composed by the extracted bits\n   */\n  var extractBits = function(value, start, stop) {\n    return (value & createMask(start, stop)) >> start;\n  };\n\n\n  /**\n   * Replicates the n lower bits until the given bit index\n   * @param  {int} val contains the bits to replicate\n   * @param  {int} bitsNb describes the number of lower bits to replicate\n   * @param  {int} endBit the \"index\" of the included final bit\n   * @return {int} result containing a number made of the replicated bits\n   */\n  var replicateBits = function(val, bitsNb, endBit) {\n    // Extracts the bitsNb lower bits from the val value\n    var extractedBits = val & ((1 << bitsNb) - 1);\n    var result = extractedBits;\n    var resultLength = bitsNb;\n\n    while (resultLength < endBit) {\n\n      var extractedBitsShift = 0;\n      if (bitsNb > endBit - resultLength) {\n        var newShift = endBit - resultLength;\n        extractedBitsShift = bitsNb - newShift;\n        bitsNb = newShift;\n      }\n\n      // Shifts the result to \"add\" the pattern\n      result <<= bitsNb;\n      result |= extractedBits >> extractedBitsShift;\n      resultLength += bitsNb;\n    }\n\n    return result;\n  };\n\n  /**\n   * Transfers one bit from an integer to another\n   * @param  {array} array containing the two cells to transfer\n   * @param  {uint} i1 the index of the first cell\n   * @param  {uint} i2 the index of the second cell\n   */\n  var bitTransferSigned = function(array, i1, i2) {\n    var a = array[i1];\n    var b = array[i2];\n\n    b >>= 1;\n    b |= a & 0x80;\n    a >>= 1;\n    a &= 0x3F;\n    if (a & 0x20)\n      a -= 0x40;\n\n    array[i1] = a;\n    array[i2] = b;\n  };\n\n  /**\n   * Reads at most 30 bits from the given U8Int array\n   * @param  {U8IntArray} u8buffer buffer containing data to read\n   * @param  {int} beginByteId first byte at which the reading should begin\n   * @param  {int} bitsOffset nth bits at which the reading should begin\n   * @param  {int} bitsNb number of bits to read\n   * @return {int} an integer containing the read bits\n   */\n  var readBits = function(u8buffer, beginByteId, bitsOffset, bitsNb) {\n    if (bitsNb > 30)\n      console.error('The reader can not read more than 30 bits in a row.');\n    if (bitsNb <= 0)\n      return 0;\n\n    // Updates the total number of extracted bits\n    // for the current block\n    //bitsReadCount += bitsNb;\n\n    var bitsReadResult = 0;\n    var offsetByteId = beginByteId + Math.floor(bitsOffset / 8);\n    var endByteId = beginByteId + Math.floor((bitsOffset + bitsNb) / 8);\n    var bornInfBit = bitsOffset % 8;\n    var bornSupBit = (bitsOffset + bitsNb - 1) % 8;\n\n    // Simple reading where data lies on the same byte\n    if (offsetByteId === endByteId)\n      return (u8buffer[offsetByteId] & createMask(bornInfBit, bornSupBit)) >> bornInfBit;\n\n    // Recreates the integer by shifting bytes\n    // the created integer is at most a 24bits integer\n    var shift = 8;\n    bitsReadResult += u8buffer[offsetByteId];\n    for (var i = offsetByteId + 1; i <= endByteId; ++i) {\n      bitsReadResult += u8buffer[i] << shift;\n      shift *= 2;\n    }\n\n    bitsReadResult = (bitsReadResult & createMask(bornInfBit, bornInfBit + bitsNb - 1)) >> bornInfBit;\n\n    return bitsReadResult;\n  };\n\n  /**\n   * Write a given value in colorEndpointData at the byte index\n   * computed from the number of bits currently written.\n   * It is important to note that the number of bits to write in\n   * a row never exceed the size of a byte (8 bits)\n   * @param  {Uint8Array} colorEndpointData destination byte array\n   * @param  {int} bits the value to write\n   * @param  {uint} bitsNb the number of bits to write\n   * @param  {uint} bitsWritten the current number of bits written\n   */\n  var writeBits = function(colorEndpointData, bits, bitsNb, bitsWritten) {\n    colorEndpointData[Math.floor(bitsWritten / 8)] = bits;\n  };\n\n  /**\n   * Reverses the bits in a byte\n   * @param  {uint8} b the byte to reverse\n   * @return {uint32} the reversed byte not casted\n   */\n  var reverseByte = function(b) {\n    // Converts x to a 32 bits unsigned integer\n    b = b >>> 0;\n    return ((b * 0x0802 & 0x22110) | (b * 0x8020 & 0x88440)) * 0x10101 >> 16;\n  };\n\n  /**\n   * Reverses each byte just as the global bytes order\n   * @param  {Uint8Array} u8array the array to reverse\n   */\n  var reverseU8Array = function(u8array) {\n    for (var i = 0; i < u8array.length / 2; ++i) {\n      var a = reverseByte(u8array[i]);\n      var b = reverseByte(u8array[u8array.length - 1 - i]);\n\n      u8array[i] = b;\n      u8array[u8array.length - 1 - i] = a;\n    }\n  };\n\n  module.exports = {\n    popCount: popCount,\n    readBits: readBits,\n    writeBits: writeBits,\n    extractBits: extractBits,\n    replicateBits: replicateBits,\n    bitTransferSigned: bitTransferSigned,\n    reverseU8Array: reverseU8Array\n  };\n\n/***/ }\n/******/ ])\n});\n;"
}
, function(t, e) {
    t.exports = "vec3 getScale( const in mat4 matrix ) {\n      // Only working with positive scales.\n      float xs = matrix[0][0] * matrix[0][1] * matrix[0][2] * matrix[0][3] < 0. ? -1. : 1.;\n      float ys = matrix[1][0] * matrix[1][1] * matrix[1][2] * matrix[1][3] < 0. ? -1. : 1.;\n      float zs = matrix[2][0] * matrix[2][1] * matrix[2][2] * matrix[2][3] < 0. ? -1. : 1.;\n      vec3 scale;\n      scale.x = xs * sqrt( matrix[0][0] * matrix[0][0] + matrix[0][1] * matrix[0][1] + matrix[0][2] * matrix[0][2]);\n      scale.y = ys * sqrt( matrix[1][0] * matrix[1][0] + matrix[1][1] * matrix[1][1] + matrix[1][2] * matrix[1][2]);\n      scale.z = zs * sqrt( matrix[2][0] * matrix[2][0] + matrix[2][1] * matrix[2][1] + matrix[2][2] * matrix[2][2]);\n      return scale;\n}\n\nvec4 billboard( const in vec3 vertex, const in mat4 modelViewMatrix, const in mat4 projectionMatrix ) {\n      vec3 scale = getScale( modelViewMatrix );\n      return projectionMatrix * ( vec4( scale.x* vertex.x , scale.y * vertex.y, scale.z * vertex.z, 1.0 ) + vec4( modelViewMatrix[ 3 ].xyz, 0.0 ) );\n}\n"
}
, function(t, e) {
    t.exports = "\nfloat decodeFloatRGBA( vec4 rgba ) {\n    return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );\n}\n\nvec4 encodeFloatRGBA( float v ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\n\nvec2 decodeHalfFloatRGBA( vec4 rgba ) {\n    return vec2(rgba.x + (rgba.y / 255.0), rgba.z + (rgba.w / 255.0));\n}\n\nvec4 encodeHalfFloatRGBA( vec2 v ) {\n    const vec2 bias = vec2(1.0 / 255.0, 0.0);\n    vec4 enc;\n    enc.xy = vec2(v.x, fract(v.x * 255.0));\n    enc.xy = enc.xy - (enc.yy * bias);\n\n    enc.zw = vec2(v.y, fract(v.y * 255.0));\n    enc.zw = enc.zw - (enc.ww * bias);\n    return enc;\n}\n"
}
, function(t, e) {
    t.exports = "// the approximation :\n// http://chilliant.blogspot.fr/2012/08/srgb-approximations-for-hlsl.html\n// introduced slightly darker colors and more slight banding in the darks.\n// The reference implementation (or even a single pow approx) did not introduced these effects.\n\n// so for now we stick with the reference implementation :\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\n// with the slight changes :\n// - we always assume the color is >= 0.0 (so no check)\n// - unlike the previous approximation, linear to srgb is monotonic so we don't need to check if the color is > 1\n\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\nfloat linearTosRGB(const in float c) {\n    return LIN_SRGB(c);\n}\nvec3 linearTosRGB(const in vec3 c) {\n    return vec3(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b));\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b), c.a);\n}\n\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\nfloat sRGBToLinear(const in float c) {\n    return SRGB_LIN(c);\n}\nvec3 sRGBToLinear(const in vec3 c) {\n    return vec3(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b));\n}\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b), c.a);\n}\n\n//http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec3 RGBMToRGB( const in vec4 rgba ) {\n    const float maxRange = 8.0;\n    return rgba.rgb * maxRange * rgba.a;\n}\n\nconst mat3 LUVInverse = mat3( 6.0013,    -2.700,   -1.7995,\n                              -1.332,    3.1029,   -5.7720,\n                              0.3007,    -1.088,    5.6268 );\n\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\n    float Le = vLogLuv.z * 255.0 + vLogLuv.w;\n    vec3 Xp_Y_XYZp;\n    Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n    Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\n    Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\n    vec3 vRGB = LUVInverse * Xp_Y_XYZp;\n    return max(vRGB, 0.0);\n}\n\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec4 encodeRGBM(const in vec3 col, const in float range) {\n    if(range <= 0.0)\n        return vec4(col, 1.0);\n    vec4 rgbm;\n    vec3 color = col / range;\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\n    rgbm.rgb = color / rgbm.a;\n    return rgbm;\n}\n\nvec3 decodeRGBM(const in vec4 col, const in float range) {\n    if(range <= 0.0)\n        return col.rgb;\n    return range * col.rgb * col.a;\n}"
}
, function(t, e) {
    t.exports = "////////////////\n// ATTENUATION\n/////////////\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation) {\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\n    // TODO find a vector alu instead of 4 scalar\n    float constant = lightAttenuation.x;\n    float linear = lightAttenuation.y*dist;\n    float quadratic = lightAttenuation.z*dist*dist;\n    return 1.0 / ( constant + linear + quadratic );\n}\n//\n// LIGHTING EQUATION TERMS\n///\nvoid specularCookTorrance(const in vec3 n, const in vec3 l, const in vec3 v, const in float hard, const in vec3 materialSpecular, const in vec3 lightSpecular, out vec3 specularContrib) {\n    vec3 h = normalize(v + l);\n    float nh = dot(n, h);\n    float specfac = 0.0;\n\n    if(nh > 0.0) {\n        float nv = max( dot(n, v), 0.0 );\n        float i = pow(nh, hard);\n        i = i / (0.1 + nv);\n        specfac = i;\n    }\n    // ugly way to fake an energy conservation (mainly to avoid super bright stuffs with low glossiness)\n    float att = hard > 100.0 ? 1.0 : smoothstep(0.0, 1.0, hard * 0.01);\n    specularContrib = specfac*materialSpecular*lightSpecular*att;\n}\n\nvoid lambert(const in float ndl,  const in vec3 materialDiffuse, const in vec3 lightDiffuse, out vec3 diffuseContrib) {\n    diffuseContrib = ndl*materialDiffuse*lightDiffuse;\n}\n////////////////////////\n/// Main func\n///////////////////////\n\n/// for each light\n//direction, dist, NDL, attenuation, compute diffuse, compute specular\n\nvec3 computeSpotLightShading(\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialAmbient,\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightAmbient,\n    const in vec3 lightDiffuse,\n    const in vec3 lightSpecular,\n\n    const in vec3  lightSpotDirection,\n    const in vec4  lightAttenuation,\n    const in vec4  lightSpotPosition,\n    const in float lightCosSpotCutoff,\n    const in float lightSpotBlend,\n\n    const in mat4 lightMatrix,\n    const in mat4 lightInvMatrix,\n\n    out vec3 eyeLightPos,\n    out vec3 eyeLightDir,\n    out bool lighted) {\n    lighted = false;\n    eyeLightPos = vec3(lightMatrix * lightSpotPosition);\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\n    // compute dist\n    float dist = length(eyeLightDir);\n    // compute attenuation\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\n    if (attenuation != 0.0) {\n        // compute direction\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n        if (lightCosSpotCutoff > 0.0) {\n            //compute lightSpotBlend\n            vec3 lightSpotDirectionEye = normalize(mat3(vec3(lightInvMatrix[0]), vec3(lightInvMatrix[1]), vec3(lightInvMatrix[2]))*lightSpotDirection);\n\n            float cosCurAngle = dot(-eyeLightDir, lightSpotDirectionEye);\n            float diffAngle = cosCurAngle - lightCosSpotCutoff;\n            float spot = 1.0;\n            if ( diffAngle < 0.0 ) {\n                spot = 0.0;\n            } else {\n                if ( lightSpotBlend > 0.0 )\n                    spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightCosSpotCutoff) / (lightSpotBlend));\n            }\n\n            if (spot > 0.0) {\n                // compute NdL\n                float NdotL = dot(eyeLightDir, normal);\n                if (NdotL > 0.0) {\n                    lighted = true;\n                    vec3 diffuseContrib;\n                    lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n                    vec3 specularContrib;\n                    specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n                    return spot * attenuation * (diffuseContrib + specularContrib);\n                }\n            }\n        }\n    }\n    return vec3(0.0);\n}\n\nvec3 computePointLightShading(\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialAmbient,\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightAmbient,\n    const in vec3 lightDiffuse,\n    const in vec3 lightSpecular,\n\n    const in vec4 lightPosition,\n    const in vec4 lightAttenuation,\n\n    const in mat4 lightMatrix,\n\n    out vec3 eyeLightPos,\n    out vec3 eyeLightDir,\n    out bool lighted) {\n\n    eyeLightPos =  vec3(lightMatrix * lightPosition);\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\n    float dist = length(eyeLightDir);\n    // compute dist\n    // compute attenuation\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\n    if (attenuation != 0.0) {\n        // compute direction\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n        // compute NdL\n        float NdotL = dot(eyeLightDir, normal);\n        if (NdotL > 0.0) {\n            lighted = true;\n            vec3 diffuseContrib;\n            lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n            vec3 specularContrib;\n            specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n            return attenuation * (diffuseContrib + specularContrib);\n        }\n    }\n    return vec3(0.0);\n}\n\nvec3 computeSunLightShading(\n\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialAmbient,\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightAmbient,\n    const in vec3 lightDiffuse,\n    const in vec3 lightSpecular,\n\n    const in vec4 lightPosition,\n\n    const in mat4 lightMatrix,\n\n    out vec3 eyeLightDir,\n    out bool lighted) {\n\n    lighted = false;\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    // compute NdL   // compute NdL\n    float NdotL = dot(eyeLightDir, normal);\n    if (NdotL > 0.0) {\n        lighted = true;\n        vec3 diffuseContrib;\n        lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n        vec3 specularContrib;\n        specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n        return (diffuseContrib + specularContrib);\n    }\n    return vec3(0.0);\n}\n\nvec3 computeHemiLightShading(\n\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightDiffuse,\n    const in vec3 lightGround,\n\n    const in vec4 lightPosition,\n\n    const in mat4 lightMatrix,\n\n    out vec3 eyeLightDir,\n    out bool lighted) {\n\n    lighted = false;\n\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    float NdotL = dot(eyeLightDir, normal);\n    float weight = 0.5 * NdotL + 0.5;\n    vec3 diffuseContrib = materialDiffuse * mix(lightGround, lightDiffuse, weight);\n\n    // same cook-torrance as above for sky/ground\n    float skyWeight = 0.5 * dot(normal, normalize(eyeVector + eyeLightDir)) + 0.5;\n    float gndWeight = 0.5 * dot(normal, normalize(eyeVector - eyeLightDir)) + 0.5;\n    float skySpec = pow(skyWeight, materialShininess);\n    float skyGround = pow(gndWeight, materialShininess);\n    float divisor = (0.1 + max( dot(normal, eyeVector), 0.0 ));\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\n    vec3 specularContrib = lightDiffuse * materialSpecular * weight * att * (skySpec + skyGround) / divisor;\n\n    return diffuseContrib + specularContrib;\n}\n"
}
, function(t, e) {
    t.exports = '#pragma include "hash.glsl"\n\n//// noise glsl\n\n// Based on Morgan McGuire @morgan3d\n// https://www.shadertoy.com/view/4dS3Wd\nfloat noise2D(const in vec2 x) {\n    vec2 i = floor(x);\n    vec2 f = fract(x);\n\n    // Four corners in 2D of a tile\n    float a = hash21(i);\n    float b = hash21(i + vec2(1.0, 0.0));\n    float c = hash21(i + vec2(0.0, 1.0));\n    float d = hash21(i + vec2(1.0, 1.0));\n\n    vec2 u = f * f * (3.0 - 2.0 * f);\n    return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\n}\n\n//// end noise glsl\n'
}
, function(t, e) {
    t.exports = "//////////////////////////////\n// OPTIMIZED VERSION (NO IF)\n//////////////////////////////\nmat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n    mat4 outMat_1;\n    mat4 tmpMat_2;\n    highp ivec4 tmpvar_3;\n    tmpvar_3 = (3 * ivec4(bonesIdx));\n    tmpMat_2 = mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0);\n    vec4 tmpvar_4;\n    tmpvar_4 = -(abs(weightsVec));\n    tmpMat_2[0] = uBones[tmpvar_3.x];\n    tmpMat_2[1] = uBones[(tmpvar_3.x + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.x + 2)];\n    outMat_1 = ((float(\n    ((tmpvar_4.x + tmpvar_4.y) >= -((tmpvar_4.z + tmpvar_4.w)))\n    ) * mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0)) + (weightsVec.x * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.y];\n    tmpMat_2[1] = uBones[(tmpvar_3.y + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.y + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.y * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.z];\n    tmpMat_2[1] = uBones[(tmpvar_3.z + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.z + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.z * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.w];\n    tmpMat_2[1] = uBones[(tmpvar_3.w + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.w + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.w * tmpMat_2));\n\n    return outMat_1;\n}\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (WITH IF)\n//////////////////////////////\n\n// //http://http.developer.nvidia.com/GPUGems/gpugems_ch04.html\n// mat4 getMat4FromVec4( const int index, inout mat4 myMat ) {\n//     // We have to use a global variable because we can't access dynamically\n//     // matrix is transpose so we should do vec * matrix\n//     myMat[0] = uBones[ index ];\n//     myMat[1] = uBones[ index + 1];\n//     myMat[2] = uBones[ index + 2];\n//     return myMat;\n// }\n\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n//     ivec4 idx =  3 * ivec4(bonesIdx);\n//     mat4 tmpMat = mat4(1.0);\n//     mat4 outMat = mat4(0.0);\n\n//     // we handle negative weights\n//     if(all(equal(weightsVec, vec4(0.0)))) return tmpMat;\n\n//     if(weightsVec.x != 0.0) outMat += weightsVec.x * getMat4FromVec4( idx.x, tmpMat );\n//     if(weightsVec.y != 0.0) outMat += weightsVec.y * getMat4FromVec4( idx.y, tmpMat );\n//     if(weightsVec.z != 0.0) outMat += weightsVec.z * getMat4FromVec4( idx.z, tmpMat );\n//     if(weightsVec.w != 0.0) outMat += weightsVec.w * getMat4FromVec4( idx.w, tmpMat );\n//     return outMat;\n// }\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (NO IF)\n//////////////////////////////\n\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n//     ivec4 idx =  3 * ivec4(bonesIdx);\n//     mat4 tmpMat = mat4(1.0);\n\n//     // if sum is 0, return identity\n//     vec4 absWeights = -abs(weightsVec);\n//     mat4 outMat = step(0.0, absWeights.x + absWeights.y + absWeights.z + absWeights.w) * tmpMat;\n\n//     // we handle negative weights\n//     // outMat[3][3] += weightsVec.x + weightsVec.y + weightsVec.z + weightsVec.w;\n\n//     tmpMat[0] = uBones[ idx.x ];\n//     tmpMat[1] = uBones[ idx.x + 1];\n//     tmpMat[2] = uBones[ idx.x + 2];\n//     outMat += weightsVec.x * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.y ];\n//     tmpMat[1] = uBones[ idx.y + 1];\n//     tmpMat[2] = uBones[ idx.y + 2];\n//     outMat += weightsVec.y * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.z ];\n//     tmpMat[1] = uBones[ idx.z + 1];\n//     tmpMat[2] = uBones[ idx.z + 2];\n//     outMat += weightsVec.z * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.w ];\n//     tmpMat[1] = uBones[ idx.w + 1];\n//     tmpMat[2] = uBones[ idx.w + 2];\n//     outMat += weightsVec.w * tmpMat;\n\n//     return outMat;\n// }\n"
}
, function(t, e) {
    t.exports = "vec3 textureRGB(const in sampler2D tex, const in vec2 uv) {\n    return texture2D(tex, uv.xy ).rgb;\n}\n\nvec4 textureRGBA(const in sampler2D tex, const in vec2 uv) {\n    return texture2D(tex, uv.xy ).rgba;\n}\n\nfloat textureIntensity(const in sampler2D tex, const in vec2 uv) {\n    return texture2D(tex, uv).r;\n}\n\nfloat textureAlpha(const in sampler2D tex, const in vec2 uv) {\n    return texture2D(tex, uv.xy ).a;\n}\n"
}
, function(t, e) {
    t.exports = "//// hash glsl\n\n// Dave Hoskins: hash without sin\n//https://www.shadertoy.com/view/4djSRW\n#define MOD2 vec2(443.8975,397.2973)\n//----------------------------------------------------------------------------------------\n//  1 out, 1 in...\n//note: normalized uniform random, [0;1[\nfloat hash11(const in float p)\n{\n    vec2 p2 = fract(vec2(p) * MOD2);\n    p2 += dot(p2.yx, p2.xy+19.19);\n    return fract(p2.x * p2.y);\n}\n//note: normalized uniform random, [0;1[\n//  2 out, 1 in...\nfloat hash21(const in vec2 p)\n{\n    vec2 p2 = fract(p * MOD2);\n    p2 += dot(p2.yx, p2.xy+19.19);\n    return fract(p2.x * p2.y);\n}\n\n\n// Based on Morgan McGuire @morgan3d\n// https://www.shadertoy.com/view/4dS3Wd\n// using Sin\n//  1 out, 1 in...\nfloat hashSin11( const in float n )\n{\n    return fract(sin(n)*43758.5453);\n}\n\n//note: normalized uniform random, [0;1[\n//  2 out, 1 in...\nfloat hashSin21( const in vec2 n ) {\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n\n// note: [-1;1]\n// iq: https://www.shadertoy.com/view/Xsl3Dl\n// note: value noise\n//  2 out, 2 in...\nvec2 hashSin22( const in vec2 n )\n{\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* vec2(43758.5453,35458.5734));\n}\n//  3 out, 3 in...\nvec3 hashSin33( in vec3 p )\n{\n    p = vec3( dot(p,vec3(127.1,311.7, 74.7)),\n              dot(p,vec3(269.5,183.3,246.1)),\n              dot(p,vec3(113.5,271.9,124.6)));\n    return fract(sin(p)*43758.5453123);\n}\n\n// Returns a random number based on a vec3 and an int.\nfloat hashSin41(const in vec4 seed){\n    return fract(sin(dot(seed, vec4(12.9898,78.233,45.164,94.673)) * 43758.5453));\n}\n\n/////// end hash\n"
}
, function(t, e) {
    t.exports = '\n#pragma include "tapPCF.glsl"\n\n#ifdef _ATLAS_SHADOW\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in vec4 shadowTextureSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in vec3 normalWorld,\n                    const in vec3 vertexWorld,                    \n                    const in float bias\n#ifdef _NORMAL_OFFSET\n                    ,const in float normalBias\n#endif //_NORMAL_OFFSET\n                    \n    )\n#else\n    \nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowTextureSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in vec3 normalWorld,\n                    const in vec3 vertexWorld,\n                    const in float bias\n#ifdef _NORMAL_OFFSET\n                    ,const in float normalBias\n#endif //_NORMAL_OFFSET\n\n   )\n    \n#endif\n{\n                        \n    #pragma include "shadowsReceiveMain.glsl"\n\n}\n\n'
}
, function(t, e) {
    t.exports = "\n// simulation of texture2Dshadow glsl call on HW\n// http://codeflow.org/entries/2013/feb/15/soft-shadow-mapping/\nfloat texture2DCompare(const in sampler2D depths, const in vec2 uv, const in float compare, const in vec4 clampDimension){\n\n    float depth = getSingleFloatFromTex(depths, clamp(uv, clampDimension.xy, clampDimension.zw));\n    return step(compare, depth);\n\n}\n\n// simulates linear fetch like texture2d shadow\nfloat texture2DShadowLerp(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare, const in vec4 clampDimension){\n\n    vec2 f = fract(uv*size.xy+0.5);\n    vec2 centroidUV = floor(uv*size.xy+0.5)*size.zw;\n\n    float lb = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 0.0), compare, clampDimension);\n    float lt = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 1.0), compare, clampDimension);\n    float rb = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 0.0), compare, clampDimension);\n    float rt = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 1.0), compare, clampDimension);\n    float a = mix(lb, lt, f.y);\n    float b = mix(rb, rt, f.y);\n    float c = mix(a, b, f.x);\n    return c;\n\n}\n"
}
, function(t, e) {
    t.exports = '\n#pragma include "colorEncode.glsl"\n\n\nvec4 computeShadowDepth(const in vec4 fragEye,\n                        const in vec4 shadowRange){\n    // distance to camera\n    float depth =  -fragEye.z * fragEye.w;\n    // most precision near 0, make sure we are near 0 and in  [0,1]\n    depth = (depth - shadowRange.x ) * shadowRange.w;\n\n    vec4 outputFrag;\n\n#if defined (_FLOATTEX) \n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#else\n    outputFrag = encodeFloatRGBA(depth);\n#endif\n\n    return outputFrag;\n}\n'
}
, function(t, e) {
    t.exports = '//begin shadows\n\n#pragma include "colorEncode.glsl"\n\n// end Float codec\nfloat getSingleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return  decodeFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).x;\n#endif\n}\n\nvec2 getDoubleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return decodeHalfFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).xy;\n#endif\n}\n\nvec4 getQuadFloatFromTex(const in sampler2D depths, const in vec2 uv){\n    return texture2D(depths, uv).xyzw;\n}\n// end Float codec\n\n#pragma include "pcf.glsl" '
}
, function(t, e) {
    t.exports = "// 0 for early out\nbool earlyOut = false;\n\n// Calculate shadow amount\nfloat shadow = 1.0;\n\nif(!lighted) {\n    shadow = 0.0;\n    earlyOut = true;\n}\n\nif (depthRange.x == depthRange.y) {\n    earlyOut = true;\n}\n\nvec4 shadowVertexEye;\nvec4 shadowNormalEye;\nfloat shadowReceiverZ = 0.0;\nvec4 shadowVertexProjected;\nvec2 shadowUV;\nfloat N_Dot_L;\n\nif(!earlyOut) {\n\n    shadowVertexEye =  shadowViewMatrix *  vec4(vertexWorld, 1.0);\n\n    vec3 shadowLightDir = vec3(0.0, 0.0, 1.0); // in shadow view light is camera\n    vec4 normalFront = vec4(normalWorld, 0.0);\n    shadowNormalEye =  shadowViewMatrix * normalFront;\n    N_Dot_L = dot(shadowNormalEye.xyz, shadowLightDir);\n\n    if(!earlyOut) {\n\n#ifdef _NORMAL_OFFSET\n\n        // http://www.dissidentlogic.com/old/images/NormalOffsetShadows/GDC_Poster_NormalOffset.png\n        float normalOffsetScale = clamp(1.0  - N_Dot_L, 0.0 , 1.0);\n\n        normalOffsetScale *= abs((shadowVertexEye.z - depthRange.x) * depthRange.w) * max(shadowProjectionMatrix[0][0], shadowProjectionMatrix[1][1]);\n\n        normalOffsetScale *= normalBias*depthRange.w;\n\n        shadowNormalEye =  shadowViewMatrix *  (normalFront * normalOffsetScale);\n\n        shadowVertexProjected = shadowProjectionMatrix * (shadowVertexEye + shadowNormalEye);\n\n#else\n\n        shadowVertexProjected = shadowProjectionMatrix * shadowVertexEye;\n\n#endif\n\n        if (shadowVertexProjected.w < 0.0) {\n            earlyOut = true; // notably behind camera\n        }\n\n    }\n\n\n\n\n    if(!earlyOut) {\n\n        shadowUV.xy = shadowVertexProjected.xy / shadowVertexProjected.w;\n        shadowUV.xy = shadowUV.xy * 0.5 + 0.5;// mad like\n\n        if(any(bvec4 ( shadowUV.x > 1., shadowUV.x < 0., shadowUV.y > 1., shadowUV.y < 0.))) {\n            earlyOut = true;// limits of light frustum\n        }\n\n        // most precision near 0, make sure we are near 0 and in [0,1]\n        shadowReceiverZ = - shadowVertexEye.z;\n        shadowReceiverZ =  (shadowReceiverZ - depthRange.x)* depthRange.w;\n\n        if(shadowReceiverZ < 0.0) {\n            earlyOut = true; // notably behind camera\n        }\n\n    }\n}\n\n\n\n\n\n\n// pcf pbias to add on offset\nvec2 shadowBiasPCF = vec2 (0.);\n\n#ifdef GL_OES_standard_derivatives\n\n\n//#define _RECEIVERPLANEDEPTHBIAS\n#ifdef _RECEIVERPLANEDEPTHBIAS\nvec2 biasUV;\n\nvec3 texCoordDY = dFdx(shadowVertexEye.xyz);\nvec3 texCoordDX = dFdy(shadowVertexEye.xyz);\n\nbiasUV.x = texCoordDY.y * texCoordDX.z - texCoordDX.y * texCoordDY.z;\nbiasUV.y = texCoordDX.x * texCoordDY.z - texCoordDY.x * texCoordDX.z;\nbiasUV *= 1.0 / ((texCoordDX.x * texCoordDY.y) - (texCoordDX.y * texCoordDY.x));\n\n// Static depth biasing to make up for incorrect fractional sampling on the shadow map grid\nfloat fractionalSamplingError = dot(vec2(1.0, 1.0) * shadowTextureSize.zw, abs(biasUV));\nfloat receiverDepthBias = min(fractionalSamplingError, 0.01);\n\nshadowBiasPCF.x = biasUV.x;\nshadowBiasPCF.y = biasUV.y;\n\n\nshadowReceiverZ += receiverDepthBias;\n\n#else\n\nshadowBiasPCF.x = clamp(dFdx(shadowReceiverZ)* shadowTextureSize.z, -1.0, 1.0 );\nshadowBiasPCF.y = clamp(dFdy(shadowReceiverZ)* shadowTextureSize.w, -1.0, 1.0 );\n\n#endif\n#endif\n\n\nvec4 clampDimension;\n\n#ifdef _ATLAS_SHADOW\n\nshadowUV.xy  = ((shadowUV.xy * shadowMapSize.zw ) + shadowMapSize.xy) / shadowTextureSize.xy;\n\n// clamp uv bias/filters by half pixel to avoid point filter on border\nclampDimension.xy = shadowMapSize.xy + vec2(0.5);\nclampDimension.zw = (shadowMapSize.xy + shadowMapSize.zw) - vec2(0.5);\n\nclampDimension = clampDimension / (shadowTextureSize.xyxy);\n\n\n#else\n\nclampDimension = vec4(0.0, 0.0, 1.0, 1.0);\n\n#endif\n\n\n// now that derivatives is done\n// and we don't access any mipmapped/texgrad texture\n// we can early out\n// see http://teknicool.tumblr.com/post/77263472964/glsl-dynamic-branching-and-texture-samplers\nif (earlyOut) {\n    // empty statement because of weird gpu intel bug\n} else {\n\n\n// depth bias: fighting shadow acne (depth imprecsion z-fighting)\nfloat shadowBias = 0.0;\n\n\n\n\n// cosTheta is dot( n, l ), clamped between 0 and 1\n//float shadowBias = 0.005*tan(acos(N_Dot_L));\n// same but 4 cycles instead of 15\nshadowBias += 0.05 *  sqrt( 1. -  N_Dot_L*N_Dot_L) / clamp(N_Dot_L, 0.0005,  1.0);\n\n//That makes sure that plane perpendicular to light doesn't flicker due to\n//selfshadowing and 1 = dot(Normal, Light) using a min bias\nshadowBias = clamp(shadowBias, 0.00005,  2.0*bias);\n\n// shadowZ must be clamped to [0,1]\n// otherwise it's not comparable to\n// shadow caster depth map\n// which is clamped to [0,1]\n// Not doing that makes ALL shadowReceiver > 1.0 black\n// because they ALL becomes behind any point in Caster depth map\nshadowReceiverZ = clamp(shadowReceiverZ, 0., 1. - shadowBias);\n\nshadowReceiverZ -= shadowBias;\n\n// Now computes Shadow\n\nshadow = getShadowPCF(tex, shadowTextureSize, shadowUV, shadowReceiverZ, shadowBiasPCF, clampDimension);\n\n}\n\nreturn shadow;\n"
}
, function(t, e) {
    t.exports = '\n#pragma include "shadowLinearSoft.glsl"\n\nfloat getShadowPCF(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare, const in vec2 biasPCF, const in vec4 clampDimension)\n{\n\n     float res = 0.0;\n     res += texture2DShadowLerp(depths, size,   uv + biasPCF, compare, clampDimension);\n\n#if defined(_PCFx1)\n\n#else\n\n    float dx0 = -size.z;\n    float dy0 = -size.w;\n    float dx1 = size.z;\n    float dy1 = size.w;\n\n#define TSF(o1,o2) texture2DShadowLerp(depths, size, uv + vec2(o1, o2) + biasPCF,  compare, clampDimension)\n\n    res += TSF(dx0, dx0);\n    res += TSF(dx0, .0);\n    res += TSF(dx0, dx1);\n\n#if defined(_PCFx4)\n\n    res /=4.0;\n\n#elif defined(_PCFx9)\n    res += TSF(.0, dx0);\n    res += TSF(.0, dx1);\n\n    res += TSF(dx1, dx0);\n    res += TSF(dx1, .0);\n    res += TSF(dx1, dx1);\n\n\n    res /=9.0;\n\n#elif defined(_PCFx25)\n\n    float dx02 = -2.0*size.z;\n    float dy02 = -2.0*size.w;\n    float dx2 = 2.0*size.z;\n    float dy2 = 2.0*size.w;\n\n    // complete row above\n    res += TSF(dx0, dx02);\n    res += TSF(dx0, dx2);\n\n    res += TSF(.0, dx02);\n    res += TSF(.0, dx2);\n\n    res += TSF(dx1, dx02);\n    res += TSF(dx1, dx2);\n\n    // two new col\n    res += TSF(dx02, dx02);\n    res += TSF(dx02, dx0);\n    res += TSF(dx02, .0);\n    res += TSF(dx02, dx1);\n    res += TSF(dx02, dx2);\n\n    res += TSF(dx2, dx02);\n    res += TSF(dx2, dx0);\n    res += TSF(dx2, .0);\n    res += TSF(dx2, dx1);\n    res += TSF(dx2, dx2);\n\n\n    res/=25.0;\n\n#endif\n\n#undef TSF\n\n#endif\n    return res;\n}\n/////// end Tap\n'
}
, function(t, e) {
    t.exports = 'varying vec3 vLocalVertex;\n\n// common stuffs\nuniform int uOutputLinear;\nuniform float uRGBMRange;\n\nuniform samplerCube uTexture0;\nuniform float uEnvironmentExposure;\nuniform float uBackgroundExposure;\nuniform float uSize;\n\n#pragma include "functions.glsl"\n#pragma include "sketchfabTextures.glsl"\n\nvoid main(void) {\n\n  vec3 color = textureCubeFixed( uTexture0, normalize( vLocalVertex.xyz ), uSize ) * uEnvironmentExposure * uBackgroundExposure;\n\n  if( uOutputLinear == 0 )\n    color = linearTosRGB(color);\n\n  gl_FragColor = encodeRGBM(color, uRGBMRange);\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\n\nuniform vec4 uHalton;\nuniform vec2 RenderSize;\n\nvarying vec3 vLocalVertex;\n\nvoid main(void)\n{\n    vLocalVertex = Vertex.rgb;\n\n    mat4 projectionMatrix = uProjectionMatrix;\n    vec2 halt = (abs(uHalton.z) == 2.0 ? 1.0 : 0.0) * (uHalton.xy / RenderSize);\n    projectionMatrix[2][0] += halt.x;\n    projectionMatrix[2][1] += halt.y;\n\n    gl_Position = (projectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0))).xyww;\n}\n"
}
, function(t, e) {
    t.exports = "varying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureHotspot;\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\nuniform vec3 uColor;\n\nconst float BIAS_VISIBILITY = 0.05;\n\nvoid main(void) {\n  float fragDepth = clamp((-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x), 0.0, 1.0);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize).rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n  float alpha = (fragDepth - BIAS_VISIBILITY < depth) ? 1.0 : 0.1;\n\n  gl_FragColor = vec4(uColor, 1.0) * texture2D(uTextureHotspot, vTexCoord0);\n  gl_FragColor.a *= alpha;\n\n  gl_FragColor.rgb *= gl_FragColor.a;\n}\n"
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform float uHotspotIndex;\n\n// icon size 48 pixel width and 2 pixel padding between them\nconst vec2 ICON_SIZE = 48.0 / vec2(512.0, -256.0);\nconst vec2 ICON_AND_PADDING = ICON_SIZE + 2.0 / vec2(512.0, -256.0);\n\nvoid main(void) {\n  vec2 offset = vec2(mod(uHotspotIndex, 10.0), floor(uHotspotIndex / 10.0));\n  vTexCoord0 = vec2(TexCoord0.x, 1.0 - TexCoord0.y) * ICON_SIZE + offset * ICON_AND_PADDING;\n\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = uProjectionMatrix * vViewPos;\n}\n"
}
, function(t, e) {
    t.exports = 'uniform vec4 uLineColor;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n    vec4 color = sRGBToLinear(uLineColor);\n    color.rgb *= color.a;\n    gl_FragColor = linearTosRGB(color);\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"
}
, function(t, e) {
    t.exports = "uniform sampler2D uTexture0;\nuniform sampler2D uTexture1;\nuniform sampler2D uTexture2;\nuniform sampler2D uTexture3;\n\n// vec4 (up to 4 textures input)\n// int meaning :\n// 0 -> read R\n// 1 -> read A\n// 2 -> read RGB\nuniform ivec4 uReadPacking;\n\nvarying vec2 vTexCoord0;\n\nvoid main(void) {\n    // check if we are in a 2 or 4 texture packing pattern\n    if ( uReadPacking.x == 2 ) {\n        gl_FragColor.rgb = texture2D( uTexture0, vTexCoord0 ).rgb;\n        gl_FragColor.a = uReadPacking.y == 0 ? texture2D( uTexture1, vTexCoord0 ).r : texture2D( uTexture1, vTexCoord0 ).a;\n    } else {\n        gl_FragColor.r = uReadPacking.x == 0 ? texture2D( uTexture0, vTexCoord0 ).r : texture2D( uTexture0, vTexCoord0 ).a;\n        gl_FragColor.g = uReadPacking.y == 0 ? texture2D( uTexture1, vTexCoord0 ).r : texture2D( uTexture1, vTexCoord0 ).a;\n        gl_FragColor.b = uReadPacking.z == 0 ? texture2D( uTexture2, vTexCoord0 ).r : texture2D( uTexture2, vTexCoord0 ).a;\n        gl_FragColor.a = uReadPacking.w == 0 ? texture2D( uTexture3, vTexCoord0 ).r : texture2D( uTexture3, vTexCoord0 ).a;\n    }\n}"
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\nvarying vec2 vTexCoord0;\n\nvoid main(void) {\n    gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);\n    vTexCoord0 = Vertex.xy;\n}\n"
}
, function(t, e) {
    t.exports = "uniform vec4 uColor;\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vec4( vec3(vColor) * uColor.a, uColor.a);\n}\n"
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\nattribute vec4 Color;\nvarying vec4 vColor;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n    vColor = Color;\n    gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);\n}\n"
}
, function(t, e) {
    t.exports = "uniform vec4 uColor;\n\nvoid main(void) {\n  gl_FragColor = vec4(uColor.xyz * uColor.a, uColor.a);\n}\n"
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);\n}\n"
}
, function(t, e) {
    t.exports = "// has to be before anything else, just after glsl language version\r\n// it's require. enable just allow\r\nvec3 textureCubemapLod(const in samplerCube texture, const in vec3 dir, const in float lod ) {\r\n    vec4 rgba = textureCubeLodEXT( texture, dir, lod );\r\n#ifdef FLOAT\r\n    return rgba.rgb;\r\n#endif\r\n#ifdef RGBM\r\n    return RGBMToRGB( rgba );\r\n#endif\r\n#ifdef LUV\r\n    return LUVToRGB( rgba );\r\n#endif\r\n}\r\n\r\nvec3 textureCubeLodEXTFixed(const in samplerCube texture, const in vec2 size, const in vec3 direction, const in float lodInput, const in float maxLod ) {\r\n    vec3 dir = direction;\r\n    float lod = min( maxLod, lodInput );\r\n\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float scale = 1.0 - exp2(lod) / size.x;\r\n    vec3 absDir = abs(dir);\r\n    float M = max(max(absDir.x, absDir.y), absDir.z);\r\n\r\n    if (absDir.x != M) dir.x *= scale;\r\n    if (absDir.y != M) dir.y *= scale;\r\n    if (absDir.z != M) dir.z *= scale;\r\n\r\n    return textureCubemapLod( texture, dir, lod );\r\n}\r\n\r\nvec3 prefilterEnvMapCube( const in float rLinear, const in vec3 R, const in samplerCube tex, const in vec2 lodRange, const in vec2 size ){\r\n    float lod = linRoughnessToMipmap(rLinear) * lodRange[1]; //( uEnvironmentMaxLod - 1.0 );\r\n    return textureCubeLodEXTFixed( tex, size, R, lod, lodRange[0] );\r\n}\r\n"
}
, function(t, e) {
    t.exports = '#pragma include "lights.glsl"\n\nvec3 computeEnvLightShading(\n                            const in vec3 normal,\n                            const in vec3 materialDiffuse,\n                           \n                            const in vec3 lightDiffuse,\n                            const in vec4 lightPosition,\n                            const in mat4 lightMatrix,\n\n                            out vec3 eyeLightDir,\n                            out bool lighted)\n{\n\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    float NdotL = dot(eyeLightDir, normal);\n    lighted = NdotL > 0.0;\n    if (!lighted) NdotL = 0.0;    \n    vec3 diffuseContrib;\n    lambert(1.0, materialDiffuse, lightDiffuse, diffuseContrib);\n    return diffuseContrib;\n}\n'
}
, function(t, e) {
    t.exports = "\nvec3 computeEnvLightShading(\n                            const in vec3 normal,\n                            const in vec3 albedo,\n\n                            const in vec4 lightColor,\n                            const in vec4 lightPosition,\n\n                            const in mat4 lightMatrix,\n\n                            out vec3 eyeLightDir,\n                            out bool lighted)\n{\n    \n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    float NdotL = dot (eyeLightDir, normal);    \n    lighted =  NdotL > 0.0;   \n    return lightColor.xyz * albedo;\n    \n}\n"
}
, function(t, e) {
    t.exports = "\r\n// math.glsl\r\n#define PI 3.141593\r\n#define HALF_PI 1.570796\r\n#define EPS .0000001\r\n\r\n// dxtogl.glsl ?\r\n#define saturate(_x) clamp(_x, 0., 1.)\r\n#define atan2(_x, _y) atan(_x, _y)\r\n#define frac(_x) fract(_x)\r\n#define lerp(_x, _y, _t) mix(_x, _y, _t)\r\n\r\n// light_common.glsl\r\n// ATTENUATION\r\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation)\r\n{\r\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\r\n    // TODO find a vector alu instead of 4 scalar\r\n    float constant = lightAttenuation.x;\r\n    float linear = lightAttenuation.y*dist;\r\n    float quadratic = lightAttenuation.z*dist*dist;\r\n    return 1.0 / ( constant + linear + quadratic );\r\n}\r\n\r\n// light PBR glsl\r\n#define G1V(dotNV, k) (1./(dotNV*(1.-k)+k))\r\n\r\nvec4 LightingFuncPrep(const in vec3 N,\r\n                      const in vec3 V,\r\n                      const in float roughness)\r\n{\r\n\r\n    float dotNV = saturate(dot(N,V));\r\n    float alpha = roughness * roughness;\r\n    float k = alpha * .5;\r\n    float visNV = G1V(dotNV,k);\r\n\r\n    vec4 prepSpec;\r\n\r\n    prepSpec.x = alpha;\r\n    prepSpec.y = alpha * alpha;\r\n    prepSpec.z = k;\r\n    prepSpec.w = visNV;\r\n\r\n    return prepSpec;\r\n\r\n}\r\n\r\nvec3 LightingFuncUsePrepGGX(const vec4 prepSpec,\r\n                            const vec3 N,\r\n                            const vec3 V,\r\n                            const vec3 L,\r\n                            const vec3 F0,\r\n                            const float dotNL)\r\n{\r\n\r\n    vec3 H = normalize(V+L);\r\n    float dotNH = saturate(dot(N,H));\r\n    // D\r\n    float alphaSqr = prepSpec.y;\r\n    float denom = dotNH * dotNH *(alphaSqr-1.) + 1.;\r\n    float D = alphaSqr / (PI * denom * denom);\r\n    // F\r\n    float dotLH = saturate(dot(L,H));\r\n    float dotLH5 = pow(1.-dotLH,5.);\r\n    vec3 F = vec3(F0) + (vec3(1.)-F0)*(dotLH5);\r\n    // V\r\n    float visNL = G1V(dotNL, prepSpec.z);\r\n    vec3 specular = D * F * visNL * prepSpec.w;\r\n    return specular;\r\n}\r\n\r\n// pure compute Light PBR\r\nvec3 computeLight(const in vec3 lightColor,\r\n                  const in vec3 albedoColor,\r\n                  const in vec3 normal,\r\n                  const in vec3 viewDir,\r\n                  const in vec3 lightDir,\r\n                  const in vec3 specular,\r\n                  const in vec4 prepSpec,\r\n                  const in float dotNL)\r\n{\r\n    vec3 cSpec = LightingFuncUsePrepGGX(prepSpec, normal, viewDir, lightDir, specular, dotNL);\r\n    return lightColor *  dotNL*(albedoColor + cSpec);\r\n}\r\n\r\n// STANDARD call for each light\r\n//direction, dist, NDL, attenuation, compute diffuse, compute specular\r\nvec3 computeSpotLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n\r\n    const in vec3  lightSpotDirection,\r\n    const in vec4  lightAttenuation,\r\n    const in vec4  lightSpotPosition,\r\n    const in float lightCosSpotCutoff,\r\n    const in float lightSpotBlend,\r\n\r\n    const in mat4 lightMatrix,\r\n    const in mat4 lightInvMatrix,\r\n\r\n    out vec3 eyeLightPos,\r\n    out vec3 eyeLightDir,\r\n    out bool lighted)\r\n{\r\n    lighted = false;\r\n    eyeLightPos = vec3(lightMatrix * lightSpotPosition);\r\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\r\n    // compute dist\r\n    float dist = length(eyeLightDir);\r\n    // compute attenuation\r\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    if (attenuation != 0.0)\r\n    {\r\n        // compute direction\r\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n        if (lightCosSpotCutoff > 0.0)\r\n        {\r\n            //compute lightSpotBlend\r\n            vec3 lightSpotDirectionEye = normalize(mat3(vec3(lightInvMatrix[0]), vec3(lightInvMatrix[1]), vec3(lightInvMatrix[2]))*lightSpotDirection);\r\n\r\n            float cosCurAngle = dot(-eyeLightDir, lightSpotDirectionEye);\r\n            float diffAngle = cosCurAngle - lightCosSpotCutoff;\r\n            float spot = 1.0;\r\n            if ( diffAngle < 0.0 ) {\r\n                spot = 0.0;\r\n            } else {\r\n                if ( lightSpotBlend > 0.0 )\r\n                    spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightCosSpotCutoff) / (lightSpotBlend));\r\n            }\r\n\r\n            if (spot > 0.0)\r\n            {\r\n                // compute NdL\r\n                float NdotL = dot(eyeLightDir, normal);\r\n                if (NdotL > 0.0)\r\n                {\r\n                    lighted = true;\r\n                    return spot * attenuation *computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir, specular, prepSpec,  NdotL);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computePointLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n\r\n    const in vec4 lightPosition,\r\n    const in vec4 lightAttenuation,\r\n\r\n    const in mat4 lightMatrix,\r\n\r\n    out vec3 eyeLightPos,\r\n    out vec3 eyeLightDir,\r\n    out bool lighted)\r\n{\r\n\r\n    eyeLightPos =  vec3(lightMatrix * lightPosition);\r\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\r\n    float dist = length(eyeLightDir);\r\n    // compute dist\r\n    // compute attenuation\r\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    if (attenuation != 0.0)\r\n    {\r\n        // compute direction\r\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n        // compute NdL\r\n        float NdotL = dot(eyeLightDir, normal);\r\n        if (NdotL > 0.0)\r\n        {\r\n            lighted = true;\r\n            return  attenuation * computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir,  specular, prepSpec,  NdotL);\r\n        }\r\n    }\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computeSunLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n\r\n    const in vec4 lightPosition,\r\n\r\n    const in mat4 lightMatrix,\r\n\r\n    out vec3 eyeLightDir,\r\n    out bool lighted)\r\n{\r\n\r\n    lighted = false;\r\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\r\n    // compute NdL\r\n    float NdotL = dot(eyeLightDir, normal);\r\n    if (NdotL > 0.0)\r\n    {\r\n        lighted = true;\r\n        return computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir, specular, prepSpec,  NdotL);\r\n    }\r\n    return vec3(0.0);\r\n}\r\n"
}
, function(t, e) {
    t.exports = "vec2 computeUVForMipmap( const in float level, const in vec2 uv, const in float size, const in float maxLOD ) {\r\n\r\n    // width for level\r\n    float widthForLevel = exp2( maxLOD-level);\r\n\r\n    // the height locally for the level in pixel\r\n    // to opimitize a bit we scale down the v by two in the inputs uv\r\n    float heightForLevel = widthForLevel * 0.5;\r\n\r\n\r\n    // compact version\r\n    float texelSize = 1.0/size;\r\n    vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, heightForLevel - 2.0);\r\n    uvSpaceLocal.y += size - widthForLevel;\r\n    return uvSpaceLocal * texelSize;\r\n}\r\n\r\n//for y up\r\nvec2 normalToPanoramaUVY( const in vec3 dir ) {\r\n    float n = length(dir.xz);\r\n\r\n    // to avoid bleeding the max(-1.0,dir.x / n) is needed\r\n    vec2 pos = vec2( (n>0.0000001) ? max(-1.0,dir.x / n) : 0.0, dir.y);\r\n\r\n    // fix edge bleeding\r\n    if ( pos.x > 0.0 ) pos.x = min( 0.999999, pos.x );\r\n\r\n    pos = acos(pos) * 0.3183098861837907; // inv_pi\r\n\r\n    pos.x = (dir.z > 0.0) ? pos.x*0.5 : 1.0-(pos.x*0.5);\r\n\r\n    // shift u to center the panorama to -z\r\n    pos.x = mod(pos.x-0.25+1.0, 1.0 );\r\n    pos.y = 1.0-pos.y;\r\n    return pos;\r\n}\r\n\r\nvec3 texturePanorama(const in sampler2D tex, const in vec2 uv) {\r\n    vec4 rgba = texture2D(tex, uv );\r\n#ifdef FLOAT\r\n    return rgba.rgb;\r\n#endif\r\n#ifdef RGBM\r\n    return RGBMToRGB( rgba );\r\n#endif\r\n#ifdef LUV\r\n    return LUVToRGB( rgba );\r\n#endif\r\n}\r\n\r\nvec3 texturePanoramaLod(const in sampler2D tex, const in vec2 size, const in vec3 direction, const in float lodInput, const in float maxLOD ) {\r\n    float lod = min( maxLOD, lodInput );\r\n    vec2 uvBase = normalToPanoramaUVY( direction );\r\n\r\n    // // we scale down v here because it avoid to do twice in sub functions\r\n    // uvBase.y *= 0.5;\r\n\r\n    float lod0 = floor(lod);\r\n    vec2 uv0 = computeUVForMipmap(lod0, uvBase, size.x, maxLOD );\r\n    vec3 texel0 = texturePanorama( tex, uv0.xy);\r\n\r\n    float lod1 = ceil(lod);\r\n    vec2 uv1 = computeUVForMipmap(lod1, uvBase, size.x, maxLOD );\r\n    vec3 texel1 = texturePanorama( tex, uv1.xy);\r\n\r\n    return mix(texel0, texel1, fract( lod ) );\r\n}\r\n\r\nvec3 prefilterEnvMapPanorama( const in float rLinear, const in vec3 R, const in sampler2D tex, const in vec2 lodRange, const in vec2 size ){\r\n    return texturePanoramaLod( tex, size, R, linRoughnessToMipmap(rLinear) * lodRange[1], lodRange[0] );\r\n}\r\n"
}
, function(t, e) {
    t.exports = '#pragma include "functions.glsl"\r\n#define LUV\r\n\r\nfloat specularOcclusion(const in int occlude, const in float ao, const in vec3 N, const in vec3 V) {\r\n    if(occlude == 0)\r\n        return 1.0;\r\n    // Yoshiharu Gotanda\'s specular occlusion approximation:\r\n    // cf http://research.tri-ace.com/Data/cedec2011_RealtimePBR_Implementation_e.pptx pg59\r\n    float d = dot( N, V ) + ao;\r\n    return clamp((d * d) - 1.0 + ao, 0.0, 1.0);\r\n}\r\n\r\nfloat adjustRoughnessNormalMap( const in float roughness, const in vec3 normal ) {\r\n    // Based on The Order : 1886 SIGGRAPH course notes implementation (page 21 notes)\r\n    float normalLen = length(normal);\r\n    if ( normalLen < 1.0) {\r\n        float normalLen2 = normalLen * normalLen;\r\n        float kappa = ( 3.0 * normalLen -  normalLen2 * normalLen )/( 1.0 - normalLen2 );\r\n        // http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/\r\n        // page 91 : they use 0.5/kappa instead\r\n        return min(1.0, sqrt( roughness * roughness + 1.0/kappa ));\r\n    }\r\n    return roughness;\r\n}\r\n\r\nfloat adjustRoughnessGeometry( const in float roughness, const in vec3 normal ) {\r\n    // Geometric Specular Aliasing (slide 43)\r\n    // http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf\r\n// #ifdef GL_OES_standard_derivatives\r\n//     vec3 vDx = dFdx( normal.xyz );\r\n//     vec3 vDy = dFdy( normal.xyz );\r\n//     return max(roughness, pow( clamp( max( dot( vDx, vDx ), dot( vDy, vDy ) ), 0.0, 1.0 ), 0.333 ));\r\n// #else\r\n    return roughness;\r\n// #endif\r\n}\r\n\r\nmat3 environmentTransformPBR( const in mat4 tr ) {\r\n    // TODO trick from animation matrix transpose?\r\n    vec3 x = vec3(tr[0][0], tr[1][0], tr[2][0]);\r\n    vec3 y = vec3(tr[0][1], tr[1][1], tr[2][1]);\r\n    vec3 z = vec3(tr[0][2], tr[1][2], tr[2][2]);\r\n    mat3 m = mat3(x, y, z);\r\n    return m;\r\n}\r\n\r\nvec3 evaluateDiffuseSphericalHarmonics( const in vec3 s[9], const in mat3 envTrans, const in vec3 N ) {\r\n    vec3 n = envTrans * N;\r\n    // https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\r\n    vec3 result = (s[0]+s[1]*n.y+s[2]*n.z+s[3]*n.x+s[4]*n.y*n.x+s[5]*n.y*n.z+s[6]*(3.0*n.z*n.z-1.0)+s[7]*(n.z*n.x)+s[8]*(n.x*n.x-n.y*n.y));\r\n    return max(result, vec3(0.0));\r\n}\r\n\r\n// Frostbite, Lagarde paper p67\r\n// http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf\r\nfloat linRoughnessToMipmap( const in float roughnessLinear ) {\r\n    return sqrt(roughnessLinear);\r\n}\r\n\r\nvec3 integrateBRDF( const in vec3 specular, const in float r, const in float NoV, const in sampler2D tex ) {\r\n    vec4 rgba = texture2D( tex, vec2(NoV, r) );\r\n    float b = (rgba[3] * 65280.0 + rgba[2] * 255.0);\r\n    float a = (rgba[1] * 65280.0 + rgba[0] * 255.0);\r\n    const float div = 1.0/65535.0;\r\n    return (specular * a + b) * div;\r\n}\r\n\r\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\r\n// TODO should we use somehow specular f0 ?\r\nvec3 integrateBRDFApprox( const in vec3 specular, const in float roughness, const in float NoV ) {\r\n    const vec4 c0 = vec4( -1, -0.0275, -0.572, 0.022 );\r\n    const vec4 c1 = vec4( 1, 0.0425, 1.04, -0.04 );\r\n    vec4 r = roughness * c0 + c1;\r\n    float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\r\n    vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\r\n    return specular * AB.x + AB.y;\r\n}\r\n\r\nvec3 computeIBLDiffuseUE4( const in vec3 normal, const in vec3 albedo, const in mat3 envTrans, const in vec3 sphHarm[9] ) {\r\n    return albedo * evaluateDiffuseSphericalHarmonics( sphHarm, envTrans, normal ) ;\r\n}\r\n\r\n// basically whether it\'s panorama or cubemap we load the adequate glsl\r\n// and we set samplerEnv and prefilterEnvMap\r\n#ifdef CUBEMAP\r\n#pragma include "cubemapSampler.glsl" "CUBEMAP"\r\n#define samplerEnv samplerCube\r\n#define prefilterEnvMap prefilterEnvMapCube\r\n\r\n#else\r\n#ifdef PANORAMA\r\n#pragma include "panoramaSampler.glsl" "PANORAMA"\r\n#define samplerEnv sampler2D\r\n#define prefilterEnvMap prefilterEnvMapPanorama\r\n\r\n#else\r\n// in case there is no environment node ?\r\nvec3 prefilterEnvMap( const in float rLinear, const in vec3 R, const in sampler2D tex, const in vec2 lodRange, const in vec2 size ) {\r\n    return vec3(0.0);\r\n}\r\n#define samplerEnv sampler2D\r\n#endif // PANORAMA\r\n\r\n#endif // CUBEMAP\r\n\r\nvec3 getSpecularDominantDir( const in vec3 N, const in vec3 R, const in float realRoughness ) {\r\n    float smoothness = 1.0 - realRoughness;\r\n    float lerpFactor = smoothness * ( sqrt( smoothness ) + realRoughness );\r\n    // The result is not normalized as we fetch in a cubemap\r\n    return mix( N, R, lerpFactor );\r\n}\r\n\r\n// samplerEnv and prefilterEnvMap are both defined above (cubemap or panorama)\r\nvec3 computeIBLSpecularUE4(\r\n    const in vec3 N,\r\n    const in vec3 V,\r\n    const in float rLinear,\r\n    const in vec3 specular,\r\n    const in mat3 envTrans,\r\n    const in samplerEnv texEnv,\r\n    const in vec2 lodRange,\r\n    const in vec2 size,\r\n    const in vec3 frontNormal\r\n    #ifdef MOBILE\r\n    ){\r\n    #else\r\n    ,const in sampler2D texBRDF ) {\r\n    #endif\r\n\r\n    float rough = max( rLinear, 0.0);\r\n\r\n    float NoV = dot( N, V );\r\n    vec3 R = normalize( NoV * 2.0 * N - V);\r\n    R = getSpecularDominantDir(N, R, rLinear);\r\n    // could use that, especially if NoV comes from shared preCompSpec\r\n    //vec3 R = reflect(-V, N);\r\n\r\n    vec3 prefilteredColor = prefilterEnvMap( rough, envTrans * R, texEnv, lodRange, size );\r\n    // http://marmosetco.tumblr.com/post/81245981087\r\n    // marmoset uses 1.3, we force it to 1.0\r\n    float factor = clamp( 1.0 + dot(R, frontNormal), 0.0, 1.0 );\r\n    prefilteredColor *= factor * factor;\r\n    #ifdef MOBILE\r\n    return prefilteredColor * integrateBRDFApprox( specular, rough, NoV );\r\n    #else\r\n    return prefilteredColor * integrateBRDF( specular, rough, NoV, texBRDF );\r\n    #endif\r\n}\r\n'
}
, function(t, e) {
    t.exports = "float adjustSpecular( const in float specular, const in vec3 normal ) {\n    // Based on The Order : 1886 SIGGRAPH course notes implementation (page 21 notes)\n    float normalLen = length(normal);\n    if ( normalLen < 1.0) {\n        float normalLen2 = normalLen * normalLen;\n        float kappa = ( 3.0 * normalLen -  normalLen2 * normalLen )/( 1.0 - normalLen2 );\n        // http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/\n        // page 91 : they use 0.5/kappa instead\n        return 1.0-min(1.0, sqrt( (1.0-specular) * (1.0-specular) + 1.0/kappa ));\n    }\n    return specular;\n}\n\nvec3 mtexNspaceTangent(const in vec4 tangent, const in vec3 normal, const in vec3 texnormal) {\n    vec3 tang = vec3(0.0,1.0,0.0);\n    float l = length(tangent.xyz);\n    if (l != 0.0) {\n        //normalize reusing length computations\n        // tang =  normalize(tangent.xyz);\n        tang =  tangent.xyz / l;\n    }\n    vec3 B = tangent.w * normalize(cross(normal, tang));\n    return normalize( texnormal.x*tang + texnormal.y*B + texnormal.z*normal);\n}\n\nvec2 normalMatcap(const in vec3 normal, const in vec3 nm_z) {\n    vec3 nm_x = vec3(-nm_z.z, 0.0, nm_z.x);\n    vec3 nm_y = cross(nm_x, nm_z);\n    return vec2(dot(normal.xz, nm_x.xz), dot(normal, nm_y)) * vec2(0.5)  + vec2(0.5) ; //MADD vector form\n}\n\nvec3 rgbToNormal(const in vec3 texel, const in int flipNormalY) {\n    vec3 rgb = texel * vec3(2.0) + vec3(-1.0); // MADD vec form\n    rgb[1] = flipNormalY == 1 ? -rgb[1] : rgb[1];\n    return rgb;\n}\n\nvec3 bumpMap(const in vec4 tangent, const in vec3 normal, const in vec2 gradient) {\n    vec3 outnormal;\n    float l = length(tangent.xyz);\n    if (l != 0.0) {\n        //normalize reusing length computations\n        // vec3 tang =  normalize(tangent.xyz);\n        vec3 tang =  tangent.xyz / l;\n        vec3 binormal = tangent.w * normalize(cross(normal, tang));\n        outnormal = normal + gradient.x * tang + gradient.y * binormal;\n    }\n    else {\n       outnormal = vec3(normal.x + gradient.x, normal.y + gradient.y, normal.z);\n    }\n    return normalize(outnormal);\n}\n"
}
, function(t, e) {
    t.exports = '#pragma include "functions.glsl"\n\nvec3 cubemapSeamlessFixDirection(const in vec3 direction, const in float size ) {\n    vec3 dir = direction;\n    float scale = 1.0 - 1.0 / size;\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\n    vec3 absDir = abs(dir);\n    float M = max(max(absDir.x, absDir.y), absDir.z);\n\n    if (absDir.x != M) dir.x *= scale;\n    if (absDir.y != M) dir.y *= scale;\n    if (absDir.z != M) dir.z *= scale;\n\n    return dir;\n}\n\n// seamless cubemap for background ( no lod )\nvec3 textureCubeFixed(const in samplerCube tex, const in vec3 direction, const in float scale ) {\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\n    vec3 dir = cubemapSeamlessFixDirection( direction, scale);\n    return LUVToRGB( textureCube( tex, dir ) );\n}\n\nvec3 textureEnvironmentCube( const in samplerCube tex, const in mat3 envTrans, const in vec3 N, const in vec3 V, const in vec2 size ){\n    vec3 R = normalize( (2.0 * clamp( dot( N, V ), 0.0, 1.0 ) ) * N - V);\n    return textureCubeFixed( tex, envTrans * R, size[0] );\n}\n\n#ifndef TEX_BUMP\n#define TEX_BUMP(tex, uv) 1.0\n#endif\n\n// Todo use #idfef and derivatives (dDFx, dDFy, fwidth) extension ?\n// float valuetexture2D(tex, uv);\n// return vec2(dFdx(value), dFdy(value));\nvec2 textureGradient(in sampler2D tex, const in vec2 uv, const in vec2 size) {\n    vec2 step = 1.0 / size;\n    float dx = TEX_BUMP(tex, uv - vec2(step.x, 0.0)) - TEX_BUMP(tex, uv + vec2(step.x, 0.0));\n    float dy = TEX_BUMP(tex, uv - vec2(0.0, step.y)) - TEX_BUMP(tex, uv + vec2(0.0, step.y));\n    return vec2(dx, dy);\n}\n'
}
, function(t, e) {
    t.exports = '\n#pragma include "functions.glsl"\n\n// G3D version of FXAA\n// green (y) as luma\n// Quality 12\nvec3 fxaa(const in sampler2D tex, const in vec2 pos, const in vec2 texSize) {\n\n    vec2 fxaaQualityRcpFrame = 1.0 / texSize.xy;\n    float fxaaQualitySubpix = 0.75;\n    float fxaaQualityEdgeThreshold = 0.125;\n    float fxaaQualityEdgeThresholdMin = 0.0625;\n\n    vec2 posM = pos.xy;\n    vec4 rgbyM = texture2D(tex, posM);\n    float lumaM = rgbyM.y;\n\n    // Swizzler Offseter Util\n    vec4 sw = vec4(-1.0, 1.0, 1.0, -1.0) * fxaaQualityRcpFrame.xxyy;\n\n    float lumaS = texture2D(tex, posM + vec2(0.0, sw.z)).y;\n    float lumaE = texture2D(tex, posM + vec2(sw.y, 0.0)).y;\n    float lumaN = texture2D(tex, posM + vec2(0.0, sw.w)).y;\n    float lumaW = texture2D(tex, posM + vec2(sw.x, 0.0)).y;\n\n    float maxSM = max(lumaS, lumaM);\n    float minSM = min(lumaS, lumaM);\n\n    float maxESM = max(lumaE, maxSM);\n    float minESM = min(lumaE, minSM);\n\n    float maxWN = max(lumaN, lumaW);\n    float minWN = min(lumaN, lumaW);\n\n    float rangeMax = max(maxWN, maxESM);\n    float rangeMin = min(minWN, minESM);\n\n    float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    float range = rangeMax - rangeMin;\n    float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\n    bool earlyExit = range < rangeMaxClamped;\n    if(earlyExit)\n        return rgbyM.rgb;\n\n    float lumaNW = texture2D(tex, posM + sw.xw).y;\n    float lumaSE = texture2D(tex, posM + sw.yz).y;\n    float lumaNE = texture2D(tex, posM + sw.yw).y;\n    float lumaSW = texture2D(tex, posM + sw.xy).y;\n\n    float lumaNS = lumaN + lumaS;\n    float lumaWE = lumaW + lumaE;\n    float subpixRcpRange = 1.0/range;\n    float subpixNSWE = lumaNS + lumaWE;\n    float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    float edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\n    float lumaNESE = lumaNE + lumaSE;\n    float lumaNWNE = lumaNW + lumaNE;\n    float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\n    float lumaNWSW = lumaNW + lumaSW;\n    float lumaSWSE = lumaSW + lumaSE;\n    float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    float edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    float edgeVert = abs(edgeVert3) + edgeVert4;\n\n    float subpixNWSWNESE = lumaNWSW + lumaNESE;\n    float lengthSign = fxaaQualityRcpFrame.x;\n    bool horzSpan = edgeHorz >= edgeVert;\n    float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    float subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\n    float gradientN = lumaN - lumaM;\n    float gradientS = lumaS - lumaM;\n    float lumaNN = lumaN + lumaM;\n    float lumaSS = lumaS + lumaM;\n    bool pairN = abs(gradientN) >= abs(gradientS);\n    float gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\n\n    vec2 posB = posM.xy;\n    vec2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n\n    vec2 posN;\n    posN.x = posB.x - offNP.x;\n    posN.y = posB.y - offNP.y;\n    vec2 posP;\n    posP.x = posB.x + offNP.x;\n    posP.y = posB.y + offNP.y;\n    float subpixD = ((-2.0)*subpixC) + 3.0;\n    float lumaEndN = texture2D(tex, posN).y;\n    float subpixE = subpixC * subpixC;\n    float lumaEndP = texture2D(tex, posP).y;\n\n    if(!pairN) lumaNN = lumaSS;\n    float gradientScaled = gradient * 1.0/4.0;\n    float lumaMM = lumaM - lumaNN * 0.5;\n    float subpixF = subpixD * subpixE;\n    bool lumaMLTZero = lumaMM < 0.0;\n\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    bool doneN = abs(lumaEndN) >= gradientScaled;\n    bool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * 1.5;\n    if(!doneN) posN.y -= offNP.y * 1.5;\n    bool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * 1.5;\n    if(!doneP) posP.y += offNP.y * 1.5;\n\n    if(doneNP) {\n        if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n        if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * 2.0;\n        if(!doneN) posN.y -= offNP.y * 2.0;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * 2.0;\n        if(!doneP) posP.y += offNP.y * 2.0;\n\n        if(doneNP) {\n            if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n            if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * 4.0;\n            if(!doneN) posN.y -= offNP.y * 4.0;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * 4.0;\n            if(!doneP) posP.y += offNP.y * 4.0;\n\n            if(doneNP) {\n                if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n                if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * 12.0;\n                if(!doneN) posN.y -= offNP.y * 12.0;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * 12.0;\n                if(!doneP) posP.y += offNP.y * 12.0;\n\n            }\n\n        }\n\n    }\n\n    float dstN = posM.x - posN.x;\n    float dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n\n    bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    float spanLength = (dstP + dstN);\n    bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    float spanLengthRcp = 1.0/spanLength;\n\n    bool directionN = dstN < dstP;\n    float dst = min(dstN, dstP);\n    bool goodSpan = directionN ? goodSpanN : goodSpanP;\n    float subpixG = subpixF * subpixF;\n    float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    float subpixH = subpixG * fxaaQualitySubpix;\n\n    float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\n    return texture2D(tex, posM).xyz;\n}\n\n// access a linear texture as if a nearest texture\nvec4 textureNearest2D(const in sampler2D tex, const in vec2 uv, const in vec2 texSize)\n{\n  return texture2D(tex, (floor(uv*texSize)+0.5) / texSize, -99999.0);\n}\n\n// static in place amortized supersampling\nvec3 supersample(const in vec3 currFragColor,  const in sampler2D tex, const in vec2 uv, const in vec2 texSize, const in vec4 halton)\n{\n    float haltz = abs(halton.z);\n    if ( haltz == 1.0 ){\n         // jut return the color.\n        return currFragColor.rgb;\n    }\n\n    // same pixel for same projected interpolated vertex on prev frame\n    vec3 accumColorN = textureNearest2D(tex, uv.xy, texSize).rgb;\n\n    // mix frames\n    float lerpFac = 1.0 / halton.w;\n\n    if ( haltz == 3.0 ){\n        // No supersample, crude motion blur by accumulation\n       return mix( currFragColor, accumColorN, lerpFac);\n    }\n\n    // Supsersample, accumulation + jittering\n    // http://en.wikipedia.org/wiki/Moving_average#Cumulative_moving_average\n    // cumulative moving average over frameNum (which starts at 2)\n    // n is previous frame\n    // accumColorN = Accum(n)\n    // return value is accumColor( n +1 )\n    // Accum(n+1) = Accum(n) + ((x(n+1) - Accum(n)) / (n + 1)))\n    // formula above is equal to glsl  mix\n    return mix(accumColorN, currFragColor, lerpFac);\n\n}\n'
}
, function(t, e) {
    t.exports = "// https://github.com/borismus/webvr-boilerplate/blob/master/src/distortion/barrel-distortion-fragment-v2.js\n\nvec2 barrel(const in vec2 v, const in vec4 projection, const in vec4 unprojection, const in vec2 distort) {\n  vec2 w = (v + unprojection.zw) / unprojection.xy;\n  float val = dot(w, w);\n  // float poly = (showCenter == 1 && val < 0.00010) ? 10000.0 : 1.0 + (distort.x + distort.y * val) * val;\n  float poly = 1.0 + (distort.x + distort.y * val) * val;\n  return projection.xy * (poly * w) - projection.zw;\n}\n\nvec2 distortion(const in vec2 texCoord, const in vec2 distort, const in vec4 projectionLeft, const in vec4 unprojectionLeft) {\n\n  if (abs(texCoord.x - 0.5) < .001) {\n    discard;\n  }\n\n  vec2 a;\n\n  if (texCoord.x < 0.5){\n    a = barrel(vec2(texCoord.x / 0.5, texCoord.y), projectionLeft, unprojectionLeft, distort);\n  } else {\n    // right projections are shifted and vertically mirrored relative to left\n    const vec3 swi = vec3(1.0, -1.0, 0.0);\n    vec4 projectionRight = (projectionLeft + swi.zzxz) * swi.xxyx;\n    vec4 unprojectionRight = (unprojectionLeft + swi.zzxz) * swi.xxyx;\n    a = barrel(vec2((texCoord.x - 0.5) / 0.5, texCoord.y), projectionRight, unprojectionRight, distort);\n  }\n\n  if (a.x < 0.0 || a.x > 1.0 || a.y < 0.0 || a.y > 1.0) {\n    discard;\n  } \n\n  return vec2(a.x * 0.5 + (texCoord.x < 0.5 ? 0.0 : 0.5), a.y);\n}"
}
, function(t, e) {
    t.exports = '#pragma include "functions.glsl"\n\nconst float MAX_BLUR = 16.0;\nconst float EPS_EARLY_OUT = 0.01; // early out (typically when we move the camera fast and the dof might be not effective)\n\nfloat texDepthToCoC(const in sampler2D texDepth, const in vec2 uv, const in vec4 dofBlurNearFarFocal) {\n    vec3 fetch = texture2D(texDepth, uv).rgb;\n    // background should be always max blurred so that the near blur can expand onto the background (because of special dilate background codepath below)\n    if(fetch.x == 1.0) return max(dofBlurNearFarFocal.x, dofBlurNearFarFocal.y);\n\n    float coc = dot(fetch.rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n    coc = clamp((coc - dofBlurNearFarFocal.z) / coc, -1.0, 1.0);\n    return (coc < 0.0 ? coc * dofBlurNearFarFocal.x : coc * dofBlurNearFarFocal.y);\n}\n\n// ------- DOWNSAMPLE COC ---------\nvec4 dofDownsampleCoC(const in sampler2D texDepth, const in vec2 uv, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    return vec4(vec3(0.0), texDepthToCoC(texDepth, uv, dofBlurNearFarFocal) * 0.5 + 0.5);\n}\n\n// ------- DOWNSAMPLE COLOR ---------\nvec4 dofDownsampleColor(const in sampler2D texColor, const in vec2 uv) {\n    return texture2D(texColor, uv);\n}\n\nvec4 dofDownsampleColor(const in sampler2D texColor, const in vec2 uv, const in sampler2D texCoC) {\n    return vec4(decodeRGBM(texture2D(texColor, uv), 7.0), texture2D(texCoC, uv).a);\n}\n\nfloat dilateNear(const in sampler2D texCoC, const in vec2 uv, const in vec2 offset, const in bool isBG) {\n    // TODO DOF both the weights and the formula can be tweaked, also we could add a bit of jitter or something\n\n    float coc = 0.0;\n    vec2 ofs = MAX_BLUR * offset / 5.0;\n\n    float coc0 = texture2D(texCoC, uv).a * 2.0 - 1.0;\n    float coc1 = texture2D(texCoC, uv - 5.0 * ofs).a * 2.0 - 1.0;\n    float coc2 = texture2D(texCoC, uv - 4.0 * ofs).a * 2.0 - 1.0;\n    float coc3 = texture2D(texCoC, uv - 3.0 * ofs).a * 2.0 - 1.0;\n    float coc4 = texture2D(texCoC, uv - 2.0 * ofs).a * 2.0 - 1.0;\n    float coc5 = texture2D(texCoC, uv - 1.0 * ofs).a * 2.0 - 1.0;\n    float coc6 = texture2D(texCoC, uv + 1.0 * ofs).a * 2.0 - 1.0;\n    float coc7 = texture2D(texCoC, uv + 2.0 * ofs).a * 2.0 - 1.0;\n    float coc8 = texture2D(texCoC, uv + 3.0 * ofs).a * 2.0 - 1.0;\n    float coc9 = texture2D(texCoC, uv + 4.0 * ofs).a * 2.0 - 1.0;\n    float coc10 = texture2D(texCoC, uv + 5.0 * ofs).a * 2.0 - 1.0;\n\n    if(isBG == true){\n        // avoid "shrink" effect on the out of focus far part on the model edges\n        // gaussian weights (sigma 10), (doesn\'t have to be gaussian though), but the sum must be 1.0\n        // http://dev.theomader.com/gaussian-kernel-calculator/\n        coc = abs(coc0) * 0.095474 +\n        (abs(coc1) + abs(coc10)) * 0.084264 +\n        (abs(coc2) + abs(coc9)) * 0.088139 +\n        (abs(coc3) + abs(coc8)) * 0.091276 +\n        (abs(coc4) + abs(coc7)) * 0.093585 +\n        (abs(coc5) + abs(coc6)) * 0.094998;\n    } else {\n        // blur only near field (expand)\n        coc = min(coc0, 0.0);\n        coc = min(coc1 * 0.3, coc);\n        coc = min(coc2 * 0.5, coc);\n        coc = min(coc3 * 0.75, coc);\n        coc = min(coc4 * 0.8, coc);\n        coc = min(coc5 * 0.95, coc);\n        coc = min(coc6 * 0.95, coc);\n        coc = min(coc7 * 0.8, coc);\n        coc = min(coc8 * 0.75, coc);\n        coc = min(coc9 * 0.5, coc);\n        coc = min(coc10 * 0.3, coc);\n        if(abs(coc0) > abs(coc))\n            coc = coc0;\n    }\n\n    return coc;\n}\n\n// ------- DILATE NEAR H ---------\nvec4 dofDilateNearH(const in sampler2D texCoC, const in sampler2D texDepth, const in vec2 uv, const in vec2 texSize,\n    const in float dofScale, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    vec2 offset = vec2( dofScale / texSize.x, 0.0);\n    float coc = dilateNear(texCoC, uv, offset, texture2D(texDepth, uv).x == 1.0);\n\n    return vec4(0.0, 0.0, 0.0, coc * 0.5 + 0.5);\n}\n\n// ------- DILATE NEAR V ---------\nvec4 dofDilateNearV(const in sampler2D texCoC, const in sampler2D texDepth,  const in vec2 uv, const in vec2 texSize,\n    const in float dofScale, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n    \n    vec2 offset = vec2(0.0, dofScale / texSize.y);\n    float coc = dilateNear(texCoC, uv, offset, texture2D(texDepth, uv).x == 1.0);\n\n    return vec4(0.0, 0.0, 0.0, coc * 0.5 + 0.5);\n}\n\nfloat nrand(const in vec3 uvt) {\n  vec3 p3 = fract(uvt * 443.8975);\n  p3 += dot(p3, p3.yzx + 19.19);\n  return fract((p3.x + p3.y) * p3.z);\n}\n\n#ifndef DOF_TAP\n#define DOF_TAP(id)  \n#endif\n\nvec4 dofBlur16(const in sampler2D texColor, const in sampler2D texCoC, const in vec2 uv, const in vec2 blurDist, const in float ntime) {\n    float rnd = 6.28318 * nrand(vec3(uv, 0.07 * fract(ntime)));\n    float cosa = cos(rnd);\n    float sina = sin(rnd);\n    vec4 basis = vec4(cosa, -sina, sina, cosa);\n\n    vec4 sumcol = vec4(0.0);\n\n    float total = 0.0;\n\n    vec2 fTaps_Poisson[17];\n    // https://github.com/bartwronski/PoissonSamplingGenerator\n    fTaps_Poisson[0] = vec2(0.343280198355, 0.921191856785);\n    fTaps_Poisson[1] = vec2(-0.116859107262, 0.873056831344);\n    fTaps_Poisson[2] = vec2(-0.646421287853, 0.760425284853);\n    fTaps_Poisson[3] = vec2(-0.0437332058416, 0.47196719804);\n    fTaps_Poisson[4] = vec2(0.48240473891, 0.464894594736);\n    fTaps_Poisson[5] = vec2(-0.718897237297, 0.352191304304);\n    fTaps_Poisson[6] = vec2(-0.939061387886, -0.0387376698953);\n    fTaps_Poisson[7] = vec2(0.546569494557, -0.0169516524446);\n    fTaps_Poisson[8] = vec2(-0.182644095652, -0.0702667761349);\n    fTaps_Poisson[9] = vec2(-0.576191305396, -0.252368997099);\n    fTaps_Poisson[10] = vec2(0.921914032366, -0.366530187909);\n    fTaps_Poisson[11] = vec2(-0.0582053944545, -0.510617206206);\n    fTaps_Poisson[12] = vec2(-0.783101528934, -0.601411360136);\n    fTaps_Poisson[13] = vec2(0.430604354377, -0.729559481383);\n    fTaps_Poisson[14] = vec2(-0.350716524868, -0.809522919973);\n    fTaps_Poisson[15] = vec2(0.0600898835968, -0.952568587297);\n    fTaps_Poisson[16] = vec2(0.0, 0.0); // dummy because of intel off-by-one bug\n\n    // for (int i = 0; i < 16; i++) {\n    //     vec2 ofs = fTaps_Poisson[i];\n\n    //     ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw) );\n\n    //     vec3 sample = decodeRGBM(texture2D(texColor, uv + blurDist * ofs), 7.0);\n\n    //     // TODO DOF premult to avoid bleeding, can be tweaked (currently x^3)\n    //     // tradeoff between bleeding dof and out of focus object that shrinks too much\n    //     float cocWeight = abs(sample.a * 2.0 - 1.0);\n    //     cocWeight *= cocWeight * cocWeight;\n\n    //     sumcol.rgb += decodeRGBM(texture2D(texColor, ofs), 7.0) * cocWeight;\n    //     sumcol.a += cocWeight;\n    // }\n\n    vec2 ofs;\n    vec4 sampleTex;\n    float cocWeight;\n\n    DOF_TAP(0);\n    DOF_TAP(1);\n    DOF_TAP(2);\n    DOF_TAP(3);\n    DOF_TAP(4);\n    DOF_TAP(5);\n    DOF_TAP(6);\n    DOF_TAP(7);\n    DOF_TAP(8);\n    DOF_TAP(9);\n    DOF_TAP(10);\n    DOF_TAP(11);\n    DOF_TAP(12);\n    DOF_TAP(13);\n    DOF_TAP(14);\n    DOF_TAP(15);\n\n    return sumcol;\n}\n\n// ------- BLUR CIRCULAR ---------\nvec4 dofBlurCircular(const in sampler2D texColor, const in sampler2D texCoC, const in vec2 uv, const in vec2 texSize, const in float ntime,\n    const in float dofScale, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    vec2 blurDist = (1.0 / texSize.xy) * MAX_BLUR * abs(texture2D(texCoC, uv).a * 2.0 - 1.0) * dofScale;\n\n    // TODO optimize dofBlur16 (unroll...)\n    vec4 sumcol = dofBlur16(texColor, texCoC, uv, blurDist, ntime); // 16\n    if(dofBlurNearFarFocal.w > 0.5) sumcol += dofBlur16(texColor, texCoC, uv, blurDist, ntime + 0.532524); // 32\n    if(dofBlurNearFarFocal.w > 1.5) sumcol += dofBlur16(texColor, texCoC, uv, blurDist, ntime + 0.798742); // 48\n    if(dofBlurNearFarFocal.w > 2.5) sumcol += dofBlur16(texColor, texCoC, uv, blurDist, ntime + 0.175857); // 64\n\n    return encodeRGBM(sumcol.rgb / sumcol.a, 7.0);\n}\n\n// ------- DOF COMBINE ---------\nvec3 dofCombine(const in vec3 color, const in sampler2D texBlur, const in sampler2D texCoC, const in sampler2D texDepth, const in vec2 uv,\n    const in float range, const in vec2 texSize, const in float dofScale, const in vec4 dofBlurNearFarFocal, const in float blurDiv) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return color;\n\n    // half res color\n    vec3 blur = decodeRGBM(texture2D(texBlur, uv), range);\n    vec2 off = vec2(1.0, -1.0) * dofScale * blurDiv;\n    blur += decodeRGBM(texture2D(texBlur, uv + off.xx / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.yy / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.xy / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.yx / texSize), range);\n    blur /= 5.0;\n\n    // merge full res and half res coc\n    float coc = abs(min(texture2D(texCoC, uv).a * 2.0 - 1.0, texDepthToCoC(texDepth, uv, dofBlurNearFarFocal)));\n\n    // merge half res blurred color and full res pixels\n    float cocLower = 0.05;\n    float cocHigher = 0.3;\n    return mix(color, blur, smoothstep(cocLower, cocHigher, coc));\n}\n'
}
, function(t, e) {
    t.exports = '#ifdef GL_FRAGMENT_PRECISION_HIGH\n   precision highp float;\n#else\n   precision mediump float;\n#endif\n\nvarying vec2 vTexCoord0;\nuniform sampler2D Texture0;\nuniform sampler2D Texture1;\nuniform vec4 uHalton;\n\n#ifdef GRAIN\n// https://www.shadertoy.com/view/4djSRW\n// quote : "[...] it gives the same result on PCs and Macs/iOS etc. [...] The sine stuff varies a lot between GPUs."\n\nuniform float uGrainFactor;\nuniform float uTimeGrain;\n\n// integer : 0.1031, uv (0,1 range): 443.8975\nfloat nrand(const in vec3 uvt) {\n  vec3 p3 = fract(uvt * 443.8975);\n  p3 += dot(p3, p3.yzx + 19.19);\n  return fract((p3.x + p3.y) * p3.z);\n}\n\nfloat nrandTriangle( const in vec3 n ) {\n    float nrnd0 = nrand( n );\n\n    // Convert uniform distribution into triangle-shaped distribution.\n    float orig = nrnd0 * 2.0 - 1.0;\n    nrnd0 = orig * inversesqrt(abs(orig));\n    nrnd0 = max(-1.0, nrnd0); // Nerf the NaN generated by 0 * rsqrt(0). Thanks @FioraAeterna!\n    nrnd0 = nrnd0 - sign(orig) + 0.5;\n\n    // Result is range [-0.5,1.5] which is useful for actual dithering. convert to [0,1] for histogram.\n    return (nrnd0 + 0.5) * 0.5;\n    // return nrnd0;\n}\n\n#endif\n\n#ifdef DOF_CROSS\nuniform vec2 RenderSize;\nuniform float uPixelRatio;\nuniform vec3 uDofCross;\n#endif\n\nvoid main() {\n    vec4 color = uHalton.z > 0.0 ? texture2D(Texture0, vTexCoord0) : texture2D(Texture1, vTexCoord0);\n\n    #ifdef GRAIN\n    float grain = nrandTriangle(vec3(vTexCoord0.xy, fract( uTimeGrain ) * 0.07));\n    color.rgb = mix(color.rgb, color.rgb * (color.rgb + (1.0 - color.rgb) * 2.0 * grain), uGrainFactor);\n    #endif\n\n    #ifdef DOF_CROSS\n    float ratio = RenderSize.y / RenderSize.x;\n    float dist = distance(vec2(uDofCross.x, uDofCross.y * ratio), vec2(vTexCoord0.x, vTexCoord0.y * ratio));\n    float widthCircle = uPixelRatio / RenderSize.x;\n    color.rgb = mix(color.rgb, vec3(1.0), abs(dist - 60.0 * widthCircle) > widthCircle ? 0.0 : uDofCross.z);\n    #endif\n\n    gl_FragColor = color;\n}\n'
}
, function(t, e) {
    t.exports = '#pragma include "functions.glsl"\n\nfloat getLuminance(const in vec3 color) {\n    // http://stackoverflow.com/questions/596216/formula-to-determine-brightness-of-rgb-color\n    const vec3 colorBright = vec3(0.2126, 0.7152, 0.0722);\n    return dot(color, colorBright);\n}\n\nfloat RGBToL(const in vec3 color) {\n    float fmin = min(min(color.r, color.g), color.b);\n    float fmax = max(max(color.r, color.g), color.b);\n    return (fmax + fmin) / 2.0;\n}\n\n// ------- TONE MAPPING ---------\n\nvec3 toneMapping(const in vec3 color, const in float expos, const in float bright, const in float contr, const in float satur, const in int method) {\n    vec3 col = color * expos;\n    float luminance = dot(col * (1.0 + bright), vec3(0.2126, 0.7152, 0.0722));\n    col = mix(vec3(luminance), col * (1.0 + bright), vec3(satur));\n    if (contr > 0.0)\n        col = (col - 0.5) / (1.0 - contr) + 0.5;\n    else if(contr < 0.0)\n        col = (col - 0.5) * (1.0 + contr) + 0.5;\n\n    // simple reinhard and filmic\n    // http://filmicgames.com/archives/190\n    if(method == 1) { // reinhard (on luminance)\n        col /= 1.0 + getLuminance(col);\n    } else if( method == 2) { // filmic\n        vec3 x = max(vec3(0.0), col - 0.004);\n        col = (x * (6.2 * x + 0.5) ) / ( x * (6.2 * x + 1.7) + 0.06);\n        col = pow(col, vec3(2.2)); // filmic curve already encode srgb to linear\n    }\n    return col;\n}\n\n// ------- COLOR BALANCE ---------\n\nvec3 colorBalance(const in vec3 color, const in vec3 lrgb, const in vec3 mrgb, const in vec3 hrgb) {\n    float cLen = length(color);\n    if(cLen < 1e-5)\n        return color;\n\n    // TODO : I have no idea what I am doing, we should use a curve widge\n    float lightness = RGBToL(color);\n    // \'  lightness=(lightness*0.9-1.0)/(lightness*2.0+1.0) +1.0;\n    lightness = (1.5 * lightness) / (lightness + 0.5);\n    // https://github.com/liovch/GPUImage/blob/master/framework/Source/GPUImageColorBalanceFilter\n    float a = 0.25;\n    float b = 0.333;\n    float scale = 0.7;\n    vec3 low = lrgb * clamp((lightness - b) / -a + 0.5, 0.0, 1.0);\n    vec3 mid = mrgb * clamp((lightness - b) / a + 0.5, 0.0, 1.0) * clamp((lightness + b - 1.0) / -a + 0.5, 0.0, 1.0);\n    vec3 high = hrgb * clamp((lightness + b - 1.0) / a + 0.5, 0.0, 1.0);\n    vec3 newColor = max(color + (low + mid + high) * scale, vec3(0.0));\n    // newColor can be negative\n    float len = length(newColor);\n    return len < 1e-5 ? newColor * cLen : newColor * cLen / len;\n}\n\n// ------- BLOOM ---------\n\nvec3 extractBright(const in vec3 color, const in float threshold) {\n    // TODO manage hdr pixel with high frequency? (use derivative??), for now we clamp the extracted pixel :(\n    return clamp(color * clamp(getLuminance(color) - threshold, 0.0, 1.0), 0.0, 1.0);\n}\n\nvec3 extractBright(const in vec3 color, const in float threshold, const in float alpha) {\n    return alpha == 0.0 ? vec3(0.0) : extractBright(color * alpha, threshold);\n}\n\n// ------- VIGNETTE ---------\n\nfloat vignetteDithered(const in vec2 uv, in vec2 lens){\n    // smoothesp is not realiable with edge0 == edge1\n    lens.y = min(lens.y, lens.x - 1e-4);\n\n    // same nrand as dof and noise, a blue noise might be better\n    vec3 p3 = fract(uv.xyx * 443.8975);\n    p3 += dot(p3, p3.yzx + 19.19);\n    float jitter = fract((p3.x + p3.y) * p3.z);\n\n    // jitter a bit the uv to remove the banding in some cases\n    // (lens.x - lens.y) reduce flickering when the vignette is harder (hardness)\n    // (lens.x + lens.y) reduce the flickering when the vignette has a strong radius\n    jitter = (lens.x - lens.y) * (lens.x + lens.y) * 0.03 * (jitter - 0.5);\n    return smoothstep(lens.x, lens.y, jitter + distance(uv, vec2(0.5)));\n}\n\nvec3 vignette(const in vec3 color, const in vec2 uv, const in vec2 lens) {\n    return color.rgb * vignetteDithered(uv, lens);\n}\n\n// when applied in the aa/ss pass srgb (no background case, also for performance reason if vignette is the ONLY mergeable postprocess)\n// there is a colorspace conversion to match the exact same vignette behaviour as with the other vignette (mergeable pass)\nvec4 vignette(const in vec4 color, const in vec2 uv, const in vec2 lens) {\n    float factor = vignetteDithered(uv, lens);\n    return vec4( linearTosRGB(sRGBToLinear(color.rgb) * factor), clamp(color.a + (1.0 - factor), 0.0, 1.0));\n}\n\n// ------- CHROMA ---------\n\nvec3 chromaticAberration(const in sampler2D tex, const in vec2 uv, const in float factor, const in float range) {\n    vec2 dist = uv - 0.5;\n    vec2 offset = factor * dist * length(dist);\n    vec3 col;\n    col.r = decodeRGBM(texture2D(tex, uv - offset), range).r;\n    col.g = decodeRGBM(texture2D(tex, uv), range).g;\n    col.b = decodeRGBM(texture2D(tex, uv + offset), range).b;\n    return col;\n}\n\n// ------- SHARPEN ---------\n\nvec3 sharpen(const in vec3 color, const in sampler2D tex,  const in vec2 uv, const in vec2 texSize, const in float sharp, const in float pixelRatio) {\n    vec4 sw = pixelRatio * vec4(-1.0, 1.0, 1.0, -1.0) / texSize.xxyy;\n\n    // use useAA, 4 texFetch already in cache. perhaps we could cache ourself.\n    vec3 rgbNW = texture2D(tex, uv + sw.xw).rgb;\n    vec3 rgbNE = texture2D(tex, uv + sw.yw).rgb;\n    vec3 rgbSW = texture2D(tex, uv + sw.xz).rgb;\n    vec3 rgbSE = texture2D(tex, uv + sw.yz).rgb;\n\n    return color.rgb + sharp * (4.0 * color.rgb - rgbNW - rgbNE - rgbSW - rgbSE);\n}\n\nvec3 sharpen(const in vec3 color, const in sampler2D tex,  const in vec2 uv, const in vec2 texSize, const in float sharp, const in float pixelRatio, const in float alpha) {\n    if(alpha == 0.0) return color;\n    return sharpen(color, tex, uv, texSize, sharp * alpha, pixelRatio);\n}\n\n// ------- COMPOSITION ---------\n\nvec4 composeExtra(const in vec3 color, const in float alpha, const in vec4 extra) {\n    vec4 outCol = extra + vec4(color.rgb, alpha) * (1.0 - extra.a);\n    return outCol;\n}\n\nvec3 composeBackgroundColor(const in vec3 color, const in float alpha, const in vec3 background) {\n    return color + background * (1.0 - alpha);\n}\n'
}
, function(t, e) {
    t.exports = '#pragma include "functions.glsl"\n\n#define NB_SAMPLES 11\n// Constant used to scale the depth view value that is given to the blur pass\n#define MIN_RADIUS 1.0\n#define NB_SPIRAL_TURNS 3.0\n\nfloat zValueFromScreenSpacePosition(const in sampler2D texDepth, const in vec2 uv, const in vec2 nearFar) {\n    float d = dot(texture2D(texDepth, uv).rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n    return nearFar.x + (nearFar.y - nearFar.x) * d;\n}\n\nvec3 reconstructCSPosition(const in vec2 ssP, const in float z, const in vec4 projInfo) {\n    return vec3((ssP.xy * projInfo.xy + projInfo.zw) * z, z);\n}\n\nvec3 getPosition(const in sampler2D texDepth, const in vec2 uv, const in vec2 texSize, const in vec4 projInfo, const in vec2 nearFar) {\n    return reconstructCSPosition(uv * texSize, zValueFromScreenSpacePosition(texDepth, uv, nearFar), projInfo);\n}\n\n# define MAX_MIP_LEVEL 5\n// Determines at which point we should switch mip level\n// if number is too small (~3) will lead to flashing (bad variance as many taps give same pixel)\n// if number is too high, mip level are not used well and the cache is not used efficiently\n# define LOG_MAX_OFFSET 3\n\nvec3 getOffsetedPixelPos(\n    const in sampler2D texmip0,\n    const in sampler2D texmip1,\n    const in sampler2D texmip2,\n    const in sampler2D texmip3,\n    const in sampler2D texmip4,\n    const in sampler2D texmip5,\n    const in vec2 uv,\n    const in vec2 unitOffset,\n    const in float screenSpaceRadius,\n    const in vec4 projInfo,\n    const in vec2 texSize,\n    const in vec2 nearFar ) {\n\n    int mipLevel = int(clamp(floor(log2(screenSpaceRadius)) - float(LOG_MAX_OFFSET), 0.0, float(MAX_MIP_LEVEL)));\n    vec2 uvOff = uv + floor(screenSpaceRadius * unitOffset) / texSize;\n\n    float d;\n    if (mipLevel == 1) d = zValueFromScreenSpacePosition(texmip1, uvOff, nearFar);\n    else if (mipLevel == 2) d = zValueFromScreenSpacePosition(texmip2, uvOff, nearFar);\n    else if (mipLevel == 3) d = zValueFromScreenSpacePosition(texmip3, uvOff, nearFar);\n    else if (mipLevel == 4) d = zValueFromScreenSpacePosition(texmip4, uvOff, nearFar);\n    else if (mipLevel == 5) d = zValueFromScreenSpacePosition(texmip5, uvOff, nearFar);\n    else d = zValueFromScreenSpacePosition(texmip0, uvOff, nearFar);\n\n    return reconstructCSPosition(uvOff * texSize, d, projInfo);\n}\n\nfloat nrand(const in vec3 uvt) {\n  vec3 p3 = fract(uvt * 443.8975);\n  p3 += dot(p3, p3.yzx + 19.19);\n  return fract((p3.x + p3.y) * p3.z);\n}\n\n#define PIOVER8 0.39269908169\nvec3 unpackNormal1(const in float pack1) {\n    float pack8 = floor(pack1 * 255.0);\n    float th = PIOVER8 * float(pack8 / 16.0);\n    float len = sqrt(mod(float(pack8), 16.0) / 15.001);\n    vec2 nv = vec2(cos(th), sin(th)) * len;\n    return -vec3(nv.x, nv.y, sqrt(max(0.0, 1.0 - nv.x * nv.x - nv.y * nv.y)));\n}\n\nvec3 unpackNormal2(const in vec2 pack2) {\n    vec3 nv = pack2.rgg * 2.0 - 1.0;\n    return -vec3(nv.x, nv.y, sqrt(max(0.0, 1.0 - nv.x * nv.x - nv.y * nv.y)));\n}\n\n#ifndef SSAO_TAP_EXTRACT\n#define SSAO_TAP_EXTRACT(id)  \n#endif\n\nvec4 ssaoExtract(\n        const in sampler2D texDepth,\n        const in vec2 uv,\n        const in vec2 nearFar,\n        const in float radius,\n        const in float intensity,\n        const in float bias,\n        const in vec4 projInfo,\n        const in float projScale,\n        const in vec2 texSize,\n        const in float time,\n        const in sampler2D texDepth1,\n        const in sampler2D texDepth2,\n        const in sampler2D texDepth3,\n        const in sampler2D texDepth4,\n        const in sampler2D texDepth5) {\n\n    vec3 depthPacked = texture2D(texDepth, uv).rgb;\n    vec3 cameraSpacePosition = getPosition(texDepth, uv, texSize, projInfo, nearFar);\n    float ssRadius = -projScale * radius / cameraSpacePosition.z;\n\n#ifdef SSAO_NORMAL\n    vec3 normal = unpackNormal2(texture2D(texDepth, uv).ba); // g buffer normal 2 component on ba\n#elif defined(GL_OES_standard_derivatives) && !defined(MOBILE)\n    vec3 normal = cross(dFdy(cameraSpacePosition), dFdx(cameraSpacePosition));\n#else\n    vec3 cam0 = getPosition(texDepth, uv - vec2(1.0, 0.0) / texSize, texSize, projInfo, nearFar);\n    vec3 cam1 = getPosition(texDepth, uv + vec2(1.0, 0.0) / texSize, texSize, projInfo, nearFar);\n    vec3 cam2 = getPosition(texDepth, uv - vec2(0.0, 1.0) / texSize, texSize, projInfo, nearFar);\n    vec3 cam3 = getPosition(texDepth, uv + vec2(0.0, 1.0) / texSize, texSize, projInfo, nearFar);\n    vec3 normal = cross(cam0 - cam1, cam3 - cam2);\n#endif\n\n    // early return background or radius too small (should be check after derivatives usage)\n    if (depthPacked.x == 1.0 || ssRadius < MIN_RADIUS) {\n        return vec4(1.0, depthPacked);\n    }\n\n    normal = normalize(normal);\n    float nFalloff = mix(1.0, max(0.0, 1.5 * normal.z), 0.35);\n\n    float randomAngle = nrand(vec3(uv, 0.07 * fract(time))) * 6.3; // needs to be > 2PI\n\n    float invRadius2 = 1.0 / (radius * radius);\n    float contrib = 0.0;\n    // for (int i = 0; i < NB_SAMPLES; ++i) {\n    //     float screenSpaceRadius = (float(i) + 0.5) * (1.0 / float(NB_SAMPLES));\n    //     float angle = screenSpaceRadius * (NB_SPIRAL_TURNS * 6.28) + randomAngle;\n    //     screenSpaceRadius = max(0.75, screenSpaceRadius * ssRadius);\n    //     vec2 offsetUnitVec = vec2(cos(angle), sin(angle));\n    //     vec3 occludingPoint = getOffsetedPixelPos(texDepth, texDepth1, texDepth2, texDepth3, texDepth4, texDepth5, uv, offsetUnitVec, screenSpaceRadius, projInfo, texSize, nearFar);\n    //     occludingPoint -= cameraSpacePosition;\n    //     float vv = dot(occludingPoint, occludingPoint);\n    //     float vn = dot(occludingPoint, normal);\n    //     contrib += max(1.0 - vv * invRadius2, 0.0) * max((vn - bias) * inversesqrt(vv), 0.0);\n    // }\n\n    // ---- UNROLL ----\n    float vv;\n    float vn;\n    float screenSpaceRadius;\n    float angle;\n    vec3 occludingPoint;\n    vec2 offsetUnitVec;\n    SSAO_TAP_EXTRACT(0);\n    SSAO_TAP_EXTRACT(1);\n    SSAO_TAP_EXTRACT(2);\n    SSAO_TAP_EXTRACT(3);\n    SSAO_TAP_EXTRACT(4);\n    SSAO_TAP_EXTRACT(5);\n    SSAO_TAP_EXTRACT(6);\n    SSAO_TAP_EXTRACT(7);\n    SSAO_TAP_EXTRACT(8);\n    SSAO_TAP_EXTRACT(9);\n    SSAO_TAP_EXTRACT(10);\n    // ---- UNROLL ----\n\n    float aoValue = max(0.0, 1.0 - sqrt(contrib * nFalloff / float(NB_SAMPLES)));\n    aoValue = pow(aoValue, 10.0 * intensity);\n\n    vec4 aoDepth;\n    aoDepth.r = mix(1.0, aoValue, clamp(ssRadius - MIN_RADIUS, 0.0, 1.0));\n    aoDepth.gba = depthPacked;\n\n    return aoDepth;\n}\n\n#define SSAO_FILTER_RADIUS 3\n\n#ifndef SSAO_TAP_BLUR\n#define SSAO_TAP_BLUR(id, absid)  \n#endif\n\nvec4 ssaoBlur(const in sampler2D texSsao, const in vec2 uv, const in vec2 axis, const in vec2 nearFar) {\n\n    vec4 aoDepth = texture2D(texSsao, uv);\n\n    // background\n    if(aoDepth.y == 1.0){\n        return aoDepth;\n    }\n\n    float initialZ = dot(aoDepth.gba, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n\n    float gaussian[SSAO_FILTER_RADIUS + 2]; // dummy because of intel off-by-one bug\n    gaussian[0] = 0.153170;\n    gaussian[1] = 0.144893;\n    gaussian[2] = 0.122649;\n    gaussian[3] = 0.092902;\n    gaussian[4] = 0.0;\n\n    float totalWeight = gaussian[0];\n    float sum = aoDepth.r * totalWeight;\n    float sharpnessFactor = 400.0;\n\n    // for (int r = - SSAO_FILTER_RADIUS; r <= SSAO_FILTER_RADIUS; ++r) {\n    //     if (r != 0) {\n    //         vec4 sample = texture2D(texSsao, uv + axis * float(r) * SSAO_SCALE);\n    //         float z = dot(sample.gba, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n    //         float weight = 0.3 + gaussian[int(abs(float(r)))];\n    //         weight *= max(0.0, 1.0 - sharpnessFactor * abs(z - initialZ));\n    //         sum += sample.r * weight;\n    //         totalWeight += weight;\n    //     }\n    // }\n\n    // ---- UNROLL ----\n    vec2 ofs;\n    float z;\n    float weight;\n    vec4 sampleTex;\n\n    SSAO_TAP_BLUR(-3, 3);\n    SSAO_TAP_BLUR(-2, 2);\n    SSAO_TAP_BLUR(-1, 1);\n    SSAO_TAP_BLUR(1, 1);\n    SSAO_TAP_BLUR(2, 2);\n    SSAO_TAP_BLUR(3, 3);\n    // ---- UNROLL ----\n\n    aoDepth.r = sum / totalWeight;\n    return aoDepth;\n}\n\nvec4 ssaoBlurH(const in sampler2D texSsao, const in vec2 uv, const in vec2 texSize, const in vec2 nearFar) {\n    return ssaoBlur(texSsao, uv, vec2(1.0, 0.0) / texSize, nearFar);\n}\n\nvec3 ssaoBlurV(const in sampler2D texSsao, const in vec2 uv, const in vec2 texSize, const in vec2 nearFar, const in vec3 color) {\n    return color * ssaoBlur(texSsao, uv, vec2(0.0, 1.0) / texSize, nearFar).rrr;\n}'
}
, function(t, e) {
    t.exports = 'varying vec2 vTexCoord0;\n\nuniform sampler2D uTexturePanel;\nuniform vec4 uHoveredArea;\nuniform float uHoveredOpaque;\nuniform float uAlpha;\nuniform float uRatio;\nuniform float uRound;\nuniform float uVeilFactor;\n\n#pragma include "functions.glsl"\n\n// signed distance to a 2D rounded box\nfloat sdRoundBox( const in vec2 p, const in vec2 b, const in float r ) {\n    vec2 q = abs(p) - b;\n    vec2 m = vec2( min(q.x,q.y), max(q.x,q.y) );\n    float d = (m.x > 0.0) ? length(q) : m.y; \n    return d - r;\n}\n\nvoid main(void) {  \n  vec4 color = texture2D(uTexturePanel, vTexCoord0);\n\n  float lerpValue = step(0.0, -vTexCoord0.x);\n  lerpValue += step(1.0, vTexCoord0.x);\n\n  float round = uRound;\n  float left = uHoveredArea.x + round;\n  float right = uHoveredArea.y - round;\n  float top = uHoveredArea.z - round;\n  float bottom = uHoveredArea.w + round;\n  \n  vec2 halfSize = abs(vec2(left - right, top - bottom) * 0.5);  \n  vec2 center = vec2(halfSize.x + left, halfSize.y + bottom);\n\n  lerpValue += max(0.0, -sign(sdRoundBox( vTexCoord0 - center, halfSize, round)));\n\n  color.rgba = mix(color.rgba, color.rgba + vec4(0.109, 0.664, 0.848, step(0.1, uHoveredOpaque)), lerpValue); \n\n  color.a *= uAlpha;\n  color.rgb *= (color.a * uVeilFactor);\n\n  gl_FragColor = color;\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\n\n// uniform mat4 uModelMatrix;\n// uniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat4 uModelViewMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  \n}\n"
}
, function(t, e) {
    t.exports = 'varying vec2 vLocalVertex;\n\nuniform float uAlpha;\nuniform int uOutputLinear;\nuniform vec3 uCursorColor;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uCursorColor, 1.0) * uAlpha * smoothstep(0.0, 1.0, 1.0 - 2.0 * length(vLocalVertex));\n\n  gl_FragColor = linearTosRGB(color);\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vLocalVertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vLocalVertex = Vertex.xy;\n\n  vec3 posLocal = Vertex.xyz * 0.5;\n  posLocal += vec3(0.0, 0.0, 0.1);\n\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(posLocal, 1.0));\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureFloor;\nuniform float uScaleToMeter;\nuniform int uOutputLinear;\n\nvarying vec4 vViewPos;\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  //manual depth test\n  float fragDepth = clamp( (-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x), 0.0, 1.0);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize).rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n  if( depth <= fragDepth) discard;\n  \n  float fade = smoothstep(0.0, 1.0, 1.0 - length(vTexCoord0 * 2.0 - 1.0));\n  vec4 color = vec4(fade * sRGBToLinear(texture2D(uTextureFloor, (vTexCoord0 * 1.0 - 0.5) * uScaleToMeter).r));\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = (uProjectionMatrix * vViewPos).xyww;\n}\n"
}
, function(t, e) {
    t.exports = 'uniform vec3 uColor;\nuniform int uOutputLinear;\n\nvarying float vHeight;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uColor, 1.0) * smoothstep(1.0, 0.0, vHeight + 1.0);\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying float vHeight;\n\nvoid main(void) {\n  vHeight = Vertex.z;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec3 vLocalVertex;\n\nuniform int uOutputLinear;\nuniform float uAlpha;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = linearTosRGB(vec4(0.1, 0.66, 0.85, 1.0)) * (smoothstep(1.0, 0.0, vLocalVertex.y) * smoothstep(1.0, 0.0, abs(vLocalVertex.x * 4.0))) * uAlpha;\n\n  gl_FragColor = color;\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec3 vLocalVertex;\n\nvoid main(void) {\n  vLocalVertex = Vertex;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"
}
, function(t, e) {
    t.exports = 'varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureTeleportCircle;\nuniform float uScale;\nuniform float uAlpha;\nuniform int uOutputLinear;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec3 tex = sRGBToLinear(texture2D(uTextureTeleportCircle, vTexCoord0).rgb);\n  vec4 color = uScale == 1.0 ? vec4(tex.rrr, 1.0) * uAlpha * tex.g : vec4(uAlpha * tex.b);\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'
}
, function(t, e) {
    t.exports = "attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nuniform float uScale;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n\n  vec3 posLocal = Vertex.xyz * vec3(uScale, uScale, 1.0 - uScale);\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(posLocal, 1.0));\n}\n"
}
, function(t, e, i) {
    !function() {
        var i, n = Array.prototype.forEach, r = Object.prototype.hasOwnProperty, a = Array.prototype.slice, s = 0, o = function() {
            return {
                keys: Object.keys || function(t) {
                    if ("object" != typeof t && "function" != typeof t || null === t)
                        throw new TypeError("keys() called on a non-object");
                    var e, i = [];
                    for (e in t)
                        t.hasOwnProperty(e) && (i[i.length] = e);
                    return i
                }
                ,
                uniqueId: function(t) {
                    var e = ++s + "";
                    return t ? t + e : e
                },
                has: function(t, e) {
                    return r.call(t, e)
                },
                each: function(t, e, i) {
                    if (null != t)
                        if (n && t.forEach === n)
                            t.forEach(e, i);
                        else if (t.length === +t.length)
                            for (var r = 0, a = t.length; r < a; r++)
                                e.call(i, t[r], r, t);
                        else
                            for (var s in t)
                                this.has(t, s) && e.call(i, t[s], s, t)
                },
                once: function(t) {
                    var e, i = !1;
                    return function() {
                        return i ? e : (i = !0,
                        e = t.apply(this, arguments),
                        t = null,
                        e)
                    }
                }
            }
        }();
        i = {
            on: function(t, e, i) {
                return u(this, "on", t, [e, i]) && e ? (this._events || (this._events = {}),
                (this._events[t] || (this._events[t] = [])).push({
                    callback: e,
                    context: i,
                    ctx: i || this
                }),
                this) : this
            },
            once: function(t, e, i) {
                if (!u(this, "once", t, [e, i]) || !e)
                    return this;
                var n = this
                  , r = o.once(function() {
                    n.off(t, r),
                    e.apply(this, arguments)
                });
                return r._callback = e,
                this.on(t, r, i)
            },
            off: function(t, e, i) {
                var n, r, a, s, l, h, c, d;
                if (!this._events || !u(this, "off", t, [e, i]))
                    return this;
                if (!t && !e && !i)
                    return this._events = {},
                    this;
                for (s = t ? [t] : o.keys(this._events),
                l = 0,
                h = s.length; l < h; l++)
                    if (t = s[l],
                    a = this._events[t]) {
                        if (this._events[t] = n = [],
                        e || i)
                            for (c = 0,
                            d = a.length; c < d; c++)
                                r = a[c],
                                (e && e !== r.callback && e !== r.callback._callback || i && i !== r.context) && n.push(r);
                        n.length || delete this._events[t]
                    }
                return this
            },
            trigger: function(t) {
                if (!this._events)
                    return this;
                var e = a.call(arguments, 1);
                if (!u(this, "trigger", t, e))
                    return this;
                var i = this._events[t]
                  , n = this._events.all;
                return i && h(i, e),
                n && h(n, arguments),
                this
            },
            stopListening: function(t, e, i) {
                var n = this._listeners;
                if (!n)
                    return this;
                var r = !e && !i;
                "object" == typeof e && (i = this),
                t && ((n = {})[t._listenerId] = t);
                for (var a in n)
                    n[a].off(e, i, this),
                    r && delete this._listeners[a];
                return this
            }
        };
        var l = /\s+/
          , u = function(t, e, i, n) {
            if (!i)
                return !0;
            if ("object" == typeof i) {
                for (var r in i)
                    t[e].apply(t, [r, i[r]].concat(n));
                return !1
            }
            if (l.test(i)) {
                for (var a = i.split(l), s = 0, o = a.length; s < o; s++)
                    t[e].apply(t, [a[s]].concat(n));
                return !1
            }
            return !0
        }
          , h = function(t, e) {
            var i, n = -1, r = t.length, a = e[0], s = e[1], o = e[2];
            switch (e.length) {
            case 0:
                for (; ++n < r; )
                    (i = t[n]).callback.call(i.ctx);
                return;
            case 1:
                for (; ++n < r; )
                    (i = t[n]).callback.call(i.ctx, a);
                return;
            case 2:
                for (; ++n < r; )
                    (i = t[n]).callback.call(i.ctx, a, s);
                return;
            case 3:
                for (; ++n < r; )
                    (i = t[n]).callback.call(i.ctx, a, s, o);
                return;
            default:
                for (; ++n < r; )
                    (i = t[n]).callback.apply(i.ctx, e)
            }
        }
          , c = {
            listenTo: "on",
            listenToOnce: "once"
        };
        o.each(c, function(t, e) {
            i[e] = function(e, i, n) {
                return (this._listeners || (this._listeners = {}))[e._listenerId || (e._listenerId = o.uniqueId("l"))] = e,
                "object" == typeof i && (n = this),
                e[t](i, n, this),
                this
            }
        }),
        i.bind = i.on,
        i.unbind = i.off,
        i.mixin = function(t) {
            var e = ["on", "once", "off", "trigger", "stopListening", "listenTo", "listenToOnce", "bind", "unbind"];
            return o.each(e, function(e) {
                t[e] = this[e]
            }, this),
            t
        }
        ,
        void 0 !== t && t.exports && (e = t.exports = i),
        e.BackboneEvents = i
    }()
}
, function(t, e, i) {
    t.exports = i(828)
}
, function(t, e, i) {
    e.glMatrix = i(319),
    e.mat2 = i(831),
    e.mat2d = i(832),
    e.mat3 = i(597),
    e.mat4 = i(833),
    e.quat = i(834),
    e.vec2 = i(835),
    e.vec3 = i(598),
    e.vec4 = i(599)
}
, function(t, e, i) {
    var n = i(319)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(4);
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(4);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        e
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t
    }
    ,
    r.identity = function(t) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t
    }
    ,
    r.fromValues = function(t, e, i, r) {
        var a = new n.ARRAY_TYPE(4);
        return a[0] = t,
        a[1] = e,
        a[2] = i,
        a[3] = r,
        a
    }
    ,
    r.set = function(t, e, i, n, r) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t[3] = r,
        t
    }
    ,
    r.transpose = function(t, e) {
        if (t === e) {
            var i = e[1];
            t[1] = e[2],
            t[2] = i
        } else
            t[0] = e[0],
            t[1] = e[2],
            t[2] = e[1],
            t[3] = e[3];
        return t
    }
    ,
    r.invert = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = i * a - r * n;
        return s ? (s = 1 / s,
        t[0] = a * s,
        t[1] = -n * s,
        t[2] = -r * s,
        t[3] = i * s,
        t) : null
    }
    ,
    r.adjoint = function(t, e) {
        var i = e[0];
        return t[0] = e[3],
        t[1] = -e[1],
        t[2] = -e[2],
        t[3] = i,
        t
    }
    ,
    r.determinant = function(t) {
        return t[0] * t[3] - t[2] * t[1]
    }
    ,
    r.multiply = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = i[0]
          , l = i[1]
          , u = i[2]
          , h = i[3];
        return t[0] = n * o + a * l,
        t[1] = r * o + s * l,
        t[2] = n * u + a * h,
        t[3] = r * u + s * h,
        t
    }
    ,
    r.mul = r.multiply,
    r.rotate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = Math.sin(i)
          , l = Math.cos(i);
        return t[0] = n * l + a * o,
        t[1] = r * l + s * o,
        t[2] = n * -o + a * l,
        t[3] = r * -o + s * l,
        t
    }
    ,
    r.scale = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = i[0]
          , l = i[1];
        return t[0] = n * o,
        t[1] = r * o,
        t[2] = a * l,
        t[3] = s * l,
        t
    }
    ,
    r.fromRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = n,
        t[1] = i,
        t[2] = -i,
        t[3] = n,
        t
    }
    ,
    r.fromScaling = function(t, e) {
        return t[0] = e[0],
        t[1] = 0,
        t[2] = 0,
        t[3] = e[1],
        t
    }
    ,
    r.str = function(t) {
        return "mat2(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ")"
    }
    ,
    r.frob = function(t) {
        return Math.sqrt(Math.pow(t[0], 2) + Math.pow(t[1], 2) + Math.pow(t[2], 2) + Math.pow(t[3], 2))
    }
    ,
    r.LDU = function(t, e, i, n) {
        return t[2] = n[2] / n[0],
        i[0] = n[0],
        i[1] = n[1],
        i[3] = n[3] - t[2] * i[1],
        [t, e, i]
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t[3] = e[3] + i[3],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t[3] = e[3] - i[3],
        t
    }
    ,
    r.sub = r.subtract,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = t[3]
          , o = e[0]
          , l = e[1]
          , u = e[2]
          , h = e[3];
        return Math.abs(i - o) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(o)) && Math.abs(r - l) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(l)) && Math.abs(a - u) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(u)) && Math.abs(s - h) <= n.EPSILON * Math.max(1, Math.abs(s), Math.abs(h))
    }
    ,
    r.multiplyScalar = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t[3] = e[3] * i,
        t
    }
    ,
    r.multiplyScalarAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t[3] = e[3] + i[3] * n,
        t
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(319)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(6);
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t[4] = 0,
        t[5] = 0,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(6);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        e[4] = t[4],
        e[5] = t[5],
        e
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[4] = e[4],
        t[5] = e[5],
        t
    }
    ,
    r.identity = function(t) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t[4] = 0,
        t[5] = 0,
        t
    }
    ,
    r.fromValues = function(t, e, i, r, a, s) {
        var o = new n.ARRAY_TYPE(6);
        return o[0] = t,
        o[1] = e,
        o[2] = i,
        o[3] = r,
        o[4] = a,
        o[5] = s,
        o
    }
    ,
    r.set = function(t, e, i, n, r, a, s) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t[3] = r,
        t[4] = a,
        t[5] = s,
        t
    }
    ,
    r.invert = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , l = i * a - n * r;
        return l ? (l = 1 / l,
        t[0] = a * l,
        t[1] = -n * l,
        t[2] = -r * l,
        t[3] = i * l,
        t[4] = (r * o - a * s) * l,
        t[5] = (n * s - i * o) * l,
        t) : null
    }
    ,
    r.determinant = function(t) {
        return t[0] * t[3] - t[1] * t[2]
    }
    ,
    r.multiply = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , l = e[5]
          , u = i[0]
          , h = i[1]
          , c = i[2]
          , d = i[3]
          , p = i[4]
          , f = i[5];
        return t[0] = n * u + a * h,
        t[1] = r * u + s * h,
        t[2] = n * c + a * d,
        t[3] = r * c + s * d,
        t[4] = n * p + a * f + o,
        t[5] = r * p + s * f + l,
        t
    }
    ,
    r.mul = r.multiply,
    r.rotate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , l = e[5]
          , u = Math.sin(i)
          , h = Math.cos(i);
        return t[0] = n * h + a * u,
        t[1] = r * h + s * u,
        t[2] = n * -u + a * h,
        t[3] = r * -u + s * h,
        t[4] = o,
        t[5] = l,
        t
    }
    ,
    r.scale = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , l = e[5]
          , u = i[0]
          , h = i[1];
        return t[0] = n * u,
        t[1] = r * u,
        t[2] = a * h,
        t[3] = s * h,
        t[4] = o,
        t[5] = l,
        t
    }
    ,
    r.translate = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , l = e[5]
          , u = i[0]
          , h = i[1];
        return t[0] = n,
        t[1] = r,
        t[2] = a,
        t[3] = s,
        t[4] = n * u + a * h + o,
        t[5] = r * u + s * h + l,
        t
    }
    ,
    r.fromRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = n,
        t[1] = i,
        t[2] = -i,
        t[3] = n,
        t[4] = 0,
        t[5] = 0,
        t
    }
    ,
    r.fromScaling = function(t, e) {
        return t[0] = e[0],
        t[1] = 0,
        t[2] = 0,
        t[3] = e[1],
        t[4] = 0,
        t[5] = 0,
        t
    }
    ,
    r.fromTranslation = function(t, e) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t[4] = e[0],
        t[5] = e[1],
        t
    }
    ,
    r.str = function(t) {
        return "mat2d(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ", " + t[4] + ", " + t[5] + ")"
    }
    ,
    r.frob = function(t) {
        return Math.sqrt(Math.pow(t[0], 2) + Math.pow(t[1], 2) + Math.pow(t[2], 2) + Math.pow(t[3], 2) + Math.pow(t[4], 2) + Math.pow(t[5], 2) + 1)
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t[3] = e[3] + i[3],
        t[4] = e[4] + i[4],
        t[5] = e[5] + i[5],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t[3] = e[3] - i[3],
        t[4] = e[4] - i[4],
        t[5] = e[5] - i[5],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiplyScalar = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t[3] = e[3] * i,
        t[4] = e[4] * i,
        t[5] = e[5] * i,
        t
    }
    ,
    r.multiplyScalarAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t[3] = e[3] + i[3] * n,
        t[4] = e[4] + i[4] * n,
        t[5] = e[5] + i[5] * n,
        t
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3] && t[4] === e[4] && t[5] === e[5]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = t[3]
          , o = t[4]
          , l = t[5]
          , u = e[0]
          , h = e[1]
          , c = e[2]
          , d = e[3]
          , p = e[4]
          , f = e[5];
        return Math.abs(i - u) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(u)) && Math.abs(r - h) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(h)) && Math.abs(a - c) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(c)) && Math.abs(s - d) <= n.EPSILON * Math.max(1, Math.abs(s), Math.abs(d)) && Math.abs(o - p) <= n.EPSILON * Math.max(1, Math.abs(o), Math.abs(p)) && Math.abs(l - f) <= n.EPSILON * Math.max(1, Math.abs(l), Math.abs(f))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(319)
      , r = {
        scalar: {},
        SIMD: {}
    };
    r.create = function() {
        var t = new n.ARRAY_TYPE(16);
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = 1,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = 1,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(16);
        return e[0] = t[0],
        e[1] = t[1],
        e[2] = t[2],
        e[3] = t[3],
        e[4] = t[4],
        e[5] = t[5],
        e[6] = t[6],
        e[7] = t[7],
        e[8] = t[8],
        e[9] = t[9],
        e[10] = t[10],
        e[11] = t[11],
        e[12] = t[12],
        e[13] = t[13],
        e[14] = t[14],
        e[15] = t[15],
        e
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[4] = e[4],
        t[5] = e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[8] = e[8],
        t[9] = e[9],
        t[10] = e[10],
        t[11] = e[11],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15],
        t
    }
    ,
    r.fromValues = function(t, e, i, r, a, s, o, l, u, h, c, d, p, f, g, m) {
        var v = new n.ARRAY_TYPE(16);
        return v[0] = t,
        v[1] = e,
        v[2] = i,
        v[3] = r,
        v[4] = a,
        v[5] = s,
        v[6] = o,
        v[7] = l,
        v[8] = u,
        v[9] = h,
        v[10] = c,
        v[11] = d,
        v[12] = p,
        v[13] = f,
        v[14] = g,
        v[15] = m,
        v
    }
    ,
    r.set = function(t, e, i, n, r, a, s, o, l, u, h, c, d, p, f, g, m) {
        return t[0] = e,
        t[1] = i,
        t[2] = n,
        t[3] = r,
        t[4] = a,
        t[5] = s,
        t[6] = o,
        t[7] = l,
        t[8] = u,
        t[9] = h,
        t[10] = c,
        t[11] = d,
        t[12] = p,
        t[13] = f,
        t[14] = g,
        t[15] = m,
        t
    }
    ,
    r.identity = function(t) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = 1,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = 1,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.scalar.transpose = function(t, e) {
        if (t === e) {
            var i = e[1]
              , n = e[2]
              , r = e[3]
              , a = e[6]
              , s = e[7]
              , o = e[11];
            t[1] = e[4],
            t[2] = e[8],
            t[3] = e[12],
            t[4] = i,
            t[6] = e[9],
            t[7] = e[13],
            t[8] = n,
            t[9] = a,
            t[11] = e[14],
            t[12] = r,
            t[13] = s,
            t[14] = o
        } else
            t[0] = e[0],
            t[1] = e[4],
            t[2] = e[8],
            t[3] = e[12],
            t[4] = e[1],
            t[5] = e[5],
            t[6] = e[9],
            t[7] = e[13],
            t[8] = e[2],
            t[9] = e[6],
            t[10] = e[10],
            t[11] = e[14],
            t[12] = e[3],
            t[13] = e[7],
            t[14] = e[11],
            t[15] = e[15];
        return t
    }
    ,
    r.SIMD.transpose = function(t, e) {
        var i, n, r, a, s, o, l, u, h, c;
        return i = SIMD.Float32x4.load(e, 0),
        n = SIMD.Float32x4.load(e, 4),
        r = SIMD.Float32x4.load(e, 8),
        a = SIMD.Float32x4.load(e, 12),
        s = SIMD.Float32x4.shuffle(i, n, 0, 1, 4, 5),
        o = SIMD.Float32x4.shuffle(r, a, 0, 1, 4, 5),
        l = SIMD.Float32x4.shuffle(s, o, 0, 2, 4, 6),
        u = SIMD.Float32x4.shuffle(s, o, 1, 3, 5, 7),
        SIMD.Float32x4.store(t, 0, l),
        SIMD.Float32x4.store(t, 4, u),
        s = SIMD.Float32x4.shuffle(i, n, 2, 3, 6, 7),
        o = SIMD.Float32x4.shuffle(r, a, 2, 3, 6, 7),
        h = SIMD.Float32x4.shuffle(s, o, 0, 2, 4, 6),
        c = SIMD.Float32x4.shuffle(s, o, 1, 3, 5, 7),
        SIMD.Float32x4.store(t, 8, h),
        SIMD.Float32x4.store(t, 12, c),
        t
    }
    ,
    r.transpose = n.USE_SIMD ? r.SIMD.transpose : r.scalar.transpose,
    r.scalar.invert = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , l = e[6]
          , u = e[7]
          , h = e[8]
          , c = e[9]
          , d = e[10]
          , p = e[11]
          , f = e[12]
          , g = e[13]
          , m = e[14]
          , v = e[15]
          , _ = i * o - n * s
          , b = i * l - r * s
          , x = i * u - a * s
          , y = n * l - r * o
          , S = n * u - a * o
          , w = r * u - a * l
          , C = h * g - c * f
          , M = h * m - d * f
          , T = h * v - p * f
          , A = c * m - d * g
          , E = c * v - p * g
          , P = d * v - p * m
          , N = _ * P - b * E + x * A + y * T - S * M + w * C;
        return N ? (N = 1 / N,
        t[0] = (o * P - l * E + u * A) * N,
        t[1] = (r * E - n * P - a * A) * N,
        t[2] = (g * w - m * S + v * y) * N,
        t[3] = (d * S - c * w - p * y) * N,
        t[4] = (l * T - s * P - u * M) * N,
        t[5] = (i * P - r * T + a * M) * N,
        t[6] = (m * x - f * w - v * b) * N,
        t[7] = (h * w - d * x + p * b) * N,
        t[8] = (s * E - o * T + u * C) * N,
        t[9] = (n * T - i * E - a * C) * N,
        t[10] = (f * S - g * x + v * _) * N,
        t[11] = (c * x - h * S - p * _) * N,
        t[12] = (o * M - s * A - l * C) * N,
        t[13] = (i * A - n * M + r * C) * N,
        t[14] = (g * b - f * y - m * _) * N,
        t[15] = (h * y - c * b + d * _) * N,
        t) : null
    }
    ,
    r.SIMD.invert = function(t, e) {
        var i, n, r, a, s, o, l, u, h, c, d = SIMD.Float32x4.load(e, 0), p = SIMD.Float32x4.load(e, 4), f = SIMD.Float32x4.load(e, 8), g = SIMD.Float32x4.load(e, 12);
        return s = SIMD.Float32x4.shuffle(d, p, 0, 1, 4, 5),
        n = SIMD.Float32x4.shuffle(f, g, 0, 1, 4, 5),
        i = SIMD.Float32x4.shuffle(s, n, 0, 2, 4, 6),
        n = SIMD.Float32x4.shuffle(n, s, 1, 3, 5, 7),
        s = SIMD.Float32x4.shuffle(d, p, 2, 3, 6, 7),
        a = SIMD.Float32x4.shuffle(f, g, 2, 3, 6, 7),
        r = SIMD.Float32x4.shuffle(s, a, 0, 2, 4, 6),
        a = SIMD.Float32x4.shuffle(a, s, 1, 3, 5, 7),
        s = SIMD.Float32x4.mul(r, a),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        o = SIMD.Float32x4.mul(n, s),
        l = SIMD.Float32x4.mul(i, s),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        o = SIMD.Float32x4.sub(SIMD.Float32x4.mul(n, s), o),
        l = SIMD.Float32x4.sub(SIMD.Float32x4.mul(i, s), l),
        l = SIMD.Float32x4.swizzle(l, 2, 3, 0, 1),
        s = SIMD.Float32x4.mul(n, r),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        o = SIMD.Float32x4.add(SIMD.Float32x4.mul(a, s), o),
        h = SIMD.Float32x4.mul(i, s),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        o = SIMD.Float32x4.sub(o, SIMD.Float32x4.mul(a, s)),
        h = SIMD.Float32x4.sub(SIMD.Float32x4.mul(i, s), h),
        h = SIMD.Float32x4.swizzle(h, 2, 3, 0, 1),
        s = SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n, 2, 3, 0, 1), a),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        r = SIMD.Float32x4.swizzle(r, 2, 3, 0, 1),
        o = SIMD.Float32x4.add(SIMD.Float32x4.mul(r, s), o),
        u = SIMD.Float32x4.mul(i, s),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        o = SIMD.Float32x4.sub(o, SIMD.Float32x4.mul(r, s)),
        u = SIMD.Float32x4.sub(SIMD.Float32x4.mul(i, s), u),
        u = SIMD.Float32x4.swizzle(u, 2, 3, 0, 1),
        s = SIMD.Float32x4.mul(i, n),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        u = SIMD.Float32x4.add(SIMD.Float32x4.mul(a, s), u),
        h = SIMD.Float32x4.sub(SIMD.Float32x4.mul(r, s), h),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        u = SIMD.Float32x4.sub(SIMD.Float32x4.mul(a, s), u),
        h = SIMD.Float32x4.sub(h, SIMD.Float32x4.mul(r, s)),
        s = SIMD.Float32x4.mul(i, a),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        l = SIMD.Float32x4.sub(l, SIMD.Float32x4.mul(r, s)),
        u = SIMD.Float32x4.add(SIMD.Float32x4.mul(n, s), u),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        l = SIMD.Float32x4.add(SIMD.Float32x4.mul(r, s), l),
        u = SIMD.Float32x4.sub(u, SIMD.Float32x4.mul(n, s)),
        s = SIMD.Float32x4.mul(i, r),
        s = SIMD.Float32x4.swizzle(s, 1, 0, 3, 2),
        l = SIMD.Float32x4.add(SIMD.Float32x4.mul(a, s), l),
        h = SIMD.Float32x4.sub(h, SIMD.Float32x4.mul(n, s)),
        s = SIMD.Float32x4.swizzle(s, 2, 3, 0, 1),
        l = SIMD.Float32x4.sub(l, SIMD.Float32x4.mul(a, s)),
        h = SIMD.Float32x4.add(SIMD.Float32x4.mul(n, s), h),
        c = SIMD.Float32x4.mul(i, o),
        c = SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c, 2, 3, 0, 1), c),
        c = SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c, 1, 0, 3, 2), c),
        s = SIMD.Float32x4.reciprocalApproximation(c),
        c = SIMD.Float32x4.sub(SIMD.Float32x4.add(s, s), SIMD.Float32x4.mul(c, SIMD.Float32x4.mul(s, s))),
        (c = SIMD.Float32x4.swizzle(c, 0, 0, 0, 0)) ? (SIMD.Float32x4.store(t, 0, SIMD.Float32x4.mul(c, o)),
        SIMD.Float32x4.store(t, 4, SIMD.Float32x4.mul(c, l)),
        SIMD.Float32x4.store(t, 8, SIMD.Float32x4.mul(c, u)),
        SIMD.Float32x4.store(t, 12, SIMD.Float32x4.mul(c, h)),
        t) : null
    }
    ,
    r.invert = n.USE_SIMD ? r.SIMD.invert : r.scalar.invert,
    r.scalar.adjoint = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = e[4]
          , o = e[5]
          , l = e[6]
          , u = e[7]
          , h = e[8]
          , c = e[9]
          , d = e[10]
          , p = e[11]
          , f = e[12]
          , g = e[13]
          , m = e[14]
          , v = e[15];
        return t[0] = o * (d * v - p * m) - c * (l * v - u * m) + g * (l * p - u * d),
        t[1] = -(n * (d * v - p * m) - c * (r * v - a * m) + g * (r * p - a * d)),
        t[2] = n * (l * v - u * m) - o * (r * v - a * m) + g * (r * u - a * l),
        t[3] = -(n * (l * p - u * d) - o * (r * p - a * d) + c * (r * u - a * l)),
        t[4] = -(s * (d * v - p * m) - h * (l * v - u * m) + f * (l * p - u * d)),
        t[5] = i * (d * v - p * m) - h * (r * v - a * m) + f * (r * p - a * d),
        t[6] = -(i * (l * v - u * m) - s * (r * v - a * m) + f * (r * u - a * l)),
        t[7] = i * (l * p - u * d) - s * (r * p - a * d) + h * (r * u - a * l),
        t[8] = s * (c * v - p * g) - h * (o * v - u * g) + f * (o * p - u * c),
        t[9] = -(i * (c * v - p * g) - h * (n * v - a * g) + f * (n * p - a * c)),
        t[10] = i * (o * v - u * g) - s * (n * v - a * g) + f * (n * u - a * o),
        t[11] = -(i * (o * p - u * c) - s * (n * p - a * c) + h * (n * u - a * o)),
        t[12] = -(s * (c * m - d * g) - h * (o * m - l * g) + f * (o * d - l * c)),
        t[13] = i * (c * m - d * g) - h * (n * m - r * g) + f * (n * d - r * c),
        t[14] = -(i * (o * m - l * g) - s * (n * m - r * g) + f * (n * l - r * o)),
        t[15] = i * (o * d - l * c) - s * (n * d - r * c) + h * (n * l - r * o),
        t
    }
    ,
    r.SIMD.adjoint = function(t, e) {
        var i, n, r, a, s, o, l, u, h, c, d, p, f, i = SIMD.Float32x4.load(e, 0), n = SIMD.Float32x4.load(e, 4), r = SIMD.Float32x4.load(e, 8), a = SIMD.Float32x4.load(e, 12);
        return h = SIMD.Float32x4.shuffle(i, n, 0, 1, 4, 5),
        o = SIMD.Float32x4.shuffle(r, a, 0, 1, 4, 5),
        s = SIMD.Float32x4.shuffle(h, o, 0, 2, 4, 6),
        o = SIMD.Float32x4.shuffle(o, h, 1, 3, 5, 7),
        h = SIMD.Float32x4.shuffle(i, n, 2, 3, 6, 7),
        u = SIMD.Float32x4.shuffle(r, a, 2, 3, 6, 7),
        l = SIMD.Float32x4.shuffle(h, u, 0, 2, 4, 6),
        u = SIMD.Float32x4.shuffle(u, h, 1, 3, 5, 7),
        h = SIMD.Float32x4.mul(l, u),
        h = SIMD.Float32x4.swizzle(h, 1, 0, 3, 2),
        c = SIMD.Float32x4.mul(o, h),
        d = SIMD.Float32x4.mul(s, h),
        h = SIMD.Float32x4.swizzle(h, 2, 3, 0, 1),
        c = SIMD.Float32x4.sub(SIMD.Float32x4.mul(o, h), c),
        d = SIMD.Float32x4.sub(SIMD.Float32x4.mul(s, h), d),
        d = SIMD.Float32x4.swizzle(d, 2, 3, 0, 1),
        h = SIMD.Float32x4.mul(o, l),
        h = SIMD.Float32x4.swizzle(h, 1, 0, 3, 2),
        c = SIMD.Float32x4.add(SIMD.Float32x4.mul(u, h), c),
        f = SIMD.Float32x4.mul(s, h),
        h = SIMD.Float32x4.swizzle(h, 2, 3, 0, 1),
        c = SIMD.Float32x4.sub(c, SIMD.Float32x4.mul(u, h)),
        f = SIMD.Float32x4.sub(SIMD.Float32x4.mul(s, h), f),
        f = SIMD.Float32x4.swizzle(f, 2, 3, 0, 1),
        h = SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o, 2, 3, 0, 1), u),
        h = SIMD.Float32x4.swizzle(h, 1, 0, 3, 2),
        l = SIMD.Float32x4.swizzle(l, 2, 3, 0, 1),
        c = SIMD.Float32x4.add(SIMD.Float32x4.mul(l, h), c),
        p = SIMD.Float32x4.mul(s, h),
        h = SIMD.Float32x4.swizzle(h, 2, 3, 0, 1),
        c = SIMD.Float32x4.sub(c, SIMD.Float32x4.mul(l, h)),
        p = SIMD.Float32x4.sub(SIMD.Float32x4.mul(s, h), p),
        p = SIMD.Float32x4.swizzle(p, 2, 3, 0, 1),
        h = SIMD.Float32x4.mul(s, o),
        h = SIMD.Float32x4.swizzle(h, 1, 0, 3, 2),
        p = SIMD.Float32x4.add(SIMD.Float32x4.mul(u, h), p),
        f = SIMD.Float32x4.sub(SIMD.Float32x4.mul(l, h), f),
        h = SIMD.Float32x4.swizzle(h, 2, 3, 0, 1),
        p = SIMD.Float32x4.sub(SIMD.Float32x4.mul(u, h), p),
        f = SIMD.Float32x4.sub(f, SIMD.Float32x4.mul(l, h)),
        h = SIMD.Float32x4.mul(s, u),
        h = SIMD.Float32x4.swizzle(h, 1, 0, 3, 2),
        d = SIMD.Float32x4.sub(d, SIMD.Float32x4.mul(l, h)),
        p = SIMD.Float32x4.add(SIMD.Float32x4.mul(o, h), p),
        h = SIMD.Float32x4.swizzle(h, 2, 3, 0, 1),
        d = SIMD.Float32x4.add(SIMD.Float32x4.mul(l, h), d),
        p = SIMD.Float32x4.sub(p, SIMD.Float32x4.mul(o, h)),
        h = SIMD.Float32x4.mul(s, l),
        h = SIMD.Float32x4.swizzle(h, 1, 0, 3, 2),
        d = SIMD.Float32x4.add(SIMD.Float32x4.mul(u, h), d),
        f = SIMD.Float32x4.sub(f, SIMD.Float32x4.mul(o, h)),
        h = SIMD.Float32x4.swizzle(h, 2, 3, 0, 1),
        d = SIMD.Float32x4.sub(d, SIMD.Float32x4.mul(u, h)),
        f = SIMD.Float32x4.add(SIMD.Float32x4.mul(o, h), f),
        SIMD.Float32x4.store(t, 0, c),
        SIMD.Float32x4.store(t, 4, d),
        SIMD.Float32x4.store(t, 8, p),
        SIMD.Float32x4.store(t, 12, f),
        t
    }
    ,
    r.adjoint = n.USE_SIMD ? r.SIMD.adjoint : r.scalar.adjoint,
    r.determinant = function(t) {
        var e = t[0]
          , i = t[1]
          , n = t[2]
          , r = t[3]
          , a = t[4]
          , s = t[5]
          , o = t[6]
          , l = t[7]
          , u = t[8]
          , h = t[9]
          , c = t[10]
          , d = t[11]
          , p = t[12]
          , f = t[13]
          , g = t[14]
          , m = t[15];
        return (e * s - i * a) * (c * m - d * g) - (e * o - n * a) * (h * m - d * f) + (e * l - r * a) * (h * g - c * f) + (i * o - n * s) * (u * m - d * p) - (i * l - r * s) * (u * g - c * p) + (n * l - r * o) * (u * f - h * p)
    }
    ,
    r.SIMD.multiply = function(t, e, i) {
        var n = SIMD.Float32x4.load(e, 0)
          , r = SIMD.Float32x4.load(e, 4)
          , a = SIMD.Float32x4.load(e, 8)
          , s = SIMD.Float32x4.load(e, 12)
          , o = SIMD.Float32x4.load(i, 0)
          , l = SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o, 0, 0, 0, 0), n), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o, 1, 1, 1, 1), r), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o, 2, 2, 2, 2), a), SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o, 3, 3, 3, 3), s))));
        SIMD.Float32x4.store(t, 0, l);
        var u = SIMD.Float32x4.load(i, 4)
          , h = SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u, 0, 0, 0, 0), n), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u, 1, 1, 1, 1), r), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u, 2, 2, 2, 2), a), SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u, 3, 3, 3, 3), s))));
        SIMD.Float32x4.store(t, 4, h);
        var c = SIMD.Float32x4.load(i, 8)
          , d = SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c, 0, 0, 0, 0), n), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c, 1, 1, 1, 1), r), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c, 2, 2, 2, 2), a), SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c, 3, 3, 3, 3), s))));
        SIMD.Float32x4.store(t, 8, d);
        var p = SIMD.Float32x4.load(i, 12)
          , f = SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p, 0, 0, 0, 0), n), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p, 1, 1, 1, 1), r), SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p, 2, 2, 2, 2), a), SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p, 3, 3, 3, 3), s))));
        return SIMD.Float32x4.store(t, 12, f),
        t
    }
    ,
    r.scalar.multiply = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = e[4]
          , l = e[5]
          , u = e[6]
          , h = e[7]
          , c = e[8]
          , d = e[9]
          , p = e[10]
          , f = e[11]
          , g = e[12]
          , m = e[13]
          , v = e[14]
          , _ = e[15]
          , b = i[0]
          , x = i[1]
          , y = i[2]
          , S = i[3];
        return t[0] = b * n + x * o + y * c + S * g,
        t[1] = b * r + x * l + y * d + S * m,
        t[2] = b * a + x * u + y * p + S * v,
        t[3] = b * s + x * h + y * f + S * _,
        b = i[4],
        x = i[5],
        y = i[6],
        S = i[7],
        t[4] = b * n + x * o + y * c + S * g,
        t[5] = b * r + x * l + y * d + S * m,
        t[6] = b * a + x * u + y * p + S * v,
        t[7] = b * s + x * h + y * f + S * _,
        b = i[8],
        x = i[9],
        y = i[10],
        S = i[11],
        t[8] = b * n + x * o + y * c + S * g,
        t[9] = b * r + x * l + y * d + S * m,
        t[10] = b * a + x * u + y * p + S * v,
        t[11] = b * s + x * h + y * f + S * _,
        b = i[12],
        x = i[13],
        y = i[14],
        S = i[15],
        t[12] = b * n + x * o + y * c + S * g,
        t[13] = b * r + x * l + y * d + S * m,
        t[14] = b * a + x * u + y * p + S * v,
        t[15] = b * s + x * h + y * f + S * _,
        t
    }
    ,
    r.multiply = n.USE_SIMD ? r.SIMD.multiply : r.scalar.multiply,
    r.mul = r.multiply,
    r.scalar.translate = function(t, e, i) {
        var n, r, a, s, o, l, u, h, c, d, p, f, g = i[0], m = i[1], v = i[2];
        return e === t ? (t[12] = e[0] * g + e[4] * m + e[8] * v + e[12],
        t[13] = e[1] * g + e[5] * m + e[9] * v + e[13],
        t[14] = e[2] * g + e[6] * m + e[10] * v + e[14],
        t[15] = e[3] * g + e[7] * m + e[11] * v + e[15]) : (n = e[0],
        r = e[1],
        a = e[2],
        s = e[3],
        o = e[4],
        l = e[5],
        u = e[6],
        h = e[7],
        c = e[8],
        d = e[9],
        p = e[10],
        f = e[11],
        t[0] = n,
        t[1] = r,
        t[2] = a,
        t[3] = s,
        t[4] = o,
        t[5] = l,
        t[6] = u,
        t[7] = h,
        t[8] = c,
        t[9] = d,
        t[10] = p,
        t[11] = f,
        t[12] = n * g + o * m + c * v + e[12],
        t[13] = r * g + l * m + d * v + e[13],
        t[14] = a * g + u * m + p * v + e[14],
        t[15] = s * g + h * m + f * v + e[15]),
        t
    }
    ,
    r.SIMD.translate = function(t, e, i) {
        var n = SIMD.Float32x4.load(e, 0)
          , r = SIMD.Float32x4.load(e, 4)
          , a = SIMD.Float32x4.load(e, 8)
          , s = SIMD.Float32x4.load(e, 12)
          , o = SIMD.Float32x4(i[0], i[1], i[2], 0);
        e !== t && (t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[4] = e[4],
        t[5] = e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[8] = e[8],
        t[9] = e[9],
        t[10] = e[10],
        t[11] = e[11]),
        n = SIMD.Float32x4.mul(n, SIMD.Float32x4.swizzle(o, 0, 0, 0, 0)),
        r = SIMD.Float32x4.mul(r, SIMD.Float32x4.swizzle(o, 1, 1, 1, 1)),
        a = SIMD.Float32x4.mul(a, SIMD.Float32x4.swizzle(o, 2, 2, 2, 2));
        var l = SIMD.Float32x4.add(n, SIMD.Float32x4.add(r, SIMD.Float32x4.add(a, s)));
        return SIMD.Float32x4.store(t, 12, l),
        t
    }
    ,
    r.translate = n.USE_SIMD ? r.SIMD.translate : r.scalar.translate,
    r.scalar.scale = function(t, e, i) {
        var n = i[0]
          , r = i[1]
          , a = i[2];
        return t[0] = e[0] * n,
        t[1] = e[1] * n,
        t[2] = e[2] * n,
        t[3] = e[3] * n,
        t[4] = e[4] * r,
        t[5] = e[5] * r,
        t[6] = e[6] * r,
        t[7] = e[7] * r,
        t[8] = e[8] * a,
        t[9] = e[9] * a,
        t[10] = e[10] * a,
        t[11] = e[11] * a,
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15],
        t
    }
    ,
    r.SIMD.scale = function(t, e, i) {
        var n, r, a, s = SIMD.Float32x4(i[0], i[1], i[2], 0);
        return n = SIMD.Float32x4.load(e, 0),
        SIMD.Float32x4.store(t, 0, SIMD.Float32x4.mul(n, SIMD.Float32x4.swizzle(s, 0, 0, 0, 0))),
        r = SIMD.Float32x4.load(e, 4),
        SIMD.Float32x4.store(t, 4, SIMD.Float32x4.mul(r, SIMD.Float32x4.swizzle(s, 1, 1, 1, 1))),
        a = SIMD.Float32x4.load(e, 8),
        SIMD.Float32x4.store(t, 8, SIMD.Float32x4.mul(a, SIMD.Float32x4.swizzle(s, 2, 2, 2, 2))),
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15],
        t
    }
    ,
    r.scale = n.USE_SIMD ? r.SIMD.scale : r.scalar.scale,
    r.rotate = function(t, e, i, r) {
        var a, s, o, l, u, h, c, d, p, f, g, m, v, _, b, x, y, S, w, C, M, T, A, E, P = r[0], N = r[1], k = r[2], F = Math.sqrt(P * P + N * N + k * k);
        return Math.abs(F) < n.EPSILON ? null : (F = 1 / F,
        P *= F,
        N *= F,
        k *= F,
        a = Math.sin(i),
        s = Math.cos(i),
        o = 1 - s,
        l = e[0],
        u = e[1],
        h = e[2],
        c = e[3],
        d = e[4],
        p = e[5],
        f = e[6],
        g = e[7],
        m = e[8],
        v = e[9],
        _ = e[10],
        b = e[11],
        x = P * P * o + s,
        y = N * P * o + k * a,
        S = k * P * o - N * a,
        w = P * N * o - k * a,
        C = N * N * o + s,
        M = k * N * o + P * a,
        T = P * k * o + N * a,
        A = N * k * o - P * a,
        E = k * k * o + s,
        t[0] = l * x + d * y + m * S,
        t[1] = u * x + p * y + v * S,
        t[2] = h * x + f * y + _ * S,
        t[3] = c * x + g * y + b * S,
        t[4] = l * w + d * C + m * M,
        t[5] = u * w + p * C + v * M,
        t[6] = h * w + f * C + _ * M,
        t[7] = c * w + g * C + b * M,
        t[8] = l * T + d * A + m * E,
        t[9] = u * T + p * A + v * E,
        t[10] = h * T + f * A + _ * E,
        t[11] = c * T + g * A + b * E,
        e !== t && (t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]),
        t)
    }
    ,
    r.scalar.rotateX = function(t, e, i) {
        var n = Math.sin(i)
          , r = Math.cos(i)
          , a = e[4]
          , s = e[5]
          , o = e[6]
          , l = e[7]
          , u = e[8]
          , h = e[9]
          , c = e[10]
          , d = e[11];
        return e !== t && (t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]),
        t[4] = a * r + u * n,
        t[5] = s * r + h * n,
        t[6] = o * r + c * n,
        t[7] = l * r + d * n,
        t[8] = u * r - a * n,
        t[9] = h * r - s * n,
        t[10] = c * r - o * n,
        t[11] = d * r - l * n,
        t
    }
    ,
    r.SIMD.rotateX = function(t, e, i) {
        var n = SIMD.Float32x4.splat(Math.sin(i))
          , r = SIMD.Float32x4.splat(Math.cos(i));
        e !== t && (t[0] = e[0],
        t[1] = e[1],
        t[2] = e[2],
        t[3] = e[3],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]);
        var a = SIMD.Float32x4.load(e, 4)
          , s = SIMD.Float32x4.load(e, 8);
        return SIMD.Float32x4.store(t, 4, SIMD.Float32x4.add(SIMD.Float32x4.mul(a, r), SIMD.Float32x4.mul(s, n))),
        SIMD.Float32x4.store(t, 8, SIMD.Float32x4.sub(SIMD.Float32x4.mul(s, r), SIMD.Float32x4.mul(a, n))),
        t
    }
    ,
    r.rotateX = n.USE_SIMD ? r.SIMD.rotateX : r.scalar.rotateX,
    r.scalar.rotateY = function(t, e, i) {
        var n = Math.sin(i)
          , r = Math.cos(i)
          , a = e[0]
          , s = e[1]
          , o = e[2]
          , l = e[3]
          , u = e[8]
          , h = e[9]
          , c = e[10]
          , d = e[11];
        return e !== t && (t[4] = e[4],
        t[5] = e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]),
        t[0] = a * r - u * n,
        t[1] = s * r - h * n,
        t[2] = o * r - c * n,
        t[3] = l * r - d * n,
        t[8] = a * n + u * r,
        t[9] = s * n + h * r,
        t[10] = o * n + c * r,
        t[11] = l * n + d * r,
        t
    }
    ,
    r.SIMD.rotateY = function(t, e, i) {
        var n = SIMD.Float32x4.splat(Math.sin(i))
          , r = SIMD.Float32x4.splat(Math.cos(i));
        e !== t && (t[4] = e[4],
        t[5] = e[5],
        t[6] = e[6],
        t[7] = e[7],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]);
        var a = SIMD.Float32x4.load(e, 0)
          , s = SIMD.Float32x4.load(e, 8);
        return SIMD.Float32x4.store(t, 0, SIMD.Float32x4.sub(SIMD.Float32x4.mul(a, r), SIMD.Float32x4.mul(s, n))),
        SIMD.Float32x4.store(t, 8, SIMD.Float32x4.add(SIMD.Float32x4.mul(a, n), SIMD.Float32x4.mul(s, r))),
        t
    }
    ,
    r.rotateY = n.USE_SIMD ? r.SIMD.rotateY : r.scalar.rotateY,
    r.scalar.rotateZ = function(t, e, i) {
        var n = Math.sin(i)
          , r = Math.cos(i)
          , a = e[0]
          , s = e[1]
          , o = e[2]
          , l = e[3]
          , u = e[4]
          , h = e[5]
          , c = e[6]
          , d = e[7];
        return e !== t && (t[8] = e[8],
        t[9] = e[9],
        t[10] = e[10],
        t[11] = e[11],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]),
        t[0] = a * r + u * n,
        t[1] = s * r + h * n,
        t[2] = o * r + c * n,
        t[3] = l * r + d * n,
        t[4] = u * r - a * n,
        t[5] = h * r - s * n,
        t[6] = c * r - o * n,
        t[7] = d * r - l * n,
        t
    }
    ,
    r.SIMD.rotateZ = function(t, e, i) {
        var n = SIMD.Float32x4.splat(Math.sin(i))
          , r = SIMD.Float32x4.splat(Math.cos(i));
        e !== t && (t[8] = e[8],
        t[9] = e[9],
        t[10] = e[10],
        t[11] = e[11],
        t[12] = e[12],
        t[13] = e[13],
        t[14] = e[14],
        t[15] = e[15]);
        var a = SIMD.Float32x4.load(e, 0)
          , s = SIMD.Float32x4.load(e, 4);
        return SIMD.Float32x4.store(t, 0, SIMD.Float32x4.add(SIMD.Float32x4.mul(a, r), SIMD.Float32x4.mul(s, n))),
        SIMD.Float32x4.store(t, 4, SIMD.Float32x4.sub(SIMD.Float32x4.mul(s, r), SIMD.Float32x4.mul(a, n))),
        t
    }
    ,
    r.rotateZ = n.USE_SIMD ? r.SIMD.rotateZ : r.scalar.rotateZ,
    r.fromTranslation = function(t, e) {
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = 1,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = 1,
        t[11] = 0,
        t[12] = e[0],
        t[13] = e[1],
        t[14] = e[2],
        t[15] = 1,
        t
    }
    ,
    r.fromScaling = function(t, e) {
        return t[0] = e[0],
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = e[1],
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = e[2],
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.fromRotation = function(t, e, i) {
        var r, a, s, o = i[0], l = i[1], u = i[2], h = Math.sqrt(o * o + l * l + u * u);
        return Math.abs(h) < n.EPSILON ? null : (h = 1 / h,
        o *= h,
        l *= h,
        u *= h,
        r = Math.sin(e),
        a = Math.cos(e),
        s = 1 - a,
        t[0] = o * o * s + a,
        t[1] = l * o * s + u * r,
        t[2] = u * o * s - l * r,
        t[3] = 0,
        t[4] = o * l * s - u * r,
        t[5] = l * l * s + a,
        t[6] = u * l * s + o * r,
        t[7] = 0,
        t[8] = o * u * s + l * r,
        t[9] = l * u * s - o * r,
        t[10] = u * u * s + a,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t)
    }
    ,
    r.fromXRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = 1,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = n,
        t[6] = i,
        t[7] = 0,
        t[8] = 0,
        t[9] = -i,
        t[10] = n,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.fromYRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = n,
        t[1] = 0,
        t[2] = -i,
        t[3] = 0,
        t[4] = 0,
        t[5] = 1,
        t[6] = 0,
        t[7] = 0,
        t[8] = i,
        t[9] = 0,
        t[10] = n,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.fromZRotation = function(t, e) {
        var i = Math.sin(e)
          , n = Math.cos(e);
        return t[0] = n,
        t[1] = i,
        t[2] = 0,
        t[3] = 0,
        t[4] = -i,
        t[5] = n,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = 1,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.fromRotationTranslation = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = n + n
          , l = r + r
          , u = a + a
          , h = n * o
          , c = n * l
          , d = n * u
          , p = r * l
          , f = r * u
          , g = a * u
          , m = s * o
          , v = s * l
          , _ = s * u;
        return t[0] = 1 - (p + g),
        t[1] = c + _,
        t[2] = d - v,
        t[3] = 0,
        t[4] = c - _,
        t[5] = 1 - (h + g),
        t[6] = f + m,
        t[7] = 0,
        t[8] = d + v,
        t[9] = f - m,
        t[10] = 1 - (h + p),
        t[11] = 0,
        t[12] = i[0],
        t[13] = i[1],
        t[14] = i[2],
        t[15] = 1,
        t
    }
    ,
    r.getTranslation = function(t, e) {
        return t[0] = e[12],
        t[1] = e[13],
        t[2] = e[14],
        t
    }
    ,
    r.getRotation = function(t, e) {
        var i = e[0] + e[5] + e[10]
          , n = 0;
        return i > 0 ? (n = 2 * Math.sqrt(i + 1),
        t[3] = .25 * n,
        t[0] = (e[6] - e[9]) / n,
        t[1] = (e[8] - e[2]) / n,
        t[2] = (e[1] - e[4]) / n) : e[0] > e[5] & e[0] > e[10] ? (n = 2 * Math.sqrt(1 + e[0] - e[5] - e[10]),
        t[3] = (e[6] - e[9]) / n,
        t[0] = .25 * n,
        t[1] = (e[1] + e[4]) / n,
        t[2] = (e[8] + e[2]) / n) : e[5] > e[10] ? (n = 2 * Math.sqrt(1 + e[5] - e[0] - e[10]),
        t[3] = (e[8] - e[2]) / n,
        t[0] = (e[1] + e[4]) / n,
        t[1] = .25 * n,
        t[2] = (e[6] + e[9]) / n) : (n = 2 * Math.sqrt(1 + e[10] - e[0] - e[5]),
        t[3] = (e[1] - e[4]) / n,
        t[0] = (e[8] + e[2]) / n,
        t[1] = (e[6] + e[9]) / n,
        t[2] = .25 * n),
        t
    }
    ,
    r.fromRotationTranslationScale = function(t, e, i, n) {
        var r = e[0]
          , a = e[1]
          , s = e[2]
          , o = e[3]
          , l = r + r
          , u = a + a
          , h = s + s
          , c = r * l
          , d = r * u
          , p = r * h
          , f = a * u
          , g = a * h
          , m = s * h
          , v = o * l
          , _ = o * u
          , b = o * h
          , x = n[0]
          , y = n[1]
          , S = n[2];
        return t[0] = (1 - (f + m)) * x,
        t[1] = (d + b) * x,
        t[2] = (p - _) * x,
        t[3] = 0,
        t[4] = (d - b) * y,
        t[5] = (1 - (c + m)) * y,
        t[6] = (g + v) * y,
        t[7] = 0,
        t[8] = (p + _) * S,
        t[9] = (g - v) * S,
        t[10] = (1 - (c + f)) * S,
        t[11] = 0,
        t[12] = i[0],
        t[13] = i[1],
        t[14] = i[2],
        t[15] = 1,
        t
    }
    ,
    r.fromRotationTranslationScaleOrigin = function(t, e, i, n, r) {
        var a = e[0]
          , s = e[1]
          , o = e[2]
          , l = e[3]
          , u = a + a
          , h = s + s
          , c = o + o
          , d = a * u
          , p = a * h
          , f = a * c
          , g = s * h
          , m = s * c
          , v = o * c
          , _ = l * u
          , b = l * h
          , x = l * c
          , y = n[0]
          , S = n[1]
          , w = n[2]
          , C = r[0]
          , M = r[1]
          , T = r[2];
        return t[0] = (1 - (g + v)) * y,
        t[1] = (p + x) * y,
        t[2] = (f - b) * y,
        t[3] = 0,
        t[4] = (p - x) * S,
        t[5] = (1 - (d + v)) * S,
        t[6] = (m + _) * S,
        t[7] = 0,
        t[8] = (f + b) * w,
        t[9] = (m - _) * w,
        t[10] = (1 - (d + g)) * w,
        t[11] = 0,
        t[12] = i[0] + C - (t[0] * C + t[4] * M + t[8] * T),
        t[13] = i[1] + M - (t[1] * C + t[5] * M + t[9] * T),
        t[14] = i[2] + T - (t[2] * C + t[6] * M + t[10] * T),
        t[15] = 1,
        t
    }
    ,
    r.fromQuat = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = i + i
          , o = n + n
          , l = r + r
          , u = i * s
          , h = n * s
          , c = n * o
          , d = r * s
          , p = r * o
          , f = r * l
          , g = a * s
          , m = a * o
          , v = a * l;
        return t[0] = 1 - c - f,
        t[1] = h + v,
        t[2] = d - m,
        t[3] = 0,
        t[4] = h - v,
        t[5] = 1 - u - f,
        t[6] = p + g,
        t[7] = 0,
        t[8] = d + m,
        t[9] = p - g,
        t[10] = 1 - u - c,
        t[11] = 0,
        t[12] = 0,
        t[13] = 0,
        t[14] = 0,
        t[15] = 1,
        t
    }
    ,
    r.frustum = function(t, e, i, n, r, a, s) {
        var o = 1 / (i - e)
          , l = 1 / (r - n)
          , u = 1 / (a - s);
        return t[0] = 2 * a * o,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = 2 * a * l,
        t[6] = 0,
        t[7] = 0,
        t[8] = (i + e) * o,
        t[9] = (r + n) * l,
        t[10] = (s + a) * u,
        t[11] = -1,
        t[12] = 0,
        t[13] = 0,
        t[14] = s * a * 2 * u,
        t[15] = 0,
        t
    }
    ,
    r.perspective = function(t, e, i, n, r) {
        var a = 1 / Math.tan(e / 2)
          , s = 1 / (n - r);
        return t[0] = a / i,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = a,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = (r + n) * s,
        t[11] = -1,
        t[12] = 0,
        t[13] = 0,
        t[14] = 2 * r * n * s,
        t[15] = 0,
        t
    }
    ,
    r.perspectiveFromFieldOfView = function(t, e, i, n) {
        var r = Math.tan(e.upDegrees * Math.PI / 180)
          , a = Math.tan(e.downDegrees * Math.PI / 180)
          , s = Math.tan(e.leftDegrees * Math.PI / 180)
          , o = Math.tan(e.rightDegrees * Math.PI / 180)
          , l = 2 / (s + o)
          , u = 2 / (r + a);
        return t[0] = l,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = u,
        t[6] = 0,
        t[7] = 0,
        t[8] = -(s - o) * l * .5,
        t[9] = (r - a) * u * .5,
        t[10] = n / (i - n),
        t[11] = -1,
        t[12] = 0,
        t[13] = 0,
        t[14] = n * i / (i - n),
        t[15] = 0,
        t
    }
    ,
    r.ortho = function(t, e, i, n, r, a, s) {
        var o = 1 / (e - i)
          , l = 1 / (n - r)
          , u = 1 / (a - s);
        return t[0] = -2 * o,
        t[1] = 0,
        t[2] = 0,
        t[3] = 0,
        t[4] = 0,
        t[5] = -2 * l,
        t[6] = 0,
        t[7] = 0,
        t[8] = 0,
        t[9] = 0,
        t[10] = 2 * u,
        t[11] = 0,
        t[12] = (e + i) * o,
        t[13] = (r + n) * l,
        t[14] = (s + a) * u,
        t[15] = 1,
        t
    }
    ,
    r.lookAt = function(t, e, i, a) {
        var s, o, l, u, h, c, d, p, f, g, m = e[0], v = e[1], _ = e[2], b = a[0], x = a[1], y = a[2], S = i[0], w = i[1], C = i[2];
        return Math.abs(m - S) < n.EPSILON && Math.abs(v - w) < n.EPSILON && Math.abs(_ - C) < n.EPSILON ? r.identity(t) : (d = m - S,
        p = v - w,
        f = _ - C,
        g = 1 / Math.sqrt(d * d + p * p + f * f),
        d *= g,
        p *= g,
        f *= g,
        s = x * f - y * p,
        o = y * d - b * f,
        l = b * p - x * d,
        g = Math.sqrt(s * s + o * o + l * l),
        g ? (g = 1 / g,
        s *= g,
        o *= g,
        l *= g) : (s = 0,
        o = 0,
        l = 0),
        u = p * l - f * o,
        h = f * s - d * l,
        c = d * o - p * s,
        g = Math.sqrt(u * u + h * h + c * c),
        g ? (g = 1 / g,
        u *= g,
        h *= g,
        c *= g) : (u = 0,
        h = 0,
        c = 0),
        t[0] = s,
        t[1] = u,
        t[2] = d,
        t[3] = 0,
        t[4] = o,
        t[5] = h,
        t[6] = p,
        t[7] = 0,
        t[8] = l,
        t[9] = c,
        t[10] = f,
        t[11] = 0,
        t[12] = -(s * m + o * v + l * _),
        t[13] = -(u * m + h * v + c * _),
        t[14] = -(d * m + p * v + f * _),
        t[15] = 1,
        t)
    }
    ,
    r.str = function(t) {
        return "mat4(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ", " + t[4] + ", " + t[5] + ", " + t[6] + ", " + t[7] + ", " + t[8] + ", " + t[9] + ", " + t[10] + ", " + t[11] + ", " + t[12] + ", " + t[13] + ", " + t[14] + ", " + t[15] + ")"
    }
    ,
    r.frob = function(t) {
        return Math.sqrt(Math.pow(t[0], 2) + Math.pow(t[1], 2) + Math.pow(t[2], 2) + Math.pow(t[3], 2) + Math.pow(t[4], 2) + Math.pow(t[5], 2) + Math.pow(t[6], 2) + Math.pow(t[7], 2) + Math.pow(t[8], 2) + Math.pow(t[9], 2) + Math.pow(t[10], 2) + Math.pow(t[11], 2) + Math.pow(t[12], 2) + Math.pow(t[13], 2) + Math.pow(t[14], 2) + Math.pow(t[15], 2))
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t[2] = e[2] + i[2],
        t[3] = e[3] + i[3],
        t[4] = e[4] + i[4],
        t[5] = e[5] + i[5],
        t[6] = e[6] + i[6],
        t[7] = e[7] + i[7],
        t[8] = e[8] + i[8],
        t[9] = e[9] + i[9],
        t[10] = e[10] + i[10],
        t[11] = e[11] + i[11],
        t[12] = e[12] + i[12],
        t[13] = e[13] + i[13],
        t[14] = e[14] + i[14],
        t[15] = e[15] + i[15],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t[2] = e[2] - i[2],
        t[3] = e[3] - i[3],
        t[4] = e[4] - i[4],
        t[5] = e[5] - i[5],
        t[6] = e[6] - i[6],
        t[7] = e[7] - i[7],
        t[8] = e[8] - i[8],
        t[9] = e[9] - i[9],
        t[10] = e[10] - i[10],
        t[11] = e[11] - i[11],
        t[12] = e[12] - i[12],
        t[13] = e[13] - i[13],
        t[14] = e[14] - i[14],
        t[15] = e[15] - i[15],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiplyScalar = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t[2] = e[2] * i,
        t[3] = e[3] * i,
        t[4] = e[4] * i,
        t[5] = e[5] * i,
        t[6] = e[6] * i,
        t[7] = e[7] * i,
        t[8] = e[8] * i,
        t[9] = e[9] * i,
        t[10] = e[10] * i,
        t[11] = e[11] * i,
        t[12] = e[12] * i,
        t[13] = e[13] * i,
        t[14] = e[14] * i,
        t[15] = e[15] * i,
        t
    }
    ,
    r.multiplyScalarAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t[2] = e[2] + i[2] * n,
        t[3] = e[3] + i[3] * n,
        t[4] = e[4] + i[4] * n,
        t[5] = e[5] + i[5] * n,
        t[6] = e[6] + i[6] * n,
        t[7] = e[7] + i[7] * n,
        t[8] = e[8] + i[8] * n,
        t[9] = e[9] + i[9] * n,
        t[10] = e[10] + i[10] * n,
        t[11] = e[11] + i[11] * n,
        t[12] = e[12] + i[12] * n,
        t[13] = e[13] + i[13] * n,
        t[14] = e[14] + i[14] * n,
        t[15] = e[15] + i[15] * n,
        t
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3] && t[4] === e[4] && t[5] === e[5] && t[6] === e[6] && t[7] === e[7] && t[8] === e[8] && t[9] === e[9] && t[10] === e[10] && t[11] === e[11] && t[12] === e[12] && t[13] === e[13] && t[14] === e[14] && t[15] === e[15]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = t[2]
          , s = t[3]
          , o = t[4]
          , l = t[5]
          , u = t[6]
          , h = t[7]
          , c = t[8]
          , d = t[9]
          , p = t[10]
          , f = t[11]
          , g = t[12]
          , m = t[13]
          , v = t[14]
          , _ = t[15]
          , b = e[0]
          , x = e[1]
          , y = e[2]
          , S = e[3]
          , w = e[4]
          , C = e[5]
          , M = e[6]
          , T = e[7]
          , A = e[8]
          , E = e[9]
          , P = e[10]
          , N = e[11]
          , k = e[12]
          , F = e[13]
          , D = e[14]
          , R = e[15];
        return Math.abs(i - b) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(b)) && Math.abs(r - x) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(x)) && Math.abs(a - y) <= n.EPSILON * Math.max(1, Math.abs(a), Math.abs(y)) && Math.abs(s - S) <= n.EPSILON * Math.max(1, Math.abs(s), Math.abs(S)) && Math.abs(o - w) <= n.EPSILON * Math.max(1, Math.abs(o), Math.abs(w)) && Math.abs(l - C) <= n.EPSILON * Math.max(1, Math.abs(l), Math.abs(C)) && Math.abs(u - M) <= n.EPSILON * Math.max(1, Math.abs(u), Math.abs(M)) && Math.abs(h - T) <= n.EPSILON * Math.max(1, Math.abs(h), Math.abs(T)) && Math.abs(c - A) <= n.EPSILON * Math.max(1, Math.abs(c), Math.abs(A)) && Math.abs(d - E) <= n.EPSILON * Math.max(1, Math.abs(d), Math.abs(E)) && Math.abs(p - P) <= n.EPSILON * Math.max(1, Math.abs(p), Math.abs(P)) && Math.abs(f - N) <= n.EPSILON * Math.max(1, Math.abs(f), Math.abs(N)) && Math.abs(g - k) <= n.EPSILON * Math.max(1, Math.abs(g), Math.abs(k)) && Math.abs(m - F) <= n.EPSILON * Math.max(1, Math.abs(m), Math.abs(F)) && Math.abs(v - D) <= n.EPSILON * Math.max(1, Math.abs(v), Math.abs(D)) && Math.abs(_ - R) <= n.EPSILON * Math.max(1, Math.abs(_), Math.abs(R))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n = i(319)
      , r = i(597)
      , a = i(598)
      , s = i(599)
      , o = {};
    o.create = function() {
        var t = new n.ARRAY_TYPE(4);
        return t[0] = 0,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t
    }
    ,
    o.rotationTo = function() {
        var t = a.create()
          , e = a.fromValues(1, 0, 0)
          , i = a.fromValues(0, 1, 0);
        return function(n, r, s) {
            var l = a.dot(r, s);
            return l < -.999999 ? (a.cross(t, e, r),
            a.length(t) < 1e-6 && a.cross(t, i, r),
            a.normalize(t, t),
            o.setAxisAngle(n, t, Math.PI),
            n) : l > .999999 ? (n[0] = 0,
            n[1] = 0,
            n[2] = 0,
            n[3] = 1,
            n) : (a.cross(t, r, s),
            n[0] = t[0],
            n[1] = t[1],
            n[2] = t[2],
            n[3] = 1 + l,
            o.normalize(n, n))
        }
    }(),
    o.setAxes = function() {
        var t = r.create();
        return function(e, i, n, r) {
            return t[0] = n[0],
            t[3] = n[1],
            t[6] = n[2],
            t[1] = r[0],
            t[4] = r[1],
            t[7] = r[2],
            t[2] = -i[0],
            t[5] = -i[1],
            t[8] = -i[2],
            o.normalize(e, o.fromMat3(e, t))
        }
    }(),
    o.clone = s.clone,
    o.fromValues = s.fromValues,
    o.copy = s.copy,
    o.set = s.set,
    o.identity = function(t) {
        return t[0] = 0,
        t[1] = 0,
        t[2] = 0,
        t[3] = 1,
        t
    }
    ,
    o.setAxisAngle = function(t, e, i) {
        i *= .5;
        var n = Math.sin(i);
        return t[0] = n * e[0],
        t[1] = n * e[1],
        t[2] = n * e[2],
        t[3] = Math.cos(i),
        t
    }
    ,
    o.getAxisAngle = function(t, e) {
        var i = 2 * Math.acos(e[3])
          , n = Math.sin(i / 2);
        return 0 != n ? (t[0] = e[0] / n,
        t[1] = e[1] / n,
        t[2] = e[2] / n) : (t[0] = 1,
        t[1] = 0,
        t[2] = 0),
        i
    }
    ,
    o.add = s.add,
    o.multiply = function(t, e, i) {
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = i[0]
          , l = i[1]
          , u = i[2]
          , h = i[3];
        return t[0] = n * h + s * o + r * u - a * l,
        t[1] = r * h + s * l + a * o - n * u,
        t[2] = a * h + s * u + n * l - r * o,
        t[3] = s * h - n * o - r * l - a * u,
        t
    }
    ,
    o.mul = o.multiply,
    o.scale = s.scale,
    o.rotateX = function(t, e, i) {
        i *= .5;
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = Math.sin(i)
          , l = Math.cos(i);
        return t[0] = n * l + s * o,
        t[1] = r * l + a * o,
        t[2] = a * l - r * o,
        t[3] = s * l - n * o,
        t
    }
    ,
    o.rotateY = function(t, e, i) {
        i *= .5;
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = Math.sin(i)
          , l = Math.cos(i);
        return t[0] = n * l - a * o,
        t[1] = r * l + s * o,
        t[2] = a * l + n * o,
        t[3] = s * l - r * o,
        t
    }
    ,
    o.rotateZ = function(t, e, i) {
        i *= .5;
        var n = e[0]
          , r = e[1]
          , a = e[2]
          , s = e[3]
          , o = Math.sin(i)
          , l = Math.cos(i);
        return t[0] = n * l + r * o,
        t[1] = r * l - n * o,
        t[2] = a * l + s * o,
        t[3] = s * l - a * o,
        t
    }
    ,
    o.calculateW = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2];
        return t[0] = i,
        t[1] = n,
        t[2] = r,
        t[3] = Math.sqrt(Math.abs(1 - i * i - n * n - r * r)),
        t
    }
    ,
    o.dot = s.dot,
    o.lerp = s.lerp,
    o.slerp = function(t, e, i, n) {
        var r, a, s, o, l, u = e[0], h = e[1], c = e[2], d = e[3], p = i[0], f = i[1], g = i[2], m = i[3];
        return a = u * p + h * f + c * g + d * m,
        a < 0 && (a = -a,
        p = -p,
        f = -f,
        g = -g,
        m = -m),
        1 - a > 1e-6 ? (r = Math.acos(a),
        s = Math.sin(r),
        o = Math.sin((1 - n) * r) / s,
        l = Math.sin(n * r) / s) : (o = 1 - n,
        l = n),
        t[0] = o * u + l * p,
        t[1] = o * h + l * f,
        t[2] = o * c + l * g,
        t[3] = o * d + l * m,
        t
    }
    ,
    o.sqlerp = function() {
        var t = o.create()
          , e = o.create();
        return function(i, n, r, a, s, l) {
            return o.slerp(t, n, s, l),
            o.slerp(e, r, a, l),
            o.slerp(i, t, e, 2 * l * (1 - l)),
            i
        }
    }(),
    o.invert = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = e[2]
          , a = e[3]
          , s = i * i + n * n + r * r + a * a
          , o = s ? 1 / s : 0;
        return t[0] = -i * o,
        t[1] = -n * o,
        t[2] = -r * o,
        t[3] = a * o,
        t
    }
    ,
    o.conjugate = function(t, e) {
        return t[0] = -e[0],
        t[1] = -e[1],
        t[2] = -e[2],
        t[3] = e[3],
        t
    }
    ,
    o.length = s.length,
    o.len = o.length,
    o.squaredLength = s.squaredLength,
    o.sqrLen = o.squaredLength,
    o.normalize = s.normalize,
    o.fromMat3 = function(t, e) {
        var i, n = e[0] + e[4] + e[8];
        if (n > 0)
            i = Math.sqrt(n + 1),
            t[3] = .5 * i,
            i = .5 / i,
            t[0] = (e[5] - e[7]) * i,
            t[1] = (e[6] - e[2]) * i,
            t[2] = (e[1] - e[3]) * i;
        else {
            var r = 0;
            e[4] > e[0] && (r = 1),
            e[8] > e[3 * r + r] && (r = 2);
            var a = (r + 1) % 3
              , s = (r + 2) % 3;
            i = Math.sqrt(e[3 * r + r] - e[3 * a + a] - e[3 * s + s] + 1),
            t[r] = .5 * i,
            i = .5 / i,
            t[3] = (e[3 * a + s] - e[3 * s + a]) * i,
            t[a] = (e[3 * a + r] + e[3 * r + a]) * i,
            t[s] = (e[3 * s + r] + e[3 * r + s]) * i
        }
        return t
    }
    ,
    o.str = function(t) {
        return "quat(" + t[0] + ", " + t[1] + ", " + t[2] + ", " + t[3] + ")"
    }
    ,
    o.exactEquals = s.exactEquals,
    o.equals = s.equals,
    t.exports = o
}
, function(t, e, i) {
    var n = i(319)
      , r = {};
    r.create = function() {
        var t = new n.ARRAY_TYPE(2);
        return t[0] = 0,
        t[1] = 0,
        t
    }
    ,
    r.clone = function(t) {
        var e = new n.ARRAY_TYPE(2);
        return e[0] = t[0],
        e[1] = t[1],
        e
    }
    ,
    r.fromValues = function(t, e) {
        var i = new n.ARRAY_TYPE(2);
        return i[0] = t,
        i[1] = e,
        i
    }
    ,
    r.copy = function(t, e) {
        return t[0] = e[0],
        t[1] = e[1],
        t
    }
    ,
    r.set = function(t, e, i) {
        return t[0] = e,
        t[1] = i,
        t
    }
    ,
    r.add = function(t, e, i) {
        return t[0] = e[0] + i[0],
        t[1] = e[1] + i[1],
        t
    }
    ,
    r.subtract = function(t, e, i) {
        return t[0] = e[0] - i[0],
        t[1] = e[1] - i[1],
        t
    }
    ,
    r.sub = r.subtract,
    r.multiply = function(t, e, i) {
        return t[0] = e[0] * i[0],
        t[1] = e[1] * i[1],
        t
    }
    ,
    r.mul = r.multiply,
    r.divide = function(t, e, i) {
        return t[0] = e[0] / i[0],
        t[1] = e[1] / i[1],
        t
    }
    ,
    r.div = r.divide,
    r.ceil = function(t, e) {
        return t[0] = Math.ceil(e[0]),
        t[1] = Math.ceil(e[1]),
        t
    }
    ,
    r.floor = function(t, e) {
        return t[0] = Math.floor(e[0]),
        t[1] = Math.floor(e[1]),
        t
    }
    ,
    r.min = function(t, e, i) {
        return t[0] = Math.min(e[0], i[0]),
        t[1] = Math.min(e[1], i[1]),
        t
    }
    ,
    r.max = function(t, e, i) {
        return t[0] = Math.max(e[0], i[0]),
        t[1] = Math.max(e[1], i[1]),
        t
    }
    ,
    r.round = function(t, e) {
        return t[0] = Math.round(e[0]),
        t[1] = Math.round(e[1]),
        t
    }
    ,
    r.scale = function(t, e, i) {
        return t[0] = e[0] * i,
        t[1] = e[1] * i,
        t
    }
    ,
    r.scaleAndAdd = function(t, e, i, n) {
        return t[0] = e[0] + i[0] * n,
        t[1] = e[1] + i[1] * n,
        t
    }
    ,
    r.distance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1];
        return Math.sqrt(i * i + n * n)
    }
    ,
    r.dist = r.distance,
    r.squaredDistance = function(t, e) {
        var i = e[0] - t[0]
          , n = e[1] - t[1];
        return i * i + n * n
    }
    ,
    r.sqrDist = r.squaredDistance,
    r.length = function(t) {
        var e = t[0]
          , i = t[1];
        return Math.sqrt(e * e + i * i)
    }
    ,
    r.len = r.length,
    r.squaredLength = function(t) {
        var e = t[0]
          , i = t[1];
        return e * e + i * i
    }
    ,
    r.sqrLen = r.squaredLength,
    r.negate = function(t, e) {
        return t[0] = -e[0],
        t[1] = -e[1],
        t
    }
    ,
    r.inverse = function(t, e) {
        return t[0] = 1 / e[0],
        t[1] = 1 / e[1],
        t
    }
    ,
    r.normalize = function(t, e) {
        var i = e[0]
          , n = e[1]
          , r = i * i + n * n;
        return r > 0 && (r = 1 / Math.sqrt(r),
        t[0] = e[0] * r,
        t[1] = e[1] * r),
        t
    }
    ,
    r.dot = function(t, e) {
        return t[0] * e[0] + t[1] * e[1]
    }
    ,
    r.cross = function(t, e, i) {
        var n = e[0] * i[1] - e[1] * i[0];
        return t[0] = t[1] = 0,
        t[2] = n,
        t
    }
    ,
    r.lerp = function(t, e, i, n) {
        var r = e[0]
          , a = e[1];
        return t[0] = r + n * (i[0] - r),
        t[1] = a + n * (i[1] - a),
        t
    }
    ,
    r.random = function(t, e) {
        e = e || 1;
        var i = 2 * n.RANDOM() * Math.PI;
        return t[0] = Math.cos(i) * e,
        t[1] = Math.sin(i) * e,
        t
    }
    ,
    r.transformMat2 = function(t, e, i) {
        var n = e[0]
          , r = e[1];
        return t[0] = i[0] * n + i[2] * r,
        t[1] = i[1] * n + i[3] * r,
        t
    }
    ,
    r.transformMat2d = function(t, e, i) {
        var n = e[0]
          , r = e[1];
        return t[0] = i[0] * n + i[2] * r + i[4],
        t[1] = i[1] * n + i[3] * r + i[5],
        t
    }
    ,
    r.transformMat3 = function(t, e, i) {
        var n = e[0]
          , r = e[1];
        return t[0] = i[0] * n + i[3] * r + i[6],
        t[1] = i[1] * n + i[4] * r + i[7],
        t
    }
    ,
    r.transformMat4 = function(t, e, i) {
        var n = e[0]
          , r = e[1];
        return t[0] = i[0] * n + i[4] * r + i[12],
        t[1] = i[1] * n + i[5] * r + i[13],
        t
    }
    ,
    r.forEach = function() {
        var t = r.create();
        return function(e, i, n, r, a, s) {
            var o, l;
            for (i || (i = 2),
            n || (n = 0),
            l = r ? Math.min(r * i + n, e.length) : e.length,
            o = n; o < l; o += i)
                t[0] = e[o],
                t[1] = e[o + 1],
                a(t, t, s),
                e[o] = t[0],
                e[o + 1] = t[1];
            return e
        }
    }(),
    r.str = function(t) {
        return "vec2(" + t[0] + ", " + t[1] + ")"
    }
    ,
    r.exactEquals = function(t, e) {
        return t[0] === e[0] && t[1] === e[1]
    }
    ,
    r.equals = function(t, e) {
        var i = t[0]
          , r = t[1]
          , a = e[0]
          , s = e[1];
        return Math.abs(i - a) <= n.EPSILON * Math.max(1, Math.abs(i), Math.abs(a)) && Math.abs(r - s) <= n.EPSILON * Math.max(1, Math.abs(r), Math.abs(s))
    }
    ,
    t.exports = r
}
, function(t, e, i) {
    var n;
    !function(r, a, s) {
        function o(t, e, i) {
            if (t.addEventListener)
                return void t.addEventListener(e, i, !1);
            t.attachEvent("on" + e, i)
        }
        function l(t) {
            if ("keypress" == t.type) {
                var e = String.fromCharCode(t.which);
                return t.shiftKey || (e = e.toLowerCase()),
                e
            }
            return y[t.which] ? y[t.which] : S[t.which] ? S[t.which] : String.fromCharCode(t.which).toLowerCase()
        }
        function u(t, e) {
            return t.sort().join(",") === e.sort().join(",")
        }
        function h(t) {
            var e = [];
            return t.shiftKey && e.push("shift"),
            t.altKey && e.push("alt"),
            t.ctrlKey && e.push("ctrl"),
            t.metaKey && e.push("meta"),
            e
        }
        function c(t) {
            if (t.preventDefault)
                return void t.preventDefault();
            t.returnValue = !1
        }
        function d(t) {
            if (t.stopPropagation)
                return void t.stopPropagation();
            t.cancelBubble = !0
        }
        function p(t) {
            return "shift" == t || "ctrl" == t || "alt" == t || "meta" == t
        }
        function f() {
            if (!x) {
                x = {};
                for (var t in y)
                    t > 95 && t < 112 || y.hasOwnProperty(t) && (x[y[t]] = t)
            }
            return x
        }
        function g(t, e, i) {
            return i || (i = f()[t] ? "keydown" : "keypress"),
            "keypress" == i && e.length && (i = "keydown"),
            i
        }
        function m(t) {
            return "+" === t ? ["+"] : (t = t.replace(/\+{2}/g, "+plus"),
            t.split("+"))
        }
        function v(t, e) {
            var i, n, r, a = [];
            for (i = m(t),
            r = 0; r < i.length; ++r)
                n = i[r],
                C[n] && (n = C[n]),
                e && "keypress" != e && w[n] && (n = w[n],
                a.push("shift")),
                p(n) && a.push(n);
            return e = g(n, a, e),
            {
                key: n,
                modifiers: a,
                action: e
            }
        }
        function _(t, e) {
            return null !== t && t !== a && (t === e || _(t.parentNode, e))
        }
        function b(t) {
            function e(t) {
                t = t || {};
                var e, i = !1;
                for (e in x)
                    t[e] ? i = !0 : x[e] = 0;
                i || (w = !1)
            }
            function i(t, e, i, n, r, a) {
                var s, o, l = [], h = i.type;
                if (!m._callbacks[t])
                    return [];
                for ("keyup" == h && p(t) && (e = [t]),
                s = 0; s < m._callbacks[t].length; ++s)
                    if (o = m._callbacks[t][s],
                    (n || !o.seq || x[o.seq] == o.level) && h == o.action && ("keypress" == h && !i.metaKey && !i.ctrlKey || u(e, o.modifiers))) {
                        var c = !n && o.combo == r
                          , d = n && o.seq == n && o.level == a;
                        (c || d) && m._callbacks[t].splice(s, 1),
                        l.push(o)
                    }
                return l
            }
            function n(t, e, i, n) {
                m.stopCallback(e, e.target || e.srcElement, i, n) || !1 === t(e, i) && (c(e),
                d(e))
            }
            function r(t) {
                "number" != typeof t.which && (t.which = t.keyCode);
                var e = l(t);
                if (e)
                    return "keyup" == t.type && y === e ? void (y = !1) : void m.handleKey(e, h(t), t)
            }
            function s() {
                clearTimeout(_),
                _ = setTimeout(e, 1e3)
            }
            function f(t, i, r, a) {
                function o(i) {
                    n(r, i, t),
                    "keyup" !== a && (y = l(i)),
                    setTimeout(e, 10)
                }
                x[t] = 0;
                for (var u = 0; u < i.length; ++u) {
                    var h = u + 1 === i.length
                      , c = h ? o : function(e) {
                        return function() {
                            w = e,
                            ++x[t],
                            s()
                        }
                    }(a || v(i[u + 1]).action);
                    g(i[u], c, a, t, u)
                }
            }
            function g(t, e, n, r, a) {
                m._directMap[t + ":" + n] = e,
                t = t.replace(/\s+/g, " ");
                var s, o = t.split(" ");
                if (o.length > 1)
                    return void f(t, o, e, n);
                s = v(t, n),
                m._callbacks[s.key] = m._callbacks[s.key] || [],
                i(s.key, s.modifiers, {
                    type: s.action
                }, r, t, a),
                m._callbacks[s.key][r ? "unshift" : "push"]({
                    callback: e,
                    modifiers: s.modifiers,
                    action: s.action,
                    seq: r,
                    level: a,
                    combo: t
                })
            }
            var m = this;
            if (t = t || a,
            !(m instanceof b))
                return new b(t);
            m.target = t,
            m._callbacks = {},
            m._directMap = {};
            var _, x = {}, y = !1, S = !1, w = !1;
            m._handleKey = function(t, r, a) {
                var s, o = i(t, r, a), l = {}, u = 0, h = !1;
                for (s = 0; s < o.length; ++s)
                    o[s].seq && (u = Math.max(u, o[s].level));
                for (s = 0; s < o.length; ++s)
                    if (o[s].seq) {
                        if (o[s].level != u)
                            continue;
                        h = !0,
                        l[o[s].seq] = 1,
                        n(o[s].callback, a, o[s].combo, o[s].seq)
                    } else
                        h || n(o[s].callback, a, o[s].combo);
                var c = "keypress" == a.type && S;
                a.type != w || p(t) || c || e(l),
                S = h && "keydown" == a.type
            }
            ,
            m._bindMultiple = function(t, e, i) {
                for (var n = 0; n < t.length; ++n)
                    g(t[n], e, i)
            }
            ,
            o(t, "keypress", r),
            o(t, "keydown", r),
            o(t, "keyup", r)
        }
        if (r) {
            for (var x, y = {
                8: "backspace",
                9: "tab",
                13: "enter",
                16: "shift",
                17: "ctrl",
                18: "alt",
                20: "capslock",
                27: "esc",
                32: "space",
                33: "pageup",
                34: "pagedown",
                35: "end",
                36: "home",
                37: "left",
                38: "up",
                39: "right",
                40: "down",
                45: "ins",
                46: "del",
                91: "meta",
                93: "meta",
                224: "meta"
            }, S = {
                106: "*",
                107: "+",
                109: "-",
                110: ".",
                111: "/",
                186: ";",
                187: "=",
                188: ",",
                189: "-",
                190: ".",
                191: "/",
                192: "`",
                219: "[",
                220: "\\",
                221: "]",
                222: "'"
            }, w = {
                "~": "`",
                "!": "1",
                "@": "2",
                "#": "3",
                $: "4",
                "%": "5",
                "^": "6",
                "&": "7",
                "*": "8",
                "(": "9",
                ")": "0",
                _: "-",
                "+": "=",
                ":": ";",
                '"': "'",
                "<": ",",
                ">": ".",
                "?": "/",
                "|": "\\"
            }, C = {
                option: "alt",
                command: "meta",
                return: "enter",
                escape: "esc",
                plus: "+",
                mod: /Mac|iPod|iPhone|iPad/.test(navigator.platform) ? "meta" : "ctrl"
            }, M = 1; M < 20; ++M)
                y[111 + M] = "f" + M;
            for (M = 0; M <= 9; ++M)
                y[M + 96] = M.toString();
            b.prototype.bind = function(t, e, i) {
                var n = this;
                return t = t instanceof Array ? t : [t],
                n._bindMultiple.call(n, t, e, i),
                n
            }
            ,
            b.prototype.unbind = function(t, e) {
                var i = this;
                return i.bind.call(i, t, function() {}, e)
            }
            ,
            b.prototype.trigger = function(t, e) {
                var i = this;
                return i._directMap[t + ":" + e] && i._directMap[t + ":" + e]({}, t),
                i
            }
            ,
            b.prototype.reset = function() {
                var t = this;
                return t._callbacks = {},
                t._directMap = {},
                t
            }
            ,
            b.prototype.stopCallback = function(t, e) {
                var i = this;
                return !((" " + e.className + " ").indexOf(" mousetrap ") > -1) && (!_(e, i.target) && ("INPUT" == e.tagName || "SELECT" == e.tagName || "TEXTAREA" == e.tagName || e.isContentEditable))
            }
            ,
            b.prototype.handleKey = function() {
                var t = this;
                return t._handleKey.apply(t, arguments)
            }
            ,
            b.addKeycodes = function(t) {
                for (var e in t)
                    t.hasOwnProperty(e) && (y[e] = t[e]);
                x = null
            }
            ,
            b.init = function() {
                var t = b(a);
                for (var e in t)
                    "_" !== e.charAt(0) && (b[e] = function(e) {
                        return function() {
                            return t[e].apply(t, arguments)
                        }
                    }(e))
            }
            ,
            b.init(),
            r.Mousetrap = b,
            void 0 !== t && t.exports && (t.exports = b),
            void 0 !== (n = function() {
                return b
            }
            .call(e, i, e, t)) && (t.exports = n)
        }
    }("undefined" != typeof window ? window : null, "undefined" != typeof window ? document : null)
}
, function(t, e, i) {
    "use strict";
    t.exports = {
        ArrayType: Float64Array
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = function() {
        r.call(this),
        this._attributeEnable = !1
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "Billboard",
        cloneType: function() {
            return new a
        },
        setEnabled: function(t) {
            this._attributeEnable = t
        },
        isEnabled: function() {
            return this._attributeEnable
        },
        apply: function() {}
    }), "osg", "Billboard"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = i(5).vec4
      , s = function(t) {
        r.call(this),
        this._constantColor = a.create(),
        a.set(this._constantColor, 1, 1, 1, 1),
        void 0 !== t && this.setConstantColor(t)
    };
    s.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "BlendColor",
        cloneType: function() {
            return new s
        },
        setConstantColor: function(t) {
            a.copy(this._constantColor, t)
        },
        getConstantColor: function() {
            return this._constantColor
        },
        apply: function(t) {
            t.getGraphicContext().blendColor(this._constantColor[0], this._constantColor[1], this._constantColor[2], this._constantColor[3])
        }
    }), "osg", "BlendColor"),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = function(t, e, i, n) {
        r.call(this),
        this._colorMask = [!0, !0, !0, !0],
        this.setMask(t, e, i, n)
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "ColorMask",
        cloneType: function() {
            return new a
        },
        setMask: function(t, e, i, n) {
            void 0 !== t && void 0 !== e && void 0 !== i && void 0 !== n && (this._colorMask[0] = t,
            this._colorMask[1] = e,
            this._colorMask[2] = i,
            this._colorMask[3] = n)
        },
        apply: function(t) {
            var e = t.getGraphicContext()
              , i = this._colorMask;
            e.colorMask(i[0], i[1], i[2], i[3])
        }
    }), "osg", "ColorMask"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(5).mat4
      , r = i(5).vec3
      , a = function() {
        this._radiusEquator = a.WGS_84_RADIUS_EQUATOR,
        this._radiusPolar = a.WGS_84_RADIUS_POLAR,
        this.computeCoefficients()
    };
    a.WGS_84_RADIUS_EQUATOR = 6378137,
    a.WGS_84_RADIUS_POLAR = 6356752.3142,
    a.prototype = {
        setRadiusEquator: function(t) {
            this._radiusEquator = t,
            this.computeCoefficients()
        },
        getRadiusEquator: function() {
            return this._radiusEquator
        },
        setRadiusPolar: function(t) {
            this._radiusPolar = t,
            this.computeCoefficients()
        },
        getRadiusPolar: function() {
            return this._radiusPolar
        },
        convertLatLongHeightToXYZ: function(t, e, i, n) {
            var r = Math.sin(t)
              , a = Math.cos(t)
              , s = this._radiusEquator / Math.sqrt(1 - this._eccentricitySquared * r * r)
              , o = (s + i) * a * Math.cos(e)
              , l = (s + i) * a * Math.sin(e)
              , u = (s * (1 - this._eccentricitySquared) + i) * r;
            return n[0] = o,
            n[1] = l,
            n[2] = u,
            n
        },
        convertXYZToLatLongHeight: function(t, e, i, n) {
            var r = Math.sqrt(t * t + e * e)
              , a = Math.atan2(i * this._radiusEquator, r * this._radiusPolar)
              , s = (this._radiusEquator * this._radiusEquator - this._radiusPolar * this._radiusPolar) / (this._radiusPolar * this._radiusPolar)
              , o = Math.sin(a)
              , l = Math.cos(a)
              , u = Math.atan((i + s * this._radiusPolar * o * o * o) / (r - this._eccentricitySquared * this._radiusEquator * l * l * l))
              , h = Math.atan2(e, t)
              , c = Math.sin(u)
              , d = this._radiusEquator / Math.sqrt(1 - this._eccentricitySquared * c * c)
              , p = Math.cos(u);
            0 === p && (p = 1);
            var f = r / p - d;
            return n[0] = u,
            n[1] = h,
            n[2] = f,
            n
        },
        computeLocalUpVector: function(t, e, i) {
            var n, a, s = this.convertXYZToLatLongHeight(t, e, i, r.create());
            return n = s[0],
            a = s[1],
            s[2],
            [Math.cos(a) * Math.cos(n), Math.sin(a) * Math.cos(n), Math.sin(n)]
        },
        isWGS84: function() {
            return this._radiusEquator === a.WGS_84_RADIUS_EQUATOR && this._radiusPolar === a.WGS_84_RADIUS_POLAR
        },
        computeCoefficients: function() {
            var t = (this._radiusEquator - this._radiusPolar) / this._radiusEquator;
            this._eccentricitySquared = 2 * t - t * t
        },
        computeLocalToWorldTransformFromLatLongHeight: function(t, e, i, r) {
            var a = this.convertLatLongHeightToXYZ(t, e, i, r);
            return n.fromTranslation(r, a),
            this.computeCoordinateFrame(t, e, r),
            r
        },
        computeLocalToWorldTransformFromXYZ: function(t, e, i) {
            var a = this.convertXYZToLatLongHeight(t, e, i, r.create())
              , s = n.fromTranslation(n.create(), r.fromValues(t, e, i));
            return this.computeCoordinateFrame(a[0], a[1], s),
            s
        },
        computeCoordinateFrame: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create();
            return function(a, s, o) {
                t[0] = Math.cos(s) * Math.cos(a),
                t[1] = Math.sin(s) * Math.cos(a),
                t[2] = Math.sin(a),
                e[0] = -Math.sin(s),
                e[1] = -Math.cos(s),
                r.cross(i, t, e),
                n.set(o, e[0], e[1], e[2], 0, i[0], i[1], i[2], 0, t[0], t[1], t[2], 0, 0, 0, 0, 1)
            }
        }()
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i(13)
      , a = i(431)
      , s = function(t) {
        a.call(this, t),
        this._canPlayDefered = void 0
    };
    s.PAUSE = 0,
    s.PLAYING = 1,
    s.prototype = r.objectLibraryClass(r.objectInherit(a.prototype, {
        isDirty: function() {
            return this._status === s.PLAYING
        },
        setImage: function(t) {
            a.prototype.setImage.call(this, t),
            this._status = s.STOP,
            t.addEventListener("ended", function() {
                this._imageObject.loop || this.stop()
            }
            .bind(this), !0),
            this.dirty()
        },
        setLooping: function(t) {
            this._imageObject.loop = t
        },
        play: function() {
            this._imageObject.play(),
            this._status = s.PLAYING
        },
        stop: function() {
            this._imageObject.pause(),
            this._status = s.PAUSE
        },
        whenReady: function() {
            return this._imageObject ? (this._canPlayDefered || (this._canPlayDefered = n.defer(),
            this._imageObject.readyState > 3 ? this._canPlayDefered.resolve(this) : this._imageObject.addEventListener("canplaythrough", this._canPlayDefered.resolve.bind(this._canPlayDefered, this), !0)),
            this._canPlayDefered.promise) : n.reject()
        }
    }), "osg", "ImageStream"),
    r.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(65)
      , a = i(605)
      , s = function(t) {
        r.call(this),
        this._buildOptions = void 0 !== t ? t : {
            _numVerticesProcessed: 0,
            _targetNumTrianglesPerLeaf: 50,
            _maxNumLevels: 20
        }
    };
    s.prototype = n.objectInherit(r.prototype, {
        apply: function(t) {
            if (t.getShape) {
                if (void 0 === t.getShape()) {
                    var e = new a;
                    e.build(this._buildOptions, t) && t.setShape(e)
                }
            }
            this.traverse(t)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(5).vec3
      , a = i(606)
      , s = i(663)
      , o = function() {
        this._intersector = new s
    };
    o.prototype = n.objectInherit(a.prototype, {
        init: function(t, e, i, n) {
            this._intersector._intersections = t,
            this._intersector.setNodePath(n),
            this._intersector.set(e, i),
            this._center = e,
            this._radius = i
        },
        intersect: function() {
            var t = r.create()
              , e = r.create()
              , i = r.create();
            return function(n) {
                var r = n._first
                  , a = n._second
                  , s = this._triangles
                  , o = this._vertices;
                if (r < 0) {
                    var l = -r - 1
                      , u = l + a
                      , h = this._intersector;
                    h.index = l;
                    for (var c = l; c < u; ++c) {
                        var d = 3 * c
                          , p = s[d]
                          , f = s[d + 1]
                          , g = s[d + 2]
                          , m = 3 * p;
                        t[0] = o[m],
                        t[1] = o[m + 1],
                        t[2] = o[m + 2],
                        m = 3 * f,
                        e[0] = o[m],
                        e[1] = o[m + 1],
                        e[2] = o[m + 2],
                        m = 3 * g,
                        i[0] = o[m],
                        i[1] = o[m + 1],
                        i[2] = o[m + 2],
                        h.intersect(t, e, i, p, f, g)
                    }
                } else
                    r > 0 && this.intersectSphere(this._kdNodes[r]._bb) && this.intersect(this._kdNodes[r]),
                    a > 0 && this.intersectSphere(this._kdNodes[a]._bb) && this.intersect(this._kdNodes[a])
            }
        }(),
        intersectSphere: function() {
            var t = r.create();
            return function(e) {
                var i = this._radius + e.radius();
                return r.sqrDist(e.center(t), this._center) <= i * i
            }
        }()
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = function(t) {
        r.call(this),
        this.lineWidth = 1,
        void 0 !== t && (this.lineWidth = t)
    };
    a.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "LineWidth",
        cloneType: function() {
            return new a
        },
        apply: function(t) {
            t.getGraphicContext().lineWidth(this.lineWidth)
        }
    }), "osg", "LineWidth"),
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(66)
      , a = i(81)
      , s = function(t) {
        r.call(this),
        this._enable = !t,
        this._pointSize = 1,
        this._circleShape = !1
    };
    s.prototype = n.objectLibraryClass(n.objectInherit(r.prototype, {
        attributeType: "PointSize",
        cloneType: function() {
            return new s(!0)
        },
        setCircleShape: function(t) {
            this._circleShape = t
        },
        isCircleShape: function() {
            return this._circleShape
        },
        setEnabled: function(t) {
            this._enable = t
        },
        isEnabled: function() {
            return this._enable
        },
        setPointSize: function(t) {
            this._pointSize = t
        },
        getOrCreateUniforms: function() {
            var t = s;
            return t.uniforms ? t.uniforms : (t.uniforms = {
                pointSize: a.createFloat(1, "uPointSize")
            },
            t.uniforms)
        },
        getHash: function() {
            return this.getTypeMember() + (this.isEnabled() ? "1" : "0") + (this._circleShape ? "1" : "0")
        },
        apply: function() {
            if (this._enable) {
                this.getOrCreateUniforms().pointSize.setFloat(this._pointSize)
            }
        }
    }), "osg", "PointSizeAttribute"),
    n.setTypeID(s),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(431)
      , a = i(28)
      , s = i(93)
      , o = function() {
        s.call(this),
        this._images = {};
        for (var t = 0; t < 6; t++)
            this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X + t] = new r
    };
    o.prototype = n.objectLibraryClass(n.objectInherit(s.prototype, {
        setDefaultParameters: function() {
            s.prototype.setDefaultParameters.call(this),
            this._textureTarget = s.TEXTURE_CUBE_MAP,
            this._flipY = !1
        },
        cloneType: function() {
            return new o
        },
        setImage: function(t, e, i) {
            var n = t;
            "string" == typeof n && (n = s[n]),
            this._images[n].setImage(e, i),
            this.setImageFormat(i),
            this.setTextureSize(this._images[n].getWidth(), this._images[n].getHeight()),
            this._textureNull = !1,
            this.dirty()
        },
        getImage: function(t) {
            return this._images[t].getImage()
        },
        initCubemapContent: function(t) {
            var e = this._internalFormat;
            return this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_POSITIVE_X, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_NEGATIVE_X, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_POSITIVE_Y, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_NEGATIVE_Y, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_POSITIVE_Z, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_NEGATIVE_Z, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, null),
            !0
        },
        generateMipmap: function(t, e) {
            if (this.hasMipmapFilter()) {
                if (this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].hasMipmap())
                    for (var i = 0; i < 6; i++) {
                        var n = this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X + i];
                        n.hasMipmap() || a.error("mipmap not set correctly for TextureCubemap");
                        for (var r = this._internalFormat, o = 1; o < n.getMipmap().length; o++) {
                            var l = n.getMipmap()[o].getWidth();
                            this.applyTexImage2D(t, t.TEXTURE_CUBE_MAP_POSITIVE_X + i, o, r, l, l, 0, r, this._type, n.getMipmap()[o].getImage())
                        }
                    }
                else
                    t.generateMipmap(e);
                this._dirtyMipmap = !1
            }
        },
        applyImageTarget: function(t, e, i) {
            var n = this._images[i];
            return n.getImage() && n.isReady() ? n.isDirty() ? (this.setTextureSize(n.getWidth(), n.getHeight()),
            n.setDirty(!1),
            n.isTypedArray() ? this.applyTexImage2D(t, i, 0, e, this._textureWidth, this._textureHeight, 0, e, this._type, n.getImage()) : this.applyTexImage2D(t, i, 0, e, e, this._type, n.getImage()),
            !this._unrefImageDataAfterApply || this.hasMipmap() && n.hasMipmap() || n.release(),
            1) : 1 : 0
        },
        initCubemapContentImage: function(t) {
            var e = this._internalFormat
              , i = 0;
            return i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_POSITIVE_X),
            i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_NEGATIVE_X),
            i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_POSITIVE_Y),
            i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_NEGATIVE_Y),
            i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_POSITIVE_Z),
            6 === (i += this.applyImageTarget(t, e, t.TEXTURE_CUBE_MAP_NEGATIVE_Z))
        },
        apply: function(t) {
            var e = t.getGraphicContext();
            if (this._dirtyTextureObject && this.releaseGLObjects(),
            void 0 === this._textureObject || this.isDirty())
                if (this._textureNull)
                    e.bindTexture(this._textureTarget, null);
                else {
                    this._textureObject || (this.computeTextureFormat(),
                    this.init(t)),
                    this._textureObject.bind(e);
                    var i;
                    i = this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].getImage() ? this.initCubemapContentImage(e) : this.initCubemapContent(e),
                    i && (this._dirty = !1,
                    this.applyFilterParameter(e, this._textureTarget),
                    this.generateMipmap(e, this._textureTarget))
                }
            else
                this._textureObject.bind(e),
                this.isDirtyMipmap() && this.generateMipmap(e, this._textureTarget)
        }
    }), "osg", "TextureCubeMap"),
    n.setTypeID(o),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(324)
      , a = function(t, e, i, n) {
        this._target = t,
        this._internalFormat = e,
        this._width = i,
        this._height = n,
        this._size = 0,
        this.computeSize()
    };
    a.prototype = {
        match: function(t) {
            return t._target === this._target && t._internalFormat === this._internalFormat && t._width === this._width && t._height === this._height
        },
        computeSize: function() {
            var t = i(93)
              , e = 0;
            switch (this._internalFormat) {
            case 1:
            case t.ALPHA:
            case t.LUMINANCE:
                e = 8;
                break;
            case t.LUMINANCE_ALPHA:
            case 2:
                e = 16;
                break;
            case t.RGB:
            case 3:
                e = 24;
                break;
            case t.RGBA:
            case 4:
                e = 32
            }
            var n = Math.ceil(this._width * this._height * e) / 8;
            this._target === t.TEXTURE_CUBE_MAP && (n *= 6),
            n += n / 3,
            this._size = n
        },
        getSize: function() {
            return this._size
        }
    },
    a.getHash = function() {
        var t = Array.prototype.slice.call(arguments)
          , e = "";
        return t.forEach(function(t) {
            e += t
        }),
        e
    }
    ;
    var s = function(t, e, i) {
        this._texture = t,
        this._id = e,
        this._textureSet = i
    };
    s.prototype = {
        target: function() {
            return this._textureSet._profile._target
        },
        id: function() {
            return this._id
        },
        getTextureSet: function() {
            return this._textureSet
        },
        reset: function() {
            this._textureObject = null,
            this._texture = void 0
        },
        bind: function(t) {
            t.bindTexture(this.target(), this._id)
        }
    };
    var o = function(t) {
        this._profile = t,
        this._usedTextureObjects = [],
        this._orphanedTextureObjects = []
    };
    o.prototype = {
        getProfile: function() {
            return this._profile
        },
        getUsedTextureObjects: function() {
            return this._usedTextureObjects
        },
        getOrphanedTextureObjects: function() {
            return this._orphanedTextureObjects
        },
        takeOrGenerate: function(t, e) {
            var i;
            if (this._orphanedTextureObjects.length > 0)
                return i = this.takeFromOrphans(),
                i._texture = e,
                this._usedTextureObjects.push(i),
                i;
            var n = t.createTexture();
            return i = new s(e,n,this),
            this._usedTextureObjects.push(i),
            i
        },
        takeFromOrphans: function() {
            if (this._orphanedTextureObjects.length)
                return this._orphanedTextureObjects.pop()
        },
        orphan: function(t) {
            var e = this._usedTextureObjects.indexOf(t);
            -1 !== e && (this._orphanedTextureObjects.push(this._usedTextureObjects[e]),
            this._usedTextureObjects.splice(e, 1))
        },
        flushDeletedTextureObjects: function(t, e) {
            if (e <= 0)
                return e;
            var i, n = this._orphanedTextureObjects.length, a = 0, s = r.instance().tick();
            for (i = 0; i < n && a < e; i++)
                t.deleteTexture(this._orphanedTextureObjects[i].id()),
                this._orphanedTextureObjects[i].reset(),
                a = r.instance().deltaS(s, r.instance().tick());
            return this._orphanedTextureObjects.splice(0, i),
            e - a
        },
        flushAllDeletedTextureObjects: function(t) {
            for (var e = this._orphanedTextureObjects.length, i = this.getProfile().getSize(), r = 0, a = e; r < a; ++r)
                t.deleteTexture(this._orphanedTextureObjects[r].id()),
                this._orphanedTextureObjects[r].reset();
            this._orphanedTextureObjects.length = 0,
            n.info("TextureManager: released " + e + " with " + e * i / 1048576 + " MB")
        }
    };
    var l = function() {
        this._textureSetMap = {}
    };
    l.prototype = {
        generateTextureObject: function(t, e, i, n, r, s) {
            var l = a.getHash(i, n, r, s);
            return void 0 === this._textureSetMap[l] && (this._textureSetMap[l] = new o(new a(i,n,r,s))),
            this._textureSetMap[l].takeOrGenerate(t, e)
        },
        updateStats: function(t, e) {
            var i = 0
              , n = 0;
            for (var r in this._textureSetMap) {
                var a = this._textureSetMap[r].getProfile()
                  , s = a.getSize()
                  , o = this._textureSetMap[r].getUsedTextureObjects().length
                  , l = this._textureSetMap[r].getOrphanedTextureObjects().length;
                i += o * s,
                n += l * s
            }
            var u = 1048576;
            e("textureused").set(i / u),
            e("texturereserved").set(n / u),
            e("texturetotal").set((i + n) / u)
        },
        reportStats: function() {
            var t = 0;
            for (var e in this._textureSetMap) {
                var i = this._textureSetMap[e].getProfile()
                  , r = i.getSize() / 1048576
                  , a = this._textureSetMap[e].getUsedTextureObjects().length;
                r *= a,
                t += r,
                n.notice(String(r) + " MB with " + a + " texture of " + i._width + "x" + i._height + " " + i._internalFormat)
            }
            n.notice(String(t) + " MB in total")
        },
        flushAllDeletedTextureObjects: function(t) {
            for (var e in this._textureSetMap)
                this._textureSetMap[e].flushAllDeletedTextureObjects(t)
        },
        flushDeletedTextureObjects: function(t, e) {
            var i = e;
            for (var n in this._textureSetMap)
                if ((i = this._textureSetMap[n].flushDeletedTextureObjects(t, i)) <= 0)
                    break;
            return i
        },
        releaseTextureObject: function(t) {
            if (t) {
                t.getTextureSet().orphan(t)
            }
        }
    },
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(65)
      , a = i(28)
      , s = i(414)
      , o = function() {
        r.call(this, r.TRAVERSE_ALL_CHILDREN),
        this._boneMap = {}
    };
    o.prototype = n.objectInherit(r.prototype, {
        apply: function(t) {
            if (t.typeID === s.typeID) {
                var e = t.getName();
                e ? this._boneMap[e] = t : a.warn("found Bone without name")
            }
            this.traverse(t)
        },
        getBoneMap: function() {
            return this._boneMap
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(65)
      , a = i(459)
      , s = function() {
        r.call(this, r.TRAVERSE_PARENTS),
        this._root = void 0,
        this._pathToRoot = void 0
    };
    s.prototype = n.objectInherit(r.prototype, {
        apply: function(t) {
            if (!this._root)
                return t.typeID === a.typeID ? (this._root = t,
                void (this._pathToRoot = this.nodePath.slice(1))) : void this.traverse(t)
        }
    }),
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(5).mat4
      , r = i(66)
      , a = i(620)
      , s = i(849)
      , o = function() {
        this._isInitialized = !1,
        this._bones = []
    };
    o.prototype = {
        computeBonePalette: function(t, e) {
            var i = this._bones;
            for (var n in t) {
                var r = e[n]
                  , a = t[n];
                void 0 !== r && (i[r] = a)
            }
            return i
        },
        init: function(t) {
            var e = new s;
            t.getSkeleton().accept(e);
            var i = e.getBoneMap();
            this.computeBonePalette(i, t._boneNameID);
            var n = 3 * this._bones.length
              , o = this._skinningAttribute = new a;
            return o.setMatrixPalette(new Float32Array(4 * n)),
            t.getStateSetAnimation().setAttributeAndModes(o, r.ON),
            this._isInitialized = !0,
            !0
        },
        computeMatrixPalette: function() {
            var t = n.create();
            return function(e, i) {
                for (var r = this._bones, a = this._skinningAttribute.getMatrixPalette(), s = 0, o = 0, l = r.length; o < l; o++) {
                    var u = r[o]
                      , h = u.getInvBindMatrixInSkeletonSpace()
                      , c = u.getMatrixInSkeletonSpace();
                    n.mul(t, c, h),
                    n.mul(t, i, t),
                    n.mul(t, t, e),
                    a[s++] = t[0],
                    a[s++] = t[4],
                    a[s++] = t[8],
                    a[s++] = t[12],
                    a[s++] = t[1],
                    a[s++] = t[5],
                    a[s++] = t[9],
                    a[s++] = t[13],
                    a[s++] = t[2],
                    a[s++] = t[6],
                    a[s++] = t[10],
                    a[s++] = t[14]
                }
            }
        }(),
        update: function(t) {
            this._isInitialized || this.init(t),
            this.computeMatrixPalette(t.getMatrixFromSkeletonToGeometry(), t.getInvMatrixFromSkeletonToGeometry())
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(85)
      , a = i(5).mat4
      , s = i(5).vec3
      , o = i(5).quat
      , l = i(354)
      , u = function(t, e, i) {
        r.call(this),
        this._axis = s.fromValues(0, 0, 1),
        e && s.copy(this._axis, e),
        this._target = l.createFloatTarget("number" == typeof i ? i : 0),
        t && this.setName(t)
    };
    u.prototype = n.objectInherit(r.prototype, {
        init: function(t, e) {
            this.setAxis(t),
            this.setAngle(e),
            this._target.defaultValue = e
        },
        setAxis: function(t) {
            s.copy(this._axis, t)
        },
        setAngle: function(t) {
            this._target.value = t
        },
        getTarget: function() {
            return this._target
        },
        resetToDefaultValue: function() {
            this.setAngle(this._target.defaultValue)
        },
        applyToMatrix: function() {
            var t = a.create()
              , e = o.create();
            return function(i) {
                var n = this._axis
                  , r = e
                  , s = t
                  , l = this._target.value;
                o.setAxisAngle(r, n, l),
                a.fromQuat(s, r),
                a.mul(i, i, s)
            }
        }()
    }),
    t.exports = u
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(28)
      , a = i(85)
      , s = i(850)
      , o = function() {
        a.call(this)
    };
    o.prototype = n.objectInherit(a.prototype, {
        init: function(t) {
            var e = new s;
            if (t.getParents().length > 1 && r.warn("A RigGeometry should not have multi parent ( " + t.getName() + " )"),
            t.getParents()[0].accept(e),
            !e._root)
                return void r.warn("A RigGeometry did not find a parent skeleton for RigGeometry ( " + t.getName() + " )");
            t.setSkeleton(e._root),
            t.setPathToSkeleton(e._pathToRoot)
        },
        update: function(t) {
            if (t && "RigGeometry" !== t.className())
                return !0;
            var e = t;
            return e.getSkeleton() || 0 === e.getParents().length || this.init(e),
            !e.getSkeleton() || (e.getNeedToComputeMatrix() && e.computeMatrixFromRootSkeleton(),
            e.update(),
            !0)
        }
    }),
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = function(t) {
        return -t * (t - 2)
    }
      , r = function(t) {
        return t * t
    }
      , a = function(t) {
        return (t -= 1) * t * t + 1
    }
      , s = function(t) {
        return t * t * t
    }
      , o = function(t) {
        return -((t -= 1) * t * t * t - 1)
    }
      , l = function(t) {
        return t * t * t * t
    }
      , u = function(t) {
        return Math.pow(2, -10 * t) * Math.sin((t - .075) * (2 * Math.PI) / .3) + 1
    }
      , h = function(t) {
        return t < 1 / 2.75 ? 7.5625 * t * t : t < 2 / 2.75 ? 7.5625 * (t -= 1.5 / 2.75) * t + .75 : t < 2.5 / 2.75 ? 7.5625 * (t -= 2.25 / 2.75) * t + .9375 : 7.5625 * (t -= 2.625 / 2.75) * t + .984375
    };
    t.exports = {
        easeOutQuad: n,
        easeInQuad: r,
        easeOutCubic: a,
        easeInCubic: s,
        easeOutQuart: o,
        easeInQuart: l,
        easeOutElastic: u,
        easeOutBounce: h,
        EaseOutQuad: n,
        EaseInQuad: r,
        EaseOutCubic: a,
        EaseInCubic: s,
        EaseOutQuart: o,
        EaseInQuart: l,
        EaseOutElastic: u,
        EaseOutBounce: h
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(461)
      , a = i(620)
      , s = i(434)
      , o = i(617)
      , l = i(414)
      , u = i(416)
      , h = i(618)
      , c = i(854)
      , d = i(626)
      , p = i(619)
      , f = i(381)
      , g = i(415)
      , m = i(459)
      , v = i(621)
      , _ = i(622)
      , b = i(852)
      , x = i(525)
      , y = i(623)
      , S = i(526)
      , w = i(460)
      , C = i(527)
      , M = i(624)
      , T = {};
    n.objectMix(T, c),
    n.objectMix(T, d),
    T.Animation = r,
    T.SkinningAttribute = a,
    T.AnimationUpdateCallback = s,
    T.BasicAnimationManager = o,
    T.Bone = l,
    T.Channel = u,
    T.CollectAnimationUpdateCallbackVisitor = h,
    T.MorphAttribute = p,
    T.MorphGeometry = f,
    T.RigGeometry = g,
    T.Skeleton = m,
    T.StackedMatrix = v,
    T.StackedQuaternion = _,
    T.StackedRotateAxis = b,
    T.StackedScale = x,
    T.StackedTranslate = y,
    T.UpdateBone = S,
    T.UpdateMatrixTransform = w,
    T.UpdateMorph = C,
    T.UpdateSkeleton = M,
    t.exports = T
}
, function(t, e, i) {
    "use strict";
    var n = {
        prefixURL: "",
        databasePath: "",
        progressXHRCallback: void 0,
        readNodeURL: void 0,
        readImageURL: void 0,
        readBinaryArrayURL: void 0,
        imageLoadingUsePromise: !0,
        imageOnload: void 0,
        imageCrossOrigin: void 0
    };
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(529)
      , a = i(382)
      , s = i(627)
      , o = i(468)
      , l = i(669)
      , u = i(670)
      , h = i(435)
      , c = i(528)
      , d = {};
    d.Input = r,
    n.objectMix(d, a),
    d.DatabasePager = s,
    d.ObjectWrapper.serializers.osg = o,
    d.ObjectWrapper.serializers.osgAnimation = l,
    d.ObjectWrapper.serializers.osgText = u,
    d.Registry = h,
    d.FileHelper = c,
    d.requestFile = i(417);
    var p = i(514);
    n.objectMix(d, p),
    t.exports = d
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(462)
      , a = i(464)
      , s = i(465)
      , o = i(661)
      , l = i(413)
      , u = i(5).mat4
      , h = i(5).vec2
      , c = i(5).vec3
      , d = i(5).quat
      , p = i(629)
      , f = i(628)
      , g = i(463)
      , m = function() {
        r.call(this),
        this._tmpHomePosition = c.create(),
        this._intersectionVisitor = new a,
        this._lineSegmentIntersector = new s,
        this._polytopeIntersector = void 0,
        this._usePolytopeIntersector = !1,
        this._dimensionMask = 4,
        this.init()
    };
    m.Interpolator = function() {
        this._current = h.create(),
        this._target = h.create(),
        this._delta = h.create(),
        this._reset = !1,
        this.reset(),
        this._width = void 0,
        this._height = void 0
    }
    ,
    m.Interpolator.prototype = {
        setWidth: function(t) {
            this._width = t
        },
        setHeight: function(t) {
            this._height = t
        },
        reset: function() {
            for (var t = 0, e = this._current.length; t < e; t++)
                this._current[t] = this._target[t] = 0;
            this._reset = !0
        },
        update: function() {
            var t, e;
            return t = void 0 === this._width ? 0 : (this._target[0] - this._current[0]) / this._width,
            this._delta[0] = t,
            this._current[0] = this._target[0],
            e = void 0 === this._height ? 0 : (this._target[1] - this._current[1]) / this._height,
            this._delta[1] = e,
            this._current[1] = this._target[1],
            this._delta
        },
        set: function() {
            for (var t = 0, e = this._current.length; t < e; t++)
                this._current[t] = this._target[t] = arguments[t];
            this._reset = !1
        },
        isReset: function() {
            return this._reset
        },
        getCurrent: function() {
            return this._current
        },
        setTarget: function() {
            for (var t = 0, e = this._target.length; t < e; t++)
                this._reset ? this._target[t] = this._current[t] = arguments[t] : this._target[t] = arguments[t];
            this._reset = !1
        },
        addTarget: function() {
            for (var t = 0; t < arguments.length; t++)
                this._target[t] += arguments[t]
        },
        getTarget: function() {
            return this._target
        },
        getDelta: function() {
            return this._delta
        }
    },
    m.AvailableControllerList = ["StandardMouseKeyboard", "Hammer"],
    m.ControllerList = ["StandardMouseKeyboard", "Hammer"],
    m.prototype = n.objectInherit(r.prototype, {
        init: function() {
            this._distance = 25,
            this._target = c.create(),
            this._upz = c.fromValues(0, 0, 1),
            this._right = c.fromValues(1, 0, 0),
            c.init(this._target);
            var t = u.fromRotation(u.create(), -Math.PI, this._upz)
              , e = u.fromRotation(u.create(), Math.PI / 10, this._right);
            this._rotation = u.create(),
            u.mul(this._rotation, t, e),
            this._time = 0,
            this._rotate = new m.Interpolator,
            this._pan = new m.Interpolator,
            this._zoom = new g(1),
            this._panFactor = 1.5,
            this._rotateFactor = 1,
            this._zoomFactor = 1,
            this._inverseMatrix = u.create(),
            this._homeEye = void 0,
            this._homeCenter = void 0,
            this._homeUp = c.fromValues(0, 0, 1),
            this._orientation = d.create(),
            this._pivotPoint = c.create(),
            this._eye = void 0,
            this._zoomDir = c.create();
            var i = this;
            m.ControllerList.forEach(function(t) {
                void 0 !== m[t] && (i._controllerList[t] = new m[t](i))
            })
        },
        setViewer: function(t) {
            this._viewer = t
        },
        reset: function() {
            this.init()
        },
        setNode: function(t) {
            this._node = t
        },
        setPivotPoint: function(t) {
            c.copy(this._pivotPoint, t)
        },
        setTarget: function() {
            var t = c.create();
            return function(e) {
                c.copy(this._target, e),
                this.getEyePosition(t),
                this._distance = c.distance(e, t)
            }
        }(),
        setEyePosition: function(t) {
            c.copy(this._eye, t),
            this._distance = c.distance(this._target, t)
        },
        setHomePosition: function(t, e, i) {
            this._homeEye = t,
            this._homeCenter = e,
            this._homeUp = i
        },
        computeHomePosition: function() {
            var t = c.create()
              , e = c.create()
              , i = c.create()
              , n = u.create();
            return function(r) {
                var a = this.getHomeBound(r);
                if (a) {
                    this.setDistance(this.getHomeDistance(a)),
                    this.setTarget(a.center()),
                    this.setPivotPoint(a.center()),
                    void 0 === this._homeEye && (this._homeEye = c.create(),
                    this.getEyePosition(this._homeEye)),
                    void 0 === this._homeCenter && (this._homeCenter = c.create(),
                    c.copy(this._homeCenter, a.center())),
                    void 0 === this._eye && (this._eye = c.create()),
                    c.copy(this._eye, this._homeEye),
                    c.copy(this._target, this._homeCenter),
                    c.copy(this._upz, this._homeUp),
                    u.copy(n, this._rotation);
                    var s = this._target
                      , o = this._eye;
                    c.sub(t, s, o),
                    c.normalize(t, t),
                    c.cross(e, t, this._upz),
                    c.normalize(e, e),
                    c.cross(i, e, t),
                    c.normalize(i, i),
                    n[0] = e[0],
                    n[1] = i[0],
                    n[2] = -t[0],
                    n[3] = 0,
                    n[4] = e[1],
                    n[5] = i[1],
                    n[6] = -t[1],
                    n[7] = 0,
                    n[8] = e[2],
                    n[9] = i[2],
                    n[10] = -t[2],
                    n[11] = 0,
                    n[12] = 0,
                    n[13] = 0,
                    n[14] = 0,
                    n[15] = 1,
                    u.getRotation(this._orientation, n),
                    d.invert(this._orientation, this._orientation)
                }
            }
        }(),
        setZoomFactor: function(t) {
            this._zoomFactor = t
        },
        setRotateFactor: function(t) {
            this._rotateFactor = t
        },
        setPanFactor: function(t) {
            this._panFactor = t
        },
        setDistance: function(t) {
            this._distance = t
        },
        setUsePolytopeIntersector: function(t) {
            this._usePolytopeIntersector = t
        },
        getUsePolytopeIntersector: function() {
            return this._usePolytopeIntersector
        },
        getDistance: function() {
            return this._distance
        },
        zoom: function(t) {
            this._distance = t
        },
        getRotateInterpolator: function() {
            return this._rotate
        },
        getPanInterpolator: function() {
            return this._pan
        },
        getZoomInterpolator: function() {
            return this._zoom
        },
        getIntersectionVisitor: function() {
            return this._intersectionVisitor
        },
        getLineSegmentIntersector: function() {
            return this._lineSegmentIntersector
        },
        getOrCreatePolytopeIntersector: function() {
            return void 0 === this._polytopeIntersector && (this._polytopeIntersector = new o,
            this._polytopeIntersector.setIntersectionLimit(o.LIMIT_ONE_PER_DRAWABLE),
            this._polytopeIntersector.setDimensionMask(o.DimZero | o.DimOne)),
            this._polytopeIntersector
        },
        getTarget: function(t) {
            return c.copy(t, this._target),
            t
        },
        getEyePosition: function(t) {
            void 0 === this._eye ? this.computeEyePosition(this._target, this._distance, t) : c.copy(t, this._eye)
        },
        computeEyePosition: function() {
            var t = c.create()
              , e = u.create();
            return function(i, n, r) {
                u.invert(e, this._rotation),
                t[1] = n,
                c.transformMat4(r, t, e),
                c.add(r, i, r)
            }
        }(),
        computePan: function() {
            var t = c.create()
              , e = c.create()
              , i = c.create();
            return function(n, r, a) {
                var s = c.length(c.sub(i, this._eye, this._pivotPoint)) / this._panFactor;
                s < 10 && (s = 10),
                t[0] = n * s / 2,
                t[1] = r * s / 2,
                t[2] = 0,
                c.transformMat4(e, t, a),
                c.add(this._eye, this._eye, e)
            }
        }(),
        computeZoom: function() {
            var t = c.create()
              , e = c.create();
            return function(i) {
                var n = i * this._zoomFactor;
                c.sub(t, this._pivotPoint, this._eye),
                c.add(this._eye, this._eye, c.scale(e, t, n))
            }
        }(),
        computeRotation: function() {
            var t = c.create()
              , e = c.create()
              , i = c.create()
              , n = c.create()
              , r = d.create()
              , a = d.create()
              , s = d.create()
              , o = c.create()
              , l = c.create();
            return function(u, h) {
                c.transformQuat(e, this._right, this._orientation),
                c.normalize(t, e),
                c.sub(i, this._eye, this._pivotPoint);
                var p = c.dot(t, i);
                c.sub(n, i, c.scale(l, t, p));
                var f = c.fromValues(-n[0], -n[1], 0)
                  , g = Math.atan2(-n[2], c.length(f));
                h = Math.max(-Math.PI / 2 + .01, Math.min(Math.PI / 2 - .01, g + h)) - g,
                d.setAxisAngle(r, e, h * this._rotateFactor),
                d.setAxisAngle(a, this._upz, u * this._rotateFactor),
                d.mul(s, a, r),
                c.transformQuat(o, i, s),
                c.add(this._eye, o, this._pivotPoint),
                d.mul(this._orientation, a, this._orientation),
                c.transformQuat(e, this._right, this._orientation),
                d.setAxisAngle(r, e, h * this._rotateFactor),
                d.mul(this._orientation, r, this._orientation)
            }
        }(),
        update: function() {
            var t = u.create()
              , e = u.create();
            return function(i) {
                var n = i.getFrameStamp().getDeltaTime()
                  , r = this._rotate.update();
                this.computeRotation(10 * -r[0], 10 * r[1]),
                u.fromQuat(t, this._orientation);
                var a = this._pan.update();
                this.computePan(10 * -a[0], 10 * -a[1], t),
                r = this._zoom.update(n),
                this.computeZoom(-r[0] / 10),
                u.fromTranslation(e, this._eye),
                u.mul(this._inverseMatrix, e, t),
                u.invert(this._inverseMatrix, this._inverseMatrix)
            }
        }(),
        getInverseMatrix: function() {
            return this._inverseMatrix
        },
        computeIntersections: function() {
            var t = []
              , e = c.create();
            return function(i) {
                var n = this._camera.getView()
                  , r = this._camera
                  , a = r.getViewport().width()
                  , s = r.getViewport().height();
                this._rotate.setWidth(a),
                this._rotate.setHeight(s),
                this._pan.setWidth(a),
                this._pan.setHeight(s);
                var o, u;
                if (0 != (4 & this._dimensionMask) && (t = n.computeIntersections(i[0], i[1]),
                t.length > 0 && (o = t[0].point,
                t[0].nodepath.shift(),
                u = l.computeLocalToWorld(t[0].nodepath),
                c.transformMat4(e, o, u),
                this.setPivotPoint(e))),
                0 === t.length && this._usePolytopeIntersector) {
                    var h = this.getOrCreatePolytopeIntersector();
                    h.reset(),
                    h.setPolytopeFromWindowCoordinates(i[0] - 5, i[1] - 5, i[0] + 5, i[1] + 5);
                    var d = this._intersectionVisitor;
                    d.setIntersector(h),
                    n.getCamera().accept(d),
                    t = h.getIntersections(),
                    t.sort(function(t, e) {
                        return t._distance - e._distance
                    }),
                    t.length > 0 && (o = t[0]._center,
                    t[0].nodePath.shift(),
                    u = l.computeLocalToWorld(t[0].nodePath),
                    c.transformMat4(e, o, u),
                    this.setPivotPoint(e))
                }
            }
        }(),
        getPositionRelativeToCanvas: function() {
            var t = h.create()
              , e = h.create();
            return function(i, n) {
                var r = this._camera._graphicContext.canvas;
                this.getOffsetRect(r, t);
                var a = r.width / r.clientWidth
                  , s = r.height / r.clientHeight;
                return e[0] = (i - t[1]) * a,
                e[1] = (r.clientHeight - (n - t[0])) * s,
                e
            }
        }(),
        getCanvasCenter: function() {
            var t = h.create()
              , e = h.create();
            return function() {
                var i = this._camera.getGraphicContext().canvas;
                this.getOffsetRect(i, t);
                var n = i.width / i.clientWidth
                  , r = i.height / i.clientHeight;
                return e[0] = i.clientWidth / 2 * n,
                e[1] = i.clientHeight / 2 * r,
                e
            }
        }(),
        getOffsetRect: function(t, e) {
            var i = t.getBoundingClientRect()
              , n = document.body
              , r = document.documentElement
              , a = window.pageYOffset || r.scrollTop || n.scrollTop
              , s = window.pageXOffset || r.scrollLeft || n.scrollLeft
              , o = r.clientTop || n.clientTop || 0
              , l = r.clientLeft || n.clientLeft || 0
              , u = i.top + a - o
              , h = i.left + s - l;
            return e[0] = Math.round(u),
            e[1] = Math.round(h),
            e
        }
    }),
    m.StandardMouseKeyboard = p,
    m.Hammer = f,
    t.exports = m
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(462)
      , a = i(5).mat4
      , s = i(5).vec2
      , o = i(5).vec3
      , l = i(5).quat
      , u = i(530)
      , h = i(630)
      , c = i(632)
      , d = i(631)
      , p = i(463)
      , f = function(t) {
        r.call(this, t),
        this.init()
    };
    f.AvailableControllerList = ["StandardMouseKeyboard", "WebVR", "DeviceOrientation", "Hammer"],
    f.ControllerList = ["StandardMouseKeyboard", "WebVR", "DeviceOrientation", "Hammer"],
    f.prototype = n.objectInherit(r.prototype, {
        computeHomePosition: function(t) {
            var e = this.getHomeBound(t);
            if (e && e.valid()) {
                this._distance = this.getHomeDistance(e);
                var i = e.center();
                o.scale(this._eye, this._direction, -this._distance),
                o.add(this._eye, i, this._eye),
                this.setTarget(i)
            }
        },
        init: function() {
            this._direction = o.fromValues(0, 1, 0),
            this._eye = o.fromValues(0, 25, 10),
            this._up = o.fromValues(0, 0, 1),
            this._distance = 1,
            this._forward = new p(1),
            this._side = new p(1),
            this._lookPosition = new p(2),
            this._pan = new p(2),
            this._zoom = new p(1),
            this._stepFactor = 1,
            this._angleVertical = 0,
            this._angleHorizontal = 0,
            this._tmpGetTargetDir = o.create(),
            this._vrEnable = !1,
            this._vrRot = l.create(),
            this._vrPos = o.create(),
            this._vrTrans = o.create();
            var t = this;
            this._controllerList = {},
            f.ControllerList.forEach(function(e) {
                void 0 !== f[e] && (t._controllerList[e] = new f[e](t))
            })
        },
        setDelay: function(t) {
            this._forward.setDelay(t),
            this._side.setDelay(t),
            this._lookPosition.setDelay(t),
            this._pan.setDelay(t),
            this._zoom.setDelay(t)
        },
        getEyePosition: function(t) {
            return t[0] = this._eye[0],
            t[1] = this._eye[1],
            t[2] = this._eye[2],
            t
        },
        setEyePosition: function(t) {
            return this._eye[0] = t[0],
            this._eye[1] = t[1],
            this._eye[2] = t[2],
            this
        },
        getTarget: function(t) {
            var e = o.scale(this._tmpGetTargetDir, this._direction, this._distance);
            return o.add(t, this._eye, e),
            t
        },
        setTarget: function(t) {
            var e = this._tmpGetTargetDir;
            o.sub(e, t, this._eye),
            e[2] = 0,
            o.normalize(e, e),
            this._angleHorizontal = Math.acos(e[1]),
            e[0] < 0 && (this._angleHorizontal = -this._angleHorizontal),
            o.sub(e, t, this._eye),
            o.normalize(e, e),
            this._angleVertical = -Math.asin(e[2]),
            o.copy(this._direction, e)
        },
        getLookPositionInterpolator: function() {
            return this._lookPosition
        },
        getSideInterpolator: function() {
            return this._side
        },
        getForwardInterpolator: function() {
            return this._forward
        },
        getPanInterpolator: function() {
            return this._pan
        },
        getZoomInterpolator: function() {
            return this._zoom
        },
        getRotateInterpolator: function() {
            return this._lookPosition
        },
        computeRotation: function() {
            var t = a.create()
              , e = a.create()
              , i = o.fromValues(1, 0, 0)
              , n = o.fromValues(0, 1, 0)
              , r = o.fromValues(0, 0, 1)
              , s = .5 * Math.PI;
            return function(l, u) {
                this._angleVertical += .01 * u,
                this._angleHorizontal -= .01 * l,
                this._angleVertical > s ? this._angleVertical = s : this._angleVertical < -s && (this._angleVertical = -s),
                this._vrEnable ? (o.transformQuat(this._direction, n, this._vrRot),
                o.normalize(this._direction, this._direction),
                o.transformQuat(this._up, r, this._vrRot)) : (a.fromRotation(t, -this._angleVertical, i),
                a.fromRotation(e, -this._angleHorizontal, r),
                a.mul(e, e, t),
                o.transformMat4(this._direction, n, e),
                o.normalize(this._direction, this._direction),
                o.transformMat4(this._up, r, e))
            }
        }(),
        reset: function() {
            this.init()
        },
        setDistance: function(t) {
            this._distance = t
        },
        getDistance: function() {
            return this._distance
        },
        setStepFactor: function(t) {
            this._stepFactor = t
        },
        computePosition: function() {
            var t = s.create();
            return function(e) {
                this._forward.update(e),
                this._side.update(e);
                var i = this._distance < .001 ? .001 : this._distance
                  , n = this._camera.getProjectionMatrix()
                  , r = 1 === n[15] ? 1 : 2 / n[5];
                t[0] = this._forward.getCurrent()[0],
                t[1] = this._side.getCurrent()[0];
                var a = s.sqrLen(t);
                a > 1 && s.scale(t, t, 1 / Math.sqrt(a));
                var l = this._pan.update(e)
                  , u = this._zoom.update(e)
                  , h = this._stepFactor * i * r * e
                  , c = this._stepFactor * i * r * .005;
                this.moveForward(t[0] * h - u[0] * c * 20),
                this.strafe(t[1] * h - l[0] * c),
                this.strafeVertical(-l[1] * c),
                this._vrEnable && (o.add(this._eye, this._eye, this._vrTrans),
                o.init(this._vrTrans))
            }
        }(),
        update: function() {
            var t = o.create();
            return function(e) {
                var i = e.getFrameStamp().getDeltaTime()
                  , n = this._lookPosition.update(i);
                this.computeRotation(.5 * -n[0], .5 * -n[1]),
                this.computePosition(i),
                o.add(t, this._eye, this._direction),
                a.lookAt(this._inverseMatrix, this._eye, t, this._up),
                this._vrEnable = !1
            }
        }(),
        setPoseVR: function(t, e) {
            this._vrEnable = !0,
            l.copy(this._vrRot, t),
            o.sub(this._vrTrans, e, this._vrPos),
            o.copy(this._vrPos, e)
        },
        moveForward: function() {
            var t = o.create();
            return function(e) {
                o.normalize(t, this._direction),
                o.scale(t, t, e),
                o.add(this._eye, this._eye, t)
            }
        }(),
        strafe: function() {
            var t = o.create();
            return function(e) {
                o.cross(t, this._direction, this._up),
                o.normalize(t, t),
                o.scale(t, t, e),
                o.add(this._eye, this._eye, t)
            }
        }(),
        strafeVertical: function() {
            var t = o.create();
            return function(e) {
                o.normalize(t, this._up),
                o.scale(t, t, e),
                o.add(this._eye, this._eye, t)
            }
        }()
    }),
    f.DeviceOrientation = u,
    f.Hammer = h,
    f.WebVR = c,
    f.StandardMouseKeyboard = d,
    t.exports = f
}
, function(t, e, i) {
    "use strict";
    var n = function() {
        this._manipulatorList = [],
        this._currentManipulator = void 0
    };
    n.prototype = {
        getCamera: function() {
            return this.getCurrentManipulator().getCamera()
        },
        setCamera: function(t) {
            for (var e = this.getManipulatorList(), i = 0, n = e.length; i < n; ++i)
                e[i].setCamera(t)
        },
        update: function(t) {
            var e = this.getCurrentManipulator();
            if (void 0 !== e)
                return e.update(t)
        },
        getNode: function() {
            return this.getCurrentManipulator()._node
        },
        setNode: function(t) {
            for (var e = this.getManipulatorList(), i = 0, n = e.length; i < n; ++i)
                e[i].setNode(t)
        },
        getControllerList: function() {
            return this.getCurrentManipulator().getControllerList()
        },
        getNumManipulator: function() {
            return this._manipulatorList.length
        },
        addManipulator: function(t) {
            this._manipulatorList.push(t),
            void 0 === this._currentManipulator && this.setManipulatorIndex(0)
        },
        getManipulatorList: function() {
            return this._manipulatorList
        },
        setManipulatorIndex: function(t) {
            this._currentManipulator = t
        },
        getCurrentManipulatorIndex: function() {
            return this._currentManipulator
        },
        getCurrentManipulator: function() {
            return this._manipulatorList[this._currentManipulator]
        },
        reset: function() {
            this.getCurrentManipulator().reset()
        },
        computeHomePosition: function(t) {
            var e = this.getCurrentManipulator();
            void 0 !== e && e.computeHomePosition(t)
        },
        getInverseMatrix: function() {
            var t = this.getCurrentManipulator();
            if (void 0 !== t)
                return t.getInverseMatrix()
        },
        getHomeBound: function(t) {
            return this.getCurrentManipulator().getHomeBound(t)
        },
        getHomeDistance: function(t) {
            return this.getCurrentManipulator().getHomeDistance(t)
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(169)
      , r = i(858)
      , a = i(629)
      , s = i(628)
      , o = i(859)
      , l = i(530)
      , u = i(630)
      , h = i(631)
      , c = i(632)
      , d = i(462)
      , p = i(531)
      , f = i(633)
      , g = i(634)
      , m = i(532)
      , v = i(635)
      , _ = i(636)
      , b = i(637)
      , x = i(860)
      , y = i(638)
      , S = {};
    n.NO_MOUSEEVENTS = !0,
    S.CADManipulator = r,
    S.getCADManipulatorStandardMouseKeyboardController = function() {
        return a
    }
    ,
    S.getCADManipulatorHammerController = function() {
        return s
    }
    ,
    S.FirstPersonManipulator = o,
    S.getFirstPersonDeviceOrientationController = function() {
        return l
    }
    ,
    S.getFirstPersonManipulatorHammerController = function() {
        return u
    }
    ,
    S.getFirstPersonStandardMouseKeyboardControllerClass = function() {
        return h
    }
    ,
    S.getFirstPersonWebVRControllerClass = function() {
        return c
    }
    ,
    S.Manipulator = d,
    S.OrbitManipulator = p,
    S.getOrbitManipulatorDeviceOrientationController = function() {
        return f
    }
    ,
    S.getOrbitManipulatorGamePadController = function() {
        return g
    }
    ,
    S.getOrbitManipulatorHammerController = function() {
        return m
    }
    ,
    S.getOrbitManipulatorLeapMotionController = function() {
        return v
    }
    ,
    S.getOrbitManipulatorStandardMouseKeyboardController = function() {
        return _
    }
    ,
    S.getOrbitManipulatorWebVRController = function() {
        return b
    }
    ,
    S.SwitchManipulator = x,
    S.OrbitManipulator.Rotate = y.ROTATE,
    S.OrbitManipulator.Pan = y.PAN,
    S.OrbitManipulator.Zoom = y.ZOOM,
    t.exports = S
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i(417)
      , a = i(529)
      , s = i(435)
      , o = i(461)
      , l = i(617)
      , u = i(459)
      , h = i(414)
      , c = i(623)
      , d = i(622)
      , p = i(525)
      , f = i(415)
      , g = i(416)
      , m = g.createQuatChannel
      , v = g.createVec3Channel
      , _ = i(376)
      , b = i(143)
      , x = i(93)
      , y = i(163)
      , S = i(519)
      , w = i(321)
      , C = i(134)
      , M = i(162)
      , T = i(526)
      , A = i(460)
      , E = i(528)
      , P = i(81)
      , n = i(7)
      , N = i(5).vec3
      , k = i(5).quat
      , F = i(5).mat4
      , D = function() {
        this._filesMap = void 0,
        this._loadedFiles = void 0,
        this._bufferViewCache = void 0,
        this._basicAnimationManager = void 0,
        this._visitedNodes = void 0,
        this._animatedNodes = void 0,
        this._skeletons = void 0,
        this._bones = void 0,
        this._skeletonToInfluenceMap = void 0,
        this._inputImgReader = void 0,
        this._localPath = "",
        this.init()
    };
    D.WEBGL_COMPONENT_TYPES = {
        5120: Int8Array,
        5121: Uint8Array,
        5122: Int16Array,
        5123: Uint16Array,
        5125: Uint32Array,
        5126: Float32Array
    },
    D.TYPE_TABLE = {
        SCALAR: 1,
        VEC2: 2,
        VEC3: 3,
        VEC4: 4,
        MAT2: 4,
        MAT3: 9,
        MAT4: 16
    },
    D.TEXTURE_FORMAT = {
        6406: x.ALPHA,
        6407: x.RGB,
        6408: x.RGBA,
        6409: x.LUMINANCE,
        6410: x.LUMINANCE_ALPHA
    },
    D.PBR_SPEC_EXT = "KHR_materials_pbrSpecularGlossiness",
    D.PBR_SPEC_MODE = "PBR_specular_glossiness",
    D.PBR_METAL_MODE = "PBR_metal_roughness",
    D.ALBEDO_TEXTURE_UNIT = 2,
    D.DIFFUSE_TEXTURE_UNIT = 2,
    D.SPECULAR_GLOSSINESS_TEXTURE_UNIT = 3,
    D.METALLIC_ROUGHNESS_TEXTURE_UNIT = 3,
    D.SPECULAR_TEXTURE_UNIT = 4,
    D.NORMAL_TEXTURE_UNIT = 5,
    D.AO_TEXTURE_UNIT = 6,
    D.ALBEDO_UNIFORM = "albedoMap",
    D.METALLIC_ROUGHNESS_UNIFORM = "metallicRoughnessMap",
    D.SPECULAR_UNIFORM = "specularMap",
    D.NORMAL_UNIFORM = "normalMap",
    D.AO_UNIFORM = "aoMap",
    D.prototype = {
        init: function() {
            this._glTFJSON = void 0,
            this._bufferViewCache = {},
            this._basicAnimationManager = void 0,
            this._localPath = "",
            this._visitedNodes = {},
            this._animatedNodes = {},
            this._skeletons = {},
            this._bones = {},
            this._skeletonToInfluenceMap = {},
            this._stateSetMap = {},
            this._filesMap = new window.Map,
            this._inputReader = new a
        },
        loadFile: n.method(function(t) {
            if (this._filesMap.has(t))
                return this._filesMap.get(t);
            var e, i = t.substr(t.lastIndexOf(".") + 1), n = E.getTypeForExtension(i), r = this._localPath + t;
            return "blob" === n ? e = this._inputReader.readImageURL(r, {
                imageLoadingUsePromise: !0
            }) : "arraybuffer" === n && (e = this._inputReader.readBinaryArrayURL(r, {
                fileType: n
            })),
            this._filesMap.set(t, e),
            e.then(function(t) {
                return t
            }),
            e
        }),
        loadAccessorBuffer: function(t, e) {
            var i = this._glTFJSON
              , n = i.bufferViews[t.bufferView]
              , r = i.buffers[n.buffer]
              , a = this;
            return this.loadFile(r.uri).then(function(i) {
                return a.assignBuffers(i, t, e, n)
            })
        },
        assignBuffers: n.method(function(t, e, i, n) {
            if (!t)
                return null;
            var r = D.WEBGL_COMPONENT_TYPES[e.componentType]
              , a = null;
            return this._bufferViewCache[e.bufferView] || (this._bufferViewCache[e.bufferView] = t.slice(n.byteOffset, n.byteOffset + n.byteLength)),
            a = new r(this._bufferViewCache[e.bufferView],e.byteOffset,e.count * D.TYPE_TABLE[e.type]),
            i ? new M(i,a,D.TYPE_TABLE[e.type],!0) : a
        }),
        findByKey: function(t, e) {
            return t && t[e]
        },
        registerUpdateCallback: function(t, e) {
            var i = this._glTFJSON
              , n = null;
            n = i.nodes[t].jointName ? new T : new A,
            n.setName(t);
            var r = N.create();
            F.getTranslation(r, e.getMatrix());
            var a = k.create();
            F.getRotation(a, e.getMatrix());
            var s = N.create();
            F.getScale(s, e.getMatrix()),
            n.getStackedTransforms().push(new c("translation",r)),
            n.getStackedTransforms().push(new d("rotation",a)),
            n.getStackedTransforms().push(new p("scale",s)),
            e.addUpdateCallback(n)
        },
        createTextureAndSetAttrib: n.method(function(t, e, i, n) {
            if (t) {
                var r = this._glTFJSON
                  , a = r.textures[t.index];
                if (a) {
                    var s = r.images[a.source];
                    if (s) {
                        var o = new x;
                        o.setFlipY(!1),
                        o.setWrapS("REPEAT"),
                        o.setWrapT("REPEAT"),
                        this.loadFile(s.uri).then(function(t) {
                            t && (o.setImage(t, D.TEXTURE_FORMAT[a.format]),
                            e.setTextureAttributeAndModes(i, o),
                            n && e.addUniform(P.createInt(i, n)))
                        })
                    }
                }
            }
        }),
        loadTransform: function(t) {
            var e = F.create();
            if (t.matrix)
                return F.copy(e, t.matrix),
                e;
            var i = t.scale || N.ONE
              , n = t.rotation || k.IDENTITY
              , r = t.translation || N.ZERO;
            return F.fromRotationTranslationScale(e, n, r, i),
            e
        },
        preprocessChannel: function(t, e) {
            var i = this._glTFJSON
              , r = []
              , a = e.samplers[t.sampler]
              , s = i.accessors[a.input]
              , o = i.accessors[a.output]
              , l = this.loadAccessorBuffer(s, null)
              , u = this.loadAccessorBuffer(o, null);
            r.push(l, u);
            var h = this;
            return n.all(r).then(function(e) {
                var i = e[0]
                  , n = e[1]
                  , r = null;
                return 4 === D.TYPE_TABLE[o.type] ? r = m(n, i, t.target.node, a.output, null) : 3 === D.TYPE_TABLE[o.type] && (r = v(n, i, t.target.node, a.output, null)),
                h._animatedNodes[t.target.node] = !0,
                r
            })
        },
        createAnimationFromChannels: function(t, e) {
            return n.all(t).then(function(t) {
                return o.createAnimation(t, e)
            })
        },
        preprocessAnimations: n.method(function() {
            var t = this._glTFJSON;
            if (t.animations) {
                for (var e = [], i = window.Object.keys(t.animations), r = 0; r < i.length; ++r) {
                    for (var a = t.animations[i[r]], s = [], o = 0; o < a.channels.length; ++o) {
                        var u = a.channels[o]
                          , h = this.preprocessChannel(u, a);
                        s.push(h)
                    }
                    var c = this.createAnimationFromChannels(s, i[r]);
                    e.push(c)
                }
                var d = this;
                return n.all(e).then(function(t) {
                    var e = new l;
                    e.init(t),
                    d._basicAnimationManager = e
                })
            }
        }),
        loadBone: function(t, e) {
            var i = this._glTFJSON
              , n = i.nodes[t]
              , r = this
              , a = i.accessors[e.inverseBindMatrices];
            return this.loadAccessorBuffer(a, null).then(function(i) {
                for (var a = 0; a < e.jointNames.length && e.jointNames[a] !== n.jointName; ++a)
                    ;
                var s = new h(n.jointName)
                  , o = i.subarray(16 * a, 16 * a + 16);
                return s.setInvBindMatrixInSkeletonSpace(o),
                r._bones[t] = s,
                s
            })
        },
        buildInfluenceMap: function(t, e) {
            if (!this._skeletonToInfluenceMap[t]) {
                this._skeletonToInfluenceMap[t] = {};
                for (var i = 0; i < e.jointNames.length; i++) {
                    var n = e.jointNames[i];
                    this._skeletonToInfluenceMap[t][n] = i
                }
            }
        },
        mapBonesToSkin: function() {
            for (var t = this._glTFJSON, e = {}, i = window.Object.keys(t.skins), n = 0; n < i.length; ++n)
                for (var r = t.skins[i[n]], a = 0; a < r.jointNames.length; ++a)
                    for (var s = r.jointNames[a], o = window.Object.keys(t.nodes), l = 0; l < o.length; ++l) {
                        var u = t.nodes[o[l]];
                        u.jointName && u.jointName === s && (e[o[l]] = r)
                    }
            return e
        },
        preprocessBones: function(t) {
            for (var e = this._glTFJSON, i = window.Object.keys(e.nodes), r = [], a = 0; a < i.length; ++a) {
                var s = i[a];
                if (e.nodes[s].jointName) {
                    var o = this.loadBone(s, t[s]);
                    r.push(o)
                }
            }
            return n.all(r)
        },
        preprocessSkeletons: n.method(function() {
            var t = this._glTFJSON;
            if (t.skins) {
                for (var e = this.mapBonesToSkin(), i = window.Object.keys(t.nodes), n = 0; n < i.length; ++n) {
                    var r = i[n]
                      , a = t.nodes[r]
                      , s = t.skins[a.skin];
                    if (a.skeletons)
                        for (var o = 0; o < a.skeletons.length; ++o) {
                            for (var l = null, h = a.skeletons[o], c = 0; c < i.length; ++c) {
                                var d = i[c]
                                  , p = t.nodes[d];
                                if (p.jointName) {
                                    var f = t.nodes[h];
                                    if (p.jointName === f.jointName) {
                                        l = d;
                                        break
                                    }
                                }
                            }
                            l && !this._skeletons[l] && (this._skeletons[h] = new u,
                            e[l] = s),
                            this.buildInfluenceMap(h, s)
                        }
                }
                return this.preprocessBones(e)
            }
        }),
        loadPBRMaterial: n.method(function(t, e, i, r) {
            var a = e.pbrMetallicRoughness
              , s = i.getOrCreateStateSet()
              , o = []
              , l = "";
            return a && (a.baseColorTexture && o.push(this.createTextureAndSetAttrib(a.baseColorTexture, s, D.ALBEDO_TEXTURE_UNIT, D.ALBEDO_UNIFORM)),
            a.metallicRoughnessTexture && o.push(this.createTextureAndSetAttrib(a.metallicRoughnessTexture, s, D.METALLIC_ROUGHNESS_TEXTURE_UNIT, D.METALLIC_ROUGHNESS_UNIFORM)),
            l = D.PBR_METAL_MODE),
            r && (r.diffuseTexture && o.push(this.createTextureAndSetAttrib(r.diffuseTexture, s, D.DIFFUSE_TEXTURE_UNIT, D.ALBEDO_UNIFORM)),
            r.specularGlossinessTexture && o.push(this.createTextureAndSetAttrib(r.specularGlossinessTexture, s, D.SPECULAR_GLOSSINESS_TEXTURE_UNIT, D.METALLIC_ROUGHNESS_UNIFORM)),
            l = D.PBR_SPEC_MODE),
            e.normalTexture && o.push(this.createTextureAndSetAttrib(e.normalTexture, s, D.NORMAL_TEXTURE_UNIT, D.NORMAL_UNIFORM)),
            e.occlusionTexture && o.push(this.createTextureAndSetAttrib(e.occlusionTexture, s, D.AO_TEXTURE_UNIT, D.AO_UNIFORM)),
            i.setUserData({
                pbrWorklow: l
            }),
            i.stateset = s,
            s.setRenderingHint("TRANSPARENT_BIN"),
            s.setRenderBinDetails(1e3, "RenderBin"),
            s.setAttributeAndModes(new _("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")),
            this._stateSetMap[t] = s,
            n.all(o)
        }),
        loadMaterial: n.method(function(t, e) {
            var i = this._glTFJSON
              , n = i.materials[t];
            if (this._stateSetMap[t])
                return void (e.stateset = this._stateSetMap[t]);
            var r = this.findByKey(n.extensions, D.PBR_SPEC_EXT);
            if (n.pbrMetallicRoughness || r)
                return this.loadPBRMaterial(t, n, e, r);
            var a = n.values;
            if (a) {
                var s = new S
                  , o = e.getOrCreateStateSet();
                if (o.setAttribute(s),
                a.ambient && s.setAmbient(a.ambient),
                a.emission && s.setEmission(a.emission),
                a.shininess && s.setShininess(a.shininess),
                a.specular && s.setSpecular(a.specular),
                a.diffuse) {
                    if ("string" == typeof a.diffuse)
                        return this.createTextureAndSetAttrib(a.diffuse, o, 0);
                    s.setDiffuse(a.diffuse)
                }
                e.stateset = o,
                this._stateSetMap[t] = o
            }
        }),
        createGeometry: function(t, e) {
            var i = this._glTFJSON
              , r = []
              , a = new b
              , s = a
              , o = function(t, e) {
                e && (this.getVertexAttributeList()[t] = e)
            };
            e && (s = new f,
            s._boneNameID = this._skeletonToInfluenceMap[e]);
            for (var l = function(t) {
                if (t) {
                    s.getAttributes().Weights = t;
                    for (var e = s.getAttributes().Weights.getElements(), i = 0, n = e.length / 4; i < n; ++i) {
                        var r = e[4 * i] + e[4 * i + 1] + e[4 * i + 2] + e[4 * i + 3]
                          , a = 1 / r;
                        e[4 * i] *= a,
                        e[4 * i + 1] *= a,
                        e[4 * i + 2] *= a,
                        e[4 * i + 3] *= a
                    }
                }
            }, u = window.Object.keys(t.attributes), h = 0; h < u.length; ++h) {
                var c = i.accessors[t.attributes[u[h]]]
                  , d = this.loadAccessorBuffer(c, M.ARRAY_BUFFER);
                if (-1 !== u[h].indexOf("POSITION"))
                    d.then(o.bind(a, "Vertex"));
                else if (-1 !== u[h].indexOf("NORMAL"))
                    d.then(o.bind(a, "Normal"));
                else if (-1 !== u[h].indexOf("TANGENT"))
                    d.then(o.bind(a, "Tangent"));
                else if (-1 !== u[h].indexOf("JOINT"))
                    d.then(o.bind(s, "Bones"));
                else if (-1 !== u[h].indexOf("WEIGHT"))
                    d.then(l);
                else if (-1 !== u[h].indexOf("TEXCOORD")) {
                    var p = u[h].substr(9);
                    d.then(o.bind(a, "TexCoord" + p))
                }
                r.push(d)
            }
            var g = i.accessors[t.indices]
              , m = this.loadAccessorBuffer(g, M.ELEMENT_ARRAY_BUFFER);
            return m.then(function(t) {
                if (t) {
                    var e = new w(C.TRIANGLES,t);
                    a.getPrimitives().push(e)
                }
            }),
            r.push(m),
            void 0 !== t.material && r.push(this.loadMaterial(t.material, a)),
            n.all(r).then(function() {
                return e && (s.setSourceGeometry(a),
                s.mergeChildrenData(),
                s.computeBoundingBox = a.computeBoundingBox),
                s
            })
        },
        loadGLTFPrimitives: function(t, e, i) {
            for (var r = this._glTFJSON, a = r.meshes[t], s = a.primitives, o = [], l = 0; l < s.length; ++l) {
                var u = s[l]
                  , h = this.createGeometry(u, i);
                o.push(h)
            }
            return n.all(o).then(function(t) {
                for (var i = 0; i < t.length; ++i)
                    e.addChild(t[i]);
                return t
            })
        },
        loadGLTFNode: n.method(function(t, e) {
            if (!this._visitedNodes[t]) {
                var i = this._glTFJSON
                  , r = i.nodes[t]
                  , a = r.jointName ? this._bones[t] : new y;
                if (a.setName(t),
                F.copy(a.getMatrix(), this.loadTransform(r)),
                r.jointName && this._skeletons[r.joinName]) {
                    var s = this._skeletons[r.jointName];
                    s.addChild(a),
                    e.addChild(s)
                }
                var o, l = r.children, u = [];
                if (l)
                    for (o = 0; o < l.length; ++o) {
                        var h = this.loadGLTFNode(l[o], a);
                        u.push(h)
                    }
                if (void 0 !== r.mesh) {
                    var c = r.mesh;
                    if (r.skeletons)
                        for (var d = 0; d < r.skeletons.length; ++d) {
                            var p = r.skeletons[d]
                              , f = this._skeletons[p]
                              , g = new y;
                            F.copy(g.getMatrix(), a.getMatrix());
                            var m = this.loadGLTFPrimitives(c, g, p);
                            f.addChild(g),
                            u.push(m)
                        }
                    else {
                        var v = this.loadGLTFPrimitives(c, a, null);
                        u.push(v)
                    }
                }
                return this._animatedNodes[t] && this.registerUpdateCallback(t, a),
                this._skeletons[t] || e.addChild(a),
                this._visitedNodes[t] = !0,
                n.all(u)
            }
        }),
        readNodeURL: function(t, e) {
            var i = n.defer()
              , a = this;
            if (this.init(),
            e && void 0 !== e.filesMap && e.filesMap.size > 0) {
                this._filesMap = e.filesMap;
                var s = this._filesMap.get(t);
                return this.readJSON(s, t)
            }
            var o = t.lastIndexOf("/");
            return this._localPath = -1 === o ? "" : t.substr(0, o + 1),
            r(t).then(function(t) {
                i.resolve(a.readJSON(t))
            }),
            i.promise
        },
        readJSON: n.method(function(t, e) {
            var i = new y;
            i.setName(e);
            var r = JSON.parse(t);
            if (r) {
                this._glTFJSON = r;
                var a = []
                  , s = this.preprocessAnimations()
                  , o = this.preprocessSkeletons();
                a.push(o, s);
                var l = this;
                return n.all(a).then(function() {
                    for (var t = [], e = window.Object.keys(r.scenes), a = 0; a < e.length; ++a) {
                        var s = r.scenes[e[a]];
                        if (s)
                            for (var o = 0; o < s.nodes.length; ++o) {
                                var u = l.loadGLTFNode(s.nodes[o], i);
                                t.push(u)
                            }
                    }
                    return l._basicAnimationManager && i.addUpdateCallback(l._basicAnimationManager),
                    n.all(t).then(function() {
                        return i
                    })
                })
            }
        })
    },
    s.instance().addReaderWriter("gltf", new D),
    t.exports = D
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i(417)
      , a = i(28)
      , s = i(435)
      , o = i(382)
      , l = i(528)
      , u = window.JSZip
      , h = function() {
        this._options = void 0,
        this._filesMap = new window.Map,
        this._fileName = ""
    };
    h.prototype = {
        readNodeURL: function(t, e) {
            var i = n.defer();
            if (void 0 === u)
                return a.error("You need to add JSZip as a dependency"),
                i.reject();
            a.log("starting to read: " + t);
            var s = this;
            if (e && void 0 !== e.filesMap && e.filesMap.has(t)) {
                var l = e.filesMap.get(t);
                return this.readZipFile(l).then(function() {
                    return s._fileName.length ? o.readNodeURL(s._fileName, {
                        filesMap: s._filesMap
                    }) : n.reject(s)
                })
            }
            return r(t, {
                responseType: "blob"
            }).then(function(t) {
                s.readZipFile(t).then(function() {
                    i.resolve(o.readNodeURL(s._fileName, {
                        filesMap: s._filesMap
                    }))
                })
            }),
            i.promise
        },
        _registerZipImage: function(t, e, i, n) {
            var r = n;
            "base64" === e && (r = new window.Image,
            r.src = "data:image/" + i + ";base64," + n),
            this._filesMap.set(t, r)
        },
        readZipFile: function(t) {
            var e = n.defer();
            return u.loadAsync(t).then(function(t) {
                var i = [];
                for (var r in t.files) {
                    var a = r.substr(r.lastIndexOf(".") + 1);
                    void 0 === s.instance().getReaderWriterForExtension(a) && "osgjs" !== a || (this._fileName = r);
                    var o = l.getTypeForExtension(a);
                    if (void 0 !== o) {
                        "blob" === o && (o = "base64");
                        var u = t.file(r).async(o).then(this._registerZipImage.bind(this, r, o, a));
                        i.push(u)
                    }
                }
                n.all(i).then(function() {
                    e.resolve()
                })
            }
            .bind(this)),
            e.promise
        }
    },
    s.instance().addReaderWriter("zip", new h),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(862)
      , r = i(863)
      , a = {};
    a.ReaderWriterGLTF = n,
    a.ReaderWriterZIP = r,
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(432)
      , r = i(28)
      , a = i(13)
      , s = {
        _createFragmentShader: function() {
            var t = this.createFragmentShaderGraph()
              , e = this.getFragmentShaderName();
            e && t.push(this.getNode("Define", "SHADER_NAME").setValue(e));
            var i = this.createShaderFromGraphs(t);
            return r.debug(this.getDebugIdentifier()),
            r.debug(i),
            this.cleanAfterFragment(),
            i
        },
        applyPointSizeCircle: function(t) {
            return this._pointSizeAttribute && this._pointSizeAttribute.isEnabled() && this._pointSizeAttribute.isCircleShape() ? (this.getNode("InlineCode").code("if (length(2.0 * gl_PointCoord - 1.0) > %radius) discard;").inputs({
                radius: this.getOrCreateConstantOne("float")
            }).outputs({
                output: t
            }),
            t) : t
        },
        cleanAfterFragment: function() {
            this._variables = {},
            this._activeNodeList = {};
            for (var t in this._texturesByName)
                this._texturesByName[t].variable = void 0;
            for (var e in this._varyings) {
                var i = this._varyings[e];
                i.reset(),
                this._activeNodeList[i.getID()] = i,
                this._variables[e] = i
            }
        },
        createDefaultFragmentShaderGraph: function() {
            var t = this.getOrCreateConstant("vec4", "fofd").setValue("vec4(1.0, 0.0, 1.0, 0.7)")
              , e = this.getNode("glFragColor");
            return this.getNode("SetFromNode").inputs(t).outputs(e),
            e
        },
        createFragmentShaderGraph: function() {
            var t = [];
            if (!this._material)
                return t.push(this.createDefaultFragmentShaderGraph()),
                t;
            var e, i = this.getOrCreateStateAttributeUniforms(this._material), n = this.getVertexColor(i.diffuse);
            if (this._lights.length > 0) {
                e = this.createLighting({
                    materialdiffuse: n
                })
            } else
                e = n;
            if (i.emission) {
                var r = this.createVariable("vec3").setValue("vec3(0.0)");
                this.getNode("Add").inputs(e, i.emission).outputs(r),
                e = r
            }
            var a = this.getDiffuseColorFromTextures();
            void 0 !== a && this.getNode("InlineCode").code("%color.rgb *= %texture.rgb;").inputs({
                texture: a
            }).outputs({
                color: e
            });
            var s, o = this.createVariable("float"), l = this.getFirstValidTexture();
            s = l ? "%alpha = %color.a * %texelAlpha.a;" : "%alpha = %color.a;",
            this._isBillboard && (s += "if ( %alpha == 0.0) discard;"),
            this.getNode("InlineCode").code(s).inputs({
                color: i.diffuse,
                texelAlpha: l
            }).outputs({
                alpha: o
            }),
            e = this.getPremultAlpha(e, o);
            var u = this.getNode("glFragColor");
            return this.getNode("SetAlpha").inputs({
                color: e,
                alpha: o
            }).outputs({
                color: u
            }),
            t.push(u),
            t
        },
        getOrCreateFrontViewTangent: function() {
            var t = this._variables.frontViewTangent;
            return t || (t = this.createVariable("vec4", "frontViewTangent"),
            this.getNode("FrontNormal").inputs({
                normal: this.getOrCreateVarying("vec4", "vViewTangent")
            }).outputs({
                normal: t
            }),
            t)
        },
        getOrCreateFrontViewNormal: function() {
            var t = this._variables.frontViewNormal;
            return t || (t = this.createVariable("vec3", "frontViewNormal"),
            this.getNode("FrontNormal").inputs({
                normal: this.getOrCreateVarying("vec3", "vViewNormal")
            }).outputs({
                normal: t
            }),
            t)
        },
        getOrCreateNormalizedViewEyeDirection: function() {
            var t = this._variables.eyeVector;
            if (t)
                return t;
            var e = this.createVariable("vec3")
              , i = this.createVariable("vec3");
            this.getNode("SetFromNode").inputs(this.getOrCreateVarying("vec4", "vViewVertex")).outputs(i),
            this.getNode("Normalize").inputs({
                vec: i
            }).outputs({
                vec: e
            });
            var n = this.createVariable("vec3", "eyeVector");
            return this.getNode("Mult").inputs(e, this.createVariable("float").setValue("-1.0")).outputs(n),
            n
        },
        getOrCreateNormalizedFrontViewNormal: function() {
            var t = this._variables.nFrontViewNormal;
            return t || (t = this.createVariable("vec3", "nFrontViewNormal"),
            this.getNode("Normalize").inputs({
                vec: this.getOrCreateFrontViewNormal()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateFrontModelNormal: function() {
            var t = this._variables.frontModelNormal;
            return t || (t = this.createVariable("vec3", "frontModelNormal"),
            this.getNode("FrontNormal").inputs({
                normal: this.getOrCreateVarying("vec3", "vModelNormal")
            }).outputs({
                normal: t
            }),
            t)
        },
        getOrCreateNormalizedFrontModelNormal: function() {
            var t = this._variables.nFrontModelNormal;
            return t || (t = this.createVariable("vec3", "nFrontModelNormal"),
            this.getNode("Normalize").inputs({
                vec: this.getOrCreateFrontModelNormal()
            }).outputs({
                vec: t
            }),
            t)
        },
        getPremultAlpha: function(t, e) {
            if (void 0 === e)
                return t;
            var i = this.createVariable("vec4");
            return this.getNode("PreMultAlpha").inputs({
                color: t,
                alpha: e
            }).outputs({
                color: i
            }),
            i
        },
        getColorsRGB: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("LinearTosRGB").inputs({
                color: t
            }).outputs({
                color: e
            }),
            e
        },
        getVertexColor: function(t) {
            if (void 0 !== t) {
                var e = this.getOrCreateVarying("vec4", "vVertexColor")
                  , i = this.getOrCreateUniform("float", "uArrayColorEnabled")
                  , n = this.createVariable("vec4")
                  , r = ["", "%color.rgb = %diffuse.rgb;", "if ( %hasVertexColor == 1.0)", "  %color *= %vertexColor.rgba;"].join("\n");
                return this.getNode("InlineCode").code(r).inputs({
                    diffuse: t,
                    hasVertexColor: i,
                    vertexColor: e
                }).outputs({
                    color: n
                }).comment("diffuse color = diffuse color * vertex color"),
                n
            }
        },
        getDiffuseColorFromTextures: function() {
            var t = []
              , e = this._texturesByName;
            for (var i in e) {
                e[i].shadow || t.push(this.getTextureByName(i).variable)
            }
            if (t.length > 1) {
                var n = this.createVariable("vec3", "texDiffuseAccum");
                return this.getNode("Mult").inputs(t).outputs(n),
                n
            }
            if (1 === t.length)
                return t[0]
        },
        getFirstValidTexture: function() {
            for (var t = this._textures, e = 0, i = t.length; e < i; ++e) {
                var n = t[e];
                if (n)
                    return this.getTextureByName(n.getName()).variable
            }
        },
        createShadowingLight: function(t, e, i) {
            var n, r, s, o = !1, l = new Array(this._shadowsTextures.length), u = -1, h = t.getLightNumber();
            for (n = 0; n < this._shadows.length; n++)
                if (r = this._shadows[n],
                r.getLightNumber() === h) {
                    u = n;
                    for (var c = 0; c < this._shadowsTextures.length; c++)
                        (s = this._shadowsTextures[c]) && s.hasLightNumber(h) && (l[c] = s,
                        o = !0)
                }
            if (o) {
                var d = this.getOrCreateVarying("vec3", "vModelVertex")
                  , p = this.getOrCreateNormalizedFrontModelNormal()
                  , f = this.createVariable("float")
                  , g = this.getOrCreateStateAttributeUniforms(this._shadows[u], "shadow")
                  , m = a.objectMix(e, g);
                for (n = 0; n < l.length; n++)
                    (s = l[n]) && (m = this.createShadowTextureInputVarying(s, m, d, p, n, h));
                return this.getNode("ShadowReceive").inputs(e).outputs({
                    float: f
                }).setShadowAttribute(r),
                this.connectShadowLightNode(t, i, f, m)
            }
        },
        connectShadowLightNode: function(t, e, i) {
            var n = this.createVariable("vec3", "lightAndShadowTempOutput");
            return this.getNode("Mult").inputs(e, i).outputs(n),
            n
        },
        createShadowTextureInputVarying: function(t, e, i, n, r, s) {
            var o = "Texture" + r
              , l = this.getOrCreateSampler("sampler2D", o)
              , u = t.getOrCreateUniforms(r)
              , h = u[o];
            delete u[o];
            var c = {};
            for (var d in u) {
                var p, f = d.split("_");
                2 === f.length ? Number(f[1]) === s && (p = "shadowTexture" + f[0],
                c[p] = this.getOrCreateUniform(u[d])) : (p = "shadowTexture" + d,
                c[p] = this.getOrCreateUniform(u[d]))
            }
            var g = c;
            u[o] = h;
            var m = a.objectMix(e, g);
            m.shadowTexture = l;
            var v = {
                vertexWorld: i,
                normalWorld: n,
                lightEyeDir: m.lightEyeDir
            };
            return m = a.objectMix(m, v)
        },
        createCommonLightingVars: function() {
            return {}
        },
        createLightAndShadowVars: function(t, e, i) {
            var r, a = this._lights[i].getLightType(), s = this.createVariable("bool", "lighted" + i);
            return a !== n.SPOT && a !== n.POINT || (r = this.createVariable("vec3", "lightEyePos" + i)),
            {
                lighted: s,
                lightEyePos: r,
                lightEyeDir: this.createVariable("vec3", "lightEyeDir" + i)
            }
        },
        createLighting: function(t, e) {
            for (var i = this.createVariable("vec3"), n = [], r = e || {
                DIRECTION: "SunLight",
                SPOT: "SpotLight",
                POINT: "PointLight",
                HEMI: "HemiLight"
            }, s = this.getOrCreateStateAttributeUniforms(this._material, "material"), o = this.createCommonLightingVars(t, r), l = 0; l < this._lights.length; l++) {
                var u = this._lights[l]
                  , h = this.createVariable("vec3")
                  , c = r[u.getLightType()]
                  , d = this.getOrCreateStateAttributeUniforms(this._lights[l], "light")
                  , p = this.createLightAndShadowVars(t, r, l)
                  , f = a.objectMix({}, d);
                f = a.objectMix(f, s),
                f = a.objectMix(f, t),
                f = a.objectMix(f, o),
                f = a.objectMix(f, p),
                f.normal || (f.normal = this.getOrCreateNormalizedFrontViewNormal()),
                f.eyeVector || (f.eyeVector = this.getOrCreateNormalizedViewEyeDirection()),
                this.getNode(c).inputs(f).outputs({
                    color: h,
                    lightEyePos: f.lightEyePos,
                    lightEyeDir: f.lightEyeDir,
                    lighted: f.lighted
                });
                var g = this.createShadowingLight(u, f, h);
                g ? n.push(g) : n.push(h);
                var m = this.createVariable("vec3", "lightMatAmbientOutput");
                this.getNode("Mult").inputs(f.materialambient, d.lightambient).outputs(m),
                n.push(m)
            }
            return 0 === n.length && n.push(this.createVariable("vec3").setValue("vec3(0.0)")),
            this.getNode("Add").inputs(n).outputs(i),
            i
        },
        createTextureRGBA: function(t, e, i) {
            var n = this.createVariable("vec4");
            return this.getNode("TextureRGBA").inputs({
                sampler: e,
                uv: i
            }).outputs({
                color: n
            }),
            n
        }
    };
    for (var o in s)
        s[o] = function(t, e) {
            return function() {
                return this._fragmentShaderMode || this.logError("This function should not be called from vertex shader : " + e),
                t.apply(this, arguments)
            }
        }(s[o], o);
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = {
        _createVertexShader: function() {
            var t = this.declareVertexMain()
              , e = this.getVertexShaderName();
            e && t.push(this.getNode("Define", "SHADER_NAME").setValue(e));
            var i = this.createShaderFromGraphs(t);
            return n.debug(this.getDebugIdentifier()),
            n.debug(i),
            i
        },
        declareVertexMain: function() {
            var t = [this.declarePointSize(), this.declareVertexPosition()];
            return this.declareVertexVaryings(t),
            t
        },
        declarePointSize: function() {
            var t = this.getNode("glPointSize");
            return this._pointSizeAttribute && this._pointSizeAttribute.isEnabled() ? (this.getNode("InlineCode").code("%pointSize = min(64.0, max(1.0, -%size / %position.z));").inputs({
                position: this.getOrCreateViewVertex(),
                size: this.getOrCreateUniform("float", "uPointSize")
            }).outputs({
                pointSize: t
            }),
            t) : (this.getNode("SetFromNode").inputs(this.getOrCreateConstantOne("float")).outputs(t),
            t)
        },
        declareVertexVaryings: function(t) {
            var e = this._varyings;
            e.vModelVertex && this.getNode("SetFromNode").inputs(this.getOrCreateModelVertex()).outputs(e.vModelVertex),
            e.vModelNormal && this.getNode("SetFromNode").inputs(this.getOrCreateModelNormal()).outputs(e.vModelNormal),
            e.vModelTangent && this.getNode("SetFromNode").inputs(this.getOrCreateModelTangent()).outputs(e.vModelTangent),
            e.vViewVertex && this.getNode("SetFromNode").inputs(this.getOrCreateViewVertex()).outputs(e.vViewVertex),
            e.vViewNormal && this.getNode("SetFromNode").inputs(this.getOrCreateViewNormal()).outputs(e.vViewNormal),
            e.vViewTangent && this.getNode("SetFromNode").inputs(this.getOrCreateViewTangent()).outputs(e.vViewTangent),
            e.vVertexColor && this.getNode("InlineCode").code("%vcolor = %venabled == 1.0 ? %acolor : vec4(1.0, 1.0, 1.0, 1.0);").inputs({
                venabled: this.getOrCreateUniform("float", "uArrayColorEnabled"),
                acolor: this.getOrCreateAttribute("vec4", "Color")
            }).outputs({
                vcolor: this.getOrCreateVarying("vec4", "vVertexColor")
            });
            for (var i in e) {
                var n = e[i];
                t.push(n);
                var r = n.getVariable();
                -1 !== r.indexOf("vTexCoord") && this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec2", r.substring(1))).outputs(n)
            }
        },
        declareVertexPosition: function() {
            var t = this.getNode("glPosition");
            return this._isBillboard ? this.declareVertexTransformBillboard(t) : this.declareScreenVertex(t),
            t
        },
        getOrCreateModelVertex: function() {
            var t = this._variables.modelVertex;
            return t || (t = this.createVariable("vec3", "modelVertex"),
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uModelMatrix"),
                vec: this.getOrCreateLocalVertex()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateModelNormal: function() {
            var t = this._variables.modelNormal;
            return t || (t = this.createVariable("vec3", "modelNormal"),
            this.getNode("MatrixMultDirection").inputs({
                matrix: this.getOrCreateUniform("mat3", "uModelNormalMatrix"),
                vec: this.getOrCreateLocalNormal()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateModelTangent: function() {
            var t = this._variables.modelTangent;
            return t || (t = this.createVariable("vec4", "modelTangent"),
            this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({
                matrix: this.getOrCreateUniform("mat3", "uModelNormalMatrix"),
                vec: this.getOrCreateLocalTangent()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateViewVertex: function() {
            var t = this._variables.viewVertex;
            return t || (t = this.createVariable("vec4", "viewVertex"),
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uModelViewMatrix"),
                vec: this.getOrCreateLocalVertex()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateViewNormal: function() {
            var t = this._variables.viewNormal;
            return t || (t = this.createVariable("vec3", "viewNormal"),
            this.getNode("MatrixMultDirection").inputs({
                matrix: this.getOrCreateUniform("mat3", "uModelViewNormalMatrix"),
                vec: this.getOrCreateLocalNormal()
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateViewTangent: function() {
            var t = this._variables.viewTangent;
            return t || (t = this.createVariable("vec4", "viewTangent"),
            this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({
                matrix: this.getOrCreateUniform("mat3", "uModelViewNormalMatrix"),
                vec: this.getOrCreateLocalTangent()
            }).outputs({
                vec: t
            }),
            t)
        },
        declareScreenVertex: function(t) {
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateProjectionMatrix(),
                vec: this.getOrCreateViewVertex()
            }).outputs({
                vec: t
            })
        },
        declareVertexTransformBillboard: function(t) {
            this.getNode("Billboard").inputs({
                Vertex: this.getOrCreateAttribute("vec3", "Vertex"),
                ModelViewMatrix: this.getOrCreateUniform("mat4", "uModelViewMatrix"),
                ProjectionMatrix: this.getOrCreateUniform("mat4", "uProjectionMatrix")
            }).outputs({
                vec: t
            })
        },
        getOrCreateBoneMatrix: function() {
            var t = this._variables.boneMatrix;
            if (t)
                return t;
            t = this.createVariable("mat4", "boneMatrix");
            var e = this.getOrCreateAttribute("vec4", "Weights")
              , i = this.getOrCreateAttribute("vec4", "Bones")
              , n = this.getOrCreateUniform("vec4", "uBones", this._skinningAttribute.getBoneUniformSize());
            return this.getNode("Skinning").inputs({
                weights: e,
                bonesIndex: i,
                matrixPalette: n
            }).outputs({
                mat4: t
            }),
            t
        },
        getTarget: function(t, e) {
            var i = -1 !== t.indexOf("Tangent") ? "vec4" : "vec3";
            return this.getOrCreateAttribute(i, t + "_" + e)
        },
        morphTangentApproximation: function(t, e) {
            var i = this.getOrCreateLocalNormal();
            return this._skinningAttribute && (i = this.createVariable("vec3"),
            this.getNode("Normalize").inputs({
                vec: this.getOrCreateMorphNormal()
            }).outputs({
                vec: i
            })),
            this.getNode("InlineCode").code("%out = %tangent.rgb - dot(%tangent.rgb, %normal) * %normal;").inputs({
                tangent: t,
                normal: i
            }).outputs({
                out: e
            }),
            e
        },
        morphTransformVec3: function(t, e) {
            for (var i = {
                vertex: t,
                weights: this.getOrCreateUniform("vec4", "uTargetWeights")
            }, n = this._morphAttribute.getNumTargets(), r = 0; r < n; r++)
                i["target" + r] = this.getTarget(t.getVariable(), r);
            return this.getNode("Morph").inputs(i).outputs({
                out: e
            }),
            e
        },
        skinTransformVertex: function(t, e) {
            return this.getNode("MatrixMultPosition").setInverse(!0).inputs({
                matrix: this.getOrCreateBoneMatrix(),
                vec: t
            }).outputs({
                vec: e
            }),
            e
        },
        skinTransformNormal: function(t, e) {
            return this.getNode("MatrixMultDirection").setInverse(!0).inputs({
                matrix: this.getOrCreateBoneMatrix(),
                vec: t
            }).outputs({
                vec: e
            }),
            e
        },
        getOrCreateMorphVertex: function() {
            var t = this.getVariable("morphVertex");
            if (t)
                return t;
            var e = this.getOrCreateAttribute("vec3", "Vertex");
            return this._morphAttribute && this._morphAttribute.hasTarget("Vertex") ? this.morphTransformVec3(e, this.createVariable("vec3", "morphVertex")) : e
        },
        getOrCreateMorphNormal: function() {
            var t = this.getVariable("morphNormal");
            if (t)
                return t;
            var e = this.getOrCreateAttribute("vec3", "Normal");
            return this._morphAttribute && this._morphAttribute.hasTarget("Normal") ? this.morphTransformVec3(e, this.createVariable("vec3", "morphNormal")) : e
        },
        getOrCreateMorphTangent: function() {
            var t = this.getVariable("morphTangent");
            if (t)
                return t;
            var e = this.getOrCreateAttribute("vec4", "Tangent");
            return this._morphAttribute && this._morphAttribute.hasTarget("Tangent") ? this.morphTransformVec3(e, this.createVariable("vec3", "morphTangent")) : e
        },
        getOrCreateSkinVertex: function() {
            var t = this.getVariable("skinVertex");
            if (t)
                return t;
            var e = this.getOrCreateMorphVertex();
            return this._skinningAttribute ? this.skinTransformVertex(e, this.createVariable("vec3", "skinVertex")) : e
        },
        getOrCreateSkinNormal: function() {
            var t = this.getVariable("skinNormal");
            if (t)
                return t;
            var e = this.getOrCreateMorphNormal();
            return this._skinningAttribute ? this.skinTransformNormal(e, this.createVariable("vec3", "skinNormal")) : e
        },
        getOrCreateSkinTangent: function() {
            var t = this.getVariable("skinTangent");
            if (t)
                return t;
            var e = this.getOrCreateMorphTangent();
            return this._skinningAttribute ? this.skinTransformNormal(e, this.createVariable("vec3", "skinTangent")) : e
        },
        getOrCreateLocalVertex: function() {
            return this.getOrCreateSkinVertex()
        },
        getOrCreateLocalNormal: function() {
            var t = this.getVariable("localNormal");
            if (t)
                return t;
            var e = this.getOrCreateSkinNormal();
            return e === this.getOrCreateAttribute("vec3", "Normal") ? e : (t = this.createVariable("vec3", "localNormal"),
            this.getNode("Normalize").inputs({
                vec: e
            }).outputs({
                vec: t
            }),
            t)
        },
        getOrCreateLocalTangent: function() {
            var t = this.getVariable("localTangent");
            if (t)
                return t;
            var e = this.getOrCreateAttribute("vec4", "Tangent")
              , i = this.getOrCreateSkinTangent();
            return i === e ? i : this.normalizeAndSetAlpha(i, e, this.createVariable("vec4", "localTangent"))
        },
        normalizeAndSetAlpha: function(t, e, i) {
            var n = this.createVariable("vec3");
            return this.getNode("Normalize").inputs({
                vec: t
            }).outputs({
                vec: n
            }),
            this.getNode("SetAlpha").inputs({
                color: n,
                alpha: e
            }).outputs({
                color: i
            }),
            i
        }
    };
    for (var a in r)
        r[a] = function(t, e) {
            return function() {
                return this._fragmentShaderMode && this.logError("This function should not be called from fragment shader : " + e),
                t.apply(this, arguments)
            }
        }(r[a], a);
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(437)
      , r = i(650)
      , a = i(660)
      , s = i(658)
      , o = function() {
        return this._generators = new window.Map,
        this.addShaderGenerator("default", new n),
        this.addShaderGenerator("ShadowCast", new r),
        this.addShaderGenerator("debugNormal", new a.ShaderGeneratorCompilerOffsetNormal),
        this.addShaderGenerator("debugTangent", new a.ShaderGeneratorCompilerOffsetTangent),
        this.addShaderGenerator("debugGeometry", new s.ShaderGeneratorCompilerColorGeometry),
        this.addShaderGenerator("debugSkinning", new s.ShaderGeneratorCompilerColorSkinning),
        this
    };
    o.prototype = {
        getShaderGenerator: function(t) {
            return t ? this._generators.get(t) : this._generators.get("default")
        },
        addShaderGenerator: function(t, e) {
            this._generators.set(t, e)
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = [i(645), i(643), i(640), i(646), i(641), i(642), i(644)]
      , r = {};
    n.forEach(function(t) {
        for (var e in t) {
            var i = t[e];
            if (void 0 !== this[e])
                throw "duplicate entry in node library";
            this[e] = i
        }
    }, r),
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(288)
      , a = i(327)
      , s = function() {
        a.apply(this)
    };
    s.prototype = n.objectInherit(a.prototype, {
        type: "Billboard",
        validInputs: ["Vertex", "ModelViewMatrix", "ProjectionMatrix"],
        validOutputs: ["vec"],
        globalFunctionDeclaration: function() {
            return '#pragma include "billboard.glsl"'
        },
        computeShader: function() {
            return r.callFunction("billboard", this._outputs.vec, [this._inputs.Vertex, this._inputs.ModelViewMatrix, this._inputs.ProjectionMatrix])
        }
    }),
    t.exports = {
        Billboard: s
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(288)
      , a = i(327)
      , s = function() {
        a.call(this)
    };
    s.prototype = n.objectInherit(a.prototype, {
        type: "ShadowReceiveNode",
        validInputs: ["lighted", "shadowTexture", "shadowTextureProjectionMatrix", "shadowTextureViewMatrix", "shadowTextureDepthRange", "vertexWorld", "shadowbias"],
        validOutputs: ["float"],
        globalFunctionDeclaration: function() {
            return '#pragma include "shadowsReceive.glsl"'
        },
        setShadowAttribute: function(t) {
            this._shadow = t
        },
        getDefines: function() {
            return this._shadow.getDefines()
        },
        getExtensions: function() {
            return this._shadow.getExtensions()
        },
        computeShader: function() {
            var t = this._inputs
              , e = [t.lighted, t.shadowTexture];
            return this._shadow.getAtlas() && e.push(t.shadowTextureMapSize),
            e = e.concat([t.shadowTextureRenderSize, t.shadowTextureProjectionMatrix, t.shadowTextureViewMatrix, t.shadowTextureDepthRange, t.normalWorld, t.vertexWorld, t.shadowbias]),
            this._shadow.getNormalBias() && e.push(t.shadownormalBias),
            r.callFunction("computeShadow", this._outputs.float, e)
        }
    });
    var o = function() {
        a.call(this)
    };
    o.prototype = n.objectInherit(a.prototype, {
        type: "ShadowCast",
        validInputs: ["shadowDepthRange", "fragEye"],
        validOutputs: ["color"],
        globalFunctionDeclaration: function() {
            return '#pragma include "shadowsCastFrag.glsl"'
        },
        setShadowCastAttribute: function(t) {
            return this._shadowCast = t,
            this
        },
        getDefines: function() {
            return this._shadowCast.getDefines()
        },
        computeShader: function() {
            var t = this._inputs;
            return r.callFunction("computeShadowDepth", this._outputs.color, [t.fragEye, t.shadowDepthRange])
        }
    }),
    t.exports = {
        ShadowCast: o,
        ShadowReceive: s
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(778)
      , r = i(779)
      , a = i(781)
      , s = i(782)
      , o = i(777)
      , l = i(780)
      , u = i(776);
    t.exports = {
        "functions.glsl": n,
        "lights.glsl": r,
        "skinning.glsl": a,
        "textures.glsl": s,
        "colorEncode.glsl": o,
        "noise.glsl": l,
        "billboard.glsl": u
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(66)
      , a = i(93)
      , s = i(81)
      , o = i(13)
      , l = i(610)
      , u = i(5).vec4
      , h = i(535)
      , c = i(656)
      , d = i(653)
      , p = function(t) {
        this._lights = [],
        this._shadowMaps = [],
        this._viewportDimension = [],
        h.apply(this, arguments),
        this._shadowSettings = t,
        this._texture = new c,
        this._textureUnitBase = 4,
        this._textureUnit = this._textureUnitBase,
        this._textureMagFilter = void 0,
        this._textureMinFilter = void 0,
        this._textureSize = 1024,
        this._shadowMapSize = 256,
        this._receivingStateset = void 0,
        this._shaderProcessor = void 0,
        t && (this.setShadowSettings(t),
        t.atlasSize && (this._textureSize = t.atlasSize),
        t.textureSize && (this._shadowMapSize = t.textureSize)),
        this._texelSizeUniform = s.createFloat1(1 / this._textureSize, "texelSize");
        var e = s.createFloat2("RenderSize");
        this._renderSize = e.getInternalArray(),
        this._renderSize[0] = this._renderSize[1] = this._textureSize,
        this._numShadowWidth = this._textureSize / this._shadowMapSize,
        this._numShadowHeight = this._textureSize / this._shadowMapSize
    };
    p.prototype = o.objectLibraryClass(o.objectInherit(h.prototype, {
        getTexture: function() {
            return this._texture
        },
        isDirty: function(t) {
            if (void 0 !== t)
                return this._shadowMaps[t].isDirty();
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                if (this._shadowMaps[e].isDirty())
                    return !0;
            return !1
        },
        setTextureUnitBase: function(t) {
            this._textureUnitBase = t,
            this._textureUnit = t;
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                this._shadowMaps[e].setTextureUnitBase(t)
        },
        setShadowSettings: function(t) {
            if (t) {
                this._shadowSettings = t;
                for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                    this._shadowMaps[e].setShadowSettings(t);
                this.setTextureSize(t.textureSize),
                this.setTexturePrecision(t.textureType)
            }
        },
        setCastsShadowDrawTraversalMask: function(t) {
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                this._shadowMaps[e].setCastsShadowDrawTraversalMask(t)
        },
        getCastsShadowDrawTraversalMask: function(t) {
            return void 0 !== t ? this._shadowMaps[t].getCastsShadowDrawTraversalMask() : 0 !== this._shadowMaps.length ? this._shadowMaps[0].getCastsShadowDrawTraversalMask() : void 0
        },
        setCastsShadowBoundsTraversalMask: function(t) {
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                this._shadowMaps[e].setCastsShadowBoundsTraversalMask(t)
        },
        getCastsShadowBoundsTraversalMask: function(t) {
            return void 0 !== t ? this._shadowMaps[t].getCastsShadowDrawTraversalMask() : 0 !== this._shadowMaps.length ? this._shadowMaps[0].getCastsShadowDrawTraversalMask() : void 0
        },
        getNormalBias: function(t) {
            return void 0 !== t ? this._shadowMaps[t].getNormalBias() : 0 !== this._shadowMaps.length ? this._shadowMaps[0].getNormalBias() : void 0
        },
        setNormalBias: function(t) {
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                this._shadowMaps[e].setNormalBias(t)
        },
        getBias: function(t) {
            return void 0 !== t ? this._shadowMaps[t].getBias() : 0 !== this._shadowMaps.length ? this._shadowMaps[0].getBias() : void 0
        },
        setBias: function(t) {
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                this._shadowMaps[e].setBias(t)
        },
        getKernelSizePCF: function(t) {
            return void 0 !== t ? this._shadowMaps[t].getKernelSizePCF() : 1 !== this._shadowMaps.length ? this._shadowMaps[0].getKernelSizePCF() : void 0
        },
        setKernelSizePCF: function(t) {
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                this._shadowMaps[e].setKernelSizePCF(t)
        },
        setShadowedScene: function(t) {
            h.prototype.setShadowedScene.call(this, t),
            this._receivingStateset = this._shadowedScene.getReceivingStateSet();
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                this._shadowMaps[e].setShadowedScene(t)
        },
        setTexturePrecision: function(t) {
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                this._shadowMaps[e].setTexturePrecision(t)
        },
        getTexturePrecision: function(t) {
            return void 0 !== t ? this._shadowMaps[t].getTexturePrecision() : 1 !== this._shadowMaps.length ? this._shadowMaps[0].getTexturePrecision() : void 0
        },
        setTextureSize: function(t) {
            t !== this._textureSize && (this._shadowMapSize = t,
            this._numShadowWidth = this._textureSize / this._shadowMapSize,
            this._numShadowHeight = this._textureSize / this._shadowMapSize,
            this.dirty())
        },
        getShadowMap: function(t) {
            return this._shadowMaps[t]
        },
        addLight: function(t) {
            if (!t || -1 !== this._lights.indexOf(t))
                return n.warn("no light or light already added"),
                -1;
            var e = this._lights.length;
            if (e === this._numShadowWidth * this._numShadowHeight)
                return void n.warn("can't allocate shadow for light " + t.getLightNumber() + " ShadowAtlas already full ");
            this._lights.push(t),
            this._shadowSettings.setLight(t);
            var i = new d(this._shadowSettings,this._texture);
            this._shadowMaps.push(i);
            var r = this._shadowMapSize
              , a = r * (e % this._numShadowWidth)
              , s = r * Math.floor(e / this._numShadowHeight);
            return i.setShadowedScene(this._shadowedScene),
            this._viewportDimension.push(u.fromValues(s, a, r, r)),
            i
        },
        init: function() {
            if (this._shadowedScene) {
                this.initTexture();
                for (var t = [], e = 0; e < this._lights.length; e++)
                    t.push(this._lights[e].getLightNumber());
                this._texture.setLightNumberArray(t),
                this._textureUnit = this._textureUnitBase,
                this._texture.setName("ShadowTexture" + this._textureUnit),
                this._numShadowWidth = this._textureSize / this._shadowMapSize,
                this._numShadowHeight = this._textureSize / this._shadowMapSize;
                var i = s.createFloat2("RenderSize");
                this._texelSizeUniform = s.createFloat1(1 / this._textureSize, "texelSize"),
                this._renderSize = i.getInternalArray(),
                this._renderSize[0] = this._renderSize[1] = this._textureSize;
                for (var n = 0, a = this._shadowMaps.length; n < a; n++) {
                    var o = this._shadowMapSize
                      , h = o * (n % this._numShadowWidth)
                      , c = o * Math.floor(n / this._numShadowHeight);
                    this._viewportDimension[n] = u.fromValues(c, h, o, o),
                    this._shadowMaps[n].init(this._texture, n, this._textureUnitBase),
                    this._texture.setLightShadowMapSize(n, this._viewportDimension[n]);
                    var d = this._shadowMaps[n].getCamera().getOrCreateStateSet()
                      , p = new l(c,h,o,o);
                    d.setAttributeAndModes(p, r.ON | r.OVERRIDE)
                }
            }
        },
        valid: function() {
            return !0
        },
        updateShadowTechnique: function(t) {
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                this._shadowMaps[e].updateShadowTechnique(t, this._viewportDimension[e])
        },
        initTexture: function() {
            if (this._dirty) {
                this._texture || (this._texture = new c,
                this._textureUnit = this._textureUnitBase),
                this._texture.setTextureSize(this._textureSize, this._textureSize),
                this._texelSizeUniform.setFloat(1 / this._textureSize),
                this._renderSize[0] = this._textureSize,
                this._renderSize[1] = this._textureSize;
                var t;
                t = a.RGBA,
                d.prototype.setTextureFiltering.call(this),
                this._texture.setInternalFormat(t),
                this._texture.setWrapS(a.CLAMP_TO_EDGE),
                this._texture.setWrapT(a.CLAMP_TO_EDGE),
                this._texture.dirty()
            }
        },
        cullShadowCasting: function(t) {
            for (var e = 0, i = this._shadowMaps.length; e < i; e++)
                this._shadowMaps[e].cullShadowCasting(t)
        },
        cleanReceivingStateSet: function() {
            if (this._receivingStateset) {
                this._texture && this._receivingStateset.getTextureAttribute(this._textureUnit, this._texture.getTypeMember()) === this._texture && this._receivingStateset.removeTextureAttribute(this._textureUnit, this._texture.getTypeMember());
                for (var t = 0, e = this._shadowMaps.length; t < e; t++)
                    this._shadowMaps[t].cleanReceivingStateSet()
            }
        },
        cleanSceneGraph: function() {
            this._texture = void 0,
            this._shadowedScene = void 0
        },
        setDebug: function(t, e) {
            if (e)
                this._shadowMaps[e].setDebug(t);
            else
                for (var i = 0, n = this._shadowMaps.length; i < n; i++)
                    this._shadowMaps[i].setDebug(t)
        }
    }), "osgShadow", "ShadowMapAtlas"),
    o.setTypeID(p),
    t.exports = p
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(93)
      , a = ["1Tap(4texFetch)", "4Tap(16texFetch)", "9Tap(36texFetch)", "16Tap(64texFetch)"]
      , s = function(t) {
        this.castsShadowDrawTraversalMask = 4294967295,
        this.castsShadowBoundsTraversalMask = 4294967295,
        this.textureSize = 1024,
        this.textureType = "UNSIGNED_BYTE",
        this.textureFormat = r.RGBA,
        this.shadowProjection = "fov",
        this.fov = 50,
        this.kernelSizePCF = "4Tap(4texFetch)",
        this.bias = .005,
        this.normalBias = void 0,
        this.shadowCastShaderGeneratorName = "ShadowCast",
        n.objectMix(this, t)
    };
    s.kernelSizeList = a,
    s.prototype = {
        setCastsShadowDrawTraversalMask: function(t) {
            this.castsShadowDrawTraversalMask = t
        },
        getCastsShadowDrawTraversalMask: function() {
            return this.castsDrawShadowTraversalMask
        },
        setCastsShadowBoundsTraversalMask: function(t) {
            this.castsShadowBoundsTraversalMask = t
        },
        getCastsShadowBoundsTraversalMask: function() {
            return this.castsShadowBoundsTraversalMask
        },
        setLight: function(t) {
            this.light = t
        },
        getLight: function() {
            return this.light
        },
        setTextureSize: function(t) {
            this.textureSize = t
        },
        getTextureSize: function() {
            return this.textureSize
        },
        setTextureType: function(t) {
            this.textureType = t
        },
        getTextureType: function() {
            return this.textureType
        },
        setTextureFormat: function(t) {
            this.textureFormat = t
        },
        getTextureFormat: function() {
            return this.textureFormat
        },
        setShadowCastShaderGeneratorName: function(t) {
            this.shadowCastShaderGeneratorName = t
        },
        getShadowCastShaderGeneratorName: function() {
            return this.shadowCastShaderGeneratorName
        }
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(457)
      , r = i(5).mat4
      , a = i(128)
      , s = i(65)
      , o = i(287)
      , l = i(13)
      , u = i(5).vec4
      , h = function() {
        a.call(this),
        this._shadowTechniques = [],
        this._optimizedFrustum = !1,
        this._frustumReceivers = [u.create(), u.create(), u.create(), u.create(), u.create(), u.create()],
        this._tmpMat = r.create(),
        this._receivingStateset = new o
    };
    h.prototype = l.objectLibraryClass(l.objectInherit(a.prototype, {
        getReceivingStateSet: function() {
            return this._receivingStateset
        },
        getShadowTechniques: function() {
            return this._shadowTechniques
        },
        addShadowTechnique: function(t) {
            this._shadowTechniques.length > 0 && -1 !== this._shadowTechniques.indexOf(t) || (this._shadowTechniques.push(t),
            t.valid() && (t.setShadowedScene(this),
            t.dirty()))
        },
        removeShadowTechnique: function(t) {
            if (this._shadowTechniques.length > 0) {
                var e = this._shadowTechniques.indexOf(t);
                -1 !== e && (this._shadowTechniques[e].valid() && this._shadowTechniques[e].cleanSceneGraph(),
                this._shadowTechniques.splice(e, 1))
            }
        },
        cleanSceneGraph: function() {
            for (var t = 0, e = this._shadowTechniques.length; t < e; t++)
                this._shadowTechniques[t] && this._shadowTechniques[t].valid() && this._shadowTechniques[t].cleanSceneGraph()
        },
        dirty: function() {
            for (var t = 0; t < this._shadowTechniques.length; t++)
                this._shadowTechniques[t].dirty()
        },
        nodeTraverse: function(t) {
            a.prototype.traverse.call(this, t)
        },
        traverse: function(t) {
            if (t.getVisitorType() === s.CULL_VISITOR) {
                var e, i, n = this._shadowTechniques.length;
                for (n && t.pushStateSet(this._receivingStateset),
                this.nodeTraverse(t),
                n && t.popStateSet(),
                e = 0; e < n; e++)
                    (i = this._shadowTechniques[e]) && i.valid() && (i.isDirty() && i.init(),
                    !i.isEnabled() && i.isFilledOnce() || (i.updateShadowTechnique(t),
                    i.cullShadowCasting(t)))
            } else
                this.nodeTraverse(t)
        }
    }), "osgShadow", "ShadowedScene"),
    l.setTypeID(h),
    n.prototype[h.typeID] = n.prototype[a.typeID],
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(648)
      , r = i(649)
      , a = i(650)
      , s = i(651)
      , o = i(652)
      , l = i(653)
      , u = i(872)
      , h = i(654)
      , c = i(873)
      , d = i(535)
      , p = i(655)
      , f = i(656)
      , g = i(874)
      , m = {};
    m.ShadowCastAttribute = n,
    m.ShadowCastCompiler = r,
    m.ShadowReceiveAttribute = h,
    m.ShadowCasterVisitor = s,
    m.ShadowFrustumIntersection = o,
    m.ShadowMap = l,
    m.ShadowMapAtlas = u,
    m.ShadowedScene = g,
    m.ShadowSettings = c,
    m.ShadowCastShaderGenerator = a,
    m.ShadowTechnique = d,
    m.ShadowTexture = p,
    m.ShadowTextureAtlas = f,
    t.exports = m
}
, function(t, e, i) {
    "use strict";
    var n = i(786)
      , r = i(787)
      , a = i(788)
      , s = i(785)
      , o = i(784)
      , l = i(789)
      , u = i(783);
    t.exports = {
        "shadowsCastFrag.glsl": n,
        "shadowsReceive.glsl": r,
        "shadowsReceiveMain.glsl": a,
        "shadowLinearSoft.glsl": s,
        "pcf.glsl": o,
        "tapPCF.glsl": l,
        "hash.glsl": u
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(657)
      , r = {};
    r.Text = n,
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(659)
      , r = i(458)
      , a = function(t) {
        this._selectables = t,
        this._nodeList = [],
        this._linkList = [],
        this._renderBinMap = new window.Map,
        this._renderBinStack = [],
        this._generatorID = 0,
        this._refID = 0,
        this._uniqueEdges = new window.Set
    };
    a.prototype = {
        getColorFromClassName: n.prototype.getColorFromClassName,
        createGraph: function(t) {
            this.reset(),
            this.apply(t)
        },
        reset: function() {
            this._renderBinMap.clear(),
            this._renderBinStack.length = 0,
            this._generatorID = 0,
            this._refID++,
            this._nodeList.length = 0,
            this._linkList.length = 0,
            this._uniqueEdges.clear()
        },
        apply: function(t) {
            var e = t.getInstanceID();
            if (this._renderBinMap.has(e) || this._renderBinMap.set(e, t),
            this._renderBinStack.push(t),
            t.getPreRenderStageList)
                for (var i = t.getPreRenderStageList(), n = 0, r = i.length; n < r; ++n)
                    this.apply(i[n].renderStage);
            if (this.registerNode(t),
            t.getPostRenderStageList)
                for (var a = t.getPostRenderStageList(), s = 0, o = a.length; s < o; ++s)
                    this.apply(a[s].renderStage);
            this._renderBinStack.pop()
        },
        registerNode: function(t) {
            var e = t.getInstanceID();
            this._nodeList.push(t);
            var i = t._bins;
            for (var n in i)
                this.apply(i[n]);
            if (t._leafs.length)
                for (var r = 0, a = t._leafs.length; r < a; r++)
                    this.createNodeAndSetID(e, t._leafs[r]);
            for (var s = 0, o = t.stateGraphList.length; s < o; s++) {
                var l = t.stateGraphList[s];
                this.createNodeAndSetID(e, l);
                for (var u = l._instanceID, h = 0, c = l.leafs.length; h < c; h++)
                    this.createNodeAndSetID(u, l.leafs[h])
            }
            if (!(this._renderBinStack.length < 2)) {
                var d = this._renderBinStack[this._renderBinStack.length - 2].getInstanceID();
                this.createLink(d, e)
            }
        },
        createLink: function(t, e) {
            var i = t + "+" + e;
            this._uniqueEdges.has(i) || (this._linkList.push({
                parentNode: t,
                childrenNode: e
            }),
            this._uniqueEdges.add(i))
        },
        createNodeAndSetID: function(t, e) {
            this._nodeList.push(e),
            (void 0 === e._instanceID || e._instanceID < 0 && e._refID !== this._refID) && (e._instanceID = -1 - this._generatorID++,
            e._refID = this._refID),
            this.createLink(t, e._instanceID)
        },
        generateRenderLeaf: function(t, e) {
            var i = e._instanceID
              , n = e._geometry && e._geometry.getName() ? "\n" + e._geometry.getName() : "Geometry"
              , r = "RenderLeaf ( " + e._instanceID + " )";
            r += "\n" + n + " ( " + e._geometry.getInstanceID() + " )",
            this._selectables.set(i.toString(), e),
            t.addNode(i, {
                label: r,
                description: "",
                style: "fill: " + this.getColorFromClassName("RenderLeaf") + ";stroke-width: 0px;"
            })
        },
        generateStateGraph: function(t, e) {
            var i = e._instanceID
              , n = "StateGraph ( " + e._instanceID + " )";
            n += "\n" + e.leafs.length + " leafs",
            this._selectables.set(i.toString(), e),
            t.addNode(i, {
                label: n,
                description: "",
                style: "fill: " + this.getColorFromClassName("StateGraph") + ";stroke-width: 0px;"
            })
        },
        generateRenderStage: function(t, e) {
            var i = e.className() + " ( " + e._instanceID + " )";
            e.getName() && (i += "\n" + e.getName()),
            i += "\nViewport ( " + e.getViewport().width() + " x " + e.getViewport().height() + " )",
            this._selectables.set(e.getInstanceID().toString(), e),
            t.addNode(e.getInstanceID(), {
                label: i,
                description: "",
                style: "fill: " + this.getColorFromClassName(e.className()) + ";stroke-width: 0px;"
            })
        },
        generateRenderBin: function(t, e) {
            var i = e.className() + " ( " + e.getInstanceID() + " )";
            e.getName() && (i += "\n" + e.getName());
            var n = "";
            e.getSortMode() === r.SORT_BACK_TO_FRONT && (n = "SortMode: BackToFront");
            var a = "BinNumber: " + e.getBinNumber() + "\n" + n;
            this._selectables.set(e.getInstanceID().toString(), e),
            t.addNode(e.getInstanceID(), {
                label: i,
                description: a,
                style: "fill: " + this.getColorFromClassName(e.className()) + ";stroke-width: 0px;"
            })
        },
        generateNodeAndLink: function(t) {
            for (var e = 0, i = this._nodeList.length; e < i; e++) {
                var n = this._nodeList[e];
                n._geometry && void 0 !== n._depth ? this.generateRenderLeaf(t, n) : void 0 !== n.depth && n.leafs && n.children ? this.generateStateGraph(t, n) : "RenderStage" === n.className() ? this.generateRenderStage(t, n) : this.generateRenderBin(t, n)
            }
            for (var r = 0, a = this._linkList.length; r < a; r++)
                t.addEdge(null, this._linkList[r].parentNode, this._linkList[r].childrenNode)
        }
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(128)
      , r = i(163)
      , a = i(377)
      , s = i(376)
      , o = i(516)
      , l = i(81)
      , u = i(5).vec2
      , h = i(5).vec3
      , c = i(5).vec4
      , d = i(5).mat4
      , p = i(5).quat
      , f = i(464)
      , g = i(465)
      , m = i(665)
      , v = i(144)
      , _ = i(13)
      , b = function(t, e) {
        t[0] = void 0 === e.offsetX ? e.layerX : e.offsetX,
        t[1] = void 0 === e.offsetY ? e.layerY : e.offsetY
    }
      , x = function() {};
    x.prototype = {
        cull: function() {
            return !1
        }
    };
    var y = new s(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA)
      , S = function(t) {
        this._testPlane = t,
        this._inter = h.create(),
        g.call(this)
    };
	console.log("TestENABLED");
    S.prototype = _.objectInherit(g.prototype, {
        setTestPlane: function(t) {
            this._testPlane = t
        },
        getTranslateDistance: function() {
            return this._inter
        },
        enter: function() {
            var t = h.create()
              , e = h.create();
            return function(i) {
                if (void 0 === i._nbAxis)
                    return !0;
                if (h.init(t),
                t[i._nbAxis] = 1,
                this._testPlane) {
                    var n = h.dot(this._iStart, t)
                      , r = h.dot(this._iEnd, t);
                    if (n === r)
                        return !1;
                    var a = -n / (r - n);
                    this._inter[0] = this._iStart[0] + (this._iEnd[0] - this._iStart[0]) * a,
                    this._inter[1] = this._iStart[1] + (this._iEnd[1] - this._iStart[1]) * a,
                    this._inter[2] = this._iStart[2] + (this._iEnd[2] - this._iStart[2]) * a
                } else {
                    h.normalize(e, h.sub(e, this._iEnd, this._iStart));
                    var s = -h.dot(e, t)
                      , o = h.dot(this._iStart, e)
                      , l = Math.abs(1 - s * s)
                      , u = -h.dot(this._iStart, t);
                    h.init(this._inter),
                    this._inter[i._nbAxis] = (s * o - u) / l
                }
                return !1
            }
        }(),
        intersect: function() {
            return !1
        }
    });
    var w = function(t) {
        r.call(this),
        this._tmask = 1,
        this._autoInsertMT = !1,
        this._viewer = t,
        this._canvas = t.getGraphicContext().canvas,
        this._manipulator = t.getManipulator(),
        this._rotateNode = new r,
        this._translateNode = new r,
        this._planeNode = new r,
        this._rotateInLocal = !0,
        this._translateInLocal = !0,
        this._showAngle = new r,
        this._downCanvasCoord = u.create(),
        this._hoverNode = null,
        this._keepHoverColor = c.create(),
        this._isEditing = !1,
        this._editLineOrigin = h.create(),
        this._editLineDirection = h.create(),
        this._editOffset = h.create(),
        this._editLocal = d.create(),
        this._editWorldTrans = d.create(),
        this._editWorldScaleRot = d.create(),
        this._editInvWorldScaleRot = d.create(),
        this._debugNode = new n,
        this._lastDistToEye = 0,
        this._attachedNode = null,
        this.attachToGeometry(null),
        this._lsi = new S,
        this._origIntersect = h.create(),
        this._dstIntersect = h.create(),
        this._iv = new f,
        this._iv.setIntersector(this._lsi),
        this._eventMouse = t._eventProxy.StandardMouseKeyboard,
        this._enableMouseBack = !1,
        this.init()
    };
    w.NO_PICK = 1,
    w.PICK_ARC_X = 2,
    w.PICK_ARC_Y = 4,
    w.PICK_ARC_Z = 8,
    w.PICK_ARROW_X = 16,
    w.PICK_ARROW_Y = 32,
    w.PICK_ARROW_Z = 64,
    w.PICK_PLANE_X = 128,
    w.PICK_PLANE_Y = 256,
    w.PICK_PLANE_Z = 512,
    w.NO_FULL_CIRCLE = 1024,
    w.PICK_ARC = w.PICK_ARC_X | w.PICK_ARC_Y | w.PICK_ARC_Z,
    w.PICK_ARROW = w.PICK_ARROW_X | w.PICK_ARROW_Y | w.PICK_ARROW_Z,
    w.PICK_PLANE = w.PICK_PLANE_X | w.PICK_PLANE_Y | w.PICK_PLANE_Z,
    w.PICK_GIZMO = w.PICK_ARC | w.PICK_ARROW | w.PICK_PLANE,
    w.prototype = _.objectInherit(r.prototype, {
        setRotateInLocal: function(t) {
            this._rotateInLocal = t
        },
        setTranslateInLocal: function(t) {
            this._translateInLocal = t
        },
        setTraversalMask: function(t) {
            this._tmask = t
        },
        isEditing: function() {
            return this._isEditing
        },
        init: function() {
            this.getOrCreateStateSet().setAttributeAndModes(new a(a.DISABLE)),
            this.getOrCreateStateSet().setAttributeAndModes(new o(o.DISABLE));
            var t = function() {};
            t.prototype = {
                update: this.updateGizmo.bind(this)
            },
            this.addUpdateCallback(new t),
            this.addChild(this.initNodeTranslate()),
            this.addChild(this.initNodeTranslatePlane()),
            this.addChild(this.initNodeRotate()),
            this._debugNode && (this._debugNode.addChild(m.createDebugLineGeometry()),
            this.addChild(this._debugNode),
            this._debugNode.setNodeMask(0));
            var e = this._canvas;
            e.addEventListener("mousemove", this.onMouseMove.bind(this)),
            e.addEventListener("mousedown", this.onMouseDown.bind(this)),
            e.addEventListener("mouseup", this.onMouseUp.bind(this)),
            e.addEventListener("mouseout", this.onMouseUp.bind(this))
        },
        attachToNodePath: function(t) {
            var e;
            if (t)
                for (var i = t.length - 1; i >= 0; --i) {
                    var n = t[i].editMask || 0;
                    if (n & w.PICK_GIZMO) {
                        e = t[i];
                        break
                    }
                }
            if (!e)
                return this._attachedNode = null,
                void this.setNodeMask(0);
            this._attachedNode = e,
            this.updateGizmoMask()
        },
        attachToMatrixTransform: function(t) {
            if (!t)
                return this._attachedNode = null,
                void this.setNodeMask(0);
            void 0 === t.editMask && (t.editMask = w.PICK_GIZMO),
            this._attachedNode = t,
            this.updateGizmoMask()
        },
        attachToGeometry: function(t) {
            var e = t;
            if (!e)
                return this._attachedNode = null,
                void this.setNodeMask(0);
            var i = e.getParents();
            if (void 0 === i[0].editMask) {
                for (var n = new r; i.length > 0; )
                    i[0].addChild(n),
                    i[0].removeChild(e);
                n.addChild(e),
                n.editMask = w.PICK_GIZMO,
                e = n
            } else
                e = i[0];
            this._attachedNode = e,
            this.updateGizmoMask()
        },
        updateGizmoMask: function() {
            if (!this._attachedNode)
                return void this.setNodeMask(0);
            var t = this._attachedNode.editMask;
            this.setNodeMask(t & w.PICK_GIZMO ? w.NO_PICK : 0),
            this._translateNode.setNodeMask(t & w.PICK_ARROW ? w.PICK_ARROW : 0),
            this._rotateNode.setNodeMask(t & w.PICK_ARC ? w.PICK_ARC : 0),
            this._planeNode.setNodeMask(t & w.PICK_PLANE ? w.PICK_PLANE : 0);
            var e = this._translateNode.getChildren();
            e[0].setNodeMask(t & w.PICK_ARROW_X ? w.PICK_ARROW_X : 0),
            e[1].setNodeMask(t & w.PICK_ARROW_Y ? w.PICK_ARROW_Y : 0),
            e[2].setNodeMask(t & w.PICK_ARROW_Z ? w.PICK_ARROW_Z : 0);
            var i = this._rotateNode.getChildren();
            i[0].setNodeMask(t & w.NO_FULL_CIRCLE ? 0 : w.NO_PICK),
            i[1].setNodeMask(t & w.PICK_ARC_X ? w.PICK_ARC_X : 0),
            i[2].setNodeMask(t & w.PICK_ARC_Y ? w.PICK_ARC_Y : 0),
            i[3].setNodeMask(t & w.PICK_ARC_Z ? w.PICK_ARC_Z : 0);
            var n = this._planeNode.getChildren();
            n[0].setNodeMask(t & w.PICK_PLANE_X ? w.PICK_PLANE_X : 0),
            n[1].setNodeMask(t & w.PICK_PLANE_Y ? w.PICK_PLANE_Y : 0),
            n[2].setNodeMask(t & w.PICK_PLANE_Z ? w.PICK_PLANE_Z : 0)
        },
        onNodeHovered: function() {
            var t = c.fromValues(1, 1, 0, 1);
            return function(e) {
                if (this._hoverNode && this._hoverNode.getStateSet().getUniform("uColor").setFloat4(this._keepHoverColor),
                !e)
                    return void (this._hoverNode = null);
                for (var i = e.nodepath, n = i.length - 1, r = i[n]; void 0 === r._nbAxis; ) {
                    if (0 === n)
                        return;
                    r = i[--n]
                }
                var a = r.getStateSet().getUniform("uColor");
                this._hoverNode = r,
                c.copy(this._keepHoverColor, a.getInternalArray()),
                a.setFloat4(t)
            }
        }(),
        initNodeRotate: function() {
            var t = m.createTorusGeometry(1, .01, 6, 64, 2 * Math.PI)
              , e = m.createTorusGeometry(1, .01, 6, 64, Math.PI)
              , i = m.createTorusGeometry(1, .1, 6, 64, Math.PI)
              , a = new r
              , s = new r
              , o = new r
              , u = new r;
            s._nbAxis = 0,
            o._nbAxis = 1,
            u._nbAxis = 2;
            var d = new n;
            d.setCullCallback(new x),
            d.addChild(i),
            t.setNodeMask(w.NO_PICK),
            e.setNodeMask(w.NO_PICK),
            s.setNodeMask(w.PICK_ARC_X),
            o.setNodeMask(w.PICK_ARC_Y),
            u.setNodeMask(w.PICK_ARC_Z),
            a.addChild(t),
            s.addChild(e),
            o.addChild(e),
            u.addChild(e),
            s.addChild(d),
            o.addChild(d),
            u.addChild(d),
            a.getOrCreateStateSet().addUniform(l.createFloat4(c.fromValues(.2, .2, .2, 1), "uColor")),
            s.getOrCreateStateSet().addUniform(l.createFloat4(c.fromValues(1, 0, 0, 1), "uColor")),
            o.getOrCreateStateSet().addUniform(l.createFloat4(c.fromValues(0, 1, 0, 1), "uColor")),
            u.getOrCreateStateSet().addUniform(l.createFloat4(c.fromValues(0, 0, 1, 1), "uColor"));
            var p = this._showAngle;
            p.getOrCreateStateSet().setAttributeAndModes(y),
            p.setNodeMask(0),
            p.getOrCreateStateSet().addUniform(l.createFloat3(h.fromValues(1, 0, 0), "uBase")),
            p.getOrCreateStateSet().addUniform(l.createFloat(0, "uAngle")),
            p.addChild(m.createQuadCircleGeometry());
            var f = this._rotateNode;
            return f.setNodeMask(w.PICK_ARC),
            f.addChild(a),
            f.addChild(s),
            f.addChild(o),
            f.addChild(u),
            f.addChild(p),
            f
        },
        initNodeTranslate: function() {
            var t = new r;
            d.fromTranslation(t.getMatrix(), h.fromValues(0, 0, 1.65)),
            t.addChild(m.createCylinderGeometry(0, .07, .3, 32, 1, !0, !0));
            var e = new r;
            d.fromTranslation(e.getMatrix(), h.fromValues(0, 0, .75)),
            e.addChild(m.createCylinderGeometry(.01, .01, 1.5, 32, 1, !0, !0));
            var i = new n;
            i.addChild(e),
            i.addChild(t);
            var a = m.createCylinderGeometry(.1, .1, 1.3 * 1.1, 32, 1, !0, !0)
              , s = new r
              , o = new r
              , u = new r;
            s._nbAxis = 0,
            o._nbAxis = 1,
            u._nbAxis = 2,
            d.fromRotation(s.getMatrix(), .5 * Math.PI, h.fromValues(0, 1, 0)),
            d.fromRotation(o.getMatrix(), .5 * -Math.PI, h.fromValues(1, 0, 0));
            var p = new r;
            p.setCullCallback(new x),
            d.fromTranslation(p.getMatrix(), h.fromValues(0, 0, 1.215)),
            p.addChild(a),
            i.setNodeMask(w.NO_PICK),
            s.setNodeMask(w.PICK_ARROW_X),
            o.setNodeMask(w.PICK_ARROW_Y),
            u.setNodeMask(w.PICK_ARROW_Z),
            s.addChild(i),
            o.addChild(i),
            u.addChild(i),
            s.addChild(p),
            o.addChild(p),
            u.addChild(p),
            s.getOrCreateStateSet().addUniform(l.createFloat4(c.fromValues(1, 0, 0, 1), "uColor")),
            o.getOrCreateStateSet().addUniform(l.createFloat4(c.fromValues(0, 1, 0, 1), "uColor")),
            u.getOrCreateStateSet().addUniform(l.createFloat4(c.fromValues(0, 0, 1, 1), "uColor"));
            var f = this._translateNode;
            return f.setNodeMask(w.PICK_ARROW),
            f.addChild(s),
            f.addChild(o),
            f.addChild(u),
            f
        },
        initNodeTranslatePlane: function() {
            var t = new r;
            d.fromTranslation(t.getMatrix(), h.fromValues(.5, .5, 0)),
            d.mul(t.getMatrix(), d.fromScaling(d.create(), h.fromValues(.5, .5, 1)), t.getMatrix()),
            t.addChild(m.createPlaneGeometry());
            var e = new r
              , i = new r
              , n = new r;
            e._nbAxis = 0,
            i._nbAxis = 1,
            n._nbAxis = 2,
            d.fromRotation(e.getMatrix(), .5 * -Math.PI, h.fromValues(0, 1, 0)),
            d.fromRotation(i.getMatrix(), .5 * Math.PI, h.fromValues(1, 0, 0)),
            e.setNodeMask(w.PICK_PLANE_X),
            i.setNodeMask(w.PICK_PLANE_Y),
            n.setNodeMask(w.PICK_PLANE_Z),
            e.addChild(t),
            i.addChild(t),
            n.addChild(t),
            e.getOrCreateStateSet().addUniform(l.createFloat4(c.fromValues(1, 0, 0, .3), "uColor")),
            i.getOrCreateStateSet().addUniform(l.createFloat4(c.fromValues(0, 1, 0, .3), "uColor")),
            n.getOrCreateStateSet().addUniform(l.createFloat4(c.fromValues(0, 0, 1, .3), "uColor"));
            var a = this._planeNode;
            return a.setNodeMask(w.PICK_PLANE),
            a.getOrCreateStateSet().setAttributeAndModes(y),
            a.addChild(e),
            a.addChild(i),
            a.addChild(n),
            a
        },
        updateArcRotation: function() {
            var t = p.create()
              , e = p.setAxisAngle(p.create(), [0, 1, 0], .5 * -Math.PI)
              , i = p.setAxisAngle(p.create(), [1, 0, 0], .5 * -Math.PI);
            return function(n) {
                var r = this._rotateNode
                  , a = r.getChildren();
                t[0] = -n[1],
                t[1] = n[0],
                t[2] = 0,
                t[3] = 1 + n[2],
                p.normalize(t, t),
                d.fromQuat(a[0].getMatrix(), t),
                p.setAxisAngle(t, [1, 0, 0], Math.atan2(n[2], n[1])),
                p.mul(t, t, e),
                d.fromQuat(a[1].getMatrix(), t),
                p.setAxisAngle(t, [0, 1, 0], Math.atan2(-n[0], -n[2])),
                p.mul(t, t, i),
                d.fromQuat(a[2].getMatrix(), t),
                p.setAxisAngle(t, [0, 0, 1], Math.atan2(-n[0], n[1])),
                d.fromQuat(a[3].getMatrix(), t),
                a[1].dirtyBound(),
                a[2].dirtyBound(),
                a[3].dirtyBound()
            }
        }(),
        getTransformType: function(t) {
            for (var e = t; e.getParents().length > 0; ) {
                if (void 0 !== e.referenceFrame && e.referenceFrame === v.ABSOLUTE_RF)
                    return v.ABSOLUTE_RF;
                e = e.getParents()[0]
            }
            return v.RELATIVE_RF
        },
        updateGizmo: function() {
            var t = h.create()
              , e = h.create()
              , i = h.create()
              , n = d.create()
              , r = d.create()
              , a = d.create()
              , s = d.create();
            return function() {
                if (this._attachedNode) {
                    var o = this.getTransformType(this._attachedNode);
                    this.setReferenceFrame(o),
                    this.setCullingActive(o === v.RELATIVE_RF);
                    var l = this._attachedNode.getWorldMatrices()[0];
                    d.getTranslation(e, l),
                    d.fromTranslation(r, e);
                    var u = 3;
                    if (o === v.ABSOLUTE_RF)
                        t[0] = t[1] = t[2] = 0,
                        i[0] = i[1] = i[2] = 1;
                    else {
                        var c = this._viewer.getCamera().getProjectionMatrix()
                          , p = .023 * this._canvas.clientWidth * c[0];
                        this._manipulator.getEyePosition(t),
                        this._lastDistToEye = this._isEditing ? this._lastDistToEye : h.distance(e, t),
                        u *= this._lastDistToEye / p
                    }
                    d.fromScaling(s, [u, u, u]),
                    d.mul(this.getMatrix(), r, s),
                    h.sub(t, t, e),
                    h.normalize(t, t),
                    this._rotateInLocal || this._translateInLocal ? (d.getScale(i, l),
                    d.fromScaling(a, i),
                    d.invert(a, a),
                    d.mul(n, l, a),
                    n[12] = n[13] = n[14] = 0,
                    this._translateInLocal && (d.copy(this._translateNode.getMatrix(), n),
                    d.copy(this._planeNode.getMatrix(), n)),
                    this._rotateInLocal && (d.copy(this._rotateNode.getMatrix(), n),
                    d.invert(n, n),
                    h.transformMat4(t, t, n))) : d.identity(this._rotateNode.getMatrix()),
                    this.updateArcRotation(t),
                    this._rotateNode.dirtyBound(),
                    this._translateNode.dirtyBound(),
                    this._planeNode.dirtyBound(),
                    this._isEditing && d.copy(this._showAngle.getMatrix(), this._hoverNode.getMatrix())
                }
            }
        }(),
        computeNearestIntersection: function() {
            var t = function(t, e) {
                return t.ratio - e.ratio
            }
              , e = u.create();
            return function(i, n) {
                b(e, i);
                var r = this._viewer
                  , a = this._canvas
                  , s = e[0] * (r._canvasWidth / a.clientWidth)
                  , o = (a.clientHeight - e[1]) * (r._canvasHeight / a.clientHeight)
                  , l = this._viewer.computeIntersections(s, o, n);
                if (0 !== l.length)
                    return l.sort(t),
                    l[0]
            }
        }(),
        setOnlyGizmoPicking: function() {
            this._viewer.getCamera().addChild(this),
            this._viewer.getSceneData().setNodeMask(0),
            this.setNodeMask(-1)
        },
        setOnlyScenePicking: function() {
            this._viewer.getCamera().removeChild(this),
            this._viewer.getSceneData().setNodeMask(-1),
            this.setNodeMask(w.NO_PICK)
        },
        pickGizmo: function(t, e) {
            this.setOnlyGizmoPicking();
            var i = this.computeNearestIntersection(t, e);
            return this.setOnlyScenePicking(),
            i
        },
        getCanvasPositionFromWorldPoint: function() {
            var t = d.create();
            return function(e, i) {
                var n = this._viewer.getCamera()
                  , r = i;
                n.getViewport() ? n.getViewport().computeWindowMatrix(t) : d.identity(t),
                d.mul(t, t, n.getProjectionMatrix()),
                this.getReferenceFrame() === v.RELATIVE_RF && d.mul(t, t, n.getViewMatrix()),
                h.transformMat4(r, e, t);
                var a = this._viewer
                  , s = this._canvas;
                return r[0] = r[0] / (a._canvasWidth / s.clientWidth),
                r[1] = s.clientHeight - r[1] / (a._canvasHeight / s.clientHeight),
                r
            }
        }(),
        onMouseDown: function(t) {
            if (b(this._downCanvasCoord, t),
            this._hoverNode && this._attachedNode) {
                this._enableMouseBack = this._eventMouse.getEnable(),
                this._eventMouse.setEnable(!1),
                this.saveEditMatrices();
                var e = this._hoverNode.getParents()[0].getNodeMask();
                this._isEditing = !0,
                e & w.PICK_ARC ? (this._translateNode.setNodeMask(0),
                this._planeNode.setNodeMask(0),
                this.startRotateEdit(t)) : e & w.PICK_ARROW ? (this._rotateNode.setNodeMask(0),
                this._planeNode.setNodeMask(0),
                this.startTranslateEdit(t)) : e & w.PICK_PLANE && (this._rotateNode.setNodeMask(0),
                this._translateNode.setNodeMask(0),
                this.startPlaneEdit(t))
            }
        },
        saveEditMatrices: function() {
            d.copy(this._editLocal, this._attachedNode.getMatrix());
            var t = this._attachedNode.getWorldMatrices()[0];
            d.fromTranslation(this._editWorldTrans, h.fromValues(t[12], t[13], t[14])),
            d.copy(this._editWorldScaleRot, t),
            this._editWorldScaleRot[12] = this._editWorldScaleRot[13] = this._editWorldScaleRot[14] = 0,
            d.invert(this._editInvWorldScaleRot, this._editWorldScaleRot)
        },
        startRotateEdit: function(t) {
            var e = this._rotateNode.getWorldMatrices()[0]
              , i = h.create();
            h.transformMat4(i, i, e),
            this.getCanvasPositionFromWorldPoint(i, i);
            var n = this.pickGizmo(t, this._hoverNode.getNodeMask() | w.PICK_ARC);
            if (n) {
                var r = 0 === this._hoverNode._nbAxis ? -1 : 1
                  , a = h.create();
                a[0] = r * n.point[1],
                a[1] = -r * n.point[0],
                a[2] = n.point[2];
                var s = h.create();
                h.transformMat4(s, a, this._hoverNode.getMatrix()),
                h.transformMat4(s, s, e),
                this.getCanvasPositionFromWorldPoint(s, s);
                var o = this._editLineDirection;
                u.sub(o, s, i),
                u.normalize(o, o),
                this._showAngle.setNodeMask(w.NO_PICK),
                n.point[2] = 0;
                var l = this._showAngle.getStateSet();
                l.getUniform("uAngle").setFloat(0),
                l.getUniform("uBase").setVec3(h.normalize(n.point, n.point)),
                b(this._editLineOrigin, t)
            }
        },
        startTranslateEdit: function(t) {
            var e = this._editLineOrigin
              , i = this._editLineDirection
              , n = this._translateNode.getWorldMatrices()[0];
            d.getTranslation(e, n),
            h.init(i),
            i[this._hoverNode._nbAxis] = 1,
            this._translateInLocal && (h.transformMat4(i, i, this._editWorldScaleRot),
            h.normalize(i, i)),
            h.add(i, e, i),
            this.getCanvasPositionFromWorldPoint(e, e),
            this.getCanvasPositionFromWorldPoint(i, i),
            u.sub(i, i, e),
            u.normalize(i, i);
            var r = this._editOffset;
            b(r, t),
            u.sub(r, r, e)
        },
        startPlaneEdit: function(t) {
            var e = this._editLineOrigin
              , i = this._planeNode.getWorldMatrices()[0];
            d.getTranslation(e, i),
            this.getCanvasPositionFromWorldPoint(e, e);
            var n = this._editOffset;
            b(n, t),
            u.sub(n, n, e)
        },
        drawLineCanvasDebug: function(t, e, i, n) {
            this._debugNode.setNodeMask(w.NO_PICK);
            var r = this._debugNode.getChildren()[0].getAttributes().Vertex;
            r.getElements()[0] = t / this._canvas.clientWidth * 2 - 1,
            r.getElements()[1] = (this._canvas.clientHeight - e) / this._canvas.clientHeight * 2 - 1,
            r.getElements()[2] = i / this._canvas.clientWidth * 2 - 1,
            r.getElements()[3] = (this._canvas.clientHeight - n) / this._canvas.clientHeight * 2 - 1,
            r.dirty()
        },
        pickAndSelect: function(t) {
            this.setNodeMask(0);
            var e = this.computeNearestIntersection(t, this._tmask);
            this._autoInsertMT ? this.attachToGeometry(e ? e.nodepath[e.nodepath.length - 1] : e) : this.attachToNodePath(e ? e.nodepath : e)
        },
        onMouseUp: function(t) {
            this._enableMouseBack && (this._enableMouseBack = !1,
            this._eventMouse.setEnable(!0),
            this._eventMouse.mouseup(t)),
            this._debugNode && this._debugNode.setNodeMask(0);
            var e = u.create();
            b(e, t),
            0 === u.distance(e, this._downCanvasCoord) && this.pickAndSelect(t),
            this._showAngle.setNodeMask(0),
            this._isEditing = !1,
            this._hoverNode && this.updateGizmoMask()
        },
        onMouseMove: function(t) {
            if (this._attachedNode) {
                var e;
                if (!1 === this._isEditing)
                    return e = this.pickGizmo(t, w.PICK_GIZMO),
                    void this.onNodeHovered(e);
                if (this._hoverNode) {
                    var i = this._hoverNode.getParents()[0];
                    i === this._rotateNode ? this.updateRotateEdit(t) : i === this._translateNode ? this.updateTranslateEdit(t) : i === this._planeNode && this.updatePlaneEdit(t)
                }
            }
        },
        updateRotateEdit: function() {
            var t = d.create()
              , e = u.create()
              , i = h.fromValues(1, 0, 0)
              , n = h.fromValues(0, 1, 0)
              , r = h.fromValues(0, 0, 1);
            return function(a) {
                var s = this._editLineOrigin
                  , o = this._editLineDirection;
                b(e, a),
                u.sub(e, e, s);
                var l = u.dot(e, o);
                this._debugNode && this.drawLineCanvasDebug(s[0], s[1], s[0] + o[0] * l, s[1] + o[1] * l);
                var h = 7 * l / Math.min(this._canvas.clientWidth, this._canvas.clientHeight);
                h %= 2 * Math.PI;
                var c = this._hoverNode._nbAxis;
                0 === c ? d.fromRotation(t, -h, i) : 1 === c ? d.fromRotation(t, -h, n) : 2 === c && d.fromRotation(t, -h, r),
                this._showAngle.getOrCreateStateSet().getUniform("uAngle").setFloat(0 === c ? -h : h),
                this._rotateInLocal || (d.mul(t, this._editInvWorldScaleRot, t),
                d.mul(t, t, this._editWorldScaleRot)),
                d.mul(this._attachedNode.getMatrix(), this._editLocal, t),
                this._attachedNode.dirtyBound()
            }
        }(),
        updateTranslateEdit: function() {
            var t = u.create()
              , e = h.create();
            return function(i) {
                var n = this._editLineOrigin
                  , r = this._editLineDirection;
                b(t, i),
                u.sub(t, t, n),
                u.sub(t, t, this._editOffset);
                var a = u.dot(t, r);
                t[0] = n[0] + r[0] * a,
                t[1] = n[1] + r[1] * a,
                this._debugNode && this.drawLineCanvasDebug(n[0], n[1], t[0], t[1]);
                var s = this._viewer
                  , o = this._canvas
                  , l = t[0] * (s._canvasWidth / o.clientWidth)
                  , c = (o.clientHeight - t[1]) * (s._canvasHeight / o.clientHeight);
                if (this._lsi.reset(),
                this._lsi.setTestPlane(!1),
                this._lsi.set(h.set(this._origIntersect, l, c, 0), h.set(this._dstIntersect, l, c, 1)),
                this._iv.reset(),
                this._iv.setTraversalMask(this._hoverNode.getNodeMask()),
                d.copy(this.getMatrix(), this._editWorldTrans),
                this.setOnlyGizmoPicking(),
                this._viewer._camera.accept(this._iv),
                this.setOnlyScenePicking(),
                this._translateInLocal) {
                    d.getScale(e, this._editInvWorldScaleRot);
                    var p = this._lsi.getTranslateDistance();
                    h.mul(e, e, p)
                } else
                    h.transformMat4(e, this._lsi.getTranslateDistance(), this._editInvWorldScaleRot);
                d.translate(this._attachedNode.getMatrix(), this._editLocal, e),
                this._attachedNode.dirtyBound()
            }
        }(),
        updatePlaneEdit: function() {
            var t = u.create()
              , e = h.create();
            return function(i) {
                b(t, i),
                u.sub(t, t, this._editOffset);
                var n = this._viewer
                  , r = this._canvas
                  , a = t[0] * (n._canvasWidth / r.clientWidth)
                  , s = (r.clientHeight - t[1]) * (n._canvasHeight / r.clientHeight);
                if (this._lsi.reset(),
                this._lsi.setTestPlane(!0),
                this._lsi.set(h.set(this._origIntersect, a, s, 0), h.set(this._dstIntersect, a, s, 1)),
                this._iv.reset(),
                this._iv.setTraversalMask(this._hoverNode.getNodeMask()),
                d.copy(this.getMatrix(), this._editWorldTrans),
                this.setOnlyGizmoPicking(),
                this._viewer._camera.accept(this._iv),
                this.setOnlyScenePicking(),
                this._translateInLocal) {
                    d.getScale(e, this._editInvWorldScaleRot);
                    var o = this._lsi.getTranslateDistance();
                    h.mul(e, e, o)
                } else
                    h.transformMat4(e, this._lsi.getTranslateDistance(), this._editInvWorldScaleRot);
                d.translate(this._attachedNode.getMatrix(), this._editLocal, e),
                this._attachedNode.dirtyBound()
            }
        }()
    }),
    t.exports = w
}
, function(t, e, i) {
    "use strict";
    var n = i(5).vec3
      , r = i(5).mat4
      , a = i(663)
      , s = function() {
        this._center = n.create(),
        this._iCenter = n.create(),
        this._radius = 1,
        this._iRadius = 1,
        this._intersections = []
    };
    s.prototype = {
        set: function(t, e) {
            n.copy(this._center, t),
            n.copy(this._iCenter, t),
            this._radius = this._iRadius = e,
            this.reset()
        },
        setCenter: function(t) {
            n.copy(this._center, t),
            n.copy(this._iCenter, t)
        },
        setRadius: function(t) {
            this._radius = this._iRadius = t
        },
        reset: function() {
            this._intersections.length = 0
        },
        enter: function(t) {
            return !t.isCullingActive() || this.intersects(t.getBound())
        },
        intersects: function(t) {
            if (!t.valid())
                return !1;
            var e = this._iRadius + t.radius();
            return n.sqrDist(t.center(), this._iCenter) <= e * e
        },
        intersect: function() {
            var t = new a;
            return function(e, i) {
                var n = i.getShape();
                if (n)
                    return n.intersectSphere(this._iCenter, this._iRadius, this._intersections, e.nodePath);
                if (t.reset(),
                t.setNodePath(e.nodePath),
                t.set(this._iCenter, this._iRadius),
                i.computeTransformedVertices) {
                    var r = i.getVertexAttributeList()
                      , a = r.Vertex.getElements();
                    r.Vertex._elements = i.computeTransformedVertices(),
                    t.apply(i),
                    r.Vertex._elements = a
                } else
                    t.apply(i);
                for (var s = t._intersections.length, o = 0; o < s; o++)
                    this._intersections.push(t._intersections[o]);
                return s > 0
            }
        }(),
        getIntersections: function() {
            return this._intersections
        },
        setCurrentTransformation: function() {
            var t = n.create();
            return function(e) {
                r.invert(e, e),
                n.transformMat4(this._iCenter, this._center, e),
                this._iRadius = this._radius * r.getScale(t, e)[0]
            }
        }()
    },
    t.exports = s
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = i(162)
      , a = i(143)
      , s = i(65)
      , o = i(134)
      , l = i(5).vec3
      , u = n
      , h = function() {
        s.call(this),
        this._T = void 0,
        this._B = void 0,
        this._N = void 0,
        this._texCoordUnit = 0
    };
    h.prototype = n.objectInherit(s.prototype, {
        apply: function(t) {
            t.getTypeID() === a.getTypeID() ? this.generate(t, this._texCoordUnit) : this.traverse(t)
        },
        setTexCoordUnit: function(t) {
            this._texCoordUnit = t
        },
        computePrimitiveSet: function(t, e) {
            if (e.getIndices) {
                var i, n = e.getNumIndices(), r = t.getAttributes().Vertex, a = t.getAttributes().Normal, s = t.getAttributes()["TexCoord" + this._texCoordUnit];
                if (e.getMode() === o.TRIANGLES)
                    for (i = 0; i < n; i += 3)
                        this.compute(e, r, a, s, i, i + 1, i + 2);
                else if (e.getMode() === o.TRIANGLE_STRIP)
                    for (i = 0; i < n - 2; ++i)
                        i % 2 == 0 ? this.compute(e, r, a, s, i, i + 1, i + 2) : this.compute(e, r, a, s, i + 1, i, i + 2)
            }
        },
        generate: function(t, e) {
            this._texCoordUnit = e,
            void 0 === this._texCoordUnit && (this._texCoordUnit = 0);
            var i = t.getAttributes().Vertex.getElements().length;
            this._T = new u.Float32Array(i),
            this._B = new u.Float32Array(i),
            this._N = new u.Float32Array(i),
            t.getPrimitiveSetList().forEach(function(e) {
                this.computePrimitiveSet(t, e)
            }, this);
            for (var n = i / 3, a = new u.Float32Array(4 * n), s = l.create(), o = l.create(), h = l.create(), c = 0; c < n; c++) {
                var d = this._T.subarray(3 * c, 3 * c + 3)
                  , p = this._N.subarray(3 * c, 3 * c + 3)
                  , f = this._B.subarray(3 * c, 3 * c + 3);
                l.normalize(p, p);
                var g = l.dot(p, d);
                l.scale(o, p, g),
                l.sub(s, d, o),
                l.normalize(h, s),
                l.cross(s, p, d);
                var m = l.dot(s, f);
                m = m < 0 ? -1 : 0,
                a[4 * c] = h[0],
                a[4 * c + 1] = h[1],
                a[4 * c + 2] = h[2],
                a[4 * c + 3] = m
            }
            t.getAttributes().Normal.setElements(this._N),
            t.getAttributes().Tangent = new r("ARRAY_BUFFER",a,4)
        },
        compute: function(t, e, i, n, r, a, s) {
            var o, u, h = t.index(r), c = t.index(a), d = t.index(s), p = e.getElements().subarray(3 * h, 3 * h + 3), f = e.getElements().subarray(3 * c, 3 * c + 3), g = e.getElements().subarray(3 * d, 3 * d + 3), m = i.getElements().subarray(3 * h, 3 * h + 3), v = i.getElements().subarray(3 * c, 3 * c + 3), _ = i.getElements().subarray(3 * d, 3 * d + 3), b = n.getElements().subarray(2 * h, 2 * h + 2), x = n.getElements().subarray(2 * c, 2 * c + 2), y = n.getElements().subarray(2 * d, 2 * d + 2), S = l.create(), w = l.create(), C = l.create(), M = l.create(), T = l.create(), A = l.create(), E = l.create(), P = l.create(), N = l.create();
            l.set(P, f[0] - p[0], x[0] - b[0], x[1] - b[1]),
            l.set(N, g[0] - p[0], y[0] - b[0], y[1] - b[1]),
            l.cross(S, P, N),
            0 !== S[0] && (l.normalize(S, S),
            u = -S[1] / S[0],
            o = -S[2] / S[0],
            T[0] += u,
            w[0] += o,
            A[0] += u,
            C[0] += o,
            E[0] += u,
            M[0] += o),
            l.set(P, f[1] - p[1], x[0] - b[0], x[1] - b[1]),
            l.set(N, g[1] - p[1], y[0] - b[0], y[1] - b[1]),
            l.cross(S, P, N),
            0 !== S[0] && (l.normalize(S, S),
            u = -S[1] / S[0],
            o = -S[2] / S[0],
            T[1] += u,
            w[1] += o,
            A[1] += u,
            C[1] += o,
            E[1] += u,
            M[1] += o),
            l.set(P, f[2] - p[2], x[0] - b[0], x[1] - b[1]),
            l.set(N, g[2] - p[2], y[0] - b[0], y[1] - b[1]),
            l.cross(S, P, N),
            0 !== S[0] && (l.normalize(S, S),
            u = -S[1] / S[0],
            o = -S[2] / S[0],
            T[2] += u,
            w[2] += o,
            A[2] += u,
            C[2] += o,
            E[2] += u,
            M[2] += o);
            var k, F, D, R = l.create(), I = l.create();
            l.cross(R, m, T),
            l.cross(I, R, m),
            k = this._T.subarray(3 * h, 3 * h + 3),
            l.add(k, I, k),
            l.cross(R, w, m),
            l.cross(I, m, R),
            F = this._B.subarray(3 * h, 3 * h + 3),
            l.add(F, I, F),
            l.cross(R, v, A),
            l.cross(I, R, v),
            k = this._T.subarray(3 * c, 3 * c + 3),
            l.add(k, I, k),
            l.cross(R, C, v),
            l.cross(I, v, R),
            F = this._B.subarray(3 * c, 3 * c + 3),
            l.add(F, I, F),
            l.cross(R, _, E),
            l.cross(I, R, _),
            k = this._T.subarray(3 * d, 3 * d + 3),
            l.add(k, I, k),
            l.cross(R, M, _),
            l.cross(I, _, R),
            F = this._B.subarray(3 * d, 3 * d + 3),
            l.add(F, I, F),
            D = this._N.subarray(3 * h, 3 * h + 3),
            l.add(D, m, D),
            D = this._N.subarray(3 * c, 3 * c + 3),
            l.add(D, v, D),
            D = this._N.subarray(3 * d, 3 * d + 3),
            l.add(D, _, D)
        }
    }),
    t.exports = h
}
, function(t, e, i) {
    "use strict";
    var n = i(272)
      , r = i(378)
      , a = i(5).mat4
      , s = i(128)
      , o = i(322)
      , l = i(323)
      , u = i(380)
      , h = i(93)
      , c = i(325)
      , d = i(81)
      , p = i(5).vec3
      , f = i(5).vec4
      , g = i(412)
      , m = i(536)
      , v = function(t, e) {
        this._rootView = t,
        this._offsetView = e
    };
    v.prototype = {
        update: function(t) {
            var e = t.getViewMatrix();
            return a.mul(e, this._offsetView, this._rootView),
            !0
        }
    };
    var _ = function(t) {
        var e = new h;
        return e.setTextureSize(t.width, t.height),
        e.setMinFilter("LINEAR"),
        e.setMagFilter("LINEAR"),
        e
    }
      , b = function() {
        var t = ["#ifdef GL_ES", "   precision highp float;", "#endif", "varying vec2 vTexCoord0;", "uniform sampler2D TextureLeft;", "uniform sampler2D TextureRight;", "void main() {", "   if (vTexCoord0.x < 0.5)", "       gl_FragColor = texture2D(TextureLeft, vec2(vTexCoord0.x * 2.0, vTexCoord0.y));", "   else", "       gl_FragColor = texture2D(TextureRight, vec2(vTexCoord0.x * 2.0 - 1.0, vTexCoord0.y));", "}"].join("\n");
        return new o(new l(l.VERTEX_SHADER,m.Filter.defaultVertexShader),new l(l.FRAGMENT_SHADER,t))
    }
      , x = function(t, e, i) {
        var r = new n;
        r.setViewport(i),
        r.setRenderOrder(n.NESTED_RENDER, 0),
        r.setReferenceFrame(c.ABSOLUTE_RF),
        a.ortho(r.getProjectionMatrix(), 0, 1, 0, 1, -5, 5);
        var s = r.getOrCreateStateSet();
        return s.addUniform(d.createInt(0, "TextureLeft")),
        s.addUniform(d.createInt(1, "TextureRight")),
        s.setTextureAttributeAndModes(0, t),
        s.setTextureAttributeAndModes(1, e),
        s.setAttributeAndModes(b()),
        r.addChild(u.createTexturedFullScreenFakeQuadGeometry()),
        r
    }
      , y = function(t, e) {
        var i = new n;
        return i.setName("rtt camera"),
        i.setViewport(new g(0,0,t.getWidth(),t.getHeight())),
        i.setProjectionMatrix(e),
        i.setClearColor(f.fromValues(.3, .3, .3, 0)),
        i.setRenderOrder(n.POST_RENDER, 0),
        i.attachTexture(r.COLOR_ATTACHMENT0, t),
        i.attachRenderBuffer(r.DEPTH_ATTACHMENT, r.DEPTH_COMPONENT16),
        i.setReferenceFrame(c.ABSOLUTE_RF),
        i
    }
      , S = {};
    S.createScene = function(t, e, i, n, r) {
        var o = n || new s
          , l = void 0 !== r ? r : 1
          , u = i.getEyeParameters("left")
          , h = i.getEyeParameters("right")
          , c = new window.VRFrameData;
        i.getFrameData(c);
        var d = a.fromTranslation(a.create(), p.fromValues(-l * u.offset[0], u.offset[1], u.offset[2]))
          , f = a.fromTranslation(a.create(), p.fromValues(-l * h.offset[0], h.offset[1], h.offset[2]))
          , g = {
            width: Math.max(u.renderWidth, h.renderWidth),
            height: Math.max(u.renderHeight, h.renderHeight)
        }
          , m = _(g)
          , b = _(g)
          , S = y(m, c.leftProjectionMatrix)
          , w = y(b, c.rightProjectionMatrix)
          , C = t.getCamera().getViewMatrix();
        S.addUpdateCallback(new v(C,d)),
        w.addUpdateCallback(new v(C,f));
        var M = x(m, b, t.getCamera().getViewport());
        return S.addChild(e),
        w.addChild(e),
        o.addChild(S),
        o.addChild(w),
        o.addChild(M),
        o
    }
    ,
    t.exports = S
}
, function(t, e, i) {
    "use strict";
    var n = i(272)
      , r = i(378)
      , a = i(5).mat4
      , s = i(128)
      , o = i(322)
      , l = i(323)
      , u = i(380)
      , h = i(93)
      , c = i(325)
      , d = i(81)
      , p = i(5).vec2
      , f = i(5).vec3
      , g = i(5).vec4
      , m = i(412)
      , v = i(536)
      , _ = {}
      , b = function(t, e, i, n, r) {
        this._viewer = t,
        this._rttScene = e,
        this._hmdConfig = i,
        this._root = n,
        this._canvas = r,
        this._width = r.width,
        this._height = r.height
    };
    b.prototype = {
        update: function() {
            var t = this._canvas
              , e = t.width
              , i = t.height;
            if (e !== this._width || i !== this._height) {
                this._root.removeChildren();
                var n = this._hmdConfig;
                n && n.isCardboard && (n.hResolution = e,
                n.vResolution = i),
                this._width = e,
                this._height = i,
                _.createScene(this._viewer, this._rttScene, n, this._root)
            }
            return !0
        }
    };
    var x = function(t, e) {
        this._rootView = t,
        this._offsetView = e
    };
    x.prototype = {
        update: function(t) {
            var e = t.getViewMatrix();
            return a.mul(e, this._offsetView, this._rootView),
            !0
        }
    };
    var y = function(t, e, i, n) {
        var r = e.hResolution / (2 * e.vResolution)
          , s = -1 - 4 * (.25 * e.hScreenSize - .5 * e.lensSeparationDistance) / e.hScreenSize
          , o = e.distortionK[0] + e.distortionK[1] * Math.pow(s, 2) + e.distortionK[2] * Math.pow(s, 4) + e.distortionK[3] * Math.pow(s, 6)
          , l = 180 / Math.PI * 2 * Math.atan2(e.vScreenSize * o, 2 * e.eyeToScreenDistance)
          , u = a.perspective(a.create(), Math.PI / 180 * l, r, .3, 1e4)
          , h = 4 * (.25 * e.hScreenSize - .5 * e.interpupillaryDistance) / e.hScreenSize
          , c = 4 * (.25 * e.hScreenSize - .5 * e.lensSeparationDistance) / e.hScreenSize
          , d = a.create()
          , g = a.create();
        n.projectionLeft = a.mul(d, a.fromTranslation(d, f.fromValues(h, 0, 0)), u),
        n.projectionRight = a.mul(g, a.fromTranslation(g, f.fromValues(-h, 0, 0)), u),
        n.viewLeft = a.fromTranslation(a.create(), f.fromValues(t * e.interpupillaryDistance * .5, 0, 0)),
        n.viewRight = a.fromTranslation(a.create(), f.fromValues(-t * e.interpupillaryDistance * .5, 0, 0)),
        i.lensCenterLeft = p.fromValues(c, 0),
        i.lensCenterRight = p.fromValues(-c, 0),
        i.hmdWarpParam = e.distortionK,
        i.chromAbParam = e.chromaAbParameter,
        i.scaleIn = p.fromValues(1, 1 / r),
        i.scale = p.fromValues(1 / o, 1 * r / o)
    }
      , S = function() {
        var t = ["", "#ifdef GL_ES", "precision highp float;", "#endif", "uniform vec2 uScale;", "uniform vec2 uScaleIn;", "uniform vec2 uLensCenter;", "uniform vec4 uHmdWarpParam;", "uniform vec4 uChromAbParam;", "uniform sampler2D Texture0;", "varying vec2 vTexCoord0;", "void main(void) {", "  vec2 uv = (vTexCoord0 * 2.0) - 1.0;", "  vec2 theta = (uv - uLensCenter) * uScaleIn;", "  float rSq = theta.x * theta.x + theta.y * theta.y;", "  vec2 rvector = theta * (uHmdWarpParam.x + uHmdWarpParam.y * rSq + uHmdWarpParam.z * rSq * rSq + uHmdWarpParam.w * rSq * rSq * rSq);", "  vec2 rBlue = rvector * (uChromAbParam.z + uChromAbParam.w * rSq);", "  vec2 tcBlue = (uLensCenter + uScale * rBlue);", "  tcBlue = (tcBlue + 1.0) * 0.5;", "  if (any(bvec2(clamp(tcBlue, vec2(0.0, 0.0), vec2(1.0, 1.0)) - tcBlue))) {", "    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);", "    return;", "  }", "  vec2 tcGreen = uLensCenter + uScale * rvector;", "  tcGreen = (tcGreen + 1.0) * 0.5;", "  vec2 rRed = rvector * (uChromAbParam.x + uChromAbParam.y * rSq);", "  vec2 tcRed = uLensCenter + uScale * rRed;", "  tcRed = (tcRed + 1.0) * 0.5;", "  gl_FragColor = vec4(texture2D(Texture0, tcRed).r, texture2D(Texture0, tcGreen).g, texture2D(Texture0, tcBlue).b, 1);", "}", ""].join("\n");
        return new o(new l(l.VERTEX_SHADER,v.Filter.defaultVertexShader),new l(l.FRAGMENT_SHADER,t))
    }
      , w = function(t) {
        var e = new h;
        return e.setTextureSize(t[0], t[1]),
        e.setMinFilter("LINEAR"),
        e.setMagFilter("LINEAR"),
        e
    }
      , C = function(t, e, i, r, s, o) {
        var l = new n
          , u = e[0]
          , h = e[1]
          , p = i[0]
          , f = i[1];
        !0 === r ? t ? l.setViewport(new m(0,0,p / 2,f)) : l.setViewport(new m(p / 2,0,p / 2,f)) : t ? l.setViewport(new m(.5 * p - u,.5 * (f - h),u,h)) : l.setViewport(new m(.5 * p,.5 * (f - h),u,h)),
        a.ortho(l.getProjectionMatrix(), -.5, .5, -.5, .5, -5, 5),
        l.setRenderOrder(n.NESTED_RENDER, 0),
        l.setReferenceFrame(c.ABSOLUTE_RF);
        var g = l.getOrCreateStateSet();
        return g.setTextureAttributeAndModes(0, s),
        g.setAttributeAndModes(S()),
        g.addUniform(d.createFloat2(o.scale, "uScale")),
        g.addUniform(d.createFloat2(o.scaleIn, "uScaleIn")),
        g.addUniform(d.createFloat2(t ? o.lensCenterLeft : o.lensCenterRight, "uLensCenter")),
        g.addUniform(d.createFloat4(o.hmdWarpParam, "uHmdWarpParam")),
        g.addUniform(d.createFloat4(o.chromAbParam, "uChromAbParam")),
        l
    }
      , M = function(t, e) {
        var i = new n;
        return i.setName("rtt camera"),
        i.setViewport(new m(0,0,t.getWidth(),t.getHeight())),
        i.setProjectionMatrix(e),
        i.setClearColor(g.fromValues(.3, .3, .3, 0)),
        i.setRenderOrder(n.POST_RENDER, 0),
        i.attachTexture(r.COLOR_ATTACHMENT0, t),
        i.attachRenderBuffer(r.DEPTH_ATTACHMENT, r.DEPTH_COMPONENT16),
        i.setReferenceFrame(c.ABSOLUTE_RF),
        i
    };
    _.createScene = function(t, e, i, n, r) {
        var a = _.getDefaultConfig(i)
          , o = p.fromValues(.5 * a.hResolution, a.vResolution)
          , l = p.fromValues(.5 * a.hResolution, a.vResolution)
          , h = t.getCamera().getViewport()
          , c = p.fromValues(h.width(), h.height())
          , d = t.getGraphicContext().canvas;
        a.isCardboard && (c[0] = d.width,
        c[1] = d.height);
        var f = void 0 !== r ? r : 1
          , g = {}
          , m = {};
        y(f, a, g, m);
        var v = t.getCamera().getViewMatrix()
          , S = n || new s;
        S.addUpdateCallback(new b(t,e,i,S,d));
        var T = w(o)
          , A = M(T, m.projectionLeft)
          , E = C(!0, l, c, a.isCardboard, T, g);
        A.addUpdateCallback(new x(v,m.viewLeft));
        var P = w(o)
          , N = M(P, m.projectionRight)
          , k = C(!1, l, c, a.isCardboard, P, g);
        return N.addUpdateCallback(new x(v,m.viewRight)),
        A.addChild(e),
        N.addChild(e),
        E.addChild(u.createTexturedFullScreenFakeQuadGeometry()),
        k.addChild(u.createTexturedFullScreenFakeQuadGeometry()),
        S.addChild(A),
        S.addChild(N),
        S.addChild(E),
        S.addChild(k),
        S
    }
    ,
    _.getDefaultConfig = function(t) {
        var e = {
            hResolution: 1920,
            vResolution: 1080,
            hScreenSize: .1296,
            vScreenSize: .0729,
            interpupillaryDistance: .064,
            lensSeparationDistance: .0635,
            eyeToScreenDistance: .04,
            distortionK: g.fromValues(1, .22, .13, .02),
            chromaAbParameter: g.fromValues(.996, -.004, 1.014, 0),
            isCardboard: !1
        };
        return 2 === t || void 0 === t ? e : 1 === t ? (e.hResolution = 1280,
        e.vResolution = 800,
        e.hScreenSize = .14976,
        e.vScreenSize = .0936,
        e.lensSeparationDistance = .064,
        e.eyeToScreenDistance = .041,
        e.distortionK = g.fromValues(1, .22, .24, 0),
        e) : (void 0 !== t.hResolution && (e.hResolution = t.hResolution),
        void 0 !== t.vResolution && (e.vResolution = t.vResolution),
        void 0 !== t.hScreenSize && (e.hScreenSize = t.hScreenSize),
        void 0 !== t.vScreenSize && (e.vScreenSize = t.vScreenSize),
        void 0 !== t.interpupillaryDistance && (e.interpupillaryDistance = t.interpupillaryDistance),
        void 0 !== t.lensSeparationDistance && (e.lensSeparationDistance = t.lensSeparationDistance),
        void 0 !== t.eyeToScreenDistance && (e.eyeToScreenDistance = t.eyeToScreenDistance),
        void 0 !== t.distortionK && (e.distortionK = t.distortionK),
        void 0 !== t.chromaAbParameter && (e.chromaAbParameter = t.chromaAbParameter),
        void 0 !== t.isCardboard && (e.isCardboard = t.isCardboard),
        e)
    }
    ,
    t.exports = _
}
, function(t, e, i) {
    "use strict";
    var n = i(536)
      , r = i(664)
      , a = i(463)
      , s = i(660)
      , o = i(658)
      , l = i(537)
      , u = i(464)
      , h = i(465)
      , c = i(13)
      , d = i(879)
      , p = i(665)
      , f = i(661)
      , g = i(662)
      , m = i(880)
      , v = i(881)
      , _ = i(466)
      , b = i(883)
      , x = i(882)
      , y = {};
    y.Composer = n,
    c.objectMix(y, r),
    y.DelayInterpolator = a,
    y.DisplayNormalVisitor = s,
    y.DisplayGeometryVisitor = o,
    y.DisplayGraph = l,
    y.IntersectionVisitor = u,
    y.LineSegmentIntersector = h,
    y.NodeGizmo = d,
    y.GizmoGeometry = p,
    y.WebVRCustom = b,
    y.PolytopeIntersector = f,
    y.PolytopePrimitiveIntersector = g,
    y.SphereIntersector = m,
    y.TangentSpaceGenerator = v,
    y.TriangleLineSegmentIntersector = _,
    y.WebVR = x,
    t.exports = y
}
, function(t, e, i) {
    "use strict";
    var n = i(5).mat4;
    "getVRDisplays"in navigator && ("depthNear"in window.VRDisplay.prototype || (window.VRDisplay.prototype.depthNear = .01),
    "depthFar"in window.VRDisplay.prototype || (window.VRDisplay.prototype.depthFar = 1e4),
    "VRFrameData"in window || (window.VRFrameData = function() {
        this.leftProjectionMatrix = new Float32Array(16),
        this.leftViewMatrix = new Float32Array(16),
        this.rightProjectionMatrix = new Float32Array(16),
        this.rightViewMatrix = new Float32Array(16),
        this.pose = null
    }
    ,
    window.VRDisplay.prototype.getFrameData = function() {
        function t(t, r, a, s, o) {
            n.perspectiveFromFieldOfView(t, s.fieldOfView, o.depthNear, o.depthFar);
            var l = a.orientation
              , u = a.position;
            l || (l = e),
            u || (u = i),
            n.fromRotationTranslation(r, l, u),
            n.translate(r, r, s.offset),
            n.invert(r, r)
        }
        var e = new Float32Array([0, 0, 0, 1])
          , i = new Float32Array([0, 0, 0]);
        return function(e) {
            var i = this.getPose();
            return !!i && (e.pose = i,
            e.timestamp = i.timestamp,
            t(e.leftProjectionMatrix, e.leftViewMatrix, i, this.getEyeParameters("left"), this),
            t(e.rightProjectionMatrix, e.rightViewMatrix, i, this.getEyeParameters("right"), this),
            !0)
        }
    }()))
}
, function(module, exports, __webpack_require__) {
    "use strict";
    var Notify = __webpack_require__(28)
      , mat4 = __webpack_require__(5).mat4
      , Options = __webpack_require__(520)
      , P = __webpack_require__(7)
      , Timer = __webpack_require__(324)
      , TimerGPU = __webpack_require__(614)
      , UpdateVisitor = __webpack_require__(615)
      , MACROUTILS = __webpack_require__(13)
      , Texture = __webpack_require__(93)
      , OrbitManipulator = __webpack_require__(531)
      , createStats = __webpack_require__(887)
      , EventProxy = __webpack_require__(667)
      , View = __webpack_require__(539)
      , WebGLUtils = __webpack_require__(668)
      , WebGLDebugUtils = __webpack_require__(895)
      , requestFile = __webpack_require__(417)
      , getGLSLOptimizer = function() {
        var deferOptimizeGLSL = P.defer();
        window.deferOptimizeGLSL = deferOptimizeGLSL;
        var mod = ["        var Module = {", "            preRun: [],", "            postRun: [ function () {", '                var func = Module.cwrap( "optimize_glsl", "string", [ "string", "number", "number" ] );', "                window.deferOptimizeGLSL.resolve( func );", "            } ],", "            print: function ( text ) {", "                Notify.debug( text );", "            },", "            printErr: function ( text ) {", "                Notify.debug( text );", "            },", "            setStatus: function ( text ) {", "                Notify.debug( text );", "            },", "            totalDependencies: 0,", "            monitorRunDependencies: function ( left ) {", "                this.totalDependencies = Math.max( this.totalDependencies, left );", '                Module.setStatus( left ? "GLSL optimizer preparing... (" + ( this.totalDependencies - left ) + "/" + this.totalDependencies + ")" : "All downloads complete." );', "            },", '            memoryInitializerPrefixURL: "https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/"', "        };"].join("\n");
        Notify.log("try to load glsl optimizer");
        var url = "https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/glsl-optimizer.js"
          , promise = requestFile(url);
        return promise.then(function(script) {
            eval(mod + script)
        }).catch(function() {
            deferOptimizeGLSL.reject()
        }),
        deferOptimizeGLSL.promise
    }
      , Viewer = function(t, e, i) {
        View.call(this),
        this._startTick = Timer.instance().tick(),
        this._stats = void 0,
        this._done = !1,
        this._runPromise = P.resolve();
        var n = this.initOptions(e)
          , r = this.initWebGLContext(t, n, i);
        if (!r)
            throw "No WebGL implementation found";
        MACROUTILS.init(),
        this.initDeviceEvents(n, t),
        this.initStats(n, t),
        this.initRun(n),
        this._updateVisitor = new UpdateVisitor,
        this.setUpView(r.canvas, n),
        this._hmd = null,
        this._requestAnimationFrame = window.requestAnimationFrame.bind(window),
        this._contextLost = !1
    };
    Viewer.prototype = MACROUTILS.objectInherit(View.prototype, {
        initDeviceEvents: function(t, e) {
            var i = t.mouseEventNode || e
              , n = t.EventBackend || {};
            t.EventBackend || (t.EventBackend = n),
            n.StandardMouseKeyboard = t.EventBackend.StandardMouseKeyboard || {};
            var r = n.StandardMouseKeyboard.mouseEventNode || i;
            n.StandardMouseKeyboard.mouseEventNode = r,
            n.StandardMouseKeyboard.keyboardEventNode = n.StandardMouseKeyboard.keyboardEventNode || document,
            "ontouchstart"in window && (n.Hammer = n.Hammer || {},
            n.Hammer.eventNode = n.Hammer.eventNode || i),
            n.GamePad = n.GamePad || {},
            this._eventProxy = this.initEventProxy(t)
        },
        initOptions: function(t) {
            var e = new Options;
            return t && e.extend(t),
            e.extendWithOptionsURL(),
            !0 === e.getBoolean("traceLogCall") && (Notify.traceLogCall = !0),
            !0 === e.getBoolean("enableFrustumCulling") && this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),
            e
        },
        initWebGLContext: function(t, e, i) {
            e.get("SimulateWebGLLostContext") && (t = WebGLDebugUtils.makeLostContextSimulatingCanvas(t),
            t.loseContextInNCalls(e.get("SimulateWebGLLostContext")));
            var n = WebGLUtils.setupWebGL(t, e, i);
            return t.addEventListener("webglcontextlost", function(t) {
                this.contextLost(),
                t.preventDefault()
            }
            .bind(this), !1),
            t.addEventListener("webglcontextrestored", function() {
                this.contextRestored()
            }
            .bind(this), !1),
            (Notify.reportWebGLError || e.get("reportWebGLError")) && (n = WebGLDebugUtils.makeDebugContext(n)),
            this.initWebGLCaps(n),
            this.setGraphicContext(n),
            n
        },
        initRun: function(t) {
            if (!0 === t.getBoolean("GLSLOptimizer")) {
                var e = __webpack_require__(323);
                e.enableGLSLOptimizer = !0,
                this._runPromise = getGLSLOptimizer(),
                this._runPromise.then(function(t) {
                    e.glslOptimizer = t,
                    e.glslOptimizer ? Notify.log("uses glsl optimizer, use ?log=info to see shader output") : Notify.error("failed to load glsl optimizer")
                }).catch(function(t) {
                    Notify.error(t)
                })
            }
        },
        setContextLostCallback: function(t) {
            this._contextLostCallback = t,
            this._contextLost && t()
        },
        contextLost: function() {
            Notify.log("webgl context lost"),
            this._contextLostCallback && this._contextLostCallback(),
            this._contextLost = !0,
            window.cancelAnimationFrame(this._requestID)
        },
        contextRestored: function() {
            Notify.log("webgl context restored, but not supported - reload the page")
        },
        init: function() {},
        getUpdateVisitor: function() {
            return this._updateVisitor
        },
        getState: function() {
            return this.getCamera().getRenderer().getState()
        },
        initStats: function(t) {
            var e = TimerGPU.instance(this.getGraphicContext());
            if (!t.getBoolean("stats"))
                return void e.disable();
            this._stats = createStats(t),
            e.setCallback(this.callbackTimerGPU.bind(this))
        },
        callbackTimerGPU: function(t, e) {
            this._stats && this._stats.rStats(e).set(t / 1e6)
        },
        getViewerStats: function() {
            return this._stats
        },
        renderingTraversal: function() {
            if (this.getScene().getSceneData() && this.getScene().getSceneData().getBound(),
            this.getCamera()) {
                var t = this._stats
                  , e = TimerGPU.instance(this.getGraphicContext())
                  , i = this.getCamera().getRenderer();
                if (t && t.rStats("cull").start(),
                i.cull(),
                t && t.rStats("cull").end(),
                e.pollQueries(),
                e.start("glframe"),
                t && t.rStats("render").start(),
                i.draw(),
                t && t.rStats("render").end(),
                e.end("glframe"),
                t) {
                    var n = i.getCullVisitor();
                    t.rStats("cullcamera").set(n._numCamera),
                    t.rStats("cullmatrixtransform").set(n._numMatrixTransform),
                    t.rStats("cullprojection").set(n._numProjection),
                    t.rStats("cullnode").set(n._numNode),
                    t.rStats("cullightsource").set(n._numLightSource),
                    t.rStats("cullgeometry").set(n._numGeometry),
                    t.rStats("pushstateset").set(i.getState()._numPushStateSet)
                }
            }
        },
        updateTraversal: function() {
            var t = this._stats;
            t && t.rStats("update").start(),
            this._updateVisitor.resetStats(),
            this.getScene().updateSceneGraph(this._updateVisitor),
            t && t.rStats("updatecallback").set(this._updateVisitor._numUpdateCallback),
            this.getDatabasePager().releaseGLExpiredSubgraphs(.005),
            this.flushDeletedGLObjects(.005),
            t && t.rStats("update").end()
        },
        advance: function(t) {
            var e = t;
            void 0 === e && (e = Number.MAX_VALUE);
            var i = this._frameStamp
              , n = i.getFrameNumber();
            i.setFrameNumber(n + 1);
            var r = Timer.instance().deltaS(this._startTick, Timer.instance().tick());
            i.setReferenceTime(r);
            var a = i.getSimulationTime();
            i.setSimulationTime(e === Number.MAX_VALUE ? r : e),
            i.setDeltaTime(i.getSimulationTime() - a)
        },
        beginFrame: function() {
            var t = this._stats;
            t && (t.rStats("frame").start(),
            t.glS.start(),
            t.rStats("rAF").tick(),
            t.rStats("FPS").frame())
        },
        endFrame: function() {
            var t = this.getFrameStamp().getFrameNumber()
              , e = this._stats
              , i = e ? e.rStats : void 0;
            i && (Texture.getTextureManager(this.getGraphicContext()).updateStats(t, i),
            i("frame").end(),
            i("rStats").start(),
            i().update(),
            i("rStats").end())
        },
        checkNeedToDoFrame: function() {
            return this._requestContinousUpdate || this._requestRedraw
        },
        frame: function() {
            if (!this._contextLost) {
                this.beginFrame(),
                this.advance();
                var t = this.updateViewport();
                this.updateEventProxy(this._eventProxy, this.getFrameStamp()),
                this._updateVisitor.setFrameStamp(this.getFrameStamp()),
                this.getManipulator() && (this.getManipulator().update(this._updateVisitor),
                mat4.copy(this.getCamera().getViewMatrix(), this.getManipulator().getInverseMatrix())),
                (this.checkNeedToDoFrame() || t) && (this._requestRedraw = !1,
                this.updateTraversal(),
                this.renderingTraversal()),
                this.endFrame(),
                this._hmd && this._hmd.isPresenting && this._hmd.submitFrame()
            }
        },
        setDone: function(t) {
            this._done = t
        },
        done: function() {
            return this._done
        },
        _runImplementation: function() {
            var t = this
              , e = function() {
                t.done() || (t._requestID = t._requestAnimationFrame(e, t.getGraphicContext().canvas),
                t.frame())
            };
            e()
        },
        run: function() {
            var t = this;
            this._runPromise.then(function() {
                t._runImplementation()
            }).catch(function() {
                t._runImplementation()
            })
        },
        setVRDisplay: function(t) {
            this._hmd = t
        },
        getVRDisplay: function() {
            return this._hmd
        },
        setPresentVR: function(t) {
            if (!this._hmd)
                return Notify.warn("no hmd device provided to the viewer!"),
                P.reject();
            if (!this._hmd.capabilities.canPresent)
                return P.reject();
            if (t) {
                this._requestAnimationFrame = this._hmd.requestAnimationFrame.bind(this._hmd);
                var e = [{
                    source: this.getGraphicContext().canvas
                }];
                return this._hmd.requestPresent(e)
            }
            return this._requestAnimationFrame = window.requestAnimationFrame.bind(window),
            this._hmd.exitPresent()
        },
        setupManipulator: function(t) {
            void 0 === t && (t = new OrbitManipulator),
            void 0 !== t.setNode ? t.setNode(this.getSceneData()) : t.view = this,
            t.setCamera(this.getCamera()),
            this.setManipulator(t)
        },
        updateViewport: function() {
            var t = this.getGraphicContext()
              , e = t.canvas;
            if (!this.computeCanvasSize(e))
                return !1;
            var i = this.getCamera()
              , n = i.getViewport()
              , r = n.width()
              , a = n.height()
              , s = e.width / r
              , o = e.height / a
              , l = s / o;
            return n.setViewport(Math.round(n.x() * s), Math.round(n.y() * o), Math.round(n.width() * s), Math.round(n.height() * o)),
            1 !== l && mat4.mul(i.getProjectionMatrix(), i.getProjectionMatrix(), mat4.fromScaling(mat4.create(), [1 / l, 1, 1])),
            !0
        },
        initEventProxy: function(t) {
            var e = t || {}
              , i = {}
              , n = EventProxy
              , r = e.EventBackend;
            for (var a in n) {
                var s = !0
                  , o = {};
                if (r && void 0 !== r[a]) {
                    var l = r[a].enable;
                    s = void 0 === l || l,
                    o = r[a]
                }
                var u = new Options;
                if (u.extend(o).extend(t),
                delete u.EventBackend,
                s) {
                    var h = new n[a](this);
                    h.init(u),
                    i[a] = h
                }
            }
            return i
        },
        updateEventProxy: function(t, e) {
            for (var i in t) {
                var n = t[i];
                n.update && n.update(e)
            }
        },
        setManipulator: function(t) {
            this._manipulator && this.removeEventProxy(),
            t.getCamera() || t.setCamera(this.getCamera()),
            View.prototype.setManipulator.call(this, t)
        },
        removeEventProxy: function() {
            var t = this._eventProxy;
            for (var e in t) {
                var i = t[e];
                i.remove && i.remove()
            }
        },
        getEventProxy: function() {
            return this._eventProxy
        }
    }),
    module.exports = Viewer
}
, function(t, e, i) {
    "use strict";
    var n = i(13)
      , r = window.BrowserStats
      , a = window.glStats
      , s = window.rStats
      , o = function(t) {
        this.bS = new r,
        this.glS = new a;
        var e = {
            frame: {
                caption: "Total frame time (ms)",
                over: 16,
                average: !0
            },
            fps: {
                caption: "Framerate (FPS)",
                below: 30
            },
            calls: {
                caption: "Calls (three.js)",
                over: 3e3
            },
            raf: {
                caption: "Time since last rAF (ms)",
                average: !0,
                avgMs: 500
            },
            rstats: {
                caption: "rStats update (ms)",
                average: !0,
                avgMs: 100
            },
            update: {
                caption: "update",
                average: !0
            },
            cull: {
                caption: "cull",
                average: !0
            },
            render: {
                caption: "render",
                average: !0
            },
            glframe: {
                caption: "glframe",
                average: !0
            },
            textureused: {
                caption: "texture used"
            },
            texturereserved: {
                caption: "texture reserved"
            },
            texturetotal: {
                caption: "texture total"
            },
            pushstateset: {
                caption: "num pushStateSet"
            },
            updatecallback: {
                caption: "num updateCallback"
            },
            cullcamera: {
                caption: "camera"
            },
            cullmatrixtransform: {
                caption: "matrixTransform"
            },
            cullprojection: {
                caption: "projection"
            },
            cullnode: {
                caption: "node"
            },
            culllightsource: {
                caption: "lightSource"
            },
            cullgeometry: {
                caption: "geometry"
            }
        }
          , i = [{
            base: "frame",
            steps: ["update", "cull", "render"]
        }]
          , o = [{
            caption: "Framerate",
            values: ["fps", "raf"]
        }, {
            caption: "Frame Budget",
            values: ["frame", "update", "cull", "render", "glframe"]
        }, {
            caption: "Scene Graph",
            values: ["pushstateset", "updatecallback"]
        }, {
            caption: "Cull",
            values: ["cullnode", "cullmatrixtransform", "cullgeometry", "cullcamera", "culllighsource", "cullprojection"]
        }, {
            caption: "Texture Memory",
            values: ["texturereserved", "textureused", "texturetotal"]
        }]
          , l = [this.bS, this.glS];
        t && (t.values && n.objectMix(e, t.values),
        t.groups && Array.prototype.unshift.apply(o, t.groups),
        t.fractions && Array.prototype.push.apply(i, t.fractions),
        t.plugins && Array.prototype.push.apply(l, t.plugins)),
        this.rStats = new s({
            values: e,
            groups: o,
            fractions: i,
            plugins: l,
            colours: ["#cc9933", "#f20041", "#69818c", "#d90074", "#b6f2ee", "#660044", "#50664d", "#330022", "#f2eeb6", "#ee00ff", "#806460", "#1600a6", "#994d57", "#00004d", "#f279da", "#002933", "#395073", "#00eeff", "#79baf2", "#008066", "#79f2aa", "#00ff66", "#1a331d", "#004d14", "#8c6c46", "#388c00", "#602080", "#ff8800", "#6d3df2", "#995200", "#0d1233", "#402200", "#3d6df2", "#330e00", "#e6f23d", "#730000"]
        })
    }
      , l = function(t) {
        if (s) {
            var e = ".rs-base{ position: absolute; z-index: 10000; padding: 10px; background-color: #222; font-size: 12px; line-height: 1.2em; width: 350px; font-family: 'Roboto Condensed', tahoma, sans-serif; left: 0; top: 0; overflow: hidden; } .rs-base h1{ margin: 0; padding: 0; font-size: 1.4em; color: #fff; margin-bottom: 5px; cursor: pointer; } .rs-base div.rs-group{ margin-bottom: 10px; } .rs-base div.rs-group.hidden{ display: none; } .rs-base div.rs-fraction{ position: relative; margin-bottom: 5px; } .rs-base div.rs-fraction p{ width: 145px; text-align: right; margin: 0; padding: 0; } .rs-base div.rs-legend{ position: absolute; line-height: 1em; } .rs-base div.rs-counter-base{ position: relative; margin: 2px 0; height: 1em; } .rs-base span.rs-counter-id{ position: absolute; left: 0; top: 0; } .rs-base div.rs-counter-value{ position: absolute; left: 115px; width: 30px; height: 1em; top: 0; text-align: right; } .rs-base canvas.rs-canvas{ position: absolute; right: 0; } "
              , i = document.head || document.getElementsByTagName("head")[0]
              , n = document.createElement("style");
            return n.type = "text/css",
            n.styleSheet ? n.styleSheet.cssText = e : n.appendChild(document.createTextNode(e)),
            i.appendChild(n),
            new o(t.rstats)
        }
    };
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = function(t) {
        this._viewer = t,
        this._type = "DeviceOrientation",
        this._enable = !1,
        this._deviceOrientation = void 0,
        this._screenOrientation = window.orientation || 90
    };
    n.prototype = {
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function() {
            var t = this;
            window.addEventListener("deviceorientation", function(e) {
                null !== e.alpha && void 0 !== e.alpha && (t._deviceOrientation = e)
            }, !1),
            window.addEventListener("orientationchange", function() {
                null !== window.orientation && void 0 !== window.orientation && (t._screenOrientation = window.orientation)
            }, !1)
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        isValid: function() {
            if (!this._enable)
                return !1;
            if (!this._deviceOrientation)
                return !1;
            var t = this._viewer.getManipulator();
            return !!t && !!t.getControllerList()[this._type]
        },
        update: function() {
            if (this.isValid()) {
                var t = this.getManipulatorController();
                t.update && t.update(this._deviceOrientation, this._screenOrientation)
            }
        }
    },
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = function(t) {
        this._viewer = t,
        this._type = "GamePad",
        this._enable = !0,
        this._gamepadIndex = -1
    };
    r.prototype = {
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function() {},
        isValid: function() {
            if (!this._enable)
                return !1;
            var t = this._viewer.getManipulator();
            return !!t && !!t.getControllerList()[this._type]
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        gamepadPoll: function() {
            if (!navigator.getGamepads)
                return null;
            var t = navigator.getGamepads()
              , e = t[this._gamepadIndex];
            if (e)
                return e;
            for (var i = 0, n = t.length; i < n; ++i) {
                var r = t[i];
                if (r && r.id && -1 === r.id.indexOf("Unknown Gamepad"))
                    return this._gamepadIndex = i,
                    this.onGamepadConnect(r),
                    r
            }
            return this._gamepadIndex >= 0 && (this._gamepadIndex = -1,
            this.onGamepadConnect()),
            null
        },
        onGamepadConnect: function(t) {
            n.log("Detected new gamepad!", t)
        },
        onGamepadDisconnect: function() {
            n.log("Gamepad disconnected")
        },
        update: function() {
            if (this.isValid()) {
                var t = this.gamepadPoll();
                if (t) {
                    var e = this.getManipulatorController();
                    e.update && e.update(t)
                }
            }
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(169)
      , r = function(t) {
        this._enable = !0,
        this._viewer = t,
        this._type = "Hammer",
        this._eventNode = void 0
    };
    r.prototype = {
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function(t) {
            var e = {
                prevent_default: !0,
                drag_max_touches: 2,
                transform_min_scale: .08,
                transform_min_rotation: 180,
                transform_always_block: !0,
                hold: !1,
                release: !1,
                swipe: !1,
                tap: !1
            };
            this._eventNode = t.eventNode,
            this._eventNode && (this._hammer = new n(this._eventNode,e),
            !1 === t.getBoolean("scrollwheel") ? this._hammer.get("pinch").set({
                enable: !1
            }) : this._hammer.get("pinch").set({
                enable: !0
            }))
        },
        isValid: function() {
            return !!(this._enable && this._viewer.getManipulator() && this._viewer.getManipulator().getControllerList()[this._type])
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        update: function() {
            this.isValid() && this.getManipulatorController().setEventProxy(this._hammer)
        },
        remove: function() {
            this.isValid() && this.getManipulatorController().removeEventProxy(this._hammer)
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(1093)
      , r = i(28)
      , a = function(t) {
        this._viewer = t,
        this._type = "LeapMotion",
        this._enable = !0
    };
    a.prototype = {
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function(t) {
            if (void 0 !== n && n.Controller) {
                var e = this;
                this._controller = new n.Controller({
                    enableGestures: t.gestures || !0,
                    tryReconnectOnDisconnect: !0,
                    connectAttempts: 3
                }),
                this._controller.on("ready", function() {
                    t.readyCallback && t.readyCallback(e._controller),
                    e._leapMotionReady = !0,
                    r.info("leapmotion ready")
                }),
                this._controller.loop(this._update.bind(this))
            }
        },
        isValid: function() {
            if (!this._enable)
                return !1;
            var t = this._viewer.getManipulator();
            return !!t && !!t.getControllerList()[this._type]
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        _update: function(t) {
            if (t.valid && this.isValid()) {
                var e = this.getManipulatorController();
                e.update && e.update(t)
            }
        }
    },
    t.exports = a
}
, function(t, e, i) {
    "use strict";
    var n = i(5).vec2
      , r = function(t) {
        this._enable = !0,
        this._viewer = t,
        this._type = "StandardMouseKeyboard",
        this._mouseEventNode = void 0,
        this._wheelEventNode = void 0,
        this._keyboardEventNode = void 0,
        this._eventList = ["mousedown", "mouseup", "mouseout", "mousemove", "dblclick"],
        this._mousePosition = n.create()
    };
    r.prototype = {
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function(t) {
            var e = t.mouseEventNode
              , i = t.wheelEventNode || e
              , n = t.keyboardEventNode || e;
            !1 === t.getBoolean("scrollwheel") && (i = null),
            this._mouseEventNode = e,
            this._wheelEventNode = i,
            this._keyboardEventNode = n,
            this._callbacks = {
                mousedown: this.mousedown.bind(this),
                mouseup: this.mouseup.bind(this),
                mouseout: this.mouseout.bind(this),
                mousemove: this.mousemove.bind(this),
                dblclick: this.dblclick.bind(this),
                mousewheel: this.mousewheel.bind(this),
                preventDefault: this.preventDefault.bind(this),
                keydown: this.keydown.bind(this),
                keyup: this.keyup.bind(this)
            },
            this.addEventListeners()
        },
        _addOrRemoveEventListeners: function(t) {
            var e = this._callbacks
              , i = t ? "removeEventListener" : "addEventListener"
              , n = this._mouseEventNode && this._mouseEventNode[i].bind(this._mouseEventNode)
              , r = this._wheelEventNode && this._wheelEventNode[i].bind(this._wheelEventNode)
              , a = this._keyboardEventNode && this._keyboardEventNode[i].bind(this._keyboardEventNode);
            if (n)
                for (var s = 0, o = this._eventList.length; s < o; s++) {
                    var l = this._eventList[s];
                    n(l, e[l], !1)
                }
            r && (r("DOMMouseScroll", e.mousewheel, !1),
            r("mousewheel", e.mousewheel, !1),
            r("MozMousePixelScroll", e.preventDefault, !1)),
            a && (a("keydown", e.keydown, !1),
            a("keyup", e.keyup, !1))
        },
        addEventListeners: function() {
            return this._addOrRemoveEventListeners(!1)
        },
        removeEventListeners: function() {
            return this._addOrRemoveEventListeners(!0)
        },
        isValid: function() {
            return !!(this._enable && this._viewer.getManipulator() && this._viewer.getManipulator().getControllerList()[this._type])
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        keyup: function(t) {
            if (this.isValid() && this.getManipulatorController().keyup)
                return this.getManipulatorController().keyup(t)
        },
        keydown: function(t) {
            if (this.isValid() && this.getManipulatorController().keydown)
                return this.getManipulatorController().keydown(t)
        },
        mousedown: function(t) {
            if (this.isValid() && this.getManipulatorController().mousedown)
                return 1 === t.button && t.preventDefault(),
                this.getManipulatorController().mousedown(t)
        },
        mouseup: function(t) {
            if (this.isValid() && this.getManipulatorController().mouseup)
                return this.getManipulatorController().mouseup(t)
        },
        mouseout: function(t) {
            if (this.isValid() && this.getManipulatorController().mouseout)
                return this.getManipulatorController().mouseout(t)
        },
        mousemove: function(t) {
            if (this.isValid() && this.getManipulatorController().mousemove)
                return this.getManipulatorController().mousemove(t)
        },
        dblclick: function(t) {
            if (this.isValid() && this.getManipulatorController().dblclick)
                return this.getManipulatorController().dblclick(t)
        },
        mousewheel: function(t) {
            if (this.isValid()) {
                var e = this.getManipulatorController();
                if (e.mousewheel) {
                    t.preventDefault();
                    var i = t || window.event
                      , n = [].slice.call(arguments, 1)
                      , r = 0
                      , a = 0
                      , s = 0;
                    return t.wheelDelta && (r = t.wheelDelta / 120),
                    t.detail && (r = -t.detail / 3),
                    s = r,
                    void 0 !== i.axis && i.axis === i.HORIZONTAL_AXIS && (s = 0,
                    a = -1 * r),
                    void 0 !== i.wheelDeltaY && (s = i.wheelDeltaY / 120),
                    void 0 !== i.wheelDeltaX && (a = -1 * i.wheelDeltaX / 120),
                    n.unshift(t, r, a, s),
                    this.getManipulatorController().mousewheel.apply(e, n)
                }
            }
        },
        preventDefault: function(t) {
            t.preventDefault()
        },
        divGlobalOffset: function(t) {
            var e = 0
              , i = 0;
            e = t.offsetLeft,
            i = t.offsetTop;
            for (var n = document.getElementsByTagName("body")[0]; t.offsetParent && t !== n; )
                e += t.offsetParent.offsetLeft,
                i += t.offsetParent.offsetTop,
                t = t.offsetParent;
            return this._mousePosition[0] = e,
            this._mousePosition[1] = i,
            this._mousePosition
        },
        getPositionRelativeToCanvas: function(t, e) {
            var i, n, r = t.target;
            t.pageX || t.pageY ? (i = t.pageX,
            n = t.pageY) : (t.clientX || t.clientY) && (i = t.clientX + document.body.scrollLeft + document.documentElement.scrollLeft,
            n = t.clientY + document.body.scrollTop + document.documentElement.scrollTop);
            var a = this.divGlobalOffset(r);
            return i -= a[0],
            n = r.height - (n - a[1]),
            void 0 === e && (e = this._mousePosition),
            e[0] = i,
            e[1] = n,
            e
        },
        update: function() {
            this.isValid() && this.getManipulatorController().setEventProxy(this)
        }
    },
    t.exports = r
}
, function(t, e, i) {
    "use strict";
    var n = i(28)
      , r = i(5).quat
      , a = i(5).vec3
      , s = i(5).mat4;
    i(885);
    var o = function(t) {
        this._viewer = t,
        this._type = "WebVR",
        this._enable = !1,
        this._hmd = void 0,
        this._sensor = void 0,
        this._frameData = void 0,
        this._quat = r.create(),
        this._pos = a.create(),
        this._worldScale = 1
    };
    o.prototype = {
        setWorldScale: function(t) {
            this._worldScale = t
        },
        setEnable: function(t) {
            this._enable = t
        },
        getEnable: function() {
            return this._enable
        },
        init: function() {
            if (navigator.getVRDisplays) {
                var t = this;
                navigator.getVRDisplays().then(function(e) {
                    e.length > 0 && (t._hmd = e[0],
                    t._frameData = new window.VRFrameData,
                    n.log("Found a VR display"),
                    t._viewer.setVRDisplay(t._hmd))
                })
            }
        },
        getManipulatorController: function() {
            return this._viewer.getManipulator().getControllerList()[this._type]
        },
        isValid: function() {
            if (!this._enable)
                return !1;
            var t = this._viewer.getManipulator();
            return !!t && (!!t.getControllerList()[this._type] && !!this._hmd)
        },
        update: function() {
            var t = r.create()
              , e = a.create();
            return function() {
                if (this.isValid()) {
                    var i = this.getManipulatorController();
                    if (i.update) {
                        this._hmd.getFrameData(this._frameData);
                        var n = this._frameData.pose;
                        if (n) {
                            var o = this._hmd.stageParameters && this._hmd.stageParameters.sittingToStandingTransform
                              , l = n.orientation;
                            l && (o && (l = s.getRotation(t, o),
                            r.mul(l, l, n.orientation)),
                            this._quat[0] = l[0],
                            this._quat[1] = -l[2],
                            this._quat[2] = l[1],
                            this._quat[3] = l[3]);
                            var u = n.position;
                            u && (o && (u = a.transformMat4(e, u, o)),
                            this._pos[0] = u[0] * this._worldScale,
                            this._pos[1] = -u[2] * this._worldScale,
                            this._pos[2] = u[1] * this._worldScale),
                            i.update(this._quat, this._pos)
                        }
                    }
                }
            }
        }(),
        getHmd: function() {
            return this._hmd
        }
    },
    t.exports = o
}
, function(t, e, i) {
    "use strict";
    var n = i(538)
      , r = i(539)
      , a = i(886)
      , s = i(667)
      , o = i(666)
      , l = {};
    l.Renderer = n,
    l.View = r,
    l.Viewer = a,
    l.EventProxy = s,
    l.Scene = o,
    t.exports = l
}
, function(t, e, i) {
    "use strict";
    var n = (i(28),
    function() {
        function t(t) {
            if (null == p) {
                p = {},
                f = {};
                for (var e in t)
                    "number" == typeof t[e] && (p[t[e]] = e,
                    f[e] = t[e])
            }
        }
        function e() {
            if (null == p)
                throw "WebGLDebugUtils.init(ctx) not called"
        }
        function i(t) {
            return e(),
            void 0 !== p[t]
        }
        function n(t) {
            e();
            var i = p[t];
            return void 0 !== i ? "gl." + i : "/*UNKNOWN WebGL ENUM*/ 0x" + t.toString(16)
        }
        function r(t, e, i, r) {
            var a = d[t];
            if (void 0 !== a) {
                var a = a[e];
                if (void 0 !== a && a[i]) {
                    if ("object" == typeof a[i] && void 0 !== a[i].enumBitwiseOr) {
                        for (var s = a[i].enumBitwiseOr, o = 0, l = [], u = 0; u < s.length; ++u) {
                            var h = f[s[u]];
                            0 != (r & h) && (o |= h,
                            l.push(n(h)))
                        }
                        return o === r ? l.join(" | ") : n(r)
                    }
                    return n(r)
                }
            }
            return null === r ? "null" : void 0 === r ? "undefined" : r.toString()
        }
        function a(t, e) {
            for (var i = "", n = e.length, a = 0; a < n; ++a)
                i += (0 == a ? "" : ", ") + r(t, n, a, e[a]);
            return i
        }
        function s(t, e, i) {
            t.__defineGetter__(i, function() {
                return e[i]
            }),
            t.__defineSetter__(i, function(t) {
                e[i] = t
            })
        }
        function o(e, i, a, l) {
            function u(t, e) {
                return function() {
                    a && a(e, arguments);
                    var n = t[e].apply(t, arguments)
                      , r = l.getError();
                    return 0 != r && (h[r] = !0,
                    i(r, e, arguments)),
                    n
                }
            }
            l = l || e,
            t(e),
            i = i || function(t, e, i) {
                for (var a = "", s = i.length, o = 0; o < s; ++o)
                    a += (0 == o ? "" : ", ") + r(e, s, o, i[o]);
                c("WebGL error " + n(t) + " in " + e + "(" + a + ")")
            }
            ;
            var h = {}
              , d = {};
            for (var p in e)
                if ("function" == typeof e[p])
                    if ("getExtension" != p)
                        d[p] = u(e, p);
                    else {
                        var f = u(e, p);
                        d[p] = function() {
                            var t = f.apply(e, arguments);
                            return t ? o(t, i, a, l) : null
                        }
                    }
                else
                    s(d, e, p);
            return d.getError = function() {
                for (var t in h)
                    if (h.hasOwnProperty(t) && h[t])
                        return h[t] = !1,
                        t;
                return e.NO_ERROR
            }
            ,
            d
        }
        function l(t) {
            var e = !!t.createTransformFeedback;
            e && t.bindVertexArray(null);
            var i = t.getParameter(t.MAX_VERTEX_ATTRIBS)
              , n = t.createBuffer();
            t.bindBuffer(t.ARRAY_BUFFER, n);
            for (var r = 0; r < i; ++r)
                t.disableVertexAttribArray(r),
                t.vertexAttribPointer(r, 4, t.FLOAT, !1, 0, 0),
                t.vertexAttrib1f(r, 0),
                e && t.vertexAttribDivisor(r, 0);
            t.deleteBuffer(n);
            for (var a = t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS), r = 0; r < a; ++r)
                t.activeTexture(t.TEXTURE0 + r),
                t.bindTexture(t.TEXTURE_CUBE_MAP, null),
                t.bindTexture(t.TEXTURE_2D, null),
                e && (t.bindTexture(t.TEXTURE_2D_ARRAY, null),
                t.bindTexture(t.TEXTURE_3D, null),
                t.bindSampler(r, null));
            if (t.activeTexture(t.TEXTURE0),
            t.useProgram(null),
            t.bindBuffer(t.ARRAY_BUFFER, null),
            t.bindBuffer(t.ELEMENT_ARRAY_BUFFER, null),
            t.bindFramebuffer(t.FRAMEBUFFER, null),
            t.bindRenderbuffer(t.RENDERBUFFER, null),
            t.disable(t.BLEND),
            t.disable(t.CULL_FACE),
            t.disable(t.DEPTH_TEST),
            t.disable(t.DITHER),
            t.disable(t.SCISSOR_TEST),
            t.blendColor(0, 0, 0, 0),
            t.blendEquation(t.FUNC_ADD),
            t.blendFunc(t.ONE, t.ZERO),
            t.clearColor(0, 0, 0, 0),
            t.clearDepth(1),
            t.clearStencil(-1),
            t.colorMask(!0, !0, !0, !0),
            t.cullFace(t.BACK),
            t.depthFunc(t.LESS),
            t.depthMask(!0),
            t.depthRange(0, 1),
            t.frontFace(t.CCW),
            t.hint(t.GENERATE_MIPMAP_HINT, t.DONT_CARE),
            t.lineWidth(1),
            t.pixelStorei(t.PACK_ALIGNMENT, 4),
            t.pixelStorei(t.UNPACK_ALIGNMENT, 4),
            t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL, !1),
            t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !1),
            t.UNPACK_COLORSPACE_CONVERSION_WEBGL && t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL, t.BROWSER_DEFAULT_WEBGL),
            t.polygonOffset(0, 0),
            t.sampleCoverage(1, !1),
            t.scissor(0, 0, t.canvas.width, t.canvas.height),
            t.stencilFunc(t.ALWAYS, 0, 4294967295),
            t.stencilMask(4294967295),
            t.stencilOp(t.KEEP, t.KEEP, t.KEEP),
            t.viewport(0, 0, t.canvas.width, t.canvas.height),
            t.clear(t.COLOR_BUFFER_BIT | t.DEPTH_BUFFER_BIT | t.STENCIL_BUFFER_BIT),
            e) {
                t.drawBuffers([t.BACK]),
                t.readBuffer(t.BACK),
                t.bindBuffer(t.COPY_READ_BUFFER, null),
                t.bindBuffer(t.COPY_WRITE_BUFFER, null),
                t.bindBuffer(t.PIXEL_PACK_BUFFER, null),
                t.bindBuffer(t.PIXEL_UNPACK_BUFFER, null);
                for (var s = t.getParameter(t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS), r = 0; r < s; ++r)
                    t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER, r, null);
                for (var o = t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS), r = 0; r < o; ++r)
                    t.bindBufferBase(t.UNIFORM_BUFFER, r, null);
                t.disable(t.RASTERIZER_DISCARD),
                t.pixelStorei(t.UNPACK_IMAGE_HEIGHT, 0),
                t.pixelStorei(t.UNPACK_SKIP_IMAGES, 0),
                t.pixelStorei(t.UNPACK_ROW_LENGTH, 0),
                t.pixelStorei(t.UNPACK_SKIP_ROWS, 0),
                t.pixelStorei(t.UNPACK_SKIP_PIXELS, 0),
                t.pixelStorei(t.PACK_ROW_LENGTH, 0),
                t.pixelStorei(t.PACK_SKIP_ROWS, 0),
                t.pixelStorei(t.PACK_SKIP_PIXELS, 0),
                t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT, t.DONT_CARE)
            }
            for (; t.getError(); )
                ;
        }
        function u(t) {
            function e(t) {
                return "function" == typeof t ? t : function(e) {
                    t.handleEvent(e)
                }
            }
            function i() {
                for (var t = Object.keys(S), e = 0; e < t.length; ++e)
                    delete S[t[e]]
            }
            function n() {
                ++b,
                m || _ == b && t.loseContext()
            }
            function r(t, e) {
                var i = t[e];
                return function() {
                    if (n(),
                    !m) {
                        return i.apply(t, arguments)
                    }
                }
            }
            function a() {
                for (var t = 0; t < v.length; ++t) {
                    var e = v[t];
                    e instanceof WebGLBuffer ? h.deleteBuffer(e) : e instanceof WebGLFramebuffer ? h.deleteFramebuffer(e) : e instanceof WebGLProgram ? h.deleteProgram(e) : e instanceof WebGLRenderbuffer ? h.deleteRenderbuffer(e) : e instanceof WebGLShader ? h.deleteShader(e) : e instanceof WebGLTexture ? h.deleteTexture(e) : d && (e instanceof WebGLQuery ? h.deleteQuery(e) : e instanceof WebGLSampler ? h.deleteSampler(e) : e instanceof WebGLSync ? h.deleteSync(e) : e instanceof WebGLTransformFeedback ? h.deleteTransformFeedback(e) : e instanceof WebGLVertexArrayObject && h.deleteVertexArray(e))
                }
            }
            function o(t) {
                return {
                    statusMessage: t,
                    preventDefault: function() {
                        x = !0
                    }
                }
            }
            function u(t) {
                for (var e in t)
                    "function" == typeof t[e] ? c[e] = r(t, e) : s(c, t, e);
                c.getError = function() {
                    if (n(),
                    !m)
                        for (var t; t = h.getError(); )
                            S[t] = !0;
                    for (var t in S)
                        if (S[t])
                            return delete S[t],
                            t;
                    return c.NO_ERROR
                }
                ;
                var i = ["createBuffer", "createFramebuffer", "createProgram", "createRenderbuffer", "createShader", "createTexture"];
                d && i.push("createQuery", "createSampler", "fenceSync", "createTransformFeedback", "createVertexArray");
                for (var a = 0; a < i.length; ++a) {
                    var o = i[a];
                    c[o] = function(e) {
                        return function() {
                            if (n(),
                            m)
                                return null;
                            var i = e.apply(t, arguments);
                            return i.__webglDebugContextLostId__ = g,
                            v.push(i),
                            i
                        }
                    }(t[o])
                }
                var l = ["getActiveAttrib", "getActiveUniform", "getBufferParameter", "getContextAttributes", "getAttachedShaders", "getFramebufferAttachmentParameter", "getParameter", "getProgramParameter", "getProgramInfoLog", "getRenderbufferParameter", "getShaderParameter", "getShaderInfoLog", "getShaderSource", "getTexParameter", "getUniform", "getUniformLocation", "getVertexAttrib"];
                d && l.push("getInternalformatParameter", "getQuery", "getQueryParameter", "getSamplerParameter", "getSyncParameter", "getTransformFeedbackVarying", "getIndexedParameter", "getUniformIndices", "getActiveUniforms", "getActiveUniformBlockParameter", "getActiveUniformBlockName");
                for (var a = 0; a < l.length; ++a) {
                    var o = l[a];
                    c[o] = function(e) {
                        return function() {
                            return n(),
                            m ? null : e.apply(t, arguments)
                        }
                    }(c[o])
                }
                var u = ["isBuffer", "isEnabled", "isFramebuffer", "isProgram", "isRenderbuffer", "isShader", "isTexture"];
                d && u.push("isQuery", "isSampler", "isSync", "isTransformFeedback", "isVertexArray");
                for (var a = 0; a < u.length; ++a) {
                    var o = u[a];
                    c[o] = function(e) {
                        return function() {
                            return n(),
                            !m && e.apply(t, arguments)
                        }
                    }(c[o])
                }
                return c.checkFramebufferStatus = function(e) {
                    return function() {
                        return n(),
                        m ? c.FRAMEBUFFER_UNSUPPORTED : e.apply(t, arguments)
                    }
                }(c.checkFramebufferStatus),
                c.getAttribLocation = function(e) {
                    return function() {
                        return n(),
                        m ? -1 : e.apply(t, arguments)
                    }
                }(c.getAttribLocation),
                c.getVertexAttribOffset = function(e) {
                    return function() {
                        return n(),
                        m ? 0 : e.apply(t, arguments)
                    }
                }(c.getVertexAttribOffset),
                c.isContextLost = function() {
                    return m
                }
                ,
                d && (c.getFragDataLocation = function(e) {
                    return function() {
                        return n(),
                        m ? -1 : e.apply(t, arguments)
                    }
                }(c.getFragDataLocation),
                c.clientWaitSync = function(e) {
                    return function() {
                        return n(),
                        m ? c.WAIT_FAILED : e.apply(t, arguments)
                    }
                }(c.clientWaitSync),
                c.getUniformBlockIndex = function(e) {
                    return function() {
                        return n(),
                        m ? c.INVALID_INDEX : e.apply(t, arguments)
                    }
                }(c.getUniformBlockIndex)),
                c
            }
            var h, c, d, p = [], f = [], c = {}, g = 1, m = !1, v = [], _ = 0, b = 0, x = !1, y = 0, S = {};
            t.getContext = function(e) {
                return function() {
                    var i = e.apply(t, arguments);
                    if (i instanceof WebGLRenderingContext || window.WebGL2RenderingContext && i instanceof WebGL2RenderingContext) {
                        if (i != h) {
                            if (h)
                                throw "got different context";
                            d = window.WebGL2RenderingContext && i instanceof WebGL2RenderingContext,
                            h = i,
                            c = u(h)
                        }
                        return c
                    }
                    return i
                }
            }(t.getContext);
            var w = function(t) {
                p.push(e(t))
            }
              , C = function(t) {
                f.push(e(t))
            };
            return function(t) {
                var e = t.addEventListener;
                t.addEventListener = function(i, n, r) {
                    switch (i) {
                    case "webglcontextlost":
                        w(n);
                        break;
                    case "webglcontextrestored":
                        C(n);
                        break;
                    default:
                        e.apply(t, arguments)
                    }
                }
            }(t),
            t.loseContext = function() {
                if (!m) {
                    for (m = !0,
                    _ = 0,
                    ++g; h.getError(); )
                        ;
                    i(),
                    S[h.CONTEXT_LOST_WEBGL] = !0;
                    var e = o("context lost")
                      , n = p.slice();
                    setTimeout(function() {
                        for (var i = 0; i < n.length; ++i)
                            n[i](e);
                        y >= 0 && setTimeout(function() {
                            t.restoreContext()
                        }, y)
                    }, 0)
                }
            }
            ,
            t.restoreContext = function() {
                m && f.length && setTimeout(function() {
                    if (!x)
                        throw "can not restore. webglcontestlost listener did not call event.preventDefault";
                    a(),
                    l(h),
                    m = !1,
                    b = 0,
                    x = !1;
                    for (var t = f.slice(), e = o("context restored"), i = 0; i < t.length; ++i)
                        t[i](e)
                }, 0)
            }
            ,
            t.loseContextInNCalls = function(t) {
                if (m)
                    throw "You can not ask a lost contet to be lost";
                _ = b + t
            }
            ,
            t.getNumCalls = function() {
                return b
            }
            ,
            t.setRestoreTimeout = function(t) {
                y = t
            }
            ,
            t
        }
        var h = function(t) {
            window.console && window.console.log && window.console.log(t)
        }
          , c = function(t) {
            window.console && window.console.error ? window.console.error(t) : h(t)
        }
          , d = {
            enable: {
                1: {
                    0: !0
                }
            },
            disable: {
                1: {
                    0: !0
                }
            },
            getParameter: {
                1: {
                    0: !0
                }
            },
            drawArrays: {
                3: {
                    0: !0
                }
            },
            drawElements: {
                4: {
                    0: !0,
                    2: !0
                }
            },
            createShader: {
                1: {
                    0: !0
                }
            },
            getShaderParameter: {
                2: {
                    1: !0
                }
            },
            getProgramParameter: {
                2: {
                    1: !0
                }
            },
            getShaderPrecisionFormat: {
                2: {
                    0: !0,
                    1: !0
                }
            },
            getVertexAttrib: {
                2: {
                    1: !0
                }
            },
            vertexAttribPointer: {
                6: {
                    2: !0
                }
            },
            bindTexture: {
                2: {
                    0: !0
                }
            },
            activeTexture: {
                1: {
                    0: !0
                }
            },
            getTexParameter: {
                2: {
                    0: !0,
                    1: !0
                }
            },
            texParameterf: {
                3: {
                    0: !0,
                    1: !0
                }
            },
            texParameteri: {
                3: {
                    0: !0,
                    1: !0,
                    2: !0
                }
            },
            copyTexImage2D: {
                8: {
                    0: !0,
                    2: !0
                }
            },
            copyTexSubImage2D: {
                8: {
                    0: !0
                }
            },
            generateMipmap: {
                1: {
                    0: !0
                }
            },
            bindBuffer: {
                2: {
                    0: !0
                }
            },
            getBufferParameter: {
                2: {
                    0: !0,
                    1: !0
                }
            },
            pixelStorei: {
                2: {
                    0: !0,
                    1: !0
                }
            },
            bindRenderbuffer: {
                2: {
                    0: !0
                }
            },
            bindFramebuffer: {
                2: {
                    0: !0
                }
            },
            checkFramebufferStatus: {
                1: {
                    0: !0
                }
            },
            framebufferRenderbuffer: {
                4: {
                    0: !0,
                    1: !0,
                    2: !0
                }
            },
            framebufferTexture2D: {
                5: {
                    0: !0,
                    1: !0,
                    2: !0
                }
            },
            getFramebufferAttachmentParameter: {
                3: {
                    0: !0,
                    1: !0,
                    2: !0
                }
            },
            getRenderbufferParameter: {
                2: {
                    0: !0,
                    1: !0
                }
            },
            renderbufferStorage: {
                4: {
                    0: !0,
                    1: !0
                }
            },
            clear: {
                1: {
                    0: {
                        enumBitwiseOr: ["COLOR_BUFFER_BIT", "DEPTH_BUFFER_BIT", "STENCIL_BUFFER_BIT"]
                    }
                }
            },
            depthFunc: {
                1: {
                    0: !0
                }
            },
            blendFunc: {
                2: {
                    0: !0,
                    1: !0
                }
            },
            blendFuncSeparate: {
                4: {
                    0: !0,
                    1: !0,
                    2: !0,
                    3: !0
                }
            },
            blendEquation: {
                1: {
                    0: !0
                }
            },
            blendEquationSeparate: {
                2: {
                    0: !0,
                    1: !0
                }
            },
            stencilFunc: {
                3: {
                    0: !0
                }
            },
            stencilFuncSeparate: {
                4: {
                    0: !0,
                    1: !0
                }
            },
            stencilMaskSeparate: {
                2: {
                    0: !0
                }
            },
            stencilOp: {
                3: {
                    0: !0,
                    1: !0,
                    2: !0
                }
            },
            stencilOpSeparate: {
                4: {
                    0: !0,
                    1: !0,
                    2: !0,
                    3: !0
                }
            },
            cullFace: {
                1: {
                    0: !0
                }
            },
            frontFace: {
                1: {
                    0: !0
                }
            },
            drawArraysInstancedANGLE: {
                4: {
                    0: !0
                }
            },
            drawElementsInstancedANGLE: {
                5: {
                    0: !0,
                    2: !0
                }
            },
            blendEquationEXT: {
                1: {
                    0: !0
                }
            },
            bufferData: {
                3: {
                    0: !0,
                    2: !0
                },
                4: {
                    0: !0,
                    2: !0
                },
                5: {
                    0: !0,
                    2: !0
                }
            },
            bufferSubData: {
                3: {
                    0: !0
                },
                4: {
                    0: !0
                },
                5: {
                    0: !0
                }
            },
            copyBufferSubData: {
                5: {
                    0: !0,
                    1: !0
                }
            },
            getBufferSubData: {
                3: {
                    0: !0
                },
                4: {
                    0: !0
                },
                5: {
                    0: !0
                }
            },
            blitFramebuffer: {
                10: {
                    8: {
                        enumBitwiseOr: ["COLOR_BUFFER_BIT", "DEPTH_BUFFER_BIT", "STENCIL_BUFFER_BIT"]
                    },
                    9: !0
                }
            },
            framebufferTextureLayer: {
                5: {
                    0: !0,
                    1: !0
                }
            },
            invalidateFramebuffer: {
                2: {
                    0: !0
                }
            },
            invalidateSubFramebuffer: {
                6: {
                    0: !0
                }
            },
            readBuffer: {
                1: {
                    0: !0
                }
            },
            getInternalformatParameter: {
                3: {
                    0: !0,
                    1: !0,
                    2: !0
                }
            },
            renderbufferStorageMultisample: {
                5: {
                    0: !0,
                    2: !0
                }
            },
            texStorage2D: {
                5: {
                    0: !0,
                    2: !0
                }
            },
            texStorage3D: {
                6: {
                    0: !0,
                    2: !0
                }
            },
            texImage2D: {
                9: {
                    0: !0,
                    2: !0,
                    6: !0,
                    7: !0
                },
                6: {
                    0: !0,
                    2: !0,
                    3: !0,
                    4: !0
                },
                10: {
                    0: !0,
                    2: !0,
                    6: !0,
                    7: !0
                }
            },
            texImage3D: {
                10: {
                    0: !0,
                    2: !0,
                    7: !0,
                    8: !0
                },
                11: {
                    0: !0,
                    2: !0,
                    7: !0,
                    8: !0
                }
            },
            texSubImage2D: {
                9: {
                    0: !0,
                    6: !0,
                    7: !0
                },
                7: {
                    0: !0,
                    4: !0,
                    5: !0
                },
                10: {
                    0: !0,
                    6: !0,
                    7: !0
                }
            },
            texSubImage3D: {
                11: {
                    0: !0,
                    8: !0,
                    9: !0
                },
                12: {
                    0: !0,
                    8: !0,
                    9: !0
                }
            },
            copyTexSubImage3D: {
                9: {
                    0: !0
                }
            },
            compressedTexImage2D: {
                7: {
                    0: !0,
                    2: !0
                },
                8: {
                    0: !0,
                    2: !0
                },
                9: {
                    0: !0,
                    2: !0
                }
            },
            compressedTexImage3D: {
                8: {
                    0: !0,
                    2: !0
                },
                9: {
                    0: !0,
                    2: !0
                },
                10: {
                    0: !0,
                    2: !0
                }
            },
            compressedTexSubImage2D: {
                8: {
                    0: !0,
                    6: !0
                },
                9: {
                    0: !0,
                    6: !0
                },
                10: {
                    0: !0,
                    6: !0
                }
            },
            compressedTexSubImage3D: {
                10: {
                    0: !0,
                    8: !0
                },
                11: {
                    0: !0,
                    8: !0
                },
                12: {
                    0: !0,
                    8: !0
                }
            },
            vertexAttribIPointer: {
                5: {
                    2: !0
                }
            },
            drawArraysInstanced: {
                4: {
                    0: !0
                }
            },
            drawElementsInstanced: {
                5: {
                    0: !0,
                    2: !0
                }
            },
            drawRangeElements: {
                6: {
                    0: !0,
                    4: !0
                }
            },
            readPixels: {
                7: {
                    4: !0,
                    5: !0
                },
                8: {
                    4: !0,
                    5: !0
                }
            },
            clearBufferfv: {
                3: {
                    0: !0
                },
                4: {
                    0: !0
                }
            },
            clearBufferiv: {
                3: {
                    0: !0
                },
                4: {
                    0: !0
                }
            },
            clearBufferuiv: {
                3: {
                    0: !0
                },
                4: {
                    0: !0
                }
            },
            clearBufferfi: {
                4: {
                    0: !0
                }
            },
            beginQuery: {
                2: {
                    0: !0
                }
            },
            endQuery: {
                1: {
                    0: !0
                }
            },
            getQuery: {
                2: {
                    0: !0,
                    1: !0
                }
            },
            getQueryParameter: {
                2: {
                    1: !0
                }
            },
            samplerParameteri: {
                3: {
                    1: !0,
                    2: !0
                }
            },
            samplerParameterf: {
                3: {
                    1: !0
                }
            },
            getSamplerParameter: {
                2: {
                    1: !0
                }
            },
            fenceSync: {
                2: {
                    0: !0,
                    1: {
                        enumBitwiseOr: []
                    }
                }
            },
            clientWaitSync: {
                3: {
                    1: {
                        enumBitwiseOr: ["SYNC_FLUSH_COMMANDS_BIT"]
                    }
                }
            },
            waitSync: {
                3: {
                    1: {
                        enumBitwiseOr: []
                    }
                }
            },
            getSyncParameter: {
                2: {
                    1: !0
                }
            },
            bindTransformFeedback: {
                2: {
                    0: !0
                }
            },
            beginTransformFeedback: {
                1: {
                    0: !0
                }
            },
            transformFeedbackVaryings: {
                3: {
                    2: !0
                }
            },
            bindBufferBase: {
                3: {
                    0: !0
                }
            },
            bindBufferRange: {
                5: {
                    0: !0
                }
            },
            getIndexedParameter: {
                2: {
                    0: !0
                }
            },
            getActiveUniforms: {
                3: {
                    2: !0
                }
            },
            getActiveUniformBlockParameter: {
                3: {
                    2: !0
                }
            }
        }
          , p = null
          , f = null;
        return {
            init: t,
            mightBeEnum: i,
            glEnumToString: n,
            glFunctionArgToString: r,
            glFunctionArgsToString: a,
            makeDebugContext: o,
            makeLostContextSimulatingCanvas: u,
            resetToInitialState: l
        }
    }());
    t.exports = n
}
, function(t, e, i) {
    "use strict";
    var n = i(468)
      , r = i(669)
      , a = i(670)
      , s = {};
    s.osg = n,
    s.osgAnimation = r,
    s.osgText = a,
    t.exports = s
}
, , , , , , , , , , , function(t, e, i) {
    "use strict";
    var n = i(910)
      , r = i(42)
      , a = i(21);
    e.a = r.a.extend({
        comparator: "order",
        model: n.a,
        _trashbin: [],
        url: function() {
            return "/i/models/" + this.options.filters.get("modelUID") + "/animations" + a.a.craft("?", {})
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(42)
      , r = i(912);
    e.a = n.a.extend({
        model: r.a,
        parse: function(t) {
            return t.results.images
        },
        url: function() {
            return "/i/models/" + this.options.uid + "/fallback"
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(544)
      , r = i(42);
    e.a = r.a.extend({
        comparator: "order",
        model: n.a
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(2)
      , s = i.n(a)
      , o = i(15);
    e.a = o.a.extend({
        defaults: {
            name: "",
            uid: "",
            duration: 0,
            isLoop: !1,
            isEnabled: !0
        },
        url: function() {
            return "/i/animations/" + this.get("uid")
        },
        save: function(t, e) {
            var i = new FormData;
            i.append("name", this.get("name")),
            i.append("isLoop", this.get("isLoop")),
            i.append("isEnabled", this.get("isEnabled"));
            var n = s.a.ajax({
                type: "PATCH",
                url: this.url(),
                data: i,
                cache: !1,
                contentType: !1,
                processData: !1
            });
            return r.a.resolve(n)
        }
    })
}
, , function(t, e, i) {
    "use strict";
    var n = i(15);
    e.a = n.a.extend({})
}
, , function(t, e, i) {
    "use strict";
    var n = i(15);
    e.a = n.a.extend({})
}
, function(t, e, i) {
    "use strict";
    var n = i(15);
    e.a = n.a.extend({})
}
, function(t, e, i) {
    "use strict";
    var n = i(15);
    e.a = n.a.extend({})
}
, function(t, e, i) {
    "use strict";
    var n = i(15);
    e.a = n.a.extend({})
}
, function(t, e, i) {
    "use strict";
    var n = i(15);
    e.a = n.a.extend({})
}
, , , , function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(169)
      , s = i.n(a)
      , o = i(90)
      , l = i(548)
      , u = i(43)
      , h = i(471)
      , c = i(89)
      , d = i(675)
      , p = i(943)
      , f = i(70)
      , g = i(87)
      , m = i(29)
      , v = i(680)
      , _ = i(293)
      , b = i(676)
      , x = i(694)
      , y = i(161)
      , S = i(146)
      , w = i(446)
      , C = i(441)
      , M = r.a.osg
      , T = r.a.osgUtil
      , A = function(t, e) {
        this._viewerWebGL = t,
        this._viewerOSGJS = t.getViewerOSGJS(),
        this._urlOptions = t.options,
        this._features = t.getFeatures(),
        this._context = e,
        this._canvas = t.getCanvas(),
        this._nodeGizmo = null,
        this._mouseKeyboard = this._viewerOSGJS.getEventProxy().StandardMouseKeyboard;
        var i = this.onPointerUp.bind(this);
        window.addEventListener("touchend", i, !0),
        window.addEventListener("touchcancel", i, !0),
        window.addEventListener("mouseup", i, !0),
        window.addEventListener("mouseout", i, !0),
        u.a.getHasAnimation().then(function(t) {
            t && (this._hasAnimation = t)
        }
        .bind(this))
    };
    A.prototype = {
        getFeatures: function() {
            return this._features
        },
        getCanvas: function() {
            return this._canvas
        },
        getViewerWebGL: function() {
            return this._viewerWebGL
        },
        getViewerOSGJS: function() {
            return this._viewerOSGJS
        },
        getResourceManager: function() {
            return this._resourceManager || c.default.instance
        },
        onPointerUp: function() {
            this._mouseKeyboard.setEnable(!0)
        },
        focusOnTargetAndEye: function() {
            var t = M.vec3.create();
            return function(e, i, n, r) {
                var a = this._viewerOSGJS.getManipulator();
                if (!n || n < 0)
                    return void a.setTargetAndEye(e, i);
                var s = this._features.cameraAnimation.getModel();
                e || (e = a.getTarget(t)),
                i || (i = a.getEyePosition(t)),
                s.setTargetAndEye(e, i, r),
                s.set("duration", n)
            }
        }(),
        focusOnHomePosition: function(t) {
            var e = this._features
              , i = e.manipulator
              , n = e.cameraAnimation;
            if (i && i.getModel() && n) {
                var r = i.getManipulator().getCurrentManipulator()
                  , a = r.getHomeBound()
                  , s = a.center()
                  , o = r.getEyePosition(M.vec3.create());
                M.vec3.sub(o, s, o),
                M.vec3.normalize(o, o),
                M.vec3.scale(o, o, r.getHomeDistance(a)),
                M.vec3.sub(o, s, o),
                this.focusOnTargetAndEye(s, o, t)
            }
        },
        focusOnSavedCamera: function(t) {
            var e = this._context.getModel().get("options")
              , n = i.i(m.a)()
              , r = this._viewerOSGJS.getManipulator()
              , a = n.cameraTarget || e.camera.target
              , s = n.cameraEye || e.camera.position
              , o = s && null !== s[0];
            return o ? o && !this._features.manipulator.getModel().validateEyeTarget(s, a) ? r.computeHomePosition() : void this.focusOnTargetAndEye(a, s, t) : r.computeHomePosition()
        },
        updateFocusOnAutoHit: function() {
            if (!this._autoHit.get("focus"))
                return !0;
            var t = i.i(C.a)(this._autoHit, this._features.hotspot.getNode())
              , e = this._features.cameraAnimation.getModel()
              , n = this._features.manipulator.getManipulator().getCurrentManipulator()
              , r = n.getEyePosition(M.vec3.create())
              , a = n.getTarget(M.vec3.create())
              , s = M.vec3.create()
              , o = M.vec3.create();
            return 1 === i.i(m.a)().cameraFollowBones ? (M.vec3.sub(o, t, a),
            M.vec3.add(s, r, o),
            M.vec3.copy(o, t)) : (M.vec3.sub(s, t, r),
            M.vec3.normalize(s, s),
            M.vec3.scale(s, s, M.vec3.dist(r, a)),
            M.vec3.sub(s, t, s),
            M.vec3.copy(o, t)),
            M.vec3.lerp(o, a, o, .25),
            M.vec3.lerp(s, r, s, .25),
            e.setTargetAndEye(o, s),
            e.set("duration", 0),
            !0
        },
        setInitialAnimation: function() {
            if (this._features.cameraAnimation) {
                var t = i.i(m.a)().camera;
                if (void 0 !== t && !1 === t)
                    return void u.a.resolveFirstCameraAnimation();
                var e = M.vec3.create()
                  , n = M.vec3.create()
                  , r = this._viewerOSGJS.getManipulator();
                r.getEyePosition(n),
                r.getTarget(e);
                var a = [e[0] - n[0], e[1] - n[1], 0]
                  , s = a[0] > a[1] ? 0 : 1
                  , o = 0 === s ? 1 : 0
                  , l = M.vec3.create();
                l[o] = 1;
                var h = a[s] < 0 ? -1 : 1;
                l[2] = .2 * h;
                var c = 1.5 * r.getNode().getMinimumBound().radius();
                M.vec3.scale(l, l, 10 * c * h);
                var d = M.vec3.add(M.vec3.create(), n, l);
                r.setEyePosition(d),
                this.focusOnTargetAndEye(e, n, 2.5);
                var p = this._features.autospin;
                if (p) {
                    var f = p.getModel();
                    f.set("speed", -f.get("speed") * h)
                }
            }
        },
        linkAutospinWithEvents: function() {
            var t = this._features
              , e = t.autospin
              , i = t.manipulator
              , n = i ? i.getModel() : void 0
              , r = e.getModel()
              , a = 0
              , s = function() {
                clearTimeout(a),
                r.set("paused", !0)
            }
              , o = function() {
                !0 == (void 0 === n || n.get("indexManipulator") === l.a.ORBIT) && (a = setTimeout(function() {
                    r.set("paused", !1)
                }, 12500))
            }
              , u = this._canvas;
            if (u.addEventListener("mousedown", s),
            u.addEventListener("touchstart", s),
            u.addEventListener("dragstart", s),
            u.addEventListener("mouseup", o),
            u.addEventListener("mouseout", o),
            u.addEventListener("touchend", o),
            u.addEventListener("touchcancel", o),
            u.addEventListener("touchleave", o),
            u.addEventListener("dragend", o),
            i) {
                var h = function() {
                    clearTimeout(a),
                    r.set("paused", n.get("indexManipulator") !== l.a.ORBIT)
                };
                n.bind("change:indexManipulator", h),
                h()
            }
        },
        linkSelectMaterialUI: function(t) {
            var e = this._features
              , i = e.materialUI
              , n = e.cameraAnimation
              , r = e.outline;
            if (i) {
                var a = function(t) {
                    M.NodeVisitor.call(this),
                    this._stateSet = t,
                    this._pushIfGeo = !1,
                    this._paths = []
                };
                a.prototype = M.objectInherit(M.NodeVisitor.prototype, {
                    apply: function(t) {
                        var e = t.getStateSet()
                          , i = this._pushIfGeo;
                        e && void 0 !== e._materialID && (this._pushIfGeo = e === this._stateSet),
                        t instanceof M.Geometry && this._pushIfGeo && this._paths.push(this.nodePath.slice(0)),
                        this.traverse(t),
                        this._pushIfGeo = i
                    }
                });
                var s = function(e) {
                    var i = new a(e);
                    t.accept(i);
                    var s = i._paths;
                    if (0 === s.length)
                        return void M.error("Cound not find nodes attached to the stateset.");
                    for (var o = t.getParents()[0].getWorldMatrices()[0], l = M.vec3.create(), u = M.vec3.create(), h = 0, c = s.length; h < c; ++h) {
                        var d = s[h]
                          , p = d[d.length - 1].getMinimumBound().center();
                        M.vec3.transformMat4(u, p, M.computeLocalToWorld(d)),
                        M.vec3.transformMat4(u, u, o),
                        M.vec3.add(l, u, l)
                    }
                    if (M.vec3.scale(l, l, 1 / c),
                    n && this.focusOnTargetAndEye(l, void 0, 2),
                    r) {
                        var f = r.getNode();
                        f.setScene(s),
                        f.showOutline()
                    }
                }
                .bind(this);
                i.getModel().bind("displayOutline", s)
            }
        },
        initEventsOnClick: function() {
            var t = new s.a.Manager(this.getCanvas());
            t.add(new s.a.Tap({
                event: "doubletap",
                pointers: 1,
                taps: 2,
                time: 250,
                interval: 450,
                threshold: 5,
                posThreshold: 50
            })),
            t.add(new s.a.Tap({
                event: "doubletap2fingers",
                pointers: 2,
                taps: 2,
                time: 250,
                interval: 450,
                threshold: 5,
                posThreshold: 50
            })),
            t.add(new s.a.Tap({
                event: "singletap",
                pointers: 1,
                taps: 1,
                time: 250,
                interval: 450,
                threshold: 5,
                posThreshold: 20
            })),
            t.on("doubletap", this.onDoubleClick.bind(this)),
            t.on("doubletap2fingers", this.onDoubleClick.bind(this)),
            t.on("singletap", this.onSingleClick.bind(this))
        },
        focusOnHit: function(t, e, i) {
            var n = M.vec3.create();
            this.getWorldPositionFromHit(t, n);
            var r = this._features.cameraAnimation.getModel()
              , a = this._features.manipulator.getManipulator().getCurrentManipulator()
              , s = a.getEyePosition(M.vec3.create())
              , o = a.getHomeDistance(a.getHomeBound())
              , l = M.vec3.dist(n, s)
              , u = i * o;
            l > u && (M.vec3.sub(s, n, s),
            M.vec3.normalize(s, s),
            M.vec3.scale(s, s, u),
            M.vec3.sub(s, n, s)),
            r.setTargetAndEye(n, s, !0),
            r.set("duration", e)
        },
        onSingleClick: function() {
            var t = M.vec3.create()
              , e = M.vec3.create()
              , n = M.vec2.create();
            return function(r) {
                var a = this._features.postProcess
                  , s = a ? a.getModel() : void 0
                  , o = s && s.get("enable") && s.get("dofEnable")
                  , l = this._viewerWebGL.getViewerAPI();
                if (l || o) {
                    var u = i.i(x.a)(r)
                      , h = u[0]
                      , c = u[1]
                      , d = this.computeNearestIntersection2D(h, c);
                    if (d) {
                        var p = o ? s.get("dofFocusPoint") : e
                          , f = l && l.intersectPoint ? t : void 0;
                        this.getWorldPositionFromHit(d, p, f),
                        l && l.intersectPoint && (n[0] = h,
                        n[1] = c,
                        l.intersectPoint(d, p, n, f)),
                        o && s.trigger("change:dofFocusPoint", p)
                    }
                }
            }
        }(),
        onDoubleClick: function(t) {
            if (i.i(m.a)().doubleClick) {
                var e = this._features.manipulator;
                if (!e || !e.getModel().get("webVR")) {
                    if (this._autoHit && this._autoHit.get("focus") && this._autoHit.set("focus", !1),
                    t.pointers.length > 1)
                        return void this.focusOnHomePosition(1);
                    var n = i.i(x.a)(t)
                      , r = n[0]
                      , a = n[1]
                      , s = this.computeNearestIntersection2D(r, a);
                    if (!s)
                        return void this.focusOnHomePosition(1);
                    if (this._urlOptions.widgetAPI) {
                        var o = this._urlOptions.widgetAPI.getTabbedWidget().get();
                        if ("virtual reality" === o)
                            return void this._features.webVR.getModel().trigger("doubleTap", s);
                        if ("materials" === o) {
                            var l = this._features.material.getModel()
                              , u = l.findFirstMaterial(s.nodepath);
                            if (!u)
                                return;
                            var c = u.get("id");
                            return void (l.uiModel.get("material") === c ? l.trigger("displayOutline", u.get("stateSet")) : l.uiModel.set("material", c))
                        }
                        if ("annotations" === o || "sound" === o)
                            return
                    }
                    i.i(m.a)().cameraFollowBones && i.i(h.a)(s.nodepath) ? (this._features.hotspot.getModel().updateHotspotHit(this._autoHit, s),
                    this._autoHit.set("focus", !0)) : this.focusOnHit(s, 1, .2)
                }
            }
        },
        canvasCoordToGL: function(t, e, i) {
            var n = this._canvas
              , r = i || M.vec2.create()
              , a = this._viewerOSGJS.getCanvasPixelRatio();
            return r[0] = t * a,
            r[1] = (n.clientHeight - e) * (this._viewerOSGJS.getCanvasHeight() / n.clientHeight),
            r
        },
        glCoordToCanvas: function(t, e, i) {
            var n = this._canvas
              , r = i || M.vec2.create()
              , a = this._viewerOSGJS.getCanvasPixelRatio();
            return r[0] = t / a,
            r[1] = n.clientHeight - e / a,
            r
        },
        computeIntersections3DPolytope: function() {
            var t = new T.PolytopeIntersector;
            t.setDimensionMask(T.PolytopeIntersector.DimZero);
            var e = M.vec3.create()
              , i = M.vec3.create()
              , n = M.vec3.create()
              , r = M.vec3.create()
              , a = M.mat4.create()
              , s = [M.vec4.create(), M.vec4.create(), M.vec4.create(), M.vec4.create(), M.vec4.create(), M.vec4.create()];
            return function(o, l, u, h) {
                M.vec3.sub(n, l, o),
                M.vec3.normalize(n, n),
                M.vec3.set(r, Math.random(), Math.random(), Math.random()),
                M.vec3.cross(e, n, r),
                M.vec3.cross(i, n, e),
                M.vec3.normalize(e, e),
                M.vec3.normalize(i, i);
                var c = .005 * S.a.getModelBoxWithoutDisplacement().radius()
                  , d = M.vec3.dot(M.vec3.sub(r, o, M.vec3.scale(r, e, c)), e)
                  , p = M.vec3.dot(M.vec3.add(r, o, M.vec3.scale(r, e, c)), e)
                  , f = M.vec3.dot(M.vec3.sub(r, o, M.vec3.scale(r, i, c)), i)
                  , g = M.vec3.dot(M.vec3.add(r, o, M.vec3.scale(r, i, c)), i);
                M.vec4.set(s[0], n[0], n[1], n[2], -M.vec3.dot(o, n)),
                M.vec4.set(s[1], -n[0], -n[1], -n[2], M.vec3.dot(l, n)),
                M.vec4.set(s[2], e[0], e[1], e[2], -d),
                M.vec4.set(s[3], -e[0], -e[1], -e[2], p),
                M.vec4.set(s[4], i[0], i[1], i[2], -f),
                M.vec4.set(s[5], -i[0], -i[1], -i[2], g),
                t.reset(),
                h.setIntersector(t),
                t.setPolytope(s),
                u.accept(h),
                M.vec3.sub(n, l, o);
                for (var m = t.getIntersections(), v = 0, _ = m.length; v < _; ++v) {
                    var b = m[v];
                    b.nodepath = b.nodePath,
                    b.backface = !1,
                    b.TriangleIntersection = {
                        i1: -1,
                        i2: -1,
                        i3: -1,
                        r1: 0,
                        r2: 0,
                        r3: 0,
                        normal: M.vec3.ONE
                    };
                    var x = b.point = b._points[0];
                    M.mat4.identity(a),
                    M.computeLocalToWorld(b.nodepath, !0, a),
                    M.vec3.transformMat4(x, x, a);
                    var y = M.vec3.dot(n, M.vec3.sub(x, x, o));
                    M.vec3.scaleAndAdd(x, o, n, y / M.vec3.sqrLen(n)),
                    b.ratio = M.vec3.dist(x, o),
                    M.mat4.invert(a, a),
                    M.vec3.transformMat4(x, x, a)
                }
                return m
            }
        }(),
        computeIntersections3D: function() {
            var t = new T.IntersectionVisitor
              , e = new T.LineSegmentIntersector;
            return function(i, n, r, a) {
                a || (a = this._features.webVR.getNode()),
                void 0 === r && (r = f.a.PICK_GEOMETRY_SLOW),
                t.reset(),
                e.reset();
                var s = this._features.shadingStyle;
                if (s && s.getModel().get("hasTriangles") && (t.setTraversalMask(r),
                t.setIntersector(e),
                e.set(i, n),
                a.accept(t)),
                s && s.getModel().get("hasPoints") && r & f.a.PICK_GEOMETRY_ANIMATED)
                    for (var o = this.computeIntersections3DPolytope(i, n, a, t), l = e.getIntersections(), u = 0; u < o.length; ++u)
                        l.push(o[u]);
                return e.getIntersections()
            }
        }(),
        computeNearestIntersection3D: function(t, e, i, n) {
            var r = this.computeIntersections3D(t, e, i, n);
            return this.sortIntersections(r)
        },
        computeNearestIntersection3DHotspotFirst: function(t, e, i, n) {
            var r = this.computeIntersections3D(t, e, i, n);
            if (0 !== r.length) {
                r.sort(function(t, e) {
                    return t.ratio - e.ratio
                });
                var a = 0
                  , s = r.length
                  , o = this._features.hotspot.getWidgetNode();
                for (a = 0; a < s; ++a)
                    if (-1 !== r[a].nodepath.indexOf(o))
                        return r[a];
                return this.getFirstVisibleHit(r)
            }
        },
        pickNearestSurface: function(t) {
            var e = void 0 === t.offsetX ? t.layerX : t.offsetX
              , i = void 0 === t.offsetY ? t.layerY : t.offsetY;
            return this.computeNearestIntersection2D(e, i, f.a.PICK_GEOMETRY_SLOW, this._context.getScene().getRoot())
        },
        computeIntersections2D: function() {
            var t = M.vec3.create()
              , e = M.vec3.create()
              , i = M.mat4.create();
            return function(n, r, a, s) {
                return s || (s = this._features.webVR.getNode()),
                this.canvasCoordToGL(n, r, t),
                this.canvasCoordToGL(n, r, e),
                t[2] = 0,
                e[2] = 1,
                this.getWorldPositionFromScreenPoint(t, t),
                this.getWorldPositionFromScreenPoint(e, e),
                s.getWorldMatrix(void 0, i),
                M.mat4.invert(i, i),
                M.vec3.transformMat4(t, t, i),
                M.vec3.transformMat4(e, e, i),
                this.computeIntersections3D(t, e, a, s)
            }
        }(),
        computeNearestIntersection2D: function(t, e, i, n) {
            var r = this.computeIntersections2D(t, e, i, n);
            return this.sortIntersections(r)
        },
        sortIntersections: function(t) {
            if (0 !== t.length)
                return t.sort(function(t, e) {
                    return t.ratio - e.ratio
                }),
                this.getFirstVisibleHit(t)
        },
        getFirstVisibleHit: function(t) {
            for (var e = this._features.material.getModel(), i = 0, n = t.length; i < n; ++i) {
                var a = t[i];
                if (!a.backface)
                    return a;
                var s = e.findFirstMaterial(a.nodepath);
                if (s && s.get("cullFace") === r.a.osg.CullFace.DISABLE)
                    return a
            }
        },
        getRelativePositionFromHit: function() {
            var t = M.mat4.create()
              , e = M.mat3.create();
            return function(i, n, r, a) {
                for (var s = i.nodepath, o = !1, l = 0, u = s.length; l < u; ++l)
                    if (s[l] === a) {
                        s = s.slice(l),
                        o = !0;
                        break
                    }
                return M.mat4.identity(t),
                !1 === o && s[0].getWorldMatrix(a, t),
                M.computeLocalToWorld(s, !0, t),
                M.vec3.transformMat4(n, i.point, t),
                r && (M.mat3.normalFromMat4(e, t),
                M.vec3.transformMat3(r, i.TriangleIntersection.normal, e),
                M.vec3.normalize(r, r)),
                n
            }
        }(),
        getWorldPositionFromHit: function(t, e, i) {
            return this.getRelativePositionFromHit(t, e, i, this._viewerOSGJS.getSceneData())
        },
        getScenePositionFromHit: function(t, e, i) {
            return this.getRelativePositionFromHit(t, e, i, this._context.getScene().getRoot())
        },
        getWorldPositionFromScenePoint: function(t, e) {
            var i = e || M.vec3.create()
              , n = this._features.orientation
              , r = this._features.autospin;
            return n && M.vec3.transformMat4(i, t, n.getNode().getMatrix()),
            r && M.vec3.transformMat4(i, i, r.getNode().getMatrix()),
            i
        },
        getScenePositionFromWorldPoint: function() {
            var t = M.mat4.create();
            return function(e, i) {
                var n = i || M.vec3.create()
                  , r = this._features.orientation
                  , a = this._features.autospin;
                return M.mat4.identity(t),
                r && M.mat4.multiply(t, t, r.getNode().getMatrix()),
                a && M.mat4.multiply(t, t, a.getNode().getMatrix()),
                M.mat4.invert(t, t),
                M.vec3.transformMat4(n, e, t)
            }
        }(),
        getScreenPositionFromScenePoint: function(t, e) {
            var i = this.getWorldPositionFromScenePoint(t, e);
            return this.getScreenPositionFromWorldPoint(i, i)
        },
        getScreenPositionFromWorldPoint: function() {
            var t = M.mat4.create();
            return function(e, i) {
                var n = this._viewerOSGJS.getCamera();
                M.mat4.identity(t),
                n.getViewport() && n.getViewport().computeWindowMatrix(t),
                M.mat4.multiply(t, t, n.getProjectionMatrix()),
                M.mat4.multiply(t, t, n.getViewMatrix());
                var r = i || M.vec3.create();
                return M.vec3.transformMat4(r, e, t)
            }
        }(),
        getWorldPositionFromScreenPoint: function() {
            var t = M.mat4.create();
            return function(e, i) {
                var n = this._viewerOSGJS.getCamera();
                M.mat4.identity(t),
                n.getViewport() && n.getViewport().computeWindowMatrix(t),
                M.mat4.multiply(t, t, n.getProjectionMatrix()),
                M.mat4.multiply(t, t, n.getViewMatrix()),
                M.mat4.invert(t, t);
                var r = i || M.vec3.create();
                return M.vec3.transformMat4(r, e, t)
            }
        }(),
        getScenePositionFromScreenPoint: function(t, e) {
            var i = this.getWorldPositionFromScreenPoint(t, e);
            return this.getScenePositionFromWorldPoint(i, i)
        },
        computeKdTree: function(t) {
            new M.KdTreeBuilder({
                _numVerticesProcessed: 0,
                _targetNumTrianglesPerLeaf: 50,
                _maxNumLevels: 50
            }).apply(t)
        },
        preloadMaxBackground: function() {
            var t = this._features.background;
            if (t) {
                var e = t.getModel();
                if (e && "fixed" === e.get("enable")) {
                    var i = e.getBackground();
                    if (i) {
                        var n = i.findImageNearestUpToResolution(window.screen.width, window.screen.height);
                        n && this.getResourceManager().getOrCreateTexture(n.url, {
                            minFilter: M.Texture.LINEAR_MIPMAP_LINEAR,
                            magFilter: M.Texture.LINEAR,
                            transferToGPU: !1,
                            convertNPOT: !1
                        })
                    }
                }
            }
        },
        applyAutospinToCamera: function(t, e) {
            var i = this._features.autospin;
            if (i) {
                var n = i.getNode().getMatrix();
                M.vec3.transformMat4(t, t, n),
                M.vec3.transformMat4(e, e, n)
            }
        },
        getCameraWithoutAutospin: function() {
            var t = M.mat4.create();
            return function(e, i) {
                var n = this._viewerOSGJS.getManipulator();
                n.getEyePosition(e),
                n.getTarget(i);
                var r = this._features.autospin;
                r && (M.mat4.invert(t, r.getNode().getMatrix()),
                M.vec3.transformMat4(e, e, t),
                M.vec3.transformMat4(i, i, t))
            }
        }(),
        createGizmoNode: function() {
            var t = new M.Camera;
            t.getOrCreateStateSet().setRenderBinDetails(g.a.EDITOR_GIZMO, "RenderBin");
            var e = this._nodeGizmo = new d.a(this._viewerOSGJS);
            e.setTraversalMask(f.a.PICK_GIZMO_LIGHT),
            t.addChild(e);
            var i = this._urlOptions.widgetAPI;
            if (i) {
                var n = this._features.orientation;
                i.getTabbedWidget().model.on("change:value", function() {
                    e.attachToGeometry(null),
                    n && n.getModel().set("showGizmo", !1)
                })
            }
            return t
        },
        setManipulatorNode: function(t) {
            this._features.manipulator ? this._features.manipulator.getModel().set("node", t) : this._viewerOSGJS.getManipulator().setNode(t)
        },
        getNodeGizmo: function() {
            return this._nodeGizmo
        },
        initializePreciseBoundManager: function() {
            var t = this._viewerOSGJS.getManipulator().getNode();
            S.a.computePreciseBox(t);
            var e = S.a.getModelBoxWithDisplacement();
            t.getBoundingBox().copy(e);
            var i = t.getBoundingSphere();
            i.set(e.center(i.center()), e.radius())
        },
        initGraph: function(t) {
            var e = this._features
              , i = new M.Node;
            i.getOrCreateStateSet().setAttributeAndModes(new M.CullFace(M.CullFace.DISABLE)),
            i.setName("FeatureManager - Root"),
            i.addChild(b.a.viewerInstance);
            var n = e.orientation
              , r = e.autospin
              , a = e.outline
              , s = e.cameraAnimation
              , o = e.shadingStyle
              , l = e.environment
              , u = e.lighting
              , h = e.sound
              , c = e.hotspot
              , d = e.postProcess
              , p = e.webVR
              , f = u.getNodeShadow()
              , g = i;
            d && (i.addChild(d.getNodeIn()),
            g = d.getNodeOut()),
            g.addChild(this.createGizmoNode(g)),
            g.addChild(f),
            g = f;
            for (var m = [s, l, u, h, p, r, n, c, a, o], v = 0, _ = m.length; v < _; ++v) {
                var x = m[v];
                x && (g.addChild(x.getNode()),
                g = x.getNode())
            }
            return g.addChild(t),
            i
        },
        finished: function(t) {
            var e = this._features
              , n = this._context.getScene().getRoot();
            n.setNodeMask(f.a.PICK_GEOMETRY_SHADOW),
            n.setName("rootModel"),
            w.a.setCamera(this._viewerOSGJS.getCamera()),
            n.addUpdateCallback(w.a);
            var r = this.initGraph(n);
            return t.addChild(r),
            this.setManipulatorNode(e.autospin.getNode()),
            this.preloadMaxBackground(),
            this.linkAutospinWithEvents(),
            this.linkSelectMaterialUI(n),
            e.lighting && e.lighting.getModel().initLights(e.material.getSceneLights()),
            e.environment && e.environment.getNode().init(n.getOrCreateStateSet(), this._viewerOSGJS.getCamera(), e.lighting.getNodeShadow()),
            M.time("compute KdTree"),
            this.computeKdTree(n),
            M.timeEnd("compute KdTree"),
            this.focusOnSavedCamera(),
            this._features.manipulator && this._features.manipulator.getModel().saveCameraPosition(),
            this.initEventsOnClick(),
            M.time("drawFirstFrame"),
            this._viewerWebGL.drawFrame(),
            M.timeEnd("drawFirstFrame"),
            this.initializePreciseBoundManager(),
            e.webVR && e.webVR.getModel().initAfterFirstFrame(),
            e.postProcess && e.postProcess.getModel().initAfterFirstFrame(),
            e.lighting && e.lighting.getModel().set("forceShadowRedraw", !0),
            M.time("drawSecondFrame"),
            this._viewerWebGL.drawFrame(),
            M.timeEnd("drawSecondFrame"),
            e.lighting && e.lighting.getModel().set("forceShadowRedraw", !1),
            i.i(o.a)() && (u.a.getFirstAnimation().then(function() {
                this.registerOptionsJSON(this._viewerWebGL.getOptionsJSON())
            }
            .bind(this)),
            window.addEventListener("beforeunload", this.onBeforeUnload.bind(this), !1)),
            !i.i(_.a)() && "onhashchange"in window && window.addEventListener("hashchange", this._hashChanged.bind(this), !1),
            i.i(m.a)().debug3D && i.i(p.a)(this, r),
            i.i(m.a)().cameraFollowBones && (this._autoHit = new y.a,
            r.addUpdateCallback({
                update: this.updateFocusOnAutoHit.bind(this)
            })),
            r
        },
        registerOptionsJSON: function(t) {
            this._lastOptions = i.i(n.cloneDeep)(t)
        },
        onBeforeUnload: function(t) {
            var e = this._viewerWebGL.getOptionsJSON()
              , r = i.i(n.reduce)(this._lastOptions, function(t, r, a) {
                return i.i(n.isEqual)(r, e[a]) ? t : t.concat(a)
            }, []);
            if (0 !== r.length) {
                var a = "You have unsaved changes:\n";
                return a += "- " + r.join("\n- "),
                a += "\n\nYou might want to save your changes before leaving.",
                t.returnValue = a,
                a
            }
        },
        _hashChanged: function() {
            var t = {};
            t = i.i(v.a)(t),
            this._features.material.getModel().overrideMaterialChannels(t);
            var e = i.i(m.a)();
            !e.debug3d && Boolean(t.debug3d) && (e.debug3d = !0,
            i.i(p.a)(this, this._context.getScene().getRoot())),
            !e.stats && Boolean(t.stats) && (e.continuousRender = !0,
            e.stats = !0,
            this._viewerOSGJS.initStats({
                getBoolean: function(t) {
                    return "stats" === t
                }
            }))
        },
        getShadowForcedUpdate: function() {
            var t = this._features.lighting.getModel()
              , e = t.get("forceShadowRedraw") || this._viewerWebGL.getSuperSample().isEnabled()
              , i = !!this._hasAnimation;
            return !0 === this._features.autospin.getModel().get("enable") && (i = !0),
            i || e
        }
    },
    e.a = A
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(4)
      , s = i(690)
      , o = i(1053)
      , l = i(1054)
      , u = i(1056)
      , h = i(691)
      , c = i(692)
      , d = i(1057)
      , p = i(29)
      , f = a.a.osg
      , g = a.a.osgWrappers.osg.functionSortAttributes
      , m = {
        Vertex: 1,
        Normal: 2,
        TexCoord: 4,
        Color: 8,
        Triangle: 16,
        Tangent: 32
    }
      , v = {
        quantization: 1,
        prediction: 2,
        delta: 4
    }
      , _ = {
        delta: 1,
        highWatermark: 2,
        implicit: 4
    }
      , b = function(t) {
        return -1 !== t.indexOf("TexCoord") ? m.TexCoord : m[t]
    }
      , x = function(t, e, n, r) {
        var a, s = t.vb, u = s.Offset ? s.Offset : 0, h = this.getIndices();
        a = s.Encoding && "varint" === s.Encoding ? i.i(c.a)(new Uint8Array(r,u), h.getItemSize() * s.Size, t.type) : new f[t.type](r,u,h.getItemSize() * s.Size),
        1 === a.BYTES_PER_ELEMENT && (a = new Uint16Array(a));
        var p = e.attributes
          , g = b("Triangle")
          , m = a
          , v = this.getMode() === f.PrimitiveSet.TRIANGLE_STRIP;
        if (0 == (p & g) || !v && this.getMode() !== f.PrimitiveSet.TRIANGLES)
            return a instanceof Uint16Array == !1 && (m = new Uint16Array(a.buffer,a.byteOffset,a.length),
            m.set(a)),
            h.setElements(m),
            this.setIndices(h),
            this;
        var x = e.triangle_mode
          , y = 0;
        if (x & _.implicit && v && (y = l.a.IMPLICIT_HEADER_LENGTH + a[l.a.IMPLICIT_HEADER_MASK_LENGTH],
        m = new Uint16Array(a[l.a.IMPLICIT_HEADER_PRIMITIVE_LENGTH])),
        x & _.delta && i.i(o.a)(a, y),
        x & _.implicit && v && i.i(l.a)(a, m, y, x & _.highWatermark),
        x & _.highWatermark && i.i(d.a)(m, m, n),
        m instanceof Uint16Array == !1) {
            var S = m;
            m = new Uint16Array(S.buffer,S.byteOffset,S.length),
            m.set(S)
        }
        return h.setElements(m),
        this.setIndices(h),
        this
    }
      , y = f.vec3.create()
      , S = f.vec3.create()
      , w = function(t, e, n, r, a) {
        var s = "Vertex" === r ? "vtx_" : "uv_" + r.substr(8) + "_"
          , o = t & v.quantization && void 0 !== a[s + "bbl_x"]
          , l = e instanceof Float32Array == !0;
        if (!o && l)
            return e;
        var u = 4 === e.BYTES_PER_ELEMENT ? new Float32Array(e.buffer,e.byteOffset,e.length) : new Float32Array(e.length);
        return o ? (y[0] = a[s + "bbl_x"],
        y[1] = a[s + "bbl_y"],
        S[0] = a[s + "h_x"],
        S[1] = a[s + "h_y"],
        3 === n && (y[2] = a[s + "bbl_z"],
        S[2] = a[s + "h_z"]),
        i.i(h.a)(e, u, y, S, n)) : (u.set(e),
        u)
    }
      , C = function(t, e, n, r, a, o) {
        var l, h = t.vb, d = this.getItemSize(), g = h.Size, m = h.Offset ? h.Offset : 0;
        if (l = h.Encoding && "varint" === h.Encoding ? i.i(c.a)(new Uint8Array(o,m), d * g, t.type) : new f[t.type](o,m,d * g),
        0 == (n.attributes & b(e))) {
            if ("Color" === e && 1 === l.BYTES_PER_ELEMENT && this.setNormalize(!0),
            "Color" === e && 4 === l.BYTES_PER_ELEMENT && i.i(p.a)().convertVertexColor8Bit) {
                for (var _ = l.length, x = new Uint8Array(l.buffer,l.byteOffset,_), y = 0; y < _; ++y)
                    x[y] = Math.round(255 * Math.max(0, Math.min(1, l[y])));
                l = x,
                this.setNormalize(!0)
            }
            return this.setElements(l),
            this
        }
        if ("Normal" === e)
            return this.setElements(i.i(s.a)(l, new Float32Array(3 * g), 3, n.epsilon, n.nphi)),
            this.setItemSize(3),
            this;
        if ("Tangent" === e)
            return this.setElements(i.i(s.a)(l, new Float32Array(4 * g), 4, n.epsilon, n.nphi)),
            this.setItemSize(4),
            this;
        var S = null;
        if ("Vertex" === e)
            S = n.vertex_mode;
        else if (-1 !== e.indexOf("TexCoord")) {
            var C = "uv_" + e.substr(8) + "_mode";
            S = void 0 !== n[C] ? n[C] : n.vertex_mode
        }
        return S & v.prediction && void 0 !== a ? r.then(function() {
            return i.i(u.a)(l, d, a.getElements()),
            this.setElements(w(S, l, d, e, n)),
            this
        }
        .bind(this)) : (this.setElements(w(S, l, d, e, n)),
        this)
    }
      , M = function(t, e, i) {
        f.NodeVisitor.call(this),
        this._emptyGeometries = [],
        this._resourceLoader = t,
        this._options = e,
        this._promises = i,
        this._wireframesPromises = []
    };
    M.prototype = f.objectInherit(f.NodeVisitor.prototype, {
        apply: function(t) {
            if (t instanceof f.Geometry == !1)
                return this.traverse(t);
            if (0 === t.getPrimitiveSetList().length && !i.i(p.a)().keepEmptyGeometries)
                return void this._emptyGeometries.push(t);
            var e = this._options
              , n = e.wireframeOptions;
            if (n && 1 === t.userDataMap.wireframe) {
                t.setNodeMask(0);
                var a = r.a.defer();
                this._wireframesPromises.push(a.promise),
                n.nodes.push(t);
                var s = this;
                n.startPromise.then(function() {
                    s.processGeometry(t, n).then(a.resolve.bind(a))
                })
            } else
                this._promises.push(this.processGeometry(t, e))
        },
        processGeometry: function(t, e) {
            var i, n, a = t.userDataMap, s = 0, o = this._options, l = this._resourceLoader, u = o.prefixURL, h = o.bufferMap, c = [], d = t.getPrimitiveSetList(), p = d.length, m = [0];
            for (s = 0; s < p; ++s) {
                var v = d[s];
                if (!(v instanceof f.DrawArrays || v instanceof f.DrawArrayLengths)) {
                    var _ = v.getIndices();
                    _.getInitialBufferArray && (_ = _.getInitialBufferArray());
                    var b = h[_.getInstanceID()];
                    if (!0 !== b.visited)
                        if (b.visited = !0,
                        b.inlined)
                            _.setElements(new Uint16Array(b.inlined)),
                            v.setIndices(_);
                        else {
                            var y = l.getBinaryArray(u + b.vb.File, e).getPromise();
                            c.push(y),
                            y.then(x.bind(v, b, a, m)),
                            v.getMode() === f.PrimitiveSet.TRIANGLE_STRIP && (n = y,
                            i = _)
                        }
                }
            }
            var S = t.getVertexAttributeList()
              , w = Object.keys(S);
            w.sort(g);
            var M = w.length;
            for (s = 0; s < M; ++s) {
                var T = w[s]
                  , A = S[T];
                A.getInitialBufferArray && (A = A.getInitialBufferArray());
                var E = h[A.getInstanceID()];
                if (!0 !== E.visited)
                    if (E.visited = !0,
                    E.inlined)
                        A.setElements(new Float32Array(E.inlined));
                    else {
                        var P = a
                          , N = T.indexOf("_");
                        if (-1 !== N) {
                            var k = T.slice(N + 1);
                            P = a["morph_" + k],
                            T = T.slice(0, N)
                        }
                        var F = l.getBinaryArray(u + E.vb.File, e).getPromise()
                          , D = F.then(C.bind(A, E, T, P, n, i));
                        c.push(D)
                    }
            }
            return r.a.all(c)
        },
        removeEmptyGeometries: function() {
            for (var t = this._emptyGeometries, e = 0, i = t.length; e < i; ++e)
                for (var n = t[e], r = n.getParents(), a = 0, s = r.length; a < s; ++a)
                    r[a].removeChild(n)
        }
    });
    var T = {};
    T.postParse = function(t, e, i) {
        var n = []
          , a = new M(e,i,n);
        t.accept(a),
        a.removeEmptyGeometries();
        var s = i.wireframeOptions;
        if (s) {
            var o = s.deferDownload;
            r.a.all(a._wireframesPromises).then(o.resolve.bind(o))
        }
        return r.a.all(n)
    }
    ,
    e.a = T
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(472)
      , s = i(1021)
      , o = i(1020)
      , l = i(1019)
      , u = r.a.osg
      , h = function(t, e, i) {
        i ? u.error("ResourceLoader: " + t + " failed " + e + " error " + i) : u.error("ResourceLoader: " + t + " failed " + e)
    }
      , c = function() {
        this._nbThreads = 5,
        this._processing = [],
        this._queue = [],
        this._finished = [],
        this._running = !1
    };
    c.prototype = {
        checkResource: function(t) {
            var e;
            return [this._processing, this._queue, this._finished].forEach(function(r) {
                e || (e = i.i(n.find)(r, function(e) {
                    return e._url === t
                }))
            }),
            e
        },
        run: function() {
            this._running = !0,
            this.runPendingProcess()
        },
        runPendingProcess: function() {
            for (; this._processing.length < this._nbThreads && this._queue.length > 0; ) {
                var t = this._queue.shift();
                this._processing.push(t),
                t.start()
            }
        },
        queue: function(t) {
            var e = t;
            t.start || (console.log(t.url),
            e = new a.a(t.url,t.response)),
            this._queue.push(e);
            var i = function() {
                this._processing.splice(this._processing.indexOf(e), 1),
                this._finished.push(e),
                this.runPendingProcess()
            }
            .bind(this)
              , n = function() {
                this._processing.splice(this._processing.indexOf(e), 1),
                this.runPendingProcess()
            }
            .bind(this);
            return e.getPromise().then(i).catch(n).done(),
            this._running && this.runPendingProcess(),
            e
        },
        getModel: function(t, e) {
            var i = this.checkResource(t);
            return i || (i = this.queue(new s.a(t,"text",e)),
            i.getPromise().then(function() {}).catch(function(e) {
                h(t, "model", e)
            }).done(),
            i)
        },
        getImage: function(t, e) {
            var i = this.checkResource(t);
            if (i)
                return i;
            var n = e || {};
            return "data:image" === t.substr(0, "data:image".length) || (n.crossOrigin = "anonymous"),
            i = this.queue(new o.a(t,n)),
            i.getPromise().then(function() {}).catch(function() {
                h(t, "image")
            }).done(),
            i
        },
        getBinaryArray: function(t, e) {
            var i = this.checkResource(t);
            return i || (i = this.queue(new l.a(t,e)),
            i.getPromise().then(function() {}).catch(function(e) {
                h(t, "binary array", e)
            }).done(),
            i)
        }
    },
    e.a = c
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(926)
      , a = i(927)
      , s = i(43)
      , o = {
        FeatureName: "animation",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , l = !1;
    s.a.getHasAnimation().then(function(t) {
        t && (l = t)
    });
    var u = n.a.create(o);
    u.prototype.prepareForScreenShot = function() {
        return !!l && (this._oldPlayingAnimation = this.getModel().get("playing"),
        this.getModel().set("playing", !1),
        !0)
    }
    ,
    u.prototype.resetAfterScreenShot = function() {
        this._oldPlayingAnimation && this.getModel().set("playing", !0)
    }
    ,
    e.a = u
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(18))
      , a = i.n(r)
      , s = i(89)
      , o = i(90)
      , l = i(29)
      , u = i(293)
      , h = a.a.Model.extend({
        defaults: function() {
            var t = this.getResourceManager().getOrCreateAnimationCollection().resource;
            return i.i(o.a)() || t.remove(t.where({
                isEnabled: !1
            })),
            {
                animations: t,
                currentUID: "-1",
                speed: 1,
                autoplay: !0,
                playing: !0,
                cycleMode: "one",
                fps: -1,
                progress: 0
            }
        },
        getName: function() {
            return "Animation"
        },
        getResourceManager: function() {
            return this._resourceManager || s.default.instance
        },
        getAnimationByUID: function(t) {
            return this.get("animations").find(function(e) {
                return e.get("uid") === t
            })
        },
        getCurrentAnimation: function() {
            return this.getAnimationByUID(this.get("currentUID"))
        },
        getEnabledAnimationsCount: function() {
            return this.get("animations").where({
                isEnabled: !0
            }).length
        },
        getFirstEnabledAnimation: function() {
            for (var t = this.get("animations"), e = t.length, i = 0; i < e; ++i) {
                var n = t.at(i);
                if (n && n.get("isEnabled"))
                    return n
            }
        },
        init: function(t) {
            this._viewer = t.getViewer();
            var e = t.getModel().get("options")
              , r = e.animation;
            if (r && r.order) {
                var a = this.get("animations");
                this.set("speed", r.speed),
                this.set("cycleMode", r.cycleMode),
                this.set("autoplay", r.autoplay),
                this.set("playing", i.i(l.a)().animationAutoplay);
                var s = i.i(n.invert)(r.order);
                a.forEach(function(t) {
                    t.set("order", parseInt(s[t.get("uid")], 10))
                }),
                a.sort()
            }
        },
        getJSON: function() {
            return {
                order: this.get("animations").pluck("uid"),
                speed: this.get("speed"),
                cycleMode: this.get("cycleMode"),
                autoplay: !!i.i(u.a)() || "-1" !== this.get("currentUID")
            }
        }
    });
    e.a = h
}
, function(t, e, i) {
    "use strict";
    var n = (i(928),
    i(7))
      , r = i.n(n)
      , a = i(4)
      , s = i(43)
      , o = i(6)
      , l = i(678)
      , u = i(51)
      , h = i(385)
      , c = i(29)
      , d = i(16)
      , p = a.a.osg
      , f = a.a.osgAnimation
      , g = a.a.osgWrappers
      , m = g.osg
      , v = o.a.extend({
        initialize: function() {
            o.a.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:playing", this.onPlayingChanged, this),
            t.bind("change:speed", this.onSpeedChanged, this),
            t.bind("change:currentUID", this.onCurrentAnimationChanged, this),
            t.bind("seek", this.onSeek, this),
            this._manager = null,
            this._idLoop = 0,
            this._skeletons = [],
            this._viewer = this.options.context.getViewer(),
            this._firstAnimationPlayed = !1,
            this._animationPromises = [],
            this._hookBasicAnimationManager(s.a.getPolygon()),
            s.a.getMaterial().then(this._initAnimation.bind(this)),
            s.a.getModelDisplayed().then(this._resolveAllAnimations.bind(this))
        },
        _resolveAllAnimations: function() {
            0 === this._animationPromises.length ? (s.a.resolveFirstAnimation(),
            s.a.resolveAllAnimations()) : r.a.all(this._animationPromises).then(s.a.resolveAllAnimations.bind(s.a))
        },
        _initAnimation: function() {
            this._animationPromises.length,
            this._manager && (this.onSpeedChanged(),
            l.a.init(this._skeletons, this._viewer, this.model))
        },
        _getHookUpdate: function() {
            var t = this;
            return function(e, i) {
                var n = t.getCurrentInstanceAnimation();
                (-1 !== this._seekTime || !this._pause && n) && u.a.draw();
                var r = f.BasicAnimationManager.prototype.update.call(this, e, i);
                if (n) {
                    var a = Math.max(0, this.getSimulationTime() * this.getTimeFactor() - n.start)
                      , s = a % n.duration * 100 / n.duration
                      , o = Math.floor(a / n.duration);
                    o > this._idLoop && (s = 100,
                    t.end(),
                    "one" !== t.model.get("cycleMode") && (r = f.BasicAnimationManager.prototype.update.call(this, e, i))),
                    this._idLoop = o,
                    t.model.set("progress", s)
                }
                return r
            }
        },
        _getHookUpdateManager: function() {
            var t = this;
            return function(e) {
                var i = t.getCurrentInstanceAnimation()
                  , n = t.model.get("fps");
                if (i && n > 0) {
                    var r = 1 / n
                      , a = (e - i.start) % r;
                    a > .5 * r ? e += r - a : e -= a
                }
                return f.BasicAnimationManager.prototype.updateManager.call(this, e)
            }
        },
        _hookUpdateChannelType: function() {
            i.i(c.a)().snapKeyframe && (f.BasicAnimationManager.prototype._updateChannelsType = function(t, e, i) {
                for (var n = 0, r = e.length; n < r; n++) {
                    var a = e[n]
                      , s = a.instanceAnimation
                      , o = s.loop
                      , l = t - a.t;
                    o && s.duration > 0 && (l %= s.duration),
                    l += s.firstKeyTime;
                    var u = a.channel;
                    if (l > u.start && l < u.end) {
                        var h = u.times
                          , c = a.key;
                        if (l > h[c])
                            for (; h[c + 1] < l; )
                                c++;
                        else if (l < h[c])
                            for (; h[c] > l; )
                                c--;
                        var d = h[c]
                          , p = h[c + 1];
                        l = Math.abs(l - d) < Math.abs(l - p) ? d : p
                    }
                    i(l, a)
                }
            }
            )
        },
        _hookBasicAnimationManager: function(t) {
            var e = this
              , i = this._animationPromises
              , n = this._getHookUpdate()
              , a = this._getHookUpdateManager();
            this._hookUpdateChannelType(),
            g.osgAnimation.BasicAnimationManager = function(o, l) {
                var u = o.getJSON();
                return u.Animations ? (m.Object(o, l),
                s.a.OSG_VERSION < 8 ? r.a.resolve(l) : e._manager ? (p.error("More than one basicAnimationManager !"),
                r.a.resolve(l)) : (e._manager = l,
                e.model.get("playing") || l.togglePause(),
                l.update = n,
                l.updateManager = a,
                t.then(function() {
                    var t = o.getOptions();
                    t.progress = void 0;
                    for (var n = u.Animations.length, r = 0; r < n; ++r) {
                        var a = u.Animations[r]
                          , s = o.setJSON(a["osgAnimation.Animation"].UserDataContainer).readUserDataContainer()
                          , l = h.a.convertUserDataToObject(s)
                          , c = e.model.getAnimationByUID(l.AnimationUID);
                        if (c) {
                            t.currentAnimationUID = c.get("url");
                            var d = o.setJSON(a).readObject();
                            d.isRejected() ? p.Notify.warn("An Animation failed on the parsing!") : (d.then(e.onAddAnimation.bind(e, r, l)),
                            i.push(d))
                        }
                    }
                }),
                r.a.resolve(l))) : r.a.reject()
            }
        },
        onAddAnimation: function(t, e, i) {
            var n = e.AnimationUID;
            i.name = n,
            i.duration || (i.duration = 2.5,
            i.still = !0),
            this._manager.addAnimations([i]),
            0 === i.duration && (this._manager.getAnimations()[n].duration = 2.5);
            var r = this.model;
            r.trigger("change:animations");
            var a = r.getAnimationByUID(n);
            a.on("change:isLoop", this.onAnimationChangeLoop.bind(this)),
            a.get("isLoop") && this.onAnimationChangeLoop(a),
            this.model.get("currentUID") === n && this.onCurrentAnimationChanged(),
            this._firstAnimationPlayed || (this._playFirstAnimation(n) && (this._firstAnimationPlayed = !0,
            this.model.set("currentUID", n)),
            s.a.resolveFirstAnimation())
        },
        _playFirstAnimation: function(t) {
            if (!this.model.get("autoplay"))
                return !1;
            var e = this.model.getFirstEnabledAnimation();
            return e && t === e.get("uid")
        },
        onAnimationChangeLoop: function(t) {
            var e = this._manager.getAnimations()[t.get("uid")];
            this._manager.setAnimationLerpEndStart(e, t.get("isLoop") ? 1 / 30 : 0)
        },
        onCurrentAnimationChanged: function() {
            this._idLoop = 0;
            var t = this._manager;
            if (t.stopAllAnimation(),
            t.resetAllStackedTransforms(),
            this.getCurrentAnimation()) {
                var e = this.getCurrentInstanceAnimation();
                e && (t.playAnimation(e),
                t.setSeekTime(e.start))
            }
            u.a.draw()
        },
        getCurrentAnimation: function() {
            return this.model.getCurrentAnimation()
        },
        getCurrentInstanceAnimation: function() {
            var t = this.getCurrentAnimation();
            return t ? this._manager.getAnimations()[t.get("uid")] : void 0
        },
        onPlayingChanged: function() {
            if (this._playlistNoLoopEnd) {
                var t = this.model.getFirstEnabledAnimation().get("uid") || "-1";
                this._playlistNoLoopEnd = !1,
                t === this.getCurrentAnimation().get("uid") ? this.model.trigger("seek", 0) : this.model.set("currentUID", t)
            }
            this._manager.togglePause(),
            u.a.draw()
        },
        onSeek: function(t) {
            var e = this.getCurrentInstanceAnimation();
            if (e) {
                var i = this._manager;
                i.setSeekTime(e.start + e.duration * (t / 100) / i.getTimeFactor()),
                u.a.draw()
            }
        },
        onSpeedChanged: function() {
            this._manager.setTimeFactor(this.model.get("speed")),
            d.a.modelViewerAnimationSpeedSelected(this.model.get("speed"))
        },
        end: function() {
            var t = this.model.get("cycleMode");
            if ("one" === t)
                this.model.trigger("cycleMode");
            else if ("all" === t || "none" === t) {
                var e, i = this.model.get("animations"), n = i.indexOf(this.getCurrentAnimation()), r = "-1", a = 0, s = i.length;
                for (a = n + 1; a < s; ++a)
                    if ((e = i.at(a)) && e.get("isEnabled")) {
                        r = e.get("uid");
                        break
                    }
                "-1" === r && "all" === t && (r = this.model.getFirstEnabledAnimation() ? this.model.getFirstEnabledAnimation().get("uid") : "-1"),
                "-1" !== r ? this.model.set("currentUID", r) : (this.model.set("playing", !1),
                this.model.trigger("seek", 99.99),
                this._playlistNoLoopEnd = !0)
            }
        }
    });
    e.a = v
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(4)
      , s = i(385)
      , o = i(89)
      , l = i(1055)
      , u = i(1051)
      , h = i(1052)
      , c = i(692)
      , d = i(691)
      , p = i(690)
      , f = a.a.osg
      , g = a.a.osgDB
      , m = a.a.osgAnimation
      , v = a.a.osgWrappers.osgAnimation
      , _ = m.Channel
      , b = function() {}
      , x = g.registry();
    x.registerObject("osgAnimation.Vec3LerpChannelCompressedPacked", b),
    x.registerObject("osgAnimation.Vec3LerpChannelCompressed", b),
    x.registerObject("osgAnimation.Vec3LerpChannelPacked", b),
    x.registerObject("osgAnimation.QuatSlerpChannelCompressedPacked", b),
    x.registerObject("osgAnimation.QuatSlerpChannelCompressed", b),
    x.registerObject("osgAnimation.QuatSlerpChannelPacked", b),
    x.registerObject("osgAnimation.FloatLerpChannelCompressedPacked", b),
    x.registerObject("osgAnimation.FloatLerpChannelCompressed", b),
    x.registerObject("osgAnimation.FloatLerpChannelPacked", b);
    var y = {}
      , S = (new o.default)._resourceLoader
      , w = {
        quantization: 1,
        prediction: 2,
        delta: 4,
        quat: 8,
        deltaTime: 16
    }
      , C = function(t, e, n, r, a, s) {
        var o, g = e.ItemSize, m = Object.keys(e.Array)[0], v = e.Array[m], _ = v.Offset ? v.Offset : 0, b = v.Size, x = n.channel_mode || 0, y = !!(1 === s ? x & w.deltaTime : x & w.delta), S = new ArrayBuffer(4 * (y ? b + 2 : b + 1) * s), C = new Float32Array(S,y ? 4 * s : 0,b * s);
        return o = v.Encoding && "varint" === v.Encoding ? i.i(c.a)(new Uint8Array(t,_), g * b, m) : new f[m](t,_,g * b),
        4 === s && x & w.quat ? (a && (o = i.i(l.a)(o, new Float32Array(o.length), g)),
        i.i(p.a)(o, C, s, n.epsilon, n.nphi, !0),
        y && (C = new Float32Array(S,0,(b + 1) * s),
        C[0] = n.ox,
        C[1] = n.oy,
        C[2] = n.oz,
        C[3] = n.ow,
        i.i(h.a)(C)),
        C) : (a && 1 !== s ? i.i(l.a)(o, C, g) : C.set(o),
        r ? (3 === s && x & w.quantization && i.i(d.a)(C, C, [n.bx, n.by, n.bz], [n.hx, n.hy, n.hz], s),
        y && (C = new Float32Array(S,0,(b + 1) * s),
        3 === s ? (C[0] = n.ox,
        C[1] = n.oy,
        C[2] = n.oz) : C[0] = n.ot,
        i.i(u.a)(C, g)),
        C) : C)
    }
      , M = function(t, e, i, n, a, o) {
        var l = t.getJSON();
        if (!(void 0 !== l.TargetName && l.KeyFrames && l.Name && l.KeyFrames.Time && l.KeyFrames.Key))
            return r.a.reject();
        var u = l.UserDataContainer
          , h = u ? s.a.convertUserDataToObject(t.setJSON(u).readUserDataContainer()) : y;
        return S.getBinaryArray(t.getOptions().currentAnimationUID).getPromise().then(function(t) {
            var r = C(t, l.KeyFrames.Time, h, n, !1, 1)
              , s = C(t, l.KeyFrames.Key, h, n, a, o);
            return i(s, r, l.TargetName, l.Name, e),
            e
        })
    };
    v.Vec3LerpChannel = function(t, e) {
        return M(t, e, _.createVec3Channel, !1, !1, 3)
    }
    ,
    v.Vec3LerpChannelCompressedPacked = function(t, e) {
        return M(t, e, _.createVec3Channel, !0, !0, 3)
    }
    ,
    v.Vec3LerpChannelCompressed = function(t, e) {
        return M(t, e, _.createVec3Channel, !0, !1, 3)
    }
    ,
    v.Vec3LerpChannelPacked = function(t, e) {
        return M(t, e, _.createVec3Channel, !1, !0, 3)
    }
    ,
    v.QuatSlerpChannel = function(t, e) {
        return M(t, e, _.createQuatChannel, !1, !1, 4)
    }
    ,
    v.QuatSlerpChannelCompressedPacked = function(t, e) {
        return M(t, e, _.createQuatChannel, !0, !0, 4)
    }
    ,
    v.QuatSlerpChannelCompressed = function(t, e) {
        return M(t, e, _.createQuatChannel, !0, !1, 4)
    }
    ,
    v.QuatSlerpChannelPacked = function(t, e) {
        return M(t, e, _.createQuatChannel, !1, !0, 4)
    }
    ,
    v.FloatLerpChannel = function(t, e) {
        return M(t, e, _.createFloatChannel, !1, !1, 1)
    }
    ,
    v.FloatLerpChannelCompressedPacked = function(t, e) {
        return M(t, e, _.createFloatChannel, !0, !0, 1)
    }
    ,
    v.FloatLerpChannelCompressed = function(t, e) {
        return M(t, e, _.createFloatChannel, !0, !1, 1)
    }
    ,
    v.FloatLerpChannelPacked = function(t, e) {
        return M(t, e, _.createFloatChannel, !1, !0, 1)
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(930)
      , a = i(932)
      , s = {
        FeatureName: "autospin",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getNode = function() {
        return this._views[0]._nodeAutospin
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(18)
      , r = i.n(n)
      , a = i(29)
      , s = r.a.Model.extend({
        defaults: {
            enable: !1,
            paused: !1,
            speed: .6
        },
        getName: function() {
            return "Autospin"
        },
        init: function() {
            var t = i.i(a.a)();
            void 0 !== t.autospin && (this.set("enable", !!t.autospin),
            this.set("speed", t.autospin))
        }
    });
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(51)
      , a = n.a.osg
      , s = function(t, e, i) {
        this._speed = void 0 !== t ? t : -.6,
        this._fadeStart = void 0 !== e ? e : 2,
        this._fadeEnd = void 0 !== i ? i : 2,
        this._enable = !0,
        this._rotation = 0,
        this._lastTime = -1,
        this._startTime = 0,
        this._endTime = 0,
        this._checkIfFinished = !1,
        this._fixedCenter = void 0
    };
    s.prototype = {
        setSpeed: function(t) {
            this._speed = t
        },
        setFadeStart: function(t) {
            this._fadeStart = t
        },
        setFadeEnd: function(t) {
            this._fadeEnd = t
        },
        deactivate: function() {
            this._enable = !1
        },
        resume: function() {
            this._enable = !0,
            this._checkIfFinished = !1;
            var t = Math.max((this._endTime - this._lastTime) / this._fadeEnd, 0);
            this._startTime = this._lastTime - this._fadeStart * t,
            this._endTime = this._lastTime,
            r.a.draw()
        },
        pause: function() {
            var t = Math.min((this._lastTime - this._startTime) / this._fadeStart, 1);
            this._endTime = this._lastTime + this._fadeEnd * t,
            this._checkIfFinished = !0
        },
        update: function() {
            var t = a.mat4.create();
            return function(e, i) {
                if (!1 === this._enable)
                    return !0;
                r.a.draw();
                var n = i.getFrameStamp().getSimulationTime();
                if (!0 === this._checkIfFinished && this._endTime < n)
                    return this._enable = !1,
                    this._checkIfFinished = !1,
                    this._lastTime = -1,
                    !0;
                if (this._lastTime < 0)
                    return this._lastTime = n,
                    this._startTime = n,
                    !0;
                var s = n - this._lastTime;
                this._lastTime = n,
                this._endTime > n ? this._rotation += s * a.smoothStep(0, 1, (this._endTime - n) / this._fadeEnd) : n - this._startTime < this._fadeStart ? this._rotation += s * a.smoothStep(0, 1, (n - this._startTime) / this._fadeStart) : this._rotation += s;
                var o = e.getMatrix();
                a.mat4.fromZRotation(o, -this._rotation * this._speed);
                var l = e.getChildren();
                if (l.length > 0) {
                    if (!this._fixedCenter) {
                        var u = l[0].getMinimumBound();
                        u.valid() && (this._fixedCenter = a.vec3.create(),
                        a.vec3.copy(this._fixedCenter, u.center()))
                    }
                    var h = this._fixedCenter || l[0].getMinimumBound().center();
                    a.vec3.negate(h, h),
                    a.mat4.fromTranslation(t, h),
                    a.mat4.multiply(o, o, t),
                    a.vec3.negate(h, h),
                    a.mat4.fromTranslation(t, h),
                    a.mat4.multiply(o, t, o)
                }
                return e.dirtyBound(),
                !0
            }
        }()
    },
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(6)
      , a = i(931)
      , s = n.a.osg
      , o = r.a.extend({
        initialize: function() {
            r.a.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:enable", this.onEnableChanged, this),
            t.bind("change:paused", this.onPausedChanged, this),
            t.bind("change:speed", this.onSpeedChanged, this),
            this._nodeAutospin = new s.MatrixTransform,
            this._nodeAutospin.setName("Feature - Autospin"),
            this._callbackAutospin = new a.a(t.get("speed"),1,1),
            this._nodeAutospin.addUpdateCallback(this._callbackAutospin),
            !1 === t.get("enable") && this._callbackAutospin.deactivate()
        },
        onEnableChanged: function() {
            !0 === this.model.get("enable") ? this._callbackAutospin.resume() : this._callbackAutospin.deactivate()
        },
        onPausedChanged: function() {
            !1 !== this.model.get("enable") && (!0 === this.model.get("paused") ? this._callbackAutospin.pause() : this._callbackAutospin.resume())
        },
        onSpeedChanged: function() {
            this._callbackAutospin.setSpeed(this.model.get("speed"))
        }
    });
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(934)
      , a = i(935)
      , s = {
        FeatureName: "background",
        ModelType: r.a,
        ViewListType: [a.a]
    };
    e.a = n.a.create(s)
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(43)
      , a = i(15)
      , s = i(566)
      , o = i(915)
      , l = i(29)
      , u = i(293)
      , h = i(292)
      , c = n.a.osg
      , d = c.vec3.fromValues(.2, .2, .2)
      , p = a.a.extend({
        _trashbin: [],
        defaults: function() {
            return {
                enable: i.i(u.a)() ? "environment" : "fixed",
                enableVR: !1,
                uid: "51af6a870cce449eb75b0345feebaebb",
                color: c.vec3.fromValues(.2, .2, .2),
                webVR: !1
            }
        },
        init: function(t) {
            var e = t.getModel().get("user").uid;
            this.backgroundCollection = this.createCollection(e),
            this.backgroundCollection.fetch({
                remove: !1
            });
            var n = t.getModel().get("options").background;
            n && (n.enable && this.set("enable", n.enable),
            void 0 !== n.enableVR && this.set("enableVR", n.enableVR),
            n.uid && this.set("uid", n.uid),
            n.color && this.set("color", n.color)),
            i.i(l.a)().transparent && this.set("enable", "none");
            var a = t.getViewer();
            i.i(u.a)() && r.a.getPolygon().then(function() {
                "Tilt Brush" === a.getRootUserData().authoringTool && (this.set("enable", "color"),
                this.set("color", c.vec3.create()))
            }
            .bind(this))
        },
        createCollection: function(t) {
            return new s.default([],{
                filters: new o.a({
                    userUID: t
                })
            })
        },
        getName: function() {
            return "Background"
        },
        setBackground: function(t) {
            return this.setBackgroundUID(t.uid)
        },
        setBackgroundUID: function(t) {
            t && this.set("uid", t)
        },
        getBackground: function() {
            if (this.backgroundCollection) {
                var t = this.get("uid")
                  , e = this.backgroundCollection.find(function(e) {
                    return e.get("uid") === t || e.get("id") === t
                });
                if (e)
                    return e;
                this.set("uid", "51af6a870cce449eb75b0345feebaebb")
            }
        },
        getEnableType: function() {
            var t = this.get("enable");
            return !this.get("webVR") || this.get("enableVR") && "environment" === t ? t : "color"
        },
        getColor: function() {
            return !this.get("webVR") || this.get("enableVR") && "color" === this.get("enable") ? this.get("color") : d
        },
        getJSON: function() {
            var t = {}
              , e = this.getBackground();
            return t.enable = this.get("enable"),
            t.enableVR = this.get("enableVR"),
            t.uid = e ? e.get("uid") : "51af6a870cce449eb75b0345feebaebb",
            t.color = this.get("color"),
            t
        },
        editorGetJSON: function() {
            return this.getJSON()
        },
        validateJSON: function(t) {
            var e = [];
            return h.a.isEnumString(t.enable, ["environment", "fixed", "color", "none"]) || e.push("Background.editorSetJSON enable must be an enum in values [ environment, fixed, color, none ]"),
            h.a.isBoolean(t.enableVR) || e.push("Background.editorSetJSON enableVR must be a boolean"),
            void 0 !== t.uid && (h.a.isString(t.uid) || e.push("Background.editorSetJSON uid must be a string")),
            void 0 !== t.color && (h.a.isArrayNumber(t.color, 3, 0, 1) || e.push("Background.editorSetJSON color must be a vec3 with value in range [0,1]")),
            e.join("\n")
        },
        editorSetJSON: function(t) {
            var e = this.validateJSON(t);
            return e ? (this.set("enable", t.enable),
            this.set("enableVR", t.enableVR),
            void 0 !== t.uid && this.set("uid", t.uid),
            void 0 !== t.color && this.set("color", t.color),
            e) : e
        }
    });
    e.a = p
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(7))
      , a = i.n(r)
      , s = i(4)
      , o = i(43)
      , l = i(6)
      , u = i(89)
      , h = i(553)
      , c = i(51)
      , d = s.a.osg
      , p = l.a.extend({
        initialize: function() {
            l.a.prototype.initialize.apply(this, arguments),
            this.model.bind("change:enable", this.onEnableChanged, this),
            this.model.bind("change:enableVR", this.onEnableChanged, this),
            this.model.bind("change:webVR", this.onEnableChanged, this),
            this.model.bind("change:uid", this.onBackgroundChanged, this),
            this.model.bind("change", c.a.draw),
            this._viewer = this.options.context.getViewer();
            var t = this.options.context.getFeatures().environment;
            t && (this.resourceDefer = a.a.defer(),
            this.options.context.getScene().addResourcePromise(this.resourceDefer.promise),
            this._modelEnvironment = t.getModel(),
            this._nodeBackground = t.getNode().getBackground(),
            this._nodeBackground.addUpdateCallback(this),
            this.onEnableChanged())
        },
        getResourceManager: function() {
            return this._resourceManager || u.default.instance
        },
        onBackgroundChanged: function() {
            var t = this.model.getBackground();
            if (t) {
                var e = this.options.context.getViewer()
                  , n = Math.max(i.i(h.a)(e.getWidth()), i.i(h.a)(e.getHeight()))
                  , r = t.findImageNearestToResolution(n, n)
                  , a = r.url;
                return this.getResources(a)
            }
        },
        getResources: function(t) {
            var e = {
                minFilter: d.Texture.LINEAR,
                magFilter: d.Texture.LINEAR,
                transferToGPU: !0,
                convertNPOT: !1
            }
              , r = this.getResourceManager()._resourceLoader._processing;
            r.length && i.i(n.forEach)(r, function(t) {
                t._options && t._options.cancelableBackground && t._options.uid !== this.model.get("uid") && t.abortImage()
            }
            .bind(this));
            var a = this.getResourceManager().getOrCreateTexture(t, i.i(n.extend)({}, e, {
                cancelableBackground: !0,
                uid: this.model.get("uid")
            }));
            a.promise.then(function(t) {
                this._nodeBackground.setBackground(t),
                this._nodeBackground.rescale(this._viewWidth, this._viewHeight),
                this.model.trigger("backgroundUpdated", t),
                "fixed" === this.model.getEnableType() && this._nodeBackground.showBackground()
            }
            .bind(this));
            var s = this.options.context.getViewer();
            return this.resourceDefer ? (a.promise.finally(this.resourceDefer.resolve.bind(this.resourceDefer)),
            this.resourceDefer = void 0) : o.a.getHighResLoaded().then(s.setFakeSecondaryProgress.bind(s, a.promise, 0)),
            a.promise
        },
        onEnableChanged: function() {
            var t = this.model.getEnableType();
            this._modelEnvironment.set("backgroundEnable", "environment" === t),
            "color" === t ? this._nodeBackground.showColor() : "fixed" === t ? this._nodeBackground.getBackground() ? this._nodeBackground.showBackground() : void 0 !== this.model.get("uid") && this.onBackgroundChanged() : "environment" === t ? this._nodeBackground.showEnvironment() : "none" === t && this._nodeBackground.hide(),
            this.resourceDefer && this.resourceDefer.resolve()
        },
        requireBiggerTexture: function() {
            var t = this.options.context.getViewer()
              , e = Math.max(i.i(h.a)(t.getWidth()), i.i(h.a)(t.getHeight()))
              , n = this.model.getBackground();
            if (n) {
                var r = n.findImageNearestUpToResolution(e, e);
                if (void 0 !== this._nodeBackground && !this._nodeBackground.getBackground())
                    return !1;
                if (r.width < this._nodeBackground.getBackground().getWidth())
                    return !1
            }
            return !0
        },
        update: function() {
            if ("fixed" !== this.model.getEnableType())
                return !0;
            var t = this._viewer.getCamera().getViewport()
              , e = t.width()
              , i = t.height();
            return this._viewWidth === e && this._viewHeight === i || (this._viewWidth = e,
            this._viewHeight = i,
            !0 === this.requireBiggerTexture() && this.onBackgroundChanged(),
            this._nodeBackground.rescale(e, i)),
            !0
        }
    });
    e.a = p
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(1)
      , a = (i.n(r),
    i(151))
      , s = n.a.osg
      , o = i.i(r.invert)(s.Texture)
      , l = ["magFilter", "minFilter", "wrapS", "wrapT", "textureTarget", "internalFormat"]
      , u = function(t) {
        t.image && (t.url = t.image,
        delete t.image);
        for (var e = 0, i = l.length; e < i; ++e) {
            var n = l[e];
            "number" == typeof t[n] && (t[n] = o[t[n]])
        }
        void 0 === t.texCoordUnit ? t.texCoordUnit = 0 : "string" == typeof t.texCoordUnit && (t.texCoordUnit = parseInt(t.texCoordUnit, 10)),
        t.format && delete t.format
    }
      , h = function(t) {
        return Math.max(0, Math.min(1, t))
    }
      , c = function(t, e, i) {
        if (void 0 !== t.factor) {
            var n = 0
              , r = 1;
            i <= 2 && ("Opacity" === e ? "alphaMask" === t.type ? n = .01 : "alphaBlend" === t.type && t.factor >= .99 && (t.factor = 1) : t.factor < .01 && (t.factor = 0)),
            "BumpMap" === e || "EmitColor" === e ? r = 10 : "SpecularHardness" === e ? r = 1e4 : "Displacement" === e && (r = 1e15),
            t.factor = Math.max(n, Math.min(r, t.factor))
        }
        if (t.color) {
            var o = t.color;
            t.color = s.vec3.fromValues(h(o[0]), h(o[1]), h(o[2]))
        }
        void 0 === t.enable && (t.enable = !0);
        var l = t.texture;
        if (l) {
            u(l);
            var c = l.internalFormat;
            if (!c)
                return void (l.internalFormat = a.a.getDefaultFormat(e));
            switch (e) {
            case "NormalMap":
            case "SpecularPBR":
                l.internalFormat = "RGB";
                break;
            case "DiffuseColor":
            case "DiffuseIntensity":
            case "SpecularColor":
            case "EmitColor":
            case "DiffusePBR":
            case "AlbedoPBR":
                "RGBA" === c && (l.internalFormat = "RGB");
                break;
            case "Displacement":
            case "SpecularHardness":
            case "BumpMap":
            case "GlossinessPBR":
            case "RoughnessPBR":
            case "MetalnessPBR":
            case "SpecularF0":
            case "AOPBR":
            case "CavityPBR":
                l.internalFormat = "LUMINANCE";
                break;
            default:
            case "Opacity":
                "RGBA" === c ? l.internalFormat = "ALPHA" : "RGB" === c && (l.internalFormat = "LUMINANCE")
            }
        }
    }
      , d = function(t) {
        var e = t.channels;
        e.Geometry && (e.NormalMap = e.Geometry,
        delete e.Geometry),
        e.Reflection && (void 0 === t.reflection && (t.reflection = e.Reflection.factor),
        delete e.Reflection),
        t.cullFace || t.cullFaceMode && (t.cullFace = t.cullFaceMode,
        delete t.cullFaceMode),
        t.depthCheckMode && (e.Opacity && !e.Opacity.type && (e.Opacity.type = "alphaBlend"),
        delete t.depthCheckMode);
        var i = t.version || 0;
        if (e)
            for (var n in e)
                c(e[n], n, i)
    };
    e.a = d
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(1)
      , a = (i.n(r),
    i(936))
      , s = n.a.osg
      , o = function(t, e) {
        var n = []
          , a = {}
          , s = 0
          , o = function(t, i) {
            if (!a[i]) {
                a[i] = i;
                var r = "https://media.sketchfab.com/urls/" + e + "/" + i
                  , o = {
                    uid: i,
                    name: i,
                    images: [{
                        url: r,
                        uid: i,
                        width: 4096,
                        height: 4096
                    }]
                };
                t.uid = a[i],
                delete t.image,
                delete t.url,
                n.push(o),
                s++
            }
            t.uid = a[i],
            delete t.image,
            delete t.url
        };
        i.i(r.each)(t, function(t) {
            i.i(r.each)(t.channels, function(t) {
                if (t.texture) {
                    var e = t.texture.url || t.texture.image;
                    !e && t.texture.uid && (e = t.texture.uid),
                    e && o(t.texture, e)
                }
            })
        }),
        window.prefetchedData["/i/models/" + e + "/textures"] = {
            results: n
        }
    }
      , l = function(t, e, i) {
        return Math.max(e, Math.min(i, t))
    }
      , u = function(t) {
        var e = t.materials;
        for (var n in e) {
            var r = e[n];
            "object" == typeof r ? void 0 === r.stateSetID ? delete e[r.id] : i.i(a.a)(r) : delete e[n]
        }
    }
      , h = function(t) {
        if (t.orientation.axis) {
            var e = t.orientation.axis;
            e = s.vec3.fromValues(l(e[0], 0, 3), l(e[1], 0, 3), l(e[2], 0, 3)),
            delete t.orientation.axis,
            e[0] = (4 - e[0]) % 4,
            e[1] = (4 - e[1]) % 4,
            e[2] = (4 - e[2]) % 4,
            t.orientation.matrix = s.mat4.fromRotation(s.mat4.create(), .5 * Math.PI * (e[0] + e[1] + e[2]), e)
        }
    }
      , c = function(t) {
        switch (t.shading.renderer || (t.shading.renderer = "pbr" === t.shading.type ? "pbr" : "classic"),
        t.shading.type) {
        case "lit":
        case "matcap":
        case "shadeless":
        case "pbr":
            break;
        case "blending":
        case "default":
        case "default-shading":
        case "predefined-shading":
        case "shading":
        case void 0:
            t.shading.type = "lit";
            break;
        default:
        case "no-shading":
            t.shading.type = "shadeless"
        }
        t.shading.vertexColor || "pbr" !== t.shading.renderer || (t.shading.vertexColor = {
            enable: !1,
            colorSpace: "linear"
        })
    }
      , d = function(t) {
        var e = t.environment;
        void 0 !== e.exposure && (e.exposure *= void 0 !== e.light && e.light > 0 ? e.light : 1);
        var i = t.environment.backgroundEnable;
        void 0 !== i && !0 === t.environment.enable ? t.background.enable = !0 === i ? "environment" : !0 === t.background.enable ? "fixed" : "none" : void 0 !== t.background.enable && (!0 === t.background.enable ? t.background.enable = "fixed" : !1 === t.background.enable && (t.background.enable = "none"))
    }
      , p = function(t) {
        if (t.lighting.lights)
            for (var e = t.lighting.lights, i = 0, n = e.length; i < n; ++i) {
                var r = e[i];
                r.hardness = Math.max(Math.min(r.hardness, 1), 0)
            }
        else
            t.lighting = {}
    }
      , f = function(t) {
        var e = t.scene && t.scene.postProcess;
        if (e) {
            var i = e.ssao;
            2 === t.version && e.enable && i && i.enable && 0 === i.bias && 0 === i.radius && (i.ssaoBias = -1,
            i.ssaoRadius = -1,
            t.vr.scale = -1)
        }
    }
      , g = function(t, e) {
        return h(t),
        c(t),
        d(t),
        u(t),
        p(t),
        f(t),
        e ? t : i.i(r.cloneDeepWith)(t, function(t) {
            if (t.byteLength)
                return Array.prototype.slice.call(t)
        })
    }
      , m = function(t) {
        var e = t.toJSON();
        void 0 === t.get("vertexCount") && t.set("vertexCount", e.nbVertexes),
        void 0 === t.get("faceCount") && t.set("faceCount", e.nbTriangles),
        void 0 === e.options && (e.options = {}),
        t.set("options", g(e.options, !0)),
        t.set("files", e.files);
        var n = !0;
        if (i.i(r.isEmpty)(t.get("options").materials) && (n = !1),
        !0 === n) {
            var a = window.prefetchedData["/i/models/" + t.get("uid") + "/textures"];
            a && a.results && a.results.length > 0 && (n = !1)
        }
        return !0 === n && o(e.options.materials, t.get("uid")),
        t
    };
    m.readOptions = g,
    e.a = m
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(939)
      , a = i(941)
      , s = {
        FeatureName: "cameraAnimation",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getNode = function() {
        return this._views[0]._nodeCameraAnimation
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(18)
      , r = i.n(n)
      , a = i(4)
      , s = a.a.osg
      , o = r.a.Model.extend({
        defaults: {
            eye: s.vec3.create(),
            target: s.vec3.create(),
            duration: 1
        },
        getName: function() {
            return "Camera animation"
        },
        setTargetAndEye: function(t, e, i) {
            return this.set("target", t),
            this.set("eye", e),
            this.trigger("setTargetAndEye", i)
        }
    });
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(43)
      , a = i(470)
      , s = i(548)
      , o = i(51)
      , l = n.a.osg
      , u = n.a.osgAnimation
      , h = function(t, e) {
        this._fpsDist = -1,
        this._manipulator = t,
        this._eyeEnd = l.vec3.create(),
        this._eyeDeltaLen = 0,
        this._targetEnd = l.vec3.create(),
        this._targetDeltaLen = 0,
        this._lastRatio = 0,
        this._preventFlip = !1,
        a.a.call(this, e),
        this._finished = !0
    };
    h.prototype = l.objectInherit(a.a.prototype, {
        setTargetAndEye: function() {
            var t = l.vec3.create();
            return function(e, i, n) {
                if (this._preventFlip = n,
                this._finished) {
                    var r = this._manipulator.getManipulatorList()[s.a.FPS];
                    this._fpsDist = r.getDistance()
                }
                l.vec3.copy(this._eyeEnd, i),
                this._manipulator.getEyePosition(t),
                this._eyeDeltaLen = l.vec3.len(l.vec3.sub(t, i, t)),
                l.vec3.copy(this._targetEnd, e),
                this._manipulator.getTarget(t),
                this._targetDeltaLen = l.vec3.len(l.vec3.sub(t, e, t)),
                this._lastRatio = 0,
                this.reset()
            }
        }(),
        update: function() {
            var t = l.vec3.create()
              , e = l.vec3.create()
              , i = l.vec3.create()
              , n = l.vec3.create();
            return function(a, h) {
                if (!0 === this._finished)
                    return !0;
                o.a.draw();
                var c = this._manipulator
                  , d = c.getCurrentManipulatorIndex();
                d === s.a.FPS && c.setManipulatorIndex(s.a.ORBIT);
                var p = h.getFrameStamp().getSimulationTime()
                  , f = this.interpolate(p, a, h);
                f = u.easeOutQuart(f);
                var g = f - this._lastRatio;
                this._lastRatio = f;
                var m = this._manipulator;
                if (m.getEyePosition(t),
                m.getTarget(e),
                l.vec3.sub(i, this._targetEnd, e),
                l.vec3.normalize(i, i),
                l.vec3.add(n, e, l.vec3.scale(n, i, g * this._targetDeltaLen)),
                m.setTarget(n),
                l.vec3.sub(i, this._eyeEnd, t),
                l.vec3.normalize(i, i),
                l.vec3.add(n, t, l.vec3.scale(n, i, g * this._eyeDeltaLen)),
                m.setEyePosition(n, this._preventFlip),
                d === s.a.FPS) {
                    var v = c.getDistance();
                    c.setManipulatorIndex(d),
                    c.getCurrentManipulator().setDistance(this._finished ? this._fpsDist : v)
                }
                return !0 === this._finished && r.a.resolveFirstCameraAnimation(),
                !0
            }
        }()
    }),
    e.a = h
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(6)
      , a = i(940)
      , s = n.a.osg
      , o = r.a.extend({
        initialize: function() {
            r.a.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:duration", this.onDurationChanged, this),
            t.bind("setTargetAndEye", this.onTargetAndEyeChanged, this);
            var e = this.options.context.getViewer().getViewerOSGJS().getManipulator();
            this._callbackCameraAnimation = new a.a(e,t.get("duration")),
            this._nodeCameraAnimation = new s.Node,
            this._nodeCameraAnimation.setName("Feature - CameraAnimation"),
            this._nodeCameraAnimation.addUpdateCallback(this._callbackCameraAnimation)
        },
        onDurationChanged: function() {
            this._callbackCameraAnimation.setDuration(this.model.get("duration"))
        },
        onTargetAndEyeChanged: function(t) {
            this._callbackCameraAnimation.setTargetAndEye(this.model.get("target"), this.model.get("eye"), t)
        }
    });
    e.a = o
}
, , function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(2))
      , a = i.n(r)
      , s = i(4)
      , o = i(43)
      , l = i(675)
      , u = i(51)
      , h = i(87)
      , c = i(678)
      , d = i(689)
      , p = i(695)
      , f = s.a.osg
      , g = s.a.osgAnimation
      , m = s.a.osgUtil
      , v = f.StateAttribute.OVERRIDE | f.StateAttribute.ON
      , _ = function() {
        m.DisplayNormalVisitor.call(this),
        this._tangentStateSet.setRenderBinDetails(h.a.DEBUG, "RenderBin"),
        this._normalStateSet.setRenderBinDetails(h.a.DEBUG, "RenderBin")
    };
    _.prototype = f.objectInherit(m.DisplayNormalVisitor.prototype, {
        apply: function(t, e) {
            t instanceof f.Geometry && t.getCullCallback() || m.DisplayNormalVisitor.prototype.apply.call(this, t, e)
        }
    });
    var b = function(t) {
        f.NodeVisitor.call(this),
        this._cullCallback = t ? void 0 : c.a.hideCullCallback
    };
    b.prototype = f.objectInherit(f.NodeVisitor.prototype, {
        apply: function(t) {
            t instanceof f.Geometry && t._isBoneBox && t.setCullCallback(this._cullCallback),
            this.traverse(t)
        }
    });
    var x = function() {
        var t = m.DisplayGeometryVisitor.prototype.apply;
        m.DisplayGeometryVisitor.prototype.apply = function(e) {
            if (!e._isBoneBox && !e._isSkeleton) {
                t.apply(this, arguments);
                var i = e._originalStateSet;
                void 0 !== i && e.getStateSet() && i !== e.getStateSet() && e.getStateSet().setRenderBinDetails(h.a.DEBUG, "RenderBin")
            }
        }
    }
      , y = function(t) {
        var e = i.i(n.invert)(h.a);
        t._graphRender.generateRenderBin = function(t, i) {
            var n = i.className() + " ( " + i.getInstanceID() + " )";
            i.getName() && (n += "\n" + i.getName());
            var r = i.getBinNumber();
            n += "\n" + e[r] || r,
            this._selectables.set(i.getInstanceID().toString(), i),
            t.addNode(i.getInstanceID(), {
                label: n,
                description: "",
                style: "fill: " + this.getColorFromClassName(i.className()) + ";stroke-width: 0px;"
            })
        }
    }
      , S = function() {
        var t = g.UpdateMorph.prototype.updateWeights;
        g.UpdateMorph.prototype.updateWeights = function() {
            if (void 0 !== this._debugActiveTarget) {
                var e = parseInt(this._debugActiveTarget, 0);
                if (-2 === e) {
                    var i = this._weights;
                    return void (i[0] = i[1] = i[2] = i[3] = 0)
                }
                if (-1 !== e)
                    for (var n = this._targets, r = 0, a = n.length; r < a; ++r)
                        n[r].value = r === e ? 1 : 0
            }
            return t.call(this)
        }
    }
      , w = function(t, e) {
        var i = function() {
            f.NodeVisitor.call(this, f.NodeVisitor.TRAVERSE_ALL_CHILDREN)
        };
        i.prototype = f.objectInherit(f.NodeVisitor.prototype, {
            apply: function(e) {
                for (var i = e.getUpdateCallbackList(), n = 0, r = i.length; n < r; ++n) {
                    var a = i[n];
                    if (a instanceof g.UpdateMorph) {
                        var s = {};
                        s.___DEFAULT = -1,
                        s["___NO MORPH"] = -2;
                        for (var o = a._targetNames, l = 0, h = o.length; l < h; ++l)
                            s[o[l]] = l;
                        a._debugActiveTarget = -1;
                        t.add(a, "_debugActiveTarget", s).name("Name " + a.getName()).onChange(u.a.draw)
                    }
                }
                this.traverse(e)
            }
        });
        var n = new i;
        e._rootModel.accept(n)
    }
      , C = function() {
        c.a.DrawBones.prototype.apply = function(t) {
            var e = t.getInstanceID();
            this._visitedNodes[e] || (this._visitedNodes[e] = !0,
            t instanceof g.Bone && this.drawBone(t),
            this.traverse(t))
        }
    }
      , M = function(t, e) {
        this._fManager = t,
        this._rootModel = t._context.getScene().getRoot(),
        this._rootFeature = e,
        this._debugNormal = !1,
        this._debugTangent = !1,
        this._debugScale = .5,
        this._baseScale = .07 * this._rootModel.getMinimumBound().radius(),
        this._normalVisitor = new _,
        this._normalVisitor.setScale(this._baseScale * this._debugScale),
        this._geoColorVisitor = new m.DisplayGeometryVisitor,
        this._geoColorVisitor._stCenter.setRenderBinDetails(h.a.DEBUG_2, "RenderBin"),
        x(),
        this._debugGeometry = !1,
        this._debugSkinning = !1,
        this._debugShadow = !1,
        this._useGizmo = !1,
        this._useSync = !1,
        this._protoUpdateWeights = g.UpdateMorph.prototype.updateWeights,
        this._protoComputeChannels = g.UpdateMatrixTransform.prototype.computeChannels,
        this._enableRig = !0,
        t.getViewerOSGJS().getState().getShaderGeneratorProxy().addShaderGenerator("skeleton", new d.a),
        this._drawBonesVisitor = new c.a.DrawBones([]),
        C(),
        this._showSkeleton = !1,
        this._showBoneBoxes = !1,
        this._graphVisitor = m.DisplayGraph.instance(),
        y(this._graphVisitor),
        this._debugGraphNode = "Model",
        this._debugGraphRenderer = !1,
        this._displayGraph = !1,
        this._cbPick = this.onPickSelect.bind(this),
        this._fManager.getCanvas().addEventListener("dblclick", this.onTrianglePick.bind(this))
    };
    M.prototype = {
        _getSaveAElement: function() {
            return this._aSave ? this._aSave : (this._aSave = document.createElement("a"),
            document.body.appendChild(this._aSave),
            this._aSave.style.display = "none",
            this._aSave)
        },
        _download: function(t, e) {
            var i = this._fManager._context.getModel("uid").get("uid") + "_";
            i += (new Date).toString().split(" ").splice(1, 4).join("_").replace(/:/g, "_"),
            i += ".";
            var n = this._getSaveAElement();
            n.href = t,
            n.download = i + e,
            n.click()
        },
        onTakeScreenShot: function() {
            i.i(p.a)(2048, 1, this._fManager.getViewerWebGL()).toBlob(function(t) {
                this._download(URL.createObjectURL(t), "png")
            }
            .bind(this), "png", 1)
        },
        onStartMovieRecord: function() {
            var t = a()(".canvas")
              , e = t[0]
              , i = e.captureStream(25)
              , n = {
                mimeType: "video/webm; codecs=vp9"
            };
            this._recorder = new window.MediaRecorder(i,n);
            var r = []
              , s = function(t) {
                var e = window.URL.createObjectURL(t);
                this._download(e, "webm")
            }
            .bind(this);
            this._recorder.ondataavailable = function(t) {
                t.data && t.data.size > 0 && r.push(t.data)
            }
            ,
            this._recorder.onstop = function() {
                s(new Blob(r,{
                    type: "video/webm"
                }))
            }
            .bind(this),
            this._recorder.start()
        },
        onEndMovieRecord: function() {
            this._recorder && this._recorder.stop()
        },
        onTrianglePick: function(t) {
            if (!this._displayGraph) {
                var e = void 0 === t.offsetX ? t.layerX : t.offsetX
                  , i = void 0 === t.offsetY ? t.layerY : t.offsetY
                  , n = this._fManager.computeNearestIntersection2D(e, i);
                if (n) {
                    window.hit = n;
                    var r = n.nodepath[n.nodepath.length - 1]
                      , a = n.TriangleIntersection;
                    console.log("Active hit : window.hit"),
                    console.log("Name geometry : " + r.getName()),
                    console.log("Vertex indices : " + a.i1 + ", " + a.i2 + ", " + a.i3),
                    console.log("Unique id : " + r._uniqueID);
                    var s = {};
                    s[a.i1] = {},
                    s[a.i2] = {},
                    s[a.i3] = {};
                    var o = r.getVertexAttributeList();
                    for (var l in s) {
                        var u = s[l];
                        l = parseInt(l);
                        for (var h in o)
                            for (var c = o[h], d = c.getItemSize(), p = c.getElements(), f = u[h] = [], g = 0; g < d; ++g)
                                f[g] = p[l * d + g]
                    }
                    n.verts = s,
                    console.log("\n")
                }
            }
        },
        onDebugScale: function(t) {
            this._normalVisitor.setScale(this._baseScale * t),
            u.a.draw()
        },
        testCreateNormalVisitor: function() {
            this._normalVisitor._alreadyRun || (this._normalVisitor._alreadyRun = !0,
            this._normalVisitor.apply(this._rootModel))
        },
        onDebugNormal: function(t) {
            this.testCreateNormalVisitor(),
            this._normalVisitor.setNormalVisibility(t),
            u.a.draw()
        },
        onDebugTangent: function(t) {
            this.testCreateNormalVisitor(),
            this._normalVisitor.setTangentVisibility(t),
            u.a.draw()
        },
        onDebugGeometry: function() {
            this._debugGeometry ? this._geoColorVisitor.setGeometryDebug(this._rootModel) : this._debugSkinning ? this._geoColorVisitor.setSkinningDebug(this._rootModel) : this._geoColorVisitor.disableDebug(this._rootModel),
            u.a.draw()
        },
        resetGraph: function() {
            this._fManager.getCanvas().removeEventListener("dblclick", this._cbPick),
            this._graphVisitor.reset()
        },
        onDisplayGraph: function() {
            this.resetGraph(),
            this._displayGraph && (this._fManager.getCanvas().addEventListener("dblclick", this._cbPick),
            o.a.getModelDisplayed().then(this.createDebugGraph.bind(this)))
        },
        createDebugGraph: function() {
            var t;
            "Model" === this._debugGraphNode ? t = this._rootModel : "Feature" === this._debugGraphNode && (t = this._rootFeature),
            this._graphVisitor.setDisplayGraphRenderer(this._debugGraphRenderer),
            this._graphVisitor.createGraph(t),
            this._graphVisitor.setCallbackSelect(this.onNodeSelect.bind(this)),
            u.a.draw()
        },
        onDebugShadow: function(t) {
            var e = this._fManager.getFeatures().lighting;
            if (e) {
                e.getModel().set("forceShadowRedraw", t);
                for (var i = e.getModel().get("lights"), n = 0, r = i.length; n < r; ++n) {
                    var a = i[n];
                    a.getShadowMap() && (a.getShadowMap().setDebug(t),
                    a.dirty())
                }
                u.a.draw()
            }
        },
        onPickSelect: function(t) {
            var e = void 0 === t.offsetX ? t.layerX : t.offsetX
              , i = void 0 === t.offsetY ? t.layerY : t.offsetY
              , n = this._fManager.computeNearestIntersection2D(e, i);
            if (n) {
                this._graphVisitor.selectNode(n.nodepath[n.nodepath.length - 1]);
                var r = this._fManager.getFeatures().outline.getNode();
                r.setScene([n.nodepath]),
                r.showOutline(),
                this._graphVisitor.focusOnGraph()
            }
        },
        onNodeSelect: function(t) {
            if (!t.getParents)
                return void this._fManager.getFeatures().materialUI.getModel().trigger("displayOutline", t);
            for (var e = [t]; t.getParents().length > 0; )
                e.unshift(t.getParents()[0]),
                t = t.getParents()[0];
            var i = f.vec3.create()
              , n = this._rootModel.getParents()[0].getWorldMatrices()[0]
              , r = e[e.length - 1].getMinimumBound().center();
            f.vec3.transformMat4(i, r, f.computeLocalToWorld(e)),
            f.vec3.transformMat4(i, i, n),
            this._fManager.focusOnTargetAndEye(i, void 0, 1);
            var a = this._fManager.getFeatures().outline.getNode();
            a.setScene([e]),
            a.showOutline()
        },
        pasteCamera: function() {
            var t = f.vec3.create()
              , e = f.vec3.create();
            this._fManager.getCameraWithoutAutospin(t, e);
            var i = window.href + "&camera_eye=" + t.join(",") + "&camera_target=" + e.join(",")
              , n = document.createTextNode(i);
            document.body.appendChild(n);
            var r = document.createRange();
            r.selectNode(n),
            window.getSelection().removeAllRanges(),
            window.getSelection().addRange(r),
            document.execCommand("copy"),
            document.body.removeChild(n)
        },
        onEnableRig: function(t) {
            g.UpdateMatrixTransform.prototype.computeChannels = t ? this._protoComputeChannels : function() {
                this._dirty = !0;
                var t = this._matrix;
                f.mat4.identity(t);
                for (var e = this._stackedTransforms, i = 0, n = e.length; i < n; i++) {
                    var r = e[i];
                    r.resetToDefaultValue(),
                    r.applyToMatrix(t)
                }
            }
            ,
            u.a.draw()
        },
        onShowSkeleton: function(t) {
            u.a.draw();
            var e = this._drawBonesVisitor;
            if (!t)
                return void e._geoStateSet.setAttributeAndModes(new f.Depth(f.Depth.NEVER), v);
            e._geoStateSet.setAttributeAndModes(new f.Depth(f.Depth.ALWAYS), v),
            e._alreadyRun || (e._alreadyRun = !0,
            this._rootModel.accept(e))
        },
        onShowBoneBoxes: function(t) {
            this._rootModel.accept(new b(t)),
            u.a.draw()
        },
        onUseGizmo: function(t) {
            this._gizmo || (this._gizmo = new l.a(this._fManager.getViewerOSGJS()),
            this._rootFeature.addChild(this._gizmo)),
            this._gizmo.attachToGeometry(null),
            this._gizmo._autoInsertMT = t,
            this._gizmo.setTraversalMask(t ? 1 : 0),
            u.a.draw()
        }
    };
    var T = function(t, e, i) {
        var n = t.addFolder("Debug graph")
          , r = {
            Model: "Model",
            Feature: "Feature",
            None: "None"
        };
        return i._graphNode = n.add(e, "_debugGraphNode", r).name("Root"),
        i._graphNode.onChange(e.onDisplayGraph.bind(e)),
        i._graphRenderer = n.add(e, "_debugGraphRenderer").name("Renderer"),
        i._graphRenderer.onChange(e.onDisplayGraph.bind(e)),
        i._displayGraph = n.add(e, "_displayGraph").name("Display graph"),
        i._displayGraph.onChange(e.onDisplayGraph.bind(e)),
        n.open(),
        n
    }
      , A = function(t, e, i) {
        var n = t.addFolder("Display vectors");
        return i._showNormal = n.add(e, "_debugNormal").name("Display normal"),
        i._showNormal.onChange(e.onDebugNormal.bind(e)),
        i._showTangent = n.add(e, "_debugTangent").name("Display tangent"),
        i._showTangent.onChange(e.onDebugTangent.bind(e)),
        i._vectorScale = n.add(e, "_debugScale").min(0).max(2).name("Scale vectors"),
        i._vectorScale.onChange(e.onDebugScale.bind(e)),
        n.open(),
        n
    }
      , E = function(t, e, i) {
        var n = t.addFolder("Animation");
        return i._useRig = n.add(e, "_enableRig").name("Use rig"),
        i._useRig.onChange(e.onEnableRig.bind(e)),
        S(),
        w(n, e),
        i._showSkeleton = n.add(e, "_showSkeleton").name("Show skeleton"),
        i._showSkeleton.onChange(e.onShowSkeleton.bind(e)),
        i._showBoxes = n.add(e, "_showBoneBoxes").name("Show boxes"),
        i._showBoxes.onChange(e.onShowBoneBoxes.bind(e)),
        i._showSkinning = n.add(e, "_debugSkinning").name("Display skinning"),
        i._showSkinning.onChange(function(t) {
            t && e._debugGeometry && i._showGeometry.setValue(!1),
            e.onDebugGeometry()
        }),
        n.open(),
        n
    }
      , P = function(t, e, i) {
        var n = t.addFolder("Misc");
        return i._showGeometry = n.add(e, "_debugGeometry").name("Display geometry"),
        i._showGeometry.onChange(function(t) {
            t && e._debugSkinning && i._showSkinning.setValue(!1),
            e.onDebugGeometry(),
            i._showSkinning.updateDisplay()
        }),
        i._gizmo = n.add(e, "_useGizmo").name("Use gizmo"),
        i._gizmo.onChange(e.onUseGizmo.bind(e)),
        i._pasteCamera = n.add(e, "pasteCamera").name("Camera to url clipboard"),
        t.add(e, "_debugShadow").name("Debug Shadow").onChange(e.onDebugShadow.bind(e)),
        t.add({
            ScreenShot: e.onTakeScreenShot.bind(e)
        }, "ScreenShot"),
        t.add({
            StartRec: e.onStartMovieRecord.bind(e)
        }, "StartRec"),
        t.add({
            StopRec: e.onEndMovieRecord.bind(e)
        }, "StopRec"),
        n.open(),
        n
    }
      , N = function(t) {
        var e = new window.dat.GUI;
        e.domElement.style.paddingTop = "50px";
        var i = new M(this,t)
          , n = {};
        T(e, i, n),
        A(e, i, n),
        E(e, i, n),
        P(e, i, n)
    }
      , k = function(t, e) {
        var i = N.bind(t, e);
        a.a.getScript("https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5/dat.gui.min.js").done(i)
    };
    e.a = k
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(69))
      , a = i(945)
      , s = i(950)
      , o = {
        FeatureName: "environment",
        ModelType: a.a,
        ViewListType: [s.a]
    }
      , l = r.a.create(o);
    l.prototype = i.i(n.extend)({}, r.a.prototype, {
        getNode: function() {
            return this._views[0].getNodeEnvironment()
        }
    }),
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(43)
      , r = i(18)
      , a = i.n(r)
      , s = i(567)
      , o = i(916)
      , l = i(293)
      , u = i(951)
      , h = i(292)
      , c = i(717)
      , d = i(29)
      , p = {
        uid: "2fa15e0b1cee45a5b02605a288934e1b",
        brightness: 4.063
    }
      , f = a.a.Model.extend({
        _trashbin: [],
        getRandomEnvironment: function() {
            var t = [];
            return this.environmentCollection.each(function(e) {
                e.get("isDefault") && -1 === c.a.indexOf(e.get("uid")) && t.push({
                    uid: e.get("uid"),
                    brightness: e.get("brightness")
                })
            }),
            0 === t.length ? p : t[Math.round(Math.random() * (t.length - 1))]
        },
        defaults: function() {
            return {
                enable: i.i(l.a)(),
                uid: p.uid,
                exposure: p.brightness,
                backgroundEnable: !1,
                backgroundExposure: 1,
                rotation: 0,
                shadowEnable: !1,
                shadowBias: .005,
                blur: .1
            }
        },
        init: function(t) {
            this._context = t,
            this._viewer = t.getViewer();
            var e = t.getModel().get("options").environment
              , r = !0;
            e && (void 0 !== e.enable && this.set("enable", e.enable),
            void 0 !== e.exposure && this.set("exposure", e.exposure),
            void 0 !== e.rotation && this.set("rotation", e.rotation),
            void 0 !== e.uid && (this.set("uid", e.uid),
            r = !1),
            void 0 !== e.blur && this.set("blur", e.blur),
            void 0 !== e.backgroundExposure && this.set("backgroundExposure", e.backgroundExposure),
            void 0 !== e.shadowEnable && i.i(d.a)().shadowEnv && this.set("shadowEnable", e.shadowEnable),
            void 0 !== e.shadowBias && this.set("shadowBias", e.shadowBias));
            var a = t.getModel().get("user").uid;
            if (this.environmentCollection = this.createCollection(a),
            this.environmentCollection.fetch({
                remove: !1
            }),
            r) {
                var s = this.getRandomEnvironment();
                this.set("uid", s.uid),
                this.set("exposure", s.brightness)
            }
            this.checkEnvironmentValidity(),
            i.i(l.a)() && n.a.getPolygon().then(this.updateEnvironmentConfig.bind(this))
        },
        updateEnvironmentConfig: function() {
            var t = this.getEnvironment();
            if (!t)
                return void this.checkEnvironmentValidity();
            var e = i.i(u.a)(this._viewer.getRootUserData().source)[t.get("uid")];
            e ? (this.set("exposure", parseFloat(e.environmentExposure)),
            this.set("backgroundExposure", parseFloat(e.brightness)),
            this.set("rotation", parseFloat(e.rotation))) : this.set("exposure", parseFloat(t.get("brightness")) || 1);
            var n = this._viewer.getRootUserData();
            i.i(l.a)() && "Tilt Brush" === n.authoringTool && (this.set("uid", "3e2ad3e1f1ea47679f045a7eb0e6af49"),
            this.set("exposure", .5))
        },
        getEnvironmentCollection: function() {
            return this.environmentCollection
        },
        checkEnvironmentValidity: function() {
            this.getEnvironment() || (this.set("uid", p.uid),
            this.set("exposure", p.brightness))
        },
        createCollection: function(t) {
            return new s.default([],{
                filters: new o.a({
                    userUID: t
                })
            })
        },
        getName: function() {
            return "Environment"
        },
        getEnvironment: function() {
            var t = this.get("uid");
            return this.environmentCollection.find(function(e) {
                return e.get("uid") === t
            })
        },
        isShadowEnable: function() {
            return this.get("shadowEnable")
        },
        getJSON: function() {
            var t = {};
            return t.uid = this.get("uid"),
            t.enable = this.get("enable"),
            t.exposure = this.get("exposure"),
            t.rotation = this.get("rotation"),
            t.blur = this.get("blur"),
            t.backgroundExposure = this.get("backgroundExposure"),
            t.shadowEnable = this.get("shadowEnable"),
            t.shadowBias = this.get("shadowBias"),
            t
        },
        editorGetJSON: function() {
            return this.getJSON()
        },
        validateJSON: function(t) {
            var e = [];
            return h.a.isBoolean(t.enable) || e.push("Environment.editorSetJSON enable must be a boolean"),
            h.a.isNumber(t.exposure, 0, 35) || e.push("Environment.editorSetJSON exposure must be a number [0,35]"),
            h.a.isNumber(t.backgroundExposure, 0, 2) || e.push("Environment.editorSetJSON backgroundExposure must be a number between [0,2]"),
            h.a.isNumber(t.rotation, 0, 360) || e.push("Environment.editorSetJSON rotation must be a number between [0,360]"),
            h.a.isNumber(t.blur, 0, 1) || e.push("Environment.editorSetJSON blur must be a number between [0,1]"),
            h.a.isString(t.uid) || e.push("Environment.editorSetJSON uid must be a string"),
            e.join("\n")
        },
        editorSetJSON: function(t) {
            var e = this.validateJSON(t);
            return e || (this.set(t),
            this.set("exposure", t.exposure),
            e)
        }
    });
    e.a = f
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(138)
      , a = i(791)
      , s = i.n(a)
      , o = i(790)
      , l = i.n(o)
      , u = i(949)
      , h = i(87)
      , c = i(51)
      , d = n.a.osg
      , p = function() {
        d.Node.call(this),
        this._geometry = d.createTexturedBoxGeometry(0, 0, 0, 5, 5, 5),
        this._uniforms = i.i(u.a)(),
        this._show = "NONE",
        this._bgEnv = null,
        this._bgFixed = null,
        this._texRatio = 1,
        this._canvasWidth = 1,
        this._canvasHidth = 1,
        this.init(),
        this.hide()
    };
    p.prototype = d.objectInherit(d.Node.prototype, {
        init: function() {
            var t = this._geometry
              , e = t.getOrCreateStateSet();
            e.setAttributeAndModes(new d.Depth(d.Depth.LEQUAL,1,1,!1), d.StateAttribute.PROTECTED),
            e.setRenderBinDetails(h.a.BACKGROUND, "RenderBin"),
            e.setAttributeAndModes(r.a.createShader(s.a, l.a, "environment-background", "Environment"));
            var i = this._uniforms;
            for (var n in i)
                e.addUniform(i[n]);
            this.addChild(t)
        },
        getUniforms: function() {
            return this._uniforms
        },
        rescale: function(t, e) {
            t && (this._canvasWidth = t),
            e && (this._canvasHeight = e);
            var i = this._canvasWidth / this._canvasHeight
              , n = this._uniforms.scale.getInternalArray();
            i >= this._texRatio ? (n[0] = 1,
            n[1] = this._texRatio / i) : (n[0] = i / this._texRatio,
            n[1] = 1)
        },
        getBackground: function() {
            return this._bgFixed
        },
        getEnvironment: function() {
            return this._bgEnv
        },
        hide: function() {
            this._show = "NONE",
            this._update()
        },
        showColor: function() {
            this._show = "COLOR",
            this._update()
        },
        showEnvironment: function() {
            this._show = "ENV",
            this._update()
        },
        setEnvironment: function(t, e) {
            this._bgEnv = t,
            void 0 !== e && this._uniforms.size.setFloat(e),
            this._update()
        },
        setExposure: function(t) {
            this._uniforms.backgroundExposure.setFloat(t)
        },
        showBackground: function() {
            this._show = "FIXED",
            this._update()
        },
        setBackground: function(t) {
            this._texRatio = t.getWidth() / t.getHeight(),
            this._bgFixed = t,
            this._update()
        },
        _update: function() {
            if (c.a.draw(),
            "ENV" !== this._show)
                return void this._geometry.setNodeMask(0);
            this._geometry.setNodeMask(-1),
            this._bgEnv && this._geometry.getOrCreateStateSet().setTextureAttributeAndModes(0, this._bgEnv)
        }
    }),
    e.a = p
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(29)
      , a = i(384)
      , s = i(683)
      , o = i(682)
      , l = i(946)
      , u = i(70)
      , h = i(948)
      , c = i(679)
      , d = i(440)
      , p = i(43)
      , f = i(51)
      , g = n.a.osg
      , m = function(t) {
        g.Node.call(this),
        this._viewer = t,
        this._isPBR = !1,
        this._textureSpecular = void 0,
        this._textureSpecularUnit = 6,
        this._textureSpecularPBR = void 0,
        this._textureIntegrateBRDF = void 0,
        this._textureSpecularPBRUnit = 6,
        this._textureIntegrateBRDFUnit = 8,
        this._environmentBackground = new l.a,
        this._uniforms = i.i(c.a)(),
        this._adjustRotation = g.mat4.fromXRotation(g.mat4.create(), Math.PI / 2),
        this._root = new g.MatrixTransform,
        g.mat4.multiply(this._root.getMatrix(), this._root.getMatrix(), this._adjustRotation),
        this.getOrCreateStateSet(),
        this._lightsProbes = [],
        this._lights = [],
        this._lightNodes = [],
        this._shadows = [],
        this._lightDirection = [],
        this._lightNodeRoot = new g.MatrixTransform,
        this._lightNodeRoot.setName("Env Lighting - Lights"),
        g.mat4.copy(this._lightNodeRoot.getMatrix(), this._root.getMatrix()),
        this._activatedShadow = i.i(d.a)() > 12,
        this._enabledShadow = !1,
        this._shadowBias = 5e-4,
        this._enabledShadowsNum = 1,
        this._hasAnimation = !1,
        p.a.getHasAnimation().then(function(t) {
            t && (this._hasAnimation = t)
        }
        .bind(this)),
        this.addUpdateCallback(this),
        this._up = g.vec3.fromValues(0, 0, 1),
        this._eye = g.vec3.fromValues(0, 0, 0)
    };
    m.prototype = g.objectInherit(g.Node.prototype, {
        getBackground: function() {
            return this._environmentBackground
        },
        getUniforms: function() {
            return this._uniforms
        },
        createCameraNode: function() {
            var t = {}
              , e = this
              , i = function() {
                this.cull = function(i, n) {
                    g.mat4.getPerspective(t, e._mainCamera.getProjectionMatrix()),
                    g.mat4.perspective(n.getCurrentProjectionMatrix(), t.fovy * Math.PI / 180, t.aspectRatio, 1, 1e3),
                    g.mat4.copy(n.getCurrentModelViewMatrix(), e._mainCamera.getViewMatrix()),
                    g.mat4.setTranslation(n.getCurrentModelViewMatrix(), g.vec3.ZERO);
                    var r = n.getCurrentModelViewMatrix();
                    return g.mat4.multiply(e._uniforms.environmentTransform.getInternalArray(), r, e._root.getMatrix()),
                    !0
                }
            }
              , n = new g.Camera;
            return n.setName("Environment - Camera"),
            n.setCullCallback(new i),
            n.setReferenceFrame(g.Transform.ABSOLUTE_RF),
            n
        },
        init: function(t, e, i) {
            this._mainCamera = e,
            this._rootLights = i,
            this._rootLights.addChild(this._lightNodeRoot);
            for (var n in this._uniforms)
                this.getStateSet().addUniform(this._uniforms[n]);
            var r = this.createCameraNode();
            r.setNodeMask(u.a.NO_PICK_NO_SHADOW),
            this.addChild(r),
            r.addChild(this._root),
            this._root.addChild(this._environmentBackground),
            this.updateTextureUnits();
            var a = this._viewer.getFeaturesManager().getFeatures().autospin;
            a && !0 === a.getModel().get("enable") && (this._hasAnimation = !0),
            this.setShadowsEnabled(this._enabledShadow)
        },
        enable: function(t, e) {
            this.setTexturesStateSet(),
            this._shadowBias = e,
            this.setShadowsEnabled(t),
            f.a.draw()
        },
        setShadowsEnabled: function(t) {
            this._enabledShadow = t,
            this._enabledShadow ? this.activateLightsAndShadowsNumber(this._enabledShadowsNum) : this.activateLightsAndShadowsNumber(0),
            f.a.draw()
        },
        removeTexturesStateSet: function() {
            var t = this.getStateSet();
            t && (this._isPBR ? (this._textureSpecularPBR && t.removeTextureAttribute(this._textureSpecularPBRUnit, this._textureSpecularPBR.getTypeMember()),
            this._textureIntegrateBRDF && t.removeTextureAttribute(this._textureIntegrateBRDFUnit, this._textureIntegrateBRDF.getTypeMember())) : this._textureSpecular && t.removeTextureAttribute(this._textureSpecularUnit, this._textureSpecular.getTypeMember()))
        },
        setTexturesStateSet: function() {
            var t = this.getStateSet();
            t && (this._isPBR ? (this._textureSpecularPBR && t.setTextureAttributeAndModes(this._textureSpecularPBRUnit, this._textureSpecularPBR),
            this._textureIntegrateBRDF && t.setTextureAttributeAndModes(this._textureIntegrateBRDFUnit, this._textureIntegrateBRDF)) : this._textureSpecular && t.setTextureAttributeAndModes(this._textureSpecularUnit, this._textureSpecular))
        },
        hide: function() {
            this.removeTexturesStateSet(),
            this.setShadowsEnabled(!1)
        },
        disable: function() {
            this.hide()
        },
        computeLightColorIntensity: function(t, e, i) {
            var n = this._lightProbes[e];
            g.vec3.scale(t.getDiffuse(), n.color, n.sum * i),
            this._uniforms["factorShadowEnv" + e].setFloat(2 * n.lum_ratio)
        },
        setExposure: function(t) {
            if (this._uniforms.exposure.setFloat(t),
            this._lightProbe && !(this._lights.length >= this._lightProbes.length))
                for (var e = 0, i = this._lights.length; e < i; e++) {
                    var n = this._lights[e];
                    this.computeLightColorIntensity(n, e, t)
                }
        },
        setBackgroundExposure: function(t) {
            this._environmentBackground.setExposure(t),
            f.a.draw()
        },
        setShadowsBias: function(t) {
            this._shadowBias = t;
            for (var e = 0, i = this._lights.length; e < i; e++)
                this._shadows[e].setBias(t),
                this._shadows[e].requestRedraw();
            f.a.draw()
        },
        addLightAndShadow: function(t) {
            if (!this._lightProbes || 0 === this._lightProbes.length)
                return !1;
            if (!this._viewer.getFeaturesManager())
                return !1;
            var e, n, l, h, c;
            t < this._lights.length ? (h = this._lightNodes[t],
            l = this._lights[t],
            n = this._shadows[t],
            c = this._lightDirection[t]) : (e = o.a.createLight("Environment", t, a.a.ENV),
            n = e.shadowMap,
            l = e.light,
            h = e.node,
            h.addChild(e.lightSource),
            n.setEnabled(this._hasAnimation && e.enableShadow),
            this._lightNodeRoot.addChild(h),
            this._lightNodes.push(h),
            this._lights.push(l),
            this._shadows.push(n),
            c = g.vec3.create(),
            this._lightDirection.push(c)),
            n.setBias(this._shadowBias),
            this._rootLights.addShadowTechnique(n),
            g.vec3.copy(c, this._lightProbes[t].direction);
            var d = h.getMatrix();
            if (Math.abs(g.vec3.dot(this._up, c)) > .999 && (this._up = 1 !== this._up[1] ? g.vec3.set(0, 1, 0, this._up) : g.vec3.set(1, 0, 0, this._up)),
            g.mat4.lookAtDirection(d, this._eye, c, this._up),
            g.mat4.invert(d, d),
            i.i(r.a)().debugEnvShadow) {
                var p = g.createAxisGeometry()
                  , f = new g.MatrixTransform;
                f.setMatrix(g.mat4.fromScaling(g.mat4.create(), [100, 100, -500])),
                g.mat4.setTranslation(f.getMatrix(), [0, 0, 500]),
                f.addChild(p);
                var m = new s.a.createDirectionalGeometry(5);
                f.addChild(m),
                f.setNodeMask(u.a.NO_PICK_NO_SHADOW),
                h.addChild(f)
            }
            var v = this._uniforms.exposure.getInternalArray()[0];
            return this.computeLightColorIntensity(l, t, v),
            !0
        },
        removeLightAndShadow: function(t) {
            if (!this._viewer.getFeaturesManager())
                return !1;
            this._lights[t].setEnabled(!1);
            var e = this._lightNodes[t];
            e.editMask = 0,
            e.setNodeMask(0),
            this._lightNodeRoot.removeChild(e);
            var i = this._rootLights
              , n = this._shadows[t];
            return i.removeShadowTechnique(n),
            this._lightNodes.splice(t, 1),
            this._lights.splice(t, 1),
            this._shadows.splice(t, 1),
            this._lightDirection.splice(t, 1),
            !0
        },
        setLightsAndShadowsNumber: function() {
            this._enabledShadow && this._lightProbes.length >= this._enabledShadowsNum ? this.activateLightsAndShadowsNumber(this._enabledShadowsNum) : this.activateLightsAndShadowsNumber(0)
        },
        activateLightsAndShadowsNumber: function(t) {
            if (!this._activatedShadow)
                return !1;
            var e, i = this._lights.length;
            if (0 === t)
                for (; 0 < i; i--)
                    this.removeLightAndShadow(i - 1);
            else {
                for (e = 0; e < t; e++)
                    if (!this.addLightAndShadow(e))
                        return !1;
                for (; i > e; i--)
                    if (!this.removeLightAndShadow(i - 1))
                        return !1
            }
            for (e = 0,
            i = this._lights.length; e < i; e++)
                this._shadows[e].requestRedraw();
            return g.mat4.copy(this._lightNodeRoot.getMatrix(), this._root.getMatrix()),
            f.a.draw(),
            !0
        },
        update: function() {
            if (0 === this._lights.length)
                return !0;
            var t = this._viewer.getFeaturesManager();
            if (!t)
                return !0;
            if (t.getShadowForcedUpdate())
                for (var e = 0, i = this._lights.length; e < i; e++)
                    this._shadows[e].requestRedraw();
            return !0
        },
        updateRotation: function(t) {
            if (g.mat4.fromZRotation(this._root.getMatrix(), -t),
            g.mat4.multiply(this._root.getMatrix(), this._root.getMatrix(), this._adjustRotation),
            g.mat4.copy(this._lightNodeRoot.getMatrix(), this._root.getMatrix()),
            this._activatedShadow)
                for (var e = 0, i = this._lights.length; e < i; e++)
                    this._shadows[e].requestRedraw()
        },
        setBackgroundTexture: function(t, e) {
            this._environmentBackground.setEnvironment(t, e)
        },
        showBackground: function() {
            this._environmentBackground.showEnvironment()
        },
        hideBackground: function() {
            this._environmentBackground.hide()
        },
        setDiffuseSPH: function(t) {
            for (var e = this.getUniforms().diffuseSPH.getInternalArray(), i = 1 / (2 * Math.sqrt(Math.PI)), n = -.5 * Math.sqrt(3 / Math.PI), r = -n, a = n, s = .5 * Math.sqrt(15 / Math.PI), o = -s, l = .25 * Math.sqrt(5 / Math.PI), u = o, h = .25 * Math.sqrt(15 / Math.PI), c = [i, i, i, n, n, n, r, r, r, a, a, a, s, s, s, o, o, o, l, l, l, u, u, u, h, h, h], d = 0; d < 27; ++d)
                e[d] = t[d] * c[d]
        },
        setSpecularTexture: function(t) {
            this._textureSpecular = new h.a(t,"Specular"),
            this.updateTextureUnits(),
            this.getUniforms().textureSpecular.setInt(this._textureSpecularUnit)
        },
        setSpecularPBRTexture: function(t, e) {
            this._textureSpecularPBR = new h.a(t,"SpecularPBR");
            var i = "TextureCubeMap" === t.className();
            this._textureSpecularPBR.setIsCubemap(i),
            this._textureSpecularPBR.updateLodRange(e),
            this.updateTextureUnits(),
            this.getUniforms().textureSpecularPBR.setInt(this._textureSpecularPBRUnit)
        },
        setLightProbes: function(t) {
            this._lights && 0 !== this._lights.length && this.activateLightsAndShadowsNumber(0),
            t && 0 !== t.length && (this._lightProbes = t,
            this.setLightsAndShadowsNumber())
        },
        setIntegrateBRDFTexture: function(t) {
            this._textureIntegrateBRDF = new h.a(t,"IntegrateBRDF"),
            this.updateTextureUnits(),
            this.getUniforms().textureIntegrateBRDF.setInt(this._textureIntegrateBRDFUnit)
        },
        updateTextureUnits: function() {
            this.setTexturesStateSet()
        },
        setIsPBR: function(t) {
            this._isPBR = t
        }
    }),
    e.a = m
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(679)
      , a = n.a.osg
      , s = function(t, e) {
        this._texture = t,
        this._channel = e || "Specular",
        this._isCubemap = !1,
        this._commonUniforms = i.i(r.a)()
    };
    s.uniforms = {},
    s.prototype = a.objectLibraryClass(a.objectInherit(a.Texture.prototype, {
        attributeType: "Texture",
        channelType: ["Specular", "SpecularPBR", "IntegrateBRDF"],
        getUniformName: function(t) {
            return "uTextureEnvironment" + this.getChannel() + t
        },
        getOrCreateUniforms: function() {
            var t = s.uniforms
              , e = this.getChannel();
            if (t[e])
                return t[e];
            var i = this._texture;
            return t[e] = {
                size: a.Uniform.createFloat2([i.getWidth(), i.getHeight()], this.getUniformName("TextureSize"))
            },
            t[e]
        },
        setIsCubemap: function(t) {
            this._isCubemap = t
        },
        getIsCubemap: function() {
            return this._isCubemap
        },
        getCommonUniforms: function() {
            return this._commonUniforms
        },
        getTexture: function() {
            return this._texture
        },
        getChannel: function() {
            return this._channel
        },
        cloneType: function() {
            return new s(new a.Texture)
        },
        getHash: function() {
            return "osgSketchfabTextureEnvironment" + this.getChannel()
        },
        updateLodRange: function(t) {
            var e = this.getOrCreateUniforms()
              , i = Math.log(this._texture.getWidth()) / Math.LN2
              , n = i - Math.log(t) / Math.LN2;
            if (e.lodRange) {
                var r = e.lodRange.getInternalArray();
                r[0] = i,
                r[1] = n
            } else
                e.lodRange = a.Uniform.createFloat2([i, n], this.getUniformName("LodRange"))
        },
        apply: function(t, e) {
            var i = this._texture;
            void 0 !== i && i.apply(t);
            var n = this.getOrCreateUniforms(e)
              , r = n.size.getInternalArray();
            r[0] = i.getWidth(),
            r[1] = i.getHeight()
        }
    }), "osgSketchfab", "TextureEnvironment"),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n, r = i(4), a = r.a.osg, s = function() {
        return n || (n = {
            texture0: a.Uniform.createInt1(0, "uTexture0"),
            backgroundExposure: a.Uniform.createFloat(1, "uBackgroundExposure"),
            size: a.Uniform.createFloat(1, "uSize"),
            color: a.Uniform.createFloat3(a.vec3.fromValues(0, 0, 1), "uBackgroundColor"),
            scale: a.Uniform.createFloat2(a.vec2.fromValues(1, 1), "uFixedScale")
        })
    };
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(68))
      , a = i.n(r)
      , s = i(7)
      , o = i.n(s)
      , l = i(4)
      , u = i(6)
      , h = i(43)
      , c = i(947)
      , d = i(89)
      , p = i(495)
      , f = i(356)
      , g = i(29)
      , m = i(51)
      , v = i.i(g.a)().panorama
      , _ = l.a.osg
      , b = u.a.extend({
        initialize: function() {
            u.a.prototype.initialize.apply(this, arguments),
            this._viewer = this.options.context.getViewer(),
            this._environment = new c.a(this._viewer),
            this._environment.setName("Feature - Environment"),
            this._backgroundLoaded = {},
            this.model.bind("change:enable", this.onEnableChanged, this),
            this.model.bind("change:exposure", this.onExposureChanged, this),
            this.model.bind("change:backgroundExposure", this.onExposureChanged, this),
            this.model.bind("change:rotation", this.onRotationChanged, this),
            this.model.bind("change:uid", this.onUIDChanged, this),
            this.model.bind("change:backgroundEnable", this.onBackgroundEnableChanged, this),
            this.model.bind("change:blur", this.onBlurChanged, this),
            f.a.bind("change:mask", this.onEnvironmentChanged, this),
            this.model.bind("change", m.a.draw),
            this.resourceDefer = o.a.defer(),
            this.options.context.getScene().addResourcePromise(this.resourceDefer.promise),
            this.model.bind("change:shadowEnable", this.onShadowEnable, this),
            this.model.bind("change:shadowBias", this.onShadowBiasChanged, this),
            this.initEnvironment(),
            this.initRotateEnvironment()
        },
        initEnvironment: function() {
            this.onRotationChanged(),
            this.onExposureChanged(),
            this.onEnableChanged()
        },
        initRotateEnvironment: function() {
            if (this._viewer.getViewerOSGJS()) {
                this._mouseKeyboard = this._viewer.getViewerOSGJS().getEventProxy().StandardMouseKeyboard,
                this._rotEnv = !1,
                this.mx_ = 0;
                var t = this.options.context.getViewer().getCanvas();
                t.addEventListener("mousedown", this.onMouseDown.bind(this)),
                t.addEventListener("mouseup", this.onMouseUp.bind(this)),
                t.addEventListener("mouseout", this.onMouseUp.bind(this)),
                t.addEventListener("mousemove", this.onMouseMove.bind(this)),
                h.a.getModelDisplayed().then(this.initOnTriplePan.bind(this))
            }
        },
        initOnTriplePan: function() {
            var t = this._viewer.getViewerOSGJS().getEventProxy();
            if (t.Hammer && t.Hammer._hammer) {
                var e = t.Hammer._hammer
                  , i = e.handlers.panstart
                  , n = e.handlers.panmove
                  , r = e.handlers.panend
                  , a = e.handlers.pinchend;
                if (1 === i.length && 1 === n.length && 1 === r.length && 1 === a.length) {
                    var s = i[0]
                      , o = n[0]
                      , l = r[0]
                      , u = a[0];
                    e.off("panstart", s),
                    e.off("panmove", o),
                    e.off("panmove", l),
                    this._evProxy = {
                        altKey: !0,
                        shiftKey: !1,
                        ctrlKey: !1
                    },
                    e.on("panstart", this.onPanStart.bind(this, s)),
                    e.on("panmove", this.onPanMove.bind(this, o, u)),
                    e.on("panend", this.onPanEnd.bind(this, l))
                }
            }
        },
        onPanStart: function(t, e) {
            if (e.pointers.length < 3)
                return t(e);
            this._evProxy.pageX = e.center.x,
            this.onMouseDown(this._evProxy)
        },
        onPanMove: function(t, e, i) {
            if (i.pointers.length < 3)
                return t(i);
            this._evProxy.pageX = i.center.x,
            this._rotEnv || (this.onMouseDown(this._evProxy),
            e(i)),
            this.onMouseMove(this._evProxy)
        },
        onPanEnd: function(t, e) {
            this.onMouseUp(),
            t(e)
        },
        onMouseDown: function(t) {
            t.altKey && (this._rotEnv = !0,
            this._mouseKeyboard.setEnable(!1),
            this.mx_ = t.pageX)
        },
        onMouseMove: function() {
            var t = _.mat4.create()
              , e = _.mat4.create();
            return function(i) {
                if (this._rotEnv) {
                    var n = !i.ctrlKey
                      , r = !i.shiftKey;
                    m.a.draw();
                    var a = (i.pageX - this.mx_) / 100;
                    if (this.mx_ = i.pageX,
                    n) {
                        var s = (this.model.get("rotation") + a) % (2 * Math.PI);
                        this.model.set("rotation", s < 0 ? s + 2 * Math.PI : s)
                    }
                    if (r) {
                        var o = this.options.context
                          , l = o.getFeatures().lighting;
                        if (!l)
                            return;
                        var u = o.getScene().getRoot().getMinimumBound().center();
                        _.mat4.fromZRotation(t, -a % (2 * Math.PI)),
                        _.vec3.negate(u, u),
                        _.mat4.multiply(t, t, _.mat4.fromTranslation(e, u)),
                        _.vec3.negate(u, u),
                        _.mat4.multiply(t, _.mat4.fromTranslation(e, u), t);
                        for (var h = l.getModel().get("lights"), c = 0, d = h.length; c < d; ++c) {
                            var p = h[c];
                            if (!p.isAttachedToCamera()) {
                                var f = p.get("matrix");
                                _.mat4.multiply(f, t, f),
                                p.dirty()
                            }
                        }
                    }
                }
            }
        }(),
        onMouseUp: function() {
            this._rotEnv = !1
        },
        onUIDChanged: function() {
            this.model.updateEnvironmentConfig(),
            this.onEnvironmentChanged()
        },
        getNodeEnvironment: function() {
            return this._environment
        },
        getResourceManager: function() {
            return this._resourceManager || d.default.instance
        },
        onEnableChanged: function() {
            this.model.get("enable") ? this._environment.enable(this.model.get("shadowEnable"), this.model.get("shadowBias")) : this._environment.disable(),
            this.onEnvironmentChanged()
        },
        onShadowEnable: function() {
            this._environment.setShadowsEnabled(this.model.get("shadowEnable"))
        },
        onShadowBiasChanged: function() {
            this._environment.setShadowsBias(this.model.get("shadowBias"))
        },
        onExposureChanged: function() {
            this._environment.setExposure(this.model.get("exposure")),
            this._environment.setBackgroundExposure(this.model.get("backgroundExposure"))
        },
        onRotationChanged: function() {
            this._environment.updateRotation(this.model.get("rotation"))
        },
        onBlurChanged: function() {
            this.abortLastDownloadEnv(),
            this.model.get("backgroundEnable") && this.onBackgroundEnableChanged()
        },
        onBackgroundEnableChanged: function() {
            if (this.model.get("backgroundEnable"))
                return this.setBackground()
        },
        resolvePreload: function() {
            this.resourceDefer && (this.resourceDefer.resolve(),
            this.resourceDefer = void 0)
        },
        onEnvironmentChanged: function() {
            var t = this.getEnvironment();
            if (!t || !this.model.get("enable"))
                return void this.resolvePreload();
            this._onlyLowRes = !0,
            this.setEnvironment(t).then(function() {
                var e = t.get("uid") === this.model.get("uid");
                i.i(g.a)().preload && e || this.resolvePreload(),
                e && (this._onlyLowRes = !1,
                this.setEnvironment(t).finally(this.resolvePreload.bind(this)))
            }
            .bind(this))
        },
        getEnvironment: function() {
            return this.model.getEnvironment()
        },
        getName: function() {
            return "Environment3D"
        },
        abortLastDownloadEnv: function() {
            for (var t = this.model.get("uid"), e = this.model.get("blur"), i = this.getResourceManager()._resourceLoader._processing, n = 0, r = i.length; n < r; ++n) {
                var a = i[n]
                  , s = a.getXHR();
                s && (void 0 !== a._envUID && a._envUID !== t && s.abort(),
                void 0 !== a._envBlur && a._envBlur !== e && s.abort())
            }
        },
        setEnvironment: function(t) {
            this.abortLastDownloadEnv();
            var e = [];
            if (f.a.get("mask") & f.a.LIT) {
                var i = f.a.get("mask") & f.a.PBR;
                this._environment.setIsPBR(i),
                this._environment.setDiffuseSPH(t.get("diffuseSPH")),
                this._environment.setLightProbes(t.get("lights"), t.id),
                i ? this.setEnvironmentPBR(t, e) : this.setEnvironmentOld(t, e)
            }
            return this.model.get("backgroundEnable") && e.push(this.onBackgroundEnableChanged()),
            0 === e.length && e.push(o.a.resolve()),
            this.wrapPromises(e)
        },
        setEnvironmentPBR: function(t, e) {
            var r = this._environment
              , s = t.get("textures")
              , o = !1;
            _.WebGLCaps.instance().getWebGLExtension("EXT_shader_texture_lod") && (o = !0),
            v && (o = !1);
            var l = i.i(n.find)(s, {
                encoding: "luv",
                type: "specular_ue4",
                format: o ? "cubemap" : "panorama"
            })
              , u = this.getImageRes(l)
              , h = {
                cubemap: o,
                panoramaLUV: !o,
                cubemapLUV: o,
                size: u.width,
                minFilter: o ? _.Texture.LINEAR_MIPMAP_LINEAR : _.Texture.LINEAR,
                magFilter: _.Texture.LINEAR,
                wrapS: _.Texture.CLAMP_TO_EDGE,
                wrapT: _.Texture.CLAMP_TO_EDGE,
                transferToGPU: !0
            }
              , c = this.getResourceManager().getOrCreateTexture(u.file, h);
            this.markLastXHR(this.model.get("uid")),
            c.texture.setFlipY(!o);
            var d = this.getPromiseTexture(c);
            if (d.then(r.setSpecularPBRTexture.bind(r, c.texture, l.limitSize)),
            e.push(d),
            !a.a.any) {
                var p = i.i(n.find)(s, {
                    type: "brdf_ue4"
                });
                h = {
                    integrateBRDFLUV: !0,
                    minFilter: _.Texture.NEAREST,
                    magFilter: _.Texture.NEAREST,
                    wrapS: _.Texture.CLAMP_TO_EDGE,
                    wrapT: _.Texture.CLAMP_TO_EDGE,
                    transferToGPU: !0
                };
                var f = this.getResourceManager().getOrCreateTexture(this.getImageRes(p).file, h);
                this.markLastXHR(this.model.get("uid")),
                f.texture.setFlipY(!1);
                var g = this.getPromiseTexture(f);
                g.then(r.setIntegrateBRDFTexture.bind(r, f.texture)),
                e.push(g)
            }
        },
        getBackgroundResource: function(t, e, r) {
            var a, s = i.i(n.find)(t, {
                encoding: "luv",
                type: "background",
                format: "cubemap"
            });
            return a = void 0 !== r ? this.getClosestBlur(s, r) : this.getImageRes(s, 512),
            e.cubemap = !0,
            e.cubemapLUV = !0,
            e.size = a.width,
            e.minFilter = _.Texture.LINEAR,
            e.magFilter = _.Texture.LINEAR,
            e.wrapS = _.Texture.CLAMP_TO_EDGE,
            e.wrapT = _.Texture.CLAMP_TO_EDGE,
            e.transferToGPU = !0,
            a
        },
        setEnvironmentOld: function(t, e) {
            var i = this._environment
              , n = {}
              , r = this.getBackgroundResource(t.get("textures"), n)
              , a = this.getResourceManager().getOrCreateTexture(r.file, n);
            this.markLastXHR(this.model.get("uid"));
            var s = this.getPromiseTexture(a);
            s.then(i.setSpecularTexture.bind(i, a.texture)),
            e.push(s)
        },
        setBackground: function() {
            var t = this.getEnvironment();
            if (!t)
                return o.a.reject();
            var e = {}
              , i = this.getBackgroundResource(t.get("textures"), e, this.model.get("blur"))
              , n = this._backgroundLoaded;
            if (this.getRequestLowRes()) {
                if (n[i.file])
                    return n[i.file];
                i = this.getBackgroundResource(t.get("textures"), e, 1)
            }
            var r = this._environment
              , a = this.getResourceManager().getOrCreateTexture(i.file, e);
            this.markLastXHR(this.model.get("uid"), this.model.get("blur"));
            var s = this.getPromiseTexture(a);
            return s.then(function() {
                r.setBackgroundTexture(a.texture, i.width),
                n[i.file] = a
            }),
            h.a.getHighResLoaded().then(this._viewer.setFakeSecondaryProgress.bind(this._viewer, s, 0)),
            s
        },
        markLastXHR: function(t, e) {
            var i = this.getResourceManager()._resourceLoader._processing;
            if (i.length > 0) {
                var n = i[i.length - 1];
                n._envUID = t,
                void 0 === e || this.getRequestLowRes() || (n._envBlur = e)
            }
        },
        wrapPromises: function(t) {
            var e = o.a.settle(t);
            return h.a.getHighResLoaded().then(this._viewer.setFakeSecondaryProgress.bind(this._viewer, e, 0)),
            e
        },
        getPromiseTexture: function(t) {
            return this._onlyLowRes || i.i(g.a)().preload ? t.promise : o.a.all([t.promise, h.a.getFirstCameraAnimation()])
        },
        getRequestLowRes: function() {
            return this._onlyLowRes && !i.i(g.a)().preload
        },
        getImageRes: function(t, e) {
            var i = new p.a(t);
            if (this.getRequestLowRes())
                return i.findImageSmallest();
            var n = void 0 !== e ? e : 1 / 0;
            return i.findImageNearestPowerOfTwoUpToResolution(n, n)
        },
        getClosestBlur: function(t, e) {
            for (var i = t.images, n = 0, r = 1 / 0, a = 0, s = i.length; a < s; ++a) {
                var o = Math.abs(i[a].blur - e);
                o < r && (n = a,
                r = o)
            }
            return i[n]
        }
    });
    e.a = b
}
, function(t, e, i) {
    "use strict";
    var n = {
        "2e9c3708feb74137b0436f946b8b66b8": {
            rotation: 1.6,
            environmentExposure: 4.27,
            brightness: 1.12
        },
        "5efd61a025f6400886ab975e2ac3d9c5": {
            rotation: 3.15,
            environmentExposure: 1.19,
            brightness: 1.21
        },
        "80fba9759ab94307a782f38d359b8ea8": {
            rotation: 1.57,
            environmentExposure: 14.19,
            brightness: 1
        },
        "268447ca0a954f44b06d1387863d114e": {
            rotation: 6.25,
            environmentExposure: 2.1,
            brightness: 1
        },
        "003c1543cd754a19a0e14bc89726ccf5": {
            rotation: 1.82,
            environmentExposure: 1,
            brightness: 1
        },
        "3e2ad3e1f1ea47679f045a7eb0e6af49": {
            rotation: .3,
            environmentExposure: .59,
            brightness: 1
        },
        "2fa15e0b1cee45a5b02605a288934e1b ": {
            rotation: .68,
            environmentExposure: 4,
            brightness: 1
        },
        "9190e8da70694ef3b9d1d0c01541917e": {
            rotation: 3.24,
            environmentExposure: 2.5,
            brightness: .57
        },
        "749a0594343e4ff9a2875cb411d0ad1a": {
            rotation: 4.73,
            environmentExposure: .5,
            brightness: 1
        },
        f2dabeb04674446696486eea67028bd8: {
            rotation: 4.71,
            environmentExposure: .76,
            brightness: 1.5
        },
        df380da788ee444885722735039b0c09: {
            rotation: .27,
            environmentExposure: 1.4,
            brightness: 1.46
        },
        "16cdcddf277d423d99094f8db0c731e9": {
            rotation: 3.73,
            environmentExposure: 2.4,
            brightness: .53
        },
        c281dff366844cbc8b33179337037f42: {
            rotation: 3.64,
            environmentExposure: 7,
            brightness: .53
        }
    }
      , r = {
        substancepainter: n
    }
      , a = {}
      , s = function(t) {
        return r[t] || a
    };
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(953)
      , a = i(954)
      , s = {
        FeatureName: "fov",
        ModelType: r.a,
        ViewListType: [a.a]
    };
    e.a = n.a.create(s)
}
, function(t, e, i) {
    "use strict";
    var n = i(15)
      , r = i(292)
      , a = n.a.extend({
        defaults: {
            fov: 45,
            nearFarRatio: .005
        },
        getName: function() {
            return "Fov"
        },
        init: function(t) {
            var e = t.getModel().get("options")
              , i = e.scene;
            e.scene && (i.fov && this.set("fov", i.fov),
            i.nearFarRatio && this.set("nearFarRatio", i.nearFarRatio))
        },
        getJSON: function() {
            return {
                fov: this.get("fov"),
                nearFarRatio: this.get("nearFarRatio")
            }
        },
        editorGetJSON: function() {
            return this.getJSON()
        },
        validateJSON: function(t) {
            var e = [];
            return r.a.isNumber(t.fov, 1, 179) || e.push("Fov.editorSetJSON fov must be a number in range [1, 179]"),
            r.a.isNumber(t.nearFarRatio, 1e-4, .005) || e.push("Fov.editorSetJSON nearFarRatio must be a number in range [0.0001, 0.005]"),
            e.join("\n")
        },
        editorSetJSON: function(t) {
            var e = this.validateJSON(t);
            return e || (this.set("fov", t.fov),
            this.set("nearFarRatio", t.nearFarRatio),
            e)
        }
    });
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(6)
      , a = i(51)
      , s = n.a.osg
      , o = r.a.extend({
        initialize: function() {
            r.a.prototype.initialize.apply(this, arguments),
            this.model.bind("change:fov", this.onFov, this),
            this.model.bind("change:nearFarRatio", this.onNearFarRatio, this),
            this._viewer = this.options.context.getViewer(),
            this._dolly = !1,
            this.onFov(),
            this._dolly = !0,
            this.onNearFarRatio()
        },
        onFov: function() {
            var t = this._viewer.getCamera()
              , e = t.getViewport()
              , i = e.width() / e.height();
            if (s.mat4.perspective(t.getProjectionMatrix(), this.model.get("fov") * Math.PI / 180, i, 1, 1e3),
            this._dolly) {
                var n = this.options.context.getViewer().getViewerOSGJS().getManipulator()
                  , r = n.getCurrentManipulator();
                if (r) {
                    var o = r.getHomeBound();
                    o && n.setDistance(r.getHomeDistance(o))
                }
            }
            var l = this._viewer.getFeatures().manipulator;
            l && l.getModel().saveCameraPosition(),
            a.a.draw()
        },
        onNearFarRatio: function() {
            var t = this._viewer.getFeatures().manipulator;
            t && t.getModel().set("minSpeed", 15 * this.model.get("nearFarRatio")),
            a.a.draw()
        }
    });
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(7)
      , a = i.n(r)
      , s = i(43)
      , o = i(87)
      , l = i(151)
      , u = i(356)
      , h = i(554)
      , c = i(29)
      , d = i(385)
      , p = i(1058)
      , f = n.a.osg
      , g = n.a.osgAnimation
      , m = a.a.defer()
      , v = window.sketchfabViewerStats = {
        promiseReady: m.promise,
        materialCountBefore: 0,
        materialCountAfter: 0,
        nodeCountBefore: 0,
        nodeCountAfter: 0,
        matrixTransformCountBefore: 0,
        matrixTransformCountAfter: 0,
        geometryCountBefore: 0,
        geometryCountAfter: 0,
        boneCountBefore: 0,
        boneCountAfter: 0,
        skeletonCountBefore: 0,
        skeletonCountAfter: 0,
        morphGeometryCountBefore: 0,
        morphGeometryCountAfter: 0,
        rigGeometryCountBefore: 0,
        rigGeometryCountAfter: 0
    }
      , _ = {
        splitLimit: 65535,
        limitMergePerMaterial: 100,
        isTransparent: !1,
        isWireframe: !1,
        protectedGeometries: {},
        channelTargetNames: {},
        bakedGeometriesFromID: {},
        parentCountFromID: {},
        childrenCountFromID: {},
        multiParentPathFromGeometryID: {},
        animatedFromID: {},
        reports: v
    }
      , b = {};
    b[f.PrimitiveSet.POINTS] = !0,
    b[f.PrimitiveSet.LINES] = !0,
    b[f.PrimitiveSet.TRIANGLES] = !0;
    var x = {};
    x[f.PrimitiveSet.POINTS] = !0,
    x[f.PrimitiveSet.LINES] = !0,
    x[f.PrimitiveSet.TRIANGLES] = !0,
    x[f.PrimitiveSet.TRIANGLE_STRIP] = !0;
    var y, S, w = {
        Vertex: 1,
        Normal: 1,
        Tangent: 1
    }, C = function(t, e) {
        var i = t[t.length - 1];
        return e[e.length - 1].getVertexAttributeList().Vertex.getElements().length - i.getVertexAttributeList().Vertex.getElements().length
    }, M = function(t) {
        return t === o.a.TRANSPARENT_BIN
    }, T = function(t) {
        return t.getVertexAttributeList().Vertex.getElements().length / 3
    }, A = function(t) {
        return t[t.length - 1].getVertexAttributeList().Vertex.getElements().length / 3
    }, E = function(t) {
        var e = t.getStateSet();
        return e && e.getAttribute("SketchfabMaterial") ? e : void 0
    }, P = function(t, e) {
        for (var i = e || 0, n = t.length - 1; n >= i; --n) {
            var r = E(t[n]);
            if (r)
                return r
        }
    }, N = function(t) {
        for (var e = 0, i = t.length; e < i; ++e)
            t[e].removeChildren()
    }, k = function(t) {
        for (var e = 0, i = t.length - 1; e < i; ++e)
            t[e].addChild(t[e + 1])
    }, F = function(t) {
        for (var e = t.length, i = 0; i < e; ++i)
            N(t[i])
    }, D = function(t) {
        var e = t[t.length - 1].getInstanceID()
          , i = _.multiParentPathFromGeometryID;
        return Boolean(i[e])
    }, R = function(t, e, i) {
        var n = t.getElements()
          , r = e.getElements()
          , a = t.getItemSize()
          , s = e.getItemSize();
        if (a === s)
            return void n.set(r, i);
        for (var o = r.length / s, l = 0; l < o; ++l) {
            var u = l * a
              , h = l * s;
            n[i + u] = r[h],
            n[i + u + 1] = r[h + 1],
            n[i + u + 2] = r[h + 2]
        }
    }, I = function(t, e, i) {
        var n = e.getVertexAttributeList().Vertex.getElements()
          , r = t.getVertexAttributeList().Vertex.getElements();
        e.getVertexAttributeList().Vertex.setElements(r.subarray(i, i + n.length)),
        t._boundingBox.copy(e.getBoundingBox()),
        t._boundingBoxComputed = !0;
        var a = e.getBoundingSphere()
          , s = t._boundingSphere;
        s.set(f.vec3.copy(s.center(), a.center()), a.radius()),
        t._boundingSphereComputed = !0,
        e.getVertexAttributeList().Vertex.setElements(n),
        e.dirtyBound()
    }, O = function(t, e, i, n) {
        var r = _.bakedGeometriesFromID[e.getInstanceID()];
        r || (_.bakedGeometriesFromID[i.getInstanceID()] = !0);
        var a = 9 === t.length
          , s = i.getElements();
        n && (s = s.subarray(n));
        var o = e.getElements();
        if (r || (a ? f.mat3.equals(f.mat3.IDENTITY, t) : f.mat4.equals(f.mat4.IDENTITY, t)))
            return void (i !== e && R(i, e, n || 0));
        for (var l = a ? f.vec3.transformMat3 : f.vec3.transformMat4, u = e.getItemSize(), h = f.vec3.create(), c = Math.min(o.length, s.length), d = 0; d < c; d += u)
            h[0] = o[d],
            h[1] = o[d + 1],
            h[2] = o[d + 2],
            l(h, h, t),
            s[d] = h[0],
            s[d + 1] = h[1],
            s[d + 2] = h[2],
            4 === u && (s[d + 3] = o[d + 3])
    }, L = function(t, e, i, n) {
        var r = i.getIndices()
          , a = r.getElements()
          , s = a.length
          , o = 0
          , l = i.getMode()
          , u = t[l]
          , h = u.primitive
          , c = h.getIndices().getElements()
          , d = h.getCount()
          , p = x[l] && !_.isTransparent
          , g = d;
        if (l === f.PrimitiveSet.TRIANGLE_STRIP && p) {
            var m = c[d - 1]
              , v = a[0] + n
              , b = m !== v && 0 !== d ? 2 : 0
              , y = d % 2;
            b && (c[d] = m,
            c[d + 1] = v),
            y && (c[d + b] = v),
            g += b + y,
            c.set(a, g)
        } else
            c.set(a, g);
        h.setCount(g + s);
        var S = g + s;
        for (o = g; o < S; ++o)
            c[o] += n;
        p || (i.setIndices(h.getIndices()),
        i.setCount(s),
        i.setFirst(g * c.BYTES_PER_ELEMENT),
        _.isTransparent || e.push(i))
    }, B = function(t, e, i, n) {
        for (var r = i.length, a = _.isTransparent, s = 0; s < r; ++s) {
            var o = i[s]
              , l = o.getMode();
            if (o instanceof f.DrawElements)
                L(t.DrawElements, e, o, n);
            else if (o instanceof f.DrawArrays) {
                var u = t.DrawArrays[l];
                a ? o.first += n : u && u.primitive.count === n && 0 === o.getFirst() ? u.primitive.count += o.getCount() : e.push(new f.DrawArrays(l,o.getFirst() + n,o.getCount()))
            } else
                o instanceof f.DrawArrayLengths && (a ? o.first += n : e.push(new f.DrawArrayLengths(l,o.getFirst() + n,o.getArrayLengths().slice())))
        }
    }, V = function(t) {
        for (var e = [{
            nbVertex: A(t[0]),
            pathList: [t[0]]
        }], i = t.length, n = 1; n < i; ++n) {
            var r = t[n]
              , a = e[e.length - 1]
              , s = A(r);
            s + a.nbVertex >= _.splitLimit ? e.push({
                nbVertex: s,
                pathList: [r]
            }) : (a.nbVertex += s,
            a.pathList.push(r))
        }
        return e
    }, U = function(t, e, i) {
        for (var n = D(t), r = 0, a = i.length; r < a; ++r) {
            var s, o = i[r];
            if (n)
                if (o instanceof f.DrawElements) {
                    var l = o.getIndices()
                      , u = l.getElements()
                      , h = new u.constructor(u)
                      , c = new f.BufferArray(f.BufferArray.ELEMENT_ARRAY_BUFFER,h,l.getItemSize(),!0);
                    s = new f.DrawElements(o.getMode(),c)
                } else
                    o instanceof f.DrawArrays ? s = new f.DrawArrays(o.getMode(),o.getFirst(),o.getCount()) : o instanceof f.DrawArrayLengths && (s = new f.DrawArrayLengths(o.getMode(),o.getFirst(),o.getArrayLengths().slice()));
            else
                s = o;
            e.push(s)
        }
    }, G = function(t, e) {
        var i = t.getElements()
          , n = i.BYTES_PER_ELEMENT;
        t.setNormalize(4 !== n);
        var r = 1;
        1 === n ? r = 255 : 2 === n && (r = 65535);
        for (var a = i.length, s = t.getItemSize(), o = e * s; o < a; ++o)
            i[o] = r
    }, z = function(t, e) {
        var i = new f.Geometry;
        return i.setName(e.getName()),
        U(t, i.getPrimitiveSetList(), e.getPrimitiveSetList()),
        i
    }, H = function(t, e) {
        var i = e.getVertexAttributeList().Color;
        if (i && 4 === i.getItemSize())
            return 4;
        for (var n = 0, r = t.length; n < r; ++n) {
            var a = t[n]
              , s = a[a.length - 1]
              , o = s.getVertexAttributeList().Color;
            if (o && 4 === o.getItemSize())
                return 4
        }
        return 3
    }, j = function(t, e, i) {
        var n = t[t.length - 1]
          , r = z(t, n)
          , a = f.computeLocalToWorld(t)
          , s = f.mat3.create();
        f.mat3.normalFromMat4(s, a);
        var o = H(i, n)
          , l = e !== T(n)
          , u = D(t)
          , h = r.getVertexAttributeList()
          , c = n.getVertexAttributeList();
        for (var d in c) {
            var p, g = c[d], m = w[d], v = "Color" === d, b = v ? o : g.getItemSize();
            if (l) {
                p = new (v ? g.getElements().constructor : Float32Array)(e * b)
            } else
                m && u ? p = new Float32Array(g.getElements().length) : h[d] = g;
            if (p) {
                var x = new f.BufferArray(f.BufferArray.ARRAY_BUFFER,p,b,!0);
                v && G(x, g.getElements().length / g.getItemSize()),
                h[d] = x,
                m || R(x, g, 0)
            }
            if (m) {
                O("Vertex" === d ? a : s, g, h[d], 0)
            }
        }
        return _.isTransparent && I(r, n, 0),
        r
    }, W = function(t, e, i) {
        var n = e[e.length - 1]
          , r = t.getVertexAttributeList()
          , a = n.getVertexAttributeList()
          , s = f.computeLocalToWorld(e)
          , o = f.mat3.create();
        f.mat3.normalFromMat4(o, s);
        for (var l in a) {
            var u = r[l]
              , h = a[l]
              , c = i * u.getItemSize();
            if (w[l]) {
                O("Vertex" === l ? s : o, h, u, c)
            } else
                R(u, h, c)
        }
    }, q = function(t, e, i) {
        for (var n in e)
            if (!t[n]) {
                var r = e[n].getItemSize()
                  , a = "Color" === n
                  , s = a ? e[n].getElements().constructor : Float32Array
                  , o = new s(i * r)
                  , l = new f.BufferArray(f.BufferArray.ARRAY_BUFFER,o,r,!0);
                t[n] = l,
                a && G(l, 0)
            }
    }, Y = function(t, e, i, n) {
        for (var r = e.DrawElements, a = e.DrawArrays, s = _.isTransparent, o = 0, l = i.length; o < l; ++o) {
            var u = i[o]
              , h = u.getMode();
            if (u instanceof f.DrawElements) {
                var c = r[h];
                if (!c) {
                    var d = u.getIndices().getItemSize()
                      , p = new f.BufferArray(f.BufferArray.ELEMENT_ARRAY_BUFFER,new Uint16Array,d,!0);
                    c = r[h] = {
                        primitive: new f.DrawElements(h,p),
                        lastElement: -1,
                        initCount: 0
                    },
                    s || t.push(c.primitive)
                }
                var g = c.primitive;
                if (h === f.PrimitiveSet.TRIANGLE_STRIP && x[h] && !s) {
                    var m = u.getIndices().getElements()
                      , v = m[0] + n
                      , y = c.lastElement !== v && 0 !== g.getCount() ? 2 : 0
                      , S = g.getCount() % 2;
                    g.setCount(g.getCount() + u.getCount() + y + S),
                    c.lastElement = m[m.length - 1] + n
                } else
                    g.setCount(g.getCount() + u.getCount())
            } else
                u instanceof f.DrawArrays && b[h] && !s && (a[h] || (a[h] = {
                    primitive: new f.DrawArrays(h,0,0),
                    initCount: 0
                },
                t.push(a[h].primitive)))
        }
    }, X = function(t) {
        for (var e = {
            DrawElements: {},
            DrawArrays: {}
        }, i = _.isTransparent, n = 0, r = t.length; n < r; ++n) {
            var a = t[n]
              , s = a.getMode();
            if (a instanceof f.DrawElements) {
                var o = a.getIndices().getElements();
                e.DrawElements[s] = {
                    primitive: a,
                    lastElement: o[o.length - 1],
                    initCount: a.getCount()
                }
            } else
                a instanceof f.DrawArrays && b[s] && !i && (e.DrawArrays[s] = {
                    primitive: a,
                    first: a.getFirst(),
                    initCount: a.getCount()
                })
        }
        return e
    }, K = function(t) {
        for (var e in t) {
            var i = t[e]
              , n = i.primitive
              , r = n.getIndices()
              , a = r.getElements()
              , s = n.getCount() >= 65535 ? Uint32Array : Uint16Array;
            r.setElements(new s(n.getCount())),
            r.getElements().set(a),
            n.setIndices(r),
            n.setCount(a.length)
        }
    }, J = function(t, e, i, n) {
        for (var r = t.getVertexAttributeList(), a = t.getPrimitiveSetList(), s = T(t), o = n, l = 0, u = e.length; l < u; ++l) {
            var h = e[l]
              , c = h[h.length - 1];
            q(r, c.getVertexAttributeList(), s),
            Y(a, i, c.getPrimitiveSetList(), o),
            o += A(h)
        }
        K(i.DrawElements)
    }, Q = function(t) {
        var e = t.DrawElements
          , i = _.isTransparent;
        for (var n in e) {
            var r = e[n];
            !i && x[n] || r.primitive.setCount(r.initCount)
        }
    }, Z = function(t, e) {
        var i = t.pathList
          , n = i.pop()
          , r = T(n[n.length - 1])
          , a = j(n, t.nbVertex, i);
        if (e.addChild(a),
        0 !== i.length) {
            var s = a.getPrimitiveSetList()
              , o = X(s);
            J(a, i, o, r);
            for (var l = _.isTransparent, u = 0, h = i.length; u < h; ++u) {
                var c = i[u];
                W(a, c, r);
                var d = c[c.length - 1];
                if (l || D(c)) {
                    var p = z(c, d);
                    l && (p._attributes = a.getVertexAttributeList(),
                    e.addChild(p),
                    I(p, d, 3 * r)),
                    d = p
                }
                var f = d.getPrimitiveSetList();
                B(o, s, f, r),
                r += A(c)
            }
            Q(o)
        }
    }, $ = function(t) {
        var e = t.localRoot;
        t.renderPathList.sort(C);
        for (var i = V(t.renderPathList), n = i.length, r = 0; r < n; ++r)
            Z(i[r], e)
    }, tt = function(t, e) {
        if (!_.isWireframe) {
            var i = t.getAttribute("SketchfabMaterial").getMaterialModel()
              , n = i.get("geometryList");
            n.length = 0;
            for (var r = e.getChildren(), a = 0, s = r.length; a < s; ++a)
                n.push(r[a]);
            i.getChannels().Displacement.updateGeometryOffsets()
        }
    }, et = function(t) {
        var e = t.localRoot
          , i = e.getStateSet();
        _.isTransparent = Boolean(i && M(i.getBinNumber())),
        t.renderPathList.length > _.limitMergePerMaterial && (_.isTransparent = !1),
        $(t),
        tt(i, e)
    }, it = function(t, e, i) {
        var n;
        n = _.isWireframe ? t[t.length - 1].getStateSet() : P(t);
        var r = n.getInstanceID()
          , a = e[r];
        a || (e[r] = a = {
            localRoot: new f.Node,
            renderPathList: []
        },
        a.localRoot.setStateSet(n),
        a.localRoot.setName(n.getName()),
        i.addChild(a.localRoot)),
        a.renderPathList.push(t),
        t[0] === i && t.shift()
    }, nt = function(t, e) {
        var i = {}
          , n = 0
          , r = t.length;
        for (n = 0; n < r; ++n)
            it(t[n], i, e);
        for (var a in i)
            et(i[a])
    }, rt = function(t) {
        for (var e = !1, i = _.channelTargetNames, n = 0, r = t.length; n < r; ++n) {
            var a, s = t[n], o = !1;
            if (s instanceof g.Bone)
                a = g.UpdateBone;
            else {
                if (!(s instanceof f.MatrixTransform))
                    continue;
                a = g.UpdateMatrixTransform,
                o = !0
            }
            for (var l = s.getUpdateCallbackList(), u = l.length - 1; u >= 0; --u) {
                var h = l[u];
                h instanceof a != !1 && (i[h.getName()] || !o ? e = !0 : (h.update(s),
                s.removeUpdateCallback(h)))
            }
        }
        var c = t[t.length - 1];
        return e || c instanceof g.RigGeometry || c instanceof g.MorphGeometry
    }, at = function() {
        var t = [];
        return function(e) {
            return t[0] = e,
            rt(t)
        }
    }();
    n.a.osgDB.Input.prototype.getJSON = function() {
        return S = this,
        this._json.Animations && (y = this._json),
        this._json
    }
    ;
    var st = function(t) {
        var e = _.channelTargetNames;
        if (!y || !y.Animations || s.a.OSG_VERSION < 8)
            return e;
        for (var i = t.getFeatures().animation.getModel(), n = y.Animations, r = 0, a = n.length; r < a; ++r) {
            var o = n[r]["osgAnimation.Animation"]
              , l = S.setJSON(o.UserDataContainer).readUserDataContainer()
              , u = d.a.convertUserDataToObject(l);
            if (i.getAnimationByUID(u.AnimationUID))
                for (var h = o.Channels, c = 0, p = h.length; c < p; ++c) {
                    var f = h[c];
                    e[f[Object.keys(f)[0]].TargetName] = 1
                }
        }
        return e
    }
      , ot = function(t, e) {
        for (var i = _.protectedGeometries, n = t.length - 1; n >= 0; --n) {
            var r = t[n]
              , a = r.length
              , s = r[a - 1]
              , o = s._uniqueID;
            if (s.getVertexAttributeList && (o = s.getVertexAttributeList().Vertex.getInstanceID()),
            i[s._uniqueID] || i[o])
                i[o] = !0,
                e.push(r),
                t.splice(n, 1);
            else if (s instanceof f.Geometry || s instanceof g.Bone)
                rt(r) && (e.push(r),
                t.splice(n, 1));
            else {
                for (var l = a - 2; l >= 0; --l)
                    if (r[l]instanceof g.Bone) {
                        e.push(r);
                        break
                    }
                t.splice(n, 1)
            }
        }
    }
      , lt = function(t, e, i) {
        ot(t.getPathList(), e),
        ot(t.getNoGeometryPathList(), e),
        ot(t.getWireframePathList(), i)
    }
      , ut = function(t) {
        for (var e = _.parentCountFromID, i = _.childrenCountFromID, n = _.multiParentPathFromGeometryID, r = 0, a = t.length; r < a; ++r) {
            for (var s = t[r], o = !1, l = 0, u = s.length; l < u; ++l) {
                var h = s[l]
                  , c = h.getInstanceID();
                e[c] = h.getParents().length,
                i[c] = h.getChildren().length,
                o = o || h.getParents().length > 1
            }
            n[s[s.length - 1].getInstanceID()] = o
        }
    }
      , ht = function(t) {
        ut(t.getPathList()),
        ut(t.getNoGeometryPathList()),
        ut(t.getWireframePathList())
    }
      , ct = function(t) {
        F(t.getPathList()),
        F(t.getNoGeometryPathList()),
        F(t.getWireframePathList())
    }
      , dt = function(t, e, i, n) {
        var r = 0
          , a = t.length
          , s = i.length
          , o = !1;
        for (r = a - 1; r >= 0; --r) {
            var l = t[r];
            k(l);
            var u = l[0] === e;
            P(l, u ? 1 : 0) || (o = !0),
            u || e.addChild(l[0])
        }
        for (r = s - 1; r >= 0; --r) {
            var h = i[r];
            k(h),
            n.push(h[h.length - 1]),
            h[0] !== e && e.addChild(h[0])
        }
        o || e.setStateSet(void 0)
    }
      , pt = function(t, e, i) {
        _.isWireframe = !0;
        var n = t.getChildren()
          , r = n.length;
        nt(e, t);
        for (var a = n.length, s = r; s < a; ++s)
            i.push(n[s])
    }
      , ft = function(t, e) {
        var i = t.length;
        if (0 !== i)
            for (var n = t[0].indexOf(e), r = Boolean(e.getStateSet()) ? 0 : 1, a = 0; a < i; ++a) {
                var s = t[a];
                s.splice(0, n + r)
            }
    }
      , gt = function(t) {
        for (var e = t.getUpdateCallbackList(), i = 0, n = e.length; i < n; ++i) {
            var r = e[i];
            if (r instanceof g.BasicAnimationManager)
                return t.removeUpdateCallback(r),
                r
        }
    }
      , mt = function(t) {
        for (var e, i, n = t.getPathList(), r = n[0][0], a = r, s = []; ; ) {
            e = E(a) || e,
            i = i || gt(a);
            var o = a.getChildren();
            if (1 !== o.length)
                break;
            if (o[0]instanceof g.Skeleton)
                break;
            if (o[0]instanceof f.Geometry)
                break;
            if (at(a))
                break;
            s.push(a),
            a = o[0]
        }
        if (r.removeChildren(),
        i && r.addUpdateCallback(i),
        r === a)
            return a;
        for (var l = a.getParents(), u = 0, h = l.length; u < h; ++u)
            l[u].removeChild(a);
        a.removeChildren(),
        r.setStateSet(void 0),
        a.setStateSet(e);
        var c = f.computeLocalToWorld(s);
        if (f.mat4.equals(f.mat4.IDENTITY, c))
            r.addChild(a);
        else {
            var d = new f.MatrixTransform;
            d.setName("Optim - RootMatrix"),
            f.mat4.copy(d.getMatrix(), c),
            r.addChild(d),
            d.addChild(a)
        }
        return ft(n, a),
        ft(t.getWireframePathList(), a),
        ft(t.getNoGeometryPathList(), a),
        a
    }
      , vt = function(t) {
        var e = t.getFeatures().hotspot.getModel().get("hotspots")
          , i = e.length
          , n = _.protectedGeometries
          , r = 0;
        for (r = 0; r < i; ++r) {
            var a = e.at(r).get("geometryUid");
            a >= 0 && (n[a] = !0)
        }
        var s = t.getFeatures().sound.getModel().get("soundtracks")
          , o = s.length;
        for (r = 0; r < o; ++r) {
            var l = s.at(r).get("geometryUid");
            l >= 0 && (n[l] = !0)
        }
    }
      , _t = function(t) {
        var e, i = t.getFeatures().material.getModel().attributes, n = {}, r = l.a.length;
        for (var a in i) {
            var s = i[a];
            if (!s._unused) {
                var o = []
                  , u = s.getChannels();
                for (e = 0; e < r; ++e) {
                    var h = l.a[e]
                      , c = u[h];
                    if (c.isEnableEffective() && c.getTexture()) {
                        var d = c.getTexCoordUnit();
                        -1 === o.indexOf(d) && o.push(d)
                    }
                }
                var p = s.get("geometryList")
                  , f = p.length;
                for (e = 0; e < f; ++e) {
                    var g = p[e]
                      , m = n[g.getInstanceID()];
                    if (m)
                        for (var v = o.length, _ = 0; _ < v; ++_)
                            -1 === m.uvList.indexOf(o[_]) && m.uvList.push(o[_]);
                    else
                        n[g.getInstanceID()] = {
                            geometry: g,
                            uvList: o.slice()
                        }
                }
            }
        }
        for (var b in n) {
            var x = n[b]
              , y = x.uvList
              , S = x.geometry.getVertexAttributeList();
            for (var w in S)
                -1 !== w.indexOf("TexCoord") && -1 === y.indexOf(parseInt(w.substring(8))) && delete S[w]
        }
    }
      , bt = function(t, e) {
        _t(e);
        var i = e.getOrCreateScene().getWireframeNodes();
        i.length = 0;
        var n = []
          , r = []
          , a = t.getPathList()
          , o = t.getWireframePathList();
        st(e);
        var l = mt(t);
        if (ht(t),
        ct(t),
        vt(e),
        lt(t, n, r),
        nt(a, l),
        dt(n, l, r, i),
        o.length > 0) {
            var u = i.slice(0);
            s.a.getWireframe().then(function() {
                for (var t = i.length = u.length, e = 0; e < t; ++e)
                    i[e] = u[e];
                f.time("optimizer - wireframe"),
                pt(l, o, i),
                f.timeEnd("optimizer - wireframe")
            })
        }
    }
      , xt = function(t) {
        var e = t.getFeatures().material.getModel().attributes
          , i = {}
          , n = {}
          , r = l.a.length;
        for (var a in e) {
            var s = e[a]
              , o = s.get("stateSet");
            if (!o)
                return;
            var h = s.getChannels()
              , c = u.a.get("mask")
              , d = [];
            d.push(s.get("cullFace") ? 1 : 0),
            d.push(s.hasOnlyPoints() ? 1 : 0),
            c & u.a.LIT && d.push(s.get("shadeless") ? 1 : 0),
            c === u.a.CLASSIC_LIT && d.push(s.get("reflection")),
            c !== u.a.MATCAP && d.push(s.get("hasVertexColor") ? 1 : 0),
            h.Opacity.isEffective() && d.push(s.get("hasVertexAlpha") ? 1 : 0);
            for (var p = 0; p < r; ++p) {
                var g = l.a[p]
                  , m = h[g];
                m.isEnableEffective() && d.push(g + (m.isEffective() ? JSON.stringify(m.getJSON()) : m.getFactor()))
            }
            d = d.join(" / "),
            i[d] ? (n[o.getInstanceID()] = i[d],
            s._unused = !0) : i[d] = o
        }
        var _ = Object.keys(n).length
          , b = Object.keys(e).length;
        if (v.materialCountBefore = b,
        v.materialCountAfter = b - _,
        0 !== _) {
            var x = function() {
                f.NodeVisitor.call(this)
            };
            x.prototype = f.objectInherit(f.NodeVisitor.prototype, {
                apply: function(t) {
                    var e = t.getStateSet();
                    if (e) {
                        var i = n[e.getInstanceID()];
                        i && t.setStateSet(i)
                    }
                    this.traverse(t)
                }
            });
            t.getRootModel().accept(new x)
        }
    }
      , yt = function(t, e) {
        var i = new p.a;
        t.accept(i);
        var n = i.getStats();
        v["nodeCount" + e] = n.nodeCount,
        v["matrixTransformCount" + e] = n.matrixTransformCount,
        v["geometryCount" + e] = n.geometryCount,
        v["boneCount" + e] = n.boneCount,
        v["skeletonCount" + e] = n.skeletonCount,
        v["morphGeometryCount" + e] = n.morphGeometryCount,
        v["rigGeometryCount" + e] = n.rigGeometryCount
    };
    _.optimize = function(t, e) {
        if (m.resolve(v),
        i.i(c.a)().graphOptimizer || i.i(c.a)().mergeMaterials) {
            f.time("optimizer");
            var n = e.getRootModel();
            if (yt(n, "Before"),
            i.i(c.a)().mergeMaterials && (f.time("optimizer - materials"),
            xt(e),
            f.timeEnd("optimizer - materials")),
            i.i(c.a)().graphOptimizer && (f.time("optimizer - nodes"),
            bt(t, e),
            f.timeEnd("optimizer - nodes")),
            yt(n, "After"),
            i.i(c.a)().graphOptimizer) {
                var r = v.geometryCountBefore + v.rigGeometryCountBefore + v.morphGeometryCountBefore
                  , a = v.geometryCountAfter + v.rigGeometryCountAfter + v.morphGeometryCountAfter;
                h.a.logMessage("Geometry count : before " + r + ", after " + a)
            }
            i.i(c.a)().mergeMaterials && h.a.logMessage("Material count : before " + v.materialCountBefore + ", after " + v.materialCountAfter),
            f.timeEnd("optimizer")
        }
    }
    ,
    e.a = _
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(958)
      , a = i(959)
      , s = {
        FeatureName: "hotspot",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getNode = function() {
        return this._views[0].getNodeHotspot()
    }
    ,
    o.prototype.getWidgetNode = function() {
        return this._views[0].getNodeProxy()
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    e.a = {
        HOTSPOT: i(766)
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(18)
      , r = i.n(n)
      , a = i(4)
      , s = i(1)
      , o = (i.n(s),
    i(469))
      , l = i(168)
      , u = i(161)
      , h = i(89)
      , c = i(29)
      , d = i(471)
      , p = i(441)
      , f = a.a.osg
      , g = a.a.osgAnimation
      , m = function(t) {
        var e = f.vec3.create()
          , n = f.vec3.create();
        t.getFeatures().manipulator.getModel().getCameraPosition(e, n),
        this.set("eye", e),
        this.set("target", n);
        var r = t.getScreenShot(128, 1)
          , a = r.toDataURL("image/jpeg");
        this.set("uidImage", void 0),
        this.set("imageFile", i.i(o.a)(a)),
        this.set("preview", a)
    }
      , v = r.a.Model.extend({
        defaults: {
            webVR: !1,
            visible: i.i(c.a)().annotationsVisible,
            hotspots: new l.a([]),
            currentHotspotIndex: -1
        },
        getName: function() {
            return "Hotspot"
        },
        getResourceManager: function() {
            return this._resourceManager || h.default.instance
        },
        init: function(t) {
            var e = this.get("hotspots");
            e.on("remove", this.onRemove, this);
            var n = this._viewer = t.getViewer();
            this.hotspotsToBeDeleted = [];
            var r = t.getModel().get("options")
              , a = r.hotspot
              , l = a && a.hotspots && i.i(s.keyBy)(a.hotspots, "uid");
            this.getResourceManager().getOrCreateHotspotCollection().resource.each(function(t) {
                t.collection = null;
                var r = t.get("images")[0];
                r && (t.set("uidImage", r.uid),
                t.set("imageFile", i.i(o.a)(r.url)),
                t.set("preview", r.url),
                t.set("refreshAction", m.bind(t, n)));
                var a = l && l[t.get("uid")];
                a && (t.set("geometryUid", a.geometryUid),
                t.set("indices", a.indices),
                t.set("barycentricWeights", a.barycentricWeights),
                t.set("localPosition", a.localPosition)),
                e.add(t)
            })
        },
        onRemove: function(t) {
            t.isNew() || this.hotspotsToBeDeleted.push(t)
        },
        setUpdateCallback: function(t) {
            this.callback = t
        },
        updateHotspotHit: function(t, e) {
            this._viewer.getFeaturesManager().getScenePositionFromHit(e, t.get("position"));
            var n = e.nodepath[e.nodepath.length - 1]
              , r = void 0 !== n._uniqueID ? n._uniqueID : -1
              , a = n instanceof g.RigGeometry || n instanceof g.MorphGeometry
              , s = a || i.i(d.a)(e.nodepath);
            t.set("geometryUid", s ? r : -1);
            var o = e.TriangleIntersection
              , l = t.get("indices");
            l[0] = a ? o.i1 : -1,
            l[1] = a ? o.i2 : -1,
            l[2] = a ? o.i3 : -1;
            var u = t.get("barycentricWeights");
            u[0] = a ? o.r1 : 0,
            u[1] = a ? o.r2 : 0,
            u[2] = a ? o.r3 : 0;
            var h = t.get("localPosition");
            h[0] = s ? e.point[0] : 0,
            h[1] = s ? e.point[1] : 0,
            h[2] = s ? e.point[2] : 0
        },
        createHotspot: function(t) {
            var e = this.get("hotspots")
              , n = new u.a;
            return n.set("uid", "tmp_" + i.i(s.uniqueId)()),
            i.i(p.b)(n, this._viewer.getFeaturesManager(), t),
            e.add(n, {
                sort: !1
            }),
            n.set("order", e.indexOf(n)),
            n.set("refreshAction", m.bind(n, this._viewer)),
            n.get("refreshAction")(),
            e.trigger("select", n),
            n
        },
        getJSON: function() {
            var t = [];
            return this.get("hotspots").each(function(e) {
                t.push({
                    uid: e.get("uid"),
                    geometryUid: e.get("geometryUid"),
                    indices: e.get("indices"),
                    barycentricWeights: e.get("barycentricWeights"),
                    localPosition: e.get("localPosition")
                })
            }),
            {
                hotspots: t
            }
        }
    });
    e.a = v
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(6)
      , a = i(43)
      , s = i(89)
      , o = i(138)
      , l = i(957)
      , u = i(70)
      , h = i(51)
      , c = i(87)
      , d = i(90)
      , p = i(16)
      , f = i(37)
      , g = i(11)
      , m = i(421)
      , v = i(681)
      , _ = i(694)
      , b = i(793)
      , x = i.n(b)
      , y = i(792)
      , S = i.n(y)
      , w = i(795)
      , C = i.n(w)
      , M = i(794)
      , T = i.n(M)
      , A = i(441)
      , E = n.a.osg
      , P = r.a.extend({
        initialize: function() {
            r.a.prototype.initialize.apply(this, arguments),
            this._hotspots = this.model.get("hotspots"),
            this._hotspots.on("sort", h.a.draw),
            this._hotspots.on("remove", this.onHotspotRemoved, this),
            this._hotspots.on("add", this.onHotspotAdded, this),
            this._hotspots.on("select", this.onHotspotSelected, this),
            this._hotspots.on("inserted", this.onHotspotInserted, this),
            this.model.on("change:visible", this.onVisible, this),
            this._lastSuccessHit = void 0;
            var t = this.options.context;
            this._viewer = t.getViewer(),
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._manipulator = this._viewerOSGJS.getManipulator(),
            this._mouseKeyboard = this._viewerOSGJS.getEventProxy().StandardMouseKeyboard,
            this._idDragging = -1,
            this._dragHotspotStarted = !1,
            this._lastHoveredIndex = -1,
            this._dragCamera = !1,
            this._lastCoordNotDragging = E.vec2.create(),
            this._nodeHotspot = new E.Node,
            this._nodeHotspot.setName("Feature - Hotspot"),
            this._proxyHotspot = new E.Node,
            this._proxyHotspot.setName("Hotspot - Proxy"),
            this._proxyHotspot.setNodeMask(0),
            this._nodeHotspot.addChild(this._proxyHotspot),
            this.initHotspotProxy(),
            this.initEventHandlers(),
            this._hotspots.each(this.onHotspotAdded.bind(this)),
            m.a.setHotspot(this._hotspots.length > 0),
            a.a.getModelDisplayed().then(this.hotspotReady.bind(this))
        },
        getNodeHotspot: function() {
            return this._nodeHotspot
        },
        getNodeProxy: function() {
            return this._proxyHotspot
        },
        getScreenThresholdHover: function() {
            return 20 * this._viewerOSGJS.getCanvasPixelRatio()
        },
        onVisible: function() {
            this._proxyHotspot.setNodeMask(this.model.get("visible") ? u.a.NO_SHADOW : 0),
            h.a.draw()
        },
        initEventHandlers: function() {
            var t = this._viewer.getCanvas();
            i.i(d.a)() && t.addEventListener("dblclick", this.onDoubleClick.bind(this)),
            t.addEventListener("mousemove", this.onPointerMove.bind(this)),
            t.addEventListener("touchmove", this.onPointerMove.bind(this)),
            t.addEventListener("mousedown", this.onPointerDown.bind(this)),
            t.addEventListener("touchstart", this.onPointerDown.bind(this)),
            t.addEventListener("touchend", this.onPointerUp.bind(this)),
            t.addEventListener("touchcancel", this.onPointerOut.bind(this)),
            t.addEventListener("mouseup", this.onPointerUp.bind(this)),
            t.addEventListener("mouseout", this.onPointerOut.bind(this))
        },
        hotspotReady: function() {
            this.onVisible();
            var t = this._viewer.getFeatures().postProcess.getCamera()._textureDepth;
            t && this._proxyHotspot.getOrCreateStateSet().setTextureAttributeAndModes(0, t),
            h.a.draw()
        },
        onHotspotInserted: function() {
            for (var t = 0; t < this._proxyHotspot.children.length; t++)
                this._proxyHotspot.children[t].initCard()
        },
        initHotspotProxy: function() {
            this._proxyHotspot.setCullCallback(this);
            var t = this._proxyHotspot.getOrCreateStateSet();
            t.setRenderBinDetails(c.a.HOTSPOT, "RenderBin"),
            t.setAttributeAndModes(new E.Depth(E.Depth.DISABLE)),
            t.setAttributeAndModes(new E.BlendFunc(E.BlendFunc.ONE,E.BlendFunc.ONE_MINUS_SRC_ALPHA));
            var e = s.default.instance.getOrCreateTexture(l.a.HOTSPOT);
            t.addUniform(E.Uniform.createInt(0, "uTextureDepth")),
            t.addUniform(E.Uniform.createInt(1, "uTextureHotspot")),
            t.setTextureAttributeAndModes(1, e.texture),
            t.setAttributeAndModes(o.a.createShader(x.a, S.a, "hotspot", "Hotspot")),
            t.setAttributeAndModes(new E.CullFace(E.CullFace.DISABLE)),
            v.a.initLineShader(o.a.createShader(C.a, T.a, "hotspotline", "VRHotspotLine"))
        },
        onDoubleClick: function(t) {
            if ("annotations" === this._viewer.getOptions().widgetAPI.getTabbedWidget().get()) {
                var e = f.a.maxHotspotsPerModel[g.a.me().get("account")];
                if (this._hotspots.length >= e) {
                    var i = "You have reached the maximum number of annotations allowed by your plan (" + e + ").";
                    return g.a.me().canUpgradeToPro() && (i += '<br><a class="button btn-medium btn-primary upgrade-link" href="/plans" data-title="maximum-annotation-upgrade" target="_blank">Upgrade to add more annotations</a>'),
                    void this.model.trigger("hotspot-error", i)
                }
                var n = this._viewer.getFeaturesManager();
                if (n) {
                    var r = n.pickNearestSurface(t);
                    r && (this.model.createHotspot(r),
                    p.a.annotationEditorCreateButtonClicked(this.options.context.getModel().get("uid")))
                }
            }
        },
        getColorHotspot: function(t) {
            return this._proxyHotspot.getChildren()[t].getColor()
        },
        setHotspotHovered: function(t, e) {
            e >= 0 && E.vec3.copy(this.getColorHotspot(e), t ? v.a.COLOR_HOVERED : v.a.COLOR_NORMAL)
        },
        updateCameraDragged: function() {
            var t = E.vec2.create();
            return function(e) {
                this._dragCamera = this._dragCamera || E.vec2.dist(i.i(_.a)(e, t), this._lastCoordNotDragging) > 5
            }
        }(),
        onPointerDown: function(t) {
            this._idDragging = this.pickHotspot(t),
            this._dragHotspotStarted = !1,
            this._dragCamera = !1,
            i.i(_.a)(t, this._lastCoordNotDragging),
            i.i(d.a)() && this._idDragging >= 0 && this._mouseKeyboard.setEnable(!1)
        },
        onPointerOut: function() {
            this._dragCamera = !0,
            this.onPointerUp()
        },
        onPointerUp: function() {
            this._dragCamera ? this._idDragging >= 0 && (this._lastSuccessHit && this.model.updateHotspotHit(this._hotspots.at(this._idDragging), this._lastSuccessHit),
            E.vec3.copy(this.getColorHotspot(this._idDragging), v.a.COLOR_NORMAL),
            h.a.draw(),
            p.a.annotationEditorPositionMoved(this.options.context.getModel().get("uid"))) : this._hotspots.trigger("select", this._hotspots.at(this._idDragging)),
            this._dragHotspotStarted = !1,
            this._dragCamera = !1,
            this._idDragging = -1
        },
        onPointerMove: function(t) {
            if (this.updateCameraDragged(t),
            i.i(d.a)() && this._idDragging >= 0)
                return void this.dragHotspot(t);
            var e = this.pickHotspot(t);
            i.i(_.a)(t, this._lastCoordNotDragging),
            this.setHotspotHovered(0, this._lastHoveredIndex),
            this.setHotspotHovered(1, e),
            this._lastHoveredIndex !== e && (this._lastHoveredIndex = e,
            h.a.draw())
        },
        dragHotspot: function(t) {
            this._dragHotspotStarted = !0;
            var e = this._viewer.getFeaturesManager();
            if (e) {
                var n = e.pickNearestSurface(t)
                  , r = this._hotspots.at(this._idDragging);
                if (E.vec3.copy(this.getColorHotspot(this._idDragging), n ? v.a.COLOR_DRAG_OK : v.a.COLOR_DRAG_FAIL),
                n)
                    this._lastSuccessHit = n,
                    this.model.updateHotspotHit(r, n);
                else {
                    var a = i.i(_.a)(t)
                      , s = e.canvasCoordToGL(a[0], a[1], E.vec3.create());
                    s[2] = e.getScreenPositionFromScenePoint(r.get("position"), E.vec3.create())[2],
                    e.getScenePositionFromScreenPoint(s, r.get("position")),
                    r.set("geometryUid", -1)
                }
                h.a.draw()
            }
        },
        onHotspotSelected: function() {
            var t = E.vec3.create()
              , e = E.vec3.create();
            return function(i) {
                if (i) {
                    var n = this._viewer.getFeaturesManager();
                    n && (E.vec3.copy(t, i.get("eye")),
                    E.vec3.copy(e, i.get("target")),
                    n.applyAutospinToCamera(t, e),
                    n.focusOnTargetAndEye(e, t, 1.5),
                    h.a.draw())
                }
            }
        }(),
        onHotspotAdded: function(t) {
            var e = new v.a(this._hotspots.indexOf(t),this._viewer);
            e.setCardVisibilityListener(this._onCardVisibilityChange.bind(this)),
            this._proxyHotspot.addChild(e),
            h.a.draw()
        },
        _onCardVisibilityChange: function(t, e) {
            e ? this._viewer.trigger("annotationFocus", t.getIndex()) : this._viewer.trigger("annotationBlur", t.getIndex())
        },
        onHotspotRemoved: function() {
            this.setHotspotHovered(0, this._lastHoveredIndex),
            this._lastHoveredIndex = -1;
            var t = this._proxyHotspot.getChildren();
            this._proxyHotspot.removeChild(t[t.length - 1]),
            h.a.draw()
        },
        pickNearestSurface: function(t) {
            var e = this._viewer.getFeaturesManager();
            if (e) {
                var n = i.i(_.a)(t);
                return e.computeNearestIntersection2D(n[0], n[1], u.a.PICK_GEOMETRY_SLOW, this._viewer.getOrCreateScene().getRoot())
            }
        },
        screenDistanceToHotspot: function() {
            var t = E.vec3.create();
            return function(e, i) {
                return this._viewer.getFeaturesManager().getScreenPositionFromScenePoint(this._hotspots.at(e).get("lastComputedScenePosition"), t),
                E.vec2.dist(t, i)
            }
        }(),
        pickHotspot: function() {
            var t = E.vec2.create();
            return function(e) {
                var n = this._viewer.getFeaturesManager();
                if (!n || !this.model.get("visible"))
                    return -1;
                i.i(_.a)(e, t),
                n.canvasCoordToGL(t[0], t[1], t);
                for (var r = 1 / 0, a = this._hotspots.length, s = -1, o = this.getScreenThresholdHover(), l = 0; l < a; ++l) {
                    var u = this.screenDistanceToHotspot(l, t);
                    u < o && u < r && (r = u,
                    s = l)
                }
                return s
            }
        }(),
        cull: function() {
            var t = E.mat4.create()
              , e = E.quat.create()
              , n = E.vec3.create()
              , r = E.vec3.create()
              , a = E.vec3.create()
              , s = E.vec3.create()
              , o = E.mat4.create();
            return function() {
                this.model.callback && this.model.callback();
                var l = this._viewer.getFeaturesManager();
                this._lastHoveredIndex >= 0 && -1 === this._idDragging && (l.canvasCoordToGL(this._lastCoordNotDragging[0], this._lastCoordNotDragging[1], a),
                this.screenDistanceToHotspot(this._lastHoveredIndex, a) >= this.getScreenThresholdHover() && this.setHotspotHovered(0, this._lastHoveredIndex));
                var u = this._hotspots
                  , h = this._proxyHotspot.getChildren()
                  , c = h.length
                  , d = this._viewer.getFeatures()
                  , p = d.webVR.getModel().get("worldFactor")
                  , f = this.model.get("webVR");
                this._manipulator.getEyePosition(n);
                var g = this._viewer.getCamera()
                  , m = .02 * this._viewerOSGJS.getCanvasClientWidth() * E.mat4.getScale(s, g.getProjectionMatrix())[0];
                this._nodeHotspot.getWorldMatrix(void 0, o),
                E.mat4.invert(t, o),
                E.vec3.transformMat4(r, n, t);
                var v = E.mat4.multiply(t, g.getViewMatrix(), o);
                E.mat4.invert(v, v),
                E.mat4.fromQuat(v, E.mat4.getRotation(e, v));
                for (var _ = 0; _ < c; ++_) {
                    var b = h[_]
                      , x = u.at(_);
                    i.i(A.a)(x, this._nodeHotspot),
                    f ? b.updatePositionVR(x, m, r, n, p, o) : b.updatePosition(x, v, m, r)
                }
                return !0
            }
        }()
    });
    e.a = P
}
, function(t, e, i) {
    "use strict";
    var n = i(15)
      , r = i(4)
      , a = i(682)
      , s = i(683)
      , o = i(70)
      , l = i(356)
      , u = i(51)
      , h = i(329)
      , c = i(29)
      , d = r.a.osg
      , p = r.a.osgUtil
      , f = n.a.extend({
        defaults: function() {
            return {
                type: "NONE",
                intensity: 1,
                intensityGround: 1,
                enable: !0,
                color: d.vec3.fromValues(1, 1, 1),
                ground: d.vec3.fromValues(.3, .2, .2),
                matrix: d.mat4.create(),
                matrixPrev: d.mat4.create(),
                falloff: -1,
                angle: 45,
                hardness: .5,
                attachedToCamera: !1,
                castShadows: !0,
                shadowBias: .005,
                shadowNormalBias: i.i(c.a)().normalOffsetShadow ? .075 : void 0,
                shadowSize: i.i(c.a)().shadowTextureSize
            }
        },
        initialize: function() {
            n.a.prototype.initialize.apply(this, arguments),
            l.a.bind("change:mask", this.dirty, this),
            this.createNode(arguments[0])
        },
        createNode: function(t) {
            this._mtLight = new d.MatrixTransform,
            this._mtLight.setName("Lighting - Mt");
            var e = a.a.createLight("Lighting", t);
            this._shadowMap = e.shadowMap,
            this._light = e.light,
            this._lightSource = e.lightSource,
            this._node = e.node,
            this._enableShadow = e.enableShadow,
            this._cameraShadows = i.i(c.a)().cameraShadows,
            this._mtQuad = new d.MatrixTransform,
            this._mtQuad.setName("Lighting - TransformIcon " + t),
            this._quadGeom = s.a.createIconGeometry(),
            this._quadGeom.setName("Lighting -  GeomIcon " + t),
            this._pointGeom = new s.a.createPointGeometry,
            this._dirGeom = new s.a.createDirectionalGeometry(5),
            this._spotGeom = new s.a.createSpotGeometry(5),
            this._hemiGeom = new s.a.createHemiGeometry(4),
            this._hemiGeom.getOrCreateStateSet().addUniform(d.Uniform.createFloat4(d.vec4.fromValues(0, 0, 1, 1), "uGround")),
            this._scale = new d.MatrixTransform,
            this._scale.setName("Lighting - ScaleIcon " + t),
            this._mtEditLight = new d.MatrixTransform,
            this._mtEditLight.getOrCreateStateSet().setTextureAttributeAndModes(0, h.a.dummyTexture),
            this._mtEditLight.setName("Lighting - MtEditLight " + t);
            var n = this._mtEditLight.getOrCreateStateSet();
            n.addUniform(d.Uniform.createFloat4(d.vec4.fromValues(1, 1, 1, 1), "uColor")),
            n.addUniform(d.Uniform.createInt(1, "uEnable")),
            n.addUniform(d.Uniform.createInt(0, "uAttachedToCamera")),
            n.addUniform(d.Uniform.createInt(0, "uTextureDepth")),
            this._node.addChild(this._mtLight),
            this._node.addChild(this._mtEditLight),
            this._mtLight.addChild(this._lightSource),
            this._mtEditLight.addChild(this._scale),
            this._mtEditLight.addChild(this._spotGeom),
            this._mtEditLight.addChild(this._pointGeom),
            this._scale.addChild(this._mtQuad),
            this._scale.addChild(this._dirGeom),
            this._scale.addChild(this._hemiGeom),
            this._mtQuad.addChild(this._quadGeom),
            this._dirty = !0,
            this._updateMatrixOnToggleCamera = !0,
            this._castShadows = !1,
            this._scene = null
        },
        setDepthTexture: function(t) {
            t && this._mtEditLight.getOrCreateStateSet().setTextureAttributeAndModes(0, t)
        },
        setScene: function(t) {
            this._scene = t
        },
        getShadowMap: function() {
            return this._shadowMap
        },
        isCastingShadows: function() {
            return this._enableShadow && this._castShadows
        },
        getLightSource: function() {
            return this._lightSource
        },
        getNodeScale: function() {
            return this._scale
        },
        getNodeQuad: function() {
            return this._mtQuad
        },
        getNode: function() {
            return this._node
        },
        getNodeLight: function() {
            return this._mtLight
        },
        getNodeEditLight: function() {
            return this._mtEditLight
        },
        dirty: function() {
            this._dirty = !0
        },
        isDirty: function() {
            return this._dirty
        },
        updateNode: function() {
            if (this._dirty) {
                this._dirty = !1;
                var t = this._node
                  , e = this._light
                  , n = this.get("type");
                if ("NONE" === n)
                    return t.setNodeMask(0),
                    e.setEnabled(!1),
                    this._castShadows = !1,
                    void (this._mtEditLight.editMask = 0);
                t.setNodeMask(-1),
                this._mtEditLight.setNodeMask(o.a.PICK_GIZMO_LIGHT),
                this._mtEditLight.editMask = "POINT" === n ? p.NodeGizmo.PICK_ARROW | p.NodeGizmo.PICK_PLANE : p.NodeGizmo.PICK_GIZMO;
                var r = "HEMI" === n && l.a.get("mask") & l.a.PBR;
                r && (n = "DIRECTION");
                var a = this.get("enable")
                  , s = this.get("falloff");
                e.setLightType(n),
                e.setSpotCutoff("SPOT" === n ? this.get("angle") : 180),
                e.setEnabled(a),
                e.setConstantAttenuation("DIRECTION" !== n ? 1 : s),
                e.setQuadraticAttenuation("DIRECTION" !== n ? s : 0),
                e.setSpotBlend(this.get("hardness")),
                d.mat4.copy(this._mtLight.getMatrix(), this.get("matrix")),
                this._mtLight.dirtyBound(),
                this._mtEditLight.dirtyBound(),
                d.vec3.scale(e.getDiffuse(), this.get("color"), this.get("intensity")),
                d.vec3.copy(e.getSpecular(), e.getDiffuse()),
                d.vec3.scale(e.getGround(), this.get("ground"), this.get("intensityGround")),
                this._castShadows = this.get("castShadows") && ("DIRECTION" === n || "SPOT" === n) && !r,
                this.getShadowMap().setTextureSize(this.get("shadowSize")),
                this.getShadowMap().setBias(this.get("shadowBias")),
                i.i(c.a)().normalOffsetShadow && this.getShadowMap().setNormalBias(this.get("shadowNormalBias")),
                this.isAttachedToCamera() ? (this._mtLight.setReferenceFrame(d.Transform.ABSOLUTE_RF),
                this._mtLight.setCullingActive(!1),
                this._cameraShadows || (this._castShadows = !1)) : (this._mtLight.setReferenceFrame(d.Transform.RELATIVE_RF),
                this._mtLight.setCullingActive(!0));
                var u = this._scene.getMinimumBound()
                  , h = u.radius()
                  , f = this.multUI_ ? this.multUI_ : u.radius2() / 1e3
                  , g = Math.pow(s * f, .125);
                g = Math.min(Math.max(g, 0), 1);
                var m = .05 * h * g + .8 * h * (1 - g);
                "SPOT" === n && this._spotGeom.updateCone(e.getSpotCutoff() * Math.PI / 180, m),
                "POINT" === n && this._pointGeom.updateRadius(m),
                this._dirGeom.setNodeMask(a && "DIRECTION" === n ? o.a.NO_PICK_NO_SHADOW : 0),
                this._spotGeom.setNodeMask(a && "SPOT" === n ? o.a.NO_PICK_NO_SHADOW : 0),
                this._hemiGeom.setNodeMask(a && "HEMI" === n ? o.a.NO_PICK_NO_SHADOW : 0),
                this._pointGeom.setNodeMask(a && "POINT" === n ? o.a.NO_PICK_NO_SHADOW : 0),
                d.vec3.copy(this._hemiGeom.getOrCreateStateSet().getUniform("uGround").getInternalArray(), e.getGround()),
                d.vec3.copy(this._mtEditLight.getOrCreateStateSet().getUniform("uColor").getInternalArray(), e.getDiffuse());
                var v = this._mtEditLight.getOrCreateStateSet();
                v.getUniform("uEnable").setInt(0 | a),
                v.getUniform("uAttachedToCamera").setInt(0 | this.isAttachedToCamera()),
                this._quadGeom.setLightType(n)
            }
        },
        setLightUnit: function(t) {
            this._light.getLightNumber() !== t && (this._light.setLightNumber(t),
            this._light.setName("skfb" + this._light.getTypeMember()),
            this._shadowMap.dirty())
        },
        setIconVisibility: function(t) {
            this._mtEditLight.setNodeMask(t ? -1 : 0)
        },
        isAttachedToCamera: function() {
            var t = this.get("type");
            return ("DIRECTION" === t || "HEMI" === t) && this.get("attachedToCamera")
        },
        resetPosition: function() {
            d.mat4.identity(this._mtLight.getMatrix()),
            this._scene && d.mat4.translate(this._mtLight.getMatrix(), this._mtLight.getMatrix(), this._scene.getMinimumBound().center()),
            u.a.draw()
        },
        updateAttachedToCamera: function() {
            var t = d.mat4.create()
              , e = d.vec3.create();
            return function(i) {
                if (this._updateMatrixOnToggleCamera) {
                    var n = this.get("matrix");
                    d.mat4.getTranslation(e, n),
                    this.get("attachedToCamera") ? d.mat4.copy(t, i.getViewMatrix()) : d.mat4.invert(t, i.getViewMatrix()),
                    d.mat4.multiply(n, t, n),
                    d.mat4.setTranslation(n, e)
                }
            }
        }(),
        setUpdateMatrixOnToggleCamera: function(t) {
            this._updateMatrixOnToggleCamera = t
        },
        getJSON: function() {
            var t = {};
            return t.type = this.get("type"),
            t.enable = this.get("enable"),
            t.color = this.get("color"),
            t.intensity = this.get("intensity"),
            t.ground = this.get("ground"),
            t.intensityGround = this.get("intensityGround"),
            t.matrix = this.get("matrix"),
            t.falloff = this.get("falloff"),
            t.attachedToCamera = this.get("attachedToCamera"),
            t.angle = this.get("angle"),
            t.hardness = this.get("hardness"),
            t.castShadows = this.get("castShadows"),
            t.shadowBias = this.get("shadowBias"),
            t.shadowSize = this.get("shadowSize"),
            t
        }
    });
    e.a = f
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(962)
      , a = i(964)
      , s = {
        FeatureName: "lighting",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getNode = function() {
        return this._views[0].getNode()
    }
    ,
    o.prototype.getWidgetNode = function() {
        return this._views[0].getNodeLight()
    }
    ,
    o.prototype.getNodeShadow = function() {
        return this._views[0].getNodeShadow()
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(43)
      , a = i(15)
      , s = i(960)
      , o = i(963)
      , l = i(293)
      , u = i(146)
      , h = i(292)
      , c = n.a.osg
      , d = a.a.extend({
        defaults: function() {
            return {
                enable: !i.i(l.a)(),
                select: -1,
                lights: [new s.a(0), new s.a(1), new s.a(2)],
                webVR: !1,
                forceShadowRedraw: !1
            }
        },
        getName: function() {
            return "Lighting"
        },
        getDefaultFalloff: function() {
            var t = this._root.getMinimumBound().radius();
            return t < 0 ? 0 : 3.90625 / (t * t)
        },
        setConfigAndDefaultFalloff: function(t) {
            for (var e = this.get("lights"), i = 0, n = e.length; i < n; ++i) {
                var r = e[i];
                r.setUpdateMatrixOnToggleCamera(!1),
                t && t[i] && r.set(t[i]),
                r.set("falloff", -1),
                r.setUpdateMatrixOnToggleCamera(!0)
            }
            this.dirtyScene()
        },
        initPresetThreePointLight: function() {
            this.setConfigAndDefaultFalloff(o.a.ThreePointLight())
        },
        initPresetFullMoonNight: function() {
            this.setConfigAndDefaultFalloff(o.a.FullMoonNight())
        },
        initPresetLowKeyLight: function() {
            this.setConfigAndDefaultFalloff(o.a.LowKeyLight())
        },
        initPresetEvilGenius: function() {
            this.setConfigAndDefaultFalloff(o.a.EvilGenius())
        },
        initPresetFairyCamp: function() {
            this.setConfigAndDefaultFalloff(o.a.FairyCamp())
        },
        initPreset2HeadLightV1: function() {
            this.setConfigAndDefaultFalloff(o.a.TwoHeadLightV1())
        },
        init: function(t) {
            this._viewer = t.getViewer(),
            this._root = t.getScene().getRoot();
            var e = t.getModel().get("options")
              , i = e.lighting;
            if (i && i.lights) {
                this._ignoreSceneLights = !0;
                var n = this.get("lights");
                void 0 !== i.enable && this.set("enable", i.enable);
                for (var a = e.version, s = 0; s < 3; ++s) {
                    var o = i.lights[s];
                    (void 0 === o.castShadows || a < 1 && o.attachedToCamera) && (o.castShadows = !1),
                    n[s].set(o)
                }
                (n[0].get("falloff") < 0 || n[1].get("falloff") < 0 || n[2].get("falloff") < 0) && this.dirtyScene()
            }
            r.a.getModelDisplayed().then(this.initDepthTexture.bind(this))
        },
        initDepthTexture: function() {
            for (var t = this._viewer.getFeatures().postProcess.getCamera(), e = this.get("lights"), i = 0; i < 3; ++i)
                e[i].setDepthTexture(t._textureDepth)
        },
        dirtyScene: function() {
            u.a.getModelBoxWithoutDisplacement() ? this.recomputeLightsPositionAndFalloff() : u.a.getBoxReady().then(this.recomputeLightsPositionAndFalloff.bind(this))
        },
        recomputeLightsPositionAndFalloff: function() {
            for (var t = u.a.getModelBoxWithoutDisplacement(), e = this.get("lights"), i = .8 * t.radius(), n = this.getDefaultFalloff(), r = t.center(c.vec3.create()), a = c.vec3.fromValues(0, 0, i), s = 0; s < 3; ++s) {
                var o = e[s]
                  , l = o.get("matrix");
                o.get("falloff") < 0 && (o.set("falloff", n),
                l[12] = r[0],
                l[13] = r[1],
                l[14] = r[2],
                c.mat4.translate(l, l, a)),
                o.dirty()
            }
        },
        initLights: function(t) {
            var e = 0
              , n = this.get("lights");
            for (e = 0; e < 3; ++e)
                n[e].setScene(this._root);
            if (this._ignoreSceneLights)
                return this.trigger("uiReady");
            var r = t.length;
            if (i.i(l.a)()) {
                if (0 === r)
                    return this.initPresetThreePointLight(),
                    this.trigger("uiReady");
                this.set("enable", !0)
            } else {
                for (e = 0; e < 3; ++e)
                    n[e].set("castShadows", !1);
                if (0 === r)
                    return this.initPreset2HeadLightV1(),
                    this.trigger("uiReady");
                if (r > 3)
                    return this.initPresetThreePointLight(),
                    this.trigger("uiReady")
            }
            t.sort(function(t, e) {
                return c.vec3.len(t.getDiffuse()) - c.vec3.len(e.getDiffuse())
            });
            var a = c.vec3.create();
            for (e = 0; e < 3; ++e) {
                var s = t[e]
                  , o = n[e];
                if (s) {
                    var u = s.getLightType();
                    o.set("type", u),
                    o.set("attachedToCamera", !1),
                    "SPOT" === u && (o.set("angle", Math.min(90, s.getSpotCutoff())),
                    o.set("hardness", s.getSpotBlend()));
                    var h = s.getDiffuse()
                      , d = Math.max(h[0], h[1], h[2], 1);
                    o.set("intensity", d),
                    c.vec3.scale(o.get("color"), h, 1 / d);
                    var p = s.getGround()
                      , f = Math.max(p[0], p[1], p[2], 1);
                    o.set("intensityGround", f),
                    c.vec3.scale(o.get("ground"), p, 1 / f),
                    o.set("falloff", s.getQuadraticAttenuation());
                    var g = o.get("matrix");
                    c.mat4.getScale(a, s._worldMatrix),
                    c.mat4.fromScaling(g, a),
                    c.mat4.invert(g, g),
                    c.mat4.multiply(g, s._worldMatrix, g)
                } else
                    o.set("falloff", this.getDefaultFalloff()),
                    o.set("type", "NONE")
            }
            return this.trigger("uiReady")
        },
        getJSON: function() {
            var t = {}
              , e = this.get("lights");
            return t.enable = this.get("enable"),
            t.lights = [e[0].getJSON(), e[1].getJSON(), e[2].getJSON()],
            t
        },
        editorGetJSON: function() {
            return this.getJSON()
        },
        validateJSON: function(t) {
            var e = [];
            h.a.isBoolean(t.enable) || e.push("Lighting.editorSetJSON enable must be a boolean"),
            h.a.isArray(t.lights, 3) || e.push("Lighting.editorSetJSON lights must be an array of 3 elements");
            for (var i = 0; i < 3; i++) {
                var n = t.lights[i];
                h.a.isEnumString(n.type, ["NONE", "DIRECTION", "SPOT", "POINT", "HEMI"]) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] type must be an enum [NONE, DIRECTION, SPOT, POINT, HEMI]"),
                h.a.isBoolean(n.enable) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] enable must be a boolean"),
                h.a.isArrayNumber(n.color, 3, 0, 1) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] color must be a vec3 with value in range [0,1]"),
                h.a.isNumber(n.intensity, 0, 100) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] intensity must be a number with value in range [0,100]"),
                h.a.isArrayNumber(n.ground, 3, 0, 1) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] ground must be a vec3 with value in range [0,1]"),
                h.a.isNumber(n.intensityGround, 0, 100) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] intensityGround must be a number with value in range [0,100]"),
                h.a.isArrayNumber(n.matrix, 16) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] matrix must be an mat4"),
                h.a.isNumber(n.falloff) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] falloff must be a number"),
                h.a.isBoolean(n.attachedToCamera) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] attachedToCamera must be a boolean"),
                h.a.isNumber(n.angle, 0, 90) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] angle must be a number with value in range [0,90]"),
                h.a.isNumber(n.hardness, 0, 1) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] hardness must be a number with value in range [0,1]"),
                h.a.isBoolean(n.castShadows, 0, 1) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] castShadows must be a boolean"),
                h.a.isNumber(n.shadowBias, 0, 1) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] shadowBias must be a number with value in range [0,1]"),
                h.a.isInteger(n.shadowSize) || e.push("Lighting.editorSetJSON light[" + i.toString() + "] shadowSize must be an integer")
            }
            return e.join("\n")
        },
        editorSetJSON: function(t) {
            var e = this.validateJSON(t);
            if (e)
                return e;
            for (var i = [], n = 0; n < 3; n++) {
                var r = {
                    type: t.lights[n].type,
                    enable: t.lights[n].enable,
                    color: t.lights[n].color,
                    ground: t.lights[n].ground,
                    intensity: t.lights[n].intensity,
                    intensityGround: t.lights[n].intensityGround,
                    matrix: t.lights[n].matrix,
                    falloff: t.lights[n].falloff,
                    attachedToCamera: t.lights[n].attachedToCamera,
                    angle: t.lights[n].angle,
                    hardness: t.lights[n].hardness,
                    castShadows: t.lights[n].castShadows,
                    shadowBias: t.lights[n].shadowBias,
                    shadowSize: t.lights[n].shadowSize
                };
                i.push(r)
            }
            return this.set("enable", t.enable),
            this.setConfigAndDefaultFalloff(i),
            e
        }
    });
    e.a = d
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = {};
    a.ThreePointLight = function() {
        return [{
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(-.9815804500275482, .1909922167095499, -.004668327333101102, 0, .13548347102422797, .7131126062169096, .6878332937084056, 0, .13469984856318096, .6745312327912614, -.7258536813891331, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(.7806122448979592, .7985214493960848, 1),
            intensity: .96
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(.7755211495104662, -.0666602860002539, .6277924441503967, 0, .2690483737361956, .9344846523281437, -.233133882464682, 0, -.5711216326246741, .3497067926613838, .7426474533145686, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(1, .8783319450229073, .7091836734693877),
            intensity: 1
        }, {
            type: "HEMI",
            enable: !0,
            attachedToCamera: !1,
            matrix: r.mat4.fromValues(.6903299131022926, -.7076363669144057, -.15064986988498263, 0, -.011089698239978026, .19785137301620165, -.9801692980238416, 0, .7234097246160907, .6783108479272498, .12873524736872857, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(.423469387755102, .7352665556018328, 1),
            intensity: .12,
            ground: r.vec3.fromValues(.9642857142857143, .6484128636877489, .2607507288629738),
            intensityGround: .06
        }]
    }
    ,
    a.FullMoonNight = function() {
        return [{
            type: "HEMI",
            enable: !0,
            attachedToCamera: !1,
            matrix: r.mat4.fromValues(.9997395789367833, .0037284998571004493, -.02251383121813605, 0, -.003172416108909601, .9996902441347245, .024685047253076783, 0, .02259889562202194, -.024607195505995896, .9994417320914686, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(.14431486880466474, .20264621883738915, .3928571428571429),
            intensity: 1.5400000000000005,
            ground: r.vec3.fromValues(.9744897959183674, .6276245973191442, .3331164098292378),
            intensityGround: .06
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(.9321120105125691, .3015730438836578, -.2005514873067817, 0, .11902736304545063, -.7780729183457072, -.6167941476566071, 0, -.34205216956578893, .5510501183556175, -.7611465564236605, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(1, .613390254060806, .19387755102040816),
            intensity: 2.9799999999999995
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(.5165535747993983, -.2459126458378022, -.8201825254045677, 0, -.40819067915319995, .771302442076031, -.48833688402577136, 0, .7526970000035951, .5870430252243886, .29803978378898704, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(1, 1, 1),
            intensity: .38
        }]
    }
    ,
    a.LowKeyLight = function() {
        return [{
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(.022621146436927503, -.2660807408393079, -.9636852821789301, 0, -.18898982664775527, .9454138725983617, -.26547213586781604, 0, .9817184571747294, .1881319984823789, -.02890020742997683, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(1, 1, 1),
            intensity: 1
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(-.9330760233019924, .058913139300351657, .35482161258401, 0, .19787524547993016, .9078715652207372, .36961413432105955, 0, -.30035732380815566, .4150885003001482, -.8587706416461712, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(1, 1, 1),
            intensity: .22
        }, {
            type: "NONE",
            enable: !0
        }]
    }
    ,
    a.EvilGenius = function() {
        return [{
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !1,
            matrix: r.mat4.fromValues(.9967621126545051, .025235816589958687, .07634424888336766, 0, .000702423157861877, -.9521689363972996, .3055713061819492, 0, .08040396369728874, -.3045282747481311, -.9491036468693457, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(1, .3450645564348185, .056122448979591844),
            intensity: 1.5400000000000005
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(-.7932202797763206, .039941473670798935, .6076234577701727, 0, .16089796285361985, .9761307284151629, .14587887644631273, 0, -.5872933111326324, .21347945972549276, -.780713191238742, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(.15368596418159094, .7346938775510203, .20111518159950362),
            intensity: 1.9000000000000008
        }, {
            type: "HEMI",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(.9998681367204546, .01574007797565349, .003994886292083951, 0, 0, .24600379421877677, -.9692688652948499, 0, -.016239124704439348, .9691410543235108, .24597135535169048, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(.9897959183673469, .674842115105101, .02524989587671801),
            intensity: .02,
            ground: r.vec3.fromValues(.3, .2, .2),
            intensityGround: .98
        }]
    }
    ,
    a.FairyCamp = function() {
        return [{
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(.7285122591021403, -.5166704810444328, -.44980162555865727, 0, .2899427624247639, .827461680647148, -.4808745798834604, 0, .6206473095530125, .21990630067806594, .752620844826062, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(.8476936693044566, .8957603762037927, .9948979591836735),
            intensity: .9
        }, {
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(.08433618912371937, -.8568665398386119, -.5085932953835439, 0, -.8584235966554874, -.3216498975444721, .39956260099599905, 0, -.5059608047162799, .40289089877364465, -.7626811835729392, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(.37244897959183676, .538942107455227, 1),
            intensity: 1.7200000000000006
        }, {
            type: "HEMI",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(.9766324883850551, -.001534767629049323, .21491074221438983, 0, .14494434684687327, -.7336231034872216, -.6639188793421307, 0, .15868244688039193, .6795548443783637, -.7162577012039377, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(.3389212827988338, .7142857142857143, .346581781400607),
            intensity: .5,
            ground: r.vec3.fromValues(.9947417742607245, .48469387755102045, 1),
            intensityGround: .14
        }]
    }
    ,
    a.TwoHeadLightV1 = function() {
        return [{
            type: "DIRECTION",
            enable: !0,
            attachedToCamera: !0,
            matrix: r.mat4.fromValues(Math.SQRT1_2, 0, Math.SQRT1_2, 0, -0, 1, 0, 0, -Math.SQRT1_2, -0, Math.SQRT1_2, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(.6, .48, .3),
            intensity: 1
        }, {
            enable: !0,
            attachedToCamera: !0,
            type: "DIRECTION",
            matrix: r.mat4.fromValues(Math.SQRT1_2, 0, -Math.SQRT1_2, 0, 0, 1, 0, 0, Math.SQRT1_2, 0, Math.SQRT1_2, 0, 0, 0, 0, 1),
            color: r.vec3.fromValues(.42, .42, .6),
            intensity: 1
        }, {
            type: "NONE",
            enable: !0
        }]
    }
    ,
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(43)
      , a = i(6)
      , s = i(70)
      , o = i(51)
      , l = i(87)
      , u = n.a.osg
      , h = a.a.extend({
        initialize: function(t) {
            a.a.prototype.initialize.apply(this, arguments),
            this.model.bind("change:select", this.onSelectChanged, this),
            this.model.bind("change:enable", this.onEnableChanged, this),
            this.model.bind("change", o.a.draw),
            this._viewer = t.context.getViewer(),
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._manipulator = this._viewerOSGJS.getManipulator(),
            this._hasAnimation = !1,
            r.a.getHasAnimation().then(function(t) {
                t && (this._hasAnimation = t)
            }
            .bind(this)),
            this._nodeFeature = new u.Node,
            this._nodeFeature.setName("Feature - Lighting"),
            this._shadowNode = new n.a.osgShadow.ShadowedScene,
            this._shadowNode.setName("Shadowed scene"),
            this._lightNode = new u.Camera,
            this._lightNode.setName("Lighting - Camera"),
            this._lightNode.setNearFarRatio(5e-5),
            this._lightNode.getOrCreateStateSet().setRenderBinDetails(l.a.EDITOR_GIZMO, "RenderBin"),
            this._lightNode.setNodeMask(s.a.NO_SHADOW),
            this.initLightNode(),
            this.onEnableChanged(),
            this._nodeFeature.addChild(this._lightNode),
            r.a.getMaterial().then(this.handleDirtyShadows.bind(this))
        },
        getNode: function() {
            return this._nodeFeature
        },
        getNodeLight: function() {
            return this._lightNode
        },
        getNodeShadow: function() {
            return this._shadowNode
        },
        handleDirtyShadows: function() {
            var t = this._viewer.getFeatures().material;
            if (t) {
                var e = t.getModel().attributes
                  , i = this.model.get("lights")
                  , n = i.length;
                for (var r in e)
                    for (var a = e[r], s = a.getChannels().Opacity, o = a.getChannels().Displacement, l = 0; l < n; ++l) {
                        var u = i[l];
                        s.bind("change", u.dirty, u),
                        o.bind("change", u.dirty, u)
                    }
            }
        },
        onEnableChanged: function() {
            var t = this.model.get("enable");
            if (this._lightNode.setNodeMask(t ? s.a.NO_SHADOW : 0),
            !t) {
                var e = this.getGizmo();
                e && e.attachToGeometry(null)
            }
            for (var i = this.model.get("lights"), n = 0, r = i.length; n < r; ++n) {
                var a = i[n].get("enable");
                i[n].getLightSource().getLight().setEnabled(a && t)
            }
            this.update()
        },
        initLightNode: function() {
            this._lightNode.addUpdateCallback(this);
            for (var t = this.model.get("lights"), e = 0, i = t.length; e < i; ++e) {
                var n = t[e];
                n.setLightUnit(e),
                n.bind("change", n.dirty, n),
                n.bind("change:attachedToCamera", n.updateAttachedToCamera.bind(n, this._viewer.getCamera()), n),
                n.bind("change", o.a.draw),
                this._lightNode.addChild(n.getNode())
            }
        },
        getGizmo: function() {
            var t = this._viewer.getFeaturesManager();
            return t ? t.getNodeGizmo() : null
        },
        onSelectChanged: function() {
            var t = this.getGizmo();
            if (t) {
                var e = this.model.get("select");
                if (-1 === e)
                    return void t.attachToGeometry(null);
                t.attachToMatrixTransform(this.model.get("lights")[e].getNodeEditLight())
            }
        },
        updateSelection: function() {
            var t = this.getGizmo();
            if (t && !t._isEditing) {
                var e = t._attachedNode;
                if (-1 !== this.model.get("select") || e) {
                    for (var i = -1, n = this.model.get("lights"), r = 0; r < 3; ++r)
                        if (n[r].getNodeEditLight() === e) {
                            t.updateGizmoMask(),
                            i = r;
                            break
                        }
                    this.model.set("select", i)
                }
            }
        },
        updateLightIcons: function() {
            var t = u.vec4.create()
              , e = u.vec3.create()
              , i = u.vec3.create()
              , n = u.quat.create();
            return function() {
                var r = this.model.get("lights")
                  , a = this._viewer.getCamera()
                  , s = .02 * this._viewerOSGJS.getCanvasClientWidth() * u.mat4.getScale(t, a.getProjectionMatrix())[0];
                this._manipulator.getEyePosition(i);
                for (var o = this.getGizmo(), l = 0; l < 3; ++l) {
                    var h = r[l];
                    if ("NONE" !== h.get("type")) {
                        var c = h.getNodeEditLight()
                          , d = h.getNodeLight()
                          , p = h.getNodeQuad()
                          , f = h.getNodeScale()
                          , g = o._isEditing && o._attachedNode === c
                          , m = p.getMatrix()
                          , v = c.getMatrix()
                          , _ = d.getMatrix();
                        h.isAttachedToCamera() ? g ? (u.mat4.getTranslation(e, v),
                        u.mat4.multiply(_, a.getViewMatrix(), v),
                        u.mat4.setTranslation(_, e)) : (u.mat4.getTranslation(e, _),
                        u.mat4.invert(v, a.getViewMatrix()),
                        u.mat4.multiply(v, v, _),
                        u.mat4.setTranslation(v, e)) : g ? u.mat4.copy(_, v) : u.mat4.copy(v, _),
                        u.mat4.copy(h.get("matrix"), _),
                        c.getWorldMatrix(void 0, m),
                        u.mat4.getTranslation(e, m);
                        var b = u.vec3.dist(i, e) / s;
                        u.mat4.fromScaling(f.getMatrix(), u.vec3.set(t, b, b, b)),
                        u.mat4.multiply(m, a.getViewMatrix(), m),
                        u.mat4.invert(m, m),
                        u.mat4.fromQuat(m, u.mat4.getRotation(n, m)),
                        p.dirtyBound(),
                        d.dirtyBound(),
                        f.dirtyBound()
                    }
                }
            }
        }(),
        update: function() {
            var t = this._shadowNode;
            if (0 === t.getChildren().length)
                return !0;
            for (var e = this._viewer.getOptions().widgetAPI, i = e && "lighting" === e.getTabbedWidget().get() && this.model.get("enable"), n = this._viewer.getFeaturesManager().getShadowForcedUpdate(), r = "lit" === this._viewer.getFeatures().shadingStyle.getModel().get("style"), a = this.model.get("webVR"), s = this.model.get("lights"), o = 0; o < 3; ++o) {
                var l = s[o]
                  , h = n || l.isDirty();
                l.updateNode();
                var c = l.getShadowMap()
                  , d = a && l.isAttachedToCamera();
                if (!d && r && l.get("enable") && l.isCastingShadows()) {
                    if (!(h = h || l.isAttachedToCamera() || n)) {
                        for (var p = l.get("matrix"), f = l.get("matrixPrev"), g = 0; g < 16; g++)
                            if (p[g] !== f[g]) {
                                h = !0;
                                break
                            }
                        u.mat4.copy(f, p)
                    }
                    h && c.requestRedraw(),
                    t.addShadowTechnique(c)
                } else
                    (h || d) && t.removeShadowTechnique(c);
                l.setIconVisibility(i)
            }
            return !i || (this.updateLightIcons(),
            this.updateSelection(),
            !0)
        }
    });
    e.a = h
}
, function(t, e, i) {
    "use strict";
    e.a = {
        DIRECTION: i(759),
        SPOT: i(763),
        POINT: i(761),
        HEMI: i(760)
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(29)
      , a = n.a.osg
      , s = n.a.osgGA
      , o = function(t) {
        s.FirstPersonManipulator.call(this, t);
        var e = Math.max(0, Math.min(4, i.i(r.a)().fpsSpeed / 25));
        this._stepFactor = e,
        this.getControllerList().StandardMouseKeyboard._stepFactor = e,
        this._postMultRotate = a.quat.create(),
        this._resetInitialVR = !1,
        this._lookPosition._delay = .25
    };
    o.prototype = a.objectInherit(s.FirstPersonManipulator.prototype, {
        getPostMultRotate: function() {
            return this._postMultRotate
        },
        setResetInitialRotationVR: function(t) {
            this._resetInitialVR = t,
            t || a.quat.identity(this._postMultRotate)
        },
        setNode: function(t) {
            s.FirstPersonManipulator.prototype.setNode.call(this, t);
            var e = this.getHomeBound();
            e && e.valid() && (this._distance = this.getHomeDistance(e))
        },
        setInitialPoseVR: function() {
            var t = a.quat.create()
              , e = a.mat4.create()
              , i = a.vec3.fromValues(0, 0, 1);
            return function(n, r) {
                a.mat4.lookAt(e, n, r, i),
                a.mat4.invert(e, e),
                a.mat4.getRotation(t, e),
                t[1] = t[0] = 0,
                a.quat.normalize(t, t),
                a.quat.copy(this._postMultRotate, t),
                this.setEyePosition(n),
                this.setTarget(r),
                this.setResetInitialRotationVR(!0)
            }
        }(),
        setPoseVR: function() {
            var t = a.vec3.create();
            return function(e, i) {
                this._resetInitialVR && (a.quat.invert(this._vrRot, e),
                this._vrRot[0] = this._vrRot[1] = 0,
                a.quat.normalize(this._vrRot, this._vrRot),
                a.quat.multiply(this._postMultRotate, this._vrRot, this._postMultRotate)),
                a.quat.multiply(this._vrRot, this._postMultRotate, e),
                a.vec3.transformQuat(t, i, this._postMultRotate),
                this._resetInitialVR ? (a.vec3.set(this._vrTrans, 0, 0, 0),
                this._resetInitialVR = !1) : a.vec3.sub(this._vrTrans, t, this._vrPos),
                a.vec3.copy(this._vrPos, t),
                this._vrEnable = !0
            }
        }()
    }),
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(968)
      , a = i(970)
      , s = {
        FeatureName: "manipulator",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getManipulator = function() {
        return this._views[0]._switchManipulator
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(15)
      , a = i(29)
      , s = i(292)
      , o = n.a.osg
      , l = r.a.extend({
        defaults: {
            webVR: !1,
            indexManipulator: "fps" === i.i(a.a)().navigation ? 1 : 0,
            node: void 0,
            eyeCamera: o.vec3.create(),
            targetCamera: o.vec3.create(),
            minSpeed: .1
        },
        getName: function() {
            return "Manipulator"
        },
        init: function(t) {
            this._viewer = t.getViewer()
        },
        getCameraPosition: function(t, e) {
            if (this._viewer.getFeaturesManager().getCameraWithoutAutospin(t, e),
            0 !== this.get("indexManipulator") && this.get("node")) {
                var i = this.get("node").getMinimumBound()
                  , n = o.vec3.dist(t, i.center())
                  , r = Math.max(.1 * i.radius(), n);
                o.vec3.sub(e, e, t),
                o.vec3.normalize(e, e),
                o.vec3.scale(e, e, r),
                o.vec3.add(e, t, e)
            }
        },
        saveCameraPosition: function() {
            this.getCameraPosition(this.get("eyeCamera"), this.get("targetCamera"))
        },
        validateEyeTarget: function(t, e) {
            var i = o.vec3.dist(t, e);
            if (i <= 1e-8)
                return !1;
            var n = this.get("node").getMinimumBound().radius();
            return i <= .001 * n && (o.vec3.sub(e, e, t),
            o.vec3.scale(e, e, .01 * n / i),
            o.vec3.add(e, t, e)),
            !0
        },
        getJSON: function() {
            return {
                position: o.vec3.copy(o.vec3.create(), this.get("eyeCamera")),
                target: o.vec3.copy(o.vec3.create(), this.get("targetCamera"))
            }
        },
        editorGetJSON: function() {
            var t = []
              , e = [];
            return this.getCameraPosition(t, e),
            {
                position: t,
                target: e
            }
        },
        validateJSON: function(t) {
            var e = [];
            return s.a.isArrayNumber(t.position, 3) || e.push("Manipulator.editorSetJSON position must be a vec3"),
            s.a.isArrayNumber(t.target, 3) || e.push("Manipulator.editorSetJSON target must be a vec3"),
            this.validateEyeTarget(t.position, t.target) || e.push("Manipulator.editorSetJSON position and target are too close"),
            e.join("\n")
        },
        editorSetJSON: function(t) {
            var e = this._viewer.getFeaturesManager()
              , i = this.validateJSON(t);
            return i || (e.getViewerOSGJS().getManipulator().setTargetAndEye(t.target, t.position),
            i)
        }
    });
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(43)
      , a = i(29)
      , s = n.a.osg
      , o = n.a.osgGA
      , l = function(t) {
        o.OrbitManipulator.call(this, t),
        this.setLimitPitchUp(.5 * Math.PI * .99),
        this.setLimitPitchDown(.5 * -Math.PI * .99),
        r.a.getFirstCameraAnimation().then(function() {
            this.setLimitYawLeft(i.i(a.a)().orbitConstraintYawLeft),
            this.setLimitYawRight(i.i(a.a)().orbitConstraintYawRight),
            this.setLimitPitchDown(i.i(a.a)().orbitConstraintPitchDown),
            this.setLimitPitchUp(i.i(a.a)().orbitConstraintPitchUp),
            this.setLimitZoomOut(i.i(a.a)().orbitConstraintZoomOut),
            i.i(a.a)().orbitConstraintZoomIn > 0 && (this.setLimitZoomIn(i.i(a.a)().orbitConstraintZoomIn),
            this.setAutoPushTarget(!1))
        }
        .bind(this))
    };
    l.prototype = s.objectInherit(o.OrbitManipulator.prototype, {
        setEyePosition: function() {
            var t = s.vec3.create()
              , e = s.vec3.create()
              , i = s.vec3.create();
            return function(n, r) {
                var a = this._rotation
                  , o = this._target;
                if (s.vec3.sub(t, n, o),
                s.vec3.normalize(t, t),
                r) {
                    var l = s.vec3.dot(t, this._upz);
                    if (Math.abs(l) > .99) {
                        var u = Math.sqrt((1 - .9801) / (t[0] * t[0] + t[1] * t[1]));
                        t[0] *= u,
                        t[1] *= u,
                        t[2] = .99 * Math.sign(l)
                    }
                }
                s.vec3.cross(e, t, this._upz),
                s.vec3.normalize(e, e),
                s.vec3.cross(i, e, t),
                s.vec3.normalize(i, i),
                a[0] = e[0],
                a[1] = t[0],
                a[2] = i[0],
                a[3] = 0,
                a[4] = e[1],
                a[5] = t[1],
                a[6] = i[1],
                a[7] = 0,
                a[8] = e[2],
                a[9] = t[2],
                a[10] = i[2],
                a[11] = 0,
                a[12] = 0,
                a[13] = 0,
                a[14] = 0,
                a[15] = 1,
                this._distance = s.vec3.dist(o, n)
            }
        }()
    }),
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(6)
      , r = i(548)
      , a = i(29)
      , s = n.a.extend({
        initialize: function() {
            n.a.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:indexManipulator", this.onIndexManipulatorChanged, this),
            t.bind("change:node", this.onNodeChanged, this),
            t.bind("change:minSpeed", this.onNodeChanged, this),
            t.bind("change:webVR", this.setVR, this),
            this._switchManipulator = new r.a,
            this._viewer = this.options.context.getViewer(),
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._viewerOSGJS.setupManipulator(this._switchManipulator),
            this.onIndexManipulatorChanged()
        },
        setVR: function() {
            var t = this._viewerOSGJS.getManipulator()
              , e = this.model.get("webVR");
            t.setDelay(e ? 1 : .15);
            var i = this._viewerOSGJS.getEventProxy();
            if (this._viewerOSGJS.requestContinuousUpdate(!0),
            e) {
                this.lastMode = this.model.get("indexManipulator");
                var n = i.WebVR.getHmd()
                  , a = !!n
                  , s = !a;
                if (!s) {
                    var o = n.displayName.toLowerCase();
                    -1 === o.indexOf("cardboard") && -1 === o.indexOf("samsung") || (s = !0)
                }
                i.Hammer.setEnable(!1),
                i.WebVR.setEnable(a),
                i.DeviceOrientation.setEnable(!a),
                this.model.set("indexManipulator", r.a.FPS)
            } else
                i.DeviceOrientation.setEnable(!1),
                i.WebVR.setEnable(!1),
                i.Hammer.setEnable(!0),
                void 0 !== this.lastMode && this.model.set("indexManipulator", this.lastMode);
            var l = this._viewer.getFeatures();
            !l || l.webVR && l.webVR.getModel().get("modeLauncher") || t.computeHomePosition()
        },
        onIndexManipulatorChanged: function() {
            this._switchManipulator.setManipulatorIndex(this.model.get("indexManipulator"))
        },
        onNodeChanged: function() {
            var t = this._switchManipulator;
            t.setNode(this.model.get("node"));
            var e = t.getManipulatorList()[r.a.ORBIT]
              , n = t.getHomeBound().radius();
            e.setMinSpeed(this.model.get("minSpeed") * n),
            0 === i.i(a.a)().orbitConstraintZoomIn && e.setLimitZoomIn(.001 * n)
        }
    });
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(972)
      , a = i(549)
      , s = a.a.extend({
        getName: function() {
            return "Material"
        }
    })
      , o = {
        FeatureName: "material",
        ModelType: s,
        ViewListType: [r.a]
    }
      , l = n.a.create(o);
    l.prototype.getSceneLights = function() {
        return this._views[0].getSceneLights()
    }
    ,
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(1)
      , s = (i.n(a),
    i(4))
      , o = i(6)
      , l = i(43)
      , u = i(29)
      , h = i(89)
      , c = i(975)
      , d = i(987)
      , p = i(986)
      , f = i(329)
      , g = i(151)
      , m = i(356)
      , v = i(686)
      , _ = i(955)
      , b = s.a.osg
      , x = o.a.extend({
        getName: function() {
            return "MaterialManagerView3D"
        },
        initialize: function() {
            o.a.prototype.initialize.apply(this, arguments),
            this.model.bind("change", this.render, this),
            m.a.bind("change:mask", this.cleanAndApplyMaterials, this),
            this._sceneLights = [],
            this._defaultStateSet = void 0,
            this._defaultMaterial = void 0,
            this._renderingPaths = new d.a;
            var t = this.createImageCollection();
            this.model.setImageCollection(t.resource),
            this.model.imageCollection.isValid(),
            this.init()
        },
        init: function() {
            var t = this.options.context
              , e = t.getScene();
            this._viewer = t.getViewer(),
            this.resourceDefer = r.a.defer(),
            e.addResourcePromise(this.resourceDefer.promise),
            l.a.getPolygon().then(this.initSceneGraph.bind(this))
        },
        createImageCollection: function() {
            return this.getResourceManager().getOrCreateImageCollection()
        },
        getResourceManager: function() {
            return this._resourceManager || h.default.instance
        },
        getOrCreateDefaultStateSet: function() {
            return void 0 === this._defaultStateSet && (this._defaultStateSet = new b.StateSet,
            this._defaultStateSet._uniqueID = 0),
            this._defaultStateSet
        },
        getOrCreateDefaultMaterial: function(t, e) {
            var i = this.getOrCreateDefaultStateSet();
            if (void 0 === this._defaultMaterial) {
                if (this._defaultMaterial = e.getMaterialByStateSet(i),
                this._defaultMaterial) {
                    var n = e.getUniqueMaterialName(i.getAttributeMap().Material, i, t);
                    this._defaultMaterial.set("name", n)
                } else
                    this._defaultMaterial = e.createMaterial(t, i);
                this._defaultMaterial.setStateSet(i)
            }
            return t.setStateSet(i),
            this._defaultMaterial
        },
        processSceneGraph: function(t, e) {
            var i = new c.a(e)
              , n = i.apply(t);
            return t.accept(this._renderingPaths),
            this.fixWrongRootEditUser(t, this._renderingPaths),
            this.pruneSceneGraph(this._renderingPaths),
            0 === n.getMaterials().length && this.getOrCreateDefaultMaterial(t, e),
            this._renderingPaths.getPathList().forEach(function(t) {
                if (!t.some(function(t) {
                    var e = t.getStateSet();
                    return e && e.getAttribute("SketchfabMaterial")
                })) {
                    var i = t[t.length - 1];
                    this.getOrCreateDefaultMaterial(i, e)
                }
            }
            .bind(this)),
            this._sceneLights = n.getLights(),
            n
        },
        getSceneLights: function() {
            return this._sceneLights
        },
        fixWrongRootEditUser: function(t, e) {
            var n = this.model
              , r = this.hasWrongRootEditUser(n);
            if (r) {
                r.rootMaterialToKeep = !0;
                var s = {};
                if (i.i(a.each)(n.attributes, function(t) {
                    s[t.get("stateSetID")] = t
                }),
                2 === i.i(a.size)(n.attributes)) {
                    var o = i.i(a.filter)(n.attributes, function(t) {
                        return t.get("stateSet") !== r.get("stateSet")
                    })[0];
                    for (var l in r.attributes.channels)
                        r.attributes.channels[l].attributes.texture && (o.attributes.channels[l].attributes.texture = r.attributes.channels[l].attributes.texture)
                } else
                    for (var u = r, h = e.getStateSetPathList(), c = 0, d = h.length; c < d; c++) {
                        var f = h[c];
                        if (f[0] === u.attributes.stateSet)
                            for (var g = f.length - 1; g--; ) {
                                var m = f[g];
                                n.removeMaterialByStateSetID(m._uniqueID)
                            }
                    }
                var v = new p.a(s);
                t.accept(v),
                0 !== v.removedStateSet.length && (v.removedStateSet = v.removedStateSet.filter(function(t, e, i) {
                    return i.lastIndexOf(t) === e && -1 === v.keepedStateSet.indexOf(t)
                }),
                i.i(a.each)(v.removedStateSet, function(t) {
                    n.removeMaterialByStateSetID(t)
                }))
            }
        },
        initSceneGraph: function() {
            var t = this.options.context
              , e = this.model
              , n = t.getScene()
              , r = n.getRoot()
              , a = this._viewer.getFeatures();
            if (b.time("initSceneGraph - create saved materials"),
            !1 === i.i(u.a)().processMaterial) {
                var s = t.getModel().get("options").materials;
                for (var o in s)
                    e.addMaterial(s[o])
            }
            b.timeEnd("initSceneGraph - create saved materials"),
            b.time("initSceneGraph - processSceneGraph");
            var h = this.processSceneGraph(r, e);
            b.timeEnd("initSceneGraph - processSceneGraph"),
            b.time("initSceneGraph - apply materials"),
            e.removeUnboundMaterial();
            var c = !1;
            if (a.shadingStyle) {
                var d = a.shadingStyle.getModel();
                c = d.get("vertexColorEnable") && d.get("vertexAlphaEnable")
            }
            e.tagMaterialWithGeometryInfo(r, c),
            this._requestTextures(),
            e._style = h.getStyle();
            var p = h.hasMetallicWorkflow();
            void 0 !== p && e.setWorkFlowMetalSpec(p, !1),
            e.overrideMaterialChannels(i.i(u.a)()),
            e.updateTexCoordUnitList(),
            this.applyMaterials(),
            this.setWireframeStateSets(),
            b.timeEnd("initSceneGraph - apply materials"),
            _.a.optimize(this._renderingPaths, this._viewer),
            a.quality && a.quality.getModel().trigger("updateTexelPolicy"),
            l.a.resolveMaterial()
        },
        setWireframeStateSets: function() {
            var t = 0
              , e = this.model
              , n = !i.i(u.a)().mergeMaterials
              , r = {}
              , a = {}
              , s = this._renderingPaths.getPathList()
              , o = s.length;
            for (t = 0; t < o; ++t) {
                var l = s[t]
                  , h = l[l.length - 1];
                if (h instanceof b.Geometry != !1) {
                    var c = h.getVertexAttributeList().Vertex;
                    c && (a[c.getInstanceID()] = l)
                }
            }
            var d = this._renderingPaths.getWireframePathList()
              , p = this.options.context.getScene().getWireframeNodes()
              , f = p.length;
            for (t = 0; t < f; ++t) {
                var g = p[t]
                  , m = g.getVertexAttributeList()
                  , _ = a[m.Vertex.getInstanceID()];
                if (_) {
                    var x, y = _[_.length - 1], S = e.findFirstMaterial(_), w = S.getChannels().Displacement, C = S && S.get("stateSet"), M = y.getVertexAttributeList();
                    if (n) {
                        x = new v.a,
                        M.Normal && (m.Normal = M.Normal);
                        for (var T in M)
                            -1 !== T.indexOf("TexCoord") && (m[T] = M[T]);
                        x.textureAttributeMapList = C.textureAttributeMapList,
                        x.setAttributeAndModes(C.getAttribute("SketchfabMaterial"))
                    } else if (w.isEffective()) {
                        var A = JSON.stringify(w.getJSON());
                        x = r[A];
                        var E = "TexCoord" + w.getTexCoordUnit();
                        M[E] && (m[E] = M[E]),
                        M.Normal && (m.Normal = M.Normal),
                        x || (x = r[A] = new v.a,
                        x.textureAttributeMapList = C.textureAttributeMapList,
                        x.setAttributeAndModes(C.getAttribute("SketchfabMaterial")))
                    } else
                        x = r.static = r.static || new v.a;
                    g.setStateSet(x)
                } else {
                    p.splice(t, 1),
                    t--,
                    f--;
                    for (var P = g.getParents(), N = 0, k = P.length; N < k; ++N)
                        P[N].removeChild(g);
                    for (var F = 0; F < d.length; ++F) {
                        var D = d[F];
                        D[D.length - 1] === g && (d.splice(F, 1),
                        F--)
                    }
                }
            }
        },
        pruneSceneGraph: function(t) {
            for (var e = t.getStateSetMapNodes(), i = t.getStateSetPathList(), n = t.getStateSetMap(), r = {}, a = 0, s = i.length; a < s; a++) {
                var o = i[a];
                if (o.length > 0) {
                    var l = o.length - 1
                      , u = o[l];
                    r[u._uniqueID] = u
                }
            }
            var h = 0
              , c = 0;
            for (var d in e)
                if (void 0 === r[d]) {
                    this.model.removeMaterialByStateSet(n[d]),
                    c++;
                    for (var p = 0, f = e[d].length; p < f; p++) {
                        var g = e[d][p];
                        g.setStateSet(void 0),
                        h += f
                    }
                }
        },
        hasWrongRootEditUser: function(t) {
            var e;
            return i.i(a.size)(t.attributes) > 1 && i.i(a.values)(t.attributes)[0].get("version") < 2 && (e = i.i(a.find)(t.attributes, function(t) {
                if (t.attributes && t.attributes.name) {
                    var e = t.attributes.name.toLowerCase();
                    if (-1 !== e.indexOf("root") || -1 !== e.indexOf("ollada visual")) {
                        if (void 0 !== i.i(a.find)(t.attributes.channels, function(t) {
                            return void 0 !== t.getTexture()
                        }))
                            return !0
                    }
                }
                return !1
            })),
            e
        },
        cleanAndApplyMaterials: function() {
            i.i(a.each)(this.model.attributes, function(t) {
                t.get("stateSet") && t.trigger("change:stateSet")
            }),
            this.applyMaterials()
        },
        applyMaterials: function() {
            i.i(a.each)(this.model.attributes, function(t) {
                t.trigger("apply")
            })
        },
        _requestTexture: function(t, e, i) {
            if (t) {
                var n = t.getChannels()[e]
                  , r = n.getTexture();
                if (r && n.isEffective()) {
                    var a = r.getTextureProxy();
                    if (a) {
                        if (0 === a.getImageCount())
                            return void n.setColor(b.vec3.fromValues(.9, .9, .9));
                        return (i ? a.getImageSmallest() : a.getImageMaxSupported()).promise
                    }
                }
            }
        },
        _requestAllTextures: function(t, e) {
            var n = this
              , r = []
              , s = new window.Set;
            return g.a.forEach(function(o) {
                i.i(a.each)(t, function(t) {
                    var i = n._requestTexture(t, o, e);
                    i && !s.has(i) && (s.add(i),
                    r.push(i))
                })
            }),
            r
        },
        _resolvePromiseTextures: function(t, e, i) {
            for (var n = (new Date).getTime() - e, r = 0, a = 0, s = t.length; a < s; ++a)
                !0 !== t[a] && r++;
            (i ? l.a.resolveLowResLoaded : l.a.resolveHighResLoaded)({
                time: r > 0 ? n : 0,
                count: r
            })
        },
        requestAllLowResTextures: function(t) {
            return this._requestAllTextures(t, !0)
        },
        requestAllHighResTextures: function(t) {
            return this._requestAllTextures(t, !1)
        },
        _resolvePromiseLowResTextures: function(t, e) {
            return this._resolvePromiseTextures(t, e, !0)
        },
        _resolvePromiseHighResTextures: function(t, e) {
            return this._resolvePromiseTextures(t, e, !1)
        },
        _requestTextures: function() {
            var t = this
              , e = this.options.context
              , n = e.getViewer()
              , a = i.i(u.a)()
              , s = a.preload;
            f.a.WAIT_ANIMATION = !s;
            var o = this.model.toJSON()
              , l = this.requestAllLowResTextures(o)
              , h = (new Date).getTime();
            s || n.setFakePrimaryProgress(l),
            r.a.settle(l).then(function() {
                t._resolvePromiseLowResTextures(l, h);
                var e = (new Date).getTime()
                  , i = t.requestAllHighResTextures(o);
                n.setFakeProgress(i, !s),
                r.a.settle(i).then(function() {
                    t._resolvePromiseHighResTextures(i, e),
                    s && t.resourceDefer.resolve()
                }),
                s || t.resourceDefer.resolve()
            })
        },
        _getUniqueTextures: function() {
            var t = {}
              , e = this.model.attributes
              , n = [];
            return i.i(a.each)(e, function(e) {
                for (var i = e.get("stateSet"), r = i.getNumTextureAttributeLists(), a = 0; a < r; ++a) {
                    var s = i.getTextureAttribute(a, "Texture");
                    s && s.getChannelPacking && (t[s.getInstanceID()] || (t[s.getInstanceID()] = !0,
                    n.push(s)))
                }
            }),
            n
        },
        getOrCreateTexelInfos: function() {
            if (this._infoTex)
                return this._infoTex;
            for (var t = this._infoTex = {
                missingResolution: !1,
                count: 0,
                pixelCount: 0,
                min: 1 / 0,
                max: -1 / 0
            }, e = {
                width: 0,
                height: 0,
                missingResolution: !1
            }, i = this._getUniqueTextures(), n = i.length, r = 0; r < n; ++r) {
                e = i[r].getMaxTextureSizePacked(e),
                t.count++,
                t.pixelCount += e.width * e.height;
                var a = Math.max(e.width, e.height);
                t.min = Math.min(a, t.min),
                t.max = Math.max(a, t.max),
                e.missingResolution && (t.missingResolution = !0)
            }
            return t
        }
    });
    e.a = x
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(1)
      , a = (i.n(r),
    i(15))
      , s = i(550)
      , o = i(293)
      , l = i(151)
      , u = i(292)
      , h = n.a.osg
      , c = i.i(r.invert)(h.CullFace)
      , d = function(t, e) {
        return t - e
    }
      , p = function(t) {
        var e = {};
        return [{
            name: "DiffuseColor",
            displayName: "Diffuse",
            color: i.i(o.a)() ? h.vec3.fromValues(1, 1, 1) : h.vec3.fromValues(.5, .5, .5),
            factor: 1,
            enable: !0
        }, {
            name: "DiffuseIntensity",
            displayName: "Lightmap",
            color: h.vec3.fromValues(1, 1, 1),
            factor: 1,
            enable: !0
        }, {
            name: "SpecularColor",
            displayName: "Specular Color",
            color: h.vec3.fromValues(.5, .5, .5),
            factor: 0,
            enable: !0
        }, {
            name: "SpecularHardness",
            displayName: "Glossiness",
            factor: 12.5,
            enable: !0
        }, {
            name: "Displacement",
            displayName: "Displacement",
            factor: 0,
            enable: !0
        }, {
            name: "NormalMap",
            displayName: "Normal map",
            factor: 1,
            enable: !1,
            flipY: !0
        }, {
            name: "BumpMap",
            displayName: "Bump map",
            factor: 1,
            enable: !1
        }, {
            name: "Opacity",
            displayName: "Transparency",
            factor: 1,
            type: "alphaBlend",
            enable: !0
        }, {
            name: "EmitColor",
            displayName: "Emission",
            color: h.vec3.fromValues(1, 1, 1),
            factor: 0,
            enable: !0,
            type: "additive"
        }, {
            name: "DiffusePBR",
            displayName: "Albedo",
            color: h.vec3.fromValues(1, 1, 1),
            factor: 1,
            enable: !1
        }, {
            name: "AlbedoPBR",
            displayName: "Base Color",
            color: h.vec3.fromValues(1, 1, 1),
            factor: 1,
            enable: !0
        }, {
            name: "SpecularPBR",
            displayName: "Specular",
            color: h.vec3.fromValues(1, 1, 1),
            factor: .05,
            enable: !1
        }, {
            name: "GlossinessPBR",
            displayName: "Glossiness",
            factor: .4,
            enable: !1
        }, {
            name: "RoughnessPBR",
            displayName: "Roughness",
            factor: .6,
            enable: !0
        }, {
            name: "MetalnessPBR",
            displayName: "Metalness",
            factor: 0,
            enable: !0
        }, {
            name: "SpecularF0",
            displayName: "Specular F0",
            factor: .5,
            enable: !0
        }, {
            name: "AOPBR",
            displayName: "Ambient Occlusion",
            factor: 1,
            enable: !1,
            occludeSpecular: !1
        }, {
            name: "CavityPBR",
            displayName: "Cavity",
            factor: 1,
            enable: !1
        }].forEach(function(i) {
            var n = i.name;
            i.material = t,
            e[n] = new s.default[n].model(i)
        }, e),
        e
    }
      , f = a.a.extend({
        defaults: function() {
            return {
                version: 3,
                shadeless: !1,
                id: "0",
                stateSetID: 0,
                name: "noname",
                channels: p(this),
                geometryList: [],
                texCoordUnitList: [],
                cullFace: h.CullFace.DISABLE,
                reflection: i.i(o.a)() ? .1 : .3,
                vertexColorColorSpace: "srgb",
                vertexColorEnable: !1,
                vertexAlphaEnable: !1,
                hasVertexColor: !1,
                hasVertexAlpha: !1,
                hasTriangles: !1,
                hasPoints: !1,
                hasLines: !1
            }
        },
        setMaterial: function(t) {
            this.set(t),
            i.i(r.each)(t.channels, function(t, e) {
                this.getChannels()[e].set(t)
            }, this)
        },
        setMaterialJSON: function(t, e) {
            void 0 !== t.version && this.set("version", t.version),
            void 0 !== t.shadeless && this.set("shadeless", t.shadeless),
            void 0 !== t.id && this.set("id", t.id),
            void 0 !== t.stateSetID && this.set("stateSetID", t.stateSetID),
            void 0 !== t.name && this.set("name", t.name),
            void 0 !== t.reflection && this.set("reflection", t.reflection),
            void 0 !== t.cullFace && this.set("cullFace", h.CullFace[t.cullFace]);
            var i = t.channels;
            if (i)
                for (var n = this.getChannels(), r = l.a.length, a = 0; a < r; ++a) {
                    var s = l.a[a]
                      , o = i[s];
                    if (o) {
                        var u = n[s];
                        u && u.setChannelJSON(o, e)
                    }
                }
        },
        getChannels: function() {
            return this.get("channels")
        },
        setStateSet: function(t) {
            return this.set("stateSet", t),
            this
        },
        setChannelEnable: function(t, e) {
            var i = this.get("channels");
            return i[t] ? (i[t].setEnable(e),
            this) : this
        },
        setChannelColor: function(t, e) {
            var i = this.get("channels");
            return i[t] ? (i[t].setColor(e),
            this) : this
        },
        setChannelTexture: function(t, e) {
            var i = this.get("channels");
            return i[t] ? (i[t].setTexture(e),
            this) : this
        },
        setChannelFactor: function(t, e) {
            var i = this.get("channels");
            return i[t] ? (i[t].setFactor(e),
            this) : this
        },
        getJSON: function() {
            var t = {};
            t.version = 3,
            t.stateSetID = this.get("stateSetID"),
            t.shadeless = this.get("shadeless"),
            t.id = this.get("id"),
            t.name = this.get("name"),
            t.cullFace = c[this.get("cullFace")],
            t.reflection = this.get("reflection");
            var e = {};
            return i.i(r.each)(this.get("channels"), function(t, i) {
                e[i] = t.getJSON()
            }),
            t.channels = e,
            t
        },
        copyDualChannel: function(t, e) {
            var i = this.getChannels()
              , n = i[t]
              , r = i[e]
              , a = r.getTexture()
              , s = "MetalnessPBR" === t || "SpecularPBR" === t
              , o = "NormalMap" === t || "BumpMap" === t;
            a ? (a = a.clone(),
            (s || o) && (a.setImage(a.getImage()),
            a.set("internalFormat", "NormalMap" === t || "SpecularPBR" === t ? h.Texture.RGB : h.Texture.LUMINANCE),
            a.updateTextureProxy()),
            n.setTexture(a)) : s || n.setColor(r.getColor()),
            o || n.setFactor(r.getFactor())
        },
        getWorkFlowPBRMetalSpec: function() {
            return this.getChannels().MetalnessPBR.getEnable()
        },
        getWorkFlowPBRRoughGloss: function() {
            return this.getChannels().RougnessPBR.getEnable()
        },
        setWorkFlowRoughGloss: function(t, e) {
            var i = t ? "GlossinessPBR" : "RoughnessPBR"
              , n = t ? "RoughnessPBR" : "GlossinessPBR"
              , r = this.getChannels();
            r[i].setEnable(!1),
            r[n].setEnable(!0),
            e && this.copyDualChannel(n, i, r)
        },
        setWorkFlowMetalSpec: function(t, e) {
            var i = t ? "DiffusePBR" : "AlbedoPBR"
              , n = t ? "SpecularPBR" : "MetalnessPBR"
              , r = t ? "AlbedoPBR" : "DiffusePBR"
              , a = t ? "MetalnessPBR" : "SpecularPBR"
              , s = this.getChannels();
            s[i].setEnable(!1),
            s[n].setEnable(!1),
            s.SpecularF0.setEnable(t),
            s[r].setEnable(!0),
            s[a].setEnable(!0),
            e && (this.copyDualChannel(r, i),
            this.copyDualChannel(a, n))
        },
        hasOnlyPoints: function() {
            return this.get("hasPoints") && !this.get("hasTriangles") && !this.get("hasLines")
        },
        updateTexCoordUnitList: function() {
            var t = this.get("texCoordUnitList");
            t.length = 0;
            for (var e, i, n = this.get("geometryList"), r = n.length, a = [], s = [], o = 0; o < r; ++o) {
                var u = n[o].getVertexAttributeList();
                s.length = 0;
                for (var h in u)
                    -1 !== h.indexOf("TexCoord") && s.push(parseInt(h.substring(8)));
                for (s.sort(d),
                e = s.length - 1; e >= 0; --e) {
                    var c = s[e]
                      , p = u["TexCoord" + c];
                    for (i = 0; i < e; ++i) {
                        var f = s[i];
                        if (p === u["TexCoord" + f]) {
                            var g = a[c];
                            void 0 !== g && g !== f ? -1 === t.indexOf(c) && t.push(c) : a[c] = f;
                            break
                        }
                    }
                    var m = s[i];
                    -1 === t.indexOf(m) && t.push(m)
                }
            }
            if (t.sort(d),
            0 !== a.length) {
                var v = t.length;
                for (e = 0; e < v; ++e)
                    a[t[e]] = t[e];
                var _ = this.getChannels()
                  , b = l.a.length;
                for (e = 0; e < b; ++e) {
                    var x = _[l.a[e]];
                    x.setTexCoordUnit(a[x.getTexCoordUnit()])
                }
            }
        }
    });
    f.validateJSON = function(t, e) {
        var i = [];
        u.a.isBoolean(t.shadeless) || i.push("Material shadeless must be a boolean"),
        u.a.isString(t.name) || i.push("Material name must be a string"),
        u.a.isEnumString(t.cullFace, ["DISABLE", "BACK"]) || i.push("Material cullFace must be an integer enum [ DISABLE, BACK ]"),
        u.a.isNumber(t.reflection, 0, 1) || i.push("Material reflection must be a number in range [ 0.0, 1.0 ]"),
        void 0 === t.channels && i.push("Material channels must be an {} but is undefined");
        for (var n = t.channels, r = l.a, a = 0; a < r.length; a++) {
            var o = r[a]
              , h = n[o];
            if (h) {
                var c = s.default[o].model.validateJSON(o, h, e);
                c && i.push(c)
            }
        }
        return i.join("\n")
    }
    ,
    e.a = f
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(6))
      , a = i(550)
      , s = i(684)
      , o = i(51)
      , l = i(151)
      , u = r.a.extend({
        initialize: function() {
            r.a.prototype.initialize.apply(this, arguments),
            this.model.bind("change:stateSet", this.stateSet, this),
            this.model.bind("change:cullFace", this.onCullFace, this),
            this.model.bind("change:shadeless", this.onDirty, this),
            this.model.bind("change:vertexColorEnable", this.onDirty, this),
            this.model.bind("change:vertexColorColorSpace", this.onDirty, this),
            this.model.bind("change:vertexAlphaEnable", this.onDirty, this),
            this.model.bind("change:hasPoints", this.onPrimitive, this),
            this.model.bind("change:hasTriangles", this.onPrimitive, this),
            this.model.bind("change:hasLines", this.onPrimitive, this),
            this.model.bind("apply", this.apply, this),
            this.model.bind("change", o.a.draw),
            this._context = new s.a(this.model),
            this._views = {};
            for (var t = this.model.get("channels"), e = l.a.length, i = 0; i < e; ++i) {
                var n = l.a[i]
                  , u = t[n];
                this._views[n] = new a.default[n].view({
                    model: u,
                    stateSetContext: this._context
                }),
                u.bind("change:enable", this.onEnableChanged, this)
            }
        },
        getStateSetContext: function() {
            return this._context
        },
        stateSet: function() {
            var t = this.model.get("stateSet");
            return t.setName(this.model.get("name")),
            this.getStateSetContext().setStateSet(t),
            this
        },
        apply: function() {
            i.i(n.each)(this._views, function(t) {
                t.apply()
            }, this),
            this.onCullFace(),
            this.onDirty()
        },
        onDirty: function() {
            this.getStateSetContext().dirtyMaterial()
        },
        onCullFace: function() {
            this.getStateSetContext().setCullface(this.model.get("cullFace"))
        },
        onPrimitive: function() {
            this.getStateSetContext().setPointCircle(this.model.hasOnlyPoints())
        },
        onEnableChanged: function(t, e) {
            if (!0 === e) {
                var i = t.getName()
                  , n = this.model.getChannels();
                "BumpMap" === i ? n.NormalMap.setEnable(!1) : "NormalMap" === i && n.BumpMap.setEnable(!1),
                "GlossinessPBR" === i ? n.RoughnessPBR.setEnable(!1) : "RoughnessPBR" === i && n.GlossinessPBR.setEnable(!1),
                "AlbedoPBR" === i || "MetalnessPBR" === i ? (n.DiffusePBR.setEnable(!1),
                n.SpecularPBR.setEnable(!1)) : "DiffusePBR" !== i && "SpecularPBR" !== i || (n.AlbedoPBR.setEnable(!1),
                n.MetalnessPBR.setEnable(!1))
            }
            return this
        }
    });
    e.a = u
}
, function(t, e, i) {
    "use strict";
    var n = i(982)
      , r = i(977)
      , a = i(385)
      , s = function(t) {
        this._materialManager = t
    };
    s.prototype = {
        apply: function(t) {
            var e = new n.a;
            t.accept(e);
            var i = e.getSource()
              , s = e.getAuthoringTool();
            i = i ? i.toLowerCase() : "default";
            var o = r.a[i] ? r.a[i] : r.a.default
              , l = new o(this._materialManager,s);
            t.accept(l),
            l.postApply(t),
            "q3d" !== i && (a.a.hasTriangles || a.a.hasVertexNormals) || (l._style = "shadeless");
            var u = t.getUserData() || [];
            return u.push({
                Name: "source",
                Value: i
            }, {
                Name: "authoringTool",
                Value: s
            }),
            t.setUserData(u),
            t.userDataMap = a.a.convertUserDataToObject(u),
            l
        }
    },
    e.a = s
}
, function(t, e, i) {
    "use strict";
    e.a = function() {
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(t) {
            var e = 16 * Math.random() | 0;
            return ("x" === t ? e : 3 & e | 8).toString(16)
        })
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(978)
      , r = i(979)
      , a = i(980)
      , s = i(981)
      , o = i(984)
      , l = i(985)
      , u = i(685)
      , h = i(983);
    e.a = {
        default: a.a,
        wavefront: u.a,
        blender: n.a,
        ksp: n.a,
        lightwave: o.a,
        minecraft: l.a,
        collada: r.a,
        fbx: s.a,
        substancepainter: r.a,
        mineways: l.a,
        gltf: h.a
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(357)
      , s = i(384)
      , o = r.a.osg
      , l = function() {
        a.a.apply(this, arguments)
    };
    l.prototype = o.objectInherit(a.a.prototype, {
        cyclesNodeToMaterial: function(t, e, i, n, r, a, s, l) {
            var u = t.nodes[r];
            if (void 0 !== u) {
                void 0 === l && (l = r);
                var h = "setChannel" + n;
                if (void 0 === e[h])
                    return void o.warn("material has not method " + h);
                if (!(s && a && u.inputs) && u.value)
                    return void e[h](l, u.value);
                for (var c = 0; c < u.inputs.length; c++) {
                    var d = u.inputs[c];
                    if (d.name === a) {
                        var p = d.default_value;
                        if (void 0 !== p)
                            if (Array.isArray(p))
                                if ("Opacity" === l || "Transparent BSDF" === l || "Glass BSDF" === l)
                                    if ("Color" === a) {
                                        var f = p[0] * p[1] * p[2] * p[3];
                                        1 === f && (f = .15),
                                        e[h](l, f)
                                    } else
                                        e[h](l, p);
                                else
                                    "SpecularPBR" === l ? "Color" === a ? e[h](l, p) : (p = p[0] * p[1] * p[2] * p[3],
                                    e[h](l, p)) : "Color" === a && "NormalMap" === l || e[h](l, p);
                            else
                                "setChannelColor" !== l && "Color" !== n && ("Strength" === a && "Emission" === r && (p /= 10),
                                e[h](l, p));
                        if (d.links && "SpecularPBR" !== l) {
                            for (var g = 0; g < d.links.length; g++) {
                                var m = d.links[g];
                                if (m.from_node) {
                                    var v = t.nodes[m.from_node];
                                    if (v) {
                                        var _ = v.texture_slot;
                                        if (p = i.getTextureAttribute(_, "Texture")) {
                                            e.setChannelTexture(l, this.createTextureModelFromTextureOSG(p));
                                            var b = e.getChannels()[l];
                                            b.resetTextureFormat(),
                                            b.setTexCoordUnit(_),
                                            b.setEnable(!0),
                                            this._texturesAssigned.push(p)
                                        }
                                    }
                                    void 0 !== v && void 0 !== p || o.warn("Missing Texture linked in " + r + " node destined to " + l)
                                }
                            }
                            return
                        }
                    }
                }
                u = this.findNodeByValueCyclesMetadata(t.nodes, r),
                u && u.value && e[h](l, u.value)
            }
        },
        findNodeByValueCyclesMetadata: function(t, e) {
            for (var i in t) {
                var n = t[i];
                if (n instanceof Object) {
                    var r = this.findNodeByValueCyclesMetadata(n, e);
                    if (void 0 !== r)
                        return r
                } else if (n === e)
                    return t
            }
        },
        metaDataToMaterial: function(t, e, i, n, r, a) {
            if (void 0 !== t[n]) {
                void 0 === r && (r = n);
                var s = "setChannel" + i;
                if (void 0 === e[s])
                    return void o.warn("material has not method " + s);
                void 0 === a || !0 === a ? e[s](r, JSON.parse(t[n])) : e[s](r, t[n])
            }
        },
        setTextureFromBlender: function(t, e, i, n, r) {
            var a = t.getChannels()[e];
            a.setFactor(r);
            var s = this.createTextureModelFromTextureOSG(n);
            a.setTexture(s),
            a.resetTextureFormat(),
            a.setTexCoordUnit(i),
            a.setEnable(!0)
        },
        processDefaultMaterial: function(t, e) {
            e.removeAttribute("Material");
            for (var i = 0, n = e.getNumTextureAttributeLists(); i < n; i++)
                e.removeTextureAttribute(i, "Texture");
            t.setStateSet(void 0)
        },
        processLightSource: function(t) {
            var e = t.getLight();
            if (e && void 0 !== e.getUserData() && e.typeID !== s.a.typeID) {
                var i = e.getUserData()
                  , n = this.convertUserDataToObject(i)
                  , r = new s.a;
                "AREA" !== n.Type && "SUN" !== n.Type && "HEMI" !== n.Type || (n.Type = "DIRECTION"),
                r.setLightType(n.Type),
                void 0 !== n.SpotSize && r.setSpotCutoff(90 * JSON.parse(n.SpotSize) / Math.PI),
                void 0 !== n.SpotBlend && r.setSpotBlend(JSON.parse(n.SpotBlend)),
                o.vec3.scale(r.getDiffuse(), JSON.parse(n.Color), JSON.parse(n.Energy));
                var a = 1 / JSON.parse(n.Distance);
                r.setQuadraticAttenuation(Math.abs(a) === 1 / 0 ? 0 : a),
                this.pushLight(r)
            }
        },
        processCyclesGraph: function(t, e, i) {
            var n;
            try {
                n = JSON.parse(i.NodeTree)
            } catch (t) {
                return o.warn("error in blender cycle graph json " + t),
                !0
            }
            if (void 0 === n)
                return !0;
            this._texturesAssigned = [],
            this.cyclesNodeToMaterial(n, t, e, "Color", "Diffuse BSDF", "Color", !0, "DiffusePBR"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Diffuse BSDF", "Roughness", !0, "RoughnessPBR"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Diffuse BSDF", "Normal", !0, "NormalMap"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Glossy BSDF", "Color", !0, "SpecularPBR"),
            t.setChannelFactor("SpecularPBR", 1),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Glossy BSDF", "Roughness", !0, "RoughnessPBR"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Glossy BSDF", "Normal", !0, "NormalMap"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Bump", "Height", !0, "NormalMap"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Bump", "Strength", !0, "NormalMap"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Emission", "Color", !0, "EmitColor"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Emission", "Strength", !0, "EmitColor"),
            this.cyclesNodeToMaterial(n, t, e, "Color", "Ambient Occlusion", "Color", !0, "AOPBR"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Ambient Occlusion", "Strength", !0, "AOPBR"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Transparency", "Strength", !0, "Opacity"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Transparent BSDF", "Color", !0, "Opacity"),
            this.cyclesNodeToMaterial(n, t, e, "Factor", "Glass BSDF", "Color", !0, "Opacity");
            for (var r = [], a = 0, s = e.getNumTextureAttributeLists(); a < s; a++) {
                var l = e.getTextureAttribute(a, "Texture");
                l && -1 === this._texturesAssigned.indexOf(l) && r.push(l)
            }
            return this.assignPBRTextureFromFilenames(r, t),
            t.setWorkFlowMetalSpec(!1, !1),
            t.setWorkFlowRoughGloss(!0, !1),
            !1
        },
        processMaterial: function(t, e, r) {
            var a = this.createMaterial(t, e)
              , s = e.getAttribute("Material")
              , l = this.convertUserDataToObject(s ? s.getUserData() : void 0)
              , u = !0;
            l.NodeTree && (u = this.processCyclesGraph(a, e, l)),
            u && (this.metaDataToMaterial(l, a, "Color", "DiffuseColor"),
            this.metaDataToMaterial(l, a, "Factor", "DiffuseIntensity", "DiffuseColor"),
            a.setChannelEnable("DiffuseColor", !0),
            this.metaDataToMaterial(l, a, "Color", "SpecularColor"),
            this.metaDataToMaterial(l, a, "Factor", "SpecularIntensity", "SpecularColor"),
            a.setChannelEnable("SpecularColor", !0),
            this.metaDataToMaterial(l, a, "Factor", "Emit", "EmitColor"),
            a.setChannelEnable("EmitColor", !0),
            this.metaDataToMaterial(l, a, "Factor", "SpecularHardness"),
            a.setChannelEnable("SpecularHardness", !0),
            void 0 !== l.Translucency && (a.setChannelFactor("Opacity", 1 - JSON.parse(l.Translucency)),
            a.setChannelEnable("Opacity", !0)),
            void 0 !== r.Shadeless && a.set("shadeless", r.Shadeless));
            var h = i.i(n.chain)(e.getUserData()).map(function(t) {
                var e = t.Name.substr(0, 2)
                  , i = parseInt(e, 10);
                if (!isNaN(i))
                    return i
            }).without(void 0).uniq().sortBy(function(t) {
                return t
            }).value();
            e.removeAttribute("Material");
            var c = {}
              , d = ["DiffuseColor", "DiffuseIntensity", "SpecularColor", "Normal", "Bump", "Translucency", "Alpha", "EmitColor", "SpecularHardness"]
              , p = this;
            i.i(n.each)(h, function(t) {
                var r = i.i(n.chain)(e.getUserData()).filter(function(e) {
                    var i = e.Name.substr(0, 2);
                    return parseInt(i, 10) === t
                }).value();
                i.i(n.each)(r, function(t) {
                    var r = t.Name.substr(0, 2)
                      , s = parseInt(r, 10)
                      , l = e.getTextureAttribute(s, "Texture");
                    if (void 0 === l)
                        return void o.warn("missing texture");
                    c[s] = l;
                    var u = t.Name.substr(3);
                    if (!0 === i.i(n.includes)(d, u)) {
                        var h = parseFloat(t.Value);
                        "DiffuseColor" === u ? void 0 !== a.getChannels().DiffuseColor.getTexture() && void 0 === a.getChannels().DiffuseIntensity.getTexture() && (u = "DiffuseIntensity") : "Alpha" === u ? u = "Opacity" : "Translucency" === u ? (u = "Opacity",
                        h = 1 - h) : "Normal" === u ? u = "NormalMap" : "Bump" === u && (u = "BumpMap"),
                        p.setTextureFromBlender(a, u, s, l, h)
                    } else
                        "UsePremultiplyAlpha" === u ? o.warn("UsePremultiplyAlpha not supported") : "UseAlpha" === u ? o.warn("UseAlpha not supported") : o.warn("channel " + u + " not supported")
                })
            });
            for (var f in c)
                e.removeTextureAttribute(parseInt(f, 10), "Texture");
            "ksp" === l.source && (-1 === a.attributes.name.toLowerCase().indexOf("wheel") ? a.getChannels().MetalnessPBR.setFactor(1) : a.getChannels().SpecularF0.setFactor(0),
            -1 !== a.attributes.name.toLowerCase().indexOf("fairing") && a.getChannels().Opacity.setFactor(.25)),
            a.setStateSet(e)
        }
    }),
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(357)
      , a = n.a.osg
      , s = function() {
        r.a.apply(this, arguments)
    };
    s.prototype = a.objectInherit(r.a.prototype, {
        processMaterial: function(t, e, i) {
            var n, r = this.createMaterial(t, e), a = ["lambert", "blinn", "phong"], s = function(t, e, n) {
                for (var r = a.length, s = "_" + t + "_" + e; r--; )
                    if (void 0 !== i[a[r] + s]) {
                        var o = i[a[r] + s];
                        return n ? o : JSON.parse(o)
                    }
            }, o = "color";
            n = s("emission", o),
            void 0 !== n && (r.setChannelColor("EmitColor", n),
            r.setChannelEnable("EmitColor", !0)),
            n = s("diffuse", o),
            void 0 !== n && (r.setChannelColor("DiffuseColor", n),
            r.setChannelEnable("DiffuseColor", !0)),
            n = s("specular", o),
            void 0 !== n && (r.setChannelColor("SpecularColor", n),
            r.setChannelEnable("SpecularColor", !0)),
            o = "amount",
            void 0 !== (n = s("shininess", o)) && (r.setChannelFactor("SpecularHardness", 128 * n),
            r.setChannelEnable("SpecularHardness", !0));
            var l = 1;
            n = s("transparency", "amount"),
            void 0 !== n && (l = n),
            n = s("transparency", "color"),
            void 0 !== n && 4 === n.length && (l = n[3]),
            r.setChannelFactor("Opacity", l),
            r.setChannelEnable("Opacity", !0),
            e.removeAttribute("Material");
            var u, h, c = [];
            !function() {
                for (var t = 0; t < e.getNumTextureAttributeLists(); t++) {
                    var i = e.getTextureAttribute(t, "Texture");
                    void 0 !== i && ("TextureMaterial" === i.className() && (i = i.getTexture()),
                    c[t] = i)
                }
            }();
            var d = function(t, i, n) {
                e.removeTextureAttribute(t, "Texture");
                var a = r.getChannels()[n];
                a.setTexture(this.createTextureModelFromTextureOSG(i)),
                a.resetTextureFormat(),
                a.setTexCoordUnit(t),
                a.setEnable(!0)
            }
            .bind(this);
            if (o = "unit",
            n = s("emissive", o),
            void 0 !== n && (u = n,
            void 0 !== (h = c[u]) && d(u, h, "EmitColor")),
            n = s("diffuse", o),
            void 0 !== n && (u = n,
            void 0 !== (h = c[u]) && d(u, h, "DiffuseColor")),
            n = s("specular", o),
            void 0 !== n && (u = n,
            void 0 !== (h = c[u]) && d(u, h, "SpecularColor")),
            void 0 !== i.extra_shininess_unit && (u = JSON.parse(i.extra_shininess_unit),
            void 0 !== (h = c[u]) && d(u, h, "SpecularColor")),
            void 0 !== (n = s("transparency", o)) && (u = n,
            void 0 !== (h = c[u]))) {
                s("transparency", "alphamask") ? (d(u, h, "Opacity"),
                h = r.getChannels().Opacity.getTexture(),
                r.getChannels().Opacity.setTransparency("alphaMask")) : (d(u, h, "Opacity"),
                h = r.getChannels().Opacity.getTexture(),
                r.getChannels().Opacity.setTransparency("alphaBlend"))
            }
            void 0 !== i.extra_bump_unit && (u = JSON.parse(i.extra_bump_unit),
            h = c[u],
            void 0 !== h && d(u, h, "BumpMap"),
            i.extra_bump_amount && (n = JSON.parse(i.extra_bump_amount),
            r.setChannelFactor("BumpMap", n))),
            void 0 !== i.extra_normal_unit && (u = JSON.parse(i.extra_normal_unit),
            h = c[u],
            void 0 !== h && d(u, h, "NormalMap"),
            i.extra_normal_amount && (n = JSON.parse(i.extra_normal_amount),
            r.setChannelFactor("NormalMap", n))),
            e.removeAttribute("Material"),
            r.setStateSet(e)
        }
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(357)
      , a = n.a.osg
      , s = function() {
        r.a.apply(this, arguments)
    };
    s.prototype = a.objectInherit(r.a.prototype, {
        processMaterial: function(t, e) {
            return this.processDefaultMaterial(t, e)
        },
        processDefaultMaterial: function(t, e) {
            var i = this.createMaterial(t, e)
              , n = e.getAttribute("Material");
            return void 0 !== n && (i.setChannelColor("EmitColor", n.getAmbient()),
            i.setChannelColor("DiffuseColor", n.getDiffuse()),
            i.setChannelColor("SpecularColor", n.getSpecular()),
            i.setChannelFactor("SpecularHardness", n.getShininess()),
            i.setChannelFactor("Opacity", n.getDiffuse()[3]),
            i.setChannelEnable("EmitColor", !0),
            i.setChannelEnable("DiffuseColor", !0),
            i.setChannelEnable("SpecularColor", !0),
            i.setChannelEnable("SpecularHardness", !0),
            i.setChannelEnable("Opacity", !0),
            e.removeAttribute("Material")),
            this.mapTexturesOnMaterial(e, i),
            i.setStateSet(e),
            i
        }
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(357)
      , s = i(384)
      , o = r.a.osg
      , l = function() {
        a.a.apply(this, arguments)
    };
    l.prototype = o.objectInherit(a.a.prototype, {
        setChannelsFromMetaData: function(t, e, r, a) {
            i.i(n.each)(a, function(i, n) {
                if (void 0 !== t[n]) {
                    var a = JSON.parse(t[n]);
                    e[r](i, a),
                    e.setChannelEnable(i, !0)
                }
            })
        },
        setMaterialChannelTexture: function(t, e, i, n, r) {
            t.removeTextureAttribute(i, "Texture");
            var a = e.getChannels()[r];
            a.setTexture(this.createTextureModelFromTextureOSG(n)),
            a.resetTextureFormat(),
            a.setTexCoordUnit(i),
            a.setFactor(1),
            a.setEnable(!0)
        },
        getReferencedTextures: function(t) {
            for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                var n = t.getTextureAttribute(i, "Texture");
                void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                e[i] = n)
            }
            return e
        },
        processLightSource: function(t) {
            var e = t.getLight();
            if (e) {
                var i = e.getUserData();
                if (void 0 !== i && e.typeID !== s.a.typeID) {
                    var n = this.convertUserDataToObject(i)
                      , r = new s.a;
                    if ("directional" === n.Type)
                        r.setLightType("DIRECTION");
                    else if ("point" === n.Type)
                        r.setLightType("POINT");
                    else {
                        if ("spot" !== n.Type)
                            return;
                        r.setLightType("SPOT")
                    }
                    if ("spot" === n.Type) {
                        r.setSpotCutoff(JSON.parse(n.OuterAngle) / 2);
                        var a = JSON.parse(n.InnerAngle) / JSON.parse(n.OuterAngle);
                        r.setSpotBlend(a !== a || Math.abs(a) === 1 / 0 ? .5 : Math.min(a, 1))
                    }
                    o.vec3.scale(r.getDiffuse(), JSON.parse(n.Color), JSON.parse(n.Intensity) / 100);
                    var l = 1 / JSON.parse(n.DecayStart);
                    r.setQuadraticAttenuation(Math.abs(l) === 1 / 0 ? 0 : l),
                    this.pushLight(r)
                }
            }
        },
        processMaterial: function(t, e, r) {
            var a = this.createMaterial(t, e)
              , s = {
                LambertDiffuseColor: "DiffuseColor",
                LambertEmissiveColor: "EmitColor",
                PhongSpecularColor: "SpecularColor"
            }
              , l = {
                sDiffuse: "DiffuseColor",
                sNormalMap: "NormalMap",
                sBump: "BumpMap",
                sEmissive: "EmitColor",
                sSpecular: "SpecularColor",
                sOpacity: "Opacity",
                sAo: "AOPBR",
                sRoughness: "RoughnessPBR",
                sMetallic: "MetalnessPBR"
            }
              , u = {
                LambertDiffuseFactor: "DiffuseColor",
                LambertBumpFactor: "BumpMap",
                LambertEmissiveFactor: "EmitColor",
                PhongSpecularFactor: "SpecularColor",
                PhongShininess: "SpecularHardness"
            };
            this.setChannelsFromMetaData(r, a, "setChannelColor", s),
            this.setChannelsFromMetaData(r, a, "setChannelFactor", u),
            e.removeAttribute("Material");
            var h = this.getReferencedTextures(e);
            if (i.i(n.each)(l, function(t, i) {
                if (void 0 !== r[i]) {
                    var n = JSON.parse(r[i])
                      , s = h[n];
                    void 0 !== s && this.setMaterialChannelTexture(e, a, n, s, t)
                }
            }
            .bind(this)),
            r.LambertBumpFactor && !r.sBump && a.getChannels().BumpMap.setEnable(!1),
            "Tilt Brush" === this._authoringTool) {
                var c = a.getChannels()
                  , d = c.EmitColor;
                d.set("type", "multiplicative"),
                d.getTexture() || 0 === d.getColor()[0] && 0 === d.getColor()[1] && 0 === d.getColor()[2] && d.setColor(o.vec3.fromValues(1, 1, 1)),
                c.SpecularF0.setFactor(0),
                c.RoughnessPBR.setFactor(1);
                var p = r.BlendMode;
                "AlphaMask" === p ? (c.Opacity.setFactor(JSON.parse(r.LambertTransparencyFactor || 0)),
                c.Opacity.setTransparency("alphaMask")) : "AdditiveBlend" === p ? (c.Opacity.setFactor(1 - JSON.parse(r.LambertTransparencyFactor || 0)),
                c.Opacity.setTransparency("additive")) : c.Opacity.setEnable(!1)
            }
            a.setStateSet(e)
        }
    }),
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = r.a.osg
      , s = function() {
        a.NodeVisitor.call(this, a.NodeVisitor.TRAVERSE_ALL_CHILDREN)
    };
    s.prototype = a.objectInherit(a.NodeVisitor.prototype, {
        getSource: function() {
            return this._source
        },
        getAuthoringTool: function() {
            return this._authoringTool
        },
        extractSource: function(t) {
            var e = i.i(n.find)(t, function(t) {
                return "source" === t.Name
            });
            if (e)
                return e.Value
        },
        checkStateSet: function(t) {
            t && t.getUserData() && (this._source = this.extractSource(t.getUserData()))
        },
        checkNode: function(t) {
            var e = t.getUserData();
            if (!e && "LightSource" === t.className()) {
                var r = t.getLight();
                r && (e = r.getUserData())
            }
            var a = this;
            e && i.i(n.each)(e, function(t) {
                "source" === t.Name ? a._source = t.Value : "authoring_tool" === t.Name && (a._authoringTool = t.Value)
            })
        },
        apply: function(t) {
            this.checkNode(t),
            this._source || this.checkStateSet(t.getStateSet()),
            this._source || this.traverse(t)
        }
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(1)
      , a = (i.n(r),
    i(357))
      , s = n.a.osg
      , o = function() {
        a.a.apply(this, arguments)
    };
    o.prototype = s.objectInherit(a.a.prototype, {
        setChannelsFromMetaData: function(t, e, n, a) {
            i.i(r.each)(a, function(i, r) {
                if (void 0 !== t[r]) {
                    var a = JSON.parse(t[r]);
                    e[n](i, a),
                    e.setChannelEnable(i, !0),
                    "MetalnessPBR" === i && (this._hasMetal = !0),
                    "SpecularPBR" === i && void 0 === this._hasMetal ? (e.setChannelFactor(i, 1),
                    this._hasMetal = !1) : "EmitColor" === i ? e.setChannelFactor(i, 1) : "GlossinessPBR" === i && void 0 === this._globalEnforceRoughness ? this._globalEnforceRoughness = !1 : "RoughnessPBR" === i && (this._globalEnforceRoughness = !0)
                }
            }
            .bind(this))
        },
        setMaterialChannelTexture: function(t, e, i, n, r) {
            t.removeTextureAttribute(i, "Texture");
            var a = e.getChannels()[r]
              , s = this.createTextureModelFromTextureOSG(n);
            a.setTexture(s),
            a.resetTextureFormat(),
            a.setTexCoordUnit(i),
            a.setFactor(1),
            a.setEnable(!0),
            "AOPBR" === r && (a.set("occludeSpecular", !0),
            a = e.getChannels().CavityPBR,
            a.setTexture(this.createTextureModelFromTextureOSG(n)),
            a.resetTextureFormat(),
            a.setTexCoordUnit(i),
            a.setFactor(1),
            a.setEnable(!0))
        },
        getReferencedTextures: function(t) {
            for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                var n = t.getTextureAttribute(i, "Texture");
                void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                e[i] = n)
            }
            return e
        },
        processMaterial: function(t, e, n) {
            var a = this.createMaterial(t, e);
            e.removeAttribute("Material");
            var o = {
                DiffuseFactor: "DiffuseColor",
                SpecularPBRFactor: "SpecularPBR",
                EmissiveFactor: "EmitColor"
            }
              , l = {
                MetallicFactor: "MetalnessPBR",
                RoughnessFactor: "RoughnessPBR",
                GlossinessPBRFactor: "GlossinessPBR",
                AOFactor: "AOPBR",
                NormalFactor: "NormalMap"
            }
              , u = {
                sDiffuse: "DiffuseColor",
                sMetallic: "MetalnessPBR",
                sRoughness: "RoughnessPBR",
                sSpecularPBR: "SpecularPBR",
                sGlossinessPBR: "GlossinessPBR",
                sNormalMap: "NormalMap",
                sBump: "BumpMap",
                sEmissive: "EmitColor",
                sOpacity: "Opacity",
                sAO: "AOPBR"
            }
              , h = this.getReferencedTextures(e);
            this.setChannelsFromMetaData(n, a, "setChannelColor", o),
            i.i(r.each)(u, function(t, i) {
                if (void 0 !== n[i]) {
                    var r = JSON.parse(n[i])
                      , s = h[r];
                    void 0 !== s && this.setMaterialChannelTexture(e, a, r, s, t)
                }
            }
            .bind(this)),
            this.setChannelsFromMetaData(n, a, "setChannelFactor", l),
            void 0 !== n.EmissiveFactor && void 0 !== n.EmissiveFactor[0] && this.hasTextureChannel(a, "EmitColor") ? a.setChannelFactor("EmitColor", JSON.parse(n.EmissiveFactor)[0]) : a.setChannelFactor("EmitColor", 1);
            var c = a.getChannels().Opacity;
            if (this.hasTextureChannel(a, "DiffuseColor")) {
                var d = a.getChannels().DiffuseColor
                  , p = d.getTexture().getImage();
                if (void 0 !== p && !0 === p.get("alpha")) {
                    var f = d.getTexture().clone();
                    f.set("internalFormat", s.Texture.ALPHA),
                    f.updateTextureProxy(),
                    c.setTexture(f),
                    c.setTexCoordUnit(d.getTexCoordUnit())
                }
            }
            "BLEND" === n.alphaMode ? this.hasTextureChannel(a, "Opacity") || void 0 === n.DiffuseFactor || 4 !== JSON.parse(n.DiffuseFactor).length || c.setFactor(JSON.parse(n.DiffuseFactor)[3]) : "MASK" === n.alphaMode && (c.setTransparency("alphaMask"),
            c.setFactor(JSON.parse(n.alphaCutoff || 0))),
            a.getChannels().NormalMap.set("flipY", void 0 !== n.yUp && !1 === JSON.parse(n.yUp)),
            void 0 !== n.doubleSided && !1 !== JSON.parse(n.doubleSided) || a.set("cullFace", s.CullFace.BACK),
            this.copyDiffuse(a),
            a.setStateSet(e)
        }
    }),
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(357)
      , a = n.a.osg
      , s = function() {
        r.a.apply(this, arguments)
    };
    s.prototype = a.objectInherit(r.a.prototype, {
        processMaterial: function(t, e, i) {
            var n, r, s = this.createMaterial(t, e), o = function(t) {
                for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                    var n = t.getTextureAttribute(i, "Texture");
                    void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                    e[i] = n)
                }
                return e
            }(e), l = function(t, e, i, n) {
                t.removeTextureAttribute(e, "Texture");
                var r = s.getChannels()[n];
                r.setTexture(this.createTextureModelFromTextureOSG(i)),
                r.resetTextureFormat(),
                r.setTexCoordUnit(0),
                r.setEnable(!0)
            }
            .bind(this);
            void 0 !== i.diffuse && (n = JSON.parse(i.diffuse),
            void 0 !== (r = o[n]) && l(e, n, r, "DiffuseColor")),
            void 0 !== i.specular && (n = JSON.parse(i.specular),
            void 0 !== (r = o[n]) && l(e, n, r, "SpecularColor")),
            void 0 !== i.transparency && (n = JSON.parse(i.transparency),
            void 0 !== (r = o[n]) && (l(e, n, r, "Opacity"),
            e.setRenderingHint("TRANSPARENT_BIN"),
            e.setTextureAttributeAndModes(n, r),
            e.setAttributeAndModes(new a.BlendFunc("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")))),
            e.removeAttribute("Material"),
            s.setStateSet(e)
        }
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(357)
      , a = i(685)
      , s = i(384)
      , o = n.a.osg
      , l = function() {
        r.a.apply(this, arguments)
    };
    l.prototype = o.objectInherit(a.a.prototype, {
        isSelfIlluminationSurface: function(t) {
            if (!t.length)
                return !1;
            var e = t[0]
              , i = e.getImage().getURL().split("/").pop().split(".").shift();
            return !!(i.match("carrot_crop_(.*)") || i.match("crops_(.*)") || "fern" === i || "dead_shrub" === i || "flower_red" === i || "flower_yellow" === i || "lilypad" === i || "mushroom_brown" === i || "mushroom_red" === i || i.match("netherwart_(.*)") || i.match("potato_crop_(.*)") || i.match("sapling_(.*)") || "tall_grass" === i || "torch" === i || "torch_flame" === i)
        },
        getReferencedTextures: function(t) {
            for (var e = [], i = 0; i < t.getNumTextureAttributeLists(); i++) {
                var n = t.getTextureAttribute(i, "Texture");
                void 0 !== n && ("TextureMaterial" === n.className() && (n = n.getTexture()),
                e[i] = n)
            }
            return e
        },
        setMaterialChannelTexture: function(t, e, i, n, r, a, s) {
            t.removeTextureAttribute(i, "Texture");
            var l = e.getChannels()[r]
              , u = this.createTextureModelFromTextureOSG(n);
            u.set("wrapT", o.Texture[a]),
            u.set("wrapS", o.Texture[a]),
            s && (u.set("minFilter", o.Texture.NEAREST_MIPMAP_LINEAR),
            u.set("magFilter", o.Texture.NEAREST),
            u.updateTextureProxy()),
            l.setTexture(u),
            l.resetTextureFormat(),
            l.setTexCoordUnit(0),
            l.setEnable(!0)
        },
        processMaterial: function(t, e, i) {
            var n = this.createMaterial(t, e)
              , r = {
                kd: "DiffuseColor"
            }
              , a = {
                tr: "Opacity",
                d: "Opacity"
            };
            this.setChannelsFromMetaData(i, n, "setChannelColor", r),
            this.setChannelsFromMetaData(i, n, "setChannelFactor", a),
            void 0 !== i.ka && (n.setChannelFactor("EmitColor", .1),
            n.setChannelEnable("EmitColor", !0)),
            n.setChannelColor("SpecularColor", o.vec3.create()),
            n.setChannelEnable("SpecularColor", !0),
            n.setChannelFactor("SpecularHardness", 1),
            n.setChannelEnable("SpecularHardness", !0),
            this.verifyOpacity(n),
            e.removeAttribute("Material");
            var l, u, h = "mineways" === i.source, c = this.getReferencedTextures(e), d = this.isSelfIlluminationSurface(c), p = d ? "CLAMP_TO_EDGE" : "REPEAT";
            if (void 0 !== i.map_kd && (l = JSON.parse(i.map_kd),
            void 0 !== (u = c[l]) && this.setMaterialChannelTexture(e, n, l, u, "DiffuseColor", p, h)),
            d || (void 0 !== i.map_ke ? (l = JSON.parse(i.map_ke),
            void 0 !== (u = c[l]) && (this.setMaterialChannelTexture(e, n, l, u, "EmitColor", p, h),
            n.setChannelFactor("EmitColor", 1))) : void 0 !== i.map_ka ? (l = JSON.parse(i.map_ka),
            void 0 !== (u = c[l]) && this.setMaterialChannelTexture(e, n, l, u, "EmitColor", p, h)) : (l = JSON.parse(i.map_kd),
            void 0 !== (u = c[l]) && (this.setMaterialChannelTexture(e, n, l, u, "EmitColor", p, h),
            n.setChannelFactor("EmitColor", .1)))),
            d && (n.set("shadeless", !0),
            n.setChannelFactor("EmitColor", 0),
            n.setChannelEnable("EmitColor", !0)),
            void 0 !== i.map_d && (l = JSON.parse(i.map_d),
            void 0 !== (u = c[l]))) {
                this.setMaterialChannelTexture(e, n, l, u, "Opacity", p, h);
                var f = n.getChannels().Opacity;
                h ? (f.getTexture().set("internalFormat", o.Texture.ALPHA),
                -1 !== n.attributes.name.toLowerCase().indexOf("leaves") && (f.setTransparency("alphaMask"),
                n.setChannelFactor("Opacity", .2))) : (f.getTexture().set("internalFormat", o.Texture.LUMINANCE),
                f.setTransparency("alphaBlend")),
                n.set("cullFace", o.CullFace.BACK)
            }
            if (n.setChannelFactor("RoughnessPBR", 1),
            n.setChannelFactor("SpecularF0", 0),
            e.removeAttribute("Material"),
            n.setStateSet(e),
            !this._lights.length) {
                var g = new s.a;
                g.setLightType("DIRECTION"),
                o.vec3.set(g.getDiffuse(), 1, 1, 1),
                this._lights.push(g),
                g._worldMatrix = o.mat4.fromRotation(o.mat4.create(), Math.PI / 6, o.vec3.fromValues(1, 1, 0))
            }
        }
    }),
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = function(t) {
        r.NodeVisitor.call(this, r.NodeVisitor.TRAVERSE_ALL_CHILDREN),
        this.stateSetStack = [],
        this.countGeometryStack = {},
        this.removedStateSet = [],
        this.keepedStateSet = [],
        this.deep = 0,
        this.materialRootList = t || {}
    };
    a.prototype = r.objectInherit(r.NodeVisitor.prototype, {
        getCurrentStateSet: function() {
            return this.stateSetStack[this.stateSetStack.length - 1]
        },
        getCurrentGeometryCount: function() {
            return void 0 === this.countGeometryStack[this.getCurrentStateSet().getInstanceID()] && (this.countGeometryStack[this.getCurrentStateSet().getInstanceID()] = 0),
            this.countGeometryStack[this.getCurrentStateSet().getInstanceID()]
        },
        setCurrentGeometryCount: function(t) {
            this.countGeometryStack[this.getCurrentStateSet().getInstanceID()] = t
        },
        updateStateSetGeometryCount: function(t) {
            var e = this.getCurrentGeometryCount();
            e += t,
            this.setCurrentGeometryCount(e)
        },
        logTree: function(t, e) {
            for (var i = ""; t--; )
                i += "    ";
            r.debug(i + e)
        },
        apply: function(t) {
            var e = t.getStateSet();
            if (e && (this.stateSetStack.push(e),
            this.deep++,
            this.logTree(this.deep, e._uniqueID + " >>>")),
            this.traverse(t),
            t instanceof r.Geometry && (this.updateStateSetGeometryCount(1),
            this.logTree(this.deep, " Geom")),
            e) {
                if (this.logTree(this.deep, e._uniqueID + " <<< geom children num " + this.getCurrentGeometryCount()),
                0 === this.getCurrentGeometryCount())
                    this.removedStateSet.push(e._uniqueID);
                else {
                    var i = !0
                      , n = e._uniqueID
                      , a = this.stateSetStack.length;
                    if (a-- > 1)
                        for (; a-- > 0; ) {
                            var s = this.stateSetStack[a]
                              , o = this.materialRootList[s._uniqueID];
                            if (o && o.rootMaterialToKeep)
                                if (2 === this.materialRootList.size) {
                                    var l = this.materialRootList[n];
                                    if (l)
                                        for (var u in o.attributes.channels)
                                            o.attributes.channels[u].attributes.texture && (l.attributes.channels[u].attributes.texture = o.attributes.channels[u].attributes.texture)
                                } else
                                    o.rootMaterialDidOverride = !0,
                                    e._uniqueID = o.attributes.stateSetID,
                                    i = !1,
                                    this.keepedStateSet.push(o.attributes.stateSetID)
                        }
                    i ? this.keepedStateSet.push(n) : this.removedStateSet.push(n)
                }
                this.stateSetStack.pop(),
                this.deep--
            }
        }
    }),
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = function() {
        r.NodeVisitor.call(this, r.NodeVisitor.TRAVERSE_ALL_CHILDREN),
        this._paths = [],
        this._pathsStateSet = [],
        this._currentStateSet = [],
        this._stateSetMap = {},
        this._stateSetMapNodes = {},
        this._wireframePaths = [],
        this._noGeometryPaths = [],
        this.nodeMaskOverride = -1
    };
    a.prototype = r.objectInherit(r.NodeVisitor.prototype, {
        getPathList: function() {
            return this._paths
        },
        getStateSetMap: function() {
            return this._stateSetMap
        },
        getStateSetMapNodes: function() {
            return this._stateSetMapNodes
        },
        getStateSetPathList: function() {
            return this._pathsStateSet
        },
        getWireframePathList: function() {
            return this._wireframePaths
        },
        getNoGeometryPathList: function() {
            return this._noGeometryPaths
        },
        apply: function(t) {
            var e = t.getStateSet();
            if (e) {
                var i = e._uniqueID;
                this._stateSetMap[i] ? this._stateSetMapNodes[i].push(t) : (this._stateSetMap[i] = e,
                this._stateSetMapNodes[i] = []),
                this._currentStateSet.push(e)
            }
            t instanceof r.Geometry ? t.userDataMap && t.userDataMap.wireframe ? this._wireframePaths.push(this.nodePath.slice(0)) : (this._pathsStateSet.push(this._currentStateSet.slice(0)),
            this._paths.push(this.nodePath.slice(0))) : (this.traverse(t),
            0 === t.getChildren().length && this._noGeometryPaths.push(this.nodePath.slice(0))),
            e && this._currentStateSet.pop()
        }
    }),
    e.a = a
}
, , function(t, e, i) {
    "use strict";
    var n = i(18)
      , r = i.n(n)
      , a = i(4)
      , s = i(292)
      , o = a.a.osg
      , l = r.a.Model.extend({
        defaults: {
            matrix: o.mat4.create(),
            showGizmo: !1
        },
        getName: function() {
            return "Orientation"
        },
        init: function(t) {
            var e = t.getModel().get("options").orientation.matrix;
            e && this.set("matrix", e)
        },
        getJSON: function() {
            return {
                matrix: this.get("matrix")
            }
        },
        editorGetJSON: function() {
            return this.getJSON()
        },
        validateJSON: function(t) {
            return s.a.isArrayNumber(t.matrix, 16) ? "" : "Orientation.editorSetJSON matrix must be a mat4"
        },
        editorSetJSON: function(t) {
            var e = this.validateJSON(t);
            return e || (this.set("matrix", t.matrix),
            e)
        }
    });
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(687)
      , a = i(138)
      , s = i(801)
      , o = i.n(s)
      , l = i(800)
      , u = i.n(l)
      , h = i(799)
      , c = i.n(h)
      , d = i(798)
      , p = i.n(d)
      , f = i(70)
      , g = i(87)
      , m = n.a.osg
      , v = function(t) {
        m.MatrixTransform.call(this),
        this._colorUniform = m.Uniform.createFloat4(m.vec4.fromValues(.5, .5, .5, 0), "uColor"),
        t && m.vec4.copy(this._colorUniform.get(), t),
        this._callbackColor = new r.a(this._colorUniform,1),
        this._timeGrid = 0,
        this.init()
    };
    v.prototype = m.objectInherit(m.MatrixTransform.prototype, {
        init: function() {
            this._visible = !1,
            this.addChild(m.createGridGeometry(-1, -1, 0, 2, 0, 0, 0, 2, 0, 10, 10)),
            this.addChild(m.createAxisGeometry(1)),
            this._boundingSphereComputed = !0,
            this._boundingBoxComputed = !0;
            var t = this.getOrCreateStateSet();
            t.setAttributeAndModes(new m.Depth(m.Depth.LEQUAL)),
            t.setAttributeAndModes(new m.BlendFunc(m.BlendFunc.ONE,m.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            t.setRenderBinDetails(g.a.GRID, "RenderBin"),
            t.addUniform(this._colorUniform),
            t.setAttributeAndModes(a.a.createShader(o.a, u.a, "orientation-grid", "Grid")),
            this.getChildren()[1].getOrCreateStateSet().setAttributeAndModes(a.a.createShader(c.a, p.a, "orientation-axis", "OrientationAxis")),
            this.addUpdateCallback(this._callbackColor),
            this.setNodeMask(0)
        },
        showGridTemporary: function(t) {
            this._visible = !0,
            this.setNodeMask(f.a.NO_PICK_NO_SHADOW),
            this._callbackColor.show(),
            window.clearTimeout(this._timeGrid),
            t && (this._timeGrid = window.setTimeout(this.hideGrid.bind(this), 1e3 * t))
        },
        isVisible: function() {
            return this._visible
        },
        hideGrid: function() {
            this._timeGrid = 0,
            this._visible = !1,
            this._callbackColor.hide()
        }
    }),
    e.a = v
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(989)
      , a = i(993)
      , s = {
        FeatureName: "orientation",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getNode = function() {
        return this._views[0].getNodeOrientation()
    }
    ,
    o.prototype.getWidgetNode = function() {
        return this._views[0].getNodeGrid()
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(470)
      , a = i(51)
      , s = n.a.osg
      , o = function(t, e, i, n) {
        this._model = i.model,
        this._manipulator = t,
        this._applyWithoutTranslation = !1,
        this._quatCurrent = s.mat4.getRotation(s.quat.create(), this._model.get("matrix")),
        this._quatTarget = s.quat.create(),
        this._quatStart = s.quat.create(),
        this._nodeGrid = i._nodeGrid,
        r.a.call(this, e),
        this._finished = !0,
        this._nodeGizmo = i._nodeGizmo,
        this._gizmoTra = i._gizmoTra,
        this._gizmoMode = !1,
        this._rootModel = n,
        this._features = i.options.context.getFeatures()
    };
    o.prototype = s.objectInherit(r.a.prototype, {
        setQuatTarget: function(t) {
            s.quat.copy(this._quatStart, this._quatCurrent),
            s.quat.copy(this._quatTarget, t),
            this.reset(),
            this._gizmoMode = !1
        },
        setGizmoMode: function(t) {
            this._gizmoMode = t
        },
        getQuatTarget: function() {
            return this._quatTarget
        },
        getQuatStart: function() {
            return this._quatStart
        },
        update: function(t, e) {
            if (this._gizmoMode)
                return s.mat4.getRotation(this._quatCurrent, this._nodeGizmo.getMatrix()),
                this.rotateNode(t),
                !0;
            if (this._finished)
                return !0;
            a.a.draw();
            var i = e.getFrameStamp().getSimulationTime()
              , n = this.interpolate(i, t, e);
            return n = s.smoothStep(0, 1, n),
            s.quat.slerp(this._quatCurrent, this._quatStart, this._quatTarget, n),
            this.rotateNode(t),
            this._finished && (s.mat4.fromQuat(this._nodeGizmo.getMatrix(), this._quatCurrent),
            this._gizmoMode = this._model.get("showGizmo")),
            !0
        },
        rotateNode: function() {
            var t = s.mat4.create()
              , e = s.vec3.create();
            return function(i) {
                var n = i.getMatrix();
                s.mat4.fromQuat(n, this._quatCurrent);
                var r = this._gizmoTra.getMatrix()
                  , a = this._rootModel.getMinimumBound()
                  , o = a.center();
                if (s.vec3.negate(o, o),
                s.mat4.fromTranslation(r, o),
                s.mat4.multiply(n, n, r),
                s.vec3.negate(o, o),
                s.mat4.fromTranslation(r, o),
                s.mat4.multiply(n, r, n),
                this._nodeGrid) {
                    s.mat4.invert(t, n);
                    var l = this._nodeGrid.getMatrix()
                      , u = s.mat4.create()
                      , h = a.radius();
                    s.mat4.fromScaling(u, s.vec3.set(e, h, h, h)),
                    s.mat4.fromTranslation(l, o),
                    s.mat4.multiply(l, l, u),
                    s.mat4.multiply(l, t, l)
                }
                this.updateShadows(),
                i.dirtyBound()
            }
        }(),
        updateShadows: function() {
            var t = this._features.lighting;
            if (t)
                for (var e = t.getModel().get("lights"), i = 0, n = e.length; i < n; ++i)
                    e[i].dirty()
        }
    }),
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(6)
      , a = i(992)
      , s = i(990)
      , o = n.a.osg
      , l = n.a.osgUtil
      , u = r.a.extend({
        initialize: function() {
            r.a.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:matrix", this.onMatrixChanged, this),
            t.bind("change:showGizmo", this.onGizmoShowChanged, this),
            t.bind("turn", this.onTurn, this),
            t.bind("reset", this.onReset, this);
            var e = this.options.context;
            this._viewer = e.getViewer();
            var i = this._viewer.getViewerOSGJS().getManipulator();
            this._nodeGrid = new s.a,
            this._nodeGrid.setName("Node grid"),
            this._nodeOrientation = new o.MatrixTransform,
            this._nodeOrientation.setName("Feature - Orientation"),
            this._nodeOrientation.addChild(this._nodeGrid),
            this._nodeGizmo = new o.MatrixTransform,
            this._nodeGizmo.setCullingActive(!1),
            this._nodeGizmo.editMask = l.NodeGizmo.PICK_ARC,
            this._gizmoTra = new o.MatrixTransform,
            this._gizmoTra.setReferenceFrame(o.Transform.ABSOLUTE_RF),
            this._gizmoTra.addChild(this._nodeGizmo),
            this._callbackOrientation = new a.a(i,.5,this,e.getScene().getRoot()),
            this._nodeOrientation.addUpdateCallback(this._callbackOrientation),
            this._callbackOrientation.rotateNode(this._nodeOrientation);
            var n = this.model.get("matrix");
            this._nodeOrientation.setMatrix(n),
            o.mat4.fromQuat(this._nodeGizmo.getMatrix(), o.mat4.getRotation(o.quat.create(), n))
        },
        onReset: function() {
            var t = o.mat4.getTranslation(o.vec3.create(), this.model.get("matrix"));
            o.mat4.fromTranslation(this.model.get("matrix"), t),
            this.onMatrixChanged()
        },
        onTurn: function(t, e) {
            var i = "right" === e ? 1 : -1
              , n = "x" === t ? i : 0
              , r = "y" === t ? i : 0
              , a = "z" === t ? i : 0
              , s = o.mat4.fromRotation(o.mat4.create(), -Math.PI / 2, o.vec3.fromValues(n, r, a))
              , l = this.model.get("matrix");
            o.mat4.multiply(l, s, l),
            this.onMatrixChanged()
        },
        onGizmoShowChanged: function() {
            var t = this.model.get("showGizmo")
              , e = this._viewer.getFeaturesManager();
            if (e) {
                var i = e.getNodeGizmo();
                i && (o.mat4.fromQuat(this._nodeGizmo.getMatrix(), o.mat4.getRotation(o.quat.create(), this.model.get("matrix"))),
                i.setForcePicking(t),
                i.setRotateInLocal(!t),
                i.setTranslateInLocal(!t),
                i.attachToMatrixTransform(t ? this._nodeGizmo : null),
                this._nodeGrid.showGridTemporary(t ? 0 : 5),
                this._callbackOrientation.setGizmoMode(t))
            }
        },
        onMatrixChanged: function() {
            this.model.get("showGizmo") || this._nodeGrid.showGridTemporary(5),
            this._callbackOrientation.setQuatTarget(o.mat4.getRotation(o.quat.create(), this.model.get("matrix")))
        },
        getNodeGrid: function() {
            return this._nodeGrid
        },
        getNodeOrientation: function() {
            return this._nodeOrientation
        }
    });
    e.a = u
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(18)
      , a = i.n(r)
      , s = n.a.osg
      , o = a.a.Model.extend({
        defaults: {
            color: s.vec3.fromValues(1, 0, 1)
        },
        getName: function() {
            return "Outline"
        }
    });
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(70)
      , a = i(87)
      , s = i(471)
      , o = i(51)
      , l = n.a.osg
      , u = n.a.osgUtil
      , h = function(t, e) {
        l.Node.call(this),
        this._viewer = t,
        this._color = void 0 !== e ? e : l.vec3.fromValues(1, 0, 1),
        this._timeoutDuration = 1e4,
        this._nodeProxy = new l.Node,
        this._outlineScene = new l.Node,
        this._timer = void 0,
        this._sobel = void 0,
        this._paths = void 0,
        this._width = t.getCanvasWidth(),
        this._height = t.getCanvasHeight(),
        this.init()
    };
    h.prototype = l.objectInherit(l.Node.prototype, {
        setColor: function(t) {
            this._color = t
        },
        clearOutlineScene: function() {
            for (var t = this._outlineScene, e = t.getChildren(), i = 0, n = e.length; i < n; ++i)
                e[i].removeChildren();
            t.removeChildren()
        },
        setScene: function() {
            var t = function(t) {
                this._path = t
            };
            return t.prototype = {
                update: function(t) {
                    return t.setMatrix(l.computeLocalToWorld(this._path)),
                    !0
                }
            },
            function(e) {
                this.clearOutlineScene();
                for (var n = this._outlineScene, r = 0, a = e.length; r < a; ++r) {
                    var o = e[r]
                      , u = new l.MatrixTransform;
                    n.addChild(u),
                    u.addChild(o[o.length - 1]),
                    i.i(s.a)(o) ? u.addUpdateCallback(new t(o)) : u.setMatrix(l.computeLocalToWorld(o))
                }
            }
        }(),
        hideOutline: function() {
            this._nodeProxy.setNodeMask(0),
            void 0 !== this._timer && (clearTimeout(this._timer),
            this._timer = void 0)
        },
        showOutline: function() {
            this._nodeProxy.setNodeMask(r.a.NO_PICK_NO_SHADOW),
            void 0 !== this._timer && clearTimeout(this._timer);
            var t = this;
            this._timer = setTimeout(function() {
                t._timer = void 0,
                t._nodeProxy.setNodeMask(0),
                o.a.draw()
            }, this._timeoutDuration)
        },
        getOrCreateTextureRTT: function() {
            var t = this._viewer
              , e = t.getCanvasWidth()
              , i = t.getCanvasHeight();
            if (this.textureRTT)
                return this.textureRTT.setTextureSize(e, i),
                this.textureRTT;
            var n = this.textureRTT = new l.Texture;
            return n.setTextureSize(e, i),
            n.setInternalFormat(l.Texture.RGBA),
            n.setMinFilter(l.Texture.NEAREST),
            n.setMagFilter(l.Texture.NEAREST),
            n
        },
        createCamera: function(t) {
            var e = this.createSubGraphRTT(t);
            return e.getOrCreateStateSet().setShaderGeneratorName("outline", l.StateAttribute.OVERRIDE | l.StateAttribute.ON),
            e.setName("Outline Camera"),
            e
        },
        createSubGraphRTT: function(t) {
            var e = this.getOrCreateTextureRTT()
              , i = new l.Camera;
            return i.setViewport(new l.Viewport(0,0,e.getWidth(),e.getHeight())),
            i.setClearColor(l.vec4.create()),
            i.setRenderOrder(l.Camera.PRE_RENDER, 0),
            i.attachTexture(l.FrameBufferObject.COLOR_ATTACHMENT0, e),
            i.attachRenderBuffer(l.FrameBufferObject.DEPTH_ATTACHMENT, l.FrameBufferObject.DEPTH_COMPONENT16),
            i.addChild(t),
            i
        },
        createComposer: function(t) {
            var e = new u.Composer;
            return e.addPass(new u.Composer.Filter.InputTexture(this.getOrCreateTextureRTT())),
            e.addPass(t),
            e.renderToScreen(this._viewer.getCanvasWidth(), this._viewer.getCanvasHeight()),
            e.build(),
            e
        },
        createRttAndComposer: function(t) {
            var e = this.createCamera(this._outlineScene);
            this._nodeProxy.addChild(e),
            this._nodeProxy.addChild(this.createComposer(t))
        },
        init: function() {
            this.addChild(this._nodeProxy),
            this._nodeProxy.setNodeMask(0);
            var t = new l.CullFace(l.CullFace.DISABLE);
            this._outlineScene.getOrCreateStateSet().setAttributeAndModes(t, l.StateAttribute.OVERRIDE | l.StateAttribute.ON);
            var e = this._sobel = new u.Composer.Filter.SobelFilter;
            e.setColor(this._color),
            e.setFactor(.25),
            e.getOrCreateStateSet().setAttributeAndModes(new l.BlendFunc(l.BlendFunc.ONE,l.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            e.getOrCreateStateSet().setRenderBinDetails(a.a.OUTLINE, "RenderBin"),
            this.createRttAndComposer(e),
            this._nodeProxy.addUpdateCallback(this)
        },
        update: function(t) {
            var e = this._viewer;
            if (e.getCanvasWidth() === this._width && e.getCanvasHeight() === this._height)
                return !0;
            this._width = e.getCanvasWidth(),
            this._height = e.getCanvasHeight();
            var i = t.getChildren()
              , n = i[0]
              , r = this.getOrCreateTextureRTT();
            return n.setViewport(new l.Viewport(0,0,r.getWidth(),r.getHeight())),
            n.attachTexture(l.FrameBufferObject.COLOR_ATTACHMENT0, r),
            t.removeChild(i[1]),
            t.addChild(this.createComposer(this._sobel)),
            !0
        }
    }),
    e.a = h
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(994)
      , a = i(997)
      , s = {
        FeatureName: "outline",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getNode = function() {
        return this._views[0].getNodeOutline()
    }
    ,
    o.prototype.prepareForScreenShot = function() {
        return this.getNode().hideOutline(),
        !1
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(6)
      , r = i(995)
      , a = i(1041)
      , s = n.a.extend({
        initialize: function() {
            n.a.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:color", this.onColorChanged, this);
            var e = this.options.context.getViewer().getViewerOSGJS();
            e.getState().getShaderGeneratorProxy().addShaderGenerator("outline", new a.a),
            this._nodeOutline = new r.a(e,t.get("color")),
            this._nodeOutline.setName("Feature - Outline")
        },
        onColorChanged: function() {
            this._nodeOutline.setColor(this.model.get("color"))
        },
        getNodeOutline: function() {
            return this._nodeOutline
        }
    });
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = n.a.osgShader
      , s = a.node.NodeFunctions
      , o = a.utils
      , l = function() {
        s.apply(this)
    };
    l.prototype = r.objectInherit(s.prototype, {
        globalFunctionDeclaration: function() {
            return '#pragma include "sketchfabFunctions.glsl"'
        }
    });
    var u = a.node.LinearTosRGB
      , h = function() {
        u.apply(this)
    };
    h.prototype = r.objectInherit(u.prototype, {
        type: "LinearTosRGBWithTest",
        validInputs: ["color", "keepLinear"],
        validOutputs: ["color"],
        computeShader: function() {
            var t = this._outputs.color
              , e = this._inputs.color
              , i = this._inputs.keepLinear
              , n = t.getType() !== e.getType() ? ".rgb" : "";
            return ["if(" + i.getVariable() + " == 1 ) {", t.getVariable() + n + "= " + e.getVariable() + n + ";", "} else {", u.prototype.computeShader.call(this) + "}"].join("\n")
        }
    });
    var c = function() {
        l.apply(this)
    };
    c.prototype = r.objectInherit(l.prototype, {
        type: "NormalTangentSpace",
        validInputs: ["tangent", "normal", "texNormal"],
        validOutputs: ["normal"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("mtexNspaceTangent", this._outputs.normal, [t.tangent, t.normal, t.texNormal])
        }
    });
    var d = function() {
        l.apply(this)
    };
    d.prototype = r.objectInherit(l.prototype, {
        type: "Bumpmap",
        validInputs: ["tangent", "normal", "gradient"],
        validOutputs: ["normal"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("bumpMap", this._outputs.normal, [t.tangent, t.normal, t.gradient])
        }
    });
    var p = function() {
        l.apply(this)
    };
    p.prototype = r.objectInherit(l.prototype, {
        type: "NormalMatcap",
        validInputs: ["normal", "eye"],
        validOutputs: ["uv"],
        computeShader: function() {
            return o.callFunction("normalMatcap", this._outputs.uv, [this._inputs.normal, this._inputs.eye])
        }
    });
    var f = function() {
        l.apply(this)
    };
    f.prototype = r.objectInherit(l.prototype, {
        type: "RGBToNormal",
        validInputs: ["normal", "flipY"],
        validOutputs: ["normal"],
        computeShader: function() {
            return o.callFunction("rgbToNormal", this._outputs.normal, [this._inputs.normal, this._inputs.flipY])
        }
    });
    var g = function() {
        l.apply(this)
    };
    g.prototype = r.objectInherit(l.prototype, {
        type: "AdjustSpecular",
        validInputs: ["specular", "normal"],
        validOutputs: ["specular"],
        computeShader: function() {
            return o.callFunction("adjustSpecular", this._outputs.specular, [this._inputs.specular, this._inputs.normal.getVariable() + ".rgb"])
        }
    }),
    e.a = {
        LinearTosRGBWithTest: h,
        NormalTangentSpace: c,
        Bumpmap: d,
        NormalMatcap: p,
        AdjustSpecular: g,
        RGBToNormal: f
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = n.a.osgShader
      , s = a.node.NodeFunctions
      , o = a.node.SunLight
      , l = a.utils
      , u = function(t) {
        return "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    }
      , h = function() {
        o.apply(this)
    };
    h.prototype = r.objectInherit(o.prototype, {
        type: "EnvLight",
        globalFunctionDeclaration: function() {
            return '#pragma include "lightEnv.glsl"'
        },
        computeShader: function() {
            return l.callFunction("computeEnvLightShading", this._outputs.color, [this._inputs.normal, u(this._inputs.materialdiffuse), u(this._inputs.lightdiffuse), this._inputs.lightposition, this._inputs.lightmatrix, this._inputs.lightEyeDir, this._inputs.lighted])
        }
    });
    var c = function() {
        s.apply(this)
    };
    c.prototype = r.objectInherit(s.prototype, {
        type: "EnvLightPBR",
        validOutputs: ["color"],
        validInputs: ["normal", "materialalbedopbr", "lightdiffuse", "lightposition", "lightmatrix", "lighted", "lightEyeDir"],
        globalFunctionDeclaration: function() {
            return '#pragma include "lightPBREnv.glsl"'
        },
        computeShader: function() {
            return l.callFunction("computeEnvLightShading", this._outputs.color, [this._inputs.normal, this._inputs.materialalbedopbr, this._inputs.lightdiffuse, this._inputs.lightposition, this._inputs.lightmatrix, this._inputs.lightEyeDir, this._inputs.lighted])
        }
    }),
    e.a = {
        EnvLight: h,
        EnvLightPBR: c
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = n.a.osgShader
      , s = a.node.NodeFunctions
      , o = a.utils
      , l = function() {
        s.apply(this)
    };
    l.prototype = r.objectInherit(s.prototype, {
        validOutputs: ["color"],
        globalFunctionDeclaration: function() {
            return '#pragma include "lightsPBR.glsl"'
        }
    });
    var u = function(t) {
        return "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    }
      , h = function() {
        l.apply(this)
    };
    h.prototype = r.objectInherit(l.prototype, {
        type: "PointLightPBR",
        validInputs: ["normal", "eyeVector", "materialalbedopbr", "prepSpec", "materialspecularpbr", "lightdiffuse", "lightposition", "lightattenuation", "lightmatrix", "lighted", "lightEyePos", "lightEyeDir"],
        computeShader: function() {
            return o.callFunction("computePointLightPBRShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, this._inputs.materialalbedopbr, this._inputs.prepSpec, this._inputs.materialspecularpbr, u(this._inputs.lightdiffuse), this._inputs.lightposition, this._inputs.lightattenuation, this._inputs.lightmatrix, this._inputs.lightEyePos, this._inputs.lightEyeDir, this._inputs.lighted])
        }
    });
    var c = function() {
        l.apply(this)
    };
    c.prototype = r.objectInherit(l.prototype, {
        type: "SpotLightPBR",
        validInputs: ["normal", "eyeVector", "materialalbedopbr", "prepSpec", "materialspecularpbr", "lightdiffuse", "lightdirection", "lightattenuation", "lightposition", "lightspotCutOff", "lightspotBlend", "lightmatrix", "lightinvMatrix", "lighted", "lightEyePos", "lightEyeDir"],
        computeShader: function() {
            return o.callFunction("computeSpotLightPBRShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, this._inputs.materialalbedopbr, this._inputs.prepSpec, this._inputs.materialspecularpbr, u(this._inputs.lightdiffuse), this._inputs.lightdirection, this._inputs.lightattenuation, this._inputs.lightposition, this._inputs.lightspotCutOff, this._inputs.lightspotBlend, this._inputs.lightmatrix, this._inputs.lightinvMatrix, this._inputs.lightEyePos, this._inputs.lightEyeDir, this._inputs.lighted])
        }
    });
    var d = function() {
        l.apply(this)
    };
    d.prototype = r.objectInherit(l.prototype, {
        type: "SunLightPBR",
        validInputs: ["normal", "eyeVector", "materialalbedopbr", "prepSpec", "materialspecularpbr", "lightdiffuse", "lightposition", "lightmatrix", "lighted", "lightEyeDir"],
        computeShader: function() {
            return o.callFunction("computeSunLightPBRShading", this._outputs.color, [this._inputs.normal, this._inputs.eyeVector, this._inputs.materialalbedopbr, this._inputs.prepSpec, this._inputs.materialspecularpbr, u(this._inputs.lightdiffuse), this._inputs.lightposition, this._inputs.lightmatrix, this._inputs.lightEyeDir, this._inputs.lighted])
        }
    });
    var p = function() {
        l.apply(this)
    };
    p.prototype = r.objectInherit(l.prototype, {
        type: "ComputeLight",
        validInputs: ["normal", "lightColor", "albedoColor", "prepSpec", "viewDir", "lightDir", "specular", "dotNL"],
        computeShader: function() {
            return o.callFunction("computeLight", this._outputs.color, [this._inputs.lightColor, this._inputs.albedoColor, this._inputs.normal, this._inputs.viewDir, this._inputs.lightDir, this._inputs.specular, this._inputs.prepSpec, this._inputs.dotNL])
        }
    });
    var f = function() {
        s.apply(this)
    };
    f.prototype = r.objectInherit(s.prototype, {
        type: "prepSpecLightPBR",
        validInputs: ["normal", "eyeVector", "materialroughnesspbr"],
        validOutputs: ["prepSpec"],
        globalFunctionDeclaration: function() {
            return '#pragma include "lightsPBR.glsl"'
        },
        computeShader: function() {
            return o.callFunction("LightingFuncPrep", this._outputs.prepSpec, [this._inputs.normal, this._inputs.eyeVector, this._inputs.materialroughnesspbr])
        }
    }),
    e.a = {
        PrepSpecLightPBR: f,
        PointLightPBR: h,
        SpotLightPBR: c,
        SunLightPBR: d,
        ComputeLight: p
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = n.a.osgShader
      , s = a.node.BaseOperator
      , o = function() {
        s.apply(this),
        this._mode = "MIX"
    };
    o.prototype = r.objectInherit(s.prototype, {
        type: "Blend",
        mode: function(t) {
            return this._mode = t,
            this
        },
        computeShader: function() {
            return this[void 0 === this._mode ? "MIX" : this._mode]()
        },
        ADD: function() {
            return this._outputs.getVariable() + " = " + this._inputs[0].getVariable() + " + (" + this._inputs[1].getVariable() + " * " + this._inputs[2].getVariable() + ");"
        },
        MIX: function() {
            return this._outputs.getVariable() + " = mix(" + this._inputs[0].getVariable() + ", " + this._inputs[1].getVariable() + ", " + this._inputs[2].getVariable() + ");"
        },
        MULTIPLY: function() {
            return this._outputs.getVariable() + " = " + this._inputs[0].getVariable() + " * mix( " + this._inputs[0].getType() + "(1.0), " + this._inputs[1].getVariable() + ", " + this._inputs[2].getVariable() + ");"
        }
    }),
    e.a = {
        Blend: o
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = n.a.osgShader
      , s = a.node.NodeFunctions
      , o = a.utils
      , l = function() {
        s.apply(this)
    };
    l.prototype = r.objectInherit(s.prototype, {
        type: "DiffuseUE4v1",
        validInputs: ["normal", "albedo", "envTransform", "sphCoef"],
        validOutputs: ["color"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("computeIBLDiffuseUE4", this._outputs.color, [t.normal, t.albedo, t.envTransform, t.sphCoef])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    });
    var u = function() {
        s.apply(this)
    };
    u.prototype = r.objectInherit(s.prototype, {
        type: "SpecularUE4v1Panorama",
        validInputs: ["normal", "eye", "roughness", "specular", "envTransform", "texSpec", "lodRange", "texSize", "frontNormal"],
        validOutputs: ["color"],
        computeShader: function() {
            var t = this._inputs
              , e = [t.normal, t.eye, t.roughness, t.specular, t.envTransform, t.texSpec, t.lodRange, t.texSize, t.frontNormal];
            return t.integrateBRDF && e.push(t.integrateBRDF),
            o.callFunction("computeIBLSpecularUE4", this._outputs.color, e)
        },
        isMobileString: function() {
            return this._inputs.integrateBRDF ? "" : "#define MOBILE"
        },
        getDefines: function() {
            return [this.isMobileString(), "#define PANORAMA"]
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    });
    var h = function() {
        u.apply(this)
    };
    h.prototype = r.objectInherit(u.prototype, {
        type: "SpecularUE4v1Cubemap",
        getDefines: function() {
            return [this.isMobileString(), "#define CUBEMAP"]
        },
        getExtensions: function() {
            return ["#extension GL_EXT_shader_texture_lod : require"]
        }
    });
    var c = function() {
        s.apply(this)
    };
    c.prototype = r.objectInherit(s.prototype, {
        type: "EnvironmentTransformPBR",
        validInputs: ["inTransform"],
        validOutputs: ["outTransform"],
        computeShader: function() {
            return o.callFunction("environmentTransformPBR", this._outputs.outTransform, [this._inputs.inTransform])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    });
    var d = function() {
        s.apply(this)
    };
    d.prototype = r.objectInherit(s.prototype, {
        type: "AdjustRoughnessNmap",
        validInputs: ["roughness", "normal"],
        validOutputs: ["roughness"],
        computeShader: function() {
            return o.callFunction("adjustRoughnessNormalMap", this._outputs.roughness, [this._inputs.roughness, this._inputs.normal])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    });
    var p = function() {
        s.apply(this)
    };
    p.prototype = r.objectInherit(s.prototype, {
        type: "AdjustRoughnessGeometry",
        validInputs: ["roughness", "normal"],
        validOutputs: ["roughness"],
        computeShader: function() {
            return o.callFunction("adjustRoughnessGeometry", this._outputs.roughness, [this._inputs.roughness, this._inputs.normal])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    });
    var f = function() {
        s.apply(this)
    };
    f.prototype = r.objectInherit(s.prototype, {
        type: "SpecularOcclusion",
        validInputs: ["occlude", "ao", "normal", "eye"],
        validOutputs: ["ao"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("specularOcclusion", this._outputs.ao, [t.occlude, t.ao, t.normal, t.eye])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "pbrUE4.glsl"'
        }
    }),
    e.a = {
        DiffuseUE4v1: l,
        SpecularUE4v1Panorama: u,
        SpecularUE4v1Cubemap: h,
        EnvironmentTransformPBR: c,
        AdjustRoughnessNmap: d,
        AdjustRoughnessGeometry: p,
        SpecularOcclusion: f
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = n.a.osgShader
      , s = a.node.NodeTextures
      , o = a.utils
      , s = a.node.NodeTextures
      , o = a.utils
      , l = function() {
        s.apply(this)
    };
    l.prototype = r.objectInherit(s.prototype, {
        globalFunctionDeclaration: function() {
            return '#pragma include "sketchfabTextures.glsl"'
        }
    });
    var u = function() {
        l.apply(this),
        this._isSRGB = !1,
        this._packingRead = "r"
    };
    u.prototype = r.objectInherit(l.prototype, {
        type: "TextureGradient",
        validInputs: ["sampler", "texSize", "uv"],
        setSRGB: function(t) {
            return this._isSRGB = t,
            this
        },
        setPackingRead: function(t) {
            return this._packingRead = t,
            this
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "sketchfabTextures.glsl"'
        },
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("textureGradient", this._outputs.color, [t.sampler, t.uv.getVariable() + ".xy", t.texSize])
        },
        getDefines: function() {
            var t = "texture2D(tex, uv)." + this._packingRead;
            return this._isSRGB && (t = "sRGBToLinear(" + t + ")"),
            ["#define TEX_BUMP(tex, uv) " + t]
        }
    });
    var h = function() {
        l.apply(this)
    };
    h.prototype = r.objectInherit(l.prototype, {
        type: "TextureEnvironmentCube",
        validInputs: ["sampler", "envTransform", "normal", "eye", "texSize"],
        computeShader: function() {
            var t = this._inputs;
            return o.callFunction("textureEnvironmentCube", this._outputs.color, [t.sampler, t.envTransform, t.normal, t.eye, t.texSize])
        }
    }),
    e.a = {
        TextureGradient: u,
        TextureEnvironmentCube: h
    }
}
, function(t, e, i) {
    "use strict";
    Object.defineProperty(e, "__esModule", {
        value: !0
    });
    var n = i(455)
      , r = i.n(n)
      , a = r.a.osg
      , s = a.DrawElements.prototype.setIndices;
    a.DrawElements.prototype.setIndices = function(t) {
        var e = t.getElements();
        a.WebGLCaps.instance().isWebGL2() && (1 === e.BYTES_PER_ELEMENT ? -1 !== e.indexOf(255) && t.setElements(new Uint16Array(e)) : 2 === e.BYTES_PER_ELEMENT && -1 !== e.indexOf(65535) && t.setElements(new Uint32Array(e))),
        s.call(this, t)
    }
    ,
    e.default = a.DrawElements
}
, function(t, e, i) {
    "use strict";
    Object.defineProperty(e, "__esModule", {
        value: !0
    });
    var n = i(455)
      , r = i.n(n)
      , a = r.a.osg
      , s = a.Geometry.prototype.computeBoundingBox;
    a.Geometry.prototype.computeBoundingBox = function(t) {
        s.call(this, t);
        var e = this._displacementFactor = this._displacementFactor || 0;
        if (e) {
            var i = t.getMin()
              , n = t.getMax();
            i[0] -= e,
            i[1] -= e,
            i[2] -= e,
            n[0] += e,
            n[1] += e,
            n[2] += e
        }
        return t
    }
    ;
    var o = a.Geometry.prototype.computeBoundingSphere;
    a.Geometry.prototype.computeBoundingSphere = function(t) {
        o.call(this, t);
        var e = this._displacementFactor = this._displacementFactor || 0;
        return e && t.set(t.center(), t.radius() + e),
        t
    }
    ,
    e.default = a.Geometry
}
, function(t, e, i) {
    "use strict";
    Object.defineProperty(e, "__esModule", {
        value: !0
    });
    var n = i(455)
      , r = i.n(n)
      , a = r.a.osg
      , s = new a.BoundingSphere;
    a.Node.prototype.getMinimumBound = function(t) {
        t || (t = s),
        t.init();
        var e = this.getBoundingBox();
        e.valid() && t.expandByBoundingBox(e);
        var i = this.getBound();
        return i.radius() < t.radius() ? i : t
    }
    ,
    e.default = a.Node
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = function() {
        r.TextureCubeMap.call(this),
        this._imageProxy = void 0
    };
    a.prototype = r.objectLibraryClass(r.objectInherit(r.TextureCubeMap.prototype, {
        getHash: function() {
            return "osgSketchfabTexture"
        }
    }), "osgSketchfab", "TextureCubeMap"),
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(329)
      , a = i(676)
      , s = i(151)
      , o = i(29)
      , l = n.a.osg
      , u = "rgba"
      , h = {};
    h[l.Texture.LUMINANCE] = "r",
    h[l.Texture.ALPHA] = "a",
    h[l.Texture.RGB] = "rgb";
    var c = function(t) {
        l.Texture.call(this),
        this._texture = t,
        this._isColorAtlas = !1,
        this._channels = [],
        this._packTextures = {}
    };
    c.prototype = l.objectLibraryClass(l.objectInherit(l.Texture.prototype, {
        attributeType: "Texture",
        setIsColorAtlas: function(t) {
            this._isColorAtlas = t
        },
        getChannelPacking: function(t) {
            return this._packTextures[t].pack
        },
        getTexture: function() {
            return this._texture || (this._texture = a.a.viewerInstance.packTextures(this._packTextures, this._channels)),
            this._texture
        },
        setTexture: function(t) {
            this._texture = t
        },
        getChannelCount: function() {
            return this._channels.length
        },
        addChannel: function(t, e, i) {
            this._packTextures[t] || (this._packTextures[t] = {
                texture: e,
                pack: "rgb"
            },
            i || this._channels.push(t),
            this._isColorAtlas || (this._texture = void 0,
            this.updatePacking()))
        },
        removeChannel: function(t) {
            this._packTextures[t] && (delete this._packTextures[t],
            this._channels.splice(this._channels.indexOf(t), 1),
            this._isColorAtlas || (this._texture = void 0,
            this.updatePacking()))
        },
        packChannelIfPossible: function(t, e) {
            if (this._isColorAtlas || !i.i(o.a)().materialPacking || e.isVideo())
                return !1;
            var n = this._channels
              , r = n.length;
            if (0 === r)
                return !1;
            for (var a = 4, l = 0; l < r; ++l)
                a -= this._packTextures[n[l]].pack.length;
            if (0 === a)
                return !1;
            var u = s.a.getDefaultStringFormat(t).length;
            return !(3 === u && a < 3) && (!!this.isFilteringFriendly(e, this._packTextures[n[0]].texture) && (3 === u ? n.unshift(t) : n.push(t),
            this.addChannel(t, e, !0),
            this.updatePacking(),
            !0))
        },
        isFilteringFriendly: function(t, e) {
            return t.getMinFilter() === e.getMinFilter() && (t.getMagFilter() === e.getMagFilter() && (t.getWrapS() === e.getWrapS() && t.getWrapT() === e.getWrapT()))
        },
        getSinglePacking: function(t, e) {
            if ("Opacity" === t) {
                var i = e.getInternalFormat()
                  , n = i && h[e.getInternalFormat()];
                return n && 1 === n.length ? n : "r"
            }
            return s.a.getDefaultStringFormat(t)
        },
        updatePacking: function() {
            var t = this._channels
              , e = 0
              , i = t.length;
            if (1 === i) {
                var n = this._packTextures[t[0]];
                return void (n.pack = this.getSinglePacking(t[0], n.texture))
            }
            for (var r = 0; r < i; ++r) {
                var a = t[r]
                  , o = this._packTextures[a];
                if (o) {
                    var l = s.a.getDefaultStringFormat(a).length;
                    o.pack = u.substr(e, l),
                    e += l
                }
            }
        },
        getMaxTextureSizePacked: function(t) {
            t.width = t.height = 0;
            for (var e = this._channels, i = e.length, n = 0; n < i; ++n) {
                var r = e[n]
                  , a = this._packTextures[r];
                if (a) {
                    var s = a.texture;
                    if (s.getImageJSONMaxSupported) {
                        var o = s.getImageJSONMaxSupported();
                        if (t.width = Math.max(t.width, o.width),
                        t.height = Math.max(t.height, o.height),
                        o.width > 512 || o.height > 512) {
                            var l = s.getImageJSONMaxSupported(512);
                            512 !== l.width && 512 !== l.height && (t.missingResolution = !0)
                        }
                    }
                }
            }
            return t
        },
        isProtectedTexture: function() {
            return !!this._packTextures.Opacity || !!this._packTextures.Displacement
        },
        getImage: function() {
            return this.getTexture().getImage()
        },
        cloneType: function() {
            return new c(new r.a)
        },
        isTextureNull: function() {
            return !(!this._isColorAtlas || 0 !== this._channels.length) || this.getTexture().isTextureNull()
        },
        apply: function(t) {
            this.getTexture().apply(t)
        },
        getHash: function() {
            for (var t = "osgTex", e = this._channels, i = 0, n = e.length; i < n; ++i)
                t += s.a.indexOf(e[i]) + "";
            return t
        }
    }), "osgSketchfab", "TextureMaterial"),
    l.setTypeID(c),
    e.a = c
}
, function(t, e, i) {
    "use strict";
    var n = i(15)
      , r = i(4)
      , a = i(43)
      , s = i(29)
      , o = i(293)
      , l = i(292)
      , u = i(146)
      , h = i(68)
      , c = i.n(h)
      , d = r.a.osg
      , p = n.a.extend({
        defaults: {
            enable: i.i(s.a)().postProcess,
            rgbmDefault: 7,
            rgbmBloom: 1,
            grainEnable: !1,
            grainAnimated: !1,
            grainFactor: .15,
            sharpenEnable: !1,
            sharpenFactor: .2,
            chromaticAberrationEnable: !1,
            chromaticAberrationFactor: .05,
            vignetteEnable: !1,
            vignetteLens: d.vec2.fromValues(.8, .25),
            bloomEnable: !1,
            bloomThreshold: 0,
            bloomFactor: .5,
            bloomRadius: .7,
            toneMappingEnable: !1,
            toneMappingMethod: "default",
            toneMappingExposure: 1,
            toneMappingBrightness: 0,
            toneMappingContrast: 0,
            toneMappingSaturation: 1,
            colorBalanceEnable: !1,
            colorBalanceLow: d.vec3.create(),
            colorBalanceMid: d.vec3.create(),
            colorBalanceHigh: d.vec3.create(),
            dofEnable: !1,
            dofBlurNear: .5,
            dofBlurFar: .5,
            dofFocusPoint: d.vec3.create(),
            dofQuality: 0,
            ssaoEnable: !1,
            ssaoBias: -1,
            ssaoRadius: -1,
            ssaoIntensity: .5,
            webVR: !1,
            veilFactor: 1,
            doDistortionVR: !1,
            distortion: d.vec2.fromValues(.441, .156),
            projectionLeft: d.vec4.fromValues(1, 1, -.5, -.5),
            unprojectionLeft: d.vec4.fromValues(1, 1, -.5, -.5),
            vrFadeLength: i.i(s.a)().vrFade / 1e3 / 2,
            vrStartFade: !1,
            vrFadeStartTime: 0,
            vrFadeCallback: void 0,
            vrFading: !1
        },
        getName: function() {
            return "PostProcess"
        },
        getViewer: function() {
            return this._viewer
        },
        _getBoundRadius: function() {
            return u.a.getModelBoxWithDisplacement().radius()
        },
        getMinimumSsaoRadius: function() {
            return .01 * this._getBoundRadius()
        },
        getMaximumSsaoRadius: function() {
            return .1 * this._getBoundRadius()
        },
        getMinimumSsaoBias: function() {
            return .002 * this._getBoundRadius()
        },
        getMaximumSsaoBias: function() {
            return .01 * this._getBoundRadius()
        },
        _makeValidOption: function(t, e, i, n) {
            var r = this.get(t);
            r < e * u.a.BIAS_MIN || r > i * u.a.BIAS_MAX ? this.set(t, n) : this.set(t, Math.min(Math.max(r, e), i))
        },
        _makeValidSsaoRadius: function() {
            this._makeValidOption("ssaoRadius", this.getMinimumSsaoRadius(), this.getMaximumSsaoRadius(), .025 * this._getBoundRadius())
        },
        _makeValidSsaoBias: function() {
            this._makeValidOption("ssaoBias", this.getMinimumSsaoBias(), this.getMaximumSsaoBias(), .005 * this._getBoundRadius())
        },
        isEffectiveGrain: function() {
            return !this.get("webVR") && this.get("grainEnable") && this.get("grainFactor") >= 5e-4
        },
        isEffectiveSharpen: function() {
            return !this.get("webVR") && this.get("sharpenEnable") && this.get("sharpenFactor") >= 5e-4
        },
        isEffectiveChromaticAberration: function() {
            return !this.get("webVR") && this.get("chromaticAberrationEnable") && this.get("chromaticAberrationFactor") >= .001
        },
        isEffectiveVignette: function() {
            return !this.get("webVR") && this.get("vignetteEnable") && this.get("vignetteLens")[1] <= .5 * Math.sqrt(2)
        },
        isEffectiveBloom: function() {
            return (!this.get("webVR") || !c.a.any) && this.get("bloomEnable") && this.get("bloomFactor") >= .01
        },
        isEffectiveToneMapping: function() {
            return this.get("toneMappingEnable")
        },
        isEffectiveColorBalance: function() {
            return this.get("colorBalanceEnable")
        },
        isEffectiveDof: function() {
            return !this.get("webVR") && this.get("dofEnable") && (this.get("dofBlurNear") >= .01 || this.get("dofBlurFar") >= .01)
        },
        isEffectiveSsao: function() {
            return !this.get("webVR") && this.get("ssaoEnable") && this.get("ssaoIntensity") >= .01
        },
        initAfterFirstFrame: function() {
            this._makeValidSsaoRadius(),
            this._makeValidSsaoBias(),
            this.trigger("uiReady")
        },
        init: function(t) {
            this._viewer = t.getViewer();
            var e = t.getModel().get("options");
            if (e.scene && e.scene.postProcess) {
                var n = e.scene.postProcess;
                void 0 !== n.enable && i.i(s.a)().postProcess && this.set("enable", n.enable),
                n.grain && (this.set("grainEnable", n.grain.enable),
                this.set("grainAnimated", n.grain.animated),
                this.set("grainFactor", n.grain.factor)),
                n.sharpen && (this.set("sharpenEnable", n.sharpen.enable),
                this.set("sharpenFactor", n.sharpen.factor)),
                n.chromaticAberration && (this.set("chromaticAberrationEnable", n.chromaticAberration.enable),
                this.set("chromaticAberrationFactor", n.chromaticAberration.factor)),
                n.vignette && (this.set("vignetteEnable", n.vignette.enable),
                this.set("vignetteLens", n.vignette.lens)),
                n.bloom && (this.set("bloomEnable", n.bloom.enable),
                this.set("bloomFactor", n.bloom.factor),
                this.set("bloomThreshold", n.bloom.threshold),
                n.bloom.radius && this.set("bloomRadius", n.bloom.radius)),
                n.toneMapping && (this.set("toneMappingEnable", n.toneMapping.enable),
                this.set("toneMappingExposure", n.toneMapping.exposure),
                this.set("toneMappingBrightness", n.toneMapping.brightness),
                this.set("toneMappingContrast", n.toneMapping.contrast),
                this.set("toneMappingSaturation", n.toneMapping.saturation),
                this.set("toneMappingMethod", n.toneMapping.method)),
                n.colorBalance && (this.set("colorBalanceEnable", n.colorBalance.enable),
                n.colorBalance.low && this.set("colorBalanceLow", n.colorBalance.low),
                n.colorBalance.mid && this.set("colorBalanceMid", n.colorBalance.mid),
                n.colorBalance.high && this.set("colorBalanceHigh", n.colorBalance.high)),
                n.dof && (this.set("dofEnable", n.dof.enable),
                this.set("dofBlurNear", n.dof.blurNear),
                this.set("dofBlurFar", n.dof.blurFar),
                this.set("dofFocusPoint", n.dof.focusPoint)),
                n.ssao && (this.set("ssaoEnable", n.ssao.enable),
                this.set("ssaoRadius", n.ssao.radius),
                this.set("ssaoIntensity", n.ssao.intensity),
                this.set("ssaoBias", n.ssao.bias))
            }
            if (i.i(o.a)()) {
                var r = t.getViewer();
                a.a.getMaterial().then(function() {
                    "Tilt Brush" === r.getRootUserData().authoringTool && (this.set("bloomEnable", !0),
                    this.set("bloomThreshold", .6),
                    this.set("bloomFactor", 1.6),
                    this.set("bloomRadius", .2),
                    this.set("toneMappingEnable", !0),
                    this.set("toneMappingMethod", "filmic"))
                }
                .bind(this))
            }
        },
        fadeForTeleportVR: function(t) {
            this.set("vrStartFade", !0),
            this.set("vrFadeCallback", t)
        },
        getJSON: function() {
            return {
                enable: this.get("enable"),
                grain: {
                    enable: this.get("grainEnable"),
                    animated: this.get("grainAnimated"),
                    factor: this.get("grainFactor")
                },
                sharpen: {
                    enable: this.get("sharpenEnable"),
                    factor: this.get("sharpenFactor")
                },
                chromaticAberration: {
                    enable: this.get("chromaticAberrationEnable"),
                    factor: this.get("chromaticAberrationFactor")
                },
                vignette: {
                    enable: this.get("vignetteEnable"),
                    lens: this.get("vignetteLens")
                },
                bloom: {
                    enable: this.get("bloomEnable"),
                    factor: this.get("bloomFactor"),
                    threshold: this.get("bloomThreshold"),
                    radius: this.get("bloomRadius")
                },
                toneMapping: {
                    enable: this.get("toneMappingEnable"),
                    method: this.get("toneMappingMethod"),
                    exposure: this.get("toneMappingExposure"),
                    brightness: this.get("toneMappingBrightness"),
                    contrast: this.get("toneMappingContrast"),
                    saturation: this.get("toneMappingSaturation")
                },
                colorBalance: {
                    enable: this.get("colorBalanceEnable"),
                    low: this.get("colorBalanceLow"),
                    mid: this.get("colorBalanceMid"),
                    high: this.get("colorBalanceHigh")
                },
                dof: {
                    enable: this.get("dofEnable"),
                    blurNear: this.get("dofBlurNear"),
                    blurFar: this.get("dofBlurFar"),
                    focusPoint: this.get("dofFocusPoint")
                },
                ssao: {
                    enable: this.get("ssaoEnable"),
                    bias: this.get("ssaoBias"),
                    intensity: this.get("ssaoIntensity"),
                    radius: this.get("ssaoRadius")
                }
            }
        },
        editorGetJSON: function() {
            return this.getJSON()
        },
        validateJSON: function(t) {
            var e = [];
            return t.grain && (l.a.isBoolean(t.grain.enable) || e.push("PostProcess.editorSetJSON grain.enable must be a boolean"),
            l.a.isBoolean(t.grain.animated) || e.push("PostProcess.editorSetJSON grain.animated must be a boolean"),
            l.a.isNumber(t.grain.factor, 0, .5) || e.push("PostProcess.editorSetJSON grain.factor must be a number in range [0,0.5]")),
            t.sharpen && (l.a.isBoolean(t.sharpen.enable) || e.push("PostProcess.editorSetJSON sharpen.enable must be a boolean"),
            l.a.isNumber(t.sharpen.factor, 0, 5) || e.push("PostProcess.editorSetJSON sharpen.factor must be a number in range [0,5]")),
            t.chromaticAberration && (l.a.isBoolean(t.chromaticAberration.enable) || e.push("PostProcess.editorSetJSON chromaticAberration.enable must be a boolean"),
            l.a.isNumber(t.chromaticAberration.factor, 0, .1) || e.push("PostProcess.editorSetJSON chromaticAberration.factor must be a number in range [0.0,0.1]")),
            t.vignette && (l.a.isBoolean(t.vignette.enable) || e.push("PostProcess.editorSetJSON vignette.enable must be a boolean"),
            l.a.isArrayNumber(t.vignette.lens, 2, -1, 1) || e.push("PostProcess.editorSetJSON vignette.lens must be a vec2 in range [-1,1]")),
            t.bloom && (l.a.isBoolean(t.bloom.enable) || e.push("PostProcess.editorSetJSON bloom.enable must be a boolean"),
            l.a.isNumber(t.bloom.factor, 0, 2) || e.push("PostProcess.editorSetJSON bloom.factor must be a number in range [0,2]"),
            l.a.isNumber(t.bloom.threshold, 0, 1) || e.push("PostProcess.editorSetJSON bloom.threshold must be a number in range [0,1]"),
            l.a.isNumber(t.bloom.radius, 0, 1) || e.push("PostProcess.editorSetJSON bloom.radius must be a number in range [0,1]")),
            t.toneMapping && (l.a.isBoolean(t.toneMapping.enable) || e.push("PostProcess.editorSetJSON toneMapping.enable must be a boolean"),
            l.a.isEnumString(t.toneMapping.method, ["default", "filmic", "reinhard"]) || e.push("PostProcess.editorSetJSON toneMapping.method must be a enum with values [default, filmic, reinhard]"),
            l.a.isNumber(t.toneMapping.exposure, 0, 2) || e.push("PostProcess.editorSetJSON toneMapping.exposure must be a number in range [ 0,2]"),
            l.a.isNumber(t.toneMapping.brightness, -1, 1) || e.push("PostProcess.editorSetJSON toneMapping.brightness must be a number in range [-1,1]"),
            l.a.isNumber(t.toneMapping.contrast, -1, 1) || e.push("PostProcess.editorSetJSON toneMapping.contrast must be a number in range [-1,1]"),
            l.a.isNumber(t.toneMapping.saturation, 0, 2) || e.push("PostProcess.editorSetJSON toneMapping.saturation must be a number in range [0,2]")),
            t.colorBalance && (l.a.isBoolean(t.colorBalance.enable) || e.push("PostProcess.editorSetJSON colorBalance.enable must be a boolean"),
            l.a.isArrayNumber(t.colorBalance.low, 3, -1, 1) || e.push("PostProcess.editorSetJSON colorBalance.low must be a vec3 in range [-1,1]"),
            l.a.isArrayNumber(t.colorBalance.mid, 3, -1, 1) || e.push("PostProcess.editorSetJSON colorBalance.mid must be a vec3 in range [-1,1]"),
            l.a.isArrayNumber(t.colorBalance.high, 3, -1, 1) || e.push("PostProcess.editorSetJSON colorBalance.high must be a vec3 in range [-1,1]")),
            t.dof && (l.a.isBoolean(t.dof.enable) || e.push("PostProcess.editorSetJSON dof.enable must be a boolean"),
            l.a.isNumber(t.dof.blurNear, 0, 1) || e.push("PostProcess.editorSetJSON dof.blurNear must be a number in range [0,1]"),
            l.a.isNumber(t.dof.blurFar, 0, 1) || e.push("PostProcess.editorSetJSON dof.blurFar must be a number in range [0,1]"),
            l.a.isArrayNumber(t.dof.focusPoint, 3) || e.push("PostProcess.editorSetJSON dof.focusPoint must be a vec3")),
            t.ssao && (l.a.isBoolean(t.ssao.enable) || e.push("PostProcess.editorSetJSON ssao.enable must be a boolean"),
            l.a.isNumber(t.ssao.bias) || e.push("PostProcess.editorSetJSON ssao.bias must be a number"),
            l.a.isNumber(t.ssao.radius) || e.push("PostProcess.editorSetJSON ssao.radius must be a number"),
            l.a.isNumber(t.ssao.intensity) || e.push("PostProcess.editorSetJSON ssao.intensity must be a number")),
            e.join("\n")
        },
        editorSetJSON: function(t) {
            var e = this.validateJSON(t);
            if (e)
                return e;
            var i = {
                enable: t.enable
            };
            return t.grain && (i.grainEnable = t.grain.enable,
            i.grainAnimated = t.grain.animated,
            i.grainFactor = t.grain.factor),
            t.sharpen && (i.sharpenEnable = t.sharpen.enable,
            i.sharpenFactor = t.sharpen.factor),
            t.chromaticAberration && (i.chromaticAberrationEnable = t.chromaticAberration.enable,
            i.chromaticAberrationFactor = t.chromaticAberration.factor),
            t.vignette && (i.vignetteEnable = t.vignette.enable,
            i.vignetteLens = t.vignette.lens),
            t.bloom && (i.bloomEnable = t.bloom.enable,
            i.bloomFactor = t.bloom.factor,
            i.bloomThreshold = t.bloom.threshold,
            i.bloomRadius = t.bloom.radius),
            t.toneMapping && (i.toneMappingEnable = t.toneMapping.enable,
            i.toneMappingMethod = t.toneMapping.method,
            i.toneMappingExposure = t.toneMapping.exposure,
            i.toneMappingBrightness = t.toneMapping.brightness,
            i.toneMappingContrast = t.toneMapping.contrast,
            i.toneMappingSaturation = t.toneMapping.saturation),
            t.colorBalance && (i.colorBalanceEnable = t.colorBalance.enable,
            i.colorBalanceLow = t.colorBalance.low,
            i.colorBalanceMid = t.colorBalance.mid,
            i.colorBalanceHigh = t.colorBalance.high),
            t.dof && (i.dofEnable = t.dof.enable,
            i.dofBlurNear = t.dof.blurNear,
            i.dofBlurFar = t.dof.blurFar,
            i.dofFocusPoint = t.dof.focusPoint),
            t.ssao && (i.ssaoEnable = t.ssao.enable,
            i.ssaoBias = t.ssao.bias,
            i.ssaoRadius = t.ssao.radius,
            i.ssaoIntensity = t.ssao.intensity),
            this.set(i),
            e
        }
    });
    e.a = p
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(29)
      , a = i(70)
      , s = i(421)
      , o = i(1014)
      , l = i(552)
      , u = i(90)
      , h = i(672)
      , c = i(329)
      , d = i(68)
      , p = i.n(d)
      , f = i(43)
      , g = i(138)
      , m = n.a.osg
      , v = n.a.osgUtil
      , _ = g.a.getShaderProcessor()
      , b = function(t) {
        m.Node.call(this),
        this.setName("PostProcess - node In"),
        this._uniforms = t._uniforms,
        this._camera = t._camera,
        this._effectiveConfig = t._effectiveConfig,
        this._viewer = t._viewer,
        this._viewerOSGJS = t._viewerOSGJS,
        this._model = t.model,
        this._stateSetCompositeBG = void 0,
        this._texturesRTT = {},
        this._isOnMobile = !1,
        this._hasTriangles = this._viewer.getOrCreateScene().getJSON().faceCount > 0,
        l.a.setHasTriangles(this._hasTriangles),
        this._viewer.getCamera().getRenderer().setRenderStage(new l.a),
        this.initStateSet(),
        this._model.on("pingPongTexture0", this.onPingPongTexture0, this),
        f.a.getMaterial().then(function() {
            var t = this.getBackgroundModel();
            t.bind("backgroundUpdated", this.onBackgroundUpdated, this),
            t.bind("change:color", this.onBackgroundColor, this)
        }
        .bind(this))
    };
    b.prototype = m.objectInherit(m.Node.prototype, {
        initStateSet: function() {
            var t = this._uniforms
              , e = this.getOrCreateStateSet();
            e.addUniform(t.uOutputLinear),
            e.addUniform(t.uRGBMRange),
            e.addUniform(t.uPixelRatio),
            e.addUniform(l.a.getDrawOpaqueUniform()),
            e.addUniform(t.uNearFar),
            e.addUniform(t.uDofBlurNearFarFocal),
            e.addUniform(t.uTime)
        },
        getNodeBackground: function() {
            return this._viewer.getFeatures().environment.getNode().getBackground()
        },
        getBackgroundModel: function() {
            return this._viewer.getFeatures().background.getModel()
        },
        getBackgroundType: function() {
            return this.getBackgroundModel().getEnableType()
        },
        onPingPongTexture0: function(t) {
            this._antialiasFilter && (this._antialiasFilter._cameraRtt0.setNodeMask(t ? -1 : 0),
            this._antialiasFilter._cameraRtt1.setNodeMask(t ? 0 : -1))
        },
        onBackgroundUpdated: function(t) {
            var e = this._stateSetCompositeBG && this._stateSetCompositeBG.getUniform("TextureFixed");
            e && (t.divisor = -1,
            this._stateSetCompositeBG.setTextureAttributeAndModes(e.getInternalArray()[0], t))
        },
        onBackgroundColor: function() {
            var t = l.a.getClearColor();
            if ("color" !== this.getBackgroundType())
                return void m.vec4.set(t, 0, 0, 0, 0);
            m.vec3.copy(t, this.getBackgroundModel().getColor()),
            t[3] = 1,
            1 === this._uniforms.uOutputLinear.getInternalArray()[0] && h.a.srgbToLinear(t, t);
            var e = this._uniforms.uRGBMRange.getInternalArray()[0];
            e > 0 && h.a.encodeRGBM(t, e, t)
        },
        getSupportedFloatTexture: function() {
            var t = m.WebGLCaps.instance();
            return 0 === i.i(r.a)().floatRtt ? m.Texture.UNSIGNED_BYTE : t.hasLinearHalfFloatRTT() ? m.Texture.HALF_FLOAT : t.hasHalfFloatRTT() ? m.Texture.HALF_FLOAT : p.a.any && this._model.get("webVR") && 2 === i.i(r.a)().floatRtt ? m.Texture.UNSIGNED_BYTE : t.hasLinearFloatRTT() ? m.Texture.FLOAT : t.hasFloatRTT() ? m.Texture.FLOAT : m.Texture.UNSIGNED_BYTE
        },
        getOrCreateTextureRTT: function(t, e, i, n) {
            e = e || "default",
            t = t || 1,
            n = n || m.Texture.UNSIGNED_BYTE,
            i = i || m.Texture.NEAREST;
            var r = Math.max(1, Math.round(this._viewerOSGJS.getCanvasWidth() / t))
              , a = Math.max(1, Math.round(this._viewerOSGJS.getCanvasHeight() / t))
              , s = e + t + "_" + n + "_" + i
              , o = this._texturesRTT[s];
            return o ? (o.setTextureSize(r, a),
            o) : (o = this._texturesRTT[s] = new m.Texture,
            o.setInternalFormatType(n),
            o.setTextureSize(r, a),
            o.setInternalFormat(m.Texture.RGBA),
            o.setMinFilter(i),
            o.setMagFilter(i),
            o.setName(s),
            o.divisor = t,
            o)
        },
        getOrCreateTextureOpaque: function(t) {
            return this.getOrCreateTextureRTT(1, "opaque", t)
        },
        getOrCreateTextureTransparent: function() {
            return this.getOrCreateTextureRTT(1, "transparent", m.Texture.NEAREST, this.getSupportedFloatTexture())
        },
        getOrCreateTextureDepth: function() {
            return this.getOrCreateTextureRTT(1, "depth", m.Texture.NEAREST)
        },
        getOrCreateTextureExtra: function() {
            return this.getOrCreateTextureRTT(1, "extra")
        },
        createCameraAA: function(t, e) {
            var i = new m.Camera;
            return i.setName(t),
            i.setRenderOrder(m.Camera.PRE_RENDER, 0),
            i.attachTexture(m.FrameBufferObject.COLOR_ATTACHMENT0, e),
            i.setClearMask(0),
            i
        },
        createFilter: function(t, e) {
            t = t || {};
            var i = new o.a([],[],_);
            i.setPostProcessConfiguration(t);
            var n = new v.Composer.Filter.Custom(i.createFragmentShader(),e);
            return n.setVertexName(i.getVertexShaderName()),
            n
        },
        addCompositeBackground: function(t, e) {
            "fixed" === this.getBackgroundType() && (t.useComposeBackground = !0,
            e.TextureFixed = this.getNodeBackground().getBackground() || c.a.dummyTexture,
            e.TextureFixed.divisor = -1,
            e.uFixedScale = this.getNodeBackground().getUniforms().scale,
            e.TextureDepth = this._camera._textureDepth)
        },
        addMergeOpacityPass: function(t, e) {
            var i = {
                isPassMergeOpacity: !0,
                RGBMTexture0: this._model.get("rgbmDefault"),
                RGBMTextureTransparent: void 0,
                encodeRGBM: e.outputInSRGB ? null : this._model.get("rgbmDefault"),
                composeExtra: e.composeExtra
            }
              , n = {
                uOutputLinear: m.Uniform.createInt(e.outputInSRGB ? 0 : 1, "uOutputLinear"),
                Texture0: e.inputTexture,
                TextureTransparent: this._camera._textureTransparent
            };
            e.composeBackground && this.addCompositeBackground(i, n);
            var r = this.getOrCreateTextureRTT(1, "mergeableOpacity", e.outputFiltering);
            this.configureVeilAndExtra(i, n);
            var a = t.addPass(this.createFilter(i, n), r);
            return a.setFragmentName("MergeOpacity"),
            e.composeBackground && (this._stateSetCompositeBG = a.getStateSet()),
            r
        },
        buildMipmapPasses: function(t, e) {
            for (var i = this._camera._textureDepth, n = {
                isPassDepthMipmap: !0
            }, r = 1; r <= 5; ++r) {
                var a = {
                    Texture0: i
                };
                i = this.getOrCreateTextureRTT(1 << r + 1, "depth_" + r, m.Texture.LINEAR, m.Texture.UNSIGNED_BYTE),
                e["TextureDepth" + r] = i;
                var s = this.createFilter(n, a);
                s.setFragmentName("DepthMipmap" + r),
                t.addPass(s, i)
            }
        },
        addSsao: function(t, e) {
            var i = {
                isPassSsaoExtract: !0
            }
              , n = {
                TextureDepth: this._camera._textureDepth,
                uSsaoRadius: this._uniforms.uSsaoRadius,
                uSsaoBias: this._uniforms.uSsaoBias,
                uSsaoIntensity: this._uniforms.uSsaoIntensity,
                uSsaoProjectionInfo: this._uniforms.uSsaoProjectionInfo,
                uSsaoProjectionScale: this._uniforms.uSsaoProjectionScale,
                uNearFar: this._uniforms.uNearFar,
                uTime: this._uniforms.uTime
            };
            this.buildMipmapPasses(t, n);
            var r = this.getOrCreateTextureRTT(1, "texSsao", e.outputFiltering)
              , a = t.addPass(this.createFilter(i, n), r);
            a.setFragmentName("SsaoExtract"),
            i = {
                isPassSsaoBlurH: !0
            },
            n = {
                TextureSsao: r
            };
            var s = this.getOrCreateTextureRTT(1, "ssaoBlur", m.Texture.NEAREST);
            a = t.addPass(this.createFilter(i, n), s),
            a.setFragmentName("SsaoBlurH"),
            i = {
                isPassSsaoBlurV: !0,
                RGBMTexture0: this._model.get("rgbmDefault"),
                encodeRGBM: e.outputInSRGB ? null : this._model.get("rgbmDefault")
            },
            n = {
                uOutputLinear: m.Uniform.createInt(e.outputInSRGB ? 0 : 1, "uOutputLinear"),
                Texture0: e.inputTexture,
                TextureSsao: s
            },
            e.composeBackground && this.addCompositeBackground(i, n);
            var o = r;
            return a = t.addPass(this.createFilter(i, n), o),
            a.setFragmentName("SsaoBlurV"),
            e.composeBackground && (this._stateSetCompositeBG = a.getStateSet()),
            o
        },
        getPackFunc: function(t) {
            return ["vec4 pack( const in vec4 col ) {", "    vec4 rgbm;", "    vec3 color = col.rgb / " + t + ";", "    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );", "    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;", "    rgbm.rgb = color / rgbm.a;", "    return rgbm;", "}"].join("\n")
        },
        getUnpackFunc: function(t) {
            return ["vec4 unpack( const in sampler2D tex, const in vec2 uv ) {", "    vec4 col = texture2D(tex, uv);", "    return vec4(" + t + " * col.rgb * col.a, 1.0);", "}"].join("\n")
        },
        addDofPass: function(t, e) {
            var n = this.getSupportedFloatTexture() === m.Texture.HALF_FLOAT
              , a = i.i(r.a)().dofRes || 2 * this._viewerOSGJS.getCanvasPixelRatio()
              , s = this._uniforms.uDofScale
              , o = {
                isPassDofDownsampleCoC: !0
            }
              , l = {
                TextureDepth: this._camera._textureDepth,
                uDofScale: s
            }
              , u = this.getOrCreateTextureRTT(a, "dofCoC", m.Texture.NEAREST)
              , h = t.addPass(this.createFilter(o, l), u);
            h.setFragmentName("DofDownsampleCoC"),
            o = {
                isPassDofDilateNearH: !0
            },
            l = {
                TextureCoC: u,
                TextureDepth: this._camera._textureDepth,
                uDofScale: s
            };
            var c = this.getOrCreateTextureRTT(a, "dofTmpCoCOrBlurred", m.Texture.LINEAR);
            h = t.addPass(this.createFilter(o, l), c),
            h.setFragmentName("DofNearDilateH"),
            o = {
                isPassDofDilateNearV: !0
            },
            l = {
                TextureCoC: c,
                TextureDepth: this._camera._textureDepth,
                uDofScale: s
            };
            var d = u;
            h = t.addPass(this.createFilter(o, l), d),
            h.setFragmentName("DofNearDilateV");
            var p;
            o = {
                isPassDofDownsampleColor: !0,
                colorWithCoC: n
            },
            l = {
                TextureColor: e.inputTexture
            },
            n && (l.TextureCoC = d),
            p = this.getOrCreateTextureRTT(a, "dofDownsampleColor", m.Texture.NEAREST, n ? m.Texture.HALF_FLOAT : m.Texture.UNSIGNED_BYTE),
            h = t.addPass(this.createFilter(o, l), p),
            h.setFragmentName("DofDownsampleColor"),
            o = {
                isPassDofBlurCircular: !0,
                colorWithCoC: n
            },
            l = {
                TextureColor: p,
                uDofScale: s
            },
            n || (l.TextureCoC = d);
            var f = c;
            h = t.addPass(this.createFilter(o, l), f),
            h.setFragmentName("DofBlurCircular"),
            o = {
                isPassDofCombine: !0,
                RGBMTexture0: this._model.get("rgbmDefault"),
                RGBMTexture1: this._model.get("rgbmDefault"),
                RGBMTexture2: this._model.get("rgbmDefault"),
                encodeRGBM: e.outputInSRGB ? null : this._model.get("rgbmDefault")
            },
            l = {
                uOutputLinear: m.Uniform.createInt(e.outputInSRGB ? 0 : 1, "uOutputLinear"),
                Texture0: e.inputTexture,
                TextureBlurred: f,
                TextureCoCDilated: d,
                TextureDepth: this._camera._textureDepth,
                uDofScale: s,
                uBlurDiv: a
            },
            e.composeBackground && this.addCompositeBackground(o, l);
            var g = this.getOrCreateTextureRTT(1, "dof", e.outputFiltering);
            return h = t.addPass(this.createFilter(o, l), g),
            h.setFragmentName("DofCombine"),
            e.composeBackground && (this._stateSetCompositeBG = h.getStateSet()),
            g
        },
        addBloomPass: function(t, e) {
            var i = this.getPackFunc(this._model.get("rgbmBloom").toExponential())
              , n = this.getUnpackFunc(this._model.get("rgbmBloom").toExponential())
              , r = m.Texture.LINEAR
              , a = "none" !== this.getBackgroundType()
              , s = {
                isPassBright: !0,
                RGBMTexture0: this._model.get("rgbmDefault"),
                encodeRGBM: this._model.get("rgbmBloom"),
                testDepthBloom: a
            }
              , o = {
                uBloomThreshold: this._uniforms.uBloomThreshold,
                uOutputLinear: m.Uniform.createInt(1, "uOutputLinear"),
                Texture0: e.inputTexture
            };
            s && (o.TextureDepth = this._camera._textureDepth);
            var l = t.addPass(this.createFilter(s, o), this.getOrCreateTextureRTT(1, "bloom", r));
            l.setFragmentName("BloomExtractBright");
            var u = 2 * this._viewerOSGJS.getCanvasPixelRatio()
              , h = 2 * u
              , c = 2 * h
              , d = 2 * c
              , p = 2 * d
              , f = this._isOnMobile ? void 0 : this.getOrCreateTextureRTT(u, "blurH", r)
              , g = this.getOrCreateTextureRTT(h, "blurH", r)
              , _ = this.getOrCreateTextureRTT(c, "blurH", r)
              , b = this.getOrCreateTextureRTT(d, "blurH", r)
              , x = this._isOnMobile ? void 0 : this.getOrCreateTextureRTT(p, "blurH", r);
            this._isOnMobile || (t.addPass(new v.Composer.Filter.VBlur(3,!0,n,i), this.getOrCreateTextureRTT(u, "blurV", r)),
            t.addPass(new v.Composer.Filter.HBlur(3,!0,n,i), f)),
            t.addPass(new v.Composer.Filter.VBlur(5,!0,n,i), this.getOrCreateTextureRTT(h, "blurV", r)),
            t.addPass(new v.Composer.Filter.HBlur(5,!0,n,i), g),
            t.addPass(new v.Composer.Filter.VBlur(7,!0,n,i), this.getOrCreateTextureRTT(c, "blurV", r)),
            t.addPass(new v.Composer.Filter.HBlur(7,!0,n,i), _),
            t.addPass(new v.Composer.Filter.VBlur(9,!0,n,i), this.getOrCreateTextureRTT(d, "blurV", r)),
            t.addPass(new v.Composer.Filter.HBlur(9,!0,n,i), b),
            this._isOnMobile || (t.addPass(new v.Composer.Filter.VBlur(11,!0,n,i), this.getOrCreateTextureRTT(p, "blurV", r)),
            t.addPass(new v.Composer.Filter.HBlur(11,!0,n,i), x));
            var y = {
                isPassAdditive: !0,
                isOnMobile: this._isOnMobile,
                RGBMTexture0: this._model.get("rgbmDefault"),
                RGBMTexture1: this._model.get("rgbmBloom"),
                RGBMTexture2: this._model.get("rgbmBloom"),
                RGBMTexture3: this._model.get("rgbmBloom"),
                RGBMTexture4: this._model.get("rgbmBloom"),
                RGBMTexture5: this._model.get("rgbmBloom"),
                encodeRGBM: e.outputInSRGB ? null : this._model.get("rgbmDefault"),
                composeExtra: e.composeExtra
            }
              , S = {
                uBloomFactor: this._uniforms.uBloomFactor,
                uBloomRadius: this._uniforms.uBloomRadius,
                uOutputLinear: m.Uniform.createInt(e.outputInSRGB ? 0 : 1, "uOutputLinear"),
                Texture0: e.inputTexture,
                Texture1: f,
                Texture2: g,
                Texture3: _,
                Texture4: b,
                Texture5: x
            };
            e.composeBackground && this.addCompositeBackground(y, S),
            this.configureVeilAndExtra(y, S);
            var w = this.getOrCreateTextureRTT(1, "bloom", e.outputFiltering);
            return l = t.addPass(this.createFilter(y, S), w),
            l.setFragmentName("BloomMergeAdditive"),
            e.composeBackground && (this._stateSetCompositeBG = l.getStateSet()),
            w
        },
        addMergeablePass: function(t, e) {
            var i = this._effectiveConfig
              , n = {
                isPassMergeable: !0,
                useChromaticAberration: i.useChromaticAberration,
                useVignetteMergeable: i.useVignetteMergeable,
                useToneMapping: i.useToneMapping,
                useColorBalance: i.useColorBalance,
                RGBMTexture0: this._model.get("rgbmDefault"),
                composeExtra: e.composeExtra
            }
              , r = {
                uOutputLinear: m.Uniform.createInt(e.outputInSRGB ? 0 : 1, "uOutputLinear"),
                Texture0: e.inputTexture
            };
            e.composeBackground && this.addCompositeBackground(n, r),
            n.useChromaticAberration && (r.uChromaFactor = this._uniforms.uChromaFactor),
            n.useVignetteMergeable && (r.uLensRadius = this._uniforms.uLensRadius),
            n.useToneMapping && (r.uToneExposure = this._uniforms.uToneExposure,
            r.uToneBrightness = this._uniforms.uToneBrightness,
            r.uToneContrast = this._uniforms.uToneContrast,
            r.uToneSaturation = this._uniforms.uToneSaturation,
            r.uToneMethod = this._uniforms.uToneMethod),
            n.useColorBalance && (r.uColorBalanceLow = this._uniforms.uColorBalanceLow,
            r.uColorBalanceMid = this._uniforms.uColorBalanceMid,
            r.uColorBalanceHigh = this._uniforms.uColorBalanceHigh),
            this.configureVeilAndExtra(n, r);
            var a = this.getOrCreateTextureRTT(1, "mergeable", e.outputFiltering)
              , s = t.addPass(this.createFilter(n, r), a);
            return s.setFragmentName("PostProcessMergeable"),
            e.composeBackground && (this._stateSetCompositeBG = s.getStateSet()),
            a
        },
        configureVeilAndExtra: function(t, e) {
            t.useVeil = this._model.get("webVR") && t.composeExtra,
            t.linearize = this._model.get("webVR") && t.composeExtra,
            t.composeExtra = this._model.get("webVR") && t.composeExtra && !!this._camera._textureExtra,
            t.useVeil && (e.uVrVeilFactor = this._uniforms.uVrVeilFactor),
            t.composeExtra && (e.TextureExtra = this._camera._textureExtra)
        },
        addSuperSamplePass: function(t) {
            var e = this._camera
              , i = this.getBackgroundType()
              , n = "none" !== i
              , r = this._effectiveConfig.useSharpen
              , a = this._effectiveConfig.useVignetteSuperSample
              , s = {
                isPassSuperSample: !0,
                background: i,
                useAntiAlias: n && this._hasTriangles,
                useSharpen: r,
                useVignetteSuperSample: a,
                useTextureExtra: !!e._textureExtra,
                testDepthSharpen: r && n,
                RGBMTexture0: null,
                encodeRGBM: null
            }
              , l = this.getOrCreateTextureRTT(1, "Antialias2", m.Texture.LINEAR)
              , u = this.createCameraAA("Antialias2", l)
              , h = this.getOrCreateTextureRTT(1, "Antialias1", m.Texture.LINEAR)
              , c = this.createCameraAA("Antialias1", h)
              , d = {
                uOutputLinear: m.Uniform.createInt(1, "uOutputLinear")
            };
            r && (d.uSharpFactor = this._uniforms.uSharpFactor),
            a && (d.uLensRadius = this._uniforms.uLensRadius);
            var p = c.getOrCreateStateSet()
              , f = u.getOrCreateStateSet()
              , g = 2;
            !s.testDepthSharpen && n || this.addTextureToPingPong(p, f, g++, "TextureDepth", e._textureDepth),
            s.useTextureExtra && this.addTextureToPingPong(p, f, g++, "TextureExtra", e._textureExtra),
            this._viewer.getSuperSample().setCanBeEnabled(n);
            var b = new o.a([],[],_);
            b.setPostProcessConfiguration(s),
            this._antialiasFilter = new v.Composer.Filter.PingPong(c,h,u,l,b.createFragmentShader(),d),
            this._antialiasFilter.setFragmentName("Antialias"),
            t.addPass(this._antialiasFilter),
            this.addFinalPass(t)
        },
        addTextureToPingPong: function(t, e, i, n, r) {
            t.addUniform(m.Uniform.createInt(i, n)),
            e.addUniform(m.Uniform.createInt(i, n)),
            t.setTextureAttributeAndModes(i, r),
            e.setTextureAttributeAndModes(i, r)
        },
        addFinalPass: function(t) {
            var e = {}
              , i = [];
            this._effectiveConfig.useGrain && (e.uGrainFactor = this._uniforms.uGrainFactor,
            e.uTimeGrain = this._uniforms.uTimeGrain,
            i.push("#define GRAIN")),
            this._effectiveConfig.useDof && (e.uDofCross = this._uniforms.uDofCross,
            i.push("#define DOF_CROSS"));
            var n = _.getShader("postProcess-pingpong.frag", i)
              , r = new v.Composer.Filter.Custom(n,e);
            r.setFragmentName("PassTroughFinal"),
            t.addPass(r)
        },
        addAntiAliasPassVR: function(t, e) {
            var n = {
                isPassFinalPassVR: !0,
                useAntiAlias: !!this._hasTriangles,
                background: this.getBackgroundType(),
                hasBackground: !0,
                RGBMTexture0: null,
                encodeRGBM: null,
                doDistortionVR: this._model.get("doDistortionVR") && i.i(r.a)().vrStereo
            }
              , a = {
                uOutputLinear: m.Uniform.createInt(1, "uOutputLinear"),
                Texture0: e.inputTexture,
                TextureDepth: this._camera._textureDepth,
                uVrFadeFactor: this._uniforms.uVrFadeFactor
            };
            n.doDistortionVR && (a.uDistortion = this._uniforms.uDistortion,
            a.uProjectionLeft = this._uniforms.uProjectionLeft,
            a.uUnprojectionLeft = this._uniforms.uUnprojectionLeft),
            t.addPass(this.createFilter(n, a)).setFragmentName("AntiAliasVR")
        },
        updateEffectiveConfig: function() {
            var t = this._effectiveConfig
              , e = this._model.get("enable");
            t.useTransparency = s.a.get("hasTransparency") || this._model.get("webVR") || i.i(u.a)(),
            t.useSsao = e && this._model.isEffectiveSsao(),
            t.useDof = e && this._model.isEffectiveDof(),
            t.useBloom = e && this._model.isEffectiveBloom(),
            t.useGrain = e && this._model.isEffectiveGrain(),
            t.useSharpen = e && this._model.isEffectiveSharpen(),
            t.useChromaticAberration = e && this._model.isEffectiveChromaticAberration(),
            t.useToneMapping = e && this._model.isEffectiveToneMapping(),
            t.useColorBalance = e && this._model.isEffectiveColorBalance(),
            t.usePassMergeable = t.useChromaticAberration || t.useToneMapping || t.useColorBalance;
            var n = this.getBackgroundType();
            "fixed" !== n || t.usePassMergeable || t.useBloom || t.hasTransparency || (t.usePassMergeable = !0),
            t.useVignette = e && this._model.isEffectiveVignette();
            var r = t.usePassMergeable && ("environment" === n || "color" === n);
            return t.useVignetteMergeable = r && t.useVignette,
            t.useVignetteSuperSample = !r && t.useVignette,
            this._effectiveConfig
        },
        needDepthTexture: function() {
            if (i.i(u.a)())
                return !0;
            var t = this._effectiveConfig;
            if (t.useDof || t.useBloom || t.useSharpen || t.useSsao)
                return !0;
            if (this._viewer.getFeatures().hotspot.getModel().get("hotspots").length > 0)
                return !0;
            var e = this.getBackgroundType();
            return "none" === e || "fixed" === e || this._model.get("webVR")
        },
        needExtraTexture: function() {
            return s.a.get("hasExtra") || this._model.get("webVR")
        },
        orderFilteringRequirement: function() {
            var t = this._effectiveConfig
              , e = [];
            return t.useSsao && e.push(m.Texture.LINEAR),
            t.useTransparency && e.push(m.Texture.NEAREST),
            t.useDof && e.push(m.Texture.LINEAR),
            t.useBloom && e.push(m.Texture.NEAREST),
            t.usePassMergeable && e.push(m.Texture.NEAREST),
            e.push(m.Texture.LINEAR),
            e
        },
        updatePassConfig: function(t) {
            var e = t.formatPasses;
            t.outputFiltering = e[t.currentPass++],
            t.outputInSRGB = t.composeBackground = t.composeExtra = t.currentPass === e.length
        },
        createComposer: function() {
            var t = this.updateEffectiveConfig()
              , e = this.orderFilteringRequirement()
              , i = 1 === e.length
              , n = this._camera
              , r = n._textureOpaque = this.getOrCreateTextureOpaque(e[0]);
            n._textureExtra = this.needExtraTexture() ? this.getOrCreateTextureExtra() : void 0,
            n._textureTransparent = t.useTransparency ? this.getOrCreateTextureTransparent() : void 0,
            n._textureDepth = this.needDepthTexture() ? this.getOrCreateTextureDepth() : void 0;
            var a = new v.Composer;
            a.addPass(new v.Composer.Filter.InputTexture(r)).setFragmentName("InputTexture");
            var s = {
                currentPass: 1,
                formatPasses: e,
                outputFiltering: m.Texture.LINEAR,
                inputTexture: r,
                inputInSRGB: i,
                outputInSRGB: !0
            };
            return this._uniforms.uOutputLinear.setInt(i ? 0 : 1),
            this._uniforms.uRGBMRange.setFloat(i ? -1 : this._model.get("rgbmDefault")),
            this.onBackgroundColor(),
            i || (t.useSsao && (this.updatePassConfig(s),
            s.inputTexture = this.addSsao(a, s)),
            t.useTransparency && (this.updatePassConfig(s),
            s.inputTexture = this.addMergeOpacityPass(a, s)),
            t.useDof && (this.updatePassConfig(s),
            s.inputTexture = this.addDofPass(a, s)),
            t.useBloom && (this.updatePassConfig(s),
            s.inputTexture = this.addBloomPass(a, s)),
            t.usePassMergeable && (this.updatePassConfig(s),
            s.inputTexture = this.addMergeablePass(a, s))),
            this._model.get("webVR") ? this.addAntiAliasPassVR(a, s) : this.addSuperSamplePass(a),
            a.renderToScreen(this._viewerOSGJS.getCanvasWidth(), this._viewerOSGJS.getCanvasHeight()),
            a.build(),
            a
        },
        resetCameraAttachments: function() {
            var t = this._camera;
            t.resetAttachments(),
            t.frameBufferObjectOpaque && (t.frameBufferObjectOpaque.reset(),
            t.frameBufferObjectOpaque = void 0),
            t.frameBufferObjectTransparent && (t.frameBufferObjectTransparent.reset(),
            t.frameBufferObjectTransparent = void 0),
            t.frameBufferObjectDepth && (t.frameBufferObjectDepth.reset(),
            t.frameBufferObjectDepth = void 0),
            t.frameBufferObjectExtra && (t.frameBufferObjectExtra.reset(),
            t.frameBufferObjectExtra = void 0),
            t.attachRenderBuffer(m.FrameBufferObject.DEPTH_ATTACHMENT, m.FrameBufferObject.DEPTH_COMPONENT16)
        },
        createPathStandard: function() {
            var t = this.createComposer();
            if (t.setNodeMask(a.a.NO_PICK_NO_SHADOW),
            t.setName("PostProcess - Composer"),
            this.resetCameraAttachments(),
            2 === this.getChildren().length && this.removeChild(this.getChildren()[1]),
            this.addChild(t),
            i.i(r.a)().stats) {
                for (var e = !this._model.get("webVR"), n = l.a.getTimerGPU(), s = t.getChildren(), o = s.length, u = 0; u < o; ++u) {
                    var h = s[u]
                      , c = h.getName();
                    !e || u !== o - 3 && u !== o - 2 || (c = "Antialias"),
                    h.setInitialDrawCallback(n.start.bind(n, c)),
                    h.setFinalDrawCallback(n.end.bind(n, c))
                }
                s[o - 1].setRenderOrder(m.Camera.POST_RENDER, 0),
                this._camera.setFinalDrawCallback(function() {
                    n.start("PostProcess")
                });
                var d = this._viewerOSGJS.getCamera();
                d.setInitialDrawCallback(n.start.bind(n, "Total GL")),
                d.setFinalDrawCallback(function() {
                    n.end("PostProcess"),
                    n.end("Total GL")
                })
            }
        }
    }),
    e.a = b
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(1009)
      , a = i(1013)
      , s = {
        FeatureName: "postProcess",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getNodeIn = function() {
        return this._views[0]._nodeIn
    }
    ,
    o.prototype.getNodeOut = function() {
        return this._views[0]._nodeOut
    }
    ,
    o.prototype.getCamera = function() {
        return this._views[0]._camera
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(51)
      , a = i(146)
      , s = i(29)
      , o = i(43)
      , l = i(70)
      , u = i(421)
      , h = n.a.osg
      , c = n.a.osgUtil
      , d = !1
      , p = !1
      , f = function(t) {
        this._dirty = !0,
        this._view3d = t,
        this._uniforms = t._uniforms,
        this._effectiveConfig = t._effectiveConfig,
        this._viewer = t._viewer,
        this._viewerOSGJS = t._viewerOSGJS,
        this._model = t.model;
        var e = i.i(s.a)().dofTransition;
        this._interpolatorDofFocal = new c.DelayInterpolator(1,e ? .15 : 1),
        this._interpolatorDofBlurNear = new c.DelayInterpolator(1,e ? .15 : 1),
        this._interpolatorDofBlurFar = new c.DelayInterpolator(1,e ? .15 : 1),
        this._interpolatorDofCross = new c.DelayInterpolator(1,e ? .08 : 1),
        this._interpolatorDofCross._epsilon = -.01,
        this._dofInitialized = !1,
        this._dofAutoFocus = !1,
        this._tmpVec3 = h.vec3.create(),
        this._eyePos = h.vec3.create(),
        this._dofLastPos = h.vec3.create(),
        this._dofLastFocal = 0,
        this._lastUpdateTime = this._viewerOSGJS.getFrameStamp().getSimulationTime();
        var n = this.dirty.bind(this);
        u.a.bind("change:hasTransparency", n),
        u.a.bind("change:hasExtra", n),
        o.a.getMaterial().then(function() {
            var t = this.getBackgroundModel();
            t.bind("change:enable", n),
            t.bind("change:enableVR", n)
        }
        .bind(this)),
        this._hookViewerCheckNeedToDoFrame(),
        this._hookViewerFrame(),
        this._hookViewerUpdateViewport()
    };
    f.prototype = {
        dirty: function() {
            this._dirty = !0
        },
        getMainCamera: function() {
            return this._view3d._camera
        },
        getNodeIn: function() {
            return this._view3d._nodeIn
        },
        getBackgroundModel: function() {
            return this._viewer.getFeatures().background.getModel()
        },
        updateTargetDofBlurNear: function() {
            this._interpolatorDofBlurNear.setTarget(this._model.get("dofBlurNear"))
        },
        updateTargetDofBlurFar: function() {
            this._interpolatorDofBlurFar.setTarget(this._model.get("dofBlurFar"))
        },
        onEffectChanged: function() {
            return r.a.draw(),
            this.updateSizeUniforms(),
            this.updateDofScaleUniform(),
            this.getNodeIn().createPathStandard()
        },
        _hookViewerCheckNeedToDoFrame: function() {
            var t = this.getMainCamera()
              , e = this._viewerOSGJS
              , i = e.checkNeedToDoFrame.bind(e)
              , n = this._viewer.getSuperSample()
              , r = this._model;
            e.checkNeedToDoFrame = function() {
                var e = i()
                  , a = d;
                return d = !1,
                e || !a ? (n.setSwitch(!r.get("webVR")),
                t.setNodeMask(-1),
                e) : (n.setSwitch(!1),
                t.setNodeMask(0),
                !0)
            }
        },
        _hookViewerFrame: function() {
            var t = this.getMainCamera()
              , e = this._viewerOSGJS
              , i = this._viewer.getSuperSample()
              , n = e.frame.bind(e);
            e.frame = function() {
                n(),
                p && (n(),
                p = !1),
                t.setNodeMask(-1),
                this._hmd && this._hmd.isPresenting && this._hmd.capabilities.hasExternalDisplay && (i.setSwitch(!1),
                t.setNodeMask(0),
                this.getCamera().getRenderer().draw())
            }
        },
        _hookViewerUpdateViewport: function() {
            var t = this._viewerOSGJS
              , e = !0
              , n = -1
              , r = function() {
                e = !0
            }
              , a = function(t) {
                window.clearTimeout(n),
                e = !1,
                n = window.setTimeout(r, t)
            };
            this._viewer.on("freezeResize", a);
            var o = i.i(s.a)().resizeRate
              , l = t.updateViewport.bind(t);
            t.updateViewport = function() {
                return !!e && (e = 0 === o,
                n = window.setTimeout(r, o),
                l())
            }
        },
        showDofCross: function() {
            this._interpolatorDofCross.getCurrent()[0] = 1,
            this._interpolatorDofCross.setTarget(0),
            h.vec3.copy(this._dofLastPos, this._model.get("dofFocusPoint")),
            this._dofLastFocal = this._interpolatorDofFocal.getCurrent()[0],
            r.a.draw()
        },
        computeFocalDistance: function() {
            var t = h.vec4.create();
            return function() {
                var e = this._model.get("dofFocusPoint");
                h.vec3.copy(t, e)[3] = 1;
                var i = this._viewer.getCamera();
                h.vec4.transformMat4(t, t, i.getViewMatrix()),
                h.vec4.transformMat4(t, t, i.getProjectionMatrix());
                var n = this._uniforms.uNearFar.getInternalArray();
                return (t[3] - n[0]) / (n[1] - n[0])
            }
        }(),
        updateDofFocusPoint: function() {
            this._interpolatorDofFocal.setTarget(this.computeFocalDistance()),
            this.showDofCross(),
            this._dofAutoFocus = !1
        },
        updateSizeUniforms: function() {
            var t = this._uniforms.uRenderSize.getInternalArray();
            t[0] = this._viewerOSGJS.getCanvasWidth(),
            t[1] = this._viewerOSGJS.getCanvasHeight(),
            this._uniforms.uPixelRatio.setFloat(this._viewerOSGJS.getCanvasPixelRatio())
        },
        updateGrain: function(t) {
            if (this._effectiveConfig.useGrain && this._model.get("grainAnimated")) {
                d = !0;
                var e = t.getSimulationTime()
                  , n = i.i(s.a)().grainSpeed / 1e3;
                n > 0 && e - this._lastUpdateTime >= n && (this._uniforms.uTimeGrain.setFloat(e / 1e3),
                this._lastUpdateTime = e)
            }
        },
        dofPickFocusPoint: function() {
            if (!i.i(s.a)().dofSticky) {
                var t = this._viewer.getFeaturesManager()
                  , e = this._viewerOSGJS.getCanvasClientWidth()
                  , n = this._viewerOSGJS.getCanvasClientHeight()
                  , r = this._dofAutoFocus ? l.a.PICK_GEOMETRY_FIXED : l.a.PICK_GEOMETRY_SLOW
                  , a = t.computeNearestIntersection2D(.5 * e, .5 * n, r);
                if (!a) {
                    var o = this._uniforms.uDofCross.getInternalArray();
                    a = t.computeNearestIntersection2D(e * o[0], n * o[1], r)
                }
                a && t.getWorldPositionFromHit(a, this._model.get("dofFocusPoint")),
                this._interpolatorDofFocal.setTarget(this.computeFocalDistance())
            }
        },
        dofUpdateShowCross: function(t, e) {
            if (this._dofAutoFocus)
                this._interpolatorDofCross.getCurrent()[0] = 0;
            else {
                var i = h.vec3.dist(this._dofLastPos, this._model.get("dofFocusPoint"))
                  , n = this._interpolatorDofFocal.getCurrent()[0];
                i > .1 * t && Math.abs(n - this._dofLastFocal) > .075 && e > .1 && this.showDofCross()
            }
        },
        dofUpdateInterpolators: function(t, e) {
            this._interpolatorDofBlurNear.setTarget(this._model.get("dofBlurNear") * e),
            this._interpolatorDofBlurFar.setTarget(this._model.get("dofBlurFar") * e);
            var i = this._viewer.getFeaturesManager()
              , n = this._uniforms.uDofCross.getInternalArray();
            i.getScreenPositionFromWorldPoint(this._model.get("dofFocusPoint"), n),
            n[0] /= this._viewerOSGJS.getCanvasWidth(),
            n[1] /= this._viewerOSGJS.getCanvasHeight();
            var r = t.getDeltaTime();
            this._interpolatorDofBlurNear.update(r),
            this._interpolatorDofBlurFar.update(r),
            this._interpolatorDofFocal.update(r),
            this._interpolatorDofCross.update(r);
            var a = this._uniforms.uDofBlurNearFarFocal.getInternalArray();
            a[0] = this._interpolatorDofBlurNear.getCurrent()[0],
            a[1] = this._interpolatorDofBlurFar.getCurrent()[0],
            a[2] = this._interpolatorDofFocal.getCurrent()[0],
            a[3] = this._model.get("dofQuality") ? 1 : 0,
            this._uniforms.uDofCross.getInternalArray()[2] = this._interpolatorDofCross.getCurrent()[0],
            this._interpolatorDofCross.isDone() || (d = !0)
        },
        updateDof: function(t) {
            if (this._model.isEffectiveDof()) {
                var e = this._uniforms.uNearFar.getInternalArray();
                if (!(e[0] > e[1])) {
                    var n = this._viewerOSGJS.getManipulator();
                    n.getEyePosition(this._tmpVec3);
                    var r = n.getHomeBound()
                      , a = r.radius()
                      , l = h.vec3.dist(this._eyePos, this._tmpVec3) / a
                      , u = l >= .01 && i.i(s.a)().dofAttenuateSpeed ? 0 : 1
                      , c = n.getHomeDistance(n.getHomeBound());
                    if (i.i(s.a)().dofAttenuateDistance) {
                        var d = (h.vec3.dist(r.center(), this._tmpVec3) - a) / (c - a);
                        u *= Math.max(0, Math.min(1, 1 - d))
                    }
                    this._dofInitialized ? this._dofAutoFocus || l > .01 ? (h.vec3.copy(this._eyePos, this._tmpVec3),
                    this._dofAutoFocus = l > 1e-5,
                    this.dofPickFocusPoint(),
                    this.dofUpdateShowCross(a, u)) : this._interpolatorDofFocal.setTarget(this.computeFocalDistance()) : (h.vec3.copy(this._eyePos, this._tmpVec3),
                    this._interpolatorDofFocal.setTarget(this.computeFocalDistance()),
                    o.a.getFirstCameraAnimation().isFulfilled() && (this._dofInitialized = !0)),
                    this.dofUpdateInterpolators(t, u)
                }
            }
        },
        getNewSize: function(t, e) {
            return Math.max(1, Math.round(e / t))
        },
        updateDofScaleUniform: function() {
            var t = i.i(s.a)().dofRes || 2 * this._viewerOSGJS.getCanvasPixelRatio();
            this._uniforms.uDofScale.getInternalArray()[0] = .0015 * this._viewerOSGJS._canvasHeight / t
        },
        resizePostProcess: function(t, e, i, n) {
            for (var a = this.getNodeIn().getChildren()[1], s = a.getChildren(), o = 0, l = s.length; o < l; ++o) {
                var u = s[o]
                  , c = 1;
                u.isRenderToTextureCamera() && ((c = u.getAttachments()[h.FrameBufferObject.COLOR_ATTACHMENT0].texture.divisor) || (h.warn("missing divisor for texture, the rtt texture wasn't created by the postprocess feature!"),
                c = 1));
                var d = this.getNewSize(c, i)
                  , p = this.getNewSize(c, n)
                  , f = u.getStateSet()
                  , g = f.getUniform("RenderSize");
                if (g) {
                    var m = g.getInternalArray();
                    m[0] = d,
                    m[1] = p
                }
                var v = u.getViewport();
                v && v.setViewport(0, 0, d, p);
                for (var _ = 0; _ < f.getNumTextureAttributeLists(); _++) {
                    var b = f.getTextureAttribute(_, "Texture");
                    b && (b.divisor || h.warn("missing divisor for texture, the rtt texture wasn't created by the postprocess feature!"),
                    b.divisor > 0 && b.setTextureSize(this.getNewSize(b.divisor, i), this.getNewSize(b.divisor, n)))
                }
            }
            this.updateSizeUniforms(),
            this.updateDofScaleUniform(),
            r.a.draw(),
            this.getNodeIn().resetCameraAttachments()
        },
        updateDirtyEffect: function() {
            var t = this._viewerOSGJS.getCanvasWidth()
              , e = this._viewerOSGJS.getCanvasHeight();
            if (this._width && this._height || (this._width = this._height = -1),
            t !== this._width || e !== this._height) {
                this._dirty || this.resizePostProcess(this._width, this._height, t, e);
                var i = this.getMainCamera();
                i._textureOpaque && i._textureOpaque.setTextureSize(t, e),
                i._textureTransparent && i._textureTransparent.setTextureSize(t, e),
                i._textureDepth && i._textureDepth.setTextureSize(t, e),
                i._textureExtra && i._textureExtra.setTextureSize(t, e),
                this._width = t,
                this._height = e,
                this._dirty || (p = !0)
            }
            this._dirty && (this.onEffectChanged(),
            this._dirty = !1)
        },
        updateFade: function(t) {
            var e = this._model.get("vrFading");
            if (this._model.get("vrStartFade") && !e && (this._model.set("vrStartFade", !1),
            e = !0,
            this._model.set("vrFading", !0),
            this._model.set("vrFadeStartTime", t.getSimulationTime())),
            e) {
                var i = this._model.get("vrFadeStartTime")
                  , n = this._model.get("vrFadeLength")
                  , r = t.getSimulationTime()
                  , a = (r - i) / n
                  , s = this._model.get("vrFadeCallback");
                r > i + n && (a = 1 - (a - 1),
                s && (s(),
                this._model.set("vrFadeCallback", void 0)));
                var o = this._uniforms.uVrFadeFactor.getInternalArray();
                a >= 0 ? o[0] = a : (o[0] = 0,
                this._model.set("vrFading", !1))
            }
        },
        updateVeil: function() {
            this._uniforms.uVrVeilFactor.getInternalArray()[0] = this._model.get("veilFactor")
        },
        updateSsao: function() {
            if (this._model.isEffectiveSsao()) {
                var t = this._uniforms.uNearFar.getInternalArray();
                if (!(t[0] > t[1])) {
                    var e = this._viewer.getCamera().getProjectionMatrix()
                      , i = 1 === e[15] ? 1 : 2 / e[5]
                      , n = -2 * Math.tan(.5 * i);
                    this._uniforms.uSsaoProjectionScale.setFloat(this._height / n);
                    var r = this._uniforms.uSsaoProjectionInfo.getInternalArray();
                    r[0] = -2 / (this._viewerOSGJS.getCanvasWidth() * e[0]),
                    r[1] = -2 / (this._viewerOSGJS.getCanvasHeight() * e[5]),
                    r[2] = (1 - e[8]) / e[0],
                    r[3] = (1 - e[9]) / e[5]
                }
            }
        },
        updateNearFarRatio: function() {
            var t;
            if (this._model.get("webVR")) {
                var e = this._viewer.getFeatures().webVR.getModel()
                  , i = e.get("worldFactor") / a.a.getModelBoxWithDisplacement().radius();
                t = i > 0 ? .005 * Math.max(.1, i) : .005
            } else
                t = this._viewer.getFeatures().fov.getModel().get("nearFarRatio");
            this.getMainCamera().setNearFarRatio(t)
        },
        update: function(t, e) {
            var i = e.getFrameStamp();
            return this._viewer.getSuperSample().isEnabled() && this._uniforms.uTime.setFloat(i.getSimulationTime() / 1e3),
            this.updateNearFarRatio(),
            this.updateSsao(i),
            this.updateGrain(i),
            this.updateDof(i),
            this.updateFade(i),
            this.updateVeil(i),
            this.updateDirtyEffect(),
            !0
        }
    },
    e.a = f
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(6)
      , a = i(138)
      , s = i(51)
      , o = i(1010)
      , l = i(1012)
      , u = i(814)
      , h = i.n(u)
      , c = i(810)
      , d = i.n(c)
      , p = i(811)
      , f = i.n(p)
      , g = i(813)
      , m = i.n(g)
      , v = i(812)
      , _ = i.n(v)
      , b = i(815)
      , x = i.n(b)
      , y = n.a.osg
      , S = a.a.getShaderProcessor()
      , w = r.a.extend({
        initialize: function() {
            r.a.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:webVR", this.onVR, this),
            t.bind("change:distortVR", this.dirty, this),
            t.bind("change:enable", this.dirty, this),
            t.bind("change:grainEnable", this.checkGrainEnable, this),
            t.bind("change:sharpenEnable", this.checkSharpenEnable, this),
            t.bind("change:chromaticAberrationEnable", this.checkChromaticAberrationEnable, this),
            t.bind("change:vignetteEnable", this.checkVignetteEnable, this),
            t.bind("change:bloomEnable", this.checkBloomEnable, this),
            t.bind("change:dofEnable", this.checkDofEnable, this),
            t.bind("change:toneMappingEnable", this.dirty, this),
            t.bind("change:colorBalanceEnable", this.dirty, this),
            t.bind("change:ssaoEnable", this.dirty, this),
            t.bind("change:distortion", this.onDistortionChanged, this),
            t.bind("change:projectionLeft", this.onProjectionLeftChanged, this),
            t.bind("change:unprojectionLeft", this.onUnprojectionLeftChanged, this),
            t.bind("change:grainFactor", this.onGrainFactor, this),
            t.bind("change:sharpenFactor", this.onSharpenFactor, this),
            t.bind("change:chromaticAberrationFactor", this.onChromaticAberrationFactor, this),
            t.bind("change:vignetteLens", this.onVignetteLensChanged, this),
            t.bind("change:bloomFactor", this.onBloomFactorChanged, this),
            t.bind("change:bloomThreshold", this.onBloomThresholdChanged, this),
            t.bind("change:bloomRadius", this.onBloomRadiusChanged, this),
            t.bind("change:toneMappingExposure", this.onToneMappingExposureChanged, this),
            t.bind("change:toneMappingBrightness", this.onToneMappingBrightnessChanged, this),
            t.bind("change:toneMappingContrast", this.onToneMappingContrastChanged, this),
            t.bind("change:toneMappingSaturation", this.onToneMappingSaturationChanged, this),
            t.bind("change:toneMappingMethod", this.onToneMappingMethodChanged, this),
            t.bind("change:colorBalanceLow", this.onColorBalanceShiftChanged, this),
            t.bind("change:colorBalanceMid", this.onColorBalanceShiftChanged, this),
            t.bind("change:colorBalanceHigh", this.onColorBalanceShiftChanged, this),
            t.bind("change:dofFocusPoint", this.onDofFocusPoint, this),
            t.bind("change:dofBlurNear", this.onDofBlurNear, this),
            t.bind("change:dofBlurFar", this.onDofBlurFar, this),
            t.bind("change:ssaoIntensity", this.onSsaoIntensity, this),
            t.bind("change:ssaoRadius", this.onSsaoRadius, this),
            t.bind("change:ssaoBias", this.onSsaoBias, this),
            t.bind("change", s.a.draw),
            this.addShaders(),
            this._effectiveConfig = {},
            this._viewer = this.model._viewer,
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._uniforms = this.createUniforms(),
            this._camera = this.createMainCamera(),
            this._nodeIn = new o.a(this),
            this._nodeOut = this.createNodeOut(),
            this._nodeIn.addChild(this._camera),
            this._camera.addChild(this._nodeOut),
            this._updatePostProcess = new l.a(this),
            this._nodeIn.addUpdateCallback(this._updatePostProcess)
        },
        dirty: function() {
            this._updatePostProcess.dirty()
        },
        addShaders: function() {
            var t = {
                "postProcess.glsl": h.a,
                "postProcess-antiAlias.glsl": d.a,
                "postProcess-distortion.glsl": f.a,
                "postProcess-pingpong.frag": m.a,
                "dof.glsl": _.a,
                "ssao.glsl": x.a
            };
            S.addShaders(t)
        },
        createNodeOut: function() {
            var t = new y.Node;
            return t.setName("PostProcess - node Out"),
            t
        },
        createMainCamera: function() {
            var t = new y.Camera;
            return t.setName("PostProcess - MainCamera"),
            t.setRenderOrder(y.Camera.PRE_RENDER, 0),
            t.getOrCreateStateSet().addUniform(this._uniforms.uRenderSize),
            t.attachRenderBuffer(y.FrameBufferObject.DEPTH_ATTACHMENT, y.FrameBufferObject.DEPTH_COMPONENT16),
            t
        },
        createUniforms: function() {
            var t = this.model
              , e = this._viewerOSGJS.getFrameStamp().getSimulationTime();
            return {
                uDistortion: y.Uniform.createFloat2(t.get("distortion"), "uDistortion"),
                uProjectionLeft: y.Uniform.createFloat4(t.get("projectionLeft"), "uProjectionLeft"),
                uUnprojectionLeft: y.Uniform.createFloat4(t.get("unprojectionLeft"), "uUnprojectionLeft"),
                uTimeGrain: y.Uniform.createFloat(e, "uTimeGrain"),
                uGrainFactor: y.Uniform.createFloat(t.get("grainFactor"), "uGrainFactor"),
                uSharpFactor: y.Uniform.createFloat(t.get("sharpenFactor"), "uSharpFactor"),
                uChromaFactor: y.Uniform.createFloat(t.get("chromaticAberrationFactor"), "uChromaFactor"),
                uLensRadius: y.Uniform.createFloat2(t.get("vignetteLens"), "uLensRadius"),
                uBloomFactor: y.Uniform.createFloat(t.get("bloomFactor"), "uBloomFactor"),
                uBloomThreshold: y.Uniform.createFloat(t.get("bloomThreshold"), "uBloomThreshold"),
                uBloomRadius: y.Uniform.createFloat(t.get("bloomRadius"), "uBloomRadius"),
                uToneExposure: y.Uniform.createFloat(t.get("toneMappingExposure"), "uToneExposure"),
                uToneBrightness: y.Uniform.createFloat(t.get("toneMappingBrightness"), "uToneBrightness"),
                uToneContrast: y.Uniform.createFloat(t.get("toneMappingContrast"), "uToneContrast"),
                uToneSaturation: y.Uniform.createFloat(t.get("toneMappingSaturation"), "uToneSaturation"),
                uToneMethod: y.Uniform.createInt(this.methodToInt(t.get("toneMappingMethod")), "uToneMethod"),
                uColorBalanceLow: y.Uniform.createFloat3(t.get("colorBalanceLow"), "uColorBalanceLow"),
                uColorBalanceMid: y.Uniform.createFloat3(t.get("colorBalanceMid"), "uColorBalanceMid"),
                uColorBalanceHigh: y.Uniform.createFloat3(t.get("colorBalanceHigh"), "uColorBalanceHigh"),
                uDofBlurNearFarFocal: y.Uniform.createFloat4(y.vec4.fromValues(t.get("dofBlurNear"), t.get("dofBlurFar"), .5, 0), "uDofBlurNearFarFocal"),
                uDofCross: y.Uniform.createFloat3(y.vec3.create(), "uDofCross"),
                uDofScale: y.Uniform.createFloat(1, "uDofScale"),
                uSsaoRadius: y.Uniform.createFloat(t.get("ssaoRadius"), "uSsaoRadius"),
                uSsaoIntensity: y.Uniform.createFloat(t.get("ssaoIntensity"), "uSsaoIntensity"),
                uSsaoBias: y.Uniform.createFloat(t.get("ssaoBias"), "uSsaoBias"),
                uSsaoProjectionInfo: y.Uniform.createFloat4(y.vec4.create(), "uSsaoProjectionInfo"),
                uSsaoProjectionScale: y.Uniform.createFloat(1, "uSsaoProjectionScale"),
                uVrFadeFactor: y.Uniform.createFloat(0, "uVrFadeFactor"),
                uVrVeilFactor: y.Uniform.createFloat(1, "uVrVeilFactor"),
                uNearFar: this._viewer.getCamera().getRenderer().getCullVisitor().getNearFarUniform(),
                uRenderSize: y.Uniform.createFloat2(y.vec2.create(), "RenderSize"),
                uOutputLinear: y.Uniform.createInt(1, "uOutputLinear"),
                uRGBMRange: y.Uniform.createFloat(t.get("rgbmDefault"), "uRGBMRange"),
                uPixelRatio: y.Uniform.createFloat(1, "uPixelRatio"),
                uTime: y.Uniform.createFloat(e, "uTime")
            }
        },
        methodToInt: function(t) {
            return "reinhard" === t ? 1 : "filmic" === t ? 2 : 0
        },
        onVR: function() {
            var t = this.model.get("webVR")
              , e = this._viewer.getSuperSample();
            e.setSwitch(!t),
            e.reset(),
            e.setCanBeEnabled(!t),
            this.dirty()
        },
        checkGrainEnable: function() {
            this._effectiveConfig.useGrain !== this.model.isEffectiveGrain() && this.dirty()
        },
        checkSharpenEnable: function() {
            this._effectiveConfig.useSharpen !== this.model.isEffectiveSharpen() && this.dirty()
        },
        checkChromaticAberrationEnable: function() {
            this._effectiveConfig.useChromaticAberration !== this.model.isEffectiveChromaticAberration() && this.dirty()
        },
        checkVignetteEnable: function() {
            this._effectiveConfig.useVignette !== this.model.isEffectiveVignette() && this.dirty()
        },
        checkBloomEnable: function() {
            this._effectiveConfig.useBloom !== this.model.isEffectiveBloom() && this.dirty()
        },
        checkDofEnable: function() {
            this._effectiveConfig.useDof !== this.model.isEffectiveDof() && this.dirty()
        },
        checkSsaoEnable: function() {
            this._effectiveConfig.useSsao !== this.model.isEffectiveSsao() && this.dirty()
        },
        onDistortionChanged: function() {
            this._uniforms.uDistortion.setFloat2(this.model.get("distortion"))
        },
        onProjectionLeftChanged: function() {
            this._uniforms.uProjectionLeft.setFloat4(this.model.get("projectionLeft"))
        },
        onUnprojectionLeftChanged: function() {
            this._uniforms.uUnprojectionLeft.setFloat4(this.model.get("unprojectionLeft"))
        },
        onGrainFactor: function() {
            this._uniforms.uGrainFactor.setFloat(this.model.get("grainFactor")),
            this.checkGrainEnable()
        },
        onSharpenFactor: function() {
            this._uniforms.uSharpFactor.setFloat(this.model.get("sharpenFactor")),
            this.checkSharpenEnable()
        },
        onChromaticAberrationFactor: function() {
            this._uniforms.uChromaFactor.setFloat(this.model.get("chromaticAberrationFactor")),
            this.checkChromaticAberrationEnable()
        },
        onVignetteLensChanged: function() {
            this._uniforms.uLensRadius.setFloat2(this.model.get("vignetteLens")),
            this.checkVignetteEnable()
        },
        onBloomFactorChanged: function() {
            this._uniforms.uBloomFactor.setFloat(this.model.get("bloomFactor")),
            this.checkBloomEnable()
        },
        onBloomThresholdChanged: function() {
            this._uniforms.uBloomThreshold.setFloat(this.model.get("bloomThreshold")),
            this.checkBloomEnable()
        },
        onBloomRadiusChanged: function() {
            this._uniforms.uBloomRadius.setFloat(this.model.get("bloomRadius")),
            this.checkBloomEnable()
        },
        onColorBalanceShiftChanged: function() {
            this._uniforms.uColorBalanceLow.setFloat3(this.model.get("colorBalanceLow")),
            this._uniforms.uColorBalanceMid.setFloat3(this.model.get("colorBalanceMid")),
            this._uniforms.uColorBalanceHigh.setFloat3(this.model.get("colorBalanceHigh"))
        },
        onToneMappingExposureChanged: function() {
            this._uniforms.uToneExposure.setFloat(this.model.get("toneMappingExposure"))
        },
        onToneMappingBrightnessChanged: function() {
            this._uniforms.uToneBrightness.setFloat(this.model.get("toneMappingBrightness"))
        },
        onToneMappingContrastChanged: function() {
            this._uniforms.uToneContrast.setFloat(this.model.get("toneMappingContrast"))
        },
        onToneMappingSaturationChanged: function() {
            this._uniforms.uToneSaturation.setFloat(this.model.get("toneMappingSaturation"))
        },
        onToneMappingMethodChanged: function() {
            this._uniforms.uToneMethod.setInt(this.methodToInt(this.model.get("toneMappingMethod")))
        },
        onDofFocusPoint: function() {
            this._updatePostProcess.updateDofFocusPoint()
        },
        onDofBlurNear: function() {
            this._updatePostProcess.updateTargetDofBlurNear(),
            this.checkDofEnable()
        },
        onDofBlurFar: function() {
            this._updatePostProcess.updateTargetDofBlurFar(),
            this.checkDofEnable()
        },
        onSsaoRadius: function() {
            this._uniforms.uSsaoRadius.setFloat(this.model.get("ssaoRadius")),
            this.checkSsaoEnable()
        },
        onSsaoIntensity: function() {
            this._uniforms.uSsaoIntensity.setFloat(this.model.get("ssaoIntensity")),
            this.checkSsaoEnable()
        },
        onSsaoBias: function() {
            this._uniforms.uSsaoBias.setFloat(this.model.get("ssaoBias"))
        }
    });
    e.a = w
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(383)
      , a = i(1015)
      , s = n.a.osg;
    n.a.osgShader.nodeFactory.registerNodes(a.a);
    var o = function() {
        r.a.apply(this, arguments),
        this.config = {}
    };
    o.prototype = s.objectInherit(r.a.prototype, {
        getFragmentShaderName: function() {
            return ""
        },
        setPostProcessConfiguration: function(t) {
            this.config = t,
            this._customVertexShader = !0
        },
        createFragmentShaderGraph: function() {
            var t = this.config
              , e = [];
            return t.isPassMergeable ? this.createFragmentMergeable(e) : t.isPassMergeOpacity ? this.createMergeOpacity(e) : t.isPassDepthMipmap ? this.createDepthMipmap(e) : t.isPassDofDownsampleCoC ? this.createFragmentDofDownsampleCoC(e) : t.isPassDofDownsampleColor ? this.createFragmentDofDownsampleColor(e) : t.isPassDofDilateNearH || t.isPassDofDilateNearV ? this.createFragmentDofDilateNear(e) : t.isPassDofBlurCircular ? this.createFragmentDofBlurCircular(e) : t.isPassDofCombine ? this.createFragmentDofCombine(e) : t.isPassSsaoExtract ? this.createFragmentSsaoExtract(e) : t.isPassSsaoBlurV || t.isPassSsaoBlurH ? this.createFragmentSsaoBlur(e) : t.isPassBright ? this.createFragmentBright(e) : t.isPassAdditive ? this.createFragmentAdditive(e) : t.isPassSuperSample ? this.createFragmentSuperSample(e) : t.isPassFinalPassVR ? this.createFragmentAntiAliasVR(e) : e
        },
        getFetch0x0y0: function() {
            return this._fetch0x0y0 ? this._fetch0x0y0 : (this._fetch0x0y0 = this.textureFetch(this.getOrCreateSampler("sampler2D", "Texture0"), this.getUv()),
            this._fetch0x0y0)
        },
        getUv: function() {
            return this.config.doDistortionVR ? this.getOrCreateDistortion() : this.getOrCreateVarying("vec2", "vTexCoord0")
        },
        createFragmentAntiAliasVR: function(t) {
            var e = this.config.useAntiAlias ? this.createAntiAlias() : this.getFetch0x0y0()
              , i = "none" === this.config.background ? this.getOrCreateAlpha() : this.createVariable("float").setValue("1.0");
            return e = this.createFade(e),
            t.push(this.getFragColor(e, i)),
            t
        },
        createFade: function(t) {
            var e = this.createVariable(t.getType());
            return this.getNode("InlineCode").code("%outColor = mix( %inColor, %black, clamp(%fadeFactor, 0.0, 1.0) );").inputs({
                inColor: t,
                fadeFactor: this.getOrCreateUniform("float", "uVrFadeFactor"),
                black: this.getOrCreateConstantZero(t.getType())
            }).outputs({
                outColor: e
            }),
            e
        },
        createMergeOpacity: function(t) {
            var e = this.createVariable("vec3")
              , i = this.textureFetch(this.getOrCreateSampler("sampler2D", "TextureTransparent"), this.getUv());
            return this.getNode("InlineCode").code("%outcolor = %opaque.rgb * (1.0 - %transparent.a) + %transparent.rgb;").inputs({
                opaque: this.getFetch0x0y0(),
                transparent: i
            }).outputs({
                outcolor: e
            }),
            t.push(this.getFragColor(e)),
            t
        },
        createDepthMipmap: function(t) {
            var e = this.getNode("glFragColor")
              , i = ["float depth = dot(%depthPacked.rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));", "%frag.rgb = vec3(1.0, 255.0, 65025.0) * depth;", "%frag.gb = fract(%frag.gb);", "%frag.rg -= %frag.gb * (1.0/256.0);"].join("\n");
            return this.getNode("InlineCode").code(i).inputs({
                depthPacked: this.getFetch0x0y0()
            }).outputs({
                frag: e
            }),
            t.push(e),
            t
        },
        createFragmentSuperSample: function(t) {
            var e = this.config
              , i = e.useAntiAlias ? this.createAntiAlias() : this.getFetch0x0y0();
            e.useSharpen && (i = this.createSharpen(i));
            var n = "none" === e.background ? this.getOrCreateAlpha() : this.createVariable("float").setValue("1.0");
            return e.useVignetteSuperSample && (n = i = this.createVignette(i, n)),
            e.useTextureExtra && (i = n = this.createComposeExtra(i, n)),
            i = this.createSuperSample(i),
            t.push(this.getFragColor(i, n)),
            t
        },
        createFragmentDofDownsampleCoC: function(t) {
            var e = this.getNode("glFragColor");
            return this.getNode("DofDownsampleCoC").inputs({
                samplerDepth: this.getOrCreateSampler("sampler2D", "TextureDepth"),
                uv: this.getUv(),
                dofBlurNearFarFocal: this.getOrCreateUniform("vec4", "uDofBlurNearFarFocal")
            }).outputs({
                color: e
            }),
            t.push(e),
            t
        },
        createFragmentDofDownsampleColor: function(t) {
            var e = this.getNode("glFragColor");
            return this.getNode("DofDownsampleColor").inputs({
                samplerColor: this.getOrCreateSampler("sampler2D", "TextureColor"),
                samplerCoC: this.config.colorWithCoC ? this.getOrCreateSampler("sampler2D", "TextureCoC") : void 0,
                uv: this.getUv()
            }).outputs({
                color: e
            }),
            t.push(e),
            t
        },
        createFragmentDofDilateNear: function(t) {
            var e = this.getNode("glFragColor");
            return this.getNode("DofDilateNear").setVertical(!!this.config.isPassDofDilateNearV).inputs({
                samplerCoC: this.getOrCreateSampler("sampler2D", "TextureCoC"),
                samplerDepth: this.getOrCreateSampler("sampler2D", "TextureDepth"),
                uv: this.getUv(),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                dofScale: this.getOrCreateUniform("float", "uDofScale"),
                dofBlurNearFarFocal: this.getOrCreateUniform("vec4", "uDofBlurNearFarFocal")
            }).outputs({
                color: e
            }),
            t.push(e),
            t
        },
        createFragmentDofBlurCircular: function(t) {
            var e = this.getNode("glFragColor");
            return this.getNode("DofBlurCircular").inputs({
                samplerColor: this.getOrCreateSampler("sampler2D", "TextureColor"),
                samplerCoC: this.getOrCreateSampler("sampler2D", this.config.colorWithCoC ? "TextureColor" : "TextureCoC"),
                uv: this.getUv(),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                time: this.getOrCreateUniform("float", "uTime"),
                dofScale: this.getOrCreateUniform("float", "uDofScale"),
                dofBlurNearFarFocal: this.getOrCreateUniform("vec4", "uDofBlurNearFarFocal")
            }).outputs({
                color: e
            }),
            t.push(e),
            t
        },
        createFragmentDofCombine: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("DofCombine").inputs({
                color: this.getFetch0x0y0(),
                samplerBlur: this.getOrCreateSampler("sampler2D", "TextureBlurred"),
                samplerCoC: this.getOrCreateSampler("sampler2D", "TextureCoCDilated"),
                samplerDepth: this.getOrCreateSampler("sampler2D", "TextureDepth"),
                range: this.getOrCreateUniform("float", "uRGBMRange"),
                uv: this.getUv(),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                dofScale: this.getOrCreateUniform("float", "uDofScale"),
                dofBlurNearFarFocal: this.getOrCreateUniform("vec4", "uDofBlurNearFarFocal"),
                blurDiv: this.getOrCreateUniform("float", "uBlurDiv")
            }).outputs({
                color: e
            }),
            t.push(this.getFragColor(e)),
            t
        },
        createFragmentSsaoExtract: function(t) {
            var e = this.getNode("glFragColor");
            return this.getNode("SsaoExtract").inputs({
                samplerDepth: this.getOrCreateSampler("sampler2D", "TextureDepth"),
                samplerDepth1: this.getOrCreateSampler("sampler2D", "TextureDepth1"),
                samplerDepth2: this.getOrCreateSampler("sampler2D", "TextureDepth2"),
                samplerDepth3: this.getOrCreateSampler("sampler2D", "TextureDepth3"),
                samplerDepth4: this.getOrCreateSampler("sampler2D", "TextureDepth4"),
                samplerDepth5: this.getOrCreateSampler("sampler2D", "TextureDepth5"),
                uv: this.getUv(),
                nearFar: this.getOrCreateUniform("vec2", "uNearFar"),
                radius: this.getOrCreateUniform("float", "uSsaoRadius"),
                intensity: this.getOrCreateUniform("float", "uSsaoIntensity"),
                bias: this.getOrCreateUniform("float", "uSsaoBias"),
                projectionInfo: this.getOrCreateUniform("vec4", "uSsaoProjectionInfo"),
                projectionScale: this.getOrCreateUniform("float", "uSsaoProjectionScale"),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                time: this.getOrCreateUniform("float", "uTime")
            }).outputs({
                color: e
            }),
            t.push(e),
            t
        },
        createFragmentSsaoBlur: function(t) {
            var e = this.config.isPassSsaoBlurV ? this.createVariable("vec3") : this.getNode("glFragColor");
            return this.getNode("SsaoBlur").setVertical(!!this.config.isPassSsaoBlurV).inputs({
                samplerSsao: this.getOrCreateSampler("sampler2D", "TextureSsao"),
                color: this.config.isPassSsaoBlurV ? this.getFetch0x0y0() : void 0,
                uv: this.getUv(),
                nearFar: this.getOrCreateUniform("vec2", "uNearFar"),
                texSize: this.getOrCreateUniform("vec2", "RenderSize")
            }).outputs({
                color: e
            }),
            this.config.isPassSsaoBlurV ? t.push(this.getFragColor(e)) : t.push(e),
            t
        },
        createFragmentBright: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("ExtractBright").inputs({
                color: this.getFetch0x0y0(),
                threshold: this.getOrCreateUniform("float", "uBloomThreshold"),
                alpha: this.config.testDepthBloom ? this.getOrCreateAlpha() : void 0
            }).outputs({
                color: e
            }),
            t.push(this.getFragColor(e)),
            t
        },
        getFactoredTex: function(t, e, i) {
            var n = this.textureFetch(this.getOrCreateSampler("sampler2D", "Texture" + t), e)
              , r = this.createVariable("vec4");
            return this.getNode("Mult").inputs(n, i || this.createVariable("float").setValue("1.0")).outputs(r),
            r
        },
        getRadiusFactored: function(t, e) {
            var i = this.createVariable("float").setValue(t.toExponential())
              , n = this.createVariable("float").setValue((2 * e - t).toExponential())
              , r = this.createVariable("float");
            return this.getNode("Blend").mode("MIX").inputs(i, n, this.getOrCreateUniform("float", "uBloomRadius")).outputs(r),
            r
        },
        createFragmentAdditive: function(t) {
            var e = this.getUv()
              , i = this.config.isOnMobile
              , n = []
              , r = i ? 1 : .6;
            i || n.push(this.getFactoredTex(1, e, this.getRadiusFactored(1.1, r))),
            n.push(this.getFactoredTex(2, e, this.getRadiusFactored(i ? 1.5 : .9, r))),
            n.push(this.getFactoredTex(3, e, this.getRadiusFactored(i ? 1 : .6, r))),
            n.push(this.getFactoredTex(4, e, this.getRadiusFactored(i ? .5 : .3, r))),
            i || n.push(this.getFactoredTex(5, e, this.getRadiusFactored(.1, r)));
            var a = this.createVariable("vec4");
            this.getNode("Add").inputs(n).outputs(a);
            var s = this.createVariable("vec4");
            return this.getNode("Blend").mode("ADD").inputs(this.getFetch0x0y0(), a, this.getOrCreateUniform("float", "uBloomFactor")).outputs(s),
            t.push(this.getFragColor(s)),
            t
        },
        createFragmentMergeable: function(t) {
            var e, i = this.config;
            return i.useChromaticAberration ? e = this.createChromaticAberration() : (e = this.createVariable("vec3"),
            this.getNode("SetFromNode").inputs(this.getFetch0x0y0()).outputs(e)),
            i.useVignetteMergeable && (e = this.createVignette(e)),
            i.useColorBalance && (e = this.createColorBalance(e)),
            i.useToneMapping && (e = this.createToneMapping(e)),
            t.push(this.getFragColor(e)),
            t
        },
        createVeil: function(t) {
            var e = this.createVariable(t.getType());
            return this.getNode("Mult").inputs(t, this.getOrCreateUniform("float", "uVrVeilFactor")).outputs(e),
            e
        },
        createVeilAndComposeExtra: function(t) {
            if (this.config.useVeil && (t = this.createVeil(t)),
            this.config.composeExtra) {
                var e = "none" === this.config.background ? this.getOrCreateAlpha() : this.createVariable("float").setValue("1.0");
                t = this.createComposeExtra(t, e)
            }
            return t
        },
        getFragColor: function(t, e) {
            var i = this.getNode("glFragColor");
            t = this.createVeilAndComposeExtra(t),
            this.config.useComposeBackground && (t = this.createComposeBackgroundFixed(t, this.getOrCreateAlpha()));
            var n = this.getSrgbColor(t);
            return this.config.encodeRGBM ? this.getNode("EncodeRGBM").inputs({
                color: n,
                range: this.createVariable("float").setValue(this.config.encodeRGBM.toExponential())
            }).outputs({
                color: i
            }) : this.getNode("SetAlpha").inputs({
                color: n,
                alpha: e || this.getFetch0x0y0()
            }).outputs({
                color: i
            }),
            i
        },
        createSuperSample: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("SuperSample").inputs({
                color: t,
                sampler: this.getOrCreateSampler("sampler2D", "Texture1"),
                uv: this.getUv(),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                halton: this.getOrCreateUniform("vec4", "uHalton")
            }).outputs({
                color: e
            }),
            e
        },
        createComposeExtra: function(t, e) {
            var i = this.textureFetch(this.getOrCreateSampler("sampler2D", "TextureExtra"), this.getUv());
            return this.config.linearize && this.getNode("sRGBToLinear").inputs({
                color: i
            }).outputs({
                color: i
            }),
            this.getNode("ComposeExtra").inputs({
                color: t,
                alpha: e,
                extra: i
            }).outputs({
                color: i
            }),
            i
        },
        createComposeBackgroundColor: function(t, e, i) {
            var n = this.createVariable("vec3");
            return this.getNode("ComposeBackgroundColor").inputs({
                color: t,
                backgroundColor: i || this.getOrCreateUniform("vec3", "uBackgroundColor"),
                alpha: e
            }).outputs({
                color: n
            }),
            n
        },
        createComposeBackgroundFixed: function(t, e) {
            var i = this.createVariable("vec3");
            this.getNode("InlineCode").code("%color = texture2D(%tex, (%uv - 0.5) * %scale + 0.5).rgb;").inputs({
                tex: this.getOrCreateSampler("sampler2D", "TextureFixed"),
                uv: this.getUv(),
                scale: this.getOrCreateUniform("vec2", "uFixedScale")
            }).outputs({
                color: i
            });
            var n = this.createVariable("vec3");
            return this.getNode("sRGBToLinear").inputs({
                color: i
            }).outputs({
                color: n
            }),
            this.createComposeBackgroundColor(t, e, n)
        },
        createAntiAlias: function() {
            var t = this.createVariable("vec3");
            return this.getNode("AntiAlias").inputs({
                sampler: this.getOrCreateSampler("sampler2D", "Texture0"),
                uv: this.getUv(),
                texSize: this.getOrCreateUniform("vec2", "RenderSize")
            }).outputs({
                color: t
            }),
            t
        },
        getOrCreateDistortion: function() {
            var t = this.getVariable("distortUvs");
            return t || (t = this.createVariable("vec2", "distortUvs"),
            this.getNode("Distortion").inputs({
                uv: this.getOrCreateVarying("vec2", "vTexCoord0"),
                distortion: this.getOrCreateUniform("vec2", "uDistortion"),
                projectionLeft: this.getOrCreateUniform("vec4", "uProjectionLeft"),
                unprojectionLeft: this.getOrCreateUniform("vec4", "uUnprojectionLeft")
            }).outputs({
                distortUvs: t
            }),
            t)
        },
        createSharpen: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("Sharpen").inputs({
                color: t,
                sampler: this.getOrCreateSampler("sampler2D", "Texture0"),
                uv: this.getUv(),
                texSize: this.getOrCreateUniform("vec2", "RenderSize"),
                factor: this.getOrCreateUniform("float", "uSharpFactor"),
                pixelRatio: this.getOrCreateUniform("float", "uPixelRatio"),
                alpha: this.config.testDepthSharpen ? this.getOrCreateAlpha() : void 0
            }).outputs({
                color: e
            }),
            e
        },
        createToneMapping: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("ToneMapping").inputs({
                color: t,
                exposure: this.getOrCreateUniform("float", "uToneExposure"),
                brightness: this.getOrCreateUniform("float", "uToneBrightness"),
                contrast: this.getOrCreateUniform("float", "uToneContrast"),
                saturation: this.getOrCreateUniform("float", "uToneSaturation"),
                method: this.getOrCreateUniform("int", "uToneMethod")
            }).outputs({
                color: e
            }),
            e
        },
        createColorBalance: function(t) {
            var e = this.createVariable("vec3");
            return this.getNode("ColorBalance").inputs({
                color: t,
                lowRGB: this.getOrCreateUniform("vec3", "uColorBalanceLow"),
                midRGB: this.getOrCreateUniform("vec3", "uColorBalanceMid"),
                highRGB: this.getOrCreateUniform("vec3", "uColorBalanceHigh")
            }).outputs({
                color: e
            }),
            e
        },
        createVignette: function(t, e) {
            var i = t;
            if (e) {
                var n = this.createVariable("vec4");
                this.getNode("SetAlpha").inputs({
                    color: t,
                    alpha: e
                }).outputs({
                    color: n
                }),
                i = n
            }
            var r = this.createVariable(i.getType());
            return this.getNode("Vignette").inputs({
                color: i,
                uv: this.getUv(),
                lens: this.getOrCreateUniform("vec2", "uLensRadius")
            }).outputs({
                color: r
            }),
            r
        },
        createChromaticAberration: function() {
            var t = this.createVariable("vec3");
            return this.getNode("ChromaticAberration").inputs({
                sampler: this.getOrCreateSampler("sampler2D", "Texture0"),
                uv: this.getUv(),
                factor: this.getOrCreateUniform("float", "uChromaFactor"),
                range: this.getOrCreateUniform("float", "uRGBMRange")
            }).outputs({
                color: t
            }),
            t
        },
        getOrCreateAlpha: function() {
            var t = this.getVariable("alpha");
            return t || (t = this.createVariable("float", "alpha"),
            this.getNode("TextureAlpha").inputs({
                sampler: this.getOrCreateSampler("sampler2D", "TextureDepth"),
                uv: this.getUv()
            }).outputs({
                color: t
            }),
            t)
        },
        textureFetch: function(t, e) {
            var i = t.getVariable()
              , n = this.createVariable("vec4");
            this.getNode("TextureRGBA").inputs({
                sampler: t,
                uv: e
            }).outputs({
                color: n
            });
            var r = n
              , a = this.config["RGBM" + i];
            if (a) {
                var s = this.createVariable("vec3");
                this.getNode("DecodeRGBM").inputs({
                    color: n,
                    range: this.createVariable("float").setValue(a.toExponential())
                }).outputs({
                    color: s
                }),
                r = this.createVariable("vec4"),
                this.getNode("SetAlpha").inputs({
                    color: s,
                    alpha: this.createVariable("float").setValue("1.0")
                }).outputs({
                    color: r
                })
            }
            return r
        }
    }),
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(29)
      , a = i(68)
      , s = i.n(a)
      , o = n.a.osg
      , l = n.a.osgShader
      , u = l.node.BaseOperator
      , h = l.utils
      , c = function() {
        u.apply(this)
    };
    c.prototype = o.objectInherit(u.prototype, {
        validOutputs: ["color"],
        globalFunctionDeclaration: function() {
            return '#pragma include "postProcess.glsl"'
        }
    });
    var d = function(t) {
        return t.getType && "vec4" === t.getType() ? t.getVariable() + ".rgb" : t
    }
      , p = function(t) {
        return t.getType && "vec4" === t.getType() ? t.getVariable() + ".a" : t
    }
      , f = function() {
        c.apply(this)
    };
    f.prototype = o.objectInherit(c.prototype, {
        type: "AntiAlias",
        validInputs: ["sampler", "uv", "texSize"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("fxaa", d(this._outputs.color), [t.sampler, t.uv, t.texSize])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "postProcess-antiAlias.glsl"'
        }
    });
    var g = function() {
        c.apply(this)
    };
    g.prototype = o.objectInherit(c.prototype, {
        type: "SuperSample",
        validInputs: ["color", "sampler", "uv", "texSize", "halton"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("supersample", d(this._outputs.color), [d(t.color), t.sampler, t.uv, t.texSize, t.halton])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "postProcess-antiAlias.glsl"'
        }
    });
    var m = function() {
        c.apply(this)
    };
    m.prototype = o.objectInherit(c.prototype, {
        type: "ToneMapping",
        validInputs: ["color", "exposure", "brightness", "contrast", "saturation", "method"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("toneMapping", this._outputs.color, [d(t.color), t.exposure, t.brightness, t.contrast, t.saturation, t.method])
        }
    });
    var v = function() {
        c.apply(this)
    };
    v.prototype = o.objectInherit(c.prototype, {
        type: "ColorBalance",
        validInputs: ["color", "lowRGB", "midRGB", "highRGB"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("colorBalance", this._outputs.color, [d(t.color), t.lowRGB, t.midRGB, t.highRGB])
        }
    });
    var _ = function() {
        c.apply(this)
    };
    _.prototype = o.objectInherit(c.prototype, {
        type: "ExtractBright",
        validInputs: ["color", "threshold"],
        computeShader: function() {
            var t = this._inputs
              , e = [d(t.color), t.threshold];
            return t.alpha && e.push(t.alpha),
            h.callFunction("extractBright", this._outputs.color, e)
        }
    });
    var b = function() {
        c.apply(this)
    };
    b.prototype = o.objectInherit(c.prototype, {
        type: "Vignette",
        validInputs: ["color", "uv", "lens"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("vignette", this._outputs.color, [t.color, t.uv, t.lens])
        }
    });
    var x = function() {
        c.apply(this)
    };
    x.prototype = o.objectInherit(c.prototype, {
        type: "ChromaticAberration",
        validInputs: ["sampler", "uv", "factor", "range"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("chromaticAberration", d(this._outputs.color), [t.sampler, t.uv, t.factor, t.range])
        }
    });
    var y = function() {
        c.apply(this)
    };
    y.prototype = o.objectInherit(c.prototype, {
        type: "Sharpen",
        validInputs: ["color", "sampler", "uv", "texSize", "factor", "pixelRatio"],
        computeShader: function() {
            var t = this._inputs
              , e = [d(t.color), t.sampler, t.uv, t.texSize, t.factor, t.pixelRatio];
            return t.alpha && e.push(t.alpha),
            h.callFunction("sharpen", this._outputs.color, e)
        }
    });
    var S = function() {
        c.apply(this)
    };
    S.prototype = o.objectInherit(c.prototype, {
        type: "ComposeExtra",
        validInputs: ["color", "alpha", "extra"],
        validOutputs: ["color"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("composeExtra", this._outputs.color, [d(t.color), p(t.alpha), t.extra])
        }
    });
    var w = function() {
        c.apply(this)
    };
    w.prototype = o.objectInherit(c.prototype, {
        type: "ComposeBackgroundColor",
        validInputs: ["color", "alpha", "backgroundColor"],
        validOutputs: ["color"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("composeBackgroundColor", this._outputs.color, [d(t.color), p(t.alpha), t.backgroundColor])
        }
    });
    var C = function() {
        c.apply(this)
    };
    C.prototype = o.objectInherit(c.prototype, {
        type: "Distortion",
        validInputs: ["uv", "distortion", "projectionLeft", "unprojectionLeft"],
        validOutputs: ["distortUvs"],
        computeShader: function() {
            var t = this._inputs
              , e = [t.uv, t.distortion, t.projectionLeft, t.unprojectionLeft];
            return h.callFunction("distortion", this._outputs.distortUvs, e)
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "postProcess-distortion.glsl"'
        }
    });
    var M = function() {
        c.apply(this)
    };
    M.prototype = o.objectInherit(c.prototype, {
        type: "DofDownsampleCoC",
        validInputs: ["samplerDepth", "uv", "dofBlurNearFarFocal"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("dofDownsampleCoC", this._outputs.color, [t.samplerDepth, t.uv, t.dofBlurNearFarFocal])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "dof.glsl"'
        }
    });
    var T = function() {
        c.apply(this)
    };
    T.prototype = o.objectInherit(c.prototype, {
        type: "DofDownsampleColor",
        validInputs: ["samplerColor", "uv"],
        computeShader: function() {
            var t = this._inputs
              , e = [t.samplerColor, t.uv];
            return t.samplerCoC && e.push(t.samplerCoC),
            h.callFunction("dofDownsampleColor", this._outputs.color, e)
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "dof.glsl"'
        }
    });
    var A = function() {
        c.apply(this),
        this._vertical = !1
    };
    A.prototype = o.objectInherit(c.prototype, {
        type: "DofDilateNear",
        validInputs: ["samplerCoC", "samplerDepth", "uv", "texSize", "dofScale", "dofBlurNearFarFocal"],
        setVertical: function(t) {
            return this._vertical = t,
            this
        },
        computeShader: function() {
            var t = this._inputs
              , e = this._vertical ? "V" : "H";
            return h.callFunction("dofDilateNear" + e, this._outputs.color, [t.samplerCoC, t.samplerDepth, t.uv, t.texSize, t.dofScale, t.dofBlurNearFarFocal])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "dof.glsl"'
        }
    });
    var E = function() {
        c.apply(this)
    };
    E.prototype = o.objectInherit(c.prototype, {
        type: "DofBlurCircular",
        validInputs: ["samplerColor", "samplerCoC", "uv", "texSize", "time", "dofScale", "dofBlurNearFarFocal"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("dofBlurCircular", this._outputs.color, [t.samplerColor, t.samplerCoC, t.uv, t.texSize, t.time, t.dofScale, t.dofBlurNearFarFocal])
        },
        getDefines: function() {
            var t = ["#define DOF_TAP(id) ", "ofs = fTaps_Poisson[id];", "ofs = uv + blurDist * vec2(dot(ofs, basis.xy), dot(ofs, basis.zw) );"];
            return this._inputs.samplerColor === this._inputs.samplerCoC ? (t.push("sampleTex = texture2D(texColor, ofs);"),
            t.push("cocWeight = abs(sampleTex.a * 2.0 - 1.0);"),
            t.push("cocWeight *= cocWeight * cocWeight;"),
            t.push("sumcol.rgb += sampleTex.rgb * cocWeight;"),
            t.push("sumcol.a += cocWeight;")) : (t.push("cocWeight = abs(texture2D(texCoC, ofs).a * 2.0 - 1.0);"),
            t.push("cocWeight *= cocWeight * cocWeight;"),
            t.push("sumcol.rgb += decodeRGBM(texture2D(texColor, ofs), 7.0) * cocWeight;"),
            t.push("sumcol.a += cocWeight;")),
            [t.join("")]
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "dof.glsl"'
        }
    });
    var P = function() {
        c.apply(this)
    };
    P.prototype = o.objectInherit(c.prototype, {
        type: "DofCombine",
        validInputs: ["color", "samplerBlur", "samplerCoC", "samplerDepth", "uv", "range", "texSize", "dofScale", "dofBlurNearFarFocal", "blurDiv"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("dofCombine", d(this._outputs.color), [d(t.color), t.samplerBlur, t.samplerCoC, t.samplerDepth, t.uv, t.range, t.texSize, t.dofScale, t.dofBlurNearFarFocal, t.blurDiv])
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "dof.glsl"'
        }
    });
    var N = function() {
        c.apply(this)
    };
    N.prototype = o.objectInherit(c.prototype, {
        type: "SsaoExtract",
        validInputs: ["samplerDepth", "uv", "nearFar", "radius", "intensity", "bias", "projectionInfo", "projectionScale", "texSize", "time", "samplerDepth1", "samplerDepth2", "samplerDepth3", "samplerDepth4", "samplerDepth5"],
        computeShader: function() {
            var t = this._inputs;
            return h.callFunction("ssaoExtract", this._outputs.color, [t.samplerDepth, t.uv, t.nearFar, t.radius, t.intensity, t.bias, t.projectionInfo, t.projectionScale, t.texSize, t.time, t.samplerDepth1, t.samplerDepth2, t.samplerDepth3, t.samplerDepth4, t.samplerDepth5])
        },
        getDefines: function() {
            var t = ["#define SSAO_TAP_EXTRACT(id) ", "screenSpaceRadius = (float(id) + 0.5) * (1.0 / float(NB_SAMPLES));", "angle = screenSpaceRadius * (NB_SPIRAL_TURNS * 6.28) + randomAngle;", "screenSpaceRadius = max(0.75, screenSpaceRadius * ssRadius);", "offsetUnitVec = vec2(cos(angle), sin(angle));", "occludingPoint = getOffsetedPixelPos(texDepth, texDepth1, texDepth2, texDepth3, texDepth4, texDepth5, uv, offsetUnitVec, screenSpaceRadius, projInfo, texSize, nearFar);", "occludingPoint -= cameraSpacePosition;", "vv = dot(occludingPoint, occludingPoint);", "vn = dot(occludingPoint, normal);", "contrib += max(1.0 - vv * invRadius2, 0.0) * max((vn - bias) * inversesqrt(vv), 0.0);"];
            return i.i(r.a)().ssaoNormal && t.push("\n#define SSAO_NORMAL"),
            s.a.any && t.push("\n#define MOBILE"),
            [t.join("")]
        },
        getExtensions: function() {
            return ["#extension GL_OES_standard_derivatives : enable"]
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "ssao.glsl"'
        }
    });
    var k = function() {
        c.apply(this),
        this._vertical = !1
    };
    k.prototype = o.objectInherit(c.prototype, {
        type: "SsaoBlur",
        validInputs: ["samplerSsao", "uv", "texSize", "nearFar"],
        setVertical: function(t) {
            return this._vertical = t,
            this
        },
        computeShader: function() {
            var t = this._inputs
              , e = this._vertical ? "V" : "H"
              , i = [t.samplerSsao, t.uv, t.texSize, t.nearFar];
            return this._vertical && i.push(d(t.color)),
            h.callFunction("ssaoBlur" + e, this._outputs.color, i)
        },
        getDefines: function() {
            return [["#define SSAO_TAP_BLUR(id, absid) ", "sampleTex = texture2D(texSsao, uv + axis * float(id) * 2.0);", "z = dot(sampleTex.gba, vec3( 1.0, 1.0 / 255.0, 1.0 / 65025.0));", "weight = max(0.0, 1.0 - sharpnessFactor * abs(z - initialZ)) * (0.3 + gaussian[absid]);", "sum += weight * sampleTex.r;", "totalWeight += weight;"].join("")]
        },
        getExtensions: function() {
            return ["#extension GL_OES_standard_derivatives : enable"]
        },
        globalFunctionDeclaration: function() {
            return '#pragma include "ssao.glsl"'
        }
    }),
    e.a = {
        AntiAlias: f,
        SuperSample: g,
        ToneMapping: m,
        ColorBalance: v,
        ExtractBright: _,
        Vignette: b,
        Sharpen: y,
        ChromaticAberration: x,
        ComposeExtra: S,
        ComposeBackgroundColor: w,
        Distortion: C,
        DofDownsampleCoC: M,
        DofDownsampleColor: T,
        DofDilateNear: A,
        DofBlurCircular: E,
        DofCombine: P,
        SsaoExtract: N,
        SsaoBlur: k
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(68)
      , s = i.n(a)
      , o = i(15)
      , l = i(29)
      , u = i(90)
      , h = o.a.extend({
        defaults: function() {
            var t = 1;
            return s.a.any ? t = 0 : i.i(u.a)() && (t = 2),
            this._deferReady = r.a.defer(),
            {
                promiseReady: this._deferReady.promise,
                level: t
            }
        },
        getBudget: function() {
            var t = i.i(l.a)();
            return void 0 !== t.pixelBudget ? 0 === t.pixelBudget ? 1 / 0 : t.pixelBudget : this.getBudgetFromLevel(this.get("level"))
        },
        getBudgetFromLevel: function(t) {
            return 0 === t ? 6144 : 1 === t ? 12288 : 1 / 0
        },
        getName: function() {
            return "Quality"
        }
    });
    e.a = h
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(1016)
      , a = i(1018)
      , s = {
        FeatureName: "quality",
        ModelType: r.a,
        ViewListType: [a.a]
    };
    e.a = n.a.create(s)
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(6)
      , s = i(43)
      , o = i(29)
      , l = i(553)
      , u = i(4)
      , h = u.a.osg
      , c = function(t) {
        return 0 == (t & t - 1)
    }
      , d = function(t) {
        return 1 << Math.floor(Math.log2(t))
    }
      , p = function(t) {
        return 1 << Math.ceil(Math.log2(t))
    }
      , f = function(t) {
        if (c(t))
            return t;
        var e = d(t);
        return t / e - 1 > .75 ? p(t) : e
    }
      , g = h.Timer.instance()
      , m = ["glframe"]
      , v = a.a.extend({
        initialize: function() {
            a.a.prototype.initialize.apply(this, arguments);
            var t = this.options.context;
            this._viewer = t.getViewer(),
            this._fMaterial = t.getFeatures().material,
            this._version = t.getModel().get("options").version,
            this.model.bind("change:level", this.onLevelChanged, this),
            this.model.bind("updateTexelPolicy", this.updateTexelPolicy, this),
            this._maxSize = i.i(l.a)(),
            this._timers = {};
            var e = [s.a.getHighResBound(), s.a.getFirstCameraAnimation()];
            r.a.all(e).then(this.initTimers.bind(this))
        },
        initTimers: function() {
            for (var t = 0, e = m.length; t < e; ++t)
                this._timers[m[t]] = {
                    accumValue: 0,
                    accumSamples: 0,
                    accumStart: g.tick(),
                    averageValue: 0
                };
            var i = h.TimerGPU.instance();
            i.setFrameAverageCount(20),
            i.setCallback(this.callbackGPU.bind(this))
        },
        callbackGPU: function(t, e) {
            if (this._viewer.getViewerOSGJS().callbackTimerGPU(t, e),
            "glframe" === e) {
                var i = this._timers[e];
                i.accumValue += t / 1e6,
                i.accumSamples++;
                var n = g.tick();
                if (n - i.accumStart >= 2e3) {
                    i.averageValue = i.accumValue / i.accumSamples,
                    i.accumValue = 0,
                    i.accumStart = n,
                    i.accumSamples = 0;
                    var r = this._viewer.getFeatures().postProcess.getModel();
                    i.averageValue < 10 ? r.set("dofQuality", 3) : i.averageValue < 12 ? r.set("dofQuality", Math.max(r.get("dofQuality"), 2)) : i.averageValue < 14 ? r.set("dofQuality", Math.max(r.get("dofQuality"), 1)) : i.averageValue > 17 && r.set("dofQuality", 0)
                }
            }
        },
        getMaterials: function() {
            return this._fMaterial.getModel().attributes
        },
        onLevelChanged: function() {
            this.updateTexelPolicy();
            var t = this._fMaterial._views[0];
            this._viewer.setFakeSecondaryProgress(t.requestAllHighResTextures(this._fMaterial.getModel().attributes), 0),
            this._fMaterial._views[0].cleanAndApplyMaterials()
        },
        getOrCreateTexelInfos: function() {
            return this._fMaterial._views[0].getOrCreateTexelInfos()
        },
        getMaxSizeFromBudget: function(t) {
            var e = t * t
              , i = this.getOrCreateTexelInfos();
            if (0 === i.count || i.pixelCount <= e)
                return this._maxSize;
            var n = Math.min(this._maxSize, Math.sqrt(e / i.count));
            return n = f(n),
            this._version < 2 && (n < 1024 ? n = 512 : n >= 1024 && n < 2048 && (n = 2048)),
            i.max <= n || i.pixelCount <= n * n ? this._maxSize : n
        },
        updateTexelPolicy: function() {
            var t = this.getOrCreateTexelInfos();
            0 === t.count || t.missingResolution || (this.model.get("promiseReady").isPending() && this.initAvailableQuality(),
            i.i(o.a)().maxTextureSize = this.getMaxSizeFromBudget(this.model.getBudget()))
        },
        initAvailableQuality: function() {
            var t = this.getMaxSizeFromBudget(this.model.getBudgetFromLevel(0))
              , e = this.getMaxSizeFromBudget(this.model.getBudgetFromLevel(1))
              , i = {
                low: !0,
                mid: e !== t,
                high: e !== this._maxSize
            }
              , n = this.model.get("level");
            i.high || 2 !== n || (n = 1),
            i.mid || 1 !== n || (n = 0),
            1 === n && (i.low = !1),
            this.model.off(null, this.onLevelChanged, this),
            this.model.set("level", n),
            this.model.on("change:level", this.onLevelChanged, this),
            this.model._deferReady.resolve(i)
        }
    });
    e.a = v
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(472))
      , a = function(t, e) {
        r.a.call(this, t, "arraybuffer", e)
    };
    a.prototype = i.i(n.extend)({}, r.a.prototype, {
        load: function() {
            var t = this.getXHR().response;
            this._defer.resolve(t)
        }
    }),
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(542)
      , s = i(472)
      , o = i(29)
      , l = i(775)
      , u = i.n(l)
      , h = i(774)
      , c = i.n(h)
      , d = r.a.osg
      , p = {}
      , f = {}
      , g = parseInt((/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [0, 0])[1], 10)
      , m = i.i(o.a)().asyncImage;
    m && (m = window.Worker && window.fetch && window.createImageBitmap && g >= 52);
    var v = [];
    window.closeBitmaps = function() {
        v.forEach(function(t) {
            t.close()
        })
    }
    ;
    var _ = function(t) {
        var e = 0
          , i = Math.max(2, Math.min(4, navigator.hardwareConcurrency || 2))
          , n = []
          , r = URL.createObjectURL(new Blob([t],{
            type: "text/javascript"
        }));
        return function() {
            var t = n[e];
            return t || (t = n[e] = new Worker(r),
            t.onmessage = function(t) {
                var e = t.data
                  , i = e.uid
                  , n = f[i];
                e.bitmap ? (n.setImage(e.bitmap),
                v.push(e.bitmap)) : (n.setImage(e.img),
                n.setWidth(e.width),
                n.setHeight(e.height)),
                p[i]()
            }
            ),
            e = (e + 1) % i,
            t
        }
    }
      , b = _(u.a)
      , x = _(c.a)
      , y = function(t, e) {
        s.a.call(this, t, "blob", e),
        this._responseType = "arraybuffer"
    };
    y.prototype = i.i(n.extend)({}, s.a.prototype, {
        isVideo: function(t) {
            return a.a.isVideoURL(t)
        },
        createVideo: function() {
            var t = document.createElement("video");
            return document.body.appendChild(t),
            t.style.display = "none",
            t
        },
        start: function() {
            var t = this.getURL();
            if (this.isVideo(t)) {
                var e = this.createVideo();
                this._image = new d.ImageStream(e),
                window.video = this._image,
                e.preload = "auto",
                e.crossOrigin = "anonymous",
                e.src = t,
                this._image.whenReady().then(function(t) {
                    t.play(),
                    this._defer.resolve(this._image)
                }
                .bind(this))
            } else {
                this._image = new d.Image;
                var i = this._options;
                i.panoramaLUV || i.integrateBRDFLUV || i.cubemapLUV ? s.a.prototype.start.call(this) : ".astc.gz" === this._url.substr(-8) ? (i.astc = !0,
                s.a.prototype.start.call(this)) : i.decodeAsync && m ? this.loadImageAsync() : this.loadImage()
            }
        },
        load: function() {
            var t = this._options;
            t.panoramaLUV || t.integrateBRDFLUV ? this.loadLUV() : t.cubemapLUV ? this.loadCubemapLUV() : t.astc && this.loadAstc()
        },
        loadImageAsync: function() {
            p[this._url] = this._defer.resolve.bind(this._defer, this._image),
            f[this._url] = this._image,
            x().postMessage({
                uid: this._url,
                url: this._url
            })
        },
        loadAstc: function() {
            var t = this._xhr.response;
            p[this._url] = this._defer.resolve.bind(this._defer, this._image),
            f[this._url] = this._image,
            b().postMessage({
                uid: this._url,
                buffer: t,
                swizzle: !0,
                nbComponents: 3
            }, [t])
        },
        loadImage: function() {
            var t = new Image;
            this._options.crossOrigin && (t.crossOrigin = this._options.crossOrigin),
            this._image.setImage(t),
            t.onload = this._defer.resolve.bind(this._defer, this._image),
            t.onerror = this._defer.reject.bind(this._defer, this._image),
            this._imgHtmlTag = t,
            t.src = this._url
        },
        abortImage: function() {
            this._imgHtmlTag && (this._imgHtmlTag.src = "")
        },
        loadLUV: function() {
            var t, e = this._xhr.response, i = Math.sqrt(e.byteLength / 4);
            t = this._options.integrateBRDFLUV ? new Uint8Array(e) : this.deinterleaveImage4(i, new Uint8Array(e), new Uint8Array(e.byteLength));
            var n = this._image;
            n.setImage(t),
            n.setWidth(i),
            n.setHeight(i),
            this._defer.resolve(this._image)
        },
        loadCubemapLUV: function() {
            for (var t = this._xhr.response, e = Math.log(this._options.size) / Math.LN2, i = 0, n = {}, r = 0; r <= e && !(i >= t.byteLength); r++)
                for (var a = Math.pow(2, e - r), s = 0; s < 6; s++) {
                    n[d.Texture.TEXTURE_CUBE_MAP_POSITIVE_X + s] || (n[d.Texture.TEXTURE_CUBE_MAP_POSITIVE_X + s] = []);
                    var o = a * a * 4
                      , l = new Uint8Array(o);
                    this.deinterleaveImage4(a, new Uint8Array(t,i,o), l);
                    var u = new d.Image;
                    u.setImage(l),
                    u.setWidth(a),
                    u.setHeight(a),
                    n[d.Texture.TEXTURE_CUBE_MAP_POSITIVE_X + s].push(u),
                    i += o
                }
            this._defer.resolve(n)
        },
        deinterleaveImage4: function(t, e, i) {
            for (var n = t * t, r = 2 * t * t, a = 3 * t * t, s = 0, o = 0; o < n; o++)
                i[s++] = e[o],
                i[s++] = e[o + n],
                i[s++] = e[o + r],
                i[s++] = e[o + a];
            return i
        },
        getImage: function() {
            return this._image
        }
    }),
    e.a = y
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(472))
      , a = function() {
        r.a.apply(this, arguments)
    };
    a.prototype = i.i(n.extend)({}, r.a.prototype, {
        load: function() {
            this._model = this._xhr.response,
            this._defer.resolve(this._model)
        },
        getModel: function() {
            return this._model
        }
    }),
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(7)
      , r = i.n(n)
      , a = i(2)
      , s = i.n(a)
      , o = i(1)
      , l = (i.n(o),
    i(37))
      , u = i(11)
      , h = i(4)
      , c = i(495)
      , d = i(6)
      , p = i(27)
      , f = i(469)
      , g = i(343)
      , m = h.a.osg;
    e.a = d.a.extend({
        savingEnabled: !1,
        initialize: function() {
            d.a.prototype.initialize.apply(this, arguments),
            s()(".save-model").click(this.onSave.bind(this));
            var t = this.options.context.getModel();
            t && !this.maintenance && this.listenTo(t, "status:loaded", this.enableSaving.bind(this))
        },
        onSave: function(t) {
            t.preventDefault(),
            g.a.isMaintenance() ? g.a.showPopup() : this.save()
        },
        save: function() {
            if (!this.savingEnabled)
                return r.a.reject();
            if (s()(".save-model").hasClass("progress"))
                return r.a.reject();
            s()(".save-model").addClass("progress");
            var t = this.options.context.getModel().get("uid")
              , e = this.options.context.getModel().get("user").uid
              , i = {
                modelUID: t,
                userUID: e
            }
              , n = this
              , a = [];
            return r.a.settle([this.saveBackgroundImages(i, a), this.saveMaterialImages(i, a), this.saveTexturesColorspace(i, a), this.saveHotspots(i, a), this.saveAnimations(i, a), this.saveSounds(i, a)]).then(function() {
                return a.length > 0 || this.cancelSave ? r.a.reject() : n.saveOptions()
            }
            .bind(this)).then(function() {
                return a.length > 0 ? r.a.reject() : r.a.settle([n.deleteTextures(a), n.deleteBackgroundImages(a), n.deleteAnimations(a), n.deleteEnvironments(a)])
            }).then(function() {
                if (a.length > 0)
                    return r.a.reject();
                s()(".save-model").removeClass("progress"),
                s()(".save-model").addClass("success"),
                setTimeout(function() {
                    s()(".save-model").removeClass("success")
                }, 4e3)
            }
            .bind(this)).catch(function(t) {
                if (s()(".save-model").removeClass("progress"),
                503 === event.target.status)
                    g.a.showPopup();
                else {
                    if (this.cancelSave)
                        return;
                    var e = "";
                    if (a.length)
                        e = a.join("<br/>");
                    else {
                        if (e = "An unexpected error happened while saving the following settings : <br/><ul>",
                        t && t.responseJSON && t.responseJSON.detail) {
                            var i = t.responseJSON.detail;
                            m.error(i);
                            for (var n = "string" == typeof i ? [i] : Object.keys(i), r = 0; r < n.length; ++r)
                                e += "<li>&bullet; " + n[r] + "</li>"
                        }
                        e += "</ul>"
                    }
                    e += "<br/>Contact the support team at support@sketchfab.com if you need help.";
                    var o = new p.default({
                        title: "Error",
                        text: e,
                        buttons: {
                            ok: !0
                        },
                        safe: !0
                    });
                    o.open().then(o.close.bind(o))
                }
            }
            .bind(this))
        },
        deleteUnusedResources: function(t, e, n) {
            if (0 === t.length)
                return r.a.resolve();
            var a = "Errors while deleting the following " + e + " :<br/><ul>"
              , s = !1
              , l = i.i(o.map)(t, function(t) {
                return r.a.resolve(t.destroy()).catch(function(e) {
                    var i = e && e.responseJSON && e.responseJSON.detail;
                    a += "<li>&bullet; " + t.get("name") + " : " + i + "</li>",
                    t.trigger("restore", t),
                    s = !0
                })
            });
            return t.length = 0,
            r.a.all(l).then(function() {
                if (s)
                    return n.push(a + "</ul>"),
                    r.a.reject()
            })
        },
        deleteTextures: function(t) {
            var e = this.options.context.getViewer().getFeatures().material.getModel()._deletedTextures || []
              , n = i.i(o.map)(e, function(t) {
                return new c.a({
                    uid: t
                })
            });
            return e.length = 0,
            this.deleteUnusedResources(n, "material textures", t)
        },
        deleteAnimations: function(t) {
            return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().animation.getModel().get("animations")._trashbin, "animations", t)
        },
        deleteEnvironments: function(t) {
            return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().environment.getModel()._trashbin, "environments", t)
        },
        deleteBackgroundImages: function(t) {
            return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().background.getModel()._trashbin, "backgrounds", t)
        },
        saveBackgroundImages: function(t, e) {
            var i = this
              , n = [];
            return this.options.context.getViewer().getFeatures().background.getModel().backgroundCollection.each(function(r) {
                if (r.isNew()) {
                    var a = i.saveImage(r, t);
                    a && (a.catch(function(t) {
                        var i = 0;
                        if (t.responseJSON.detail.imageFile)
                            for (i = 0; i < t.responseJSON.detail.imageFile.length; i++)
                                t.responseJSON.detail.imageFile[i].match("The image should be less than 4mb") && e.push("Background image is too big (max: 4MB)")
                    }),
                    n.push(a))
                }
            }),
            r.a.all(n)
        },
        saveImage: function(t, e) {
            return r.a.resolve(t.save(e).then(function(e) {
                t.set("uid", e.uid)
            }))
        },
        _saveImageToBlob: function(t, e, n, r) {
            var a, s = t.getImage(), o = t.getTextureProxy().getImage().getImage();
            if (o.toBlob) {
                var l = this;
                return void o.toBlob(function(t) {
                    t.name = e.name,
                    s.set("imageFile", t),
                    n(l.saveImage(s, r))
                }, e.type, .95)
            }
            if (o.toDataURL)
                a = i.i(f.a)(o.toDataURL(e.type, .95)),
                a.name = e.name,
                s.set("imageFile", a),
                n(this.saveImage(s, r));
            else {
                var u = o;
                o = document.createElement("canvas"),
                o.width = u.width,
                o.height = u.height,
                o.getContext("2d").drawImage(u, 0, 0)
            }
            a = i.i(f.a)(o.toDataURL(e.type, .95)),
            a.name = e.name,
            s.set("imageFile", a),
            n(this.saveImage(s, r))
        },
        saveMaterialImages: function(t, e) {
            var n = this
              , a = []
              , s = {}
              , l = this.options.context.getViewer().getFeatures().material
              , u = "Errors while saving the following texture materials :<br/><ul>"
              , h = !1;
            return i.i(o.each)(l.getModel().attributes, function(e) {
                var l = e.getChannels();
                i.i(o.each)(l, function(e) {
                    var o = e.getTexture();
                    if (o) {
                        var l = o.getImage();
                        if (l && l.isNew()) {
                            var c = l.getUID();
                            if (1 !== s[c]) {
                                s[c] = 1;
                                var d = new r.a(function(e) {
                                    var r = l.get("imageFile");
                                    if (void 0 === r) {
                                        var a = l.findImageNearestToResolution(16384, 16384)
                                          , s = i.i(f.a)(a.url);
                                        return l.set("imageFile", s),
                                        void e(n.saveImage(l, t))
                                    }
                                    if (0 === r.size)
                                        n._saveImageToBlob(o, r, e, t);
                                    else if (window.File) {
                                        var u = new FileReader;
                                        u.onload = function() {
                                            this.readyState === FileReader.DONE ? e(n.saveImage(l, t)) : n._saveImageToBlob(o, r, e, t)
                                        }
                                        ,
                                        u.onerror = function() {
                                            n._saveImageToBlob(o, r, e, t)
                                        }
                                        ,
                                        u.readAsArrayBuffer(r)
                                    }
                                }
                                );
                                a.push(d.catch(function(t) {
                                    var e = t && t.responseJSON && t.responseJSON.detail;
                                    u += "<li>&bullet; " + l.getName() + " : " + e + "</li>",
                                    h = !0
                                }))
                            }
                        }
                    }
                })
            }),
            r.a.all(a).then(function() {
                if (h)
                    return e.push(u + "</ul>"),
                    r.a.reject()
            })
        },
        saveOptions: function() {
            var t = this.options.context
              , e = t.getViewer()
              , i = e.getOptionsJSON();
            if (e.getFeaturesManager().registerOptionsJSON(i),
            i.animation)
                for (var n = e.getFeatures().animation.getModel().get("animations")._trashbin, a = 0; a < n.length; a++)
                    n[a] && i.animation.order.splice(a, 0, n[a].get("uid"));
            return r.a.resolve(t.getModel().save({
                options: i
            }, {
                patch: !0
            }))
        },
        saveHotspot: function(t, e, i) {
            return t.save(e).catch(function(e) {
                if (i.push("Annotation #" + (+t.get("order") + 1) + " could not be saved."),
                e.responseJSON && e.responseJSON.detail) {
                    var n = 0;
                    if (e.responseJSON.detail.name)
                        for (n = 0; n < e.responseJSON.detail.name.length; n++)
                            e.responseJSON.detail.name[n].match("This field is required.") && i.push("Title is required."),
                            e.responseJSON.detail.name[n].match("Ensure this value has at most 64 characters") && i.push("Title is too long (64 characters max).");
                    if (e.responseJSON.detail.content)
                        for (n = 0; n < e.responseJSON.detail.content.length; n++)
                            e.responseJSON.detail.content[n].match("Ensure this value has at most 1024 characters") && i.push("Description is too long (1024 characters max).")
                }
            })
        },
        deleteHotspot: function(t, e, i, n) {
            return t.remove(e).catch(function() {
                n.push(t),
                i.push("An annotation could not be deleted. Please try saving your settings again.")
            })
        },
        saveHotspots: function(t, e) {
            var n = this.options.context.getViewer().getFeatures().hotspot
              , a = n.getModel()
              , s = a.get("hotspots")
              , h = l.a.maxHotspotsPerModel[u.a.me().get("account")]
              , c = s.length - h;
            if (s.length > h) {
                var d = "You have reached the maximum number of annotations allowed by your plan (" + h + ").";
                return u.a.me().canUpgradeToPro() && (d += 1 === c ? '<br>Delete the last annotation you created or <a class="upgrade-link underlined" href="/plans" data-title="maximum-annotation-upgrade" target="_blank">upgrade your account</a>.' : "<br>Delete the " + c + ' last annotations you created or <a class="upgrade-link underlined" href="/plans" data-title="maximum-annotation-upgrade" target="_blank">upgrade your account</a>.'),
                a.trigger("hotspot-error", d),
                void (this.cancelSave = !0)
            }
            this.cancelSave = !1;
            var p = []
              , f = []
              , g = this;
            return i.i(o.each)(a.hotspotsToBeDeleted, function(i) {
                p.push(g.deleteHotspot(i, t, e, f))
            }),
            a.hotspotsToBeDeleted = f,
            r.a.all(p).then(function() {
                var i = [];
                return s.each(function(n) {
                    n.set("order", s.indexOf(n)),
                    i.push(g.saveHotspot(n, t, e))
                }),
                r.a.all(i)
            })
        },
        saveTexturesColorspace: function(t, e) {
            var i = "Errors while changing the following texture colorspace :<br/><ul>"
              , n = !1
              , a = [];
            return this.model.imageCollection.each(function(t) {
                !t.isNew() && t.hasChanged("colorSpace") && a.push(t.saveColorspace().catch(function(e) {
                    var r = e && e.responseJSON && e.responseJSON.detail;
                    i += "<li>&bullet; " + t.get("name") + " : " + r + "</li>",
                    n = !0
                }))
            }),
            r.a.all(a).then(function() {
                if (n)
                    return e.push(i + "</ul>"),
                    r.a.reject()
            })
        },
        saveAnimations: function(t, e) {
            var i = this.options.context.getViewer().getFeatures().animation
              , n = i.getModel()
              , a = "Errors while saving the following animations :<br/><ul>"
              , s = !1
              , o = n.get("animations").map(function(e) {
                return e.save(t).catch(function(t) {
                    var i = t && t.responseJSON && t.responseJSON.detail;
                    a += "<li>&bullet; " + e.get("name") + " : " + i + "</li>",
                    s = !0
                })
            });
            return r.a.all(o).then(function() {
                if (s)
                    return e.push(a + "</ul>"),
                    r.a.reject()
            })
        },
        saveSounds: function() {
            var t = this.options.context.getViewer().getFeatures().sound
              , e = t.getModel()
              , i = e.get("soundtracks")
              , n = l.a.maxSoundtracksPerModel[u.a.me().get("account")];
            if (i.length > n) {
                var r = i.length - n
                  , a = ["You have reached the maximum number of sounds allowed by your plan (" + n + ").", "<br>Delete " + r + ' sounds or <a class="upgrade-link underlined" href="/plans" target="_blank">upgrade your account</a>.'].join("\n");
                e.trigger("sound-error", a),
                this.cancelSave = !0
            } else
                this.cancelSave = !1
        },
        enableSaving: function() {
            this.savingEnabled = !0,
            s()(".save-model").removeClass("btn-disabled")
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(1)
      , s = (i.n(a),
    i(6))
      , o = i(674)
      , l = i(908)
      , u = s.a.extend({
        _isLoaded: !1,
        _context: null,
        isMoving: !1,
        startX: 0,
        sensitivity: 20,
        sprite: {
            current: 0,
            steps: 15,
            ratio: null,
            width: 0
        },
        size: 1,
        autospinTimer: null,
        events: {
            mousedown: "onMouseDown",
            mouseup: "onMouseUp",
            "mousemove ": "onMouseMove",
            touchstart: "onTouchStart",
            touchend: "onTouchEnd",
            touchmove: "onTouchMove"
        },
        constructor: function() {
            this._boundResizeEvent = this.onWindowResize.bind(this),
            s.a.prototype.constructor.apply(this, arguments)
        },
        initialize: function() {
            s.a.prototype.initialize.apply(this, arguments),
            this.$viewport = r()(),
            this.$image = r()()
        },
        delegateEvents: function() {
            s.a.prototype.delegateEvents.apply(this, arguments),
            r()(window).on("resize", this._boundResizeEvent)
        },
        undelegateEvents: function() {
            s.a.prototype.undelegateEvents.apply(this, arguments),
            r()(window).off("resize", this._boundResizeEvent),
            this.autospinTimer && clearInterval(this.autospinTimer)
        },
        isViewerReady: function() {
            return this._isLoaded
        },
        run: function() {
            var t = new o.a;
            this._context = t,
            this.$el.show(),
            this.$el.siblings(".webgl").hide(),
            this.$el.siblings(".osd").hide();
            var e = this.model.get("uid")
              , i = this._fallbackCollection = new l.a([],{
                uid: e
            });
            return i.fetch().then(function() {
                i.length > 0 ? this.displayFallback() : this.displayNoFallbackError()
            }
            .bind(this)).fail(function() {
                this.displayNoFallbackError()
            }
            .bind(this)),
            this._isLoaded = !0,
            !0
        },
        getContext: function() {
            return this._context
        },
        getFeatures: function() {
            return {}
        },
        findBestImage: function() {
            for (var t, e = this._fallbackCollection.at(0).get("images"), i = this.$el.height(), n = 1 / 0, r = 0, a = e.length; r < a; ++r) {
                var s = e[r]
                  , o = Math.abs(i - s.height);
                o < n && (n = o,
                t = s)
            }
            return t
        },
        displayFallback: function() {
            this.$viewport = r()(".fallback-viewport"),
            this.$image = this.$viewport.find("img.fallback-sprite");
            var t = this.findBestImage()
              , e = t.url;
            this._currentHeight = t.height,
            this.$image.on("load", function(t) {
                var e = t.target.naturalHeight
                  , i = t.target.naturalWidth / this.sprite.steps;
                this.sprite.ratio = e ? i / e : 0,
                r()(t.target).css("display", "block"),
                this.trigger("secondary-progress", {
                    progress: 1
                }),
                this.trigger("success"),
                this.displayFallbackWarning(),
                this.onWindowResize()
            }
            .bind(this)),
            this.$image.on("error", function(t) {
                console.error("Fallback loading failed. URL : " + e + " ERROR : " + t.toString()),
                this.trigger("fail"),
                this.displayFallbackLoadingError()
            }
            .bind(this)),
            this.$image.attr("src", e)
        },
        displayFallbackLoadingError: function() {
            this.$el.find(".fallback-error-loading").show()
        },
        displayNoFallbackError: function() {
            this.$el.find(".fallback-error-nofallback").show()
        },
        displayFallbackWarning: function() {
            this._warningDisplayed || (this._warningDisplayed = !0,
            this.$el.find(".fallback-warning").show(),
            this.fallbackWarning = setTimeout(function() {
                this.$el.find(".fallback-warning").fadeOut()
            }
            .bind(this), 5e3))
        },
        onWindowResize: function() {
            var t, e, i = this.$el.width(), n = this.$el.height(), r = i / n;
            this.findBestImage().height > this._currentHeight && this.displayFallback(),
            2 === this.size ? r < this.sprite.ratio ? (t = i,
            e = Math.floor(t / this.sprite.ratio)) : (e = n,
            t = Math.floor(e * this.sprite.ratio)) : r < this.sprite.ratio ? (e = n,
            t = Math.floor(e * this.sprite.ratio)) : (t = i,
            e = Math.floor(t / this.sprite.ratio)),
            this.$viewport.width(t).height(e).css({
                "margin-top": Math.round(-1 * e / 2),
                "margin-left": Math.round(-1 * t / 2)
            }),
            this.sprite.width = Math.round(this.$image.prop("scrollHeight") * this.sprite.ratio),
            this.$viewport.scrollLeft(this.sprite.width * this.sprite.current)
        },
        onMouseDown: function(t) {
            t.preventDefault(),
            this.isMoving = !0,
            this.startX = t.clientX
        },
        onMouseMove: function(t) {
            t.preventDefault(),
            this.move(t.clientX)
        },
        onMouseUp: function(t) {
            t.preventDefault(),
            this.isMoving = !1
        },
        onTouchStart: function(t) {
            t.preventDefault(),
            this.isMoving = !0;
            var e = t.originalEvent.touches[0];
            this.startX = e.clientX
        },
        onTouchMove: function(t) {
            t.preventDefault(),
            this.move(t.originalEvent.touches[0].clientX)
        },
        onTouchEnd: function(t) {
            t.preventDefault(),
            this.isMoving = !1
        },
        move: function(t) {
            this.isMoving && (this.autospinTimer && this.stopAutospin(),
            t > this.startX + this.sensitivity && (this.startX = t,
            this.moveRight()),
            t < this.startX - this.sensitivity && (this.startX = t,
            this.moveLeft()))
        },
        moveRight: function() {
            0 === this.sprite.current ? this.sprite.current = this.sprite.steps - 1 : this.sprite.current = this.sprite.current - 1,
            this.$viewport.scrollLeft(this.sprite.width * this.sprite.current)
        },
        moveLeft: function() {
            this.sprite.current = (this.sprite.current + 1) % this.sprite.steps,
            this.$viewport.scrollLeft(this.sprite.width * this.sprite.current)
        },
        startAutospin: function() {
            this.autospinTimer = setInterval(i.i(a.bind)(function() {
                this.moveLeft()
            }, this), 500)
        },
        stopAutospin: function() {
            clearInterval(this.autospinTimer),
            this.autospinTimer = null
        },
        toggleAutospin: function() {
            this.autospinTimer ? this.stopAutospin() : this.startAutospin()
        }
    });
    e.a = u
}
, function(t, e, i) {
    "use strict";
    e.a = function() {
        return i(767)
    }
}
, function(t, e, i) {
    "use strict";
    var n = i(15)
      , r = i(43)
      , a = i(293)
      , s = i(29)
      , o = i(292)
      , l = n.a.extend({
        defaults: function() {
            return {
                renderer: "classic",
                style: "lit",
                hasWireframe: !0,
                wireframeEnable: !1,
                wireframeColor: "000000FF",
                hasVertexColor: !1,
                hasVertexAlpha: !1,
                vertexColorEnable: !0,
                vertexAlphaEnable: !!i.i(a.a)(),
                vertexColorColorSpace: i.i(a.a)() ? "srgb" : "linear",
                blendingEasingDuration: 1,
                blendingPauseDuration: 2.5,
                hasPoints: !1,
                hasLines: !1,
                hasTriangles: !1,
                pointSize: i.i(a.a)() ? 2 : 0,
                webVR: !1
            }
        },
        getName: function() {
            return "ShadingStyle"
        },
        init: function(t) {
            this.set("hasWireframe", !!t.getScene().getWireframeSize());
            var e = t.getModel().get("options")
              , n = e.shading;
            n && n.type && (this.set("style", n.type),
            this.set("renderer", n.renderer));
            var o = e.wireframe;
            o && (void 0 !== o.enable && this.set("wireframeEnable", o.enable),
            o.color && o.enable && this.set("wireframeColor", o.color));
            var l = n && n.pointSize;
            l && this.set("pointSize", l);
            var u = n && n.vertexColor;
            u && (this.set("vertexColorEnable", u.enable),
            this.set("vertexColorColorSpace", u.colorSpace),
            void 0 !== u.useAlpha && this.set("vertexAlphaEnable", true));
            var h = i.i(s.a)().blending;
            void 0 !== h && (this.set("style", "blending"),
            this.set("blendingPauseDuration", Math.abs(h))),
            i.i(a.a)() && r.a.getMaterial().then(function() {
                var e = t.getFeatures().material.getModel();
                this.set("renderer", "pbr", {
                    copyChannel: !0,
                    overrideTexture: !1
                }),
                e._style && this.set("style", e._style)
            }
            .bind(this))
        },
        setWireframeColorSmooth: function(t) {
            this.trigger("setWireframeColorSmooth", t)
        },
        getJSON: function() {
            return {
                shading: {
                    pointSize: this.get("pointSize"),
                    type: this.get("style"),
                    renderer: this.get("renderer"),
                    vertexColor: {
                        enable: this.get("vertexColorEnable"),
                        useAlpha: true,
                        colorSpace: this.get("vertexColorColorSpace")
                    }
                },
                wireframe: {
                    enable: this.get("wireframeEnable"),
                    color: this.get("wireframeColor")
                }
            }
        },
        editorGetJSON: function() {
            return this.getJSON()
        },
        validateJSON: function(t) {
            var e = [];
            return t.shading && (o.a.isEnumString(t.shading.type, ["lit", "shadeless", "matcap", "blending"]) || e.push("ShadingStyle.editorSetJSON shading.style must be an enum in [lit, shadeless,matcap]"),
            o.a.isEnumString(t.shading.renderer, ["classic", "pbr"]) || e.push("ShadingStyle.editorSetJSON shading.renderer must be an enum in [classic, pbr]"),
            t.shading.vertexColor && (o.a.isBoolean(t.shading.vertexColor.enable) || e.push("ShadingStyle.editorSetJSON shading.vertexColor.enable must be boolean"),
            o.a.isBoolean(true) || e.push("ShadingStyle.editorSetJSON shading.vertexColor.useAlpha must be boolean"),
            o.a.isEnumString(t.shading.vertexColor.colorSpace, ["srgb", "linear"]) || e.push("ShadingStyle.editorSetJSON shading.vertexColor.colorSpace must be an enum with value in [ srgb, linear ]"))),
            t.wireframe && (o.a.isBoolean(t.wireframe.enable) || e.push("ShadingStyle.editorSetJSON wireframe.enable must be boolean"),
            o.a.isString(t.wireframe.color) || e.push("ShadingStyle.editorSetJSON wireframe.color must be a string like 000000FF")),
            e.join("\n")
        },
        editorSetJSON: function(t) {
            var e = this.validateJSON(t);
            if (e)
                return e;
            var i = {};
            return t.shading && (t.shading.type && (i.style = t.shading.type),
            t.shading.renderer && (i.renderer = t.shading.renderer),
            t.shading.vertexColor && (i.vertexColorEnable = t.shading.vertexColor.enable,
            i.vertexAlphaEnable = true,
            i.vertexColorColorSpace = t.shading.vertexColor.colorSpace)),
            t.wireframe && (i.wireframeEnable = t.wireframe.enable,
            i.wireframeColor = t.wireframe.color),
            this.set(i),
            e
        }
    });
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(89)
      , a = i(470)
      , s = i(1024)
      , o = i(51)
      , l = n.a.osg
      , u = function(t, e, i) {
        a.a.call(this, i),
        this._pauseDuration = void 0 === e ? 2.5 : e,
        this._blendUniform = t,
        this._finishCallback = void 0,
        this._finished = !0,
        this._inPause = !1
    };
    u.prototype = l.objectInherit(a.a.prototype, {
        setPauseDuration: function(t) {
            this._pauseDuration = t
        },
        setFinishCallback: function(t) {
            this._finishCallback = t
        },
        changeBlend: function() {
            this._inPause = !1,
            this.reset(),
            this._finishCallback()
        },
        update: function(t, e) {
            if (!0 === this._finished)
                return !0;
            o.a.draw();
            var i = e.getFrameStamp().getSimulationTime();
            if (!0 === this._inPause) {
                if (i < this._startTime + this._pauseDuration + this._duration)
                    return !0;
                this.changeBlend()
            }
            var n = this.interpolate(i, t, e);
            return !0 === this._finished && (this._finished = !1,
            this._inPause = !0,
            this._finishCallback(!0)),
            n = l.smoothStep(0, 1, n),
            this._blendUniform.getInternalArray()[0] = n,
            !0
        }
    });
    var h = function(t, e) {
        l.Node.call(this),
        this._blendUniform = l.Uniform.createFloat1(0, "uBlend"),
        this._callbackUpdate = new u(this._blendUniform,t,e),
        this._textureMatcap = void 0,
        this._matcapUnit = 6,
        this.init()
    };
    h.prototype = l.objectInherit(l.Node.prototype, {
        setPauseDuration: function(t) {
            this._callbackUpdate.setPauseDuration(t)
        },
        setTransitionDuration: function(t) {
            this._callbackUpdate.setDuration(t)
        },
        setEnable: function(t) {
            this.setMatcapEnable(t),
            this._callbackUpdate._finished = !t
        },
        setMatcapEnable: function(t) {
            var e = this.getOrCreateStateSet();
            !0 === t ? e.setTextureAttributeAndModes(this._matcapUnit, this._textureMatcap, l.StateAttribute.OVERRIDE | l.StateAttribute.ON) : e.removeTextureAttribute(this._matcapUnit, "Texture")
        },
        setFinishCallback: function(t) {
            this._callbackUpdate.setFinishCallback(t)
        },
        init: function() {
            var t = i.i(s.a)()
              , e = this._resourceManager || r.default.instance
              , n = e.getOrCreateTexture(t);
            this._textureMatcap = n.texture,
            n.texture.setName("matcap"),
            this.getOrCreateStateSet().addUniform(this._blendUniform),
            this.getOrCreateStateSet().addUniform(l.Uniform.createInt1(this._matcapUnit, "sMatcap")),
            this.addUpdateCallback(this._callbackUpdate)
        }
    }),
    e.a = h
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(1025)
      , a = i(1028)
      , s = {
        FeatureName: "shadingStyle",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getNode = function() {
        return this._views[0]._nodeBlending
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(7))
      , a = i.n(r)
      , s = i(4)
      , o = i(43)
      , l = i(6)
      , u = i(686)
      , h = i(1026)
      , c = i(473)
      , d = i(70)
      , p = i(291)
      , f = i(1042)
      , g = i(688)
      , m = i(475)
      , v = i(1043)
      , _ = i(1038)
      , b = i(1040)
      , x = i(1046)
      , y = i(356)
      , S = i(51)
      , w = i(421)
      , C = i(328)
      , M = i(385)
      , T = i(684)
      , A = i(146)
      , E = s.a.osg
      , P = l.a.extend({
        initialize: function(t) {
            l.a.prototype.initialize.apply(this, arguments);
            var e = this.model;
            e.bind("change:webVR", this.onWebVRChanged, this),
            e.bind("change:renderer", this.onRendererChanged, this),
            e.bind("change:style", this.onShadingChanged, this),
            e.bind("change:pointSize", this.onPointSizeChanged, this),
            e.bind("change:wireframeEnable", this.onWireframeEnableChanged, this),
            e.bind("change:wireframeColor", this.onWireframeColorChanged, this),
            e.bind("change:vertexColorEnable", this.onVertexColorChanged, this),
            e.bind("change:vertexAlphaEnable", this.onVertexColorChanged, this),
            e.bind("change:vertexColorColorSpace", this.onVertexColorChanged, this),
            e.bind("change:blendingPauseDuration", this.onBlendingPauseDurationChanged, this),
            e.bind("change:blendingTransitionDuration", this.onBlendingTransitionDurationChanged, this),
            e.bind("setWireframeColorSmooth", this.onSetWireframeColorSmooth, this),
            this._viewer = t.context.getViewer(),
            this._viewerOSGJS = this._viewer.getViewerOSGJS();
            var i = this._generatorProxy = this._viewerOSGJS.getState().getShaderGeneratorProxy();
            i.addShaderGenerator("classic-lit", new p.a),
            i.addShaderGenerator("classic-shadeless", new f.a),
            i.addShaderGenerator("classic-blending", new g.a),
            i.addShaderGenerator("pbr-lit", new m.a),
            i.addShaderGenerator("pbr-shadeless", new v.a),
            i.addShaderGenerator("pbr-blending", new _.a),
            i.addShaderGenerator("classic-matcap", new b.a),
            i.addShaderGenerator("pbr-matcap", new b.a),
            i.addShaderGenerator("wireframe", new x.a),
            this._rootStateSet = this._viewerOSGJS.getSceneData().getOrCreateStateSet(),
            this._rootStateSet.setShaderGeneratorName(this.getCompilerName()),
            this.updateShadingGlobal(),
            this._nodeBlending = new h.a(e.get("blendingDuration")),
            this._nodeBlending.setName("ShadingStyle - Node Blending"),
            this.initBlendingPreset(t.context, "classic"),
            this.initBlendingPreset(t.context, "pbr"),
            this.initNodeBlending();
            var n = t.context.getScene();
            this._hasWireframe = !!n.getWireframeSize(),
            this._wireframeNodes = n.getWireframeNodes(),
            o.a.getPolygon().then(function() {
                this.model.set("hasVertexColor", C.a.hasVertexColor),
                this.model.set("hasVertexAlpha", C.a.hasVertexAlpha),
                !1 === C.a.hasVertexColor && this.model.set("vertexColorEnable", !1),
                !1 === C.a.hasVertexAlpha && this.model.set("vertexAlphaEnable", !1),
                this.onVertexColorChanged(),
                this.model.set("hasPoints", M.a.hasPoints),
                this.model.set("hasTriangles", M.a.hasTriangles),
                this.model.set("hasLines", M.a.hasLines)
            }
            .bind(this)),
            A.a.getBoxReady().then(this.onPointSizeChanged.bind(this)),
            a.a.all([o.a.getMaterial(), o.a.getWireframe()]).then(this.initWireframe.bind(this))
        },
        onWebVRChanged: function() {
            for (var t = this._wireframeNodes, e = 0, i = t.length; e < i; ++e)
                t[e].getStateSet().setRenderBinVR(this.model.get("webVR"))
        },
        onPointSizeChanged: function() {
            var t = A.a.getModelBoxWithDisplacement().radius();
            t *= this._viewerOSGJS.getCanvasPixelRatio() * this.model.get("pointSize"),
            T.a.cachedSquarePoint.setPointSize(t),
            T.a.cachedCirclePoint.setPointSize(t),
            S.a.draw()
        },
        initBlending: function(t, e) {
            var i = this._generatorProxy.getShaderGenerator(e + "-blending");
            i.setGraphicContext(this._viewerOSGJS.getGraphicContext()),
            i.addShader(c.a.DEFAULT),
            i.addShader(c.a.MATCAP | c.a.WIREFRAME),
            i.addShader(c.a.MATCAP | c.a.GEOMETRY | c.a.WIREFRAME),
            i.addShader(c.a.DEFAULT & ~c.a.DIFFUSE),
            i.addShader(c.a.DEFAULT)
        },
        initNodeBlending: function() {
            var t = this
              , e = function(e) {
                if ("matcap" !== t.model.get("style")) {
                    var i = t._generatorProxy.getShaderGenerator(t.model.get("renderer") + "-blending");
                    !0 === e ? i.onSameShader() : (i.toNextShader(),
                    t.onBlendingShader())
                }
            };
            this._nodeBlending.setFinishCallback(e);
            var i = this.model.get("style");
            this._nodeBlending.setEnable("blending" === i),
            "matcap" === i && this._nodeBlending.setMatcapEnable(!0)
        },
        initBlendingPreset: function(t, e) {
            var i = this._generatorProxy.getShaderGenerator(e + "-blending");
            i.setGraphicContext(this._viewerOSGJS.getGraphicContext()),
            i.addShader(c.a.DEFAULT),
            i.addShader(c.a.MATCAP | c.a.WIREFRAME),
            i.addShader(c.a.MATCAP | c.a.GEOMETRY | c.a.WIREFRAME),
            i.addShader(c.a.DEFAULT & ~c.a.DIFFUSE),
            i.addShader(c.a.DEFAULT)
        },
        initWireframe: function() {
            for (var t = this._wireframeNodes, e = t.length, i = !0 === this.model.get("wireframeEnable") ? d.a.NO_PICK_NO_SHADOW : 0, n = 0; n < e; ++n) {
                t[n].setNodeMask(i)
            }
            if (e > 0) {
                var r = t[0].getStateSet();
                r || (r = new u.a,
                t[0].setStateSet(r)),
                r.getUpdateCallbackList()[0].setFinishCallback(this.setWireframeNodesMask.bind(this, 0))
            }
            this.onWireframeColorChanged(),
            !0 === this.model.get("wireframeEnable") && this.onWireframeEnableChanged()
        },
        onBlendingPauseDurationChanged: function() {
            this._nodeBlending.setPauseDuration(this.model.get("blendingPauseDuration"))
        },
        onBlendingTransitionDurationChanged: function() {
            this._nodeBlending.setTransitionDuration(this.model.get("blendingTransitionDuration"))
        },
        onBlendingShader: function() {
            var t = this._generatorProxy.getShaderGenerator(this.getCompilerName()).getNextShader()
              , e = 0 != (t & c.a.WIREFRAME);
            this.model.set("wireframeEnable", e),
            e && this.model.set("wireframeColor", "ffffff66"),
            this.model.trigger("nextBlendingShader", t)
        },
        getCompilerName: function() {
            return this.model.get("renderer") + "-" + this.model.get("style")
        },
        updateShadingGlobal: function() {
            var t, e = this.model.get("style"), i = this.model.get("renderer"), n = "lit" === e || "blending" === e;
            t = "matcap" === e ? y.a.MATCAP : "pbr" === i && n ? y.a.PBR_LIT : "pbr" === i && "shadeless" === e ? y.a.PBR_SHADELESS : "classic" === i && n ? y.a.CLASSIC_LIT : y.a.CLASSIC_SHADELESS,
            y.a.set("mask", t)
        },
        copyChannels: function(t, e, r) {
            var a = {
                DiffusePBR: "DiffuseColor",
                AlbedoPBR: "DiffuseColor",
                AOPBR: "DiffuseIntensity"
            };
            i.i(n.each)(a, function(i, n) {
                var a = e.getChannels()
                  , s = a[n]
                  , o = a[i];
                "pbr" === t ? o.getTexture() ? s.getTexture() && !r || s.setTexture(o.getTexture().clone()) : s.getTexture() || s.setColor(o.getColor()) : (e.getWorkFlowPBRMetalSpec() && "DiffusePBR" !== n || !e.getWorkFlowPBRMetalSpec() && "AlbedoPBR" !== n) && (s.getTexture() ? s.getTexture() && !r || o.setTexture(s.getTexture().clone()) : o.getTexture() || o.setColor(s.getColor()))
            })
        },
        onRendererChanged: function(t, e, r) {
            this.onShadingChanged();
            var a = this.model.get("renderer")
              , s = void 0 === r.copyChannel || r.copyChannel
              , o = void 0 === r.overrideTexture || r.overrideTexture
              , l = this._viewer.getFeatures().material;
            if (!l)
                return void E.error("The renderer has been changed before the material feature is initialized");
            var u = l.getModel().attributes
              , h = this;
            s && i.i(n.each)(u, function(t) {
                h.copyChannels(a, t, o)
            }),
            S.a.draw()
        },
        onShadingChanged: function() {
            this.updateShadingGlobal();
            var t = this.model.get("style");
            this.model.set("hasWireframe", this._hasWireframe && "blending" !== t),
            this._nodeBlending.setEnable("blending" === t),
            this._rootStateSet.setShaderGeneratorName(this.getCompilerName()),
            "matcap" === t && this._nodeBlending.setMatcapEnable(!0),
            "blending" !== t && (this._wireEnable = void 0),
            "blending" === t ? (this._wireEnable = this.model.get("wireframeEnable"),
            this._wireColor = this.model.get("wireframeColor"),
            this.onBlendingShader()) : void 0 !== this._wireEnable && (this.model.set("wireframeEnable", this._wireEnable),
            this._wireEnable && this.model.set("wireframeColor", this._wireColor)),
            S.a.draw()
        },
        onWireframeColorChanged: function() {
            for (var t = this._wireframeNodes, e = 0, i = t.length; e < i; ++e)
                t[e].getStateSet().setWireframeColor(this.getRGBA())
        },
        onSetWireframeColorSmooth: function(t) {
            var e = this.model;
            e.off("change:wireframeColor", this.onWireframeColorChanged, this),
            e.set("wireframeColor", t),
            e.bind("change:wireframeColor", this.onWireframeColorChanged, this);
            for (var i = this._wireframeNodes, n = 0, r = i.length; n < r; ++n)
                i[n].getStateSet().setWireframeColorSmooth(this.getRGBA());
            e.off("change:wireframeColor", this.onWireframeColorChanged, this),
            e.set("wireframeColor", t),
            e.on("change:wireframeColor", this.onWireframeColorChanged, this)
        },
        setWireframeNodesMask: function(t) {
            for (var e = this._wireframeNodes, i = 0, n = e.length; i < n; ++i)
                e[i].setNodeMask(t);
            w.a.setWireframe(0 !== t)
        },
        onWireframeEnableChanged: function() {
            this.setWireframeNodesMask(d.a.NO_PICK_NO_SHADOW);
            for (var t = this._wireframeNodes, e = 0, i = t.length; e < i; ++e)
                t[e].getStateSet().setWireframeEnable(this.model.get("wireframeEnable"), this.getRGBA())
        },
        getRGBA: function() {
            var t = E.vec4.create();
            return function(e) {
                var i = e || this.model.get("wireframeColor");
                return t[0] = parseInt(i.substr(0, 2), 16) / 255,
                t[1] = parseInt(i.substr(2, 2), 16) / 255,
                t[2] = parseInt(i.substr(4, 2), 16) / 255,
                t[3] = parseInt(i.substr(6, 2), 16) / 255,
                t
            }
        }(),
        onVertexColorChanged: function() {
            var t = this.model.get("vertexColorEnable")
              , e = t && this.model.get("vertexAlphaEnable")
              , i = this.model.get("vertexColorColorSpace")
              , n = this._viewer.getFeatures().material;
            if (n) {
                var r = n.getModel().attributes;
                for (var a in r) {
                    var s = r[a];
                    s.set("vertexColorEnable", t && s.get("hasVertexColor")),
                    s.set("vertexColorColorSpace", i);
                    var o = e && s.get("hasVertexAlpha");
                    s.set("vertexAlphaEnable", o),
                    s.getChannels().Opacity.set("vertexAlphaEnable", o)
                }
                S.a.draw()
            }
        }
    });
    e.a = P
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(473)
      , a = i(439)
      , s = n.a.osg
      , o = r.a
      , l = o.prototype
      , u = a.a.prototype
      , h = function() {
        a.a.apply(this, arguments),
        this.assignMatcapTexture(),
        this._outputs = [],
        this._index = o.DEFAULT
    };
    h.prototype = s.objectInherit(a.a.prototype, {
        getCompilerName: function() {
            return "BlendingPBR"
        },
        getOrCreateMaterialAlbedo: function() {
            return this._index & o.DIFFUSE ? u.getOrCreateMaterialAlbedo.call(this) : this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialDiffusePBR: function() {
            return this._index & o.DIFFUSE ? u.getOrCreateMaterialDiffusePBR.call(this) : this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialRoughness: function() {
            return this._index & o.ROUGHNESS ? u.getOrCreateMaterialRoughness.call(this) : this.getOrCreateConstant("float", "defRough").setValue("0.2")
        },
        getOrCreateMaterialSpecularPBR: function() {
            return this._index & o.SPECULAR ? u.getOrCreateMaterialSpecularPBR.call(this) : this.getOrCreateConstantZero("vec3")
        },
        getOrCreateMaterialSpecularF0: function() {
            return this._index & o.SPECULAR ? u.getOrCreateMaterialSpecularF0.call(this) : this.getOrCreateConstant("float", "defF0").setValue("0.04")
        },
        setOutputs: l.setOutputs,
        computeShader: l.computeShader,
        createFragmentShaderGraph: l.createFragmentShaderGraph,
        getDefaultFragment: l.getDefaultFragment,
        getMatcapFragment: l.getMatcapFragment,
        getOrCreateMaterialNormal: l.getOrCreateMaterialNormal
    }),
    e.a = h
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(383)
      , a = n.a.osg
      , s = function() {
        r.a.apply(this, arguments),
        this._isLighted = !1,
        this._isVertexAlpha = !!this._material && this._material.getVertexAlphaEnable(),
        this._isVertexColored = this._isVertexAlpha,
        this.assignMatcapTexture()
    };
    s.prototype = a.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "Matcap"
        },
        getOrCreateChannel: function(t) {
            switch (t) {
            case "Opacity":
            case "NormalMap":
            case "BumpMap":
            case "Displacement":
                return r.a.prototype.getOrCreateChannel.call(this, t)
            }
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getMatcapColor(this.getOrCreateGeometryNormal());
            return [this.getFinalFrag(t)]
        }
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(474)
      , a = n.a.osg
      , s = function() {
        r.a.apply(this, arguments)
    };
    s.prototype = a.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "Outline"
        },
        getOrCreateChannel: function(t) {
            switch (t) {
            case "Displacement":
                return r.a.prototype.getOrCreateChannel.call(this, t)
            }
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {},
        createFragmentShaderGraph: function() {
            var t = this.createVariable("vec4").setValue("vec4(1.0, 0.0, 1.0, 1.0)")
              , e = this.getNode("glFragColor");
            return this.getNode("SetFromNode").inputs(t).outputs(e),
            [e]
        }
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(383)
      , a = n.a.osg
      , s = function() {
        r.a.apply(this, arguments),
        this._isLighted = !1
    };
    s.prototype = a.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "Shadeless"
        },
        getOrCreateChannel: function(t) {
            switch (t) {
            case "Opacity":
            case "DiffuseColor":
            case "EmitColor":
            case "DiffuseIntensity":
            case "Displacement":
                return r.a.prototype.getOrCreateChannel.call(this, t)
            }
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {}
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(439)
      , a = n.a.osg
      , s = function() {
        r.a.apply(this, arguments),
        this._isLighted = !1
    };
    s.prototype = a.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "ShadelessPBR"
        },
        getOrCreateChannel: function(t) {
            switch (t) {
            case "Opacity":
            case "EmitColor":
            case "DiffusePBR":
            case "AlbedoPBR":
            case "CavityPBR":
            case "AOPBR":
            case "Displacement":
                return r.a.prototype.getOrCreateChannel.call(this, t)
            }
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {}
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(439)
      , a = n.a.osg
      , s = function() {
        r.a.apply(this, arguments)
    };
    s.prototype = a.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "ShadingVr"
        },
        createFragmentShaderGraph: function() {
            var t, e = {};
            e.normal = this.getOrCreateMaterialNormal(),
            e.materialalbedopbr = this.getOrCreateMaterialDiffusePBR(),
            e.materialspecularf0 = this.getOrCreateMaterialSpecularF0(),
            e.materialspecularpbr = this.getOrCreateMaterialSpecularPBR();
            var i = this.createVariable("vec4")
              , n = this.getOrCreateMaterialNormal()
              , r = this.createVariable("vec3").setValue("normalize(vec3(0.0, 0.3, 0.9))")
              , a = this.createVariable("float");
            return this.getNode("InlineCode").code("%out = dot(%lightDir,%normal);").inputs({
                lightDir: r,
                normal: n
            }).outputs({
                out: a
            }),
            t = this.createVariable("vec3"),
            this.getNode("ComputeLight").inputs({
                normal: n,
                lightColor: this.createVariable("vec3").setValue("vec3(0.7, 0.7, 0.9)"),
                albedoColor: e.materialalbedopbr,
                prepSpec: i,
                viewDir: this.getOrCreateNormalizedViewEyeDirection(),
                lightDir: r,
                specular: e.materialspecularpbr,
                dotNL: a
            }).outputs({
                color: t
            }),
            t = this.applyEmissive(t),
            [this.getFinalFrag(t)]
        },
        getVertexColor: function(t) {
            if (void 0 !== t) {
                var e = this.createVariable("vec4");
                return this.getNode("InlineCode").code("%color.rgb = %diffuse.rgb * %vertexColor.r;").inputs({
                    diffuse: t,
                    vertexColor: this.getOrCreateVarying("vec4", "vVertexColor")
                }).outputs({
                    color: e
                }),
                e
            }
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {}
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(474)
      , a = n.a.osg
      , s = n.a.osgShadow
      , o = s.ShadowCastCompiler
      , l = function() {
        r.a.apply(this, arguments)
    };
    l.prototype = a.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "ShadowCastSkfb"
        },
        getFragmentShaderName: function() {
            return this.getCompilerName()
        },
        initAttributes: function() {
            for (var t = this._attributes, e = 0, i = t.length; e < i; e++) {
                var n = t[e].className();
                "Material" === n ? this._material = t[e] : "ShadowCastAttribute" === n ? this._shadowCastAttribute = t[e] : "Billboard" === n ? this._isBillboard = !!t[e] : "SkinningAttribute" === n ? this._skinningAttribute = t[e] : "MorphAttribute" === n && (this._morphAttribute = t[e])
            }
        },
        applyAlphaBlendMasking: function(t) {
            return this.isAlphaBlendedMaterial() ? (this.getNode("InlineCode").code("if(%alpha < 1.0) discard;").inputs({
                alpha: this.getOrCreateChannel("Opacity")
            }).outputs({
                out: t
            }),
            t) : t
        },
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.applyPointSizeCircle(t),
            this.applyAlphaMask(t),
            this.applyAlphaBlendMasking(t),
            o.prototype.createShadowCastDepth.call(this, t),
            [t]
        }
    }),
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(474)
      , a = n.a.osg
      , s = function() {
        r.a.apply(this, arguments),
        this._isVertexColored = !1
    };
    s.prototype = a.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "Skeleton"
        },
        initTextureAttributes: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.getNode("SetFromNode").inputs(this.getOrCreateUniform("vec4", "uColor")).outputs(t),
            [t]
        }
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(383)
      , a = n.a.osg
      , s = function() {
        r.a.apply(this, arguments),
        this._isVertexColored = !1
    };
    s.prototype = a.objectInherit(r.a.prototype, {
        getCompilerName: function() {
            return "Wireframe"
        },
        getOrCreateChannel: function(t) {
            switch (t) {
            case "Displacement":
                return r.a.prototype.getOrCreateChannel.call(this, t)
            }
        },
        registerTextureEnvironment: function() {},
        registerTextureShadow: function() {},
        createFragmentShaderGraph: function() {
            var t = this.getNode("glFragColor");
            return this.getNode("InlineCode").code("%out = vec4( %color.rgb * %color.a, %color.a);").inputs({
                color: this.getOrCreateUniform("vec4", "uColor")
            }).outputs({
                out: t
            }),
            [t]
        },
        declareScreenVertex: function(t) {
            var e = this.getOrCreateViewVertex()
              , i = this.createVariable("vec4");
            return this.getNode("InlineCode").code("%out = %pos; %out[3] += 0.005 / %proj[1][1];").inputs({
                proj: this.getOrCreateUniform("mat4", "uProjectionMatrix"),
                pos: e
            }).outputs({
                out: i
            }),
            this.getNode("MatrixMultPosition").inputs({
                matrix: this.getOrCreateUniform("mat4", "uProjectionMatrix"),
                vec: i
            }).outputs({
                vec: t
            }),
            t
        }
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(475)
      , a = i(688)
      , s = i(1029)
      , o = n.a.osg
      , l = function() {
        r.a.apply(this, arguments),
        this._CompilerBlending = s.a,
        this._stackShader = [],
        this._indexShader = 0,
        this._onSameShader = !0,
        this._gl = null
    }
      , u = a.a.prototype;
    l.prototype = o.objectInherit(r.a.prototype, {
        setGraphicContext: u.setGraphicContext,
        getNextIndexShader: u.getNextIndexShader,
        onSameShader: u.onSameShader,
        toNextShader: u.toNextShader,
        getNextShader: u.getNextShader,
        getCurrentShader: u.getCurrentShader,
        addShader: u.addShader,
        compileAllShaders: u.compileAllShaders,
        getOrCreateProgram: u.getOrCreateProgram
    }),
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(328)
      , r = i(291)
      , a = i(474)
      , s = function() {
        r.a.apply(this, arguments),
        this.setShaderCompiler(a.a),
        this._idCompiler = n.a.EARLYZ_COMPILER
    };
    s.prototype = r.a.prototype,
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(291)
      , r = i(1030)
      , a = function() {
        n.a.apply(this, arguments),
        this.setShaderCompiler(r.a)
    };
    a.prototype = n.a.prototype,
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(328)
      , r = i(291)
      , a = i(1031)
      , s = function() {
        r.a.apply(this, arguments),
        this.setShaderCompiler(a.a),
        this._idCompiler = n.a.EARLYZ_COMPILER
    };
    s.prototype = r.a.prototype,
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(291)
      , r = i(1032)
      , a = function() {
        n.a.apply(this, arguments),
        this.setShaderCompiler(r.a)
    };
    a.prototype = n.a.prototype,
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(475)
      , r = i(1033)
      , a = function() {
        n.a.apply(this, arguments),
        this.setShaderCompiler(r.a)
    };
    a.prototype = n.a.prototype,
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(475)
      , r = i(1034)
      , a = function() {
        n.a.apply(this, arguments),
        this.setShaderCompiler(r.a)
    };
    a.prototype = n.a.prototype,
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(328)
      , a = i(1035)
      , s = i(291)
      , o = n.a.osgShadow
      , l = n.a.osg
      , u = function() {
        o.ShadowCastShaderGenerator.apply(this, arguments),
        this.setShaderCompiler(a.a),
        this._idCompiler = r.a.EARLYZ_COMPILER,
        this._acceptAttributeTypes.add("SketchfabMaterial"),
        this._acceptAttributeTypes.add("Texture")
    };
    u.prototype = l.objectInherit(s.a.prototype, {
        filterAttributeTypes: function(t) {
            return !!s.a.prototype.filterAttributeTypes.call(this, t) || !this._acceptAttributeTypes.has(t.getType())
        }
    }),
    e.a = u
}
, function(t, e, i) {
    "use strict";
    var n = i(291)
      , r = i(1037)
      , a = i(328)
      , s = function() {
        n.a.apply(this, arguments),
        this.setShaderCompiler(r.a),
        this._idCompiler = a.a.WIREFRAME_COMPILER
    };
    s.prototype = n.a.prototype,
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(15)
      , r = i(29)
      , a = i(544)
      , s = i(909)
      , o = i(446);
    e.a = n.a.extend({
        defaults: {
            soundtracks: new s.a([]),
            currentSoundIndex: -1,
            visible: i.i(r.a)().showSound,
            autoplay: !0,
            playing: !1,
            volume: void 0,
            select: void 0
        },
        getName: function() {
            return "Sound"
        },
        init: function(t) {
            this._viewer = t.getViewer(),
            this.set("volume", o.a.getVolume());
            var e = this.get("soundtracks")
              , i = t.getModel().get("options").sound;
            i && i.soundtracks && i.soundtracks.forEach(function(t) {
                e.add(new a.a(t))
            })
        },
        getJSON: function() {
            var t = [];
            return this.get("soundtracks").each(function(e) {
                t.push(e.getJSON())
            }),
            {
                soundtracks: t
            }
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(1047)
      , a = i(1049)
      , s = {
        FeatureName: "sound",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getNode = function() {
        return this._views[0].getNode()
    }
    ,
    o.prototype.getWidgetNode = function() {
        return this._views[0].getNodeEditor()
    }
    ,
    o.prototype.prepareForScreenShot = function() {
        var t = n.a.prototype.prepareForScreenShot.call(this);
        return t && this._views[0].setPauseUpdate(!0),
        t
    }
    ,
    o.prototype.resetAfterScreenShot = function() {
        n.a.prototype.resetAfterScreenShot.call(this),
        this._views[0].setPauseUpdate(!1)
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(6)
      , a = i(446)
      , s = i(7)
      , o = i.n(s)
      , l = i(51)
      , u = i(29)
      , h = i(43)
      , c = i(90)
      , d = i(441)
      , p = i(146)
      , f = i(1050)
      , g = i(68)
      , m = i.n(g)
      , v = n.a.osg;
    e.a = r.a.extend({
        initialize: function(t) {
            r.a.prototype.initialize.apply(this, arguments),
            this._currentFrame = 0,
            this._currentSimulationTime = 0,
            this._soundPromises = [],
            this._soundObjects = [],
            this._context = t.context,
            this._viewer = this._context.getViewer(),
            this.model.set("enable", !i.i(u.a)().soundEnable),
            i.i(u.a)().soundMute && this.model.set("volume", 0),
            this._nodeFeature = new v.Node,
            this._nodeFeature.setName("Feature - Sound"),
            this._nodeFeature.setCullCallback(this),
            i.i(c.a)() && f.a.init(this.model, this._context, this._nodeFeature),
            this.listenTo(this.model, "change:playing", this.onPlayingChange.bind(this)),
            this.listenTo(this.model, "change:enable", this.onEnableChange.bind(this)),
            this.listenTo(this.model, "change:volume", this.updateVolume.bind(this));
            var e = this.model.get("soundtracks");
            this.listenTo(e, "add", this.onAdd.bind(this)),
            this.listenTo(e, "remove", this.onRemove.bind(this)),
            this.listenTo(e, "select", this.onSelectChanged.bind(this)),
            e.each(this.onAdd.bind(this)),
            h.a.resolveHasSound(e.length > 0),
            i.i(u.a)().soundPreload ? o.a.all(this._soundPromises).then(function() {
                h.a.resolveSoundsCanPlayTrough(!0),
                this.handleAnimLoadPromise(),
                this.updateVolume(this.model)
            }
            .bind(this)) : (this.handleAnimLoadPromise(),
            this.updateVolume(this.model)),
            i.i(c.a)() && (f.a.setListeners(),
            h.a.getModelDisplayed().then(function() {
                this.initDepthTexture()
            }
            .bind(this))),
            ["hidden", "mozHidden", "msHidden", "webkitHidden"].forEach(function(t) {
                document && void 0 !== document[t] && (this._hidden = t,
                this._visibilityChangeEvent = t.toLowerCase().split("hidden").shift() + "visibilitychange")
            }
            .bind(this)),
            this._visibilityChangeEvent && document.addEventListener(this._visibilityChangeEvent, this.tabChange.bind(this))
        },
        tabChange: function() {
            document[this._hidden] ? a.a.setEnabled(!1) : a.a.setEnabled(!0)
        },
        handleAnimLoadPromise: function() {
            h.a.getHasAnimation().then(function(t) {
                this._hasAnim = t,
                a.a.setHasAnim(t),
                h.a.getModelDisplayed().then(function() {
                    if (this.play(),
                    t) {
                        var e = this._viewer.getFeatures().animation.getModel();
                        this._featureAnimationModel = e,
                        this.animationTimeSync(),
                        e.bind("change:playing", this.onAnimationPlaying, this),
                        e.bind("change:speed", this.onAnimationSpeedChange, this),
                        e.bind("seek", this.onAnimationTimeSeek, this),
                        e.bind("change:currentUID", this.onUidChange, this)
                    }
                }
                .bind(this))
            }
            .bind(this))
        },
        animationTimeSync: function() {
            if (1 === this._featureAnimationModel.get("speed")) {
                var t = this._featureAnimationModel.getFirstEnabledAnimation();
                if (void 0 !== t) {
                    var e = t.get("duration")
                      , i = this._featureAnimationModel.get("progress") * e / 100;
                    i !== this._currentSimulationTime && (this._currentSimulationTime = i,
                    this.updatePositionAndTime())
                }
            }
        },
        updatePositionAndTime: function(t) {
            if (a.a.canPlay())
                for (var e = this._currentSimulationTime, n = 0, r = this._soundObjects.length; n < r; n++) {
                    var s = this._soundObjects[n];
                    s.setTime(e, t),
                    s.updatePosition(i.i(d.a)(s.getModel(), this._nodeFeature))
                }
        },
        onAnimationPlaying: function(t) {
            var e = t.get("playing");
            this.model.set("playing", e),
            e ? this.play() : this.pause()
        },
        onUidChange: function(t) {
            "-1" === t.get("currentUID") ? this.pause() : t.get("playing") && this.play()
        },
        onAnimationTimeSeek: function(t) {
            this._currentSimulationTime = t
        },
        onAnimationSpeedChange: function(t) {
            1 !== t.get("speed") ? this.pause() : this.play()
        },
        onSoundChange: function(t) {
            t.get("soundObject").updateFromModel(t),
            t === this.model.get("select") && f.a.updateGizmo(t),
            l.a.draw()
        },
        cull: function() {
            return this._hasAnim && this._featureAnimationModel && this.animationTimeSync(),
            i.i(c.a)() && !this._pauseUpdate && f.a.updateVisibility(),
            !0
        },
        setPauseUpdate: function(t) {
            this._pauseUpdate = t
        },
        getNode: function() {
            return this._nodeFeature
        },
        getNodeEditor: function() {
            return f.a.getNodeCamera()
        },
        onSelectChanged: function(t) {
            this.model.get("select") !== t && (this.model.set("select", t),
            this.model.get("soundtracks").trigger("select", t),
            f.a.updateGizmo(t),
            l.a.draw())
        },
        onAdd: function(t) {
            var e = a.a.createSound(t, this.model.get("playing"));
            if (-1 === t.get("distance")) {
                var n = p.a.getModelBoxWithDisplacement();
                t.set("distance", n.radius()),
                t.set("position", n.center(v.vec3.create())),
                this.onSelectChanged(t),
                this._hasAnim && t.set("sync", !0)
            }
            t.set("lastComputedScenePosition", v.vec3.create()),
            t.set("soundObject", e),
            t.on("change", this.onSoundChange.bind(this)),
            i.i(d.a)(t, this._nodeFeature),
            h.a.getModelDisplayed().then(function() {
                a.a.canPlay() && e.updateFromModel(),
                e.updatePosition(i.i(d.a)(e.getModel(), this._nodeFeature))
            }
            .bind(this)),
            this._soundObjects.push(e),
            i.i(c.a)() && !t.get("ambient") && f.a.addIcon(t);
            var r = o.a.defer();
            this._soundPromises.push(r),
            i.i(u.a)().soundPreload ? e.whenReady().then(function() {
                r.resolve(e)
            }) : r.resolve(e)
        },
        initDepthTexture: function() {
            f.a.initDepthTexture()
        },
        onRemove: function(t) {
            t === this.model.get("select") && this.onSelectChanged(),
            c.a && f.a.removeIcon(t);
            var e = t.get("soundObject");
            a.a.releaseSound(e),
            this._soundObjects.splice(this._soundObjects.indexOf(e), 1)
        },
        onEnableChange: function() {
            this.model.set("playing", this.model.get("enable"))
        },
        onPlayingChange: function() {
            this.model.get("enable") && (this.model.get("playing") ? this.onPlay() : this.onPause())
        },
        onPlay: function() {
            if ("-1" !== this._viewer.getFeatures().animation.getModel().get("currentUID")) {
                if (!this.model.get("enable"))
                    return this.model.set("playing", !1),
                    void this.pause();
                for (var t = 0, e = this._soundObjects.length; t < e; t++)
                    this._soundObjects[t].play();
                this.updatePositionAndTime(!0)
            }
        },
        onPause: function() {
            for (var t = 0, e = this._soundObjects.length; t < e; t++) {
                this._soundObjects[t].pause()
            }
            this.updatePositionAndTime()
        },
        play: function() {
            this.model.get("enable") && (this.model.set("playing", !0),
            this.onPlay())
        },
        pause: function() {
            this.model.get("enable") && (this.model.set("playing", !1),
            this.onPause())
        },
        updateVolume: function(t) {
            var e = t.get("volume");
            if (m.a.apple.device && e > 0)
                return void t.set("volume", 0);
            a.a.setVolume(e)
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n, r, a = i(4), s = i(89), o = i(138), l = i(594), u = i.n(l), h = i(593), c = i.n(h), d = i(329), p = i(87), f = i(70), g = i(51), m = i(43), v = i(441), _ = i(90), b = i(82), x = i(146), y = i(762), S = a.a.osg, w = a.a.osgUtil, C = new S.BlendFunc(S.BlendFunc.ONE,S.BlendFunc.ONE_MINUS_SRC_ALPHA), M = new S.Depth(S.Depth.DISABLE), T = S.StateAttribute.ON, A = S.vec4.fromValues(.109375, .6640625, .84765625, 1), E = S.vec4.fromValues(1, 1, 0, 1), P = S.vec4.fromValues(.8, .8, .8, 1), N = S.vec4.fromValues(1, 1, 0, 1), k = function() {
        return r || (r = S.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0)),
        r
    }, F = {
        init: function(t, e, i) {
            this.model = t,
            this._context = e,
            this._viewer = this._context.getViewer(),
            this._nodeFeature = i,
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._manipulator = this._viewerOSGJS.getManipulator(),
            this._icons = [],
            this._nodeCamera = new S.Camera,
            this._nodeCamera.setNearFarRatio(5e-4),
            this._nodeCamera.setName("Sound - Camera"),
            this._nodeCamera.getOrCreateStateSet().setRenderBinDetails(p.a.EDITOR_GIZMO, "RenderBin"),
            this._nodeCamera.setNodeMask(0),
            this._nodeGizmo = new S.MatrixTransform,
            this._nodeIcons = new S.MatrixTransform,
            this._geomHandle = new S.createTexturedBoxGeometry(0,0,0,.5,.5,.5),
            this._arc = w.GizmoGeometry.createCircleGeometry(64, 1, 3.2 * Math.PI),
            this._arcScale = new S.MatrixTransform,
            this._arcX = this._makeArc("arcX"),
            this._arcY = this._makeArc("arcY", .5 * -Math.PI, S.vec3.fromValues(1, 0, 0)),
            this._arcZ = this._makeArc("arcZ", .5 * Math.PI, S.vec3.fromValues(0, 1, 0)),
            this._handleX = this._makeHandle("handleX", S.vec3.fromValues(1, 0, 0)),
            this._handleY = this._makeHandle("handleY", S.vec3.fromValues(0, 1, 0)),
            this._handleZ = this._makeHandle("handleZ", S.vec3.fromValues(0, 0, 1)),
            this._handleXNeg = this._makeHandle("handleXNeg", S.vec3.fromValues(-1, 0, 0)),
            this._handleYNeg = this._makeHandle("handleYNeg", S.vec3.fromValues(0, -1, 0)),
            this._handleZNeg = this._makeHandle("handleZNeg", S.vec3.fromValues(0, 0, -1)),
            this.setGizmoStateset(this._arc, A),
            this.setGizmoStateset(this._geomHandle, A),
            this._nodeGizmo.editMask = w.NodeGizmo.PICK_ARROW | w.NodeGizmo.PICK_PLANE,
            this._nodeGizmo.setCullingActive(!1),
            this._nodeGizmo.setCullCallback(this),
            this._nodeFeature.addChild(this._nodeCamera),
            this._nodeCamera.addChild(this._nodeIcons),
            this._nodeCamera.addChild(this._nodeGizmo),
            this._nodeGizmo.addChild(this._arcScale),
            this.initStateset()
        },
        _makeHandle: function(t, e) {
            var i = new S.MatrixTransform;
            return i.setName(t),
            this._nodeGizmo.addChild(i),
            i.addChild(this._geomHandle),
            S.mat4.fromTranslation(i.getMatrix(), e),
            i
        },
        _makeArc: function(t, e, i) {
            var n = new S.MatrixTransform;
            return n.setName(t),
            this._arcScale.addChild(n),
            n.addChild(this._arc),
            e && i && S.mat4.fromRotation(n.getMatrix(), e, i),
            n
        },
        initStateset: function() {
            this._nodeCamera.getOrCreateStateSet().setTextureAttributeAndModes(0, d.a.dummyTexture, T),
            this._nodeCamera.getOrCreateStateSet().addUniform(S.Uniform.createInt(0, "uTextureDepth"))
        },
        setGizmoStateset: function(t, e) {
            var i = t.getOrCreateStateSet();
            i.setAttributeAndModes(o.a.createShader(u.a, c.a, "line", "Handle3D", "LINE"), T),
            i.setAttributeAndModes(C, T),
            i.setAttributeAndModes(M, T),
            i.addUniform(S.Uniform.createFloat4(e, "uColor"))
        },
        setListeners: function() {
            var t = this._viewer.getCanvas();
            t.addEventListener("dblclick", this.onDoubleClick.bind(this)),
            t.addEventListener("mousedown", this.onDragStart.bind(this)),
            t.addEventListener("mouseleave", this.onDragEnd.bind(this)),
            t.addEventListener("mouseup", this.onDragEnd.bind(this)),
            t.addEventListener("mousemove", this.onDragMove.bind(this))
        },
        updateDragHandle: function(t, e) {
            var i = t.getMatrix();
            S.mat4.fromTranslation(i, e);
            var n = t.getWorldMatrices()[0];
            S.mat4.getTranslation(e, n);
            var r = this.getIconSize(e);
            S.mat4.scale(i, i, r),
            t.dirtyBound()
        },
        cull: function() {
            var t = S.vec3.create();
            return function() {
                if (!i.i(_.a)())
                    return !0;
                var e = this.model.get("select");
                if (!e)
                    return !0;
                if (e !== this._select && (this._select = e,
                this._isSnapped = e.get("snap")),
                this._dragging && g.a.draw(),
                e.get("ambient"))
                    return !0;
                var n = e.get("distance")
                  , r = this._arcScale.getMatrix();
                S.mat4.scale(r, S.mat4.IDENTITY, S.vec3.set(t, n, n, n)),
                this._arcScale.dirtyBound(),
                this.updateDragHandle(this._handleX, S.vec3.set(t, n, 0, 0)),
                this.updateDragHandle(this._handleY, S.vec3.set(t, 0, n, 0)),
                this.updateDragHandle(this._handleZ, S.vec3.set(t, 0, 0, n)),
                this.updateDragHandle(this._handleXNeg, S.vec3.set(t, -n, 0, 0)),
                this.updateDragHandle(this._handleYNeg, S.vec3.set(t, 0, -n, 0)),
                this.updateDragHandle(this._handleZNeg, S.vec3.set(t, 0, 0, -n));
                var a = this.getGizmo()
                  , s = e.get("lastComputedScenePosition")
                  , o = e.get("snap");
                if (a && (a.isEditing() || this._isSnapped !== o)) {
                    this._isSnapped = o,
                    S.vec3.copy(t, s),
                    S.mat4.getTranslation(s, a.getMatrix());
                    var l = e.get("soundObject");
                    if (o ? (this.snapCheck(e, s),
                    l.updatePosition(i.i(v.a)(e, this._nodeFeature)),
                    this._displaySnapHelp()) : e.set("geometryUid", -1),
                    S.vec3.equals(t, s))
                        return !0;
                    l.updatePosition(s),
                    S.vec3.copy(e.get("position"), s)
                }
                return !0
            }
        }(),
        getNodeCamera: function() {
            return this._nodeCamera
        },
        getGizmo: function() {
            var t = this._viewer.getFeaturesManager();
            return t ? t.getNodeGizmo() : null
        },
        _displaySnapHelp: function() {
            new b.a({
                content: "Double-click to snap the sound on the object surface.",
                class: "info",
                delay: 2e3
            })
        },
        updateGizmo: function(t) {
            var e = this.getGizmo();
            if (e) {
                if (void 0 === t || t.get("ambient"))
                    return e.attachToGeometry(null),
                    e.attachToMatrixTransform(null),
                    this._nodeGizmo.setNodeMask(0),
                    void this.hideIcon(t);
                t.get("ambient") || this.addIcon(t),
                e.attachToMatrixTransform(this._nodeGizmo),
                this._nodeGizmo.setNodeMask(-1),
                t.get("snap") ? this._nodeGizmo.editMask = w.NodeGizmo.NO_PICK : this._nodeGizmo.editMask = w.NodeGizmo.PICK_ARROW | w.NodeGizmo.PICK_PLANE;
                var i = t.get("lastComputedScenePosition");
                S.mat4.setTranslation(this._nodeGizmo.getMatrix(), i),
                this._nodeGizmo.dirtyBound()
            }
        },
        initDepthTexture: function() {
            var t = this._viewer.getFeatures().postProcess.getCamera()._textureDepth;
            this._nodeCamera.getStateSet().setTextureAttributeAndModes(0, t, T);
            for (var e = 0, i = this._icons.length; e < i; e++)
                this._icons[e].getStateSet().setTextureAttributeAndModes(0, t, T)
        },
        getIconSize: function() {
            var t = S.vec4.create()
              , e = S.vec3.create()
              , i = S.vec3.create();
            return function(n) {
                var r = this._viewer.getCamera()
                  , a = .02 * this._viewerOSGJS.getCanvasClientWidth() * S.mat4.getScale(t, r.getProjectionMatrix())[0];
                this._manipulator.getEyePosition(e);
                var s = S.vec3.dist(e, n || S.vec3.ZERO) / a;
                return S.vec3.set(i, s, s, s)
            }
        }(),
        updateIcons: function() {
            var t = S.quat.create()
              , e = S.mat4.create()
              , n = S.vec4.create()
              , r = S.vec3.create();
            return function() {
                if (i.i(_.a)() && this.isSoundTabOpen()) {
                    var a = this.model.get("select")
                      , s = this._viewer.getCamera()
                      , o = .02 * this._viewerOSGJS.getCanvasClientWidth() * S.mat4.getScale(n, s.getProjectionMatrix())[0];
                    this._manipulator.getEyePosition(r);
                    var l, u, h;
                    S.mat4.invert(e, s.getViewMatrix()),
                    S.mat4.getRotation(t, e);
                    for (var c = 0, d = this._icons.length; c < d; c++) {
                        u = this._icons[c];
                        h = u.getUserData().get("soundObject").getModel(),
                        u !== this._hovered && this.setIconSelected(u, a === h),
                        l = u.getMatrix();
                        var p = h.get("lastComputedScenePosition")
                          , f = S.vec3.dist(r, p) / o;
                        S.vec3.set(n, f, f, f),
                        S.mat4.fromRotationTranslationScale(l, t, p, n),
                        u.dirtyBound()
                    }
                }
            }
        }(),
        addIcon: function(t) {
            var e, i;
            if (i = this._findIcon(t))
                return i.setNodeMask(-1),
                i;
            e = k(),
            i = new S.MatrixTransform,
            i.addChild(e);
            var r = s.default.instance
              , a = r.getOrCreateTexture(y);
            this.setGizmoStateset(i, P);
            var l = i.getOrCreateStateSet();
            l.setTextureAttributeAndModes(1, a.texture, T),
            l.addUniform(S.Uniform.createInt(1, "uTextureIcon")),
            l.addUniform(S.Uniform.createInt(0, "uAttachedToCamera")),
            l.addUniform(S.Uniform.createInt(1, "uEnable")),
            n || (n = o.a.createShader(u.a, c.a, "icon", "LightingIcon", "ICON")),
            l.setAttributeAndModes(n),
            m.a.getModelDisplayed().then(this.initDepthTexture.bind(this));
            var h = this._icons.length;
            i.setName("SOUNDIconMT_" + h);
            var d = i.getMatrix();
            S.mat4.fromTranslation(d, t.get("lastComputedScenePosition")),
            S.mat4.scale(d, d, this.getIconSize()),
            this._icons.push(i),
            this._nodeIcons.addChild(i),
            i.setUserData(t),
            i.dirtyBound()
        },
        hideIcon: function(t) {
            var e = this._findIcon(t);
            e && e.setNodeMask(0)
        },
        _findIcon: function(t) {
            for (var e = 0; e < this._icons.length; e++)
                if (this._icons[e].getUserData() === t)
                    return this._icons[e];
            return null
        },
        snapCheck: function() {
            var t = new w.SphereIntersector
              , e = new w.IntersectionVisitor;
            return function(n, r) {
                var a = x.a.getModelBoxWithDisplacement().radius()
                  , s = 10 * a;
                e.setTraversalMask(f.a.PICK_GEOMETRY_SLOW),
                t.set(r, s),
                e.setIntersector(t),
                this._context.getScene().getPolygonNode().accept(e);
                var o = t.getIntersections();
                o.length && (o.sort(function(t, e) {
                    return t.ratio - e.ratio
                }),
                i.i(v.b)(n, this._viewer.getFeaturesManager(), o[0]))
            }
        }(),
        onDragStart: function(t) {
            if (this.isSoundTabOpen()) {
                var e = this._viewer.getFeaturesManager();
                if (e) {
                    var i = void 0 === t.offsetX ? t.layerX : t.offsetX
                      , n = void 0 === t.offsetY ? t.layerY : t.offsetY
                      , r = e.computeNearestIntersection2D(i, n, f.a.PICK_GEOMETRY, this._nodeCamera);
                    if (this._dragging = !1,
                    r) {
                        var a = r.nodepath[r.nodepath.length - 1];
                        if (a === k()) {
                            var s = r.nodepath[r.nodepath.length - 2].getUserData();
                            s && this.model.get("soundtracks").trigger("select", s)
                        } else if (a === this._geomHandle) {
                            var o = this.model.get("select");
                            if (void 0 === o)
                                return;
                            var l = this.getGizmo();
                            if (!l || l.isEditing())
                                return;
                            this._viewer._viewer._eventProxy.StandardMouseKeyboard.mouseup(t),
                            this._viewer._viewer._eventProxy.StandardMouseKeyboard._enable = !1,
                            this._dragging = !0,
                            this.model.set("dragging", !0);
                            var u = l.getWorldMatrices()[0]
                              , h = S.vec3.create();
                            S.vec3.transformMat4(h, h, u),
                            l.getCanvasPositionFromWorldPoint(h, h),
                            this._draggingStartGizmoCenterX = h[0],
                            this._draggingStartGizmoCenterY = h[1],
                            this._draggingStartX = void 0 === t.offsetX ? t.layerX : t.offsetX,
                            this._draggingStartY = void 0 === t.offsetY ? t.layerY : t.offsetY,
                            i = (this._draggingStartX - this._draggingStartGizmoCenterX) / this._viewer.getWidth(),
                            n = (this._draggingStartY - this._draggingStartGizmoCenterY) / this._viewer.getHeight(),
                            this._draggingStartScreenDistance = Math.sqrt(i * i + n * n),
                            this._draggingStartDistance = o.get("distance")
                        }
                    }
                }
            }
        },
        onHover: function(t, e, i) {
            var n = this._viewer.getFeaturesManager();
            if (n) {
                var r, a = n.computeNearestIntersection2D(t, e, f.a.PICK_GEOMETRY, this._nodeCamera);
                if (a) {
                    var s = a.nodepath[a.nodepath.length - 1];
                    if (s === this._hovered || a.nodepath.length > 2 && a.nodepath[a.nodepath.length - 2] === this._hovered)
                        return;
                    s === k() ? (this._hovered = a.nodepath[a.nodepath.length - 2],
                    this.setIconSelected(this._hovered, !0),
                    g.a.draw()) : s === this._geomHandle && (this._hovered = s,
                    r = this._geomHandle.getStateSet().getUniform("uColor").getInternalArray(),
                    S.vec4.copy(r, E),
                    g.a.draw())
                } else
                    this._hovered && (this._hovered === this._geomHandle ? (r = this._geomHandle.getStateSet().getUniform("uColor").getInternalArray(),
                    S.vec4.copy(r, A)) : this._hovered.getUserData() !== i && this.setIconSelected(this._hovered, !1),
                    g.a.draw(),
                    this._hovered = !1)
            }
        },
        setIconSelected: function(t, e) {
            var i = t.getStateSet().getUniformList()
              , n = i.uColor.getAttribute().getInternalArray();
            e ? S.vec4.copy(n, N) : S.vec4.copy(n, P)
        },
        onDragMove: function(t) {
            if (this.isSoundTabOpen()) {
                var e = void 0 === t.offsetX ? t.layerX : t.offsetX
                  , i = void 0 === t.offsetY ? t.layerY : t.offsetY
                  , n = this.model.get("select");
                if (!this._dragging)
                    return void this.onHover(e, i, n);
                if (void 0 !== n) {
                    var r = this.getGizmo();
                    if (r) {
                        if (r.isEditing())
                            return void this.onDragEnd();
                        e = (e - this._draggingStartGizmoCenterX) / this._viewer.getWidth(),
                        i = (i - this._draggingStartGizmoCenterY) / this._viewer.getHeight();
                        var a = Math.sqrt(e * e + i * i);
                        a = a * this._draggingStartDistance / this._draggingStartScreenDistance,
                        n.set("distance", a),
                        g.a.draw()
                    }
                }
            }
        },
        onDragEnd: function() {
            if (this._dragging && this.isSoundTabOpen()) {
                void 0 !== this.model.get("select") && (this._viewer._viewer._eventProxy.StandardMouseKeyboard._enable = !0,
                this._dragging = !1,
                this.model.set("dragging", !1),
                g.a.draw())
            }
        },
        onDoubleClick: function(t) {
            if (this.isSoundTabOpen()) {
                var e = this.model.get("select");
                if (void 0 !== e && !e.get("ambient")) {
                    var n = this._viewer.getFeaturesManager();
                    if (n) {
                        var r = n.pickNearestSurface(t);
                        if (r) {
                            i.i(v.b)(e, n, r),
                            e.get("snap") || e.set("geometryUid", -1);
                            e.get("soundObject").updatePosition(i.i(v.a)(e, this._nodeFeature))
                        }
                    }
                }
            }
        },
        isSoundTabOpen: function() {
            var t = this._viewer.getOptions().widgetAPI;
            return t && "sound" === t.getTabbedWidget().get()
        },
        removeIcon: function(t) {
            for (var e = 0, i = this._icons.length; e < i; e++) {
                var n = this._icons[e];
                if (n.getUserData() === t) {
                    n.getParents()[0].removeChild(n);
                    break
                }
            }
        },
        updateVisibility: function() {
            this.isSoundTabOpen() ? (this._nodeCamera.setNodeMask(f.a.NO_SHADOW),
            this.updateGizmo(this.model.get("select")),
            this.updateIcons()) : this._nodeCamera.setNodeMask(0)
        }
    };
    e.a = F
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e) {
        for (var i = e || 1, n = 1, r = t.length / i; n < r; ++n)
            for (var a = (n - 1) * i, s = n * i, o = 0; o < i; ++o)
                t[s + o] += t[a + o];
        return t
    };
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = function(t) {
        for (var e = 1, i = t.length / 4; e < i; ++e) {
            var n = 4 * (e - 1)
              , r = 4 * e
              , a = t[n]
              , s = t[n + 1]
              , o = t[n + 2]
              , l = t[n + 3]
              , u = t[r]
              , h = t[r + 1]
              , c = t[r + 2]
              , d = t[r + 3];
            t[r] = a * d + s * c - o * h + l * u,
            t[r + 1] = -a * c + s * d + o * u + l * h,
            t[r + 2] = a * h - s * u + o * d + l * c,
            t[r + 3] = -a * u - s * h - o * c + l * d
        }
        return t
    };
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e) {
        for (var i = e || 0, n = t.length, r = t[i], a = i + 1; a < n; ++a) {
            var s = t[a];
            r = t[a] = r + (s >> 1 ^ -(1 & s))
        }
        return t
    };
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e, i, r) {
        for (var a = t[n.IMPLICIT_HEADER_EXPECTED_INDEX], s = t[n.IMPLICIT_HEADER_MASK_LENGTH], o = new Uint32Array(t.subarray(n.IMPLICIT_HEADER_LENGTH, s + n.IMPLICIT_HEADER_LENGTH)), l = 32 * s - e.length, u = 0; u < s; ++u)
            for (var h = o[u], c = 32 * u, d = u === s - 1 ? l : 0, p = d; p < 32; ++p,
            ++c)
                e[c] = h & 1 << 31 >>> p ? t[i++] : r ? a : a++;
        return e
    };
    n.IMPLICIT_HEADER_PRIMITIVE_LENGTH = 0,
    n.IMPLICIT_HEADER_MASK_LENGTH = 1,
    n.IMPLICIT_HEADER_EXPECTED_INDEX = 2,
    n.IMPLICIT_HEADER_LENGTH = 3,
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e, i) {
        for (var n = t.length / i, r = 0; r < n; ++r)
            for (var a = r * i, s = 0; s < i; ++s)
                e[a + s] = t[r + n * s];
        return e
    };
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e, i) {
        var n = t.length / e
          , r = new Uint8Array(n)
          , a = i.length - 1;
        r[i[0]] = 1,
        r[i[1]] = 1,
        r[i[2]] = 1;
        for (var s = 2; s < a; ++s) {
            var o = s - 2
              , l = i[o]
              , u = i[o + 1]
              , h = i[o + 2]
              , c = i[o + 3];
            if (1 !== r[c]) {
                r[c] = 1,
                l *= e,
                u *= e,
                h *= e,
                c *= e;
                for (var d = 0; d < e; ++d)
                    t[c + d] = t[c + d] + t[u + d] + t[h + d] - t[l + d]
            }
        }
        return t
    };
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = function(t, e, i) {
        for (var n = i[0], r = t.length, a = 0; a < r; ++a) {
            var s = n - t[a];
            e[a] = s,
            n <= s && (n = s + 1)
        }
        return i[0] = n,
        e
    };
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = n.a.osgAnimation
      , s = function() {
        r.NodeVisitor.call(this),
        this._stats = {
            nodeCount: 0,
            matrixTransformCount: 0,
            geometryCount: 0,
            boneCount: 0,
            skeletonCount: 0,
            morphGeometryCount: 0,
            rigGeometryCount: 0
        }
    };
    s.NodeCount = 0,
    s.MatrixTransformCount = 0,
    s.BoneCount = 0,
    s.MorphGeometryCount = 0,
    s.RigGeometryCount = 0,
    s.GeometryCount = 0,
    s.SkeletonCount = 0;
    var o = r.Node.typeID
      , l = r.MatrixTransform.typeID
      , u = a.Bone.typeID
      , h = a.Skeleton.typeID
      , c = r.Geometry.typeID
      , d = a.MorphGeometry.typeID
      , p = a.RigGeometry.typeID;
    s.prototype = r.objectInherit(r.NodeVisitor.prototype, {
        getStats: function() {
            return this._stats
        },
        apply: function(t) {
            var e = this._stats
              , i = t.typeID;
            t.userDataMap && t.userDataMap.wireframe || (i === o ? e.nodeCount++ : i === l ? e.matrixTransformCount++ : i === c ? e.geometryCount++ : i === u ? e.boneCount++ : i === h ? e.skeletonCount++ : i === d ? e.morphGeometryCount++ : i === p ? (e.rigGeometryCount++,
            t.getSourceGeometry().typeID === d && e.morphGeometryCount++) : console.error("Unknown node type ID : " + i + " " + t.className()),
            this.traverse(t))
        }
    }),
    e.a = s
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(29)
      , a = i(51)
      , s = n.a.osg
      , o = [[.263385, -.0252475], [-.38545, .054485], [-.139795, -.5379925], [-.2793775, .6875475], [.7139025, .4710925], [.90044, -.16422], [.4481775, -.82799], [-.9253375, -.2910625], [.3468025, 1.02292], [-1.13742, .33522], [-.7676225, -.9123175], [-.2005775, -1.1774125], [-.926525, .96876], [1.12909, -.7500325], [.9603, 1.14625]]
      , l = function(t) {
        return l.instance ? l.instance : (this._canBeEnabled = i.i(r.a)().supersample,
        this._viewer = t,
        this._sampleCount = 15,
        this._isSupersampling = !1,
        this._frameNum = 1,
        this._switch = !0,
        l.instance = this,
        this)
    };
    l.prototype = {
        getSampleCount: function() {
            return this._sampleCount
        },
        setCanBeEnabled: function(t) {
            this._canBeEnabled = i.i(r.a)().supersample && t
        },
        canBeEnabled: function() {
            return this._canBeEnabled
        },
        getOrCreateJitterUniform: function() {
            return this._jitterUniform ? this._jitterUniform : (this._jitterUniform = s.Uniform.createFloat4("uHalton"),
            this._jitter = this._jitterUniform.getInternalArray(),
            this._jitter[2] = 1,
            this._jitterUniform)
        },
        getSortedJitterTable: function() {
            return o
        },
        updateUniforms: function() {
            var t = this.getSortedJitterTable()[this._frameNum - 1];
            this._jitter[0] = t[0],
            this._jitter[1] = t[1]
        },
        setSwitch: function(t) {
            this._switch = t
        },
        updateFrame: function() {
            return this._jitter[2] = -this._jitter[2],
            this._postProcess.getModel().trigger("pingPongTexture0", this._jitter[2] > 0),
            !!this._isSupersampling && (this._jitter[3] = this._frameNum,
            this.updateUniforms(),
            this._frameNum++,
            this.isSupersampled() && (this._isSupersampling = !1),
            this._isSupersampling)
        },
        update: function(t, e) {
            if (!this._switch)
                return !0;
            var i = e.getFrameStamp().getFrameNumber();
            return this._lastUpdateFrame === i || (this._lastUpdateFrame = i,
            !this._postProcess && (this._postProcess = this._viewer.getFeatures().postProcess,
            !this._postProcess) || (this.updateFrame() && a.a.drawSameFrame(),
            !0))
        },
        isSupersampled: function() {
            return this._frameNum > this._sampleCount
        },
        isEnabled: function() {
            return this._isSupersampling
        },
        forceEnable: function() {
            this._isSupersampling = !0,
            this._jitter[0] = 0,
            this._jitter[1] = 0,
            this._jitter[2] = 2 * Math.sign(this._jitter[2]),
            this._jitter[3] = 0,
            this._frameNum = 1,
            a.a.drawSameFrame()
        },
        enable: function() {
            this.canBeEnabled() && 1 === this._frameNum && this.forceEnable()
        },
        reset: function() {
            this._jitter[0] = 0,
            this._jitter[1] = 0,
            this._jitter[2] = Math.sign(this._jitter[2]),
            this._frameNum = 1,
            this._isSupersampling = !1
        },
        setRoot: function(t) {
            t.getOrCreateStateSet().addUniform(this.getOrCreateJitterUniform());
            var e = new s.Node("supersampleUpdateInterceptor");
            t.addChild(e),
            e.addUpdateCallback(this)
        }
    },
    e.a = l
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(18)
      , a = i.n(r)
      , s = i(29)
      , o = i(1070)
      , l = i(1073)
      , u = i(146)
      , h = n.a.osg;
    i.i(s.a)().vrForceRaf && (n.a.osgViewer.Viewer.prototype.setVRDisplay = function(t) {
        this._hmd = t,
        this._requestAnimationFrame = t.requestAnimationFrame.bind(t)
    }
    );
    var c = a.a.Model.extend({
        defaults: {
            enable: !1,
            worldFactor: -1,
            deviceInfo: void 0,
            hasNativeHMD: !!navigator.getVRDisplays,
            modeLauncher: !1,
            hit: void 0,
            floorHeight: 0,
            humanMatrix: h.mat4.create(),
            humanInAir: !1
        },
        init: function(t) {
            this._context = t,
            this._scene = t.getScene(),
            this._viewer = t.getViewer()
        },
        initAfterFirstFrame: function() {
            navigator.getVRDisplays && navigator.getVRDisplays().then(function(t) {
                this.set("hasNativeHMD", t.length > 0)
            }
            .bind(this)),
            this.set("deviceInfo", this._initDeviceInfo());
            var t = this._context.getModel().get("options").vr;
            if (t && t.scale > 0) {
                this.set("worldFactor", t.scale),
                this.set("floorHeight", t.floorHeight);
                var e = this.get("humanMatrix")
                  , n = t.initialCamera;
                h.mat4.fromQuat(e, n.rotation),
                h.mat4.setTranslation(e, n.position)
            }
            this.initBoundAndWorldFactor(),
            this.set("enable", i.i(s.a)().cardboard > 0)
        },
        _getBoundRadius: function() {
            return u.a.getModelBoxWithDisplacement().radius()
        },
        isDiorama: function() {
            return this._getBoundRadius() < 2 * this.get("worldFactor")
        },
        getMinimumWorldFactor: function() {
            return .001 * this._getBoundRadius()
        },
        getMaximumWorldFactor: function() {
            return 10 * this._getBoundRadius()
        },
        _makeValidWorldFactor: function() {
            var t = this.get("worldFactor")
              , e = this.getMinimumWorldFactor()
              , i = this.getMaximumWorldFactor();
            if (t < e * u.a.BIAS_MIN || t > i * u.a.BIAS_MAX) {
                var n = u.a.getModelBoxWithDisplacement()
                  , r = n.getMin()[2]
                  , a = n.radius();
                this.set("worldFactor", .5 * a),
                this.set("floorHeight", r);
                var s = n.center(h.vec3.create());
                s[1] -= 1.2 * a,
                s[2] = r,
                h.mat4.fromTranslation(this.get("humanMatrix"), s)
            } else
                this.set("worldFactor", Math.min(Math.max(t, e), i))
        },
        initBoundAndWorldFactor: function() {
            this._makeValidWorldFactor(),
            this.trigger("uiReady")
        },
        _initDeviceInfo: function() {
            var t = new l.a(!1)
              , e = new o.a(t.getDeviceParams());
            return i.i(s.a)().cardboard > 1 && e.setViewer(o.a.Viewers.CardboardV2),
            e
        },
        getName: function() {
            return "WebVR"
        },
        getJSON: function() {
            var t = h.mat4.copy(h.mat4.create(), this.get("humanMatrix"))
              , e = h.mat4.getScale(h.vec3.create(), t);
            h.vec3.set(e, 1 / e[0], 1 / e[1], 1 / e[2]);
            var i = h.mat4.scale(t, t, e)
              , n = h.quat.create();
            return h.quat.normalize(n, h.mat4.getRotation(n, i)),
            {
                scale: this.get("worldFactor"),
                initialCamera: {
                    position: h.mat4.getTranslation(h.vec3.create(), i),
                    rotation: n
                },
                floorHeight: this.get("floorHeight")
            }
        }
    });
    e.a = c
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(138)
      , a = i(70)
      , s = i(87)
      , o = i(386)
      , l = i(68)
      , u = i.n(l)
      , h = i(825)
      , c = i.n(h)
      , d = i(824)
      , p = i.n(d)
      , f = i(549)
      , g = n.a.osg
      , m = {
        SCALE_THRESHOLD: .3,
        CIRCULAR_BUTTON: 0,
        TRIGGER: 1,
        MENU: 3
    }
      , v = {
        SCALE_THRESHOLD: .7,
        STICK: 0,
        TRIGGER_UP: 1,
        TRIGGER_SIDE: 2,
        AX: 3,
        BY: 4,
        HOME: 5
    }
      , _ = {
        CIRCULAR_BUTTON: 0,
        HOME: 1,
        CIRCULAR_UP: 5,
        CIRCULAR_DOWN: 4
    }
      , b = {
        SCALE_THRESHOLD: .7,
        CIRCULAR_BUTTON: 0
    }
      , x = {
        TOUCHPAD_BUTTON: 0
    }
      , y = function(t, e) {
        g.MatrixTransform.call(this),
        this.setName("WebVR - Controller"),
        this.setNodeMask(a.a.NO_PICK_NO_SHADOW),
        this._pointerMT = new g.MatrixTransform,
        this._proxyControllerMT = new g.MatrixTransform,
        this._geomPointer = g.createTexturedQuadGeometry(-.5, 0, 0, 1, 0, 0, 0, 1, 0),
        this._geomController = new g.createTexturedBoxGeometry(0,-.1,0,.1,.2,.1),
        this.addChild(this._proxyControllerMT),
        this.addChild(this._pointerMT),
        this._pointerMT.addChild(this._geomPointer),
        this._proxyControllerMT.addChild(this._geomController),
        this._activeController = void 0,
        this._model = t,
        this._postMultRotate = t._viewer.getViewerOSGJS().getManipulator().getFirstPersonManipulator().getPostMultRotate(),
        this._uPointerAlpha = g.Uniform.createFloat1(1, "uAlpha"),
        this._hitScaleOffset = 20,
        this._canvas = e,
        this._controllerMeshDisplay = void 0,
        this._pressedButtons = [],
        this._gamepadType = void 0,
        this._pointerClicked = !1,
        this._timeSinceLastPointerClick = 0,
        this._menuPressed = !1,
        this._clickPressed = !1,
        this._teleportPressed = !1,
        this._menuPressedFrame = !1,
        this._clickPressedFrame = !1,
        this._teleportPressedFrame = !1,
        this._scaleValueChange = 0,
        this._cbPointerDown = this.onPointerDown.bind(this),
        this._cbPointerUp = this.onPointerUp.bind(this),
        this._cbMouseDown = this.onMouseDown.bind(this),
        this._cbClick = this.onClick.bind(this),
        this._canvasX = 0,
        this._canvasY = 0,
        this._preferLeftHand = !1,
        this.init()
    };
    y.prototype = g.objectInherit(g.MatrixTransform.prototype, {
        init: function() {
            var t = this._proxyControllerMT.getOrCreateStateSet();
            this._createMaterialWithColor(t, g.vec3.fromValues(.8481, .8481, .8481));
            var e = this._geomPointer.getOrCreateStateSet();
            e.addUniform(this._uPointerAlpha),
            e.setRenderBinDetails(s.a.VR_CURSOR, "RenderBin"),
            e.setAttributeAndModes(new g.BlendFunc(g.BlendFunc.ONE,g.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            e.setAttributeAndModes(r.a.createShader(c.a, p.a, "webVR-laser", "VRLaser"))
        },
        _createMaterialWithColor: function(t, e) {
            t.setShaderGeneratorName("shading-vr");
            var i = f.a.createMaterialModel(t);
            i.set("hasVertexColor", !0),
            i.set("vertexColorEnable", !0),
            i.set("vertexColorColorSpace", "linear");
            var n = i.getChannels();
            n.AlbedoPBR.setColor(e),
            n.AlbedoPBR.setEnable(!0),
            n.MetalnessPBR.setFactor(0),
            n.MetalnessPBR.setEnable(!0),
            n.RoughnessPBR.setFactor(.5),
            n.RoughnessPBR.setEnable(!0),
            i.trigger("apply"),
            t.setAttributeAndModes(t.getAttribute("SketchfabMaterial"))
        },
        setEventListeners: function() {
            this._model.get("hasNativeHMD") ? window.addEventListener("click", this._cbClick) : (this._canvas.addEventListener("touchstart", this._cbPointerDown),
            this._canvas.addEventListener("touchend", this._cbPointerUp),
            this._canvas.addEventListener("mousedown", this._cbMouseDown),
            this._canvas.addEventListener("mouseup", this._cbPointerUp))
        },
        removeEventListeners: function() {
            this._model.get("hasNativeHMD") ? window.addEventListener("click", this._cbClick) : (this._canvas.removeEventListener("touchstart", this._cbPointerDown),
            this._canvas.removeEventListener("touchend", this._cbPointerUp),
            this._canvas.removeEventListener("mousedown", this._cbMouseDown),
            this._canvas.removeEventListener("mouseup", this._cbPointerUp))
        },
        onClick: function() {
            this._teleportPressed = !0,
            this._clickPressed = !0
        },
        setListenToEvents: function(t) {
            t ? this.setEventListeners() : this.removeEventListeners()
        },
        isPosedController: function() {
            var t = this._activeController;
            return !!(t && t.pose && t.pose.hasOrientation)
        },
        replaceControllerMesh: function(t) {
            var e = this._geomController;
            this._proxyControllerMT.removeChild(e);
            var i = t.BODY;
            this._geomController = new g.Geometry,
            this._geomController.getAttributes().Vertex = new g.BufferArray(g.BufferArray.ARRAY_BUFFER,i.VERTEX,3),
            this._geomController.getAttributes().Normal = new g.BufferArray(g.BufferArray.ARRAY_BUFFER,i.NORMAL,3),
            this._geomController.getAttributes().Color = new g.BufferArray(g.BufferArray.ARRAY_BUFFER,i.COLOR,1),
            this._geomController.getPrimitives().push(new g.DrawElements(g.PrimitiveSet.TRIANGLES,new g.BufferArray(g.BufferArray.ELEMENT_ARRAY_BUFFER,i.TRIANGLES,1))),
            this._geomController.getPrimitives().push(new g.DrawElements(g.PrimitiveSet.TRIANGLE_STRIP,new g.BufferArray(g.BufferArray.ELEMENT_ARRAY_BUFFER,i.STRIP,1))),
            this._proxyControllerMT.addChild(this._geomController);
            var n = t.BUTTON;
            this._geomControllerButtons = new g.Geometry,
            this._geomControllerButtons.getAttributes().Vertex = new g.BufferArray(g.BufferArray.ARRAY_BUFFER,n.VERTEX,3),
            this._geomControllerButtons.getAttributes().Normal = new g.BufferArray(g.BufferArray.ARRAY_BUFFER,n.NORMAL,3),
            this._geomControllerButtons.getAttributes().Color = new g.BufferArray(g.BufferArray.ARRAY_BUFFER,n.COLOR,1),
            this._geomControllerButtons.getPrimitives().push(new g.DrawElements(g.PrimitiveSet.TRIANGLES,new g.BufferArray(g.BufferArray.ELEMENT_ARRAY_BUFFER,n.TRIANGLES,1))),
            this._geomControllerButtons.getPrimitives().push(new g.DrawElements(g.PrimitiveSet.TRIANGLE_STRIP,new g.BufferArray(g.BufferArray.ELEMENT_ARRAY_BUFFER,n.STRIP,1))),
            this._proxyControllerMT.addChild(this._geomControllerButtons),
            this._createMaterialWithColor(this._geomControllerButtons.getOrCreateStateSet(), g.vec3.fromValues(.00237, .30699, .57048)),
            this._updateCorrectionMatrix()
        },
        _updateCorrectionMatrix: function() {
            var t = this._proxyControllerMT.getMatrix();
            if (this._gamepadType === v) {
                var e = g.vec3.create();
                g.mat4.fromTranslation(t, g.vec3.set(e, 0, .03262643, .031930979)),
                g.mat4.rotateX(t, t, .22 * Math.PI),
                this._activeController && "left" === this._activeController.hand && g.mat4.scale(t, t, g.vec3.set(e, -1, 1, 1))
            } else
                g.mat4.identity(t)
        },
        onPointerDown: function() {
            u.a.any && !this._activeController && (this._pointerClicked = !0)
        },
        onPointerUp: function(t) {
            this._pointerClicked = !1,
            u.a.any || (2 === t.button ? this._menuPressed = !0 : Math.abs(t.pageX - this._canvasX) < 5 && Math.abs(t.pageY - this._canvasY) < 5 && (this._clickPressed = !0,
            this._teleportPressed = !0))
        },
        onMouseDown: function(t) {
            u.a.any && !this._activeController && this._model.get("hasNativeHMD") && (this._teleportPressed = !0),
            u.a.any || (this._canvasX = t.pageX,
            this._canvasY = t.pageY)
        },
        updateButtonsPressed: function() {
            if (this._activeController)
                for (var t = this._pressedButtons.length, e = 0; e < t; ++e) {
                    var i = this._activeController.buttons[e].pressed;
                    i !== this._pressedButtons[e] && (this._pressedButtons[e] = i,
                    i ? this.onButtonDown(e) : this.onButtonUp(e))
                }
        },
        updateHoverAxes: function() {
            this._gamepadType === v && (this._scaleValueChange = 0,
            this.updateScaleChangeFromXAxis(v.SCALE_THRESHOLD))
        },
        updateScaleChangeFromXAxis: function(t) {
            var e = this._activeController.axes[0];
            e > t ? this._scaleValueChange = 1 : e < -t && (this._scaleValueChange = -1)
        },
        updatePointerClick: function(t) {
            if (this._pointerClicked) {
                if (this._timeSinceLastPointerClick > 1.2)
                    return this._menuPressed = !0,
                    this._pointerClicked = !1,
                    void (this._timeSinceLastPointerClick = 0);
                this._timeSinceLastPointerClick += t
            } else
                this._timeSinceLastPointerClick > 0 && this._timeSinceLastPointerClick < 1.2 && (u.a.any && (this._clickPressed = !0,
                this._teleportPressed = !0),
                this._timeSinceLastPointerClick = 0)
        },
        onButtonUp: function(t) {
            if (this._gamepadType === m)
                switch (t) {
                case m.TRIGGER:
                    this._clickPressed = !0,
                    this._teleportPressed = !0;
                    break;
                case m.CIRCULAR_BUTTON:
                    this._scaleValueChange = 0;
                    break;
                case m.MENU:
                    this._menuPressed = !0
                }
            else if (this._gamepadType === v)
                switch (t) {
                case v.TRIGGER_UP:
                    this._clickPressed = !0,
                    this._teleportPressed = !0;
                    break;
                case v.BY:
                    this._menuPressed = !0
                }
            else if (this._gamepadType === _)
                switch (t) {
                case _.CIRCULAR_BUTTON:
                    this._clickPressed = !0,
                    this._teleportPressed = !0;
                    break;
                case _.HOME:
                    this._menuPressed = !0;
                    break;
                case _.CIRCULAR_UP:
                case _.CIRCULAR_DOWN:
                    this._scaleValueChange = 0
                }
            else if (this._gamepadType === b)
                switch (t) {
                case b.CIRCULAR_BUTTON:
                    0 !== this._scaleValueChange && (this._menuPressed = !1,
                    this._pointerClicked = !1,
                    this._teleportPressed = !1),
                    this._pointerClicked = !1,
                    this._scaleValueChange = 0
                }
            else if (this._gamepadType === x)
                switch (t) {
                case x.TOUCHPAD_BUTTON:
                    this._pointerClicked = !1
                }
        },
        onButtonDown: function(t) {
            if (this._gamepadType === m)
                switch (t) {
                case m.CIRCULAR_BUTTON:
                    this.updateScaleChangeFromXAxis(m.SCALE_THRESHOLD)
                }
            else if (this._gamepadType === _)
                switch (t) {
                case _.CIRCULAR_UP:
                    this._scaleValueChange = 1;
                    break;
                case _.CIRCULAR_DOWN:
                    this._scaleValueChange = -1
                }
            else if (this._gamepadType === b)
                switch (t) {
                case b.CIRCULAR_BUTTON:
                    this.updateScaleChangeFromXAxis(b.SCALE_THRESHOLD),
                    this._pointerClicked = 0 === this._scaleValueChange
                }
            else if (this._gamepadType === x)
                switch (t) {
                case x.TOUCHPAD_BUTTON:
                    this._pointerClicked = !0
                }
        },
        getAndSetActiveController: function() {
            if (navigator.getGamepads) {
                var t = navigator;
                try {
                    if (!(t = window.parent.navigator))
                        throw new Error("Host is not defined")
                } catch (e) {
                    t = navigator
                }
                var e = t.getGamepads()
                  , i = this._activeController;
                if (this._activeController = this._getControllerWithPressedButtons(e),
                this._activeController || (this._hasController(e, i) ? this._activeController = i : this._activeController = this._getControllerWithOrientationAndPreferredHand(e)),
                this._activeController || (this._pressedButtons.length = 0),
                this._activeController && i !== this._activeController) {
                    for (var n = this._pressedButtons.length = this._activeController.buttons.length, r = 0; r < n; ++r)
                        this._pressedButtons[r] = !1;
                    this._gamepadType = this._getGamepadType(this._activeController),
                    this._updateCorrectionMatrix()
                }
            }
        },
        _hasController: function(t, e) {
            if (!e)
                return !1;
            for (var i = 0, n = t.length; i < n; ++i)
                if (t[i] === e)
                    return !0;
            return !1
        },
        _getControllerWithPressedButtons: function(t) {
            for (var e = 0, i = t.length; e < i; ++e) {
                var n = t[e];
                if (n) {
                    if (!(n.pose && n.pose.hasOrientation) || n.pose.orientation)
                        for (var r = n.buttons.length, a = 0; a < r; ++a)
                            if (n.buttons[a].pressed)
                                return n
                }
            }
        },
        setPreferLeftHand: function(t) {
            this._preferLeftHand !== t && (this._preferLeftHand = t,
            this.getAndSetActiveController(),
            this._updateCorrectionMatrix())
        },
        _getControllerWithOrientationAndPreferredHand: function(t) {
            for (var e, i = this._preferLeftHand ? "left" : "right", n = 0, r = t.length; n < r; ++n) {
                var a = t[n];
                if (a) {
                    var s = a.pose && a.pose.hasOrientation;
                    if (!s || a.pose.orientation) {
                        if (s && a.hand === i)
                            return a;
                        !s && e || (e = a)
                    }
                }
            }
            return e
        },
        _getGamepadType: function(t) {
            var e = t && t.id;
            if (e)
                return e = e.toLowerCase(),
                -1 !== e.indexOf("oculus") ? -1 !== e.indexOf("touch") ? v : _ : -1 !== e.indexOf("daydream") ? b : -1 !== e.indexOf("vive") || -1 !== e.indexOf("openvr") ? m : -1 !== e.indexOf("gear vr") ? x : void 0
        },
        applyPoseMatrix: function() {
            var t = g.quat.create()
              , e = g.vec3.create()
              , i = g.mat4.create();
            return function(n, r, a, s) {
                if (r) {
                    var o = a.stageParameters && a.stageParameters.sittingToStandingTransform
                      , l = r.orientation;
                    r.hasOrientation && l && (o && (l = g.mat4.getRotation(t, o),
                    g.quat.multiply(l, l, r.orientation)),
                    l = g.quat.set(t, l[0], -l[2], l[1], l[3]),
                    g.quat.multiply(l, this._postMultRotate, l),
                    g.mat4.multiply(n, n, g.mat4.fromQuat(i, l)));
                    var u = this._model.get("worldFactor")
                      , h = r.position;
                    if (r.hasPosition && h)
                        o && (h = g.vec3.transformMat4(e, h, o)),
                        h = g.vec3.set(e, h[0] * u, -h[2] * u, h[1] * u),
                        g.vec3.transformQuat(h, h, this._postMultRotate),
                        g.vec3.add(h, h, s),
                        g.mat4.setTranslation(n, h);
                    else if (!r.hasPosition) {
                        e[0] = .2 * u * ("left" === a.hand ? -1 : 1),
                        e[1] = .2 * u,
                        e[2] = 0,
                        g.vec3.transformQuat(e, e, t),
                        e[2] -= .5 * u,
                        g.vec3.add(e, e, s),
                        g.mat4.setTranslation(n, e)
                    }
                }
            }
        }(),
        updatePointerScaleFromHit: function(t) {
            var e = g.mat4.getTranslation(g.vec3.create(), this.getMatrix())
              , i = g.vec3.dist(e, t);
            this._hitScaleOffset = i / this._model.get("worldFactor")
        },
        resetPointerScale: function() {
            this._hitScaleOffset = 20
        },
        isMenuPressed: function() {
            return this._menuPressedFrame
        },
        isTeleportPressed: function() {
            return this._teleportPressedFrame
        },
        isClickPressed: function() {
            return this._clickPressedFrame
        },
        checkScaleChangeValue: function() {
            return this._scaleValueChange
        },
        checkDownloadController: function() {
            this.isPosedController() && (this._gamepadType === b ? this._controllerMeshDisplay !== b && (this._controllerMeshDisplay = b,
            o.a.getControllerDaydream(this.replaceControllerMesh.bind(this))) : this._gamepadType === v ? this._controllerMeshDisplay !== v && (this._controllerMeshDisplay = v,
            o.a.getControllerOculusTouch(this.replaceControllerMesh.bind(this))) : this._controllerMeshDisplay !== m && (this._controllerMeshDisplay = m,
            o.a.getControllerVive(this.replaceControllerMesh.bind(this))))
        },
        updateNodeVR: function() {
            var t = g.vec3.create();
            return function(e, i, n) {
                var r = this._model.get("worldFactor");
                this.getAndSetActiveController(),
                this.checkDownloadController(),
                this.updatePointerClick(i),
                this.updateButtonsPressed(),
                this.updateHoverAxes();
                var s = this.getMatrix();
                g.mat4.fromScaling(this._pointerMT.getMatrix(), g.vec3.set(t, .05, this._hitScaleOffset, 1)),
                g.mat4.fromScaling(s, g.vec3.set(t, r, r, r)),
                this.isPosedController() ? (this.setNodeMask(a.a.NO_PICK_NO_SHADOW),
                this.applyPoseMatrix(s, this._activeController.pose, e, n)) : this.setNodeMask(0),
                this._menuPressedFrame = this._menuPressed,
                this._clickPressedFrame = this._clickPressed,
                this._teleportPressedFrame = this._teleportPressed,
                this._clickPressed = !1,
                this._menuPressed = !1,
                this._teleportPressed = !1,
                this.dirtyBound()
            }
        }(),
        raycastFromController: function() {
            var t = g.vec3.fromValues(0, 20, 0);
            return function(e, i, n, r, s) {
                g.mat4.getTranslation(r, this.getMatrix()),
                g.vec3.set(s, 0, n / this._model.get("worldFactor"), 0),
                g.vec3.transformMat4(s, s, this.getMatrix());
                var o = i.computeNearestIntersection3DHotspotFirst(r, s, a.a.PICK_GEOMETRY_FAST, e);
                return o || g.vec3.transformMat4(s, t, this.getMatrix()),
                o
            }
        }()
    }),
    e.a = y
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(138)
      , a = i(70)
      , s = i(87)
      , o = i(819)
      , l = i.n(o)
      , u = i(818)
      , h = i.n(u)
      , c = n.a.osg
      , d = function() {
        c.MatrixTransform.call(this),
        this.setName("WebVR - Cursor"),
        this.setVisible(!0),
        this._geom = c.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0),
        this._uAlpha = c.Uniform.createFloat(1, "uAlpha"),
        this._uColor = c.Uniform.createFloat3(c.vec3.fromValues(.7, .7, .7), "uCursorColor"),
        this.addChild(this._geom),
        this.init()
    };
    d.prototype = c.objectInherit(c.MatrixTransform.prototype, {
        init: function() {
            var t = c.StateAttribute.OVERRIDE | c.StateAttribute.ON
              , e = this.getOrCreateStateSet();
            e.setAttributeAndModes(r.a.createShader(l.a, h.a, "webVR-cursor", "VRCursor"), t),
            e.setRenderBinDetails(s.a.VR_CURSOR, "RenderBin"),
            e.setAttributeAndModes(new c.BlendFunc(c.BlendFunc.ONE,c.BlendFunc.ONE_MINUS_SRC_ALPHA)),
            e.addUniform(this._uColor),
            e.addUniform(this._uAlpha)
        },
        setVisible: function(t) {
            this.setNodeMask(t ? a.a.NO_PICK_NO_SHADOW : 0)
        },
        setColor: function(t) {
            c.vec3.copy(this._uColor.getInternalArray(), t)
        },
        updateNodeVR: function() {
            var t = c.vec3.create()
              , e = c.quat.create();
            return function(i, n, r, a) {
                var s = this.getMatrix();
                c.mat4.invert(s, n.getViewMatrix()),
                c.mat4.fromQuat(s, c.mat4.getRotation(e, s)),
                c.mat4.scale(s, s, c.vec3.set(t, a, a, a)),
                c.mat4.setTranslation(s, r),
                this._uAlpha.setFloat(i),
                this.dirtyBound()
            }
        }()
    }),
    e.a = d
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(138)
      , a = i(70)
      , s = i(89)
      , o = i(87)
      , l = i(90)
      , u = i(386)
      , h = i(329)
      , c = i(146)
      , d = i(821)
      , p = i.n(d)
      , f = i(820)
      , g = i.n(f)
      , m = n.a.osg
      , v = function(t) {
        m.MatrixTransform.call(this),
        this._model = t,
        this._postMultRotate = t._viewer.getViewerOSGJS().getManipulator().getFirstPersonManipulator().getPostMultRotate(),
        this.setName("WebVR - Floor"),
        this.setNodeMask(a.a.NO_SHADOW),
        this._cam = new m.Camera,
        this._cam.setNearFarRatio(5e-5),
        this._geom = m.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0),
        this._uScaleToMeter = m.Uniform.createFloat(1, "uScaleToMeter"),
        this._cam.addChild(this._geom),
        this.addChild(this._cam),
        this.init()
    };
    v.prototype = m.objectInherit(m.MatrixTransform.prototype, {
        init: function() {
            var t = this.getOrCreateStateSet();
            t.setAttributeAndModes(r.a.createShader(p.a, g.a, "webVR-floor", "VRFloor")),
            t.addUniform(m.Uniform.createInt(0, "uTextureFloor")),
            t.setTextureAttributeAndModes(0, h.a.dummyTexture),
            t.addUniform(this._uScaleToMeter),
            t.addUniform(m.Uniform.createInt(1, "uTextureDepth")),
            t.setTextureAttributeAndModes(1, h.a.dummyTexture),
            t.setRenderBinDetails(o.a.TRANSPARENT_BIN_NO_EARLYZ_PRE, "RenderBin"),
            t.setAttributeAndModes(new m.Depth(m.Depth.DISABLE)),
            t.setAttributeAndModes(new m.CullFace(m.CullFace.BACK)),
            i.i(l.a)() && this.initTextureFloor()
        },
        initTextureFloor: function() {
            u.a.getBaseVR(this.replaceTextureFloor.bind(this))
        },
        replaceTextureFloor: function(t) {
            this.getOrCreateStateSet().setTextureAttributeAndModes(0, s.default.instance.getOrCreateTexture(t.FLOOR).texture)
        },
        setVisible: function(t) {
            if (this.setNodeMask(t ? a.a.NO_SHADOW : 0),
            t && !this._depthInitialized) {
                var e = this.getOrCreateStateSet()
                  , i = this._model._viewer.getFeatures().postProcess.getCamera()._textureDepth;
                i && (e.setTextureAttributeAndModes(1, i),
                this._depthInitialized = !0)
            }
        },
        updateNodeVR: function() {
            var t = m.vec3.create()
              , e = m.vec3.create();
            return function() {
                var i = this.getMatrix()
                  , n = c.a.getModelBoxWithDisplacement();
                n.center(e);
                var r = 15 * n.radius();
                m.mat4.fromQuat(i, this._postMultRotate),
                m.mat4.scale(i, i, m.vec3.set(t, r, r, r)),
                i[12] = e[0],
                i[13] = e[1],
                i[14] = this._model.get("floorHeight"),
                this._uScaleToMeter.setFloat(r / this._model.get("worldFactor")),
                this.dirtyBound()
            }
        }()
    }),
    e.a = v
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(138)
      , a = i(87)
      , s = i(70)
      , o = i(90)
      , l = i(386)
      , u = i(549)
      , h = i(596)
      , c = i.n(h)
      , d = i(595)
      , p = i.n(d)
      , f = i(823)
      , g = i.n(f)
      , m = i(822)
      , v = i.n(m)
      , _ = n.a.osg
      , b = n.a.osgUtil
      , x = _.vec3.fromValues(.1, .4, .8)
      , y = _.vec3.fromValues(1, .7, .1)
      , S = _.vec3.fromValues(1, 0, 0)
      , w = _.vec3.fromValues(0, 0, .9)
      , C = function(t) {
        _.MatrixTransform.call(this),
        this._model = t,
        this.setMatrix(t.get("humanMatrix")),
        this.setName("WebVR - Human"),
        this.setNodeMask(s.a.NO_SHADOW),
        this.editMask = b.NodeGizmo.NO_FULL_CIRCLE | b.NodeGizmo.PICK_PLANE_Z | b.NodeGizmo.PICK_ARROW | b.NodeGizmo.PICK_ARC_Z,
        this._humanMT = new _.MatrixTransform,
        _.mat4.fromZRotation(this._humanMT.getMatrix(), Math.PI),
        this._geoHuman = new _.Geometry,
        this._humanMT.addChild(this._geoHuman),
        this._uColorCylinder = _.Uniform.createFloat3(_.vec3.copy(_.vec3.create(), x), "uColor"),
        this._uColorHint = _.Uniform.createFloat3(_.vec3.copy(_.vec3.create(), y), "uColor"),
        this._hintToFloorMT = new _.MatrixTransform,
        this._geoHintToFloor = _.createTexturedBoxGeometry(0, 0, -.5, .02, .02, 1),
        this._hintToFloorMT.addChild(this._geoHintToFloor),
        this._hintToFloorMT.setNodeMask(s.a.NO_PICK),
        this._geoCylinder = b.GizmoGeometry.createCylinderGeometry(1, 1, 1, 50, 1, !1, !1),
        this._geoCylinder.setNodeMask(s.a.NO_PICK);
        for (var e = 0, i = this._geoCylinder.getAttributes().Vertex.getElements(), n = i.length / 3; e < n; ++e)
            i[3 * e + 2] += .5;
        this._cylinderMT = new _.MatrixTransform,
        _.mat4.fromScaling(this._cylinderMT.getMatrix(), _.vec3.fromValues(1, 1, .5)),
        this._cylinderMT.addChild(this._geoCylinder),
        this.addChild(this._humanMT),
        this.addChild(this._cylinderMT),
        this.addChild(this._hintToFloorMT),
        this._boundingBoxComputed = !0,
        this._boundingSphereComputed = !0,
        this.init()
    };
    C.prototype = _.objectInherit(_.MatrixTransform.prototype, {
        init: function() {
            this.getOrCreateStateSet().setAttributeAndModes(new _.CullFace(_.CullFace.BACK));
            var t = this._humanMT.getOrCreateStateSet();
            t.setShaderGeneratorName("pbr-shadeless");
            var e = u.a.createMaterialModel(t);
            e.set("hasVertexColor", !0),
            e.set("vertexColorEnable", !0),
            e.set("vertexColorColorSpace", "linear"),
            e.trigger("apply"),
            t.setAttributeAndModes(t.getAttribute("SketchfabMaterial")),
            i.i(o.a)() && l.a.getHuman(this.initHumanMesh.bind(this));
            var n = this._geoHintToFloor.getOrCreateStateSet();
            n.setAttributeAndModes(r.a.createShader(g.a, v.a, "webVR-hintToFloor", "VRHintToFloor")),
            n.addUniform(this._uColorHint),
            n.setRenderBinDetails(a.a.TRANSPARENT_BIN_NO_EARLYZ_POST, "RenderBin");
            var s = this._geoCylinder.getOrCreateStateSet();
            s.setAttributeAndModes(r.a.createShader(c.a, p.a, "webVR-humanCylinder", "VRHumanCylinder")),
            s.addUniform(this._uColorCylinder),
            s.addUniform(_.Uniform.createFloat(1, "uAlpha")),
            s.setRenderBinDetails(a.a.TRANSPARENT_BIN_NO_EARLYZ_POST, "RenderBin")
        },
        initHumanMesh: function(t) {
            var e = this._geoHuman;
            e.getAttributes().Vertex = new _.BufferArray(_.BufferArray.ARRAY_BUFFER,t.VERTEX,3),
            e.getAttributes().Color = new _.BufferArray(_.BufferArray.ARRAY_BUFFER,t.COLOR,4),
            e.getPrimitives().push(new _.DrawElements(_.PrimitiveSet.TRIANGLES,new _.BufferArray(_.BufferArray.ELEMENT_ARRAY_BUFFER,t.TRIANGLES,1))),
            e.getPrimitives().push(new _.DrawElements(_.PrimitiveSet.TRIANGLE_STRIP,new _.BufferArray(_.BufferArray.ELEMENT_ARRAY_BUFFER,t.STRIP,1)))
        },
        setVisible: function(t) {
            if (this._visible !== t) {
                this._visible = t,
                this.setNodeMask(t ? s.a.NO_SHADOW : 0);
                var e = this._model._viewer.getFeaturesManager().getNodeGizmo();
                t ? (e.attachToGeometry(this._humanMT),
                this._initView()) : this._restoreView()
            }
        },
        _initView: function() {
            var t = _.vec3.create()
              , e = _.vec3.create()
              , i = _.vec3.create()
              , n = _.quat.create()
              , r = _.vec3.create()
              , a = _.vec3.create()
              , s = _.vec3.fromValues(0, 0, -1);
            return function() {
                var o = this._model._viewer.getFeaturesManager()
                  , l = this._model.get("worldFactor")
                  , u = this._model._viewer.getViewerOSGJS().getManipulator();
                this._eyePos || (this._eyePos = _.vec3.create(),
                this._eyeTarget = _.vec3.create()),
                u.getEyePosition(this._eyePos),
                u.getTarget(this._eyeTarget),
                _.mat4.getTranslation(t, this.getMatrix()),
                _.mat4.getRotation(n, this.getMatrix()),
                _.vec3.set(e, 0, 1, 0),
                _.vec3.transformQuat(e, e, n),
                _.vec3.copy(r, w),
                _.vec3.scale(r, r, l),
                _.vec3.add(t, t, r),
                _.vec3.scale(r, e, -1),
                _.vec3.normalize(r, r),
                _.vec3.cross(a, r, s),
                _.vec3.copy(i, t),
                _.vec3.scale(r, r, 3 * l),
                _.vec3.scale(a, a, .5 * l),
                _.vec3.add(r, r, a),
                _.vec3.add(i, i, r),
                o.focusOnTargetAndEye(t, i, 1)
            }
        }(),
        _restoreView: function() {
            if (this._eyePos) {
                this._model._viewer.getFeaturesManager().focusOnTargetAndEye(this._eyeTarget, this._eyePos)
            }
        },
        computeDistanceToFloor: function() {
            var t = _.vec3.create()
              , e = _.vec3.create();
            return function() {
                var i = this.getMatrix()
                  , n = this._model
                  , r = n._viewer.getFeaturesManager()
                  , a = n.get("worldFactor")
                  , o = n.get("floorHeight");
                _.mat4.getTranslation(t, i),
                _.vec3.copy(e, t);
                var l = .1 * a;
                t[2] += l,
                e[2] -= 100 * a,
                this.setNodeMask(s.a.NO_PICK_NO_SHADOW);
                var u = r.computeNearestIntersection3D(t, e, s.a.PICK_GEOMETRY_SLOW);
                return this.setNodeMask(s.a.NO_SHADOW),
                l = u ? _.vec3.dist(r.getWorldPositionFromHit(u, e), t) : t[2] - o,
                Math.max(0, l - .1 * a)
            }
        }(),
        updateNodeVR: function() {
            var t = _.vec3.create();
            return function(e, i) {
                if (0 !== this.getNodeMask()) {
                    var n = this.getMatrix()
                      , r = this._model
                      , a = r._viewer.getFeaturesManager()
                      , s = r.get("worldFactor")
                      , o = r.get("floorHeight");
                    _.vec3.lerp(this._uColorHint.getInternalArray(), y, S, .5 * Math.sin(10 * i) + .5),
                    _.mat4.getScale(t, n),
                    _.vec3.set(t, s / t[0], s / t[1], s / t[2]),
                    _.mat4.scale(n, n, t),
                    n[14] = Math.max(n[14], o);
                    var l = a._nodeGizmo._attachedNode === this || e && -1 !== e.nodepath.indexOf(this._humanMT);
                    _.vec3.copy(this._uColorCylinder.getInternalArray(), l ? y : x);
                    var u = this.computeDistanceToFloor() / s
                      , h = u > .05;
                    _.mat4.fromScaling(this._hintToFloorMT.getMatrix(), _.vec3.set(t, 1, 1, h ? u : 1e-7)),
                    this._model.set("humanInAir", h),
                    this.dirtyBound()
                }
            }
        }()
    }),
    e.a = C
}
, function(t, e, i) {
    "use strict";
    var n = i(386)
      , r = i(1075)
      , a = i(442)
      , s = i(476)
      , o = i(4)
      , l = i(89)
      , u = i(580)
      , h = (i.n(u),
    o.a.osgAnimation)
      , c = o.a.osg
      , d = h.easeOutCubic
      , p = function(t) {
        c.Node.call(this),
        this._menuPanel = new a.a(.9,2.5,s.a.AXIS_BOTH,.2,10,10),
        this._menuPanel.setUseCache(!0),
        this._menuPanel.setClickAction("vrHelpButton", this.displayHelp.bind(this)),
        this._menuPanel.setClickAction("vrExitButton", this.hide.bind(this)),
        this._menuPanel.setVisible(!1);
        var e = new r.a(c.vec3.fromValues(0, 0, -.05),.15,d,this._menuPanel,t);
        this._menuPanel.setAnimation(e),
        this.addChild(this._menuPanel),
        this._helpPanel = new s.a(2,2,s.a.AXIS_BOTH,.2,10,10),
        this._helpPanel.setPanelClickAction(this.hideHelp.bind(this)),
        this._helpPanel.setVisible(!1);
        var i = new r.a(c.vec3.fromValues(0, 0, 0),.3,d,this._helpPanel,t);
        this._helpPanel.setAnimation(i),
        this.addChild(this._helpPanel),
        this._model = t
    };
    p.prototype = c.objectInherit(c.Node.prototype, {
        initialize: function(t) {
            var e = t.hotspot._views[0]._hotspots;
            this._menuPanel.initialize("skfb_front/macros/vr/vr-menu", {
                hasHotspotsNavigation: e.length && e.length > 1
            }),
            n.a.getBaseVR(function(t) {
                var e = l.default.instance.getOrCreateTexture(t.MENU_HELP).texture;
                this._helpPanel.initialize(e, {
                    width: 1e3,
                    height: 500
                })
            }
            .bind(this))
        },
        display: function(t, e) {
            this._menuPanel.displayInView(t, e, this._model.get("worldFactor"))
        },
        hide: function() {
            this._menuPanel.setVisible(!1),
            this._helpPanel.isVisible() && this._helpPanel.setVisible(!1)
        },
        setHomeAction: function(t) {
            this._menuPanel.setClickAction("vrHomeButton", t)
        },
        setNextAction: function(t) {
            this._menuPanel.setClickAction("vrNextButton", t)
        },
        setPrevAction: function(t) {
            this._menuPanel.setClickAction("vrPrevButton", t)
        },
        displayHelp: function() {
            c.mat4.copy(this._helpPanel.getMatrix(), c.mat4.create()),
            c.mat4.setTranslation(this._helpPanel.getMatrix(), c.vec3.fromValues(0, 0, .2)),
            c.mat4.multiply(this._helpPanel.getMatrix(), this._menuPanel.getMatrix(), this._helpPanel.getMatrix()),
            this._helpPanel.setVisible(!0)
        },
        hideHelp: function() {
            this._helpPanel.isVisible() && this._helpPanel.setVisible(!1)
        },
        isVisible: function() {
            return this._menuPanel.isVisible()
        },
        isHelpVisible: function() {
            return this._helpPanel.isVisible()
        },
        updateHit: function(t) {
            return this._helpPanel.isVisible() ? this._helpPanel.updateHit(t) : this._menuPanel.isVisible() ? this._menuPanel.updateHit(t) : void 0
        },
        click: function() {
            this._helpPanel.isVisible() ? this._helpPanel.click() : this._menuPanel.isVisible() && this._menuPanel.click()
        }
    }),
    e.a = p
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(138)
      , a = i(70)
      , s = i(89)
      , o = i(386)
      , l = i(329)
      , u = i(827)
      , h = i.n(u)
      , c = i(826)
      , d = i.n(c)
      , p = i(596)
      , f = i.n(p)
      , g = i(595)
      , m = i.n(g)
      , v = n.a.osg
      , _ = n.a.osgUtil
      , b = function() {
        v.Node.call(this),
        this.setName("WebVR - Teleport"),
        this.setVisible(!0),
        this._interpolatorNormal = new _.DelayInterpolator(3),
        this._interpolatorNormal.setDelay(.08),
        this._geoCircle1 = v.createTexturedQuadGeometry(-.5, -.5, 0, 1, 0, 0, 0, 1, 0),
        this._geoCircle2 = v.createTexturedQuadGeometry(-.5, -.5, .15, 1, 0, 0, 0, 1, 0),
        this._geoCircle3 = v.createTexturedQuadGeometry(-.5, -.5, .15, 1, 0, 0, 0, 1, 0),
        this._uAlpha1 = v.Uniform.createFloat(1, "uAlpha"),
        this._uAlpha2 = v.Uniform.createFloat(1, "uAlpha"),
        this._uAlpha3 = v.Uniform.createFloat(1, "uAlpha"),
        this._uScale1 = v.Uniform.createFloat(1, "uScale"),
        this._uScale2 = v.Uniform.createFloat(.99, "uScale"),
        this._uScale3 = v.Uniform.createFloat(.99, "uScale"),
        this._geoCylinder = _.GizmoGeometry.createCylinderGeometry(1, 1, 1, 50, 1, !1, !1);
        for (var t = 0, e = this._geoCylinder.getAttributes().Vertex.getElements(), i = e.length / 3; t < i; ++t)
            e[3 * t + 2] += .5;
        this._cylinderMT = new v.MatrixTransform,
        v.mat4.fromScaling(this._cylinderMT.getMatrix(), v.vec3.fromValues(.38, .38, .125)),
        this._cylinderMT.addChild(this._geoCylinder),
        this._hotspotHintMT = new v.MatrixTransform,
        this._hotspotHintMT.addChild(this._geoCylinder),
        this._hotspotHintMT.setNodeMask(0),
        this._teleportMT = new v.MatrixTransform,
        this._teleportMT.addChild(this._geoCircle1),
        this._teleportMT.addChild(this._geoCircle2),
        this._teleportMT.addChild(this._geoCircle3),
        this._teleportMT.addChild(this._cylinderMT),
        this.addChild(this._teleportMT),
        this.addChild(this._hotspotHintMT),
        this.init()
    };
    b.prototype = v.objectInherit(v.Node.prototype, {
        init: function() {
            var t = this.getOrCreateStateSet();
            t.setAttributeAndModes(r.a.createShader(h.a, d.a, "webVR-teleportCircle", "VRTeleportCircle")),
            t.addUniform(v.Uniform.createInt(0, "uTextureTeleportCircle")),
            t.setTextureAttributeAndModes(0, l.a.dummyTexture),
            this._geoCircle1.getOrCreateStateSet().addUniform(this._uScale1),
            this._geoCircle2.getOrCreateStateSet().addUniform(this._uScale2),
            this._geoCircle3.getOrCreateStateSet().addUniform(this._uScale3),
            this._geoCircle1.getOrCreateStateSet().addUniform(this._uAlpha1),
            this._geoCircle2.getOrCreateStateSet().addUniform(this._uAlpha2),
            this._geoCircle3.getOrCreateStateSet().addUniform(this._uAlpha3);
            var e = this._cylinderMT.getOrCreateStateSet();
            e.addUniform(v.Uniform.createFloat3(v.vec3.fromValues(.7, .7, .3), "uColor")),
            e.addUniform(this._uAlpha1);
            var i = this._hotspotHintMT.getOrCreateStateSet();
            i.addUniform(v.Uniform.createFloat3(v.vec3.fromValues(.1, .66, .85), "uColor")),
            i.addUniform(this._uAlpha1),
            this._geoCylinder.getOrCreateStateSet().setAttributeAndModes(r.a.createShader(f.a, m.a, "webVR-teleportCylinder", "VRTeleportCylinder"))
        },
        initTextureTeleport: function() {
            o.a.getBaseVR(this.replaceTextureTeleport.bind(this))
        },
        replaceTextureTeleport: function(t) {
            this.getOrCreateStateSet().setTextureAttributeAndModes(0, s.default.instance.getOrCreateTexture(t.TELEPORT_CIRCLE).texture)
        },
        setVisible: function(t) {
            this.setNodeMask(t ? a.a.NO_PICK_NO_SHADOW : 0)
        },
        setHotspotHint: function() {
            var t = v.vec3.create()
              , e = v.vec3.fromValues(0, 0, 1)
              , i = v.quat.create();
            return function(n, r, a, s) {
                if (this._hotspotHintMT.setNodeMask(n ? -1 : 0),
                r) {
                    v.vec3.sub(t, a, r);
                    var o = v.vec3.len(t);
                    v.vec3.normalize(t, t),
                    v.quat.rotationTo(i, e, t);
                    var l = this._hotspotHintMT.getMatrix();
                    v.mat4.fromQuat(l, i);
                    v.mat4.scale(l, l, v.vec3.set(t, .02 * s, .02 * s, o)),
                    v.mat4.setTranslation(l, r)
                }
            }
        }(),
        updateWorldNormal: function(t, e) {
            this._interpolatorNormal.setTarget(e[0], e[1], e[2]),
            this._interpolatorNormal.update(t.getDeltaTime()),
            v.vec3.normalize(e, this._interpolatorNormal.getCurrent())
        },
        updateNodeVR: function() {
            var t = v.vec3.fromValues(0, 0, 1)
              , e = v.vec3.create();
            return function(i, n, r, s, o, l, u) {
                var h = this._teleportMT.getMatrix();
                if (this.getNodeMask()) {
                    var c = Math.acos(v.vec3.dot(t, u));
                    v.vec3.cross(e, u, t),
                    v.mat4.fromRotation(h, -c, e);
                    var d = Math.min(Math.max(o, l), 50 * l);
                    v.mat4.scale(h, h, v.vec3.set(e, d, d, d)),
                    v.vec3.set(e, s[0], s[1], s[2] + .05 * o),
                    v.mat4.setTranslation(h, e),
                    this.setNodeMask(a.a.NO_PICK_NO_SHADOW)
                }
                var p = r.getSimulationTime()
                  , f = p % .99
                  , g = (p + .2) % .99;
                this._uScale2.setFloat(f),
                this._uScale3.setFloat(g),
                this._uAlpha1.setFloat(i),
                this._uAlpha2.setFloat(i * (1 - f * f)),
                this._uAlpha3.setFloat(i * (1 - g * g)),
                this._teleportMT.dirtyBound()
            }
        }()
    }),
    e.a = b
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = function() {
        r.ComputeBoundsVisitor.call(this),
        this._minBox = new r.BoundingBox,
        this._visitedBuffers = {}
    };
    a.prototype = r.objectInherit(r.ComputeBoundsVisitor.prototype, {
        getPreciseBox: function() {
            return this._minBox
        },
        apply: function(t) {
            if (t instanceof r.Transform)
                return void this.applyTransform(t);
            if (t instanceof r.Geometry) {
                var e = this._matrixStack.length
                  , i = e > 0 ? this._matrixStack[e - 1] : r.mat4.IDENTITY
                  , n = t.getVertexAttributeList().Vertex
                  , a = this._visitedBuffers[n.getInstanceID()];
                if (a && r.mat4.exactEquals(a.matrix, i))
                    return;
                var s = t.computeTransformedVertices ? t.computeTransformedVertices() : n.getElements();
                this._visitedBuffers[n.getInstanceID()] = {
                    buffer: s,
                    matrix: r.mat4.copy(r.mat4.create(), i)
                };
                for (var o = i[0], l = i[1], u = i[2], h = i[3], c = i[4], d = i[5], p = i[6], f = i[7], g = i[8], m = i[9], v = i[10], _ = i[11], b = i[12], x = i[13], y = i[14], S = i[15], w = 1 / 0, C = 1 / 0, M = 1 / 0, T = -1 / 0, A = -1 / 0, E = -1 / 0, P = 0, N = s.length; P < N; P += 3) {
                    var k = s[P]
                      , F = s[P + 1]
                      , D = s[P + 2]
                      , R = h * k + f * F + _ * D + S || 1
                      , I = (o * k + c * F + g * D + b) / R
                      , O = (l * k + d * F + m * D + x) / R
                      , L = (u * k + p * F + v * D + y) / R;
                    I < w && (w = I),
                    O < C && (C = O),
                    L < M && (M = L),
                    I > T && (T = I),
                    O > A && (A = O),
                    L > E && (E = L)
                }
                var B = this._minBox.getMin()
                  , V = this._minBox.getMax();
                return w < B[0] && (B[0] = w),
                C < B[1] && (B[1] = C),
                M < B[2] && (B[2] = M),
                T > V[0] && (V[0] = T),
                A > V[1] && (V[1] = A),
                void (E > V[2] && (V[2] = E))
            }
            this.traverse(t)
        }
    }),
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(4))
      , a = i(6)
      , s = i(43)
      , o = i(547)
      , l = i(51)
      , u = i(555)
      , h = i(87)
      , c = i(70)
      , d = i(90)
      , p = i(29)
      , f = i(405)
      , g = i.n(f)
      , m = i(681)
      , v = i(68)
      , _ = i.n(v)
      , b = i(1064)
      , x = i(1066)
      , y = i(1062)
      , S = i(1063)
      , w = i(1061)
      , C = i(1065)
      , M = r.a.osg
      , T = r.a.osgUtil
      , A = new g.a({
        device: "VWR",
        listen: !0
    })
      , E = a.a.extend({
        initialize: function() {
            a.a.prototype.initialize.apply(this, arguments);
            var t = this.model;
            t.bind("change:enable", this.onEnable, this),
            t.bind("change:worldFactor", this.onWorldFactor, this),
            t.bind("change:floorHeight", this.onFloorHeight, this),
            t.bind("doubleTap", this.onDoubleTap, this),
            t.bind("snapHumanOnFloor", this.snapHumanOnFloor, this),
            this._standaloneViewer = !i.i(p.a)().messaging,
            A.on("message:requestPresent", this.onRequestPresent, this),
            this._viewer = this.options.context.getViewer(),
            this._viewerOSGJS = this._viewer.getViewerOSGJS(),
            this._manipulator = this._viewerOSGJS.getManipulator(),
            this._cullConfig = o.a.vrConfig,
            this._lastSelectedHotspot = void 0,
            this._lastHoveredHotspot = void 0,
            this._lastFloorHeight = 0,
            this._lastTime = 0,
            this._lastWorldFactor = -1,
            this._lastMouse = M.vec2.create(),
            this._interpolatorAlpha = new T.DelayInterpolator(1),
            this._interpolatorAlpha.setDelay(.1),
            this._webvrMaxHeight = this.getWebVRMaxHeight(),
            this._nodeWebVR = new M.Node,
            this._nodeWebVR.setName("Feature - WebVR"),
            this._proxyVR = new M.Node,
            this._proxyVR.setName("WebVR - Proxy"),
            this._proxyVR.setNodeMask(0),
            this._floorMT = new S.a(t),
            this._humanMT = new b.a(t),
            this._teleportNode = new x.a,
            this._cursorMT = new y.a,
            this._controllerMT = new w.a(t,this._viewer.getCanvas()),
            this._nodeMenu = new C.a(t),
            this._nodeMenu.setHomeAction(this._exitVR.bind(this)),
            this._nodeMenu.setNextAction(this.goToNextHotspot.bind(this)),
            this._nodeMenu.setPrevAction(this.goToPrevHotspot.bind(this)),
            this._dataDownloaded = !1,
            this._scaleControlEnabled = !0,
            this._frameData = void 0,
            this.onFloorHeight(),
            this.initGraphNodes(),
            this.hookComputeCanvasSize();
            var e = this._viewer.getCanvas();
            window.addEventListener("keydown", this.onKeyDown.bind(this)),
            i.i(d.a)() && e.addEventListener("mousemove", this.onMouseMove.bind(this)),
            window.addEventListener("vrdisplayactivate", function() {
                s.a.getModelDisplayed().isFulfilled() ? t.set("enable", !0) : s.a.getModelDisplayed().then(function() {
                    t.set("enable", !0)
                }),
                this.getConfigWebVR().isPresenting || this._viewerOSGJS.setPresentVR(!0).then(this.notifyPresentVR.bind(this))
            }
            .bind(this)),
            window.addEventListener("vrdisplaydeactivate", function() {
                this._standaloneViewer && !this.model.get("modeLauncher") && this.model.set("enable", !1)
            }
            .bind(this)),
            window.addEventListener("vrdisplaypresentchange", function(t) {
                t.display.isPresenting || !this._standaloneViewer || this.model.get("modeLauncher") || this.model.set("enable", !1)
            }
            .bind(this)),
            s.a.getModelDisplayed().then(this.initWebVR.bind(this))
        },
        getNodeWebVR: function() {
            return this._nodeWebVR
        },
        getProxyWebVR: function() {
            return this._proxyVR
        },
        getWebVRMaxHeight: function() {
            return _.a.any ? Math.min(window.screen.width, window.screen.height) * Math.min(2.5, window.devicePixelRatio) : -1
        },
        onRequestPresent: function(t) {
            this._standaloneViewer ? M.log("Launcher onRequestPresent") : M.log("Viewer onRequestPresent"),
            this.startEnable(!0, !0),
            t.removeFromHash()
        },
        initWebVR: function() {
            this._nodeWebVR.addUpdateCallback(this)
        },
        setProxyVisible: function(t) {
            this._proxyVR.setNodeMask(t ? c.a.NO_SHADOW : 0)
        },
        onDoubleTap: function(t) {
            if (!this.model.get("enable") && -1 === t.nodepath.indexOf(this._humanMT)) {
                var e = this._viewer.getFeaturesManager()
                  , i = M.vec3.create();
                e.getWorldPositionFromHit(t, i),
                M.mat4.setTranslation(this._humanMT.getMatrix(), i),
                l.a.draw()
            }
        },
        onKeyDown: function(t) {
            var e = this.model.get("worldFactor");
            if (!(e <= 0)) {
                var i = 1;
                if (79 === t.which)
                    i = 1.2;
                else {
                    if (80 !== t.which)
                        return;
                    i = 1 / 1.2
                }
                this.model.set("worldFactor", e * i)
            }
        },
        onMouseMove: function(t) {
            this._lastMouse[0] = void 0 === t.offsetX ? t.layerX : t.offsetX,
            this._lastMouse[1] = void 0 === t.offsetY ? t.layerY : t.offsetY
        },
        onFloorHeight: function() {
            var t = this.model.get("floorHeight")
              , e = .05 * this.model.get("worldFactor");
            Math.abs(this._humanMT.getMatrix()[14] - this._lastFloorHeight) <= e && (this._humanMT.getMatrix()[14] = t),
            this._floorMT.getMatrix()[14] = t,
            this._lastFloorHeight = t
        },
        initGraphNodes: function() {
            this._nodeWebVR.addChild(this._proxyVR),
            this._proxyVR.addChild(this._floorMT),
            this._proxyVR.addChild(this._humanMT),
            this._proxyVR.addChild(this._teleportNode),
            this._proxyVR.addChild(this._cursorMT),
            this._proxyVR.addChild(this._controllerMT),
            this._proxyVR.addChild(this._nodeMenu);
            var t = this._proxyVR.getOrCreateStateSet();
            t.setRenderBinDetails(h.a.TRANSPARENT_BIN_NO_EARLYZ_POST, "RenderBin"),
            t.setAttributeAndModes(new M.Depth(M.Depth.LESS,0,1,!1)),
            t.setAttributeAndModes(new M.CullFace(M.CullFace.DISABLE))
        },
        resetCameraToHuman: function() {
            var t = M.vec3.create()
              , e = M.vec3.create()
              , i = M.mat4.create();
            return function() {
                var n = this.getConfigWebVR()
                  , r = n.capabilities.hasPosition && n.stageParameters
                  , a = M.mat4.copy(i, this._humanMT.getMatrix());
                M.mat4.getScale(t, a),
                M.vec3.set(t, 1 / t[0], 1 / t[1], 1 / t[2]),
                M.mat4.scale(a, a, t);
                var s = this._manipulator.getFirstPersonManipulator()
                  , o = s.getPostMultRotate();
                M.quat.normalize(o, M.mat4.getRotation(o, a)),
                n.displayName.toLowerCase().indexOf("oculus") >= 0 ? (this._cb && window.removeEventListener("vrdisplayactivate", this._cb),
                this._cb = this._cb || function() {
                    s.setResetInitialRotationVR(!0),
                    window.removeEventListener("vrdisplayactivate", this._cb)
                }
                .bind(this),
                window.addEventListener("vrdisplayactivate", this._cb)) : s.setResetInitialRotationVR(!0),
                M.mat4.getTranslation(e, a),
                r && M.mat4.equals(M.mat4.IDENTITY, r.sittingToStandingTransform) && this.handleBuggyStandingTransform(n, 3),
                e[2] += this.getEyeLevel(),
                this._viewer.getFeaturesManager().focusOnTargetAndEye(void 0, e)
            }
        }(),
        requestData: function(t, e) {
            var i = this.model.get("modeLauncher");
            !t || i || this._dataDownloaded || (this._dataDownloaded = !0,
            this._teleportNode.initTextureTeleport(),
            this._floorMT.initTextureFloor(),
            this._nodeMenu.initialize(e))
        },
        notifyPresentVR: function() {
            var t = this.model.get("enable")
              , e = this.model.get("modeLauncher");
            e && (this._scaleControlEnabled = !1);
            var i;
            this._standaloneViewer ? !t && e && (M.log("Launcher sending requestPresent"),
            i = A.createMessage({
                data: "requestPresent"
            }),
            i.appendToHash(),
            M.log("Launcher sent requestPresent")) : (M.log("Viewer enable after Promise" + t),
            t || (M.log("Viewer SendingExit"),
            i = A.createMessage({
                data: "exit"
            }),
            i.appendToHash(),
            M.log("Viewer SentExit")))
        },
        _exitVR: function() {
            if (i.i(p.a)().isApp) {
                A.createMessage({
                    data: "exit"
                }).appendToHash()
            } else
                this.model.set("enable", !1)
        },
        startEnable: function(t, e) {
            var n = this._viewer.getFeatures();
            this.setProxyVisible(t),
            this.requestData(t, n),
            this.updateDistortion(),
            n.background.getModel().set("webVR", t && !i.i(p.a)().vrAr),
            n.manipulator.getModel().set("webVR", t),
            n.hotspot.getModel().set("webVR", t),
            n.shadingStyle.getModel().set("webVR", t),
            n.lighting.getModel().set("webVR", t),
            n.postProcess.getModel().set("webVR", t),
            i.i(p.a)().vrStereo ? this._cullConfig.doVR = t : this._cullConfig.doVR = !1,
            this._controllerMT.setListenToEvents(t),
            t ? (this._floorMT.updateNodeVR(),
            this.resetCameraToHuman()) : this._viewer.getFeaturesManager().focusOnHomePosition(),
            this._standaloneViewer ? M.log("Launcher StartEnable: enabled:" + t + " doPresentVR: " + e) : M.log("Viewer StartEnable: enabled:" + t + " doPresentVR: " + e);
            var r = this.getConfigWebVR();
            t && !e || r.isPresenting === t || (this.model.get("hasNativeHMD") ? this._viewerOSGJS.setPresentVR(t).then(this.notifyPresentVR.bind(this), this.notifyPresentVR.bind(this)) : (r.isPresenting = t,
            this.notifyPresentVR()))
        },
        onEnable: function() {
            var t = this.model.get("enable");
            this.startEnable(t, this._standaloneViewer)
        },
        handleBuggyStandingTransform: function(t, e) {
            0 !== e && (M.warn("VR: Handling buggy standing transform Vive"),
            navigator.getVRDisplays().then(function(i) {
                for (var n = 0; n < i.length; ++n)
                    if (i[n].displayName === t.displayName) {
                        t = i[n];
                        break
                    }
                var r = t.capabilities.hasPosition && t.stageParameters;
                if (r && M.mat4.equals(M.mat4.IDENTITY, r.sittingToStandingTransform))
                    return void setTimeout(this.handleBuggyStandingTransform.bind(this, t, --e), 5e3)
            }
            .bind(this)))
        },
        updateDistortion: function() {
            if (!this.model.get("hasNativeHMD") && !i.i(p.a)().vrAr) {
                var t = this._viewer.getFeatures().postProcess.getModel();
                t.set("doDistortionVR", !0);
                var e = this.model.get("deviceInfo")
                  , n = e.getProjectionMatrixLeftEye()
                  , r = e.getProjectionMatrixLeftEye(!0)
                  , a = e.getUndistortedViewportLeftEye()
                  , s = e.device
                  , o = {
                    xScale: a.width / (s.width / 2),
                    yScale: a.height / s.height,
                    xTrans: 2 * (a.x + a.width / 2) / (s.width / 2) - 1,
                    yTrans: 2 * (a.y + a.height / 2) / s.height - 1
                };
                t.set("distortion", e.viewer.distortionCoefficients),
                t.set("projectionLeft", u.a.projectionMatrixToVector_(n)),
                t.set("unprojectionLeft", u.a.projectionMatrixToVector_(r, o))
            }
        },
        snapHumanOnFloor: function() {
            this._humanMT.getMatrix()[14] -= this._humanMT.computeDistanceToFloor()
        },
        getEyeLevel: function() {
            var t = this.getConfigWebVR();
            return t.capabilities.hasPosition && t.stageParameters ? this.getPosVR()[2] : 1.65 * this.model.get("worldFactor")
        },
        snapOnFloor: function() {
            var t = this.model.get("worldFactor")
              , e = this._manipulator.getEyePosition(M.vec3.create())
              , i = M.vec3.copy(M.vec3.create(), e);
            i[2] -= 5 * t;
            var n = this._viewer.getFeaturesManager()
              , r = n.computeNearestIntersection3D(e, i, c.a.PICK_GEOMETRY_FAST, this._nodeWebVR);
            if (r) {
                var a = M.vec3.create();
                n.getWorldPositionFromHit(r, a),
                a[2] += this.getEyeLevel(),
                n.focusOnTargetAndEye(void 0, a)
            }
        },
        onWorldFactor: function() {
            var t = M.vec3.create();
            return function() {
                var e = this.model.get("worldFactor");
                this._lastWorldFactor > 0 && this._lastWorldFactor !== e && (M.vec3.scale(this.getPosVR(), this.getPosVR(), e / this._lastWorldFactor),
                this.model.get("enable") && this.snapOnFloor()),
                this._lastWorldFactor = e;
                var n = this.getConfigWebVR()
                  , r = this._cullConfig
                  , a = n.getEyeParameters("left")
                  , s = n.getEyeParameters("right")
                  , o = n.getFrameData(this._frameData)
                  , u = 1;
                i.i(p.a)().vrScaleRTT > 0 ? u = i.i(p.a)().vrScaleRTT : this._webvrMaxHeight > 0 && (u = Math.min(1, this._webvrMaxHeight / (a.renderHeight || 512))),
                r.leftRenderWidth = Math.floor(a.renderWidth * u) || 512,
                r.leftRenderHeight = Math.floor(a.renderHeight * u) || 512,
                r.rightRenderWidth = Math.floor(s.renderWidth * u) || 512,
                r.rightRenderHeight = Math.floor(s.renderHeight * u) || 512,
                o && (M.mat4.copy(r.leftProjection, this._frameData.leftProjectionMatrix),
                M.mat4.copy(r.rightProjection, this._frameData.rightProjectionMatrix)),
                M.mat4.fromTranslation(r.leftOffsetView, M.vec3.set(t, -e * a.offset[0], -e * a.offset[1], -e * a.offset[2])),
                M.mat4.fromTranslation(r.rightOffsetView, M.vec3.set(t, -e * s.offset[0], -e * s.offset[1], -e * s.offset[2])),
                this._viewerOSGJS.getEventProxy().WebVR.setWorldScale(e),
                l.a.draw()
            }
        }(),
        perspectiveMatrixFromVRFieldOfView: function(t, e, i, n) {
            var r = n || M.mat4.create()
              , a = Math.PI / 180
              , s = Math.tan(t.upDegrees * a) * e
              , o = Math.tan(t.downDegrees * a) * e
              , l = Math.tan(t.leftDegrees * a) * e
              , u = Math.tan(t.rightDegrees * a) * e;
            return M.mat4.frustum(r, -l, u, -o, s, e, i),
            r
        },
        hookComputeCanvasSize: function() {
            var t = this._viewerOSGJS
              , e = t.computeCanvasSize
              , i = this
              , n = this._cullConfig;
            t.computeCanvasSize = function(r) {
                var a = i.model.get("enable");
                if (!a)
                    return e.call(t, r);
                i.model.get("hasNativeHMD") && i.onWorldFactor();
                var s = Math.floor(n.leftRenderWidth + n.rightRenderWidth)
                  , o = Math.floor(Math.max(n.leftRenderHeight, n.rightRenderHeight))
                  , l = Math.max(s, o);
                if (!a && l > 4096) {
                    var u = 4096 / l;
                    s = Math.floor(s * u),
                    o = Math.floor(o * u)
                }
                var h = !1;
                return this._canvasWidth !== s && (r.width = s,
                this._canvasWidth = s,
                h = !0),
                this._canvasHeight !== o && (r.height = o,
                this._canvasHeight = o,
                h = !0),
                h
            }
        },
        getConfigWebVR: function() {
            var t = this._viewerOSGJS
              , e = t.getVRDisplay();
            if (e)
                return this._frameData instanceof window.VRFrameData == !1 && (this._frameData = new window.VRFrameData),
                e;
            if (this._defaultHMD)
                return this._defaultHMD;
            var i = this.model.get("deviceInfo")
              , n = .5 * i.viewer.interLensDistance
              , r = i.getUndistortedViewportLeftEye();
            this._frameData = {
                leftProjectionMatrix: this.perspectiveMatrixFromVRFieldOfView(i.getFieldOfViewLeftEye(!1), .1, 1e3, M.mat4.create()),
                rightProjectionMatrix: this.perspectiveMatrixFromVRFieldOfView(i.getFieldOfViewRightEye(!1), .1, 1e3, M.mat4.create())
            };
            var a = {
                left: {
                    offset: M.vec3.fromValues(-n, 0, 0),
                    renderWidth: r.width,
                    renderHeight: r.height
                },
                right: {
                    offset: M.vec3.fromValues(n, 0, 0),
                    renderWidth: r.width,
                    renderHeight: r.height
                }
            };
            return this._defaultHMD = {
                displayName: "fake-cardboard",
                isPresenting: !1,
                getFrameData: function(t) {
                    return t
                },
                getEyeParameters: function(t) {
                    return a[t]
                },
                capabilities: {
                    hasPosition: !1,
                    hasRotation: !1,
                    hasExternalDisplay: !1
                }
            },
            this._defaultHMD
        },
        getPosVR: function() {
            var t = M.vec3.create();
            return function() {
                return this._manipulator.getCurrentManipulator()._vrPos || M.vec3.set(t, 0, 0, 0)
            }
        }(),
        getTeleportPosFromHotspot: function() {
            var t = M.vec3.create()
              , e = M.vec3.create()
              , i = M.vec3.create()
              , n = M.vec3.create();
            return function(r, a, s, o) {
                var l = this._viewer.getFeaturesManager()
                  , u = this.model.get("worldFactor");
                l.getWorldPositionFromScenePoint(M.mat4.getTranslation(t, r.getHotspotMatrix()), e);
                var h = 2.5 * u;
                M.vec3.sub(t, e, a);
                var d = M.vec3.length(t);
                t[2] = 0,
                M.vec3.normalize(t, t),
                M.vec3.scale(t, t, h),
                M.vec3.sub(i, e, t),
                i[2] = e[2] + u,
                d < h + .1 * h && M.vec3.copy(i, a),
                M.vec3.copy(n, i),
                n[2] -= 3.5 * u;
                var p = l.computeNearestIntersection3D(i, n, c.a.PICK_GEOMETRY_FAST, this._nodeWebVR);
                p ? (l.getWorldPositionFromHit(p, s, o),
                p.backface && M.vec3.negate(o, o)) : (M.vec3.copy(s, i),
                s[2] -= this.getEyeLevel(),
                M.vec3.set(o, 0, 0, 1)),
                this._teleportNode.setHotspotHint(r.canTeleport(), s, e, u),
                r.setWorldTeleportPosition(e, s, u)
            }
        }(),
        updateHitHotspot: function() {
            var t = function(t) {
                return t instanceof m.a
            };
            return function(e, r, a, s, o) {
                var l = this._viewer.getFeatures().hotspot.getWidgetNode()
                  , u = e && -1 !== e.nodepath.indexOf(l);
                if (this._lastHoveredHotspot && this._lastHoveredHotspot.setHovered(!1),
                !u)
                    return this._lastHoveredHotspot && this._lastHoveredHotspot.updateCardHit(),
                    this._lastHoveredHotspot = void 0,
                    void this._teleportNode.setHotspotHint(!1);
                var h = this._lastHoveredHotspot = i.i(n.find)(e.nodepath, t);
                return h.updateCardHit(e),
                h.setHovered(!0),
                h.isFullyVisibleCard() ? h : (this.getTeleportPosFromHotspot(h, r, s, o),
                this._viewer.getFeatures().hotspot.getModel().set("currentHotspotIndex", h.getIndex()),
                h)
            }
        }(),
        handleHitPicking: function(t, e, i, n, r, a, s) {
            var o, l = this._viewer.getFeaturesManager(), u = this.model.get("worldFactor"), h = this._floorMT.getBoundingSphere(), d = M.vec3.dist(h.center(), e) + h.radius();
            return t ? o = l.computeNearestIntersection2D(this._lastMouse[0], this._lastMouse[1], c.a.PICK_GEOMETRY_FAST) : this._controllerMT.isPosedController() ? (o = this._controllerMT.raycastFromController(this._nodeWebVR, l, d, a, s),
            o ? (l.getWorldPositionFromHit(o, n, r),
            o.backface && M.vec3.negate(r, r),
            this._controllerMT.updatePointerScaleFromHit(n),
            this._cursorMT.setColor(M.vec3.fromValues(.1, .66, .85))) : (this._controllerMT.resetPointerScale(),
            M.vec3.copy(n, s))) : (M.vec3.copy(a, e),
            M.vec3.copy(s, i),
            M.vec3.scale(s, i, d),
            M.vec3.add(s, a, s),
            o = l.computeNearestIntersection3DHotspotFirst(a, s, c.a.PICK_GEOMETRY_FAST, this._nodeWebVR),
            o ? (l.getWorldPositionFromHit(o, n, r),
            o.backface && M.vec3.negate(r, r)) : (M.vec3.scale(n, i, 3 * u),
            M.vec3.add(n, e, n))),
            o
        },
        goToNextHotspot: function() {
            this._viewer.getFeatures().postProcess.getModel().fadeForTeleportVR(this.doTeleportToHotspot.bind(this, 1))
        },
        doTeleportToHotspot: function(t) {
            this._nodeMenu && this._nodeMenu.isVisible() && this._nodeMenu.hide();
            var e = this.computeHotspotIndex(t);
            -1 !== e && (this.moveToHotspotWithIndex(e),
            this.displayHotspotCardForIndex(e))
        },
        goToPrevHotspot: function() {
            this._viewer.getFeatures().postProcess.getModel().fadeForTeleportVR(this.doTeleportToHotspot.bind(this, -1))
        },
        displayHotspotCardForIndex: function(t) {
            var e = this._viewer.getFeatures().hotspot.getWidgetNode().children[t];
            this.toggleHotspotCard(e)
        },
        computeHotspotIndex: function(t) {
            var e = this._viewer.getFeatures().hotspot.getModel()
              , i = e.get("hotspots");
            if (0 === i.length)
                return -1;
            if (1 !== t && -1 !== t)
                return console.error("computeHotspotIndex was called with an invalid direction argument. Valid values are 1 for foward -1 for backward."),
                0;
            var n = e.get("currentHotspotIndex")
              , r = i.length;
            return n += t,
            n < 0 && (n = -1),
            n = (n % r + r) % r,
            e.set("currentHotspotIndex", n),
            n
        },
        moveToHotspotWithIndex: function() {
            var t = M.vec3.create()
              , e = M.vec3.create()
              , i = M.vec3.create();
            return function(n) {
                var r = this._viewer.getFeaturesManager()
                  , a = this._viewer.getFeatures().hotspot.getWidgetNode()
                  , s = a.children[n]
                  , o = this._viewer.getFeatures().hotspot.getModel().get("hotspots").at(n);
                r.getWorldPositionFromScenePoint(o.get("eye"), e),
                r.getWorldPositionFromScenePoint(o.get("position"), t),
                this.getTeleportPosFromHotspot(s, e, e, i),
                e[2] += this.getEyeLevel(),
                this._manipulator.getFirstPersonManipulator().setInitialPoseVR(e, t)
            }
        }(),
        doTeleport: function(t, e, i) {
            var n = this._viewer.getFeaturesManager();
            t[2] += this.getEyeLevel(),
            n.focusOnTargetAndEye(e, t),
            this.toggleHotspotCard(i)
        },
        toggleHotspotCard: function(t) {
            t && (t.isFullyVisibleCard() ? t.onCardHit(this) : (this._lastSelectedHotspot && this._lastSelectedHotspot.setVisibleCard(!1),
            this._lastSelectedHotspot = t,
            t && t.setVisibleCard(!0)))
        },
        setPauseUpdate: function(t) {
            this._pauseUpdate = t
        },
        update: function() {
            var t = M.vec3.create()
              , e = M.vec3.create()
              , n = M.vec3.create()
              , r = M.vec3.create()
              , a = M.vec3.create()
              , s = M.vec3.create()
              , o = M.vec3.create()
              , u = M.vec3.create()
              , h = M.vec3.create()
              , c = M.vec3.create();
            return function(d, f) {
                var g = this._viewer.getFeatures()
                  , m = this.model.get("enable")
                  , v = this.model.get("modeLauncher")
                  , _ = this._viewer.getOptions().widgetAPI
                  , b = !!_ && "virtual reality" === _.getTabbedWidget().get() && !this._pauseUpdate
                  , x = m || b;
                this.setProxyVisible(x);
                var y = g.background.getModel();
                y.get("webVR") !== x && y.set("webVR", x);
                var S = g.postProcess.getModel();
                if (S.get("webVR") !== x && S.set("webVR", x),
                this._humanMT.setVisible(b),
                !m && !b)
                    return !0;
                var w = this.model.get("worldFactor")
                  , C = f.getFrameStamp()
                  , T = C.getSimulationTime()
                  , A = C.getDeltaTime()
                  , E = this.getConfigWebVR();
                this._manipulator.getEyePosition(n),
                this._manipulator.getTarget(r),
                M.vec3.sub(r, r, n),
                M.vec3.normalize(r, r);
                var P = this._viewer.getCamera()
                  , N = .02 * this._viewerOSGJS.getCanvasClientWidth() * M.mat4.getScale(u, this._cullConfig.leftProjection)[0];
                this._controllerMT.updateNodeVR(E, A, M.vec3.sub(u, n, this.getPosVR()));
                var k = this.handleHitPicking(!m && b, n, r, e, t, a, s);
                this.model.set("hit", k),
                M.vec3.copy(o, e);
                var F = m && !v && this._controllerMT.isTeleportPressed()
                  , D = !v && this._controllerMT.isClickPressed()
                  , R = this._nodeMenu && this._controllerMT.isMenuPressed(this._nodeMenu.isVisible())
                  , I = k && -1 === k.nodepath.indexOf(this._nodeMenu) && (F || D) && this._nodeMenu.isVisible()
                  , O = m && (R || I);
                O && (this._manipulator.getTarget(u),
                this._nodeMenu.isVisible() ? this._nodeMenu.hide() : this._nodeMenu.display(n, u));
                var L, B;
                if (m && !v) {
                    B = this._nodeMenu.updateHit(k),
                    L = this.updateHitHotspot(k, a, s, o, t),
                    this._teleportNode.updateWorldNormal(C, t);
                    var V = k && t[2] > .5
                      , U = L ? L.canTeleport() : V
                      , G = k && -1 !== k.nodepath.indexOf(this._floorMT)
                      , z = L ? L.canTeleport() : V && (!this.model.isDiorama() || G);
                    if (F && T - this._lastTime > .5) {
                        if (U) {
                            M.vec3.add(c, o, r),
                            M.vec3.copy(h, o);
                            this._viewer.getFeatures().postProcess.getModel().fadeForTeleportVR(this.doTeleport.bind(this, h, c, L)),
                            this._lastTime = T
                        }
                        U || this.toggleHotspotCard(L),
                        B && B.click()
                    }
                    this._interpolatorAlpha.setTarget(z ? 1 : 0),
                    this._interpolatorAlpha.update(C.getDeltaTime())
                }
                var H = M.vec3.dist(e, n) / N
                  , j = O ? 0 : this._interpolatorAlpha.getCurrent()[0];
                this._cursorMT.setVisible(m),
                this._teleportNode.setVisible(k && !v && m && !R),
                this._floorMT.setVisible(!v && !i.i(p.a)().vrAr),
                this._floorMT.updateNodeVR(),
                this._humanMT.updateNodeVR(k, T),
                this._teleportNode.updateNodeVR(j, k, C, o, w, H, t),
                this._cursorMT.updateNodeVR(v || L ? 1 : 1 - j, P, e, H),
                this._nodeMenu && this._lastSelectedHotspot && this._nodeMenu.isVisible() && this._lastSelectedHotspot.isFullyVisibleCard() && this._lastSelectedHotspot.setVisibleCard(!1);
                var W = this._controllerMT.checkScaleChangeValue();
                return this._scaleControlEnabled && 0 !== W && (W = w * Math.abs(W) * (W > 0 ? 1.02 : 1 / 1.02),
                this.model.set("worldFactor", W)),
                l.a.draw(),
                !0
            }
        }()
    });
    e.a = E
}
, function(t, e, i) {
    "use strict";
    var n = i(69)
      , r = i(1060)
      , a = i(1068)
      , s = {
        FeatureName: "webVR",
        ModelType: r.a,
        ViewListType: [a.a]
    }
      , o = n.a.create(s);
    o.prototype.getNode = function() {
        return this._views[0].getNodeWebVR()
    }
    ,
    o.prototype.getWidgetNode = function() {
        return this._views[0].getProxyWebVR()
    }
    ,
    o.prototype.prepareForScreenShot = function() {
        var t = n.a.prototype.prepareForScreenShot.call(this);
        return t && this._views[0].setPauseUpdate(!0),
        t
    }
    ,
    o.prototype.resetAfterScreenShot = function() {
        n.a.prototype.resetAfterScreenShot.call(this),
        this._views[0].setPauseUpdate(!1)
    }
    ,
    e.a = o
}
, function(t, e, i) {
    "use strict";
    function n(t) {
        this.viewer = f.CardboardV1,
        this.updateDeviceParams(t)
    }
    var r = i(4)
      , a = i(1071)
      , s = i(555)
      , o = r.a.osg
      , l = 180 / Math.PI
      , u = Math.PI / 180
      , h = function(t) {
        this.id = t.id,
        this.label = t.label,
        this.fov = t.fov,
        this.interLensDistance = t.interLensDistance,
        this.baselineLensDistance = t.baselineLensDistance,
        this.screenLensDistance = t.screenLensDistance,
        this.distortionCoefficients = t.distortionCoefficients,
        this.inverseCoefficients = t.inverseCoefficients
    }
      , c = function(t) {
        this.width = t.width || s.a.getScreenWidth(),
        this.height = t.height || s.a.getScreenHeight(),
        this.widthMeters = t.widthMeters,
        this.heightMeters = t.heightMeters,
        this.bevelMeters = t.bevelMeters
    }
      , d = new c({
        widthMeters: .11,
        heightMeters: .062,
        bevelMeters: .004
    })
      , p = new c({
        widthMeters: .1038,
        heightMeters: .0584,
        bevelMeters: .004
    })
      , f = {
        CardboardV1: new h({
            id: "CardboardV1",
            label: "Cardboard I/O 2014",
            fov: 40,
            interLensDistance: .06,
            baselineLensDistance: .035,
            screenLensDistance: .042,
            distortionCoefficients: [.441, .156],
            inverseCoefficients: [-.4410035, .42756155, -.4804439, .5460139, -.58821183, .5733938, -.48303202, .33299083, -.17573841, .0651772, -.01488963, .001559834]
        }),
        CardboardV2: new h({
            id: "CardboardV2",
            label: "Cardboard I/O 2015",
            fov: 60,
            interLensDistance: .064,
            baselineLensDistance: .035,
            screenLensDistance: .039,
            distortionCoefficients: [.34, .55],
            inverseCoefficients: [-.33836704, -.18162185, .862655, -1.2462051, 1.0560602, -.58208317, .21609078, -.05444823, .009177956, -.0009904169, 6183535e-11, -16981803e-13]
        })
    };
    n.prototype.updateDeviceParams = function(t) {
        this.device = this.determineDevice_(t) || this.device
    }
    ,
    n.prototype.getDevice = function() {
        return this.device
    }
    ,
    n.prototype.setViewer = function(t) {
        this.viewer = t
    }
    ,
    n.prototype.determineDevice_ = function(t) {
        if (!t)
            return s.a.isIOS() ? p : d;
        var e = .0254 / t.xdpi
          , i = .0254 / t.ydpi
          , n = s.a.getScreenWidth()
          , r = s.a.getScreenHeight();
        return new c({
            widthMeters: e * n,
            heightMeters: i * r,
            bevelMeters: .001 * t.bevelMm
        })
    }
    ,
    n.prototype.getDistortedFieldOfViewLeftEye = function() {
        var t = this.viewer
          , e = this.device
          , i = new a.a(t.distortionCoefficients)
          , n = t.screenLensDistance
          , r = (e.widthMeters - t.interLensDistance) / 2
          , s = t.interLensDistance / 2
          , o = t.baselineLensDistance - e.bevelMeters
          , u = e.heightMeters - o
          , h = l * Math.atan(i.distort(r / n))
          , c = l * Math.atan(i.distort(s / n))
          , d = l * Math.atan(i.distort(o / n))
          , p = l * Math.atan(i.distort(u / n));
        return {
            leftDegrees: Math.min(h, t.fov),
            rightDegrees: Math.min(c, t.fov),
            downDegrees: Math.min(d, t.fov),
            upDegrees: Math.min(p, t.fov)
        }
    }
    ,
    n.prototype.getFieldOfViewLeftEye = function(t) {
        return t ? this.getUndistortedFieldOfViewLeftEye() : this.getDistortedFieldOfViewLeftEye()
    }
    ,
    n.prototype.getFieldOfViewRightEye = function(t) {
        var e = this.getFieldOfViewLeftEye(t);
        return {
            leftDegrees: e.rightDegrees,
            rightDegrees: e.leftDegrees,
            upDegrees: e.upDegrees,
            downDegrees: e.downDegrees
        }
    }
    ,
    n.prototype.getProjectionMatrixLeftEye = function(t) {
        var e = this.getFieldOfViewLeftEye(t)
          , i = o.mat4.create()
          , n = .1 * Math.tan(u * e.leftDegrees)
          , r = .1 * Math.tan(u * e.rightDegrees)
          , a = .1 * Math.tan(u * e.downDegrees)
          , s = .1 * Math.tan(u * e.upDegrees);
        return o.mat4.frustum(i, -n, r, -a, s, .1, 1e3),
        i
    }
    ,
    n.prototype.getUndistortedViewportLeftEye = function() {
        var t = this.getUndistortedParams_()
          , e = this.viewer
          , i = this.device
          , n = e.screenLensDistance
          , r = i.widthMeters / n
          , a = i.heightMeters / n
          , s = i.width / r
          , o = i.height / a
          , l = Math.round((t.eyePosX - t.outerDist) * s)
          , u = Math.round((t.eyePosY - t.bottomDist) * o);
        return {
            x: l,
            y: u,
            width: Math.round((t.eyePosX + t.innerDist) * s) - l,
            height: Math.round((t.eyePosY + t.topDist) * o) - u
        }
    }
    ,
    n.prototype.getUndistortedFieldOfViewLeftEye = function() {
        var t = this.getUndistortedParams_();
        return {
            leftDegrees: l * Math.atan(t.outerDist),
            rightDegrees: l * Math.atan(t.innerDist),
            downDegrees: l * Math.atan(t.bottomDist),
            upDegrees: l * Math.atan(t.topDist)
        }
    }
    ,
    n.prototype.getUndistortedParams_ = function() {
        var t = this.viewer
          , e = this.device
          , i = new a.a(t.distortionCoefficients)
          , n = t.screenLensDistance
          , r = t.interLensDistance / 2 / n
          , s = e.widthMeters / n
          , o = e.heightMeters / n
          , l = s / 2 - r
          , h = (t.baselineLensDistance - e.bevelMeters) / n
          , c = t.fov
          , d = i.distortInverse(Math.tan(u * c))
          , p = Math.min(l, d)
          , f = Math.min(r, d)
          , g = Math.min(h, d);
        return {
            outerDist: p,
            innerDist: f,
            topDist: Math.min(o - h, d),
            bottomDist: g,
            eyePosX: l,
            eyePosY: h
        }
    }
    ,
    n.Viewers = f,
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = function(t) {
        this.coefficients = t
    };
    n.prototype.distortInverse = function(t) {
        for (var e = t / .9, i = .9 * t, n = t - this.distort(e); Math.abs(i - e) > 1e-4; ) {
            var r = t - this.distort(i)
              , a = i - r * ((i - e) / (r - n));
            e = i,
            i = a,
            n = r
        }
        return i
    }
    ,
    n.prototype.distort = function(t) {
        return t * this.distortionFactor_(t)
    }
    ,
    n.prototype.distortionFactor_ = function(t) {
        for (var e = 1, i = 1, n = t * t, r = 0; r < this.coefficients.length; r++) {
            var a = this.coefficients[r];
            i *= n,
            e += a * i
        }
        return e
    }
    ,
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = {
        format: 1,
        last_updated: "2016-01-26T23:11:18Z",
        devices: [{
            type: "android",
            rules: [{
                mdmh: "asus/*/Nexus 7/*"
            }, {
                ua: "Nexus 7"
            }],
            dpi: [320.8, 323],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "asus/*/ASUS_Z00AD/*"
            }, {
                ua: "ASUS_Z00AD"
            }],
            dpi: [403, 404.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "HTC/*/HTC6435LVW/*"
            }, {
                ua: "HTC6435LVW"
            }],
            dpi: [449.7, 443.3],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "HTC/*/HTC One XL/*"
            }, {
                ua: "HTC One XL"
            }],
            dpi: [315.3, 314.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "htc/*/Nexus 9/*"
            }, {
                ua: "Nexus 9"
            }],
            dpi: 289,
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "HTC/*/HTC One M9/*"
            }, {
                ua: "HTC One M9"
            }],
            dpi: [442.5, 443.3],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "HTC/*/HTC One_M8/*"
            }, {
                ua: "HTC One_M8"
            }],
            dpi: [449.7, 447.4],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "HTC/*/HTC One/*"
            }, {
                ua: "HTC One"
            }],
            dpi: 472.8,
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Huawei/*/Nexus 6P/*"
            }, {
                ua: "Nexus 6P"
            }],
            dpi: [515.1, 518],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/Nexus 5X/*"
            }, {
                ua: "Nexus 5X"
            }],
            dpi: [422, 419.9],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LGMS345/*"
            }, {
                ua: "LGMS345"
            }],
            dpi: [221.7, 219.1],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LG-D800/*"
            }, {
                ua: "LG-D800"
            }],
            dpi: [422, 424.1],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LG-D850/*"
            }, {
                ua: "LG-D850"
            }],
            dpi: [537.9, 541.9],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/VS985 4G/*"
            }, {
                ua: "VS985 4G"
            }],
            dpi: [537.9, 535.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/Nexus 5/*"
            }, {
                ua: "Nexus 5 B"
            }],
            dpi: [442.4, 444.8],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/Nexus 4/*"
            }, {
                ua: "Nexus 4"
            }],
            dpi: [319.8, 318.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LG-P769/*"
            }, {
                ua: "LG-P769"
            }],
            dpi: [240.6, 247.5],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LGMS323/*"
            }, {
                ua: "LGMS323"
            }],
            dpi: [206.6, 204.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "LGE/*/LGLS996/*"
            }, {
                ua: "LGLS996"
            }],
            dpi: [403.4, 401.5],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Micromax/*/4560MMX/*"
            }, {
                ua: "4560MMX"
            }],
            dpi: [240, 219.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Micromax/*/A250/*"
            }, {
                ua: "Micromax A250"
            }],
            dpi: [480, 446.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Micromax/*/Micromax AQ4501/*"
            }, {
                ua: "Micromax AQ4501"
            }],
            dpi: 240,
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/DROID RAZR/*"
            }, {
                ua: "DROID RAZR"
            }],
            dpi: [368.1, 256.7],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT830C/*"
            }, {
                ua: "XT830C"
            }],
            dpi: [254, 255.9],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1021/*"
            }, {
                ua: "XT1021"
            }],
            dpi: [254, 256.7],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1023/*"
            }, {
                ua: "XT1023"
            }],
            dpi: [254, 256.7],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1028/*"
            }, {
                ua: "XT1028"
            }],
            dpi: [326.6, 327.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1034/*"
            }, {
                ua: "XT1034"
            }],
            dpi: [326.6, 328.4],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1053/*"
            }, {
                ua: "XT1053"
            }],
            dpi: [315.3, 316.1],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1562/*"
            }, {
                ua: "XT1562"
            }],
            dpi: [403.4, 402.7],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/Nexus 6/*"
            }, {
                ua: "Nexus 6 B"
            }],
            dpi: [494.3, 489.7],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1063/*"
            }, {
                ua: "XT1063"
            }],
            dpi: [295, 296.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1064/*"
            }, {
                ua: "XT1064"
            }],
            dpi: [295, 295.6],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1092/*"
            }, {
                ua: "XT1092"
            }],
            dpi: [422, 424.1],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "motorola/*/XT1095/*"
            }, {
                ua: "XT1095"
            }],
            dpi: [422, 423.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "OnePlus/*/A0001/*"
            }, {
                ua: "A0001"
            }],
            dpi: [403.4, 401],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "OnePlus/*/ONE E1005/*"
            }, {
                ua: "ONE E1005"
            }],
            dpi: [442.4, 441.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "OnePlus/*/ONE A2005/*"
            }, {
                ua: "ONE A2005"
            }],
            dpi: [391.9, 405.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "OPPO/*/X909/*"
            }, {
                ua: "X909"
            }],
            dpi: [442.4, 444.1],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9082/*"
            }, {
                ua: "GT-I9082"
            }],
            dpi: [184.7, 185.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G360P/*"
            }, {
                ua: "SM-G360P"
            }],
            dpi: [196.7, 205.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/Nexus S/*"
            }, {
                ua: "Nexus S"
            }],
            dpi: [234.5, 229.8],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9300/*"
            }, {
                ua: "GT-I9300"
            }],
            dpi: [304.8, 303.9],
            bw: 5,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-T230NU/*"
            }, {
                ua: "SM-T230NU"
            }],
            dpi: 216,
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SGH-T399/*"
            }, {
                ua: "SGH-T399"
            }],
            dpi: [217.7, 231.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-N9005/*"
            }, {
                ua: "SM-N9005"
            }],
            dpi: [386.4, 387],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SAMSUNG-SM-N900A/*"
            }, {
                ua: "SAMSUNG-SM-N900A"
            }],
            dpi: [386.4, 387.7],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9500/*"
            }, {
                ua: "GT-I9500"
            }],
            dpi: [442.5, 443.3],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9505/*"
            }, {
                ua: "GT-I9505"
            }],
            dpi: 439.4,
            bw: 4,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G900F/*"
            }, {
                ua: "SM-G900F"
            }],
            dpi: [415.6, 431.6],
            bw: 5,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G900M/*"
            }, {
                ua: "SM-G900M"
            }],
            dpi: [415.6, 431.6],
            bw: 5,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G800F/*"
            }, {
                ua: "SM-G800F"
            }],
            dpi: 326.8,
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G906S/*"
            }, {
                ua: "SM-G906S"
            }],
            dpi: [562.7, 572.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9300/*"
            }, {
                ua: "GT-I9300"
            }],
            dpi: [306.7, 304.8],
            bw: 5,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-T535/*"
            }, {
                ua: "SM-T535"
            }],
            dpi: [142.6, 136.4],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-N920C/*"
            }, {
                ua: "SM-N920C"
            }],
            dpi: [515.1, 518.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9300I/*"
            }, {
                ua: "GT-I9300I"
            }],
            dpi: [304.8, 305.8],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-I9195/*"
            }, {
                ua: "GT-I9195"
            }],
            dpi: [249.4, 256.7],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SPH-L520/*"
            }, {
                ua: "SPH-L520"
            }],
            dpi: [249.4, 255.9],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SAMSUNG-SGH-I717/*"
            }, {
                ua: "SAMSUNG-SGH-I717"
            }],
            dpi: 285.8,
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SPH-D710/*"
            }, {
                ua: "SPH-D710"
            }],
            dpi: [217.7, 204.2],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/GT-N7100/*"
            }, {
                ua: "GT-N7100"
            }],
            dpi: 265.1,
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SCH-I605/*"
            }, {
                ua: "SCH-I605"
            }],
            dpi: 265.1,
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/Galaxy Nexus/*"
            }, {
                ua: "Galaxy Nexus"
            }],
            dpi: [315.3, 314.2],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-N910H/*"
            }, {
                ua: "SM-N910H"
            }],
            dpi: [515.1, 518],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-N910C/*"
            }, {
                ua: "SM-N910C"
            }],
            dpi: [515.2, 520.2],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G130M/*"
            }, {
                ua: "SM-G130M"
            }],
            dpi: [165.9, 164.8],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G928I/*"
            }, {
                ua: "SM-G928I"
            }],
            dpi: [515.1, 518.4],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G920F/*"
            }, {
                ua: "SM-G920F"
            }],
            dpi: 580.6,
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G920P/*"
            }, {
                ua: "SM-G920P"
            }],
            dpi: [522.5, 577],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G925F/*"
            }, {
                ua: "SM-G925F"
            }],
            dpi: 580.6,
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "samsung/*/SM-G925V/*"
            }, {
                ua: "SM-G925V"
            }],
            dpi: [522.5, 576.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Sony/*/C6903/*"
            }, {
                ua: "C6903"
            }],
            dpi: [442.5, 443.3],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "Sony/*/D6653/*"
            }, {
                ua: "D6653"
            }],
            dpi: [428.6, 427.6],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Sony/*/E6653/*"
            }, {
                ua: "E6653"
            }],
            dpi: [428.6, 425.7],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Sony/*/E6853/*"
            }, {
                ua: "E6853"
            }],
            dpi: [403.4, 401.9],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "Sony/*/SGP321/*"
            }, {
                ua: "SGP321"
            }],
            dpi: [224.7, 224.1],
            bw: 3,
            ac: 500
        }, {
            type: "android",
            rules: [{
                mdmh: "TCT/*/ALCATEL ONE TOUCH Fierce/*"
            }, {
                ua: "ALCATEL ONE TOUCH Fierce"
            }],
            dpi: [240, 247.5],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "THL/*/thl 5000/*"
            }, {
                ua: "thl 5000"
            }],
            dpi: [480, 443.3],
            bw: 3,
            ac: 1e3
        }, {
            type: "android",
            rules: [{
                mdmh: "ZTE/*/ZTE Blade L2/*"
            }, {
                ua: "ZTE Blade L2"
            }],
            dpi: 240,
            bw: 3,
            ac: 500
        }, {
            type: "ios",
            rules: [{
                res: [640, 960]
            }],
            dpi: [325.1, 328.4],
            bw: 4,
            ac: 1e3
        }, {
            type: "ios",
            rules: [{
                res: [640, 1136]
            }],
            dpi: [317.1, 320.2],
            bw: 3,
            ac: 1e3
        }, {
            type: "ios",
            rules: [{
                res: [750, 1334]
            }],
            dpi: 326.4,
            bw: 4,
            ac: 1e3
        }, {
            type: "ios",
            rules: [{
                res: [1242, 2208]
            }],
            dpi: [453.6, 458.4],
            bw: 4,
            ac: 1e3
        }, {
            type: "ios",
            rules: [{
                res: [1125, 2001]
            }],
            dpi: [410.9, 415.4],
            bw: 4,
            ac: 1e3
        }]
    };
    e.a = n
}
, function(t, e, i) {
    "use strict";
    var n = i(1072)
      , r = i(555)
      , a = function(t) {
        this.xdpi = t.xdpi,
        this.ydpi = t.ydpi,
        this.bevelMm = t.bevelMm
    }
      , s = function(t, e) {
        if (this.dpdb = n.a,
        this.recalculateDeviceParams_(),
        t) {
            this.onDeviceParamsUpdated = e;
            var i = new XMLHttpRequest
              , r = this;
            i.open("GET", "https://storage.googleapis.com/cardboard-dpdb/dpdb.json", !0),
            i.addEventListener("load", function() {
                r.loading = !1,
                i.status >= 200 && i.status <= 299 && (r.dpdb = JSON.parse(i.response),
                r.recalculateDeviceParams_())
            }),
            i.send()
        }
    };
    s.prototype.getDeviceParams = function() {
        return this.deviceParams
    }
    ,
    s.prototype.recalculateDeviceParams_ = function() {
        var t = this.calcDeviceParams_();
        t && (this.deviceParams = t,
        this.onDeviceParamsUpdated && this.onDeviceParamsUpdated(this.deviceParams))
    }
    ,
    s.prototype.calcDeviceParams_ = function() {
        var t = this.dpdb;
        if (!t)
            return null;
        if (1 !== t.format)
            return null;
        if (!t.devices || !t.devices.length)
            return null;
        var e = navigator.userAgent || navigator.vendor || window.opera
          , i = r.a.getScreenWidth()
          , n = r.a.getScreenHeight();
        if (!t.devices)
            return null;
        for (var s = 0; s < t.devices.length; s++) {
            var o = t.devices[s];
            if (o.rules && (("ios" === o.type || "android" === o.type) && r.a.isIOS() === ("ios" === o.type))) {
                for (var l = !1, u = 0; u < o.rules.length; u++) {
                    var h = o.rules[u];
                    if (this.matchRule_(h, e, i, n)) {
                        l = !0;
                        break
                    }
                }
                if (l) {
                    var c = o.dpi[0] || o.dpi
                      , d = o.dpi[1] || o.dpi;
                    return new a({
                        xdpi: c,
                        ydpi: d,
                        bevelMm: o.bw
                    })
                }
            }
        }
        return null
    }
    ,
    s.prototype.matchRule_ = function(t, e, i, n) {
        if (!t.ua && !t.res)
            return !1;
        if (t.ua && e.indexOf(t.ua) < 0)
            return !1;
        if (t.res) {
            if (!t.res[0] || !t.res[1])
                return !1;
            var r = t.res[0]
              , a = t.res[1];
            if (Math.min(i, n) !== Math.min(r, a) || Math.max(i, n) !== Math.max(r, a))
                return !1
        }
        return !0
    }
    ,
    e.a = s
}
, , function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = n.a.osg
      , a = function(t, e, i, n, a) {
        this._startPosOffset = t,
        this._startPos = r.vec3.create(),
        this._targetPos = r.vec3.create(),
        this._duration = e,
        this._easingFunc = i,
        this._result = r.vec3.create(),
        this._hasStarted = !1,
        this._reverse = !1,
        this._finished = !0,
        this._node = n,
        this._model = a
    };
    a.prototype = {
        isFinished: function() {
            return this._finished
        },
        _reverseAnim: function() {
            this._reverse = !this._reverse
        },
        start: function() {
            var t = r.vec3.create();
            return function(e) {
                this._started = .05 * -e,
                this._hasStarted = !1,
                this._finished = !1,
                r.vec3.scale(t, this._startPosOffset, this._model.get("worldFactor")),
                this._reverse ? (r.mat4.getTranslation(this._startPos, this._node.getMatrix()),
                r.vec3.add(this._targetPos, this._startPos, t),
                this._node.setOpacity(1)) : (r.mat4.getTranslation(this._targetPos, this._node.getMatrix()),
                r.vec3.add(this._startPos, this._targetPos, t),
                this._node.setOpacity(0)),
                r.mat4.setTranslation(this._node.getMatrix(), this._startPos)
            }
        }(),
        update: function(t, e) {
            if (!this._finished) {
                var i = e.getFrameStamp().getSimulationTime();
                if (this._started < 0)
                    return this._started += e.getFrameStamp().getDeltaTime(),
                    !0;
                this._hasStarted || (this._started = i,
                this._hasStarted = !0);
                var n = (i - this._started) / this._duration;
                return n > 1 && (this._finished = !0,
                n = 1),
                this._easingFunc && (n = this._easingFunc(n)),
                this.interpolate(n, t),
                this._finished && (this._reverseAnim(),
                this._onFinishCallback && this._onFinishCallback(),
                this._node.dirtyBound()),
                !0
            }
        },
        interpolate: function(t, e) {
            r.vec3.lerp(this._result, this._startPos, this._targetPos, t),
            r.mat4.setTranslation(e.getMatrix(), this._result),
            this._reverse ? this._node.setOpacity(1 - t) : this._node.setOpacity(t)
        },
        setOnFinishCallback: function(t) {
            this._onFinishCallback = t
        }
    },
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(442)
      , r = i(70)
      , a = i(4)
      , s = a.a.osg
      , o = function(t, e) {
        n.a.call(this, t, e),
        this._round = .005
    };
    o.prototype = s.objectInherit(n.a.prototype, {
        initialize: function(t, e) {
            n.a.prototype.initialize.call(this, t, e, function() {
                this.setClickAction("nextPage", function() {
                    this.setPage(this._currentPage + 1)
                }
                .bind(this)),
                this.setClickAction("prevPage", function() {
                    this.setPage(this._currentPage - 1)
                }
                .bind(this))
            }
            .bind(this)),
            this._nbColumns = e.column,
            this._currentPage = 0
        },
        setHinted: function(t) {
            this._hinted = t,
            this.setNodeMask(t ? r.a.NO_PICK : 0),
            this._uAlpha && (this._uAlpha[0] = .1)
        },
        isHinted: function() {
            return this._hinted
        },
        getNbPage: function() {
            return this._nbColumns
        },
        getCurrentPage: function() {
            return this._currentPage
        },
        setPage: function(t) {
            if (this._currentPage !== t) {
                var e = this.getNbPage()
                  , i = Math.min(e - 1, Math.max(0, t));
                this.setPageForCell("column" + i, "default"),
                this._currentPage = i
            }
        }
    }),
    e.a = o
}
, , , , function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(172)
      , s = i(16);
    e.a = a.a.extend({
        VIEWER_MODE_ORBIT: 0,
        VIEWER_MODE_FPS: 1,
        HOTSPOT_CYCLE_PAUSE: 1e4,
        events: {
            "click .has-menu": "toggleMenu",
            "touchstart .has-menu": "toggleMenuTouch",
            keydown: "onKeydown",
            mousewheel: "onMousewheel",
            "mousedown  .webgl .canvas": "cameraMoveStart",
            "touchstart .webgl .canvas": "cameraMoveStart",
            "mousedown  .webgl": "mouseDownEvent",
            "mouseup    .webgl": "mouseUpEvent",
            "touchstart .webgl": "mouseDownEvent",
            "touchend   .webgl": "mouseUpEvent",
            "mousedown  .fallback": "mouseDownEvent",
            "touchstart .fallback": "mouseDownEvent",
            "click      .watermark": "onWatermarkClick",
            "touchend   .watermark": "onWatermarkClick"
        },
        constructor: function() {
            this.globalCloseEvent = this.globalCloseEvent.bind(this),
            this.globalMouseUpEvent = this.globalMouseUpEvent.bind(this),
            this.onKeydown = this.onKeydown.bind(this),
            a.a.prototype.constructor.apply(this, arguments)
        },
        delegateEvents: function() {
            a.a.prototype.delegateEvents.apply(this, arguments);
            var t = r()(document);
            t.on("keydown", this.onKeydown),
            t.on("mousedown", this.globalCloseEvent),
            t.on("mouseup", this.globalMouseUpEvent),
            t.on("mousewheel.delegateEvents" + this.cid, ".annotation", this.preventScroll)
        },
        undelegateEvents: function() {
            a.a.prototype.undelegateEvents.apply(this, arguments);
            var t = r()(document);
            t.off("keydown", this.onKeydown),
            t.off("mousedown", this.globalCloseEvent),
            t.off("mouseup", this.globalMouseUpEvent),
            t.off("mousewheel.delegateEvents" + this.cid, ".annotation", this.preventScroll)
        },
        enable: function() {
            this.$(".gui").addClass("enabled")
        },
        disable: function() {
            this.$(".gui").removeClass("enabled")
        },
        closeMenus: function() {
            this.$(".gui").find(".has-menu").removeClass("active"),
            this.viewer.subviews.generalControls && this.viewer.subviews.generalControls.settings && this.viewer.subviews.generalControls.settings.togglePane(!1)
        },
        cameraMoveStart: function() {
            this.viewer.$(".webgl").addClass("camera-moving"),
            this.viewer.subviews.hotspots && this.viewer.subviews.hotspots.pauseHotspotCycleInterval()
        },
        cameraMoveEnd: function() {
            this.viewer.$(".webgl").removeClass("camera-moving"),
            this.viewer.subviews.hotspots && this.viewer.subviews.hotspots._hotspotCycleIntervalPaused && this.viewer.subviews.hotspots.beginHotspotCycleInterval(this.HOTSPOT_CYCLE_PAUSE)
        },
        onMousewheel: function() {
            var t;
            if (this.viewer.scene) {
                var e = this.viewer.scene.getFeatures();
                e.hasOwnProperty("manipulator") && (t = e.manipulator.getModel().get("indexManipulator"))
            }
            if (t === this.VIEWER_MODE_FPS) {
                var i = this.viewer.scene.getViewerOSGJS().getManipulator().getCurrentManipulator()._stepFactor
                  , n = Math.round(i / 4 * 100);
                this.viewer.subviews.osd.show("Walking speed: " + n, {
                    duration: 1e3
                })
            }
        },
        onKeydown: function(t) {
            var e = document.activeElement
              , i = ""
              , n = ["BODY", "CANVAS"];
            32 === t.which && e && (i = e.tagName,
            -1 !== n.indexOf(i) && (this.recenter(),
            t.preventDefault())),
            t.which >= 96 && t.which <= 105 && this.timeline && this.timeline.setCurrentAnimation(t.which - 96),
            27 === t.which && (this.viewer.subviews.hotspots && this.viewer.subviews.hotspots._hotspots.length && (this.viewer.subviews.hotspots.currentHotspot = -1,
            this.viewer.subviews.hotspots.applyCurrentHotspot(),
            this.viewer.subviews.hotspots.unrevealHotspots(),
            this.viewer.subviews.hotspots.stopHotspotCycleInterval()),
            this.closeMenus(),
            this.viewer.subviews.soundCreditsOverlay.hide(),
            this.viewer.subviews.helpOverlay.hide())
        },
        preventParentScroll: function(t, e) {
            var i = r()(".hotspot-controls .list")
              , n = i.height()
              , a = i.children()[0].scrollHeight
              , s = i.children()[0].scrollTop;
            (s === a - n && e < 0 || 0 === s && e > 0) && t.preventDefault()
        },
        preventScroll: function(t) {
            t.preventDefault()
        },
        globalMouseUpEvent: function() {
            this.cameraMoveEnd()
        },
        globalCloseEvent: function(t) {
            r()(t.target).hasClass("has-menu") || r()(t.target).parents(".has-menu").length || this.closeMenus(t)
        },
        toggleMenu: function(t) {
            t.preventDefault(),
            t.stopPropagation();
            var e = r()(t.currentTarget);
            e.hasClass("active") ? t.currentTarget === t.target && e.attr("data-title", e.attr("title")).removeClass("active") : (this.closeMenus(),
            e.attr("title", e.attr("data-title")).removeAttr("data-title").addClass("active"))
        },
        toggleMenuTouch: function(t) {
            t.preventDefault(),
            t.stopPropagation(),
            this.toggleMenu(t)
        },
        renderSetting: function(t, e) {
            this.viewer.$('[data-setting="' + t + '"]').removeClass("active"),
            "wireframeColor" === t && !1 === this.viewer.proxySettings.get("wireframeEnable") || this.viewer.$('[data-setting="' + t + '"][data-value="' + e + '"]').addClass("active")
        },
        getPointerPosition: function(t) {
            var e, i = t.originalEvent ? t.originalEvent : t, n = {};
            return i.touches && i.touches.length || i.changedTouches && i.changedTouches.length ? (e = i.touches && i.touches.length ? i.touches : i.changedTouches,
            e = e[0],
            n.x = e.pageX,
            n.y = e.pageY,
            n.type = "Touch") : (n.x = t.pageX,
            n.y = t.pageY,
            n.type = "Mouse"),
            n
        },
        mouseDownEvent: function(t) {
            this.mouseDownPosition = this.getPointerPosition(t),
            this.viewer.subviews.hint.hide(),
            "touchstart" === t.type && (t.target === t.currentTarget || this.scene && this.scene.getCanvas && t.target === this.viewer.scene.getCanvas()) && t.preventDefault()
        },
        mouseUpEvent: function(t) {
            if (this.mouseDownPosition) {
                var e = this.getPointerPosition(t);
                if (this.viewer.$el.hasClass("started")) {
                    if (Math.abs(this.mouseDownPosition.x - e.x) > 20 || Math.abs(this.mouseDownPosition.y - e.y) > 20) {
                        var i = this.viewer._currentModel ? this.viewer._currentModel.get("uid") : this.viewer._currentUid;
                        s.a.modelEmbedModelInteraction(i, e.type)
                    }
                    this.mouseDownPosition = null
                }
            }
        },
        recenter: function() {
            this.viewer.scene && this.viewer.scene.getViewerOSGJS().getManipulator().computeHomePosition()
        },
        onWatermarkClick: function() {
            var t = r()(".watermark").find("a").attr("href")
              , e = t.split("models/").pop().split("/")[0];
            s.a.modelEmbedWatermarkClicked(e)
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(1)
      , s = (i.n(a),
    i(68))
      , o = i.n(s)
      , l = i(290)
      , u = i(90)
      , h = i(16)
      , c = i(452)
      , d = i(83)
      , p = i(758)
      , f = i(1088)
      , g = i(21)
      , m = i(37)
      , v = m.a.shortcuts
      , _ = new c.a(v.viewerRendering)
      , b = function(t) {
        var e = [{
            title: "Off",
            className: "colors-none",
            dataSetting: "wireframeEnable",
            dataValue: "0"
        }, {
            title: "Black",
            className: "colors-black",
            dataSetting: "wireframeColor",
            dataValue: "00000099"
        }, {
            title: "White",
            className: "colors-white",
            dataSetting: "wireframeColor",
            dataValue: "ffffff99"
        }, {
            title: "Red",
            className: "colors-red",
            dataSetting: "wireframeColor",
            dataValue: "ff507f99"
        }, {
            title: "Blue",
            className: "colors-blue",
            dataSetting: "wireframeColor",
            dataValue: "4d9cff99"
        }, {
            title: "Green",
            className: "colors-green",
            dataSetting: "wireframeColor",
            dataValue: "2d9e8499"
        }, {
            title: "Yellow",
            className: "colors-yellow",
            dataSetting: "wireframeColor",
            dataValue: "ebc71299"
        }]
          , n = i.i(a.template)(["<a", '   class="<%= className %> <% if (isActive) { %>active<% } %>"', '   data-setting="<%= dataSetting %>"', '   data-value="<%= dataValue %>"', '   title="<%= title %>">', "</a>"].join(""));
        return i.i(a.template)(['<p class="wireframe-title">', "Wireframe ", '<span class="shortcut" title="Keyboard shortcut">', "   <%= shortcut %>", "</span>", "</p>", '<div class="wireframe-colors">', "   <%= colorItems %>", "</div>"].join(""))({
            shortcut: _.getShortDescriptionById("toggleWireframe"),
            colorItems: e.map(function(e) {
                return n(i.i(a.extend)({}, e, {
                    isActive: t.wireframeColor === e.dataValue
                }))
            }).join("")
        })
    }
      , x = function(t) {
        var e = i.i(a.template)(['    <div class="setting-list-header">', '       <a class="back control-menu-back">Back</a>', '       <span class="setting-list-header-help">Key</span>', "   </div>", '    <ul class="setting-list" data-setting="<%= name %>">', "        <%= listItems %>", "    </ul>", "   <%= wireframe %>"].join(""))
          , n = t.viewerSettings.hasWireframe
          , r = t.viewerSettings.wireframeColor;
        return e(i.i(a.extend)({}, t, {
            wireframe: n ? b({
                wireframeColor: r
            }) : ""
        }))
    }
      , y = {
        shadingStyle: {
            label: "Rendering",
            settings: [{
                label: "Lit",
                value: "lit",
                shortcut: _.getShortDescriptionById("defaultRenderingMode")
            }, {
                label: "Shadeless",
                value: "shadeless",
                shortcut: _.getShortDescriptionById("shadelessRenderingMode")
            }, {
                label: "MatCap",
                value: "matcap",
                shortcut: _.getShortDescriptionById("matcapRenderingMode")
            }],
            paneTemplate: x,
            order: 2
        },
        annotationsVisible: {
            label: "Annotations",
            type: "bool",
            group: "annotation",
            settings: [{
                label: "Visible",
                value: !0
            }, {
                label: "Hidden",
                value: !1
            }]
        },
        speed: {
            label: "Anim. Speed",
            group: "animation",
            type: "number",
            settings: [{
                label: "x0.1",
                value: "0.1"
            }, {
                label: "x0.5",
                value: "0.5"
            }, {
                label: "x1",
                value: "1"
            }, {
                label: "x2",
                value: "2"
            }],
            order: 3
        },
        viewerMode: {
            label: "Navigation",
            settings: [{
                label: "Orbit",
                value: "0"
            }, {
                label: "First Person",
                value: "1"
            }],
            order: 4
        }
    };
    e.a = p.a.extend({
        events: {
            "click .help": "onHelpClick",
            "click .vr": "onVrClick",
            "click .fullscreen": "onFullscreenClick",
            "click .theatre": "onTheatreClick",
            "touchend .control.tooltip": "replaceDOMElement"
        },
        constructor: function() {
            this.fullScreenChange = this.fullScreenChange.bind(this),
            this.onVrClick = this.onVrClick.bind(this),
            this.onFullscreenClick = this.onFullscreenClick.bind(this),
            this.onTheatreClick = this.onTheatreClick.bind(this),
            p.a.prototype.constructor.apply(this, arguments)
        },
        initialize: function() {
            p.a.prototype.initialize.apply(this, arguments),
            this.enableVR = !1,
            !this.hasFullscreen() && i.i(l.default)() && window.self === window.top && (this.viewer.$el.addClass("no-fullscreen"),
            this.viewer.$el.find(".controls .settings").addClass("shift-menu-left")),
            this.initializeTheatreMode(),
            this.viewer.on("model-loaded", function() {
                var t, e = this.viewer.scene, n = e.getFeatures().animation.getModel();
                t = n.get("animations").length > 1 ? [{
                    label: "One",
                    value: "one"
                }, {
                    label: "All",
                    value: "all"
                }, {
                    label: "None",
                    value: "none"
                }] : "none" === n.get("cycleMode") ? [{
                    label: "All",
                    value: "all"
                }, {
                    label: "None",
                    value: "none"
                }] : [{
                    label: i.i(a.capitalize)(n.get("cycleMode")),
                    value: n.get("cycleMode")
                }, {
                    label: "None",
                    value: "none"
                }],
                y.cycleMode = {
                    label: "Anim. Cycle",
                    group: "animation",
                    settings: t,
                    order: 3
                };
                var s = e.getFeatures().sound
                  , o = s.getModel()
                  , l = "True" === r()("#soundInEditor").val();
                (o.get("soundtracks").length || i.i(u.a)() && l) && (y.sound = {
                    label: "Sound credits",
                    isButton: !0,
                    action: "onSoundCreditsClick",
                    settings: [],
                    order: 1
                }),
                this.renderSettings()
            }
            .bind(this))
        },
        delegateEvents: function() {
            p.a.prototype.delegateEvents.apply(this, arguments),
            this.onFullScreenChange(this.fullScreenChange),
            this.viewer.proxySettings.on("change", this.renderSettings, this),
            this.viewer.on("model-loaded", function() {
                var t = this.viewer.scene.getFeatures().animation.getModel();
                t.on("change:cycleMode", this.renderSettings, this),
                t.get("animations").on("add remove reset", this.renderSettings, this)
            }
            .bind(this))
        },
        undelegateEvents: function() {
            if (p.a.prototype.undelegateEvents.apply(this, arguments),
            !this.$el)
                return this;
            this.offFullScreenChange(this.fullScreenChange),
            this.viewer.proxySettings.off("change", this.renderSettings, this)
        },
        setHasAnimations: function(t) {
            this.hasAnimations = t
        },
        getSettingLabelForValue: function(t, e) {
            return y[t].settings.find(function(t) {
                return t.value === e
            }).label
        },
        getDisplayedSettings: function() {
            var t = this.viewer.scene
              , e = t.model;
            return i.i(a.mapValues)(y, function(n) {
                return i.i(a.extend)({}, n, {
                    settings: n.settings.filter(function(i) {
                        return !i.isDisplayed || i.isDisplayed(e, t)
                    })
                })
            })
        },
        getEmbedUrl: function(t) {
            var e = g.a.craft(i.i(a.extend)({}, g.a.parse(location.search), t || {}));
            return this.viewer._currentModel.get("embedUrl") + "?" + e
        },
        onHelpClick: function(t) {
            t.preventDefault(),
            t.stopPropagation(),
            h.a.modelViewerHelpButtonCliked(),
            this.viewer.subviews.helpOverlay.show()
        },
        generateTextureQualitySettings: function(t) {
            y.textureQuality = {
                label: "Textures",
                group: "textureQuality",
                settings: [{
                    label: "LD",
                    value: "0"
                }, {
                    label: "SD",
                    value: "1"
                }, {
                    label: "HD",
                    value: "2"
                }],
                order: 5
            };
            var e = ["low", "mid", "high"]
              , n = 0;
            e.forEach(function(e, i) {
                if (!t[e]) {
                    y.textureQuality.settings.splice(i - n, 1),
                    n++
                }
            }
            .bind(this)),
            i.i(a.last)(y.textureQuality.settings).label = "HD",
            this.renderSettings()
        },
        renderSettings: function() {
            this.settings || (this.settings = new f.a({
                el: this.$(".settings-menu"),
                viewer: this.viewer,
                settings: this.getDisplayedSettings()
            })),
            this.settings.settings = this.getDisplayedSettings(),
            this.settings.render()
        },
        onVrClick: function(t) {
            t.stopPropagation(),
            this.widgets.hotspots && (this.widgets.hotspots.hideTooltips(),
            this.widgets.hotspots.currentHotspot = -1,
            this.widgets.hotspots.renderControl());
            var e = this.viewer.scene.getFeatures().webVR.getModel();
            e.get("hasNativeHMD") ? (e.set("enable", !e.get("enable")),
            h.a.modelViewerVrButtonClicked("nativeVR")) : o.a.any ? (this.fullscreenVR(t),
            h.a.modelViewerVrButtonClicked("mobile")) : (this.openVrInstructions(),
            h.a.modelViewerVrButtonClicked("desktop"))
        },
        openVrWindow: function() {
            this.viewer._currentModel && window.open(this.getEmbedUrl({
                cardboard: 1,
                autostart: 1
            }), "skfbCardboard", "menubar=no,toolbar=no")
        },
        openVrInstructions: function() {
            this.viewer._currentModel.sharing().then(function() {
                var t = this.viewer._currentModel.get("sharing").shortUrl;
                this.viewer.subviews.helperVrOverlay.setUrl(t),
                this.viewer.subviews.helperVrOverlay.show()
            }
            .bind(this))
        },
        initializeTheatreMode: function() {
            this._theatreActive = "false" !== d.a.get("theatre_mode", "false")
        },
        isTheatreActive: function() {
            return this._theatreActive
        },
        onTheatreClick: function(t) {
            t.stopPropagation(),
            t.preventDefault();
            var e = this.isTheatreActive();
            return this.viewer.trigger(e ? "leaveTheatreMode" : "enterTheatreMode"),
            d.a.set("theatre_mode", !e),
            this._theatreActive = !e,
            !1
        },
        onFullscreenClick: function(t, e) {
            t.stopPropagation(),
            this.hasFullscreen() ? this.isFullscreen() ? this.exitFullscreen() : this.requestFullscreen() : e ? this.openVrWindow() : this.openFakeFullscreen()
        },
        openFakeFullscreen: function() {
            this.viewer._currentModel && (o.a.any ? window.open(this.getEmbedUrl()) : window.open(this.getEmbedUrl(), "skfbFullscreenFallback", "menubar=no,toolbar=no"))
        },
        onFullScreenChange: function(t) {
            var e = r()(document);
            e.on("fullscreenchange", t),
            e.on("webkitfullscreenchange", t),
            e.on("msfullscreenchange", t),
            e.on("mozfullscreenchange", t)
        },
        offFullScreenChange: function(t) {
            var e = r()(document);
            e.off("fullscreenchange", t),
            e.off("webkitfullscreenchange", t),
            e.off("msfullscreenchange", t),
            e.off("mozfullscreenchange", t)
        },
        fullScreenChange: function() {
            r()('[data-action="fullscreen"] > .icon').toggleClass("icon-fullscreen-icon").toggleClass("icon-fullscreen-off-icon"),
            this.viewer.$el.toggleClass("fullscreen", this.isFullscreen());
            var t = this.viewer.scene.getFeatures().webVR;
            if (t) {
                var e = t.getModel();
                this.isFullscreen() ? !0 === this.enableVR && e.set("enable", !0) : !0 === this.enableVR && (e.set("enable", !1),
                this.enableVR = !1)
            }
        },
        fullscreenVR: function(t) {
            return this.enableVR = !0,
            this.onFullscreenClick(t, !0)
        },
        hasFullscreen: function() {
            return document.fullscreenEnabled || document.webkitFullscreenEnabled || document.msFullscreenEnabled || document.mozFullScreenEnabled
        },
        isFullscreen: function() {
            return document.mozFullScreen || document.webkitIsFullScreen
        },
        requestFullscreen: function() {
            this.viewer.el.requestFullscreen ? this.viewer.el.requestFullscreen() : this.viewer.el.webkitRequestFullscreen ? this.viewer.el.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT) : this.viewer.el.msRequestFullscreen ? this.viewer.el.msRequestFullscreen() : this.viewer.el.mozRequestFullScreen && this.viewer.el.mozRequestFullScreen()
        },
        exitFullscreen: function() {
            document.exitFullscreen ? document.exitFullscreen() : document.webkitExitFullscreen ? document.webkitExitFullscreen() : document.msExitFullscreen ? document.msExitFullscreen() : document.mozCancelFullScreen && document.mozCancelFullScreen()
        },
        replaceDOMElement: i.i(a.debounce)(function(t) {
            var e = t.target.parentElement
              , n = t.target.nextSibling;
            e && (e.removeChild(t.target),
            i.i(a.defer)(function() {
                e.insertBefore(t.target, n)
            }))
        }, 2e3)
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(172);
    e.a = n.a.extend({
        events: {
            "click .close": "close"
        },
        close: function(t) {
            t && t.preventDefault && t.preventDefault()
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(1)
      , s = (i.n(a),
    i(16))
      , o = i(452)
      , l = i(37)
      , u = i(454)
      , h = l.a.shortcuts;
    e.a = u.a.extend({
        events: {
            "click .tabs a": "onTabClick",
            "touchstart .tabs a": "onTabClick",
            'click [data-action="reset-camera"]': "onResetCameraClick",
            'touchstart [data-action="reset-camera"]': "onResetCameraClick"
        },
        initialize: function() {
            u.a.prototype.initialize.apply(this, arguments),
            this.renderingShortcuts = new o.a(h.viewerRendering),
            this.annotationShortcuts = new o.a(h.annotationControl),
            this.animationShortcuts = new o.a(h.animationControl),
            this.render()
        },
        onResetCameraClick: function(t) {
            t.preventDefault(),
            s.a.modelViewerResetCameraButtonClicked(),
            this.hide(),
            this.viewer.scene.getFeaturesManager().focusOnSavedCamera(2),
            i.i(a.defer)(function(t) {
                t.target.blur()
            }, t)
        },
        render: function() {
            var t = this.renderingShortcuts.generateHelpSection()
              , e = this.annotationShortcuts.generateHelpSection()
              , i = this.animationShortcuts.generateHelpSection();
            this.$(".rendering-shortcuts").html(t),
            this.$(".annotation-shortcuts").html(e),
            this.$(".animation-shortcuts").html(i)
        },
        onTabClick: function(t) {
            t.preventDefault();
            var e = r()(t.currentTarget)
              , i = e.attr("data-target")
              , n = this.$("[data-tab].active")
              , a = this.$('[data-tab="' + i + '"]');
            s.a.modelViewerHelpTabClicked(i),
            this.$(".tabs li").removeClass("active"),
            e.parent().addClass("active"),
            n.removeClass("active"),
            a.addClass("active")
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(172))
      , a = i(83)
      , s = i(29);
    e.a = r.a.extend({
        initialize: function() {
            r.a.prototype.initialize.apply(this, arguments),
            this.$hint = this.$(".viewer-hint"),
            this.options.fallback && this.$hint.addClass("fallback-position")
        },
        show: function(t) {
            t = i.i(n.defaults)(i.i(n.extend)({}, t), {
                force: !1
            });
            var e = 1 === a.a.get("show_viewer_hint", 1)
              , r = i.i(s.a)().uiHint;
            2 === r && (t.force = !0),
            (t.force || 1 === r && e) && this.$hint.addClass("active")
        },
        hide: function(t) {
            t = i.i(n.defaults)(i.i(n.extend)({}, t), {
                remember: !0
            }),
            this.$hint.removeClass("active"),
            t.remember && a.a.set("show_viewer_hint", 0, {
                expires: 15552e6,
                path: "/"
            })
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(165)
      , r = i(454)
      , a = r.a.extend({
        mixins: [n.a],
        events: {
            "click .tabs a": "onTabClick",
            'click [data-action="reset-camera"]': "onResetCameraClick"
        },
        setModel: function(t) {
            this.model = t,
            this.render()
        },
        render: function() {
            this.model && (this.$(".hotspot-title").html(this.model.get("name")),
            this.$(".hotspot-content").html(this.model.get("content").rendered),
            this.handleLazyLoading())
        }
    });
    e.a = a
}
, function(t, e, i) {
    "use strict";
    var n = i(4)
      , r = i(172)
      , a = i(405)
      , s = i.n(a)
      , o = i(29)
      , l = n.a.osg
      , u = new s.a({
        device: "VWR"
    });
    e.a = r.a.extend({
        reset: function() {
            this._primaryProgress = 0,
            this._secondaryProgress = 0,
            this._lowerSecondaryProgress = 0,
            this._actualSecondaryProgress = 0
        },
        handleLoading: function(t) {
            t.scene.on("primary-progress", function(t) {
                if (this.setPrimaryProgress(t.progress),
                i.i(o.a)().isApp) {
                    var e = u.createMessage({
                        data: {
                            progress: t.progress + ""
                        }
                    });
                    this.previousMessage && this.previousMessage.removeFromHash(),
                    e.appendToHash(),
                    this.previousMessage = e
                }
            }
            .bind(this)),
            t.scene.on("secondary-progress", function(t) {
                this.setSecondaryProgress(t.progress)
            }
            .bind(this)),
            t.scene.on("success", function() {
                this.viewer.$el.removeClass("model-loading").addClass("model-loaded"),
                t.model.trigger("status:loaded"),
                this.trigger("loaded")
            }
            .bind(this)),
            t.scene.on("fail", function() {
                l.error("Viewer instanciation failed")
            }
            .bind(this))
        },
        setPrimaryProgress: function(t) {
            var e = Math.min(Math.max(0, t), 1);
            this._primaryProgress = e,
            this.updateMainProgressBar(this._primaryProgress),
            1 === this._primaryProgress && (this._lowerSecondaryProgress = this._actualSecondaryProgress,
            this.setSecondaryProgress(this._secondaryProgress))
        },
        setSecondaryProgress: function(t) {
            var e = Math.min(Math.max(0, t), 1);
            this._actualSecondaryProgress = e,
            this._secondaryProgress = (this._actualSecondaryProgress - this._lowerSecondaryProgress) / (1 - this._lowerSecondaryProgress),
            1 === this._lowerSecondaryProgress && (this._secondaryProgress = 1),
            this.updateSecondaryProgressBar(this._secondaryProgress)
        },
        updateMainProgressBar: function(t) {
            var e = 1 === this._primaryProgress;
            t = Math.max(t, this._previousPrimaryValue || 0),
            this._previousPrimaryValue = t,
            this.$(".main-progress").toggleClass("loading", !e),
            this.$(".main-progress-display").attr("value", t),
            this.$(".main-progress-percentage").text(Math.floor(100 * t) + " %")
        },
        updateSecondaryProgressBar: function(t) {
            t = Math.max(t, 0),
            this.$(".secondary-progress-percentage").text(Math.floor(100 * t) + " %"),
            this.$(".secondary-progress-display").css("width", 100 * t + "%");
            var e = 1 === this._primaryProgress
              , i = 1 === this._secondaryProgress;
            this.$(".secondary-progress").toggleClass("visible", e && !i)
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(88))
      , a = i(172);
    e.a = a.a.extend({
        events: {
            "click .osd": "hide"
        },
        show: function(t, e) {
            e = i.i(n.extend)({
                duration: 1 / 0,
                position: "center",
                style: "default"
            }, e),
            e.duration = Math.max(0, e.duration),
            window.clearTimeout(this.osdTimeout),
            this.$(".osd .osd-content").html(t);
            var r = this.$(".osd");
            r.removeClass("osd-default"),
            r.removeClass("osd-compact"),
            r.addClass("osd-" + e.style),
            r.removeClass("osd-top"),
            r.removeClass("osd-center"),
            r.removeClass("osd-bottom"),
            r.addClass("osd-" + e.position),
            e.duration > 0 && e.duration < 1 / 0 && (r.addClass("hud"),
            this.osdTimeout = setTimeout(this.hide.bind(this), e.duration)),
            r.hasClass("active") || (r.removeClass("hidden"),
            r.addClass("active"))
        },
        hide: function() {
            var t = this.$(".osd");
            t.removeClass("active"),
            i.i(r.a)(t[0], function() {
                t.addClass("hidden"),
                t.removeClass("hud"),
                this.$(".osd .osd-content").empty()
            }
            .bind(this))
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(1)
      , s = (i.n(a),
    i(88))
      , o = i(16)
      , l = i(172)
      , u = i.i(a.template)(['<div class="setting" data-setting="<%= name %>" data-setting-group="<%= group %>">', '   <p class="setting-label"><%= label %></p>', "</div>"].join(""))
      , h = i.i(a.template)(['<div class="setting" data-setting="<%= name %>" data-setting-group="<%= group %>" data-setting-type="<%= type %>">', '   <p class="setting-label"><%= label %></p>', '   <p class="setting-value" data-value="<%= value %>" ><%= prettyValue %></p>', "</div>"].join(""))
      , c = i.i(a.template)(['   <a class="control-menu-back back">Back</a>', '   <ul class="setting-list" data-setting="<%= name %>" data-setting-type="<%= type %>">', "       <%= listItems %>", "   </ul>"].join(""))
      , d = i.i(a.template)(['<li class="setting-item <% if (selected) { %>selected<% } %>" data-value="<%= value %>">', "   <%= prettyValue %>", '   <span class="shortcut" title="Keyboard shortcut"><%= shortcut %></span>', "</li>"].join(""));
    e.a = l.a.extend({
        initialize: function(t) {
            this.settings = t.settings,
            this.viewer = t.viewer,
            this.settings || console.warn("No settings object given to SettingsMenu"),
            l.a.prototype.initialize.apply(this, arguments),
            this.$list = this.$(".control-menu-list"),
            this.$pane = this.$(".control-menu-pane"),
            this.$el.on("click touchend", ".setting", this.onSettingClick.bind(this)),
            this.$el.on("click touchend", ".back", this.togglePane.bind(this, !1)),
            this.$el.on("click touchend", ".setting-item", this.onSettingValueClick.bind(this)),
            this.$el.on("click touchend", '[data-setting="viewerMode"] li', this.onViewerModeChange.bind(this)),
            this.$el.on("click touchend", '.wireframe-colors a[data-setting="wireframeColor"]:not(.active)', this.onWireframeColorClick.bind(this)),
            this.$el.on("click touchend", '.wireframe-colors a[data-setting="wireframeColor"].active', this.onDisableWireframeClick.bind(this)),
            this.$el.on("click touchend", '.wireframe-colors a[data-setting="wireframeEnable"]', this.onDisableWireframeClick.bind(this)),
            this.viewer.proxySettings.on("change", this.render.bind(this))
        },
        onViewerModeChange: function(t) {
            t && "touchend" === t.type && t.preventDefault(),
            "0" === this.viewer.proxySettings.get("viewerMode") ? this.viewer.subviews.osd.show("Click and hold to rotate", {
                position: "top",
                duration: 3e3
            }) : this.viewer.subviews.osd.show("Mouse to look around, keyboard to move", {
                position: "top",
                duration: 3e3
            })
        },
        onDisableWireframeClick: function(t) {
            t && "touchend" === t.type && t.preventDefault();
            var e = this.$('.wireframe-colors [data-setting="wireframeEnable"]');
            this.viewer.proxySettings.set("wireframeEnable", !1),
            e.parent().find(".active").removeClass("active"),
            e.addClass("active")
        },
        onWireframeColorClick: function(t) {
            t && "touchend" === t.type && t.preventDefault();
            var e = r()(t.currentTarget)
              , i = e.attr("data-value");
            this.viewer.proxySettings.set("wireframeColor", i),
            this.viewer.proxySettings.set("wireframeEnable", !0),
            e.parent().find(".active").removeClass("active"),
            e.addClass("active"),
            o.a.modelViewerWireframeColorSelected(i)
        },
        onSettingClick: function(t) {
            t && "touchend" === t.type && t.preventDefault && t.preventDefault();
            var e = r()(t.currentTarget).attr("data-setting")
              , i = this.settings[e];
            if (i.name = e,
            i.isButton)
                return this[i.action] && this[i.action](t);
            this.renderSettingPane(i),
            this.togglePane(!0)
        },
        onSettingValueClick: function(t) {
            t.preventDefault(),
            t.stopPropagation();
            var e = r()(t.currentTarget)
              , i = e.attr("data-value")
              , n = e.closest("[data-setting]").attr("data-setting")
              , a = e.closest("[data-setting]").attr("data-setting-type") || "string"
              , s = this.settings[n];
            switch ("shadingStyle" === n ? o.a.modelViewerShadingSelected(i) : "cycleMode" === n ? o.a.modelViewerAnimationRepeatModeSelected(i) : "annotationsVisible" === n ? o.a.modelViewerAnnotationsToggled(this.viewer._currentModel.get("uid"), "false" !== i) : "viewerMode" === n && o.a.modelViewerViewerModeSelected(i),
            this.viewer.proxySettings.once("change", function() {
                s.value = i,
                this.renderSettingPane(s),
                this.updateSetting(s),
                "shadingStyle" !== n && this.togglePane()
            }
            .bind(this)),
            a) {
            case "number":
                i = parseFloat(i);
                break;
            case "bool":
                i = "true" === i
            }
            this.viewer.proxySettings.set(n, i)
        },
        onSoundCreditsClick: function(t) {
            t.preventDefault(),
            t.stopPropagation(),
            this.viewer.subviews.gui.closeMenus(),
            this.viewer.subviews.soundCreditsOverlay.show(),
            o.a.modelViewerSoundCreditsButtonClicked()
        },
        onSettingChangeWhileOpen: function() {
            this.renderSettingPane(this._currentSetting)
        },
        renderSettingPane: function(t) {
            var e = ""
              , n = ""
              , r = this.viewer.proxySettings.get(t.name)
              , s = this.getSettingFromValue(t.name, r)
              , o = this.viewer._currentModel.get("options").shading.type;
            this._currentSetting && this.viewer.proxySettings.off("change:" + this._currentSetting.name, this.onSettingChangeWhileOpen, this),
            this._currentSetting = t,
            this._currentSetting && this.viewer.proxySettings.on("change:" + this._currentSetting.name, this.onSettingChangeWhileOpen, this),
            "shadingStyle" === t.name && "lit" !== o || i.i(a.each)(t.settings, function(t) {
                e += d({
                    value: t.value,
                    type: t.type || "string",
                    prettyValue: t.label,
                    selected: s === t,
                    shortcut: t.shortcut || ""
                })
            }),
            n = (t.paneTemplate || c)({
                listItems: e,
                name: t.name,
                type: t.type || "string",
                viewerSettings: this.viewer.proxySettings.toJSON()
            }),
            this.$pane.html(n);
            var l = this.viewer.scene.getFeatures().webVR.getModel();
            "viewerMode" !== this._currentSetting.name || l.get("hasNativeHMD") ? this.$('[data-value="2"]').show() : this.$('[data-value="2"]').hide()
        },
        updateSetting: function(t) {
            var e = (this.getSettingFromValue(t.name, t.value) || {}).label || "Unknown Value";
            this.$list.find('[data-setting="' + t.name + '"]').find(".setting-value").html(e)
        },
        getSettingFromValue: function(t, e) {
            var i;
            return (this.settings[t].settings || []).forEach(function(t) {
                t.value !== e && t.value + "" != e + "" || (i = t)
            }),
            i
        },
        togglePane: function(t, e) {
            e && "touchend" === e.type && e.preventDefault(),
            this.$el.toggleClass("detail", t),
            i.i(s.a)(this.$(".control-menu-wrapper"), function() {
                this.$el.hasClass("detail") || this.clearPane()
            }
            .bind(this))
        },
        clearPane: function() {
            this.$pane.html("")
        },
        render: function() {
            var t = ""
              , e = this.viewer.scene.getFeatures().quality.getModel()
              , n = this.viewer.scene.getFeatures().manipulator.getModel()
              , r = this.viewer.scene.getFeatures().hotspot.getModel()
              , s = this.viewer.scene.getFeatures().animation.getModel()
              , o = [];
            i.i(a.each)(this.settings, function(t, e) {
                var n = i.i(a.clone)(t);
                n.name = e,
                o.push(n)
            }),
            o = i.i(a.sortBy)(o, "order"),
            i.i(a.each)(o, function(e) {
                var i, n = e.name;
                if (e.isButton)
                    i = u({
                        name: n,
                        label: e.label,
                        group: e.group
                    });
                else {
                    var r = this.getSettingFromValue(n, this.viewer.proxySettings.get(n)) || e.settings[0];
                    i = h({
                        name: n,
                        label: e.label,
                        value: r.value,
                        prettyValue: r.label,
                        group: e.group,
                        type: r.type
                    })
                }
                t += i
            }
            .bind(this)),
            this.$list.html(t),
            l.a.prototype.render.apply(this, arguments),
            s && s.get("animations").length ? this.$('[data-setting-group="animation"]').show() : this.$('[data-setting-group="animation"]').hide(),
            e && e.get("promiseReady").isFulfilled() ? this.$('[data-setting-group="textureQuality"]').show() : this.$('[data-setting-group="textureQuality"]').hide(),
            r && r.get("hotspots").length ? this.$('[data-setting-group="annotation"]').show() : this.$('[data-setting-group="annotation"]').hide();
            var c = this.getSettingFromValue("viewerMode", n.get("indexManipulator"));
            if (this.$('[data-setting="viewerMode"] .setting-value').attr("data-value", c.value).text(c.label),
            s) {
                var d = this.getSettingFromValue("speed", s.get("speed"));
                this.$('[data-setting="speed"] .setting-value').attr("data-value", d.value).text(d.label);
                var p = this.getSettingFromValue("cycleMode", s.get("cycleMode"));
                this.$('[data-setting="cycleMode"] .setting-value').attr("data-value", p.value).text(p.label)
            }
            e && e.get("promiseReady").isFulfilled() && window.requestAnimationFrame(function() {
                var t = this.getSettingFromValue("textureQuality", e.get("level"));
                this.$('[data-setting="textureQuality"] .setting-value').attr("data-value", t.value).text(t.label)
            }
            .bind(this))
        },
        onTextureQualityReady: function(t) {
            var e = this.viewer.scene.getFeatures().quality;
            if (e) {
                if (!t.low && !t.mid && !t.high)
                    return void this.$('[data-setting="textureQuality"]').remove();
                var i = e.getModel()
                  , n = i.get("level");
                this.viewer.proxySettings.set("textureQuality", n),
                this.render()
            }
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(7))
      , a = i.n(r)
      , s = i(4)
      , o = i(172)
      , l = i(716)
      , u = i(718)
      , h = i(27)
      , c = i(469)
      , d = s.a.osg;
    e.a = o.a.extend({
        events: {
            "mouseover .snapshot .button": "showGuides",
            "mouseout .snapshot .button": "hideGuides"
        },
        initialize: function() {
            o.a.prototype.initialize.apply(this, arguments),
            this.$el.find(".snapshot .button").on("click", this.onSnapshot.bind(this))
        },
        onSnapshot: function(t) {
            var e = this.viewer.scene;
            t.preventDefault();
            var i = this.$el.find(".snapshot")
              , n = this.$el.find(".snapshot-flash")
              , r = this.$el.find(".img-container");
            if (!i.hasClass("progress")) {
                i.addClass("progress"),
                n.addClass("active"),
                setTimeout(function() {
                    n.removeClass("active")
                }, 2e3);
                var s = !0
                  , o = e.getFeatures();
                if (o.manipulator) {
                    o.manipulator && o.manipulator.getModel().saveCameraPosition();
                    var l = e.getFeatures().saveUI;
                    l || (l = new u.a,
                    l.init(e.getFeaturesManager()._context),
                    l._views[0].enableSaving()),
                    s = l._views[0].save(t)
                }
                a.a.all([e.getScreenShot(), s]).then(this.onTakeScreenshot.bind(this, i, r))
            }
        },
        onTakeScreenshot: function(t, e, n) {
            var r = n[0]
              , a = i.i(c.a)(r.toDataURL("image/jpeg"))
              , s = new l.a({
                imageFile: a
            })
              , o = this.viewer._currentModel
              , u = s.save({
                modelUID: o.get("uid")
            })
              , p = e.find("img");
            p && (p.remove(),
            null !== this.previewTimeout && (window.clearTimeout(this.previewTimeout),
            this.previewTimeout = null));
            var f = new Image;
            f.src = r.toDataURL("image/jpeg"),
            e.prepend(f),
            e.removeClass("invisible"),
            this.previewTimeout = setTimeout(function() {
                e.addClass("invisible")
            }, 4e3),
            u.done(function() {
                t.removeClass("progress"),
                t.addClass("success"),
                setTimeout(function() {
                    t.removeClass("success")
                }, 2e3)
            }).fail(function() {
                var e = new h.default({
                    title: "Save settings error",
                    text: "An unexpected error happened. The thumbnail has NOT been saved.",
                    buttons: {
                        ok: !0
                    }
                });
                e.open().then(function() {
                    e.close()
                }),
                d.error("Error while saving snapshot"),
                t.removeClass("progress")
            })
        },
        showGuides: i.i(n.debounce)(function() {
            this.$(".snapshot-guides").addClass("active")
        }, 100),
        hideGuides: i.i(n.debounce)(function() {
            this.$(".snapshot-guides").removeClass("active")
        }, 100)
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(2)
      , r = i.n(n)
      , a = i(1)
      , s = (i.n(a),
    i(713))
      , o = i(172)
      , l = i(37)
      , u = i(452);
    e.a = o.a.extend({
        events: i.i(a.extend)({}, o.a.prototype.events, {
            touchstart: "onTouchStart",
            mousedown: "onClick",
            mouseover: "onMouseover",
            mouseout: "onMouseout"
        }),
        initialize: function() {
            o.a.prototype.initialize.apply(this, arguments),
            this.previousValue = null,
            this._touched = !1,
            this.$icon = this.$(".fa"),
            this.listenTo(this.model, "change:volume", this.render.bind(this)),
            this.render(),
            this.$volumeMenu = this.$(".volume-menu"),
            this.slider = new s.a(void 0,{
                model: this.model,
                global: !0,
                orientation: "vertical"
            }),
            this.$volumeMenu.append(this.slider.$el),
            this.initializeShortcuts()
        },
        initializeShortcuts: function() {
            this.soundControlShortcuts = new u.a(l.a.shortcuts.sound),
            this.soundControlShortcuts.on("mute", this.toggleMute.bind(this)),
            this.soundControlShortcuts.listen()
        },
        onTouchStart: function() {
            this._touched = !0
        },
        onClick: function(t) {
            t.preventDefault();
            var e = r()(t.target);
            e.is(".volume-menu") || e.parents(".volume-menu").length || this.toggleMute()
        },
        toggleMute: function() {
            this.slider.onoff()
        },
        render: function() {
            var t = this.model.get("volume");
            return this.$icon.toggleClass("fa-volume-up", t > 0),
            this.$icon.toggleClass("fa-volume-off", 0 === t),
            this
        },
        togglePane: function(t) {
            this.$volumeMenu.toggleClass("--active", t)
        },
        onMouseover: function() {
            if (this._touched)
                return void (this._touched = !1);
            this.togglePane(!0)
        },
        onMouseout: function() {
            this.togglePane(!1)
        },
        show: function() {
            this.viewer.$el.addClass("sound-enabled")
        },
        hide: function() {
            this.viewer.$el.removeClass("sound-enabled")
        }
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(1)
      , r = (i.n(n),
    i(7))
      , a = i.n(r)
      , s = i(545)
      , o = i(9)
      , l = i(454);
    e.a = l.a.extend({
        trackTemplate: o.default.getFromString(['<div class="track">', '    <img height="50px" src="{{ artworkUrl }}">', '    <div class="meta">', "        <span><b>{{ title }}</b> by {{ artist }}</span>", '        <a href="{{ url }}" target="_blank">{{ url }}</span>', "    </div>", "</div>"].join("")),
        initialize: function() {
            this.$tracks = this.$(".tracks")
        },
        render: i.i(n.debounce)(function(t) {
            var e = []
              , i = [];
            t.each(function(t) {
                var n = t.get("soundcloudID");
                -1 === e.indexOf(n) && (e.push(n),
                i.push(s.a.fetch(n)))
            }),
            a.a.map(i, function(t) {
                return this.trackTemplate({
                    artworkUrl: t.artwork_url || t.user.avatar_url,
                    title: t.title,
                    artist: t.user.username,
                    url: t.permalink_url
                })
            }
            .bind(this)).then(function(t) {
                this.$tracks.html(t.join(""))
            }
            .bind(this)).catch(function(t) {
                console.error("Sound error: can not get track info", t)
            })
        }, 100)
    })
}
, function(t, e, i) {
    "use strict";
    var n = i(172);
    e.a = n.a.extend({
        events: {
            "click .close": "close",
            "touchstart .close": "close"
        },
        initialize: function() {
            n.a.prototype.initialize.apply(this, arguments),
            this.toggle(),
            this.model.on("change:notSupported", this.toggle, this)
        },
        toggle: function() {
            var t = this.model.get("notSupported");
            this.$el.toggleClass("hidden", !t)
        },
        close: function(t) {
            t && t.preventDefault && t.preventDefault(),
            this.$el.addClass("hidden"),
            setTimeout(function() {
                this.$el.remove()
            }
            .bind(this), 300)
        }
    })
}
, function(t, e) {
    t.exports = {}
}
, function(t, e) {
    t.exports = {
        allow_ui_fadeout: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_fadeout"],
            limited_to: "biz"
        },
        allow_snapshots: {
            type: "bool",
            defaultValue: !1,
            query_params: ["ui_snapshots"],
            limited_to: null
        },
        allow_stops: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_stop", "stop_button"],
            limited_to: null
        },
        animation_autoplay: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "private",
            help: "Automatically play animations when the viewer starts."
        },
        anisotropy: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "private",
            help: "If we activate anisotropy when trilinear is chosen."
        },
        annotation: {
            type: "number",
            defaultValue: 0,
            values: "[1 - 50]",
            share: "public",
            help: "Setting to [1 - 50] will automatically load that annotation when the viewer starts."
        },
        annotation_cycle: {
            type: "number",
            defaultValue: null,
            values: "+X",
            share: "public",
            help: "Setting to any number will start the Autopilot cycle with that duration, in seconds, at each annotation."
        },
        annotations_visible: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "public",
            help: "Setting to 0 will hide annotations by default."
        },
        api_id: {
            type: "string",
            defaultValue: null,
            values: "string",
            share: "private",
            help: "The id of the viewer API."
        },
        api_version: {
            type: "string",
            defaultValue: null,
            values: "string",
            share: "private",
            help: "The version of the viewer API."
        },
        async_image: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "shared",
            help: "Loads png and jpg in asynchronous (memory overhead for now so disabled by default)."
        },
        autospin: {
            type: "number",
            defaultValue: 0,
            values: "+/-X",
            share: "public",
            help: "Setting to any number will cause the model to automatically spin around the z-axis after loading. The greater the number, the faster the spin. A negative number will reverse the spin direction.",
            query_params: ["autospin"]
        },
        autostart: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "public",
            help: "Setting to 1 will make the model load immediately once the page is ready, rather than waiting for a user to click the Play button."
        },
        blending: {
            type: "number",
            defaultValue: null,
            values: "+/-X",
            share: "private",
            help: "Uses the blending mode that cycle between material channel (will be deprecated with model inspector). Value indicates cycle times."
        },
        camera: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "public",
            help: "Setting to 0 will skip the initial animation that occurs when a model is loaded, and immediately show the model in its default position.",
            query_params: ["camera"]
        },
        camera_easing: {
            type: "number",
            defaultValue: null,
            values: "0..1",
            share: "private",
            help: "0 means no easing."
        },
        camera_eye: {
            type: "vec3",
            defaultValue: null,
            values: "X,Y,Z",
            share: "private",
            help: "Forces position of the camera."
        },
        camera_follow_bones: {
            type: "number",
            defaultValue: 0,
            values: "0, 1, 2",
            share: "private",
            help: "1: translate eye 2: focus eye. You need to double-click the model on an animated part first."
        },
        camera_shadows: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "private",
            help: "Enable shadows on the camera."
        },
        camera_target: {
            type: "vec3",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "Forces the target of the camera."
        },
        cardboard: {
            type: "number",
            defaultValue: 0,
            values: "0, 1, 2",
            share: "public",
            help: "Start in VR Mode automatically."
        },
        carmel: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "If we are in the carmel context."
        },
        continuous_render: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Redraw continuously."
        },
        convert_vertex_color_8bit: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "private",
            help: "Converts vertex color in 8bit."
        },
        debug3d: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Open a dat.gui panel to debug 3d stuffs."
        },
        debug_env_shadow: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Debug shadow environment."
        },
        desc_button: {
            type: "number",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Legacy, now ui_infos?"
        },
        dof_attenuate_distance: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "private",
            help: "Attenuates dof effect when we unzoom."
        },
        dof_attenuate_speed: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Attenuates dof effect when we move the camera."
        },
        dof_res: {
            type: "number",
            defaultValue: 2,
            values: "+X",
            share: "private",
            help: "Resolution divider of dof postprocess (2 means half resolution)."
        },
        dof_sticky: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "If the dof focus point sticks on the same place."
        },
        dof_transition: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "private",
            help: "If there is a transition when changing the dof focus point."
        },
        double_click: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "shared",
            help: "If we allow double-click (focus constraint)."
        },
        download_picture: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Download the thumbnail on Save View."
        },
        enable_tracking: {
            type: "bool",
            defaultValue: !0,
            query_params: ["tracking"],
            limited_to: "staff"
        },
        epsilon_alpha: {
            type: "number",
            defaultValue: 1e-5,
            values: "0..1",
            share: "private",
            help: "GPU workaround bug with epsilon alpha discard threshold."
        },
        float_rtt: {
            type: "number",
            defaultValue: 2,
            values: "0, 1, 2",
            share: "private",
            help: "0 : force 8bit, 1 force float if supported, 2 : depends (dynamic)."
        },
        fps_speed: {
            type: "number",
            defaultValue: 5,
            values: "+X",
            share: "public",
            help: "Set the default walk speed in First-Person."
        },
        grain_speed: {
            type: "number",
            defaultValue: 64,
            values: "+X",
            share: "private",
            help: "Grain animation speed, in ms."
        },
        graph_optimizer: {
            type: "bool",
            defaultValue: null,
            values: "+X",
            share: "private",
            help: "Optimizes mesh (merge and bake geometries, etc), disabled by default in some cases (editor, api, processing)."
        },
        image_compression: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "shared",
            help: "Use the full resolution, original textures."
        },
        internal: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Allows us to use limited parameters on whitelisted domains (e.g. hide the watermark on sketchfab.com).",
            query_params: ["internal"]
        },
        is_app: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "If we are in the mobile app context."
        },
        is_started: {
            type: "bool",
            defaultValue: !1,
            query_params: ["autostart"]
        },
        keep_empty_geometries: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "If we want to keep the empty geometries in the scene graph instead of removing them."
        },
        material_ao: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override ao channel for material given by material_names option."
        },
        material_cavity: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override cavity channel for material given by material_names option."
        },
        material_diffuse: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override diffuse channel for material given by material_names option."
        },
        material_displacement: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override displacement channel for material given by material_names option."
        },
        material_displacement_factor: {
            type: "number",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override displacement factor channel for material given by material_names option."
        },
        material_emissive: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override emissive channel for material given by material_names option."
        },
        material_f0: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override f0 channel for material given by material_names option."
        },
        material_glossiness: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override glossiness channel for material given by material_names option."
        },
        material_metalness: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override metalness channel for material given by material_names option."
        },
        material_names: {
            type: "string",
            defaultValue: "main_material",
            values: "0, 1",
            share: "private",
            help: "Multiple names are separated with ; For example material_names=mat1;mat2."
        },
        material_normal: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override normal channel for material given by material_names option."
        },
        material_packing: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "Pack texture materials."
        },
        material_roughness: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override roughness channel for material given by material_names option."
        },
        material_showcase: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Enables material showcase."
        },
        material_specular: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override specular channel for material given by material_names option."
        },
        material_transparency: {
            type: "string",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "override opacity channel for material given by material_names option."
        },
        max_texture_size: {
            type: "number",
            defaultValue: 8192,
            values: "+X",
            share: "private",
            help: "All texture capped at that texture size."
        },
        merge_materials: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "private",
            help: "Merge similar materials."
        },
        messaging: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "private"
        },
        model: {
            type: "string",
            defaultValue: null,
            values: "uid",
            share: "UID of model to hook."
        },
        navigation: {
            type: "string",
            defaultValue: "orbit",
            values: "orbit, fps",
            share: "public",
            help: "Choose between fps and orbit mode."
        },
        normal_compression: {
            type: "string",
            defaultValue: "percep",
            values: "percep, jpg",
            share: "private",
            help: "In case of astc normalmap, choose between astc and jpg."
        },
        normal_offset_shadow: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "If we use normal offset shadow bias."
        },
        orbit_constraint_pan: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "shared",
            help: "Disable panning"
        },
        orbit_constraint_pitch_down: {
            type: "number",
            defaultValue: -1.5550883635269477,
            values: "[-PI/2, PI/2]",
            share: "shared",
            help: "Disable panning."
        },
        orbit_constraint_pitch_up: {
            type: "number",
            defaultValue: 1.5550883635269477,
            values: "[-PI/2, PI/2]",
            share: "shared",
            help: "Pitch down limit."
        },
        orbit_constraint_yaw_left: {
            type: "number",
            defaultValue: -3.141592653589793,
            values: "[-PI, PI]",
            share: "shared",
            help: "Yaw left limit."
        },
        orbit_constraint_yaw_right: {
            type: "number",
            defaultValue: 3.141592653589793,
            values: "[-PI, PI]",
            share: "shared",
            help: "Yaw right limit."
        },
        orbit_constraint_zoom_in: {
            type: "number",
            defaultValue: 0,
            values: "+X",
            share: "shared",
            help: "Zoom in limit."
        },
        orbit_constraint_zoom_out: {
            type: "number",
            defaultValue: "Infinity",
            values: "+X",
            share: "shared",
            help: "Zoom out limit."
        },
        panorama: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Uses panorama hdr instead of cubemap."
        },
        pixel_budget: {
            type: "number",
            defaultValue: null,
            values: "+X",
            share: "private",
            help: "0 is infinite, x is nb of pixel (e.g 4096)."
        },
        post_process: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "private",
            help: "If postprocess filters are enabled."
        },
        power_preference: {
            type: "string",
            defaultValue: "default",
            values: "default|low-power|high-performance",
            share: "private",
            help: "Hint for gpu (power battery vs performance). Setting high-performance might be unsafe (context lost), so be wary."
        },
        preload: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "public",
            help: "Download all textures before displaying the model."
        },
        preserve_drawing_buffer: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "public",
            help: "WebGL canvas option."
        },
        process_material: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Reprocess materials."
        },
        process_options: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Reprocess all the options (same as a reupload without backend reprocessing)."
        },
        resize_rate: {
            type: "number",
            defaultValue: 100,
            values: "+X",
            share: "shared",
            help: "Resize rate of canvas (in ms)."
        },
        scrollwheel: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "public",
            help: "Disable zooming with scrollwheel (Ctrl+Click/drag still zooms)."
        },
        shadow_env: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "public",
            help: "Activates shadow directional light environment feature."
        },
        shadow_PCF: {
            type: "string",
            defaultValue: "1Tap(4texFetch)",
            values: "1Band(1texFetch), 4Band(4texFetch), 9Band(9texFetch), 16Band(16texFetch), 1Tap(4texFetch), 4Tap(16texFetch), 9Tap(36texFetch), 16Tap(64texFetch), 4Poisson(16texFetch), 8Poisson(32texFetch), 16Poisson(64texFetch), 25Poisson(100texFetch), 32Poisson(128texFetch)",
            share: "private",
            help: "Shadow attempt to fight aliasing complex settings."
        },
        shadow_texture_size: {
            type: "number",
            defaultValue: 1024,
            values: "+X",
            share: "private",
            help: "Size of shadowmaps."
        },
        shared_draft: {
            type: "bool",
            default: !1,
            query_params: ["share"]
        },
        show_animations: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_animations"],
            limited_to: "biz"
        },
        show_annotations: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_annotations"],
            limited_to: "biz"
        },
        show_sound: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_sound"],
            limited_to: "staff"
        },
        show_bones: {
            type: "number",
            defaultValue: 0,
            values: "0, 1, 2, 3",
            share: "private",
            help: "1: Skeleton only, 2: Skeleton + Mesh, 3: Bounding boxes"
        },
        show_controls: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_controls", "controls"],
            limited_to: "biz"
        },
        show_full_screen: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_fullscreen"],
            limited_to: "biz"
        },
        show_general_controls: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_general_controls"],
            limited_to: "biz"
        },
        show_help: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_help"],
            limited_to: "biz"
        },
        show_infos: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_infos", "desc_button"],
            limited_to: "biz"
        },
        show_related: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_related"],
            limited_to: "pro"
        },
        show_settings: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_settings"],
            limited_to: "biz"
        },
        show_theatre: {
            type: "bool",
            defaultValue: !1,
            query_params: ["ui_theatre"],
            limited_to: "biz"
        },
        show_vr: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_vr"],
            limited_to: "biz"
        },
        show_watermark: {
            type: "bool",
            defaultValue: !0,
            query_params: ["ui_watermark", "watermark"],
            limited_to: "staff"
        },
        snap_keyframe: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Snap on keyframes."
        },
        sound_enable: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Enables the sound feature"
        },
        sound_mute: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Mute any sound"
        },
        sound_preload: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Preloads the sounds"
        },
        ssao_normal: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "DEBUG ONLY! otherwise needs mrt."
        },
        stats: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "OSGJS option to display stats"
        },
        substance_displacement: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Moves vertices in y dimension only (displacement map)."
        },
        supersample: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "private",
            help: "If accumulation supersample is enabled or not."
        },
        transparent: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "public",
            help: "Makes the background transparent.",
            query_params: ["transparent"]
        },
        ui_animations: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Hide Animation menu / timeline."
        },
        ui_annotations: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Hide Annotation menu / controls."
        },
        ui_controls: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Hide help, Settings, VR, Fullscreen."
        },
        ui_fullscreen: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Hide Fullscreen button."
        },
        ui_general_controls: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Hide all viewer controls."
        },
        ui_help: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Hide help button."
        },
        ui_hint: {
            type: "number",
            defaultValue: 1,
            values: "0, 1, 2",
            share: "private",
            help: "Hide viewer hint."
        },
        ui_infos: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Hide top info bar."
        },
        ui_related: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "pro",
            help: "Hide related models."
        },
        ui_settings: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Hide Settings button."
        },
        ui_snapshots: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "public",
            help: "Show Save View button."
        },
        ui_stop: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Hide Stop Viewer button. "
        },
        ui_vr: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "public",
            limited: "biz",
            help: "Hide View in VR button."
        },
        unit_render_local: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Uses for unit render test."
        },
        unit_render_screenshot: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Uses for unit render test."
        },
        unit_render_uid: {
            type: "string",
            defaultValue: null,
            values: "uid",
            share: "private",
            help: "To run 1 uid in /tests/screenshot"
        },
        use_vao: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "If we use the VAO gl extension."
        },
        varying_sorting: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "private",
            help: "Hack because of earlyz (bug gpu)."
        },
        vr_ar: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "transparent background and no floor (to test)"
        },
        vr_browser_env: {
            type: "string",
            defaultValue: null,
            values: "uid",
            share: "private",
            help: "Model UID of the environment model for the vr browse."
        },
        vr_fade: {
            type: "number",
            defaultValue: 200,
            values: "+X",
            share: "private",
            help: "Fade time of the black transition in vr."
        },
        vr_launcher_alpha_card_factor: {
            type: "number",
            defaultValue: 1,
            values: "+X",
            share: "private",
            help: "Alpha card factor."
        },
        vr_force_raf: {
            type: "bool",
            defaultValue: !1,
            values: "0, 1",
            share: "private",
            help: "Debug only (force replacement of native raf with hmd raf)."
        },
        vr_stereo: {
            type: "bool",
            defaultValue: !0,
            values: "0, 1",
            share: "private",
            help: "Mostly for debugging vr on desktop: disable stereo view in vr context."
        },
        vr_scale_rtt: {
            type: "number",
            defaultValue: 0,
            values: "+X",
            share: "private",
            help: "If not 0, it will scale the size of te recommended vr renderTarget."
        },
        webgl2: {
            type: "bool",
            defaultValue: null,
            values: "0, 1",
            share: "shared",
            help: "Uses webgl2 instead of webgl1 if provided."
        }
    }
}
]);
//# sourceMappingURL=viewer-a5ba3b61a2ca639adba6.js.map
